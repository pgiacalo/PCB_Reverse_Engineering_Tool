var W1=s=>{throw TypeError(s)};var X0=(s,e,t)=>e.has(s)||W1("Cannot "+t);var Ts=(s,e,t)=>(X0(s,e,"read from private field"),t?t.call(s):e.get(s)),_d=(s,e,t)=>e.has(s)?W1("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),Hl=(s,e,t,n)=>(X0(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t),jd=(s,e,t)=>(X0(s,e,"access private method"),t);var $1=(s,e,t,n)=>({set _(r){Hl(s,e,r,t)},get _(){return Ts(s,e,n)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var h4=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Dw(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var K0={exports:{}},Kf={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G1;function Lw(){if(G1)return Kf;G1=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,r,o){var d=null;if(o!==void 0&&(d=""+o),r.key!==void 0&&(d=""+r.key),"key"in r){o={};for(var c in r)c!=="key"&&(o[c]=r[c])}else o=r;return r=o.ref,{$$typeof:s,type:n,key:d,ref:r!==void 0?r:null,props:o}}return Kf.Fragment=e,Kf.jsx=t,Kf.jsxs=t,Kf}var Y1;function Mw(){return Y1||(Y1=1,K0.exports=Lw()),K0.exports}var l=Mw(),Z0={exports:{}},gi={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X1;function Iw(){if(X1)return gi;X1=1;var s=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),d=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),A=Symbol.iterator;function v(E){return E===null||typeof E!="object"?null:(E=A&&E[A]||E["@@iterator"],typeof E=="function"?E:null)}var N={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,_={};function b(E,L,Q){this.props=E,this.context=L,this.refs=_,this.updater=Q||N}b.prototype.isReactComponent={},b.prototype.setState=function(E,L){if(typeof E!="object"&&typeof E!="function"&&E!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,E,L,"setState")},b.prototype.forceUpdate=function(E){this.updater.enqueueForceUpdate(this,E,"forceUpdate")};function H(){}H.prototype=b.prototype;function R(E,L,Q){this.props=E,this.context=L,this.refs=_,this.updater=Q||N}var M=R.prototype=new H;M.constructor=R,T(M,b.prototype),M.isPureReactComponent=!0;var B=Array.isArray;function q(){}var G={H:null,A:null,T:null,S:null},X=Object.prototype.hasOwnProperty;function O(E,L,Q){var ee=Q.ref;return{$$typeof:s,type:E,key:L,ref:ee!==void 0?ee:null,props:Q}}function Y(E,L){return O(E.type,L,E.props)}function W(E){return typeof E=="object"&&E!==null&&E.$$typeof===s}function I(E){var L={"=":"=0",":":"=2"};return"$"+E.replace(/[=:]/g,function(Q){return L[Q]})}var J=/\/+/g;function Z(E,L){return typeof E=="object"&&E!==null&&E.key!=null?I(""+E.key):L.toString(36)}function Ce(E){switch(E.status){case"fulfilled":return E.value;case"rejected":throw E.reason;default:switch(typeof E.status=="string"?E.then(q,q):(E.status="pending",E.then(function(L){E.status==="pending"&&(E.status="fulfilled",E.value=L)},function(L){E.status==="pending"&&(E.status="rejected",E.reason=L)})),E.status){case"fulfilled":return E.value;case"rejected":throw E.reason}}throw E}function ie(E,L,Q,ee,oe){var xe=typeof E;(xe==="undefined"||xe==="boolean")&&(E=null);var re=!1;if(E===null)re=!0;else switch(xe){case"bigint":case"string":case"number":re=!0;break;case"object":switch(E.$$typeof){case s:case e:re=!0;break;case m:return re=E._init,ie(re(E._payload),L,Q,ee,oe)}}if(re)return oe=oe(E),re=ee===""?"."+Z(E,0):ee,B(oe)?(Q="",re!=null&&(Q=re.replace(J,"$&/")+"/"),ie(oe,L,Q,"",function(Oe){return Oe})):oe!=null&&(W(oe)&&(oe=Y(oe,Q+(oe.key==null||E&&E.key===oe.key?"":(""+oe.key).replace(J,"$&/")+"/")+re)),L.push(oe)),1;re=0;var Le=ee===""?".":ee+":";if(B(E))for(var Ee=0;Ee<E.length;Ee++)ee=E[Ee],xe=Le+Z(ee,Ee),re+=ie(ee,L,Q,xe,oe);else if(Ee=v(E),typeof Ee=="function")for(E=Ee.call(E),Ee=0;!(ee=E.next()).done;)ee=ee.value,xe=Le+Z(ee,Ee++),re+=ie(ee,L,Q,xe,oe);else if(xe==="object"){if(typeof E.then=="function")return ie(Ce(E),L,Q,ee,oe);throw L=String(E),Error("Objects are not valid as a React child (found: "+(L==="[object Object]"?"object with keys {"+Object.keys(E).join(", ")+"}":L)+"). If you meant to render a collection of children, use an array instead.")}return re}function le(E,L,Q){if(E==null)return E;var ee=[],oe=0;return ie(E,ee,"","",function(xe){return L.call(Q,xe,oe++)}),ee}function se(E){if(E._status===-1){var L=E._result;L=L(),L.then(function(Q){(E._status===0||E._status===-1)&&(E._status=1,E._result=Q)},function(Q){(E._status===0||E._status===-1)&&(E._status=2,E._result=Q)}),E._status===-1&&(E._status=0,E._result=L)}if(E._status===1)return E._result.default;throw E._result}var Ae=typeof reportError=="function"?reportError:function(E){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var L=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof E=="object"&&E!==null&&typeof E.message=="string"?String(E.message):String(E),error:E});if(!window.dispatchEvent(L))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",E);return}console.error(E)},ue={map:le,forEach:function(E,L,Q){le(E,function(){L.apply(this,arguments)},Q)},count:function(E){var L=0;return le(E,function(){L++}),L},toArray:function(E){return le(E,function(L){return L})||[]},only:function(E){if(!W(E))throw Error("React.Children.only expected to receive a single React element child.");return E}};return gi.Activity=y,gi.Children=ue,gi.Component=b,gi.Fragment=t,gi.Profiler=r,gi.PureComponent=R,gi.StrictMode=n,gi.Suspense=h,gi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=G,gi.__COMPILER_RUNTIME={__proto__:null,c:function(E){return G.H.useMemoCache(E)}},gi.cache=function(E){return function(){return E.apply(null,arguments)}},gi.cacheSignal=function(){return null},gi.cloneElement=function(E,L,Q){if(E==null)throw Error("The argument must be a React element, but you passed "+E+".");var ee=T({},E.props),oe=E.key;if(L!=null)for(xe in L.key!==void 0&&(oe=""+L.key),L)!X.call(L,xe)||xe==="key"||xe==="__self"||xe==="__source"||xe==="ref"&&L.ref===void 0||(ee[xe]=L[xe]);var xe=arguments.length-2;if(xe===1)ee.children=Q;else if(1<xe){for(var re=Array(xe),Le=0;Le<xe;Le++)re[Le]=arguments[Le+2];ee.children=re}return O(E.type,oe,ee)},gi.createContext=function(E){return E={$$typeof:d,_currentValue:E,_currentValue2:E,_threadCount:0,Provider:null,Consumer:null},E.Provider=E,E.Consumer={$$typeof:o,_context:E},E},gi.createElement=function(E,L,Q){var ee,oe={},xe=null;if(L!=null)for(ee in L.key!==void 0&&(xe=""+L.key),L)X.call(L,ee)&&ee!=="key"&&ee!=="__self"&&ee!=="__source"&&(oe[ee]=L[ee]);var re=arguments.length-2;if(re===1)oe.children=Q;else if(1<re){for(var Le=Array(re),Ee=0;Ee<re;Ee++)Le[Ee]=arguments[Ee+2];oe.children=Le}if(E&&E.defaultProps)for(ee in re=E.defaultProps,re)oe[ee]===void 0&&(oe[ee]=re[ee]);return O(E,xe,oe)},gi.createRef=function(){return{current:null}},gi.forwardRef=function(E){return{$$typeof:c,render:E}},gi.isValidElement=W,gi.lazy=function(E){return{$$typeof:m,_payload:{_status:-1,_result:E},_init:se}},gi.memo=function(E,L){return{$$typeof:f,type:E,compare:L===void 0?null:L}},gi.startTransition=function(E){var L=G.T,Q={};G.T=Q;try{var ee=E(),oe=G.S;oe!==null&&oe(Q,ee),typeof ee=="object"&&ee!==null&&typeof ee.then=="function"&&ee.then(q,Ae)}catch(xe){Ae(xe)}finally{L!==null&&Q.types!==null&&(L.types=Q.types),G.T=L}},gi.unstable_useCacheRefresh=function(){return G.H.useCacheRefresh()},gi.use=function(E){return G.H.use(E)},gi.useActionState=function(E,L,Q){return G.H.useActionState(E,L,Q)},gi.useCallback=function(E,L){return G.H.useCallback(E,L)},gi.useContext=function(E){return G.H.useContext(E)},gi.useDebugValue=function(){},gi.useDeferredValue=function(E,L){return G.H.useDeferredValue(E,L)},gi.useEffect=function(E,L){return G.H.useEffect(E,L)},gi.useEffectEvent=function(E){return G.H.useEffectEvent(E)},gi.useId=function(){return G.H.useId()},gi.useImperativeHandle=function(E,L,Q){return G.H.useImperativeHandle(E,L,Q)},gi.useInsertionEffect=function(E,L){return G.H.useInsertionEffect(E,L)},gi.useLayoutEffect=function(E,L){return G.H.useLayoutEffect(E,L)},gi.useMemo=function(E,L){return G.H.useMemo(E,L)},gi.useOptimistic=function(E,L){return G.H.useOptimistic(E,L)},gi.useReducer=function(E,L,Q){return G.H.useReducer(E,L,Q)},gi.useRef=function(E){return G.H.useRef(E)},gi.useState=function(E){return G.H.useState(E)},gi.useSyncExternalStore=function(E,L,Q){return G.H.useSyncExternalStore(E,L,Q)},gi.useTransition=function(){return G.H.useTransition()},gi.version="19.2.0",gi}var K1;function my(){return K1||(K1=1,Z0.exports=Iw()),Z0.exports}var U=my();const Dt=Dw(U);var J0={exports:{}},Zf={},Q0={exports:{}},em={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z1;function zw(){return Z1||(Z1=1,(function(s){function e(ie,le){var se=ie.length;ie.push(le);e:for(;0<se;){var Ae=se-1>>>1,ue=ie[Ae];if(0<r(ue,le))ie[Ae]=le,ie[se]=ue,se=Ae;else break e}}function t(ie){return ie.length===0?null:ie[0]}function n(ie){if(ie.length===0)return null;var le=ie[0],se=ie.pop();if(se!==le){ie[0]=se;e:for(var Ae=0,ue=ie.length,E=ue>>>1;Ae<E;){var L=2*(Ae+1)-1,Q=ie[L],ee=L+1,oe=ie[ee];if(0>r(Q,se))ee<ue&&0>r(oe,Q)?(ie[Ae]=oe,ie[ee]=se,Ae=ee):(ie[Ae]=Q,ie[L]=se,Ae=L);else if(ee<ue&&0>r(oe,se))ie[Ae]=oe,ie[ee]=se,Ae=ee;else break e}}return le}function r(ie,le){var se=ie.sortIndex-le.sortIndex;return se!==0?se:ie.id-le.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;s.unstable_now=function(){return o.now()}}else{var d=Date,c=d.now();s.unstable_now=function(){return d.now()-c}}var h=[],f=[],m=1,y=null,A=3,v=!1,N=!1,T=!1,_=!1,b=typeof setTimeout=="function"?setTimeout:null,H=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function M(ie){for(var le=t(f);le!==null;){if(le.callback===null)n(f);else if(le.startTime<=ie)n(f),le.sortIndex=le.expirationTime,e(h,le);else break;le=t(f)}}function B(ie){if(T=!1,M(ie),!N)if(t(h)!==null)N=!0,q||(q=!0,I());else{var le=t(f);le!==null&&Ce(B,le.startTime-ie)}}var q=!1,G=-1,X=5,O=-1;function Y(){return _?!0:!(s.unstable_now()-O<X)}function W(){if(_=!1,q){var ie=s.unstable_now();O=ie;var le=!0;try{e:{N=!1,T&&(T=!1,H(G),G=-1),v=!0;var se=A;try{t:{for(M(ie),y=t(h);y!==null&&!(y.expirationTime>ie&&Y());){var Ae=y.callback;if(typeof Ae=="function"){y.callback=null,A=y.priorityLevel;var ue=Ae(y.expirationTime<=ie);if(ie=s.unstable_now(),typeof ue=="function"){y.callback=ue,M(ie),le=!0;break t}y===t(h)&&n(h),M(ie)}else n(h);y=t(h)}if(y!==null)le=!0;else{var E=t(f);E!==null&&Ce(B,E.startTime-ie),le=!1}}break e}finally{y=null,A=se,v=!1}le=void 0}}finally{le?I():q=!1}}}var I;if(typeof R=="function")I=function(){R(W)};else if(typeof MessageChannel<"u"){var J=new MessageChannel,Z=J.port2;J.port1.onmessage=W,I=function(){Z.postMessage(null)}}else I=function(){b(W,0)};function Ce(ie,le){G=b(function(){ie(s.unstable_now())},le)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(ie){ie.callback=null},s.unstable_forceFrameRate=function(ie){0>ie||125<ie?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):X=0<ie?Math.floor(1e3/ie):5},s.unstable_getCurrentPriorityLevel=function(){return A},s.unstable_next=function(ie){switch(A){case 1:case 2:case 3:var le=3;break;default:le=A}var se=A;A=le;try{return ie()}finally{A=se}},s.unstable_requestPaint=function(){_=!0},s.unstable_runWithPriority=function(ie,le){switch(ie){case 1:case 2:case 3:case 4:case 5:break;default:ie=3}var se=A;A=ie;try{return le()}finally{A=se}},s.unstable_scheduleCallback=function(ie,le,se){var Ae=s.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?Ae+se:Ae):se=Ae,ie){case 1:var ue=-1;break;case 2:ue=250;break;case 5:ue=1073741823;break;case 4:ue=1e4;break;default:ue=5e3}return ue=se+ue,ie={id:m++,callback:le,priorityLevel:ie,startTime:se,expirationTime:ue,sortIndex:-1},se>Ae?(ie.sortIndex=se,e(f,ie),t(h)===null&&ie===t(f)&&(T?(H(G),G=-1):T=!0,Ce(B,se-Ae))):(ie.sortIndex=ue,e(h,ie),N||v||(N=!0,q||(q=!0,I()))),ie},s.unstable_shouldYield=Y,s.unstable_wrapCallback=function(ie){var le=A;return function(){var se=A;A=le;try{return ie.apply(this,arguments)}finally{A=se}}}})(em)),em}var J1;function Bw(){return J1||(J1=1,Q0.exports=zw()),Q0.exports}var tm={exports:{}},Yo={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q1;function Fw(){if(Q1)return Yo;Q1=1;var s=my();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)f+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function o(h,f,m){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:y==null?null:""+y,children:h,containerInfo:f,implementation:m}}var d=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Yo.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Yo.createPortal=function(h,f){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return o(h,f,null,m)},Yo.flushSync=function(h){var f=d.T,m=n.p;try{if(d.T=null,n.p=2,h)return h()}finally{d.T=f,n.p=m,n.d.f()}},Yo.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,n.d.C(h,f))},Yo.prefetchDNS=function(h){typeof h=="string"&&n.d.D(h)},Yo.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var m=f.as,y=c(m,f.crossOrigin),A=typeof f.integrity=="string"?f.integrity:void 0,v=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;m==="style"?n.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:y,integrity:A,fetchPriority:v}):m==="script"&&n.d.X(h,{crossOrigin:y,integrity:A,fetchPriority:v,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Yo.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var m=c(f.as,f.crossOrigin);n.d.M(h,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&n.d.M(h)},Yo.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var m=f.as,y=c(m,f.crossOrigin);n.d.L(h,m,{crossOrigin:y,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Yo.preloadModule=function(h,f){if(typeof h=="string")if(f){var m=c(f.as,f.crossOrigin);n.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else n.d.m(h)},Yo.requestFormReset=function(h){n.d.r(h)},Yo.unstable_batchedUpdates=function(h,f){return h(f)},Yo.useFormState=function(h,f,m){return d.H.useFormState(h,f,m)},Yo.useFormStatus=function(){return d.H.useHostTransitionStatus()},Yo.version="19.2.0",Yo}var ex;function Ow(){if(ex)return tm.exports;ex=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),tm.exports=Fw(),tm.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tx;function Uw(){if(tx)return Zf;tx=1;var s=Bw(),e=my(),t=Ow();function n(i){var a="https://react.dev/errors/"+i;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)a+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function o(i){var a=i,u=i;if(i.alternate)for(;a.return;)a=a.return;else{i=a;do a=i,(a.flags&4098)!==0&&(u=a.return),i=a.return;while(i)}return a.tag===3?u:null}function d(i){if(i.tag===13){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function c(i){if(i.tag===31){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function h(i){if(o(i)!==i)throw Error(n(188))}function f(i){var a=i.alternate;if(!a){if(a=o(i),a===null)throw Error(n(188));return a!==i?null:i}for(var u=i,g=a;;){var w=u.return;if(w===null)break;var k=w.alternate;if(k===null){if(g=w.return,g!==null){u=g;continue}break}if(w.child===k.child){for(k=w.child;k;){if(k===u)return h(w),i;if(k===g)return h(w),a;k=k.sibling}throw Error(n(188))}if(u.return!==g.return)u=w,g=k;else{for(var V=!1,he=w.child;he;){if(he===u){V=!0,u=w,g=k;break}if(he===g){V=!0,g=w,u=k;break}he=he.sibling}if(!V){for(he=k.child;he;){if(he===u){V=!0,u=k,g=w;break}if(he===g){V=!0,g=k,u=w;break}he=he.sibling}if(!V)throw Error(n(189))}}if(u.alternate!==g)throw Error(n(190))}if(u.tag!==3)throw Error(n(188));return u.stateNode.current===u?i:a}function m(i){var a=i.tag;if(a===5||a===26||a===27||a===6)return i;for(i=i.child;i!==null;){if(a=m(i),a!==null)return a;i=i.sibling}return null}var y=Object.assign,A=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),N=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),H=Symbol.for("react.consumer"),R=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),q=Symbol.for("react.suspense_list"),G=Symbol.for("react.memo"),X=Symbol.for("react.lazy"),O=Symbol.for("react.activity"),Y=Symbol.for("react.memo_cache_sentinel"),W=Symbol.iterator;function I(i){return i===null||typeof i!="object"?null:(i=W&&i[W]||i["@@iterator"],typeof i=="function"?i:null)}var J=Symbol.for("react.client.reference");function Z(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===J?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case T:return"Fragment";case b:return"Profiler";case _:return"StrictMode";case B:return"Suspense";case q:return"SuspenseList";case O:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case N:return"Portal";case R:return i.displayName||"Context";case H:return(i._context.displayName||"Context")+".Consumer";case M:var a=i.render;return i=i.displayName,i||(i=a.displayName||a.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case G:return a=i.displayName||null,a!==null?a:Z(i.type)||"Memo";case X:a=i._payload,i=i._init;try{return Z(i(a))}catch{}}return null}var Ce=Array.isArray,ie=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,le=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se={pending:!1,data:null,method:null,action:null},Ae=[],ue=-1;function E(i){return{current:i}}function L(i){0>ue||(i.current=Ae[ue],Ae[ue]=null,ue--)}function Q(i,a){ue++,Ae[ue]=i.current,i.current=a}var ee=E(null),oe=E(null),xe=E(null),re=E(null);function Le(i,a){switch(Q(xe,a),Q(oe,i),Q(ee,null),a.nodeType){case 9:case 11:i=(i=a.documentElement)&&(i=i.namespaceURI)?p1(i):0;break;default:if(i=a.tagName,a=a.namespaceURI)a=p1(a),i=g1(a,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}L(ee),Q(ee,i)}function Ee(){L(ee),L(oe),L(xe)}function Oe(i){i.memoizedState!==null&&Q(re,i);var a=ee.current,u=g1(a,i.type);a!==u&&(Q(oe,i),Q(ee,u))}function Ze(i){oe.current===i&&(L(ee),L(oe)),re.current===i&&(L(re),$f._currentValue=se)}var st,mt;function Mt(i){if(st===void 0)try{throw Error()}catch(u){var a=u.stack.trim().match(/\n( *(at )?)/);st=a&&a[1]||"",mt=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+st+i+mt}var K=!1;function jt(i,a){if(!i||K)return"";K=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(a){var Pt=function(){throw Error()};if(Object.defineProperty(Pt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Pt,[])}catch(ft){var rt=ft}Reflect.construct(i,[],Pt)}else{try{Pt.call()}catch(ft){rt=ft}i.call(Pt.prototype)}}else{try{throw Error()}catch(ft){rt=ft}(Pt=i())&&typeof Pt.catch=="function"&&Pt.catch(function(){})}}catch(ft){if(ft&&rt&&typeof ft.stack=="string")return[ft.stack,rt.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var w=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");w&&w.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var k=g.DetermineComponentFrameRoot(),V=k[0],he=k[1];if(V&&he){var Be=V.split(`
`),nt=he.split(`
`);for(w=g=0;g<Be.length&&!Be[g].includes("DetermineComponentFrameRoot");)g++;for(;w<nt.length&&!nt[w].includes("DetermineComponentFrameRoot");)w++;if(g===Be.length||w===nt.length)for(g=Be.length-1,w=nt.length-1;1<=g&&0<=w&&Be[g]!==nt[w];)w--;for(;1<=g&&0<=w;g--,w--)if(Be[g]!==nt[w]){if(g!==1||w!==1)do if(g--,w--,0>w||Be[g]!==nt[w]){var vt=`
`+Be[g].replace(" at new "," at ");return i.displayName&&vt.includes("<anonymous>")&&(vt=vt.replace("<anonymous>",i.displayName)),vt}while(1<=g&&0<=w);break}}}finally{K=!1,Error.prepareStackTrace=u}return(u=i?i.displayName||i.name:"")?Mt(u):""}function $t(i,a){switch(i.tag){case 26:case 27:case 5:return Mt(i.type);case 16:return Mt("Lazy");case 13:return i.child!==a&&a!==null?Mt("Suspense Fallback"):Mt("Suspense");case 19:return Mt("SuspenseList");case 0:case 15:return jt(i.type,!1);case 11:return jt(i.type.render,!1);case 1:return jt(i.type,!0);case 31:return Mt("Activity");default:return""}}function Yt(i){try{var a="",u=null;do a+=$t(i,u),u=i,i=i.return;while(i);return a}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}var yt=Object.prototype.hasOwnProperty,on=s.unstable_scheduleCallback,ze=s.unstable_cancelCallback,Ne=s.unstable_shouldYield,Ct=s.unstable_requestPaint,wt=s.unstable_now,it=s.unstable_getCurrentPriorityLevel,pt=s.unstable_ImmediatePriority,Ot=s.unstable_UserBlockingPriority,Qe=s.unstable_NormalPriority,St=s.unstable_LowPriority,Wt=s.unstable_IdlePriority,Bt=s.log,Ln=s.unstable_setDisableYieldValue,Kt=null,rn=null;function un(i){if(typeof Bt=="function"&&Ln(i),rn&&typeof rn.setStrictMode=="function")try{rn.setStrictMode(Kt,i)}catch{}}var ot=Math.clz32?Math.clz32:Ft,Zt=Math.log,sn=Math.LN2;function Ft(i){return i>>>=0,i===0?32:31-(Zt(i)/sn|0)|0}var Jt=256,yn=262144,_n=4194304;function Qt(i){var a=i&42;if(a!==0)return a;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function Ut(i,a,u){var g=i.pendingLanes;if(g===0)return 0;var w=0,k=i.suspendedLanes,V=i.pingedLanes;i=i.warmLanes;var he=g&134217727;return he!==0?(g=he&~k,g!==0?w=Qt(g):(V&=he,V!==0?w=Qt(V):u||(u=he&~i,u!==0&&(w=Qt(u))))):(he=g&~k,he!==0?w=Qt(he):V!==0?w=Qt(V):u||(u=g&~i,u!==0&&(w=Qt(u)))),w===0?0:a!==0&&a!==w&&(a&k)===0&&(k=w&-w,u=a&-a,k>=u||k===32&&(u&4194048)!==0)?a:w}function zi(i,a){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&a)===0}function Jn(i,a){switch(i){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Lt(){var i=_n;return _n<<=1,(_n&62914560)===0&&(_n=4194304),i}function Ht(i){for(var a=[],u=0;31>u;u++)a.push(i);return a}function Et(i,a){i.pendingLanes|=a,a!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function ti(i,a,u,g,w,k){var V=i.pendingLanes;i.pendingLanes=u,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=u,i.entangledLanes&=u,i.errorRecoveryDisabledLanes&=u,i.shellSuspendCounter=0;var he=i.entanglements,Be=i.expirationTimes,nt=i.hiddenUpdates;for(u=V&~u;0<u;){var vt=31-ot(u),Pt=1<<vt;he[vt]=0,Be[vt]=-1;var rt=nt[vt];if(rt!==null)for(nt[vt]=null,vt=0;vt<rt.length;vt++){var ft=rt[vt];ft!==null&&(ft.lane&=-536870913)}u&=~Pt}g!==0&&vi(i,g,0),k!==0&&w===0&&i.tag!==0&&(i.suspendedLanes|=k&~(V&~a))}function vi(i,a,u){i.pendingLanes|=a,i.suspendedLanes&=~a;var g=31-ot(a);i.entangledLanes|=a,i.entanglements[g]=i.entanglements[g]|1073741824|u&261930}function ar(i,a){var u=i.entangledLanes|=a;for(i=i.entanglements;u;){var g=31-ot(u),w=1<<g;w&a|i[g]&a&&(i[g]|=a),u&=~w}}function _t(i,a){var u=a&-a;return u=(u&42)!==0?1:Fn(u),(u&(i.suspendedLanes|a))!==0?0:u}function Fn(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function Xn(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function ci(){var i=le.p;return i!==0?i:(i=window.event,i===void 0?32:B1(i.type))}function ri(i,a){var u=le.p;try{return le.p=i,a()}finally{le.p=u}}var Br=Math.random().toString(36).slice(2),Di="__reactFiber$"+Br,Ni="__reactProps$"+Br,Ns="__reactContainer$"+Br,ha="__reactEvents$"+Br,Na="__reactListeners$"+Br,$l="__reactHandles$"+Br,Wa="__reactResources$"+Br,$a="__reactMarker$"+Br;function No(i){delete i[Di],delete i[Ni],delete i[ha],delete i[Na],delete i[$l]}function Qn(i){var a=i[Di];if(a)return a;for(var u=i.parentNode;u;){if(a=u[Ns]||u[Di]){if(u=a.alternate,a.child!==null||u!==null&&u.child!==null)for(i=S1(i);i!==null;){if(u=i[Di])return u;i=S1(i)}return a}i=u,u=i.parentNode}return null}function Us(i){if(i=i[Di]||i[Ns]){var a=i.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return i}return null}function Ti(i){var a=i.tag;if(a===5||a===26||a===27||a===6)return i.stateNode;throw Error(n(33))}function Pa(i){var a=i[Wa];return a||(a=i[Wa]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function On(i){i[$a]=!0}var Qo=new Set,wi={};function fa(i,a){Ea(i,a),Ea(i+"Capture",a)}function Ea(i,a){for(wi[i]=a,i=0;i<a.length;i++)Qo.add(a[i])}var el=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),tl={},Ga={};function ud(i){return yt.call(Ga,i)?!0:yt.call(tl,i)?!1:el.test(i)?Ga[i]=!0:(tl[i]=!0,!1)}function dr(i,a,u){if(ud(a))if(u===null)i.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":i.removeAttribute(a);return;case"boolean":var g=a.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){i.removeAttribute(a);return}}i.setAttribute(a,""+u)}}function nl(i,a,u){if(u===null)i.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(a);return}i.setAttribute(a,""+u)}}function $n(i,a,u,g){if(g===null)i.removeAttribute(u);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(u);return}i.setAttributeNS(a,u,""+g)}}function Wn(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function il(i){var a=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function co(i,a,u){var g=Object.getOwnPropertyDescriptor(i.constructor.prototype,a);if(!i.hasOwnProperty(a)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var w=g.get,k=g.set;return Object.defineProperty(i,a,{configurable:!0,get:function(){return w.call(this)},set:function(V){u=""+V,k.call(this,V)}}),Object.defineProperty(i,a,{enumerable:g.enumerable}),{getValue:function(){return u},setValue:function(V){u=""+V},stopTracking:function(){i._valueTracker=null,delete i[a]}}}}function Ra(i){if(!i._valueTracker){var a=il(i)?"checked":"value";i._valueTracker=co(i,a,""+i[a])}}function ea(i){if(!i)return!1;var a=i._valueTracker;if(!a)return!0;var u=a.getValue(),g="";return i&&(g=il(i)?i.checked?"true":"false":i.value),i=g,i!==u?(a.setValue(i),!0):!1}function ki(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var Ki=/[\n"\\]/g;function Si(i){return i.replace(Ki,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Fr(i,a,u,g,w,k,V,he){i.name="",V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"?i.type=V:i.removeAttribute("type"),a!=null?V==="number"?(a===0&&i.value===""||i.value!=a)&&(i.value=""+Wn(a)):i.value!==""+Wn(a)&&(i.value=""+Wn(a)):V!=="submit"&&V!=="reset"||i.removeAttribute("value"),a!=null?ta(i,V,Wn(a)):u!=null?ta(i,V,Wn(u)):g!=null&&i.removeAttribute("value"),w==null&&k!=null&&(i.defaultChecked=!!k),w!=null&&(i.checked=w&&typeof w!="function"&&typeof w!="symbol"),he!=null&&typeof he!="function"&&typeof he!="symbol"&&typeof he!="boolean"?i.name=""+Wn(he):i.removeAttribute("name")}function $c(i,a,u,g,w,k,V,he){if(k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(i.type=k),a!=null||u!=null){if(!(k!=="submit"&&k!=="reset"||a!=null)){Ra(i);return}u=u!=null?""+Wn(u):"",a=a!=null?""+Wn(a):u,he||a===i.value||(i.value=a),i.defaultValue=a}g=g??w,g=typeof g!="function"&&typeof g!="symbol"&&!!g,i.checked=he?i.checked:!!g,i.defaultChecked=!!g,V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"&&(i.name=V),Ra(i)}function ta(i,a,u){a==="number"&&ki(i.ownerDocument)===i||i.defaultValue===""+u||(i.defaultValue=""+u)}function Hs(i,a,u,g){if(i=i.options,a){a={};for(var w=0;w<u.length;w++)a["$"+u[w]]=!0;for(u=0;u<i.length;u++)w=a.hasOwnProperty("$"+i[u].value),i[u].selected!==w&&(i[u].selected=w),w&&g&&(i[u].defaultSelected=!0)}else{for(u=""+Wn(u),a=null,w=0;w<i.length;w++){if(i[w].value===u){i[w].selected=!0,g&&(i[w].defaultSelected=!0);return}a!==null||i[w].disabled||(a=i[w])}a!==null&&(a.selected=!0)}}function Gl(i,a,u){if(a!=null&&(a=""+Wn(a),a!==i.value&&(i.value=a),u==null)){i.defaultValue!==a&&(i.defaultValue=a);return}i.defaultValue=u!=null?""+Wn(u):""}function pa(i,a,u,g){if(a==null){if(g!=null){if(u!=null)throw Error(n(92));if(Ce(g)){if(1<g.length)throw Error(n(93));g=g[0]}u=g}u==null&&(u=""),a=u}u=Wn(a),i.defaultValue=u,g=i.textContent,g===u&&g!==""&&g!==null&&(i.value=g),Ra(i)}function vs(i,a){if(a){var u=i.firstChild;if(u&&u===i.lastChild&&u.nodeType===3){u.nodeValue=a;return}}i.textContent=a}var na=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ya(i,a,u){var g=a.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?g?i.setProperty(a,""):a==="float"?i.cssFloat="":i[a]="":g?i.setProperty(a,u):typeof u!="number"||u===0||na.has(a)?a==="float"?i.cssFloat=u:i[a]=(""+u).trim():i[a]=u+"px"}function zt(i,a,u){if(a!=null&&typeof a!="object")throw Error(n(62));if(i=i.style,u!=null){for(var g in u)!u.hasOwnProperty(g)||a!=null&&a.hasOwnProperty(g)||(g.indexOf("--")===0?i.setProperty(g,""):g==="float"?i.cssFloat="":i[g]="");for(var w in a)g=a[w],a.hasOwnProperty(w)&&u[w]!==g&&Ya(i,w,g)}else for(var k in a)a.hasOwnProperty(k)&&Ya(i,k,a[k])}function $i(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var uo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Tl=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Kr(i){return Tl.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function ho(){}var ur=null;function or(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Po=null,qn=null;function li(i){var a=Us(i);if(a&&(i=a.stateNode)){var u=i[Ni]||null;e:switch(i=a.stateNode,a.type){case"input":if(Fr(i,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),a=u.name,u.type==="radio"&&a!=null){for(u=i;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+Si(""+a)+'"][type="radio"]'),a=0;a<u.length;a++){var g=u[a];if(g!==i&&g.form===i.form){var w=g[Ni]||null;if(!w)throw Error(n(90));Fr(g,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name)}}for(a=0;a<u.length;a++)g=u[a],g.form===i.form&&ea(g)}break e;case"textarea":Gl(i,u.value,u.defaultValue);break e;case"select":a=u.value,a!=null&&Hs(i,!!u.multiple,a,!1)}}}var Pn=!1;function Gc(i,a,u){if(Pn)return i(a,u);Pn=!0;try{var g=i(a);return g}finally{if(Pn=!1,(Po!==null||qn!==null)&&(eg(),Po&&(a=Po,i=qn,qn=Po=null,li(a),i)))for(a=0;a<i.length;a++)li(i[a])}}function ga(i,a){var u=i.stateNode;if(u===null)return null;var g=u[Ni]||null;if(g===null)return null;u=g[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(i=i.type,g=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!g;break e;default:i=!1}if(i)return null;if(u&&typeof u!="function")throw Error(n(231,a,typeof u));return u}var gn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),jn=!1;if(gn)try{var ui={};Object.defineProperty(ui,"passive",{get:function(){jn=!0}}),window.addEventListener("test",ui,ui),window.removeEventListener("test",ui,ui)}catch{jn=!1}var pn=null,hi=null,xn=null;function du(){if(xn)return xn;var i,a=hi,u=a.length,g,w="value"in pn?pn.value:pn.textContent,k=w.length;for(i=0;i<u&&a[i]===w[i];i++);var V=u-i;for(g=1;g<=V&&a[u-g]===w[k-g];g++);return xn=w.slice(i,1<g?1-g:void 0)}function Gt(i){var a=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&a===13&&(i=13)):i=a,i===10&&(i=13),32<=i||i===13?i:0}function Bi(){return!0}function an(){return!1}function Kn(i){function a(u,g,w,k,V){this._reactName=u,this._targetInst=w,this.type=g,this.nativeEvent=k,this.target=V,this.currentTarget=null;for(var he in i)i.hasOwnProperty(he)&&(u=i[he],this[he]=u?u(k):k[he]);return this.isDefaultPrevented=(k.defaultPrevented!=null?k.defaultPrevented:k.returnValue===!1)?Bi:an,this.isPropagationStopped=an,this}return y(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Bi)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Bi)},persist:function(){},isPersistent:Bi}),a}var Vs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xa=Kn(Vs),as=y({},Vs,{view:0,detail:0}),rl=Kn(as),Da,Ka,sl,Ac=y({},as,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sn,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==sl&&(sl&&i.type==="mousemove"?(Da=i.screenX-sl.screenX,Ka=i.screenY-sl.screenY):Ka=Da=0,sl=i),Da)},movementY:function(i){return"movementY"in i?i.movementY:Ka}}),Yl=Kn(Ac),kl=y({},Ac,{dataTransfer:0}),Eo=Kn(kl),uu=y({},as,{relatedTarget:0}),wn=Kn(uu),Ro=y({},Vs,{animationName:0,elapsedTime:0,pseudoElement:0}),j=Kn(Ro),te=y({},Vs,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Se=Kn(te),Ie=y({},Vs,{data:0}),Ve=Kn(Ie),lt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},At={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ln={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tn(i){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(i):(i=ln[i])?!!a[i]:!1}function Sn(){return Tn}var si=y({},as,{key:function(i){if(i.key){var a=lt[i.key]||i.key;if(a!=="Unidentified")return a}return i.type==="keypress"?(i=Gt(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?At[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sn,charCode:function(i){return i.type==="keypress"?Gt(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Gt(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),_i=Kn(si),Zr=y({},Ac,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fi=Kn(Zr),Qi=y({},as,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sn}),Ui=Kn(Qi),Lr=y({},Vs,{propertyName:0,elapsedTime:0,pseudoElement:0}),hr=Kn(Lr),fo=y({},Ac,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Ps=Kn(fo),al=y({},Vs,{newState:0,oldState:0}),ws=Kn(al),ol=[9,13,27,32],Or=gn&&"CompositionEvent"in window,ma=null;gn&&"documentMode"in document&&(ma=document.documentMode);var Ss=gn&&"TextEvent"in window&&!ma,Za=gn&&(!Or||ma&&8<ma&&11>=ma),fi=" ",po=!1;function Cc(i,a){switch(i){case"keyup":return ol.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hd(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Ja=!1;function qs(i,a){switch(i){case"compositionend":return hd(a);case"keypress":return a.which!==32?null:(po=!0,fi);case"textInput":return i=a.data,i===fi&&po?null:i;default:return null}}function Do(i,a){if(Ja)return i==="compositionend"||!Or&&Cc(i,a)?(i=du(),xn=hi=pn=null,Ja=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Za&&a.locale!=="ko"?null:a.data;default:return null}}var Tc={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Lo(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a==="input"?!!Tc[i.type]:a==="textarea"}function ya(i,a,u,g){Po?qn?qn.push(g):qn=[g]:Po=g,a=og(a,"onChange"),0<a.length&&(u=new Xa("onChange","change",null,u,g),i.push({event:u,listeners:a}))}var hs=null,Qa=null;function ll(i){l1(i,0)}function go(i){var a=Ti(i);if(ea(a))return i}function mo(i,a){if(i==="change")return a}var xa=!1;if(gn){var fs;if(gn){var Mo="oninput"in document;if(!Mo){var La=document.createElement("div");La.setAttribute("oninput","return;"),Mo=typeof La.oninput=="function"}fs=Mo}else fs=!1;xa=fs&&(!document.documentMode||9<document.documentMode)}function Li(){hs&&(hs.detachEvent("onpropertychange",Io),Qa=hs=null)}function Io(i){if(i.propertyName==="value"&&go(Qa)){var a=[];ya(a,Qa,i,or(i)),Gc(ll,a)}}function fr(i,a,u){i==="focusin"?(Li(),hs=a,Qa=u,hs.attachEvent("onpropertychange",Io)):i==="focusout"&&Li()}function jr(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return go(Qa)}function fd(i,a){if(i==="click")return go(a)}function Ma(i,a){if(i==="input"||i==="change")return go(a)}function _l(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var Es=typeof Object.is=="function"?Object.is:_l;function Xl(i,a){if(Es(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;var u=Object.keys(i),g=Object.keys(a);if(u.length!==g.length)return!1;for(g=0;g<u.length;g++){var w=u[g];if(!yt.call(a,w)||!Es(i[w],a[w]))return!1}return!0}function pd(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function eo(i,a){var u=pd(i);i=0;for(var g;u;){if(u.nodeType===3){if(g=i+u.textContent.length,i<=a&&g>=a)return{node:u,offset:a-i};i=g}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=pd(u)}}function cl(i,a){return i&&a?i===a?!0:i&&i.nodeType===3?!1:a&&a.nodeType===3?cl(i,a.parentNode):"contains"in i?i.contains(a):i.compareDocumentPosition?!!(i.compareDocumentPosition(a)&16):!1:!1}function zo(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var a=ki(i.document);a instanceof i.HTMLIFrameElement;){try{var u=typeof a.contentWindow.location.href=="string"}catch{u=!1}if(u)i=a.contentWindow;else break;a=ki(i.document)}return a}function ba(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a&&(a==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||a==="textarea"||i.contentEditable==="true")}var Ws=gn&&"documentMode"in document&&11>=document.documentMode,Ia=null,Bo=null,va=null,yo=!1;function er(i,a,u){var g=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;yo||Ia==null||Ia!==ki(g)||(g=Ia,"selectionStart"in g&&ba(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),va&&Xl(va,g)||(va=g,g=og(Bo,"onSelect"),0<g.length&&(a=new Xa("onSelect","select",null,a,u),i.push({event:a,listeners:g}),a.target=Ia)))}function Hi(i,a){var u={};return u[i.toLowerCase()]=a.toLowerCase(),u["Webkit"+i]="webkit"+a,u["Moz"+i]="moz"+a,u}var Nr={animationend:Hi("Animation","AnimationEnd"),animationiteration:Hi("Animation","AnimationIteration"),animationstart:Hi("Animation","AnimationStart"),transitionrun:Hi("Transition","TransitionRun"),transitionstart:Hi("Transition","TransitionStart"),transitioncancel:Hi("Transition","TransitionCancel"),transitionend:Hi("Transition","TransitionEnd")},ps={},jl={};gn&&(jl=document.createElement("div").style,"AnimationEvent"in window||(delete Nr.animationend.animation,delete Nr.animationiteration.animation,delete Nr.animationstart.animation),"TransitionEvent"in window||delete Nr.transitionend.transition);function dl(i){if(ps[i])return ps[i];if(!Nr[i])return i;var a=Nr[i],u;for(u in a)if(a.hasOwnProperty(u)&&u in jl)return ps[i]=a[u];return i}var gs=dl("animationend"),wa=dl("animationiteration"),Nl=dl("animationstart"),ul=dl("transitionrun"),Pl=dl("transitionstart"),Kl=dl("transitioncancel"),El=dl("transitionend"),to=new Map,Rl="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Rl.push("scrollEnd");function br(i,a){to.set(i,a),fa(a,[i])}var Pi=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},Jr=[],Qr=0,za=0;function Bd(){for(var i=Qr,a=za=Qr=0;a<i;){var u=Jr[a];Jr[a++]=null;var g=Jr[a];Jr[a++]=null;var w=Jr[a];Jr[a++]=null;var k=Jr[a];if(Jr[a++]=null,g!==null&&w!==null){var V=g.pending;V===null?w.next=w:(w.next=V.next,V.next=w),g.pending=w}k!==0&&Zi(u,w,k)}}function hl(i,a,u,g){Jr[Qr++]=i,Jr[Qr++]=a,Jr[Qr++]=u,Jr[Qr++]=g,za|=g,i.lanes|=g,i=i.alternate,i!==null&&(i.lanes|=g)}function Fd(i,a,u,g){return hl(i,a,u,g),pr(i)}function Fo(i,a){return hl(i,null,null,a),pr(i)}function Zi(i,a,u){i.lanes|=u;var g=i.alternate;g!==null&&(g.lanes|=u);for(var w=!1,k=i.return;k!==null;)k.childLanes|=u,g=k.alternate,g!==null&&(g.childLanes|=u),k.tag===22&&(i=k.stateNode,i===null||i._visibility&1||(w=!0)),i=k,k=k.return;return i.tag===3?(k=i.stateNode,w&&a!==null&&(w=31-ot(u),i=k.hiddenUpdates,g=i[w],g===null?i[w]=[a]:g.push(a),a.lane=u|536870912),k):null}function pr(i){if(50<us)throw us=0,ei=null,Error(n(185));for(var a=i.return;a!==null;)i=a,a=i.return;return i.tag===3?i.stateNode:null}var Rs={};function Od(i,a,u,g){this.tag=i,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ia(i,a,u,g){return new Od(i,a,u,g)}function gd(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Ba(i,a){var u=i.alternate;return u===null?(u=ia(i.tag,a,i.key,i.mode),u.elementType=i.elementType,u.type=i.type,u.stateNode=i.stateNode,u.alternate=i,i.alternate=u):(u.pendingProps=a,u.type=i.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=i.flags&65011712,u.childLanes=i.childLanes,u.lanes=i.lanes,u.child=i.child,u.memoizedProps=i.memoizedProps,u.memoizedState=i.memoizedState,u.updateQueue=i.updateQueue,a=i.dependencies,u.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},u.sibling=i.sibling,u.index=i.index,u.ref=i.ref,u.refCleanup=i.refCleanup,u}function Yc(i,a){i.flags&=65011714;var u=i.alternate;return u===null?(i.childLanes=0,i.lanes=a,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=u.childLanes,i.lanes=u.lanes,i.child=u.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=u.memoizedProps,i.memoizedState=u.memoizedState,i.updateQueue=u.updateQueue,i.type=u.type,a=u.dependencies,i.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),i}function Dl(i,a,u,g,w,k){var V=0;if(g=i,typeof i=="function")gd(i)&&(V=1);else if(typeof i=="string")V=ww(i,u,ee.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case O:return i=ia(31,u,a,w),i.elementType=O,i.lanes=k,i;case T:return Zl(u.children,w,k,a);case _:V=8,w|=24;break;case b:return i=ia(12,u,a,w|2),i.elementType=b,i.lanes=k,i;case B:return i=ia(13,u,a,w),i.elementType=B,i.lanes=k,i;case q:return i=ia(19,u,a,w),i.elementType=q,i.lanes=k,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case R:V=10;break e;case H:V=9;break e;case M:V=11;break e;case G:V=14;break e;case X:V=16,g=null;break e}V=29,u=Error(n(130,i===null?"null":typeof i,"")),g=null}return a=ia(V,u,a,w),a.elementType=i,a.type=g,a.lanes=k,a}function Zl(i,a,u,g){return i=ia(7,i,g,a),i.lanes=u,i}function fl(i,a,u){return i=ia(6,i,null,a),i.lanes=u,i}function kc(i){var a=ia(18,null,null,0);return a.stateNode=i,a}function Oo(i,a,u){return a=ia(4,i.children!==null?i.children:[],i.key,a),a.lanes=u,a.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},a}var Jl=new WeakMap;function Fa(i,a){if(typeof i=="object"&&i!==null){var u=Jl.get(i);return u!==void 0?u:(a={value:i,source:a,stack:Yt(a)},Jl.set(i,a),a)}return{value:i,source:a,stack:Yt(a)}}var Ql=[],xo=0,Ll=null,md=0,ms=[],bo=0,os=null,Oa=1,vo="";function Ds(i,a){Ql[xo++]=md,Ql[xo++]=Ll,Ll=i,md=a}function _c(i,a,u){ms[bo++]=Oa,ms[bo++]=vo,ms[bo++]=os,os=i;var g=Oa;i=vo;var w=32-ot(g)-1;g&=~(1<<w),u+=1;var k=32-ot(a)+w;if(30<k){var V=w-w%5;k=(g&(1<<V)-1).toString(32),g>>=V,w-=V,Oa=1<<32-ot(a)+w|u<<w|g,vo=k+i}else Oa=1<<k|u<<w|g,vo=i}function yd(i){i.return!==null&&(Ds(i,1),_c(i,1,0))}function ec(i){for(;i===Ll;)Ll=Ql[--xo],Ql[xo]=null,md=Ql[--xo],Ql[xo]=null;for(;i===os;)os=ms[--bo],ms[bo]=null,vo=ms[--bo],ms[bo]=null,Oa=ms[--bo],ms[bo]=null}function Ml(i,a){ms[bo++]=Oa,ms[bo++]=vo,ms[bo++]=os,Oa=a.id,vo=a.overflow,os=i}var ra=null,Pr=null,Mi=!1,Ua=null,ls=!1,wo=Error(n(519));function tc(i){var a=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw As(Fa(a,i)),wo}function hu(i){var a=i.stateNode,u=i.type,g=i.memoizedProps;switch(a[Di]=i,a[Ni]=g,u){case"dialog":Xi("cancel",a),Xi("close",a);break;case"iframe":case"object":case"embed":Xi("load",a);break;case"video":case"audio":for(u=0;u<Uf.length;u++)Xi(Uf[u],a);break;case"source":Xi("error",a);break;case"img":case"image":case"link":Xi("error",a),Xi("load",a);break;case"details":Xi("toggle",a);break;case"input":Xi("invalid",a),$c(a,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0);break;case"select":Xi("invalid",a);break;case"textarea":Xi("invalid",a),pa(a,g.value,g.defaultValue,g.children)}u=g.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||a.textContent===""+u||g.suppressHydrationWarning===!0||h1(a.textContent,u)?(g.popover!=null&&(Xi("beforetoggle",a),Xi("toggle",a)),g.onScroll!=null&&Xi("scroll",a),g.onScrollEnd!=null&&Xi("scrollend",a),g.onClick!=null&&(a.onclick=ho),a=!0):a=!1,a||tc(i,!0)}function Il(i){for(ra=i.return;ra;)switch(ra.tag){case 5:case 31:case 13:ls=!1;return;case 27:case 3:ls=!0;return;default:ra=ra.return}}function Ur(i){if(i!==ra)return!1;if(!Mi)return Il(i),Mi=!0,!1;var a=i.tag,u;if((u=a!==3&&a!==27)&&((u=a===5)&&(u=i.type,u=!(u!=="form"&&u!=="button")||L0(i.type,i.memoizedProps)),u=!u),u&&Pr&&tc(i),Il(i),a===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(317));Pr=w1(i)}else if(a===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(317));Pr=w1(i)}else a===27?(a=Pr,Lu(i.type)?(i=F0,F0=null,Pr=i):Pr=a):Pr=ra?Ic(i.stateNode.nextSibling):null;return!0}function ys(){Pr=ra=null,Mi=!1}function zl(){var i=Ua;return i!==null&&(Rt===null?Rt=i:Rt.push.apply(Rt,i),Ua=null),i}function As(i){Ua===null?Ua=[i]:Ua.push(i)}var fu=E(null),nc=null,Ar=null;function $s(i,a,u){Q(fu,a._currentValue),a._currentValue=u}function Cr(i){i._currentValue=fu.current,L(fu)}function Sa(i,a,u){for(;i!==null;){var g=i.alternate;if((i.childLanes&a)!==a?(i.childLanes|=a,g!==null&&(g.childLanes|=a)):g!==null&&(g.childLanes&a)!==a&&(g.childLanes|=a),i===u)break;i=i.return}}function cs(i,a,u,g){var w=i.child;for(w!==null&&(w.return=i);w!==null;){var k=w.dependencies;if(k!==null){var V=w.child;k=k.firstContext;e:for(;k!==null;){var he=k;k=w;for(var Be=0;Be<a.length;Be++)if(he.context===a[Be]){k.lanes|=u,he=k.alternate,he!==null&&(he.lanes|=u),Sa(k.return,u,i),g||(V=null);break e}k=he.next}}else if(w.tag===18){if(V=w.return,V===null)throw Error(n(341));V.lanes|=u,k=V.alternate,k!==null&&(k.lanes|=u),Sa(V,u,i),V=null}else V=w.child;if(V!==null)V.return=w;else for(V=w;V!==null;){if(V===i){V=null;break}if(w=V.sibling,w!==null){w.return=V.return,V=w;break}V=V.return}w=V}}function Gs(i,a,u,g){i=null;for(var w=a,k=!1;w!==null;){if(!k){if((w.flags&524288)!==0)k=!0;else if((w.flags&262144)!==0)break}if(w.tag===10){var V=w.alternate;if(V===null)throw Error(n(387));if(V=V.memoizedProps,V!==null){var he=w.type;Es(w.pendingProps.value,V.value)||(i!==null?i.push(he):i=[he])}}else if(w===re.current){if(V=w.alternate,V===null)throw Error(n(387));V.memoizedState.memoizedState!==w.memoizedState.memoizedState&&(i!==null?i.push($f):i=[$f])}w=w.return}i!==null&&cs(a,i,u,g),a.flags|=262144}function Ys(i){for(i=i.firstContext;i!==null;){if(!Es(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Xs(i){nc=i,Ar=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function tr(i){return So(nc,i)}function no(i,a){return nc===null&&Xs(i),So(i,a)}function So(i,a){var u=a._currentValue;if(a={context:a,memoizedValue:u,next:null},Ar===null){if(i===null)throw Error(n(308));Ar=a,i.dependencies={lanes:0,firstContext:a},i.flags|=524288}else Ar=Ar.next=a;return u}var ic=typeof AbortController<"u"?AbortController:function(){var i=[],a=this.signal={aborted:!1,addEventListener:function(u,g){i.push(g)}};this.abort=function(){a.aborted=!0,i.forEach(function(u){return u()})}},Uo=s.unstable_scheduleCallback,rc=s.unstable_NormalPriority,Vi={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function sa(){return{controller:new ic,data:new Map,refCount:0}}function Ks(i){i.refCount--,i.refCount===0&&Uo(rc,function(){i.controller.abort()})}var Aa=null,Ha=0,x=0,S=null;function P(i,a){if(Aa===null){var u=Aa=[];Ha=0,x=T0(),S={status:"pending",value:void 0,then:function(g){u.push(g)}}}return Ha++,a.then(F,F),a}function F(){if(--Ha===0&&Aa!==null){S!==null&&(S.status="fulfilled");var i=Aa;Aa=null,x=0,S=null;for(var a=0;a<i.length;a++)(0,i[a])()}}function ne(i,a){var u=[],g={status:"pending",value:null,reason:null,then:function(w){u.push(w)}};return i.then(function(){g.status="fulfilled",g.value=a;for(var w=0;w<u.length;w++)(0,u[w])(a)},function(w){for(g.status="rejected",g.reason=w,w=0;w<u.length;w++)(0,u[w])(void 0)}),g}var ae=ie.S;ie.S=function(i,a){Yn=wt(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&P(i,a),ae!==null&&ae(i,a)};var ce=E(null);function me(){var i=ce.current;return i!==null?i:ye.pooledCache}function we(i,a){a===null?Q(ce,ce.current):Q(ce,a.pool)}function Te(){var i=me();return i===null?null:{parent:Vi._currentValue,pool:i}}var Fe=Error(n(460)),et=Error(n(474)),ke=Error(n(542)),qe={then:function(){}};function Ge(i){return i=i.status,i==="fulfilled"||i==="rejected"}function ct(i,a,u){switch(u=i[u],u===void 0?i.push(a):u!==a&&(a.then(ho,ho),a=u),a.status){case"fulfilled":return a.value;case"rejected":throw i=a.reason,bt(i),i;default:if(typeof a.status=="string")a.then(ho,ho);else{if(i=ye,i!==null&&100<i.shellSuspendCounter)throw Error(n(482));i=a,i.status="pending",i.then(function(g){if(a.status==="pending"){var w=a;w.status="fulfilled",w.value=g}},function(g){if(a.status==="pending"){var w=a;w.status="rejected",w.reason=g}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw i=a.reason,bt(i),i}throw gt=a,Fe}}function Ke(i){try{var a=i._init;return a(i._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(gt=u,Fe):u}}var gt=null;function ut(){if(gt===null)throw Error(n(459));var i=gt;return gt=null,i}function bt(i){if(i===Fe||i===ke)throw Error(n(483))}var Nt=null,hn=0;function dn(i){var a=hn;return hn+=1,Nt===null&&(Nt=[]),ct(Nt,i,a)}function ni(i,a){a=a.props.ref,i.ref=a!==void 0?a:null}function fn(i,a){throw a.$$typeof===A?Error(n(525)):(i=Object.prototype.toString.call(a),Error(n(31,i==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":i)))}function In(i){function a(Xe,He){if(i){var tt=Xe.deletions;tt===null?(Xe.deletions=[He],Xe.flags|=16):tt.push(He)}}function u(Xe,He){if(!i)return null;for(;He!==null;)a(Xe,He),He=He.sibling;return null}function g(Xe){for(var He=new Map;Xe!==null;)Xe.key!==null?He.set(Xe.key,Xe):He.set(Xe.index,Xe),Xe=Xe.sibling;return He}function w(Xe,He){return Xe=Ba(Xe,He),Xe.index=0,Xe.sibling=null,Xe}function k(Xe,He,tt){return Xe.index=tt,i?(tt=Xe.alternate,tt!==null?(tt=tt.index,tt<He?(Xe.flags|=67108866,He):tt):(Xe.flags|=67108866,He)):(Xe.flags|=1048576,He)}function V(Xe){return i&&Xe.alternate===null&&(Xe.flags|=67108866),Xe}function he(Xe,He,tt,kt){return He===null||He.tag!==6?(He=fl(tt,Xe.mode,kt),He.return=Xe,He):(He=w(He,tt),He.return=Xe,He)}function Be(Xe,He,tt,kt){var Hn=tt.type;return Hn===T?vt(Xe,He,tt.props.children,kt,tt.key):He!==null&&(He.elementType===Hn||typeof Hn=="object"&&Hn!==null&&Hn.$$typeof===X&&Ke(Hn)===He.type)?(He=w(He,tt.props),ni(He,tt),He.return=Xe,He):(He=Dl(tt.type,tt.key,tt.props,null,Xe.mode,kt),ni(He,tt),He.return=Xe,He)}function nt(Xe,He,tt,kt){return He===null||He.tag!==4||He.stateNode.containerInfo!==tt.containerInfo||He.stateNode.implementation!==tt.implementation?(He=Oo(tt,Xe.mode,kt),He.return=Xe,He):(He=w(He,tt.children||[]),He.return=Xe,He)}function vt(Xe,He,tt,kt,Hn){return He===null||He.tag!==7?(He=Zl(tt,Xe.mode,kt,Hn),He.return=Xe,He):(He=w(He,tt),He.return=Xe,He)}function Pt(Xe,He,tt){if(typeof He=="string"&&He!==""||typeof He=="number"||typeof He=="bigint")return He=fl(""+He,Xe.mode,tt),He.return=Xe,He;if(typeof He=="object"&&He!==null){switch(He.$$typeof){case v:return tt=Dl(He.type,He.key,He.props,null,Xe.mode,tt),ni(tt,He),tt.return=Xe,tt;case N:return He=Oo(He,Xe.mode,tt),He.return=Xe,He;case X:return He=Ke(He),Pt(Xe,He,tt)}if(Ce(He)||I(He))return He=Zl(He,Xe.mode,tt,null),He.return=Xe,He;if(typeof He.then=="function")return Pt(Xe,dn(He),tt);if(He.$$typeof===R)return Pt(Xe,no(Xe,He),tt);fn(Xe,He)}return null}function rt(Xe,He,tt,kt){var Hn=He!==null?He.key:null;if(typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint")return Hn!==null?null:he(Xe,He,""+tt,kt);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case v:return tt.key===Hn?Be(Xe,He,tt,kt):null;case N:return tt.key===Hn?nt(Xe,He,tt,kt):null;case X:return tt=Ke(tt),rt(Xe,He,tt,kt)}if(Ce(tt)||I(tt))return Hn!==null?null:vt(Xe,He,tt,kt,null);if(typeof tt.then=="function")return rt(Xe,He,dn(tt),kt);if(tt.$$typeof===R)return rt(Xe,He,no(Xe,tt),kt);fn(Xe,tt)}return null}function ft(Xe,He,tt,kt,Hn){if(typeof kt=="string"&&kt!==""||typeof kt=="number"||typeof kt=="bigint")return Xe=Xe.get(tt)||null,he(He,Xe,""+kt,Hn);if(typeof kt=="object"&&kt!==null){switch(kt.$$typeof){case v:return Xe=Xe.get(kt.key===null?tt:kt.key)||null,Be(He,Xe,kt,Hn);case N:return Xe=Xe.get(kt.key===null?tt:kt.key)||null,nt(He,Xe,kt,Hn);case X:return kt=Ke(kt),ft(Xe,He,tt,kt,Hn)}if(Ce(kt)||I(kt))return Xe=Xe.get(tt)||null,vt(He,Xe,kt,Hn,null);if(typeof kt.then=="function")return ft(Xe,He,tt,dn(kt),Hn);if(kt.$$typeof===R)return ft(Xe,He,tt,no(He,kt),Hn);fn(He,kt)}return null}function bn(Xe,He,tt,kt){for(var Hn=null,wr=null,Rn=He,Ri=He=0,Ji=null;Rn!==null&&Ri<tt.length;Ri++){Rn.index>Ri?(Ji=Rn,Rn=null):Ji=Rn.sibling;var Sr=rt(Xe,Rn,tt[Ri],kt);if(Sr===null){Rn===null&&(Rn=Ji);break}i&&Rn&&Sr.alternate===null&&a(Xe,Rn),He=k(Sr,He,Ri),wr===null?Hn=Sr:wr.sibling=Sr,wr=Sr,Rn=Ji}if(Ri===tt.length)return u(Xe,Rn),Mi&&Ds(Xe,Ri),Hn;if(Rn===null){for(;Ri<tt.length;Ri++)Rn=Pt(Xe,tt[Ri],kt),Rn!==null&&(He=k(Rn,He,Ri),wr===null?Hn=Rn:wr.sibling=Rn,wr=Rn);return Mi&&Ds(Xe,Ri),Hn}for(Rn=g(Rn);Ri<tt.length;Ri++)Ji=ft(Rn,Xe,Ri,tt[Ri],kt),Ji!==null&&(i&&Ji.alternate!==null&&Rn.delete(Ji.key===null?Ri:Ji.key),He=k(Ji,He,Ri),wr===null?Hn=Ji:wr.sibling=Ji,wr=Ji);return i&&Rn.forEach(function(Fu){return a(Xe,Fu)}),Mi&&Ds(Xe,Ri),Hn}function Zn(Xe,He,tt,kt){if(tt==null)throw Error(n(151));for(var Hn=null,wr=null,Rn=He,Ri=He=0,Ji=null,Sr=tt.next();Rn!==null&&!Sr.done;Ri++,Sr=tt.next()){Rn.index>Ri?(Ji=Rn,Rn=null):Ji=Rn.sibling;var Fu=rt(Xe,Rn,Sr.value,kt);if(Fu===null){Rn===null&&(Rn=Ji);break}i&&Rn&&Fu.alternate===null&&a(Xe,Rn),He=k(Fu,He,Ri),wr===null?Hn=Fu:wr.sibling=Fu,wr=Fu,Rn=Ji}if(Sr.done)return u(Xe,Rn),Mi&&Ds(Xe,Ri),Hn;if(Rn===null){for(;!Sr.done;Ri++,Sr=tt.next())Sr=Pt(Xe,Sr.value,kt),Sr!==null&&(He=k(Sr,He,Ri),wr===null?Hn=Sr:wr.sibling=Sr,wr=Sr);return Mi&&Ds(Xe,Ri),Hn}for(Rn=g(Rn);!Sr.done;Ri++,Sr=tt.next())Sr=ft(Rn,Xe,Ri,Sr.value,kt),Sr!==null&&(i&&Sr.alternate!==null&&Rn.delete(Sr.key===null?Ri:Sr.key),He=k(Sr,He,Ri),wr===null?Hn=Sr:wr.sibling=Sr,wr=Sr);return i&&Rn.forEach(function(Rw){return a(Xe,Rw)}),Mi&&Ds(Xe,Ri),Hn}function Yr(Xe,He,tt,kt){if(typeof tt=="object"&&tt!==null&&tt.type===T&&tt.key===null&&(tt=tt.props.children),typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case v:e:{for(var Hn=tt.key;He!==null;){if(He.key===Hn){if(Hn=tt.type,Hn===T){if(He.tag===7){u(Xe,He.sibling),kt=w(He,tt.props.children),kt.return=Xe,Xe=kt;break e}}else if(He.elementType===Hn||typeof Hn=="object"&&Hn!==null&&Hn.$$typeof===X&&Ke(Hn)===He.type){u(Xe,He.sibling),kt=w(He,tt.props),ni(kt,tt),kt.return=Xe,Xe=kt;break e}u(Xe,He);break}else a(Xe,He);He=He.sibling}tt.type===T?(kt=Zl(tt.props.children,Xe.mode,kt,tt.key),kt.return=Xe,Xe=kt):(kt=Dl(tt.type,tt.key,tt.props,null,Xe.mode,kt),ni(kt,tt),kt.return=Xe,Xe=kt)}return V(Xe);case N:e:{for(Hn=tt.key;He!==null;){if(He.key===Hn)if(He.tag===4&&He.stateNode.containerInfo===tt.containerInfo&&He.stateNode.implementation===tt.implementation){u(Xe,He.sibling),kt=w(He,tt.children||[]),kt.return=Xe,Xe=kt;break e}else{u(Xe,He);break}else a(Xe,He);He=He.sibling}kt=Oo(tt,Xe.mode,kt),kt.return=Xe,Xe=kt}return V(Xe);case X:return tt=Ke(tt),Yr(Xe,He,tt,kt)}if(Ce(tt))return bn(Xe,He,tt,kt);if(I(tt)){if(Hn=I(tt),typeof Hn!="function")throw Error(n(150));return tt=Hn.call(tt),Zn(Xe,He,tt,kt)}if(typeof tt.then=="function")return Yr(Xe,He,dn(tt),kt);if(tt.$$typeof===R)return Yr(Xe,He,no(Xe,tt),kt);fn(Xe,tt)}return typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint"?(tt=""+tt,He!==null&&He.tag===6?(u(Xe,He.sibling),kt=w(He,tt),kt.return=Xe,Xe=kt):(u(Xe,He),kt=fl(tt,Xe.mode,kt),kt.return=Xe,Xe=kt),V(Xe)):u(Xe,He)}return function(Xe,He,tt,kt){try{hn=0;var Hn=Yr(Xe,He,tt,kt);return Nt=null,Hn}catch(Rn){if(Rn===Fe||Rn===ke)throw Rn;var wr=ia(29,Rn,null,Xe.mode);return wr.lanes=kt,wr.return=Xe,wr}finally{}}}var Ei=In(!0),Gn=In(!1),en=!1;function Vt(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function lr(i,a){i=i.updateQueue,a.updateQueue===i&&(a.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Dn(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function di(i,a,u){var g=i.updateQueue;if(g===null)return null;if(g=g.shared,(fe&2)!==0){var w=g.pending;return w===null?a.next=a:(a.next=w.next,w.next=a),g.pending=a,a=pr(i),Zi(i,null,u),a}return hl(i,g,a,u),pr(i)}function nr(i,a,u){if(a=a.updateQueue,a!==null&&(a=a.shared,(u&4194048)!==0)){var g=a.lanes;g&=i.pendingLanes,u|=g,a.lanes=u,ar(i,u)}}function gr(i,a){var u=i.updateQueue,g=i.alternate;if(g!==null&&(g=g.updateQueue,u===g)){var w=null,k=null;if(u=u.firstBaseUpdate,u!==null){do{var V={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};k===null?w=k=V:k=k.next=V,u=u.next}while(u!==null);k===null?w=k=a:k=k.next=a}else w=k=a;u={baseState:g.baseState,firstBaseUpdate:w,lastBaseUpdate:k,shared:g.shared,callbacks:g.callbacks},i.updateQueue=u;return}i=u.lastBaseUpdate,i===null?u.firstBaseUpdate=a:i.next=a,u.lastBaseUpdate=a}var mr=!1;function Ai(){if(mr){var i=S;if(i!==null)throw i}}function yr(i,a,u,g){mr=!1;var w=i.updateQueue;en=!1;var k=w.firstBaseUpdate,V=w.lastBaseUpdate,he=w.shared.pending;if(he!==null){w.shared.pending=null;var Be=he,nt=Be.next;Be.next=null,V===null?k=nt:V.next=nt,V=Be;var vt=i.alternate;vt!==null&&(vt=vt.updateQueue,he=vt.lastBaseUpdate,he!==V&&(he===null?vt.firstBaseUpdate=nt:he.next=nt,vt.lastBaseUpdate=Be))}if(k!==null){var Pt=w.baseState;V=0,vt=nt=Be=null,he=k;do{var rt=he.lane&-536870913,ft=rt!==he.lane;if(ft?(ge&rt)===rt:(g&rt)===rt){rt!==0&&rt===x&&(mr=!0),vt!==null&&(vt=vt.next={lane:0,tag:he.tag,payload:he.payload,callback:null,next:null});e:{var bn=i,Zn=he;rt=a;var Yr=u;switch(Zn.tag){case 1:if(bn=Zn.payload,typeof bn=="function"){Pt=bn.call(Yr,Pt,rt);break e}Pt=bn;break e;case 3:bn.flags=bn.flags&-65537|128;case 0:if(bn=Zn.payload,rt=typeof bn=="function"?bn.call(Yr,Pt,rt):bn,rt==null)break e;Pt=y({},Pt,rt);break e;case 2:en=!0}}rt=he.callback,rt!==null&&(i.flags|=64,ft&&(i.flags|=8192),ft=w.callbacks,ft===null?w.callbacks=[rt]:ft.push(rt))}else ft={lane:rt,tag:he.tag,payload:he.payload,callback:he.callback,next:null},vt===null?(nt=vt=ft,Be=Pt):vt=vt.next=ft,V|=rt;if(he=he.next,he===null){if(he=w.shared.pending,he===null)break;ft=he,he=ft.next,ft.next=null,w.lastBaseUpdate=ft,w.shared.pending=null}}while(!0);vt===null&&(Be=Pt),w.baseState=Be,w.firstBaseUpdate=nt,w.lastBaseUpdate=vt,k===null&&(w.shared.lanes=0),qt|=V,i.lanes=V,i.memoizedState=Pt}}function Hr(i,a){if(typeof i!="function")throw Error(n(191,i));i.call(a)}function Vr(i,a){var u=i.callbacks;if(u!==null)for(i.callbacks=null,i=0;i<u.length;i++)Hr(u[i],a)}var pi=E(null),ai=E(0);function Tr(i,a){i=Tt,Q(ai,i),Q(pi,a),Tt=i|a.baseLanes}function Gi(){Q(ai,Tt),Q(pi,pi.current)}function Cs(){Tt=ai.current,L(pi),L(ai)}var Er=E(null),Yi=null;function es(i){var a=i.alternate;Q(qi,qi.current&1),Q(Er,i),Yi===null&&(a===null||pi.current!==null||a.memoizedState!==null)&&(Yi=i)}function Ii(i){Q(qi,qi.current),Q(Er,i),Yi===null&&(Yi=i)}function Mr(i){i.tag===22?(Q(qi,qi.current),Q(Er,i),Yi===null&&(Yi=i)):ts()}function ts(){Q(qi,qi.current),Q(Er,Er.current)}function xr(i){L(Er),Yi===i&&(Yi=null),L(qi)}var qi=E(0);function Ls(i){for(var a=i;a!==null;){if(a.tag===13){var u=a.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||z0(u)||B0(u)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ns=0,Nn=null,En=null,Wi=null,aa=!1,oa=!1,Ms=!1,ds=0,Bl=0,pl=null,xd=0;function vr(){throw Error(n(321))}function pu(i,a){if(a===null)return!1;for(var u=0;u<a.length&&u<i.length;u++)if(!Es(i[u],a[u]))return!1;return!0}function jc(i,a,u,g,w,k){return ns=k,Nn=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,ie.H=i===null||i.memoizedState===null?Ef:th,Ms=!1,k=u(g,w),Ms=!1,oa&&(k=gl(a,u,g,w)),Nc(i),k}function Nc(i){ie.H=Zd;var a=En!==null&&En.next!==null;if(ns=0,Wi=En=Nn=null,aa=!1,Bl=0,pl=null,a)throw Error(n(300));i===null||Is||(i=i.dependencies,i!==null&&Ys(i)&&(Is=!0))}function gl(i,a,u,g){Nn=i;var w=0;do{if(oa&&(pl=null),Bl=0,oa=!1,25<=w)throw Error(n(301));if(w+=1,Wi=En=null,i.updateQueue!=null){var k=i.updateQueue;k.lastEffect=null,k.events=null,k.stores=null,k.memoCache!=null&&(k.memoCache.index=0)}ie.H=nh,k=a(u,g)}while(oa);return k}function Xu(){var i=ie.H,a=i.useState()[0];return a=typeof a.then=="function"?ac(a):a,i=i.useState()[0],(En!==null?En.memoizedState:null)!==i&&(Nn.flags|=1024),a}function bd(){var i=ds!==0;return ds=0,i}function Ud(i,a,u){a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~u}function gu(i){if(aa){for(i=i.memoizedState;i!==null;){var a=i.queue;a!==null&&(a.pending=null),i=i.next}aa=!1}ns=0,Wi=En=Nn=null,oa=!1,Bl=ds=0,pl=null}function qr(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wi===null?Nn.memoizedState=Wi=i:Wi=Wi.next=i,Wi}function Wr(){if(En===null){var i=Nn.alternate;i=i!==null?i.memoizedState:null}else i=En.next;var a=Wi===null?Nn.memoizedState:Wi.next;if(a!==null)Wi=a,En=i;else{if(i===null)throw Nn.alternate===null?Error(n(467)):Error(n(310));En=i,i={memoizedState:En.memoizedState,baseState:En.baseState,baseQueue:En.baseQueue,queue:En.queue,next:null},Wi===null?Nn.memoizedState=Wi=i:Wi=Wi.next=i}return Wi}function sc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ac(i){var a=Bl;return Bl+=1,pl===null&&(pl=[]),i=ct(pl,i,a),a=Nn,(Wi===null?a.memoizedState:Wi.next)===null&&(a=a.alternate,ie.H=a===null||a.memoizedState===null?Ef:th),i}function Xc(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return ac(i);if(i.$$typeof===R)return tr(i)}throw Error(n(438,String(i)))}function Fl(i){var a=null,u=Nn.updateQueue;if(u!==null&&(a=u.memoCache),a==null){var g=Nn.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(a={data:g.data.map(function(w){return w.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),u===null&&(u=sc(),Nn.updateQueue=u),u.memoCache=a,u=a.data[a.index],u===void 0)for(u=a.data[a.index]=Array(i),g=0;g<i;g++)u[g]=Y;return a.index++,u}function ml(i,a){return typeof a=="function"?a(i):a}function oc(i){var a=Wr();return Pc(a,En,i)}function Pc(i,a,u){var g=i.queue;if(g===null)throw Error(n(311));g.lastRenderedReducer=u;var w=i.baseQueue,k=g.pending;if(k!==null){if(w!==null){var V=w.next;w.next=k.next,k.next=V}a.baseQueue=w=k,g.pending=null}if(k=i.baseState,w===null)i.memoizedState=k;else{a=w.next;var he=V=null,Be=null,nt=a,vt=!1;do{var Pt=nt.lane&-536870913;if(Pt!==nt.lane?(ge&Pt)===Pt:(ns&Pt)===Pt){var rt=nt.revertLane;if(rt===0)Be!==null&&(Be=Be.next={lane:0,revertLane:0,gesture:null,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null}),Pt===x&&(vt=!0);else if((ns&rt)===rt){nt=nt.next,rt===x&&(vt=!0);continue}else Pt={lane:0,revertLane:nt.revertLane,gesture:null,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null},Be===null?(he=Be=Pt,V=k):Be=Be.next=Pt,Nn.lanes|=rt,qt|=rt;Pt=nt.action,Ms&&u(k,Pt),k=nt.hasEagerState?nt.eagerState:u(k,Pt)}else rt={lane:Pt,revertLane:nt.revertLane,gesture:nt.gesture,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null},Be===null?(he=Be=rt,V=k):Be=Be.next=rt,Nn.lanes|=Pt,qt|=Pt;nt=nt.next}while(nt!==null&&nt!==a);if(Be===null?V=k:Be.next=he,!Es(k,i.memoizedState)&&(Is=!0,vt&&(u=S,u!==null)))throw u;i.memoizedState=k,i.baseState=V,i.baseQueue=Be,g.lastRenderedState=k}return w===null&&(g.lanes=0),[i.memoizedState,g.dispatch]}function Hd(i){var a=Wr(),u=a.queue;if(u===null)throw Error(n(311));u.lastRenderedReducer=i;var g=u.dispatch,w=u.pending,k=a.memoizedState;if(w!==null){u.pending=null;var V=w=w.next;do k=i(k,V.action),V=V.next;while(V!==w);Es(k,a.memoizedState)||(Is=!0),a.memoizedState=k,a.baseQueue===null&&(a.baseState=k),u.lastRenderedState=k}return[k,g]}function Vd(i,a,u){var g=Nn,w=Wr(),k=Mi;if(k){if(u===void 0)throw Error(n(407));u=u()}else u=a();var V=!Es((En||w).memoizedState,u);if(V&&(w.memoizedState=u,Is=!0),w=w.queue,_f(Ec.bind(null,g,w,i),[i]),w.getSnapshot!==a||V||Wi!==null&&Wi.memoizedState.tag&1){if(g.flags|=2048,Dc(9,{destroy:void 0},vd.bind(null,g,w,u,a),null),ye===null)throw Error(n(349));k||(ns&127)!==0||Ho(g,a,u)}return u}function Ho(i,a,u){i.flags|=16384,i={getSnapshot:a,value:u},a=Nn.updateQueue,a===null?(a=sc(),Nn.updateQueue=a,a.stores=[i]):(u=a.stores,u===null?a.stores=[i]:u.push(i))}function vd(i,a,u,g){a.value=u,a.getSnapshot=g,qd(a)&&Kc(i)}function Ec(i,a,u){return u(function(){qd(a)&&Kc(i)})}function qd(i){var a=i.getSnapshot;i=i.value;try{var u=a();return!Es(i,u)}catch{return!0}}function Kc(i){var a=Fo(i,2);a!==null&&Ul(a,i,2)}function Rc(i){var a=qr();if(typeof i=="function"){var u=i;if(i=u(),Ms){un(!0);try{u()}finally{un(!1)}}}return a.memoizedState=a.baseState=i,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ml,lastRenderedState:i},a}function mu(i,a,u,g){return i.baseState=u,Pc(i,En,typeof g=="function"?g:ml)}function Rh(i,a,u,g,w){if(Dh(i))throw Error(n(485));if(i=a.action,i!==null){var k={payload:w,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(V){k.listeners.push(V)}};ie.T!==null?u(!0):k.isTransition=!1,g(k),u=a.pending,u===null?(k.next=a.pending=k,Wd(a,k)):(k.next=u.next,a.pending=u.next=k)}}function Wd(i,a){var u=a.action,g=a.payload,w=i.state;if(a.isTransition){var k=ie.T,V={};ie.T=V;try{var he=u(w,g),Be=ie.S;Be!==null&&Be(V,he),Vo(i,a,he)}catch(nt){Ca(i,a,nt)}finally{k!==null&&V.types!==null&&(k.types=V.types),ie.T=k}}else try{k=u(w,g),Vo(i,a,k)}catch(nt){Ca(i,a,nt)}}function Vo(i,a,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(g){yl(i,a,g)},function(g){return Ca(i,a,g)}):yl(i,a,u)}function yl(i,a,u){a.status="fulfilled",a.value=u,yu(a),i.state=u,a=i.pending,a!==null&&(u=a.next,u===a?i.pending=null:(u=u.next,a.next=u,Wd(i,u)))}function Ca(i,a,u){var g=i.pending;if(i.pending=null,g!==null){g=g.next;do a.status="rejected",a.reason=u,yu(a),a=a.next;while(a!==g)}i.action=null}function yu(i){i=i.listeners;for(var a=0;a<i.length;a++)(0,i[a])()}function $d(i,a){return a}function Ol(i,a){if(Mi){var u=ye.formState;if(u!==null){e:{var g=Nn;if(Mi){if(Pr){t:{for(var w=Pr,k=ls;w.nodeType!==8;){if(!k){w=null;break t}if(w=Ic(w.nextSibling),w===null){w=null;break t}}k=w.data,w=k==="F!"||k==="F"?w:null}if(w){Pr=Ic(w.nextSibling),g=w.data==="F!";break e}}tc(g)}g=!1}g&&(a=u[0])}}return u=qr(),u.memoizedState=u.baseState=a,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$d,lastRenderedState:a},u.queue=g,u=dc.bind(null,Nn,g),g.dispatch=u,g=Rc(!1),k=Pf.bind(null,Nn,!1,g.queue),g=qr(),w={state:a,dispatch:null,action:i,pending:null},g.queue=w,u=Rh.bind(null,Nn,w,k,u),w.dispatch=u,g.memoizedState=i,[a,u,!1]}function lc(i){var a=Wr();return cc(a,En,i)}function cc(i,a,u){if(a=Pc(i,a,$d)[0],i=oc(ml)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var g=ac(a)}catch(V){throw V===Fe?ke:V}else g=a;a=Wr();var w=a.queue,k=w.dispatch;return u!==a.memoizedState&&(Nn.flags|=2048,Dc(9,{destroy:void 0},xu.bind(null,w,u),null)),[g,k,i]}function xu(i,a){i.action=a}function Gd(i){var a=Wr(),u=En;if(u!==null)return cc(a,u,i);Wr(),a=a.memoizedState,u=Wr();var g=u.queue.dispatch;return u.memoizedState=i,[a,g,!1]}function Dc(i,a,u,g){return i={tag:i,create:u,deps:g,inst:a,next:null},a=Nn.updateQueue,a===null&&(a=sc(),Nn.updateQueue=a),u=a.lastEffect,u===null?a.lastEffect=i.next=i:(g=u.next,u.next=i,i.next=g,a.lastEffect=i),i}function xl(){return Wr().memoizedState}function Zc(i,a,u,g){var w=qr();Nn.flags|=i,w.memoizedState=Dc(1|a,{destroy:void 0},u,g===void 0?null:g)}function wd(i,a,u,g){var w=Wr();g=g===void 0?null:g;var k=w.memoizedState.inst;En!==null&&g!==null&&pu(g,En.memoizedState.deps)?w.memoizedState=Dc(a,k,u,g):(Nn.flags|=i,w.memoizedState=Dc(1|a,k,u,g))}function Ep(i,a){Zc(8390656,8,i,a)}function _f(i,a){wd(2048,8,i,a)}function y0(i){Nn.flags|=4;var a=Nn.updateQueue;if(a===null)a=sc(),Nn.updateQueue=a,a.events=[i];else{var u=a.events;u===null?a.events=[i]:u.push(i)}}function Rp(i){var a=Wr().memoizedState;return y0({ref:a,nextImpl:i}),function(){if((fe&2)!==0)throw Error(n(440));return a.impl.apply(void 0,arguments)}}function Dp(i,a){return wd(4,2,i,a)}function Lp(i,a){return wd(4,4,i,a)}function Mp(i,a){if(typeof a=="function"){i=i();var u=a(i);return function(){typeof u=="function"?u():a(null)}}if(a!=null)return i=i(),a.current=i,function(){a.current=null}}function Ip(i,a,u){u=u!=null?u.concat([i]):null,wd(4,4,Mp.bind(null,a,i),u)}function jf(){}function zp(i,a){var u=Wr();a=a===void 0?null:a;var g=u.memoizedState;return a!==null&&pu(a,g[1])?g[0]:(u.memoizedState=[i,a],i)}function bu(i,a){var u=Wr();a=a===void 0?null:a;var g=u.memoizedState;if(a!==null&&pu(a,g[1]))return g[0];if(g=i(),Ms){un(!0);try{i()}finally{un(!1)}}return u.memoizedState=[g,a],g}function Sd(i,a,u){return u===void 0||(ns&1073741824)!==0&&(ge&261930)===0?i.memoizedState=a:(i.memoizedState=u,i=bl(),Nn.lanes|=i,qt|=i,u)}function Yd(i,a,u,g){return Es(u,a)?u:pi.current!==null?(i=Sd(i,u,g),Es(i,a)||(Is=!0),i):(ns&42)===0||(ns&1073741824)!==0&&(ge&261930)===0?(Is=!0,i.memoizedState=u):(i=bl(),Nn.lanes|=i,qt|=i,a)}function Ku(i,a,u,g,w){var k=le.p;le.p=k!==0&&8>k?k:8;var V=ie.T,he={};ie.T=he,Pf(i,!1,a,u);try{var Be=w(),nt=ie.S;if(nt!==null&&nt(he,Be),Be!==null&&typeof Be=="object"&&typeof Be.then=="function"){var vt=ne(Be,g);Kd(i,a,vt,xs(i))}else Kd(i,a,g,xs(i))}catch(Pt){Kd(i,a,{then:function(){},status:"rejected",reason:Pt},xs())}finally{le.p=k,V!==null&&he.types!==null&&(V.types=he.types),ie.T=V}}function Zu(){}function Ju(i,a,u,g){if(i.tag!==5)throw Error(n(476));var w=vu(i).queue;Ku(i,w,a,se,u===null?Zu:function(){return wu(i),u(g)})}function vu(i){var a=i.memoizedState;if(a!==null)return a;a={memoizedState:se,baseState:se,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ml,lastRenderedState:se},next:null};var u={};return a.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ml,lastRenderedState:u},next:null},i.memoizedState=a,i=i.alternate,i!==null&&(i.memoizedState=a),a}function wu(i){var a=vu(i);a.next===null&&(a=i.alternate.memoizedState),Kd(i,a.next.queue,{},xs())}function Xd(){return tr($f)}function Qu(){return Wr().memoizedState}function eh(){return Wr().memoizedState}function x0(i){for(var a=i.return;a!==null;){switch(a.tag){case 24:case 3:var u=xs();i=Dn(u);var g=di(a,i,u);g!==null&&(Ul(g,a,u),nr(g,a,u)),a={cache:sa()},i.payload=a;return}a=a.return}}function Nf(i,a,u){var g=xs();u={lane:g,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Dh(i)?Jc(a,u):(u=Fd(i,a,u,g),u!==null&&(Ul(u,i,g),Bp(u,a,g)))}function dc(i,a,u){var g=xs();Kd(i,a,u,g)}function Kd(i,a,u,g){var w={lane:g,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(Dh(i))Jc(a,w);else{var k=i.alternate;if(i.lanes===0&&(k===null||k.lanes===0)&&(k=a.lastRenderedReducer,k!==null))try{var V=a.lastRenderedState,he=k(V,u);if(w.hasEagerState=!0,w.eagerState=he,Es(he,V))return hl(i,a,w,0),ye===null&&Bd(),!1}catch{}finally{}if(u=Fd(i,a,w,g),u!==null)return Ul(u,i,g),Bp(u,a,g),!0}return!1}function Pf(i,a,u,g){if(g={lane:2,revertLane:T0(),gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},Dh(i)){if(a)throw Error(n(479))}else a=Fd(i,u,g,2),a!==null&&Ul(a,i,2)}function Dh(i){var a=i.alternate;return i===Nn||a!==null&&a===Nn}function Jc(i,a){oa=aa=!0;var u=i.pending;u===null?a.next=a:(a.next=u.next,u.next=a),i.pending=a}function Bp(i,a,u){if((u&4194048)!==0){var g=a.lanes;g&=i.pendingLanes,u|=g,a.lanes=u,ar(i,u)}}var Zd={readContext:tr,use:Xc,useCallback:vr,useContext:vr,useEffect:vr,useImperativeHandle:vr,useLayoutEffect:vr,useInsertionEffect:vr,useMemo:vr,useReducer:vr,useRef:vr,useState:vr,useDebugValue:vr,useDeferredValue:vr,useTransition:vr,useSyncExternalStore:vr,useId:vr,useHostTransitionStatus:vr,useFormState:vr,useActionState:vr,useOptimistic:vr,useMemoCache:vr,useCacheRefresh:vr};Zd.useEffectEvent=vr;var Ef={readContext:tr,use:Xc,useCallback:function(i,a){return qr().memoizedState=[i,a===void 0?null:a],i},useContext:tr,useEffect:Ep,useImperativeHandle:function(i,a,u){u=u!=null?u.concat([i]):null,Zc(4194308,4,Mp.bind(null,a,i),u)},useLayoutEffect:function(i,a){return Zc(4194308,4,i,a)},useInsertionEffect:function(i,a){Zc(4,2,i,a)},useMemo:function(i,a){var u=qr();a=a===void 0?null:a;var g=i();if(Ms){un(!0);try{i()}finally{un(!1)}}return u.memoizedState=[g,a],g},useReducer:function(i,a,u){var g=qr();if(u!==void 0){var w=u(a);if(Ms){un(!0);try{u(a)}finally{un(!1)}}}else w=a;return g.memoizedState=g.baseState=w,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:w},g.queue=i,i=i.dispatch=Nf.bind(null,Nn,i),[g.memoizedState,i]},useRef:function(i){var a=qr();return i={current:i},a.memoizedState=i},useState:function(i){i=Rc(i);var a=i.queue,u=dc.bind(null,Nn,a);return a.dispatch=u,[i.memoizedState,u]},useDebugValue:jf,useDeferredValue:function(i,a){var u=qr();return Sd(u,i,a)},useTransition:function(){var i=Rc(!1);return i=Ku.bind(null,Nn,i.queue,!0,!1),qr().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,a,u){var g=Nn,w=qr();if(Mi){if(u===void 0)throw Error(n(407));u=u()}else{if(u=a(),ye===null)throw Error(n(349));(ge&127)!==0||Ho(g,a,u)}w.memoizedState=u;var k={value:u,getSnapshot:a};return w.queue=k,Ep(Ec.bind(null,g,k,i),[i]),g.flags|=2048,Dc(9,{destroy:void 0},vd.bind(null,g,k,u,a),null),u},useId:function(){var i=qr(),a=ye.identifierPrefix;if(Mi){var u=vo,g=Oa;u=(g&~(1<<32-ot(g)-1)).toString(32)+u,a="_"+a+"R_"+u,u=ds++,0<u&&(a+="H"+u.toString(32)),a+="_"}else u=xd++,a="_"+a+"r_"+u.toString(32)+"_";return i.memoizedState=a},useHostTransitionStatus:Xd,useFormState:Ol,useActionState:Ol,useOptimistic:function(i){var a=qr();a.memoizedState=a.baseState=i;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=u,a=Pf.bind(null,Nn,!0,u),u.dispatch=a,[i,a]},useMemoCache:Fl,useCacheRefresh:function(){return qr().memoizedState=x0.bind(null,Nn)},useEffectEvent:function(i){var a=qr(),u={impl:i};return a.memoizedState=u,function(){if((fe&2)!==0)throw Error(n(440));return u.impl.apply(void 0,arguments)}}},th={readContext:tr,use:Xc,useCallback:zp,useContext:tr,useEffect:_f,useImperativeHandle:Ip,useInsertionEffect:Dp,useLayoutEffect:Lp,useMemo:bu,useReducer:oc,useRef:xl,useState:function(){return oc(ml)},useDebugValue:jf,useDeferredValue:function(i,a){var u=Wr();return Yd(u,En.memoizedState,i,a)},useTransition:function(){var i=oc(ml)[0],a=Wr().memoizedState;return[typeof i=="boolean"?i:ac(i),a]},useSyncExternalStore:Vd,useId:Qu,useHostTransitionStatus:Xd,useFormState:lc,useActionState:lc,useOptimistic:function(i,a){var u=Wr();return mu(u,En,i,a)},useMemoCache:Fl,useCacheRefresh:eh};th.useEffectEvent=Rp;var nh={readContext:tr,use:Xc,useCallback:zp,useContext:tr,useEffect:_f,useImperativeHandle:Ip,useInsertionEffect:Dp,useLayoutEffect:Lp,useMemo:bu,useReducer:Hd,useRef:xl,useState:function(){return Hd(ml)},useDebugValue:jf,useDeferredValue:function(i,a){var u=Wr();return En===null?Sd(u,i,a):Yd(u,En.memoizedState,i,a)},useTransition:function(){var i=Hd(ml)[0],a=Wr().memoizedState;return[typeof i=="boolean"?i:ac(i),a]},useSyncExternalStore:Vd,useId:Qu,useHostTransitionStatus:Xd,useFormState:Gd,useActionState:Gd,useOptimistic:function(i,a){var u=Wr();return En!==null?mu(u,En,i,a):(u.baseState=i,[i,u.queue.dispatch])},useMemoCache:Fl,useCacheRefresh:eh};nh.useEffectEvent=Rp;function Su(i,a,u,g){a=i.memoizedState,u=u(g,a),u=u==null?a:y({},a,u),i.memoizedState=u,i.lanes===0&&(i.updateQueue.baseState=u)}var Au={enqueueSetState:function(i,a,u){i=i._reactInternals;var g=xs(),w=Dn(g);w.payload=a,u!=null&&(w.callback=u),a=di(i,w,g),a!==null&&(Ul(a,i,g),nr(a,i,g))},enqueueReplaceState:function(i,a,u){i=i._reactInternals;var g=xs(),w=Dn(g);w.tag=1,w.payload=a,u!=null&&(w.callback=u),a=di(i,w,g),a!==null&&(Ul(a,i,g),nr(a,i,g))},enqueueForceUpdate:function(i,a){i=i._reactInternals;var u=xs(),g=Dn(u);g.tag=2,a!=null&&(g.callback=a),a=di(i,g,u),a!==null&&(Ul(a,i,u),nr(a,i,u))}};function Fp(i,a,u,g,w,k,V){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(g,k,V):a.prototype&&a.prototype.isPureReactComponent?!Xl(u,g)||!Xl(w,k):!0}function Lh(i,a,u,g){i=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(u,g),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(u,g),a.state!==i&&Au.enqueueReplaceState(a,a.state,null)}function Qc(i,a){var u=a;if("ref"in a){u={};for(var g in a)g!=="ref"&&(u[g]=a[g])}if(i=i.defaultProps){u===a&&(u=y({},u));for(var w in i)u[w]===void 0&&(u[w]=i[w])}return u}function Op(i){Pi(i)}function Up(i){console.error(i)}function qo(i){Pi(i)}function Mh(i,a){try{var u=i.onUncaughtError;u(a.value,{componentStack:a.stack})}catch(g){setTimeout(function(){throw g})}}function uc(i,a,u){try{var g=i.onCaughtError;g(u.value,{componentStack:u.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(w){setTimeout(function(){throw w})}}function Ih(i,a,u){return u=Dn(u),u.tag=3,u.payload={element:null},u.callback=function(){Mh(i,a)},u}function Jd(i){return i=Dn(i),i.tag=3,i}function Rf(i,a,u,g){var w=u.type.getDerivedStateFromError;if(typeof w=="function"){var k=g.value;i.payload=function(){return w(k)},i.callback=function(){uc(a,u,g)}}var V=u.stateNode;V!==null&&typeof V.componentDidCatch=="function"&&(i.callback=function(){uc(a,u,g),typeof w!="function"&&(ii===null?ii=new Set([this]):ii.add(this));var he=g.stack;this.componentDidCatch(g.value,{componentStack:he!==null?he:""})})}function Ad(i,a,u,g,w){if(u.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(a=u.alternate,a!==null&&Gs(a,u,w,!0),u=Er.current,u!==null){switch(u.tag){case 31:case 13:return Yi===null?tg():u.alternate===null&&Je===0&&(Je=3),u.flags&=-257,u.flags|=65536,u.lanes=w,g===qe?u.flags|=16384:(a=u.updateQueue,a===null?u.updateQueue=new Set([g]):a.add(g),S0(i,g,w)),!1;case 22:return u.flags|=65536,g===qe?u.flags|=16384:(a=u.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([g])},u.updateQueue=a):(u=a.retryQueue,u===null?a.retryQueue=new Set([g]):u.add(g)),S0(i,g,w)),!1}throw Error(n(435,u.tag))}return S0(i,g,w),tg(),!1}if(Mi)return a=Er.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=w,g!==wo&&(i=Error(n(422),{cause:g}),As(Fa(i,u)))):(g!==wo&&(a=Error(n(423),{cause:g}),As(Fa(a,u))),i=i.current.alternate,i.flags|=65536,w&=-w,i.lanes|=w,g=Fa(g,u),w=Ih(i.stateNode,g,w),gr(i,w),Je!==4&&(Je=2)),!1;var k=Error(n(520),{cause:g});if(k=Fa(k,u),dt===null?dt=[k]:dt.push(k),Je!==4&&(Je=2),a===null)return!0;g=Fa(g,u),u=a;do{switch(u.tag){case 3:return u.flags|=65536,i=w&-w,u.lanes|=i,i=Ih(u.stateNode,g,i),gr(u,i),!1;case 1:if(a=u.type,k=u.stateNode,(u.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(ii===null||!ii.has(k))))return u.flags|=65536,w&=-w,u.lanes|=w,w=Jd(w),Rf(w,i,u,g),gr(u,w),!1}u=u.return}while(u!==null);return!1}var ih=Error(n(461)),Is=!1;function Ta(i,a,u,g){a.child=i===null?Gn(a,null,u,g):Ei(a,i.child,u,g)}function Hp(i,a,u,g,w){u=u.render;var k=a.ref;if("ref"in g){var V={};for(var he in g)he!=="ref"&&(V[he]=g[he])}else V=g;return Xs(a),g=jc(i,a,u,V,k,w),he=bd(),i!==null&&!Is?(Ud(i,a,w),fc(i,a,w)):(Mi&&he&&yd(a),a.flags|=1,Ta(i,a,g,w),a.child)}function Vp(i,a,u,g,w){if(i===null){var k=u.type;return typeof k=="function"&&!gd(k)&&k.defaultProps===void 0&&u.compare===null?(a.tag=15,a.type=k,qp(i,a,k,g,w)):(i=Dl(u.type,null,g,a,a.mode,w),i.ref=a.ref,i.return=a,a.child=i)}if(k=i.child,!Va(i,w)){var V=k.memoizedProps;if(u=u.compare,u=u!==null?u:Xl,u(V,g)&&i.ref===a.ref)return fc(i,a,w)}return a.flags|=1,i=Ba(k,g),i.ref=a.ref,i.return=a,a.child=i}function qp(i,a,u,g,w){if(i!==null){var k=i.memoizedProps;if(Xl(k,g)&&i.ref===a.ref)if(Is=!1,a.pendingProps=g=k,Va(i,w))(i.flags&131072)!==0&&(Is=!0);else return a.lanes=i.lanes,fc(i,a,w)}return zh(i,a,u,g,w)}function rh(i,a,u,g){var w=g.children,k=i!==null?i.memoizedState:null;if(i===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.mode==="hidden"){if((a.flags&128)!==0){if(k=k!==null?k.baseLanes|u:u,i!==null){for(g=a.child=i.child,w=0;g!==null;)w=w|g.lanes|g.childLanes,g=g.sibling;g=w&~k}else g=0,a.child=null;return Wp(i,a,k,u,g)}if((u&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},i!==null&&we(a,k!==null?k.cachePool:null),k!==null?Tr(a,k):Gi(),Mr(a);else return g=a.lanes=536870912,Wp(i,a,k!==null?k.baseLanes|u:u,u,g)}else k!==null?(we(a,k.cachePool),Tr(a,k),ts(),a.memoizedState=null):(i!==null&&we(a,null),Gi(),ts());return Ta(i,a,w,u),a.child}function Cu(i,a){return i!==null&&i.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Wp(i,a,u,g,w){var k=me();return k=k===null?null:{parent:Vi._currentValue,pool:k},a.memoizedState={baseLanes:u,cachePool:k},i!==null&&we(a,null),Gi(),Mr(a),i!==null&&Gs(i,a,g,!0),a.childLanes=w,null}function sh(i,a){return a=Cd({mode:a.mode,children:a.children},i.mode),a.ref=i.ref,i.child=a,a.return=i,a}function Tu(i,a,u){return Ei(a,i.child,null,u),i=sh(a,a.pendingProps),i.flags|=2,xr(a),a.memoizedState=null,i}function b0(i,a,u){var g=a.pendingProps,w=(a.flags&128)!==0;if(a.flags&=-129,i===null){if(Mi){if(g.mode==="hidden")return i=sh(a,g),a.lanes=536870912,Cu(null,i);if(Ii(a),(i=Pr)?(i=v1(i,ls),i=i!==null&&i.data==="&"?i:null,i!==null&&(a.memoizedState={dehydrated:i,treeContext:os!==null?{id:Oa,overflow:vo}:null,retryLane:536870912,hydrationErrors:null},u=kc(i),u.return=a,a.child=u,ra=a,Pr=null)):i=null,i===null)throw tc(a);return a.lanes=536870912,null}return sh(a,g)}var k=i.memoizedState;if(k!==null){var V=k.dehydrated;if(Ii(a),w)if(a.flags&256)a.flags&=-257,a=Tu(i,a,u);else if(a.memoizedState!==null)a.child=i.child,a.flags|=128,a=null;else throw Error(n(558));else if(Is||Gs(i,a,u,!1),w=(u&i.childLanes)!==0,Is||w){if(g=ye,g!==null&&(V=_t(g,u),V!==0&&V!==k.retryLane))throw k.retryLane=V,Fo(i,V),Ul(g,i,V),ih;tg(),a=Tu(i,a,u)}else i=k.treeContext,Pr=Ic(V.nextSibling),ra=a,Mi=!0,Ua=null,ls=!1,i!==null&&Ml(a,i),a=sh(a,g),a.flags|=4096;return a}return i=Ba(i.child,{mode:g.mode,children:g.children}),i.ref=a.ref,a.child=i,i.return=a,i}function ku(i,a){var u=a.ref;if(u===null)i!==null&&i.ref!==null&&(a.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(n(284));(i===null||i.ref!==u)&&(a.flags|=4194816)}}function zh(i,a,u,g,w){return Xs(a),u=jc(i,a,u,g,void 0,w),g=bd(),i!==null&&!Is?(Ud(i,a,w),fc(i,a,w)):(Mi&&g&&yd(a),a.flags|=1,Ta(i,a,u,w),a.child)}function Bh(i,a,u,g,w,k){return Xs(a),a.updateQueue=null,u=gl(a,g,u,w),Nc(i),g=bd(),i!==null&&!Is?(Ud(i,a,k),fc(i,a,k)):(Mi&&g&&yd(a),a.flags|=1,Ta(i,a,u,k),a.child)}function Fh(i,a,u,g,w){if(Xs(a),a.stateNode===null){var k=Rs,V=u.contextType;typeof V=="object"&&V!==null&&(k=tr(V)),k=new u(g,k),a.memoizedState=k.state!==null&&k.state!==void 0?k.state:null,k.updater=Au,a.stateNode=k,k._reactInternals=a,k=a.stateNode,k.props=g,k.state=a.memoizedState,k.refs={},Vt(a),V=u.contextType,k.context=typeof V=="object"&&V!==null?tr(V):Rs,k.state=a.memoizedState,V=u.getDerivedStateFromProps,typeof V=="function"&&(Su(a,u,V,g),k.state=a.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof k.getSnapshotBeforeUpdate=="function"||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(V=k.state,typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount(),V!==k.state&&Au.enqueueReplaceState(k,k.state,null),yr(a,g,k,w),Ai(),k.state=a.memoizedState),typeof k.componentDidMount=="function"&&(a.flags|=4194308),g=!0}else if(i===null){k=a.stateNode;var he=a.memoizedProps,Be=Qc(u,he);k.props=Be;var nt=k.context,vt=u.contextType;V=Rs,typeof vt=="object"&&vt!==null&&(V=tr(vt));var Pt=u.getDerivedStateFromProps;vt=typeof Pt=="function"||typeof k.getSnapshotBeforeUpdate=="function",he=a.pendingProps!==he,vt||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(he||nt!==V)&&Lh(a,k,g,V),en=!1;var rt=a.memoizedState;k.state=rt,yr(a,g,k,w),Ai(),nt=a.memoizedState,he||rt!==nt||en?(typeof Pt=="function"&&(Su(a,u,Pt,g),nt=a.memoizedState),(Be=en||Fp(a,u,Be,g,rt,nt,V))?(vt||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount()),typeof k.componentDidMount=="function"&&(a.flags|=4194308)):(typeof k.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=g,a.memoizedState=nt),k.props=g,k.state=nt,k.context=V,g=Be):(typeof k.componentDidMount=="function"&&(a.flags|=4194308),g=!1)}else{k=a.stateNode,lr(i,a),V=a.memoizedProps,vt=Qc(u,V),k.props=vt,Pt=a.pendingProps,rt=k.context,nt=u.contextType,Be=Rs,typeof nt=="object"&&nt!==null&&(Be=tr(nt)),he=u.getDerivedStateFromProps,(nt=typeof he=="function"||typeof k.getSnapshotBeforeUpdate=="function")||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(V!==Pt||rt!==Be)&&Lh(a,k,g,Be),en=!1,rt=a.memoizedState,k.state=rt,yr(a,g,k,w),Ai();var ft=a.memoizedState;V!==Pt||rt!==ft||en||i!==null&&i.dependencies!==null&&Ys(i.dependencies)?(typeof he=="function"&&(Su(a,u,he,g),ft=a.memoizedState),(vt=en||Fp(a,u,vt,g,rt,ft,Be)||i!==null&&i.dependencies!==null&&Ys(i.dependencies))?(nt||typeof k.UNSAFE_componentWillUpdate!="function"&&typeof k.componentWillUpdate!="function"||(typeof k.componentWillUpdate=="function"&&k.componentWillUpdate(g,ft,Be),typeof k.UNSAFE_componentWillUpdate=="function"&&k.UNSAFE_componentWillUpdate(g,ft,Be)),typeof k.componentDidUpdate=="function"&&(a.flags|=4),typeof k.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof k.componentDidUpdate!="function"||V===i.memoizedProps&&rt===i.memoizedState||(a.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||V===i.memoizedProps&&rt===i.memoizedState||(a.flags|=1024),a.memoizedProps=g,a.memoizedState=ft),k.props=g,k.state=ft,k.context=Be,g=vt):(typeof k.componentDidUpdate!="function"||V===i.memoizedProps&&rt===i.memoizedState||(a.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||V===i.memoizedProps&&rt===i.memoizedState||(a.flags|=1024),g=!1)}return k=g,ku(i,a),g=(a.flags&128)!==0,k||g?(k=a.stateNode,u=g&&typeof u.getDerivedStateFromError!="function"?null:k.render(),a.flags|=1,i!==null&&g?(a.child=Ei(a,i.child,null,w),a.child=Ei(a,null,u,w)):Ta(i,a,u,w),a.memoizedState=k.state,i=a.child):i=fc(i,a,w),i}function $p(i,a,u,g){return ys(),a.flags|=256,Ta(i,a,u,g),a.child}var Df={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Oh(i){return{baseLanes:i,cachePool:Te()}}function Qd(i,a,u){return i=i!==null?i.childLanes&~u:0,a&&(i|=Ue),i}function Uh(i,a,u){var g=a.pendingProps,w=!1,k=(a.flags&128)!==0,V;if((V=k)||(V=i!==null&&i.memoizedState===null?!1:(qi.current&2)!==0),V&&(w=!0,a.flags&=-129),V=(a.flags&32)!==0,a.flags&=-33,i===null){if(Mi){if(w?es(a):ts(),(i=Pr)?(i=v1(i,ls),i=i!==null&&i.data!=="&"?i:null,i!==null&&(a.memoizedState={dehydrated:i,treeContext:os!==null?{id:Oa,overflow:vo}:null,retryLane:536870912,hydrationErrors:null},u=kc(i),u.return=a,a.child=u,ra=a,Pr=null)):i=null,i===null)throw tc(a);return B0(i)?a.lanes=32:a.lanes=536870912,null}var he=g.children;return g=g.fallback,w?(ts(),w=a.mode,he=Cd({mode:"hidden",children:he},w),g=Zl(g,w,u,null),he.return=a,g.return=a,he.sibling=g,a.child=he,g=a.child,g.memoizedState=Oh(u),g.childLanes=Qd(i,V,u),a.memoizedState=Df,Cu(null,g)):(es(a),ed(a,he))}var Be=i.memoizedState;if(Be!==null&&(he=Be.dehydrated,he!==null)){if(k)a.flags&256?(es(a),a.flags&=-257,a=hc(i,a,u)):a.memoizedState!==null?(ts(),a.child=i.child,a.flags|=128,a=null):(ts(),he=g.fallback,w=a.mode,g=Cd({mode:"visible",children:g.children},w),he=Zl(he,w,u,null),he.flags|=2,g.return=a,he.return=a,g.sibling=he,a.child=g,Ei(a,i.child,null,u),g=a.child,g.memoizedState=Oh(u),g.childLanes=Qd(i,V,u),a.memoizedState=Df,a=Cu(null,g));else if(es(a),B0(he)){if(V=he.nextSibling&&he.nextSibling.dataset,V)var nt=V.dgst;V=nt,g=Error(n(419)),g.stack="",g.digest=V,As({value:g,source:null,stack:null}),a=hc(i,a,u)}else if(Is||Gs(i,a,u,!1),V=(u&i.childLanes)!==0,Is||V){if(V=ye,V!==null&&(g=_t(V,u),g!==0&&g!==Be.retryLane))throw Be.retryLane=g,Fo(i,g),Ul(V,i,g),ih;z0(he)||tg(),a=hc(i,a,u)}else z0(he)?(a.flags|=192,a.child=i.child,a=null):(i=Be.treeContext,Pr=Ic(he.nextSibling),ra=a,Mi=!0,Ua=null,ls=!1,i!==null&&Ml(a,i),a=ed(a,g.children),a.flags|=4096);return a}return w?(ts(),he=g.fallback,w=a.mode,Be=i.child,nt=Be.sibling,g=Ba(Be,{mode:"hidden",children:g.children}),g.subtreeFlags=Be.subtreeFlags&65011712,nt!==null?he=Ba(nt,he):(he=Zl(he,w,u,null),he.flags|=2),he.return=a,g.return=a,g.sibling=he,a.child=g,Cu(null,g),g=a.child,he=i.child.memoizedState,he===null?he=Oh(u):(w=he.cachePool,w!==null?(Be=Vi._currentValue,w=w.parent!==Be?{parent:Be,pool:Be}:w):w=Te(),he={baseLanes:he.baseLanes|u,cachePool:w}),g.memoizedState=he,g.childLanes=Qd(i,V,u),a.memoizedState=Df,Cu(i.child,g)):(es(a),u=i.child,i=u.sibling,u=Ba(u,{mode:"visible",children:g.children}),u.return=a,u.sibling=null,i!==null&&(V=a.deletions,V===null?(a.deletions=[i],a.flags|=16):V.push(i)),a.child=u,a.memoizedState=null,u)}function ed(i,a){return a=Cd({mode:"visible",children:a},i.mode),a.return=i,i.child=a}function Cd(i,a){return i=ia(22,i,null,a),i.lanes=0,i}function hc(i,a,u){return Ei(a,i.child,null,u),i=ed(a,a.pendingProps.children),i.flags|=2,a.memoizedState=null,i}function _u(i,a,u){i.lanes|=a;var g=i.alternate;g!==null&&(g.lanes|=a),Sa(i.return,a,u)}function ah(i,a,u,g,w,k){var V=i.memoizedState;V===null?i.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:g,tail:u,tailMode:w,treeForkCount:k}:(V.isBackwards=a,V.rendering=null,V.renderingStartTime=0,V.last=g,V.tail=u,V.tailMode=w,V.treeForkCount=k)}function Hh(i,a,u){var g=a.pendingProps,w=g.revealOrder,k=g.tail;g=g.children;var V=qi.current,he=(V&2)!==0;if(he?(V=V&1|2,a.flags|=128):V&=1,Q(qi,V),Ta(i,a,g,u),g=Mi?md:0,!he&&i!==null&&(i.flags&128)!==0)e:for(i=a.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&_u(i,u,a);else if(i.tag===19)_u(i,u,a);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break e;for(;i.sibling===null;){if(i.return===null||i.return===a)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(w){case"forwards":for(u=a.child,w=null;u!==null;)i=u.alternate,i!==null&&Ls(i)===null&&(w=u),u=u.sibling;u=w,u===null?(w=a.child,a.child=null):(w=u.sibling,u.sibling=null),ah(a,!1,w,u,k,g);break;case"backwards":case"unstable_legacy-backwards":for(u=null,w=a.child,a.child=null;w!==null;){if(i=w.alternate,i!==null&&Ls(i)===null){a.child=w;break}i=w.sibling,w.sibling=u,u=w,w=i}ah(a,!0,u,null,k,g);break;case"together":ah(a,!1,null,null,void 0,g);break;default:a.memoizedState=null}return a.child}function fc(i,a,u){if(i!==null&&(a.dependencies=i.dependencies),qt|=a.lanes,(u&a.childLanes)===0)if(i!==null){if(Gs(i,a,u,!1),(u&a.childLanes)===0)return null}else return null;if(i!==null&&a.child!==i.child)throw Error(n(153));if(a.child!==null){for(i=a.child,u=Ba(i,i.pendingProps),a.child=u,u.return=a;i.sibling!==null;)i=i.sibling,u=u.sibling=Ba(i,i.pendingProps),u.return=a;u.sibling=null}return a.child}function Va(i,a){return(i.lanes&a)!==0?!0:(i=i.dependencies,!!(i!==null&&Ys(i)))}function Lf(i,a,u){switch(a.tag){case 3:Le(a,a.stateNode.containerInfo),$s(a,Vi,i.memoizedState.cache),ys();break;case 27:case 5:Oe(a);break;case 4:Le(a,a.stateNode.containerInfo);break;case 10:$s(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,Ii(a),null;break;case 13:var g=a.memoizedState;if(g!==null)return g.dehydrated!==null?(es(a),a.flags|=128,null):(u&a.child.childLanes)!==0?Uh(i,a,u):(es(a),i=fc(i,a,u),i!==null?i.sibling:null);es(a);break;case 19:var w=(i.flags&128)!==0;if(g=(u&a.childLanes)!==0,g||(Gs(i,a,u,!1),g=(u&a.childLanes)!==0),w){if(g)return Hh(i,a,u);a.flags|=128}if(w=a.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),Q(qi,qi.current),g)break;return null;case 22:return a.lanes=0,rh(i,a,u,a.pendingProps);case 24:$s(a,Vi,i.memoizedState.cache)}return fc(i,a,u)}function Mf(i,a,u){if(i!==null)if(i.memoizedProps!==a.pendingProps)Is=!0;else{if(!Va(i,u)&&(a.flags&128)===0)return Is=!1,Lf(i,a,u);Is=(i.flags&131072)!==0}else Is=!1,Mi&&(a.flags&1048576)!==0&&_c(a,md,a.index);switch(a.lanes=0,a.tag){case 16:e:{var g=a.pendingProps;if(i=Ke(a.elementType),a.type=i,typeof i=="function")gd(i)?(g=Qc(i,g),a.tag=1,a=Fh(null,a,i,g,u)):(a.tag=0,a=zh(null,a,i,g,u));else{if(i!=null){var w=i.$$typeof;if(w===M){a.tag=11,a=Hp(null,a,i,g,u);break e}else if(w===G){a.tag=14,a=Vp(null,a,i,g,u);break e}}throw a=Z(i)||i,Error(n(306,a,""))}}return a;case 0:return zh(i,a,a.type,a.pendingProps,u);case 1:return g=a.type,w=Qc(g,a.pendingProps),Fh(i,a,g,w,u);case 3:e:{if(Le(a,a.stateNode.containerInfo),i===null)throw Error(n(387));g=a.pendingProps;var k=a.memoizedState;w=k.element,lr(i,a),yr(a,g,null,u);var V=a.memoizedState;if(g=V.cache,$s(a,Vi,g),g!==k.cache&&cs(a,[Vi],u,!0),Ai(),g=V.element,k.isDehydrated)if(k={element:g,isDehydrated:!1,cache:V.cache},a.updateQueue.baseState=k,a.memoizedState=k,a.flags&256){a=$p(i,a,g,u);break e}else if(g!==w){w=Fa(Error(n(424)),a),As(w),a=$p(i,a,g,u);break e}else{switch(i=a.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Pr=Ic(i.firstChild),ra=a,Mi=!0,Ua=null,ls=!0,u=Gn(a,null,g,u),a.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(ys(),g===w){a=fc(i,a,u);break e}Ta(i,a,g,u)}a=a.child}return a;case 26:return ku(i,a),i===null?(u=k1(a.type,null,a.pendingProps,null))?a.memoizedState=u:Mi||(u=a.type,i=a.pendingProps,g=lg(xe.current).createElement(u),g[Di]=a,g[Ni]=i,Co(g,u,i),On(g),a.stateNode=g):a.memoizedState=k1(a.type,i.memoizedProps,a.pendingProps,i.memoizedState),null;case 27:return Oe(a),i===null&&Mi&&(g=a.stateNode=A1(a.type,a.pendingProps,xe.current),ra=a,ls=!0,w=Pr,Lu(a.type)?(F0=w,Pr=Ic(g.firstChild)):Pr=w),Ta(i,a,a.pendingProps.children,u),ku(i,a),i===null&&(a.flags|=4194304),a.child;case 5:return i===null&&Mi&&((w=g=Pr)&&(g=lw(g,a.type,a.pendingProps,ls),g!==null?(a.stateNode=g,ra=a,Pr=Ic(g.firstChild),ls=!1,w=!0):w=!1),w||tc(a)),Oe(a),w=a.type,k=a.pendingProps,V=i!==null?i.memoizedProps:null,g=k.children,L0(w,k)?g=null:V!==null&&L0(w,V)&&(a.flags|=32),a.memoizedState!==null&&(w=jc(i,a,Xu,null,null,u),$f._currentValue=w),ku(i,a),Ta(i,a,g,u),a.child;case 6:return i===null&&Mi&&((i=u=Pr)&&(u=cw(u,a.pendingProps,ls),u!==null?(a.stateNode=u,ra=a,Pr=null,i=!0):i=!1),i||tc(a)),null;case 13:return Uh(i,a,u);case 4:return Le(a,a.stateNode.containerInfo),g=a.pendingProps,i===null?a.child=Ei(a,null,g,u):Ta(i,a,g,u),a.child;case 11:return Hp(i,a,a.type,a.pendingProps,u);case 7:return Ta(i,a,a.pendingProps,u),a.child;case 8:return Ta(i,a,a.pendingProps.children,u),a.child;case 12:return Ta(i,a,a.pendingProps.children,u),a.child;case 10:return g=a.pendingProps,$s(a,a.type,g.value),Ta(i,a,g.children,u),a.child;case 9:return w=a.type._context,g=a.pendingProps.children,Xs(a),w=tr(w),g=g(w),a.flags|=1,Ta(i,a,g,u),a.child;case 14:return Vp(i,a,a.type,a.pendingProps,u);case 15:return qp(i,a,a.type,a.pendingProps,u);case 19:return Hh(i,a,u);case 31:return b0(i,a,u);case 22:return rh(i,a,u,a.pendingProps);case 24:return Xs(a),g=tr(Vi),i===null?(w=me(),w===null&&(w=ye,k=sa(),w.pooledCache=k,k.refCount++,k!==null&&(w.pooledCacheLanes|=u),w=k),a.memoizedState={parent:g,cache:w},Vt(a),$s(a,Vi,w)):((i.lanes&u)!==0&&(lr(i,a),yr(a,null,null,u),Ai()),w=i.memoizedState,k=a.memoizedState,w.parent!==g?(w={parent:g,cache:g},a.memoizedState=w,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=w),$s(a,Vi,g)):(g=k.cache,$s(a,Vi,g),g!==w.cache&&cs(a,[Vi],u,!0))),Ta(i,a,a.pendingProps.children,u),a.child;case 29:throw a.pendingProps}throw Error(n(156,a.tag))}function td(i){i.flags|=4}function Vh(i,a,u,g,w){if((a=(i.mode&32)!==0)&&(a=!1),a){if(i.flags|=16777216,(w&335544128)===w)if(i.stateNode.complete)i.flags|=8192;else if(Hy())i.flags|=8192;else throw gt=qe,et}else i.flags&=-16777217}function Gp(i,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!E1(a))if(Hy())i.flags|=8192;else throw gt=qe,et}function oh(i,a){a!==null&&(i.flags|=4),i.flags&16384&&(a=i.tag!==22?Lt():536870912,i.lanes|=a,at|=a)}function ju(i,a){if(!Mi)switch(i.tailMode){case"hidden":a=i.tail;for(var u=null;a!==null;)a.alternate!==null&&(u=a),a=a.sibling;u===null?i.tail=null:u.sibling=null;break;case"collapsed":u=i.tail;for(var g=null;u!==null;)u.alternate!==null&&(g=u),u=u.sibling;g===null?a||i.tail===null?i.tail=null:i.tail.sibling=null:g.sibling=null}}function Rr(i){var a=i.alternate!==null&&i.alternate.child===i.child,u=0,g=0;if(a)for(var w=i.child;w!==null;)u|=w.lanes|w.childLanes,g|=w.subtreeFlags&65011712,g|=w.flags&65011712,w.return=i,w=w.sibling;else for(w=i.child;w!==null;)u|=w.lanes|w.childLanes,g|=w.subtreeFlags,g|=w.flags,w.return=i,w=w.sibling;return i.subtreeFlags|=g,i.childLanes=u,a}function nd(i,a,u){var g=a.pendingProps;switch(ec(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rr(a),null;case 1:return Rr(a),null;case 3:return u=a.stateNode,g=null,i!==null&&(g=i.memoizedState.cache),a.memoizedState.cache!==g&&(a.flags|=2048),Cr(Vi),Ee(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(i===null||i.child===null)&&(Ur(a)?td(a):i===null||i.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,zl())),Rr(a),null;case 26:var w=a.type,k=a.memoizedState;return i===null?(td(a),k!==null?(Rr(a),Gp(a,k)):(Rr(a),Vh(a,w,null,g,u))):k?k!==i.memoizedState?(td(a),Rr(a),Gp(a,k)):(Rr(a),a.flags&=-16777217):(i=i.memoizedProps,i!==g&&td(a),Rr(a),Vh(a,w,i,g,u)),null;case 27:if(Ze(a),u=xe.current,w=a.type,i!==null&&a.stateNode!=null)i.memoizedProps!==g&&td(a);else{if(!g){if(a.stateNode===null)throw Error(n(166));return Rr(a),null}i=ee.current,Ur(a)?hu(a):(i=A1(w,g,u),a.stateNode=i,td(a))}return Rr(a),null;case 5:if(Ze(a),w=a.type,i!==null&&a.stateNode!=null)i.memoizedProps!==g&&td(a);else{if(!g){if(a.stateNode===null)throw Error(n(166));return Rr(a),null}if(k=ee.current,Ur(a))hu(a);else{var V=lg(xe.current);switch(k){case 1:k=V.createElementNS("http://www.w3.org/2000/svg",w);break;case 2:k=V.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;default:switch(w){case"svg":k=V.createElementNS("http://www.w3.org/2000/svg",w);break;case"math":k=V.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;case"script":k=V.createElement("div"),k.innerHTML="<script><\/script>",k=k.removeChild(k.firstChild);break;case"select":k=typeof g.is=="string"?V.createElement("select",{is:g.is}):V.createElement("select"),g.multiple?k.multiple=!0:g.size&&(k.size=g.size);break;default:k=typeof g.is=="string"?V.createElement(w,{is:g.is}):V.createElement(w)}}k[Di]=a,k[Ni]=g;e:for(V=a.child;V!==null;){if(V.tag===5||V.tag===6)k.appendChild(V.stateNode);else if(V.tag!==4&&V.tag!==27&&V.child!==null){V.child.return=V,V=V.child;continue}if(V===a)break e;for(;V.sibling===null;){if(V.return===null||V.return===a)break e;V=V.return}V.sibling.return=V.return,V=V.sibling}a.stateNode=k;e:switch(Co(k,w,g),w){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}g&&td(a)}}return Rr(a),Vh(a,a.type,i===null?null:i.memoizedProps,a.pendingProps,u),null;case 6:if(i&&a.stateNode!=null)i.memoizedProps!==g&&td(a);else{if(typeof g!="string"&&a.stateNode===null)throw Error(n(166));if(i=xe.current,Ur(a)){if(i=a.stateNode,u=a.memoizedProps,g=null,w=ra,w!==null)switch(w.tag){case 27:case 5:g=w.memoizedProps}i[Di]=a,i=!!(i.nodeValue===u||g!==null&&g.suppressHydrationWarning===!0||h1(i.nodeValue,u)),i||tc(a,!0)}else i=lg(i).createTextNode(g),i[Di]=a,a.stateNode=i}return Rr(a),null;case 31:if(u=a.memoizedState,i===null||i.memoizedState!==null){if(g=Ur(a),u!==null){if(i===null){if(!g)throw Error(n(318));if(i=a.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(557));i[Di]=a}else ys(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Rr(a),i=!1}else u=zl(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=u),i=!0;if(!i)return a.flags&256?(xr(a),a):(xr(a),null);if((a.flags&128)!==0)throw Error(n(558))}return Rr(a),null;case 13:if(g=a.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(w=Ur(a),g!==null&&g.dehydrated!==null){if(i===null){if(!w)throw Error(n(318));if(w=a.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(n(317));w[Di]=a}else ys(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Rr(a),w=!1}else w=zl(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=w),w=!0;if(!w)return a.flags&256?(xr(a),a):(xr(a),null)}return xr(a),(a.flags&128)!==0?(a.lanes=u,a):(u=g!==null,i=i!==null&&i.memoizedState!==null,u&&(g=a.child,w=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(w=g.alternate.memoizedState.cachePool.pool),k=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(k=g.memoizedState.cachePool.pool),k!==w&&(g.flags|=2048)),u!==i&&u&&(a.child.flags|=8192),oh(a,a.updateQueue),Rr(a),null);case 4:return Ee(),i===null&&N0(a.stateNode.containerInfo),Rr(a),null;case 10:return Cr(a.type),Rr(a),null;case 19:if(L(qi),g=a.memoizedState,g===null)return Rr(a),null;if(w=(a.flags&128)!==0,k=g.rendering,k===null)if(w)ju(g,!1);else{if(Je!==0||i!==null&&(i.flags&128)!==0)for(i=a.child;i!==null;){if(k=Ls(i),k!==null){for(a.flags|=128,ju(g,!1),i=k.updateQueue,a.updateQueue=i,oh(a,i),a.subtreeFlags=0,i=u,u=a.child;u!==null;)Yc(u,i),u=u.sibling;return Q(qi,qi.current&1|2),Mi&&Ds(a,g.treeForkCount),a.child}i=i.sibling}g.tail!==null&&wt()>zn&&(a.flags|=128,w=!0,ju(g,!1),a.lanes=4194304)}else{if(!w)if(i=Ls(k),i!==null){if(a.flags|=128,w=!0,i=i.updateQueue,a.updateQueue=i,oh(a,i),ju(g,!0),g.tail===null&&g.tailMode==="hidden"&&!k.alternate&&!Mi)return Rr(a),null}else 2*wt()-g.renderingStartTime>zn&&u!==536870912&&(a.flags|=128,w=!0,ju(g,!1),a.lanes=4194304);g.isBackwards?(k.sibling=a.child,a.child=k):(i=g.last,i!==null?i.sibling=k:a.child=k,g.last=k)}return g.tail!==null?(i=g.tail,g.rendering=i,g.tail=i.sibling,g.renderingStartTime=wt(),i.sibling=null,u=qi.current,Q(qi,w?u&1|2:u&1),Mi&&Ds(a,g.treeForkCount),i):(Rr(a),null);case 22:case 23:return xr(a),Cs(),g=a.memoizedState!==null,i!==null?i.memoizedState!==null!==g&&(a.flags|=8192):g&&(a.flags|=8192),g?(u&536870912)!==0&&(a.flags&128)===0&&(Rr(a),a.subtreeFlags&6&&(a.flags|=8192)):Rr(a),u=a.updateQueue,u!==null&&oh(a,u.retryQueue),u=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),g=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(g=a.memoizedState.cachePool.pool),g!==u&&(a.flags|=2048),i!==null&&L(ce),null;case 24:return u=null,i!==null&&(u=i.memoizedState.cache),a.memoizedState.cache!==u&&(a.flags|=2048),Cr(Vi),Rr(a),null;case 25:return null;case 30:return null}throw Error(n(156,a.tag))}function Yp(i,a){switch(ec(a),a.tag){case 1:return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 3:return Cr(Vi),Ee(),i=a.flags,(i&65536)!==0&&(i&128)===0?(a.flags=i&-65537|128,a):null;case 26:case 27:case 5:return Ze(a),null;case 31:if(a.memoizedState!==null){if(xr(a),a.alternate===null)throw Error(n(340));ys()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 13:if(xr(a),i=a.memoizedState,i!==null&&i.dehydrated!==null){if(a.alternate===null)throw Error(n(340));ys()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 19:return L(qi),null;case 4:return Ee(),null;case 10:return Cr(a.type),null;case 22:case 23:return xr(a),Cs(),i!==null&&L(ce),i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 24:return Cr(Vi),null;case 25:return null;default:return null}}function pc(i,a){switch(ec(a),a.tag){case 3:Cr(Vi),Ee();break;case 26:case 27:case 5:Ze(a);break;case 4:Ee();break;case 31:a.memoizedState!==null&&xr(a);break;case 13:xr(a);break;case 19:L(qi);break;case 10:Cr(a.type);break;case 22:case 23:xr(a),Cs(),i!==null&&L(ce);break;case 24:Cr(Vi)}}function Wo(i,a){try{var u=a.updateQueue,g=u!==null?u.lastEffect:null;if(g!==null){var w=g.next;u=w;do{if((u.tag&i)===i){g=void 0;var k=u.create,V=u.inst;g=k(),V.destroy=g}u=u.next}while(u!==w)}}catch(he){Ir(a,a.return,he)}}function id(i,a,u){try{var g=a.updateQueue,w=g!==null?g.lastEffect:null;if(w!==null){var k=w.next;g=k;do{if((g.tag&i)===i){var V=g.inst,he=V.destroy;if(he!==void 0){V.destroy=void 0,w=a;var Be=u,nt=he;try{nt()}catch(vt){Ir(w,Be,vt)}}}g=g.next}while(g!==k)}}catch(vt){Ir(a,a.return,vt)}}function If(i){var a=i.updateQueue;if(a!==null){var u=i.stateNode;try{Vr(a,u)}catch(g){Ir(i,i.return,g)}}}function Ao(i,a,u){u.props=Qc(i.type,i.memoizedProps),u.state=i.memoizedState;try{u.componentWillUnmount()}catch(g){Ir(i,a,g)}}function Lc(i,a){try{var u=i.ref;if(u!==null){switch(i.tag){case 26:case 27:case 5:var g=i.stateNode;break;case 30:g=i.stateNode;break;default:g=i.stateNode}typeof u=="function"?i.refCleanup=u(g):u.current=g}}catch(w){Ir(i,a,w)}}function io(i,a){var u=i.ref,g=i.refCleanup;if(u!==null)if(typeof g=="function")try{g()}catch(w){Ir(i,a,w)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(w){Ir(i,a,w)}else u.current=null}function lh(i){var a=i.type,u=i.memoizedProps,g=i.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":u.autoFocus&&g.focus();break e;case"img":u.src?g.src=u.src:u.srcSet&&(g.srcset=u.srcSet)}}catch(w){Ir(i,i.return,w)}}function ch(i,a,u){try{var g=i.stateNode;nw(g,i.type,u,a),g[Ni]=a}catch(w){Ir(i,i.return,w)}}function Nu(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Lu(i.type)||i.tag===4}function qh(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Nu(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Lu(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function zf(i,a,u){var g=i.tag;if(g===5||g===6)i=i.stateNode,a?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(i,a):(a=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,a.appendChild(i),u=u._reactRootContainer,u!=null||a.onclick!==null||(a.onclick=ho));else if(g!==4&&(g===27&&Lu(i.type)&&(u=i.stateNode,a=null),i=i.child,i!==null))for(zf(i,a,u),i=i.sibling;i!==null;)zf(i,a,u),i=i.sibling}function eu(i,a,u){var g=i.tag;if(g===5||g===6)i=i.stateNode,a?u.insertBefore(i,a):u.appendChild(i);else if(g!==4&&(g===27&&Lu(i.type)&&(u=i.stateNode),i=i.child,i!==null))for(eu(i,a,u),i=i.sibling;i!==null;)eu(i,a,u),i=i.sibling}function dh(i){var a=i.stateNode,u=i.memoizedProps;try{for(var g=i.type,w=a.attributes;w.length;)a.removeAttributeNode(w[0]);Co(a,g,u),a[Di]=i,a[Ni]=u}catch(k){Ir(i,i.return,k)}}var rd=!1,Zs=!1,uh=!1,Pu=typeof WeakSet=="function"?WeakSet:Set,ka=null;function Xp(i,a){if(i=i.containerInfo,R0=gg,i=zo(i),ba(i)){if("selectionStart"in i)var u={start:i.selectionStart,end:i.selectionEnd};else e:{u=(u=i.ownerDocument)&&u.defaultView||window;var g=u.getSelection&&u.getSelection();if(g&&g.rangeCount!==0){u=g.anchorNode;var w=g.anchorOffset,k=g.focusNode;g=g.focusOffset;try{u.nodeType,k.nodeType}catch{u=null;break e}var V=0,he=-1,Be=-1,nt=0,vt=0,Pt=i,rt=null;t:for(;;){for(var ft;Pt!==u||w!==0&&Pt.nodeType!==3||(he=V+w),Pt!==k||g!==0&&Pt.nodeType!==3||(Be=V+g),Pt.nodeType===3&&(V+=Pt.nodeValue.length),(ft=Pt.firstChild)!==null;)rt=Pt,Pt=ft;for(;;){if(Pt===i)break t;if(rt===u&&++nt===w&&(he=V),rt===k&&++vt===g&&(Be=V),(ft=Pt.nextSibling)!==null)break;Pt=rt,rt=Pt.parentNode}Pt=ft}u=he===-1||Be===-1?null:{start:he,end:Be}}else u=null}u=u||{start:0,end:0}}else u=null;for(D0={focusedElem:i,selectionRange:u},gg=!1,ka=a;ka!==null;)if(a=ka,i=a.child,(a.subtreeFlags&1028)!==0&&i!==null)i.return=a,ka=i;else for(;ka!==null;){switch(a=ka,k=a.alternate,i=a.flags,a.tag){case 0:if((i&4)!==0&&(i=a.updateQueue,i=i!==null?i.events:null,i!==null))for(u=0;u<i.length;u++)w=i[u],w.ref.impl=w.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&k!==null){i=void 0,u=a,w=k.memoizedProps,k=k.memoizedState,g=u.stateNode;try{var bn=Qc(u.type,w);i=g.getSnapshotBeforeUpdate(bn,k),g.__reactInternalSnapshotBeforeUpdate=i}catch(Zn){Ir(u,u.return,Zn)}}break;case 3:if((i&1024)!==0){if(i=a.stateNode.containerInfo,u=i.nodeType,u===9)I0(i);else if(u===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":I0(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(n(163))}if(i=a.sibling,i!==null){i.return=a.return,ka=i;break}ka=a.return}}function Wh(i,a,u){var g=u.flags;switch(u.tag){case 0:case 11:case 15:Mc(i,u),g&4&&Wo(5,u);break;case 1:if(Mc(i,u),g&4)if(i=u.stateNode,a===null)try{i.componentDidMount()}catch(V){Ir(u,u.return,V)}else{var w=Qc(u.type,a.memoizedProps);a=a.memoizedState;try{i.componentDidUpdate(w,a,i.__reactInternalSnapshotBeforeUpdate)}catch(V){Ir(u,u.return,V)}}g&64&&If(u),g&512&&Lc(u,u.return);break;case 3:if(Mc(i,u),g&64&&(i=u.updateQueue,i!==null)){if(a=null,u.child!==null)switch(u.child.tag){case 27:case 5:a=u.child.stateNode;break;case 1:a=u.child.stateNode}try{Vr(i,a)}catch(V){Ir(u,u.return,V)}}break;case 27:a===null&&g&4&&dh(u);case 26:case 5:Mc(i,u),a===null&&g&4&&lh(u),g&512&&Lc(u,u.return);break;case 12:Mc(i,u);break;case 31:Mc(i,u),g&4&&Jp(i,u);break;case 13:Mc(i,u),g&4&&Td(i,u),g&64&&(i=u.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(u=qv.bind(null,u),dw(i,u))));break;case 22:if(g=u.memoizedState!==null||rd,!g){a=a!==null&&a.memoizedState!==null||Zs,w=rd;var k=Zs;rd=g,(Zs=a)&&!k?Go(i,u,(u.subtreeFlags&8772)!==0):Mc(i,u),rd=w,Zs=k}break;case 30:break;default:Mc(i,u)}}function Kp(i){var a=i.alternate;a!==null&&(i.alternate=null,Kp(a)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(a=i.stateNode,a!==null&&No(a)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var is=null,ro=!1;function gc(i,a,u){for(u=u.child;u!==null;)Zp(i,a,u),u=u.sibling}function Zp(i,a,u){if(rn&&typeof rn.onCommitFiberUnmount=="function")try{rn.onCommitFiberUnmount(Kt,u)}catch{}switch(u.tag){case 26:Zs||io(u,a),gc(i,a,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:Zs||io(u,a);var g=is,w=ro;Lu(u.type)&&(is=u.stateNode,ro=!1),gc(i,a,u),Vf(u.stateNode),is=g,ro=w;break;case 5:Zs||io(u,a);case 6:if(g=is,w=ro,is=null,gc(i,a,u),is=g,ro=w,is!==null)if(ro)try{(is.nodeType===9?is.body:is.nodeName==="HTML"?is.ownerDocument.body:is).removeChild(u.stateNode)}catch(k){Ir(u,a,k)}else try{is.removeChild(u.stateNode)}catch(k){Ir(u,a,k)}break;case 18:is!==null&&(ro?(i=is,x1(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,u.stateNode),Qh(i)):x1(is,u.stateNode));break;case 4:g=is,w=ro,is=u.stateNode.containerInfo,ro=!0,gc(i,a,u),is=g,ro=w;break;case 0:case 11:case 14:case 15:id(2,u,a),Zs||id(4,u,a),gc(i,a,u);break;case 1:Zs||(io(u,a),g=u.stateNode,typeof g.componentWillUnmount=="function"&&Ao(u,a,g)),gc(i,a,u);break;case 21:gc(i,a,u);break;case 22:Zs=(g=Zs)||u.memoizedState!==null,gc(i,a,u),Zs=g;break;default:gc(i,a,u)}}function Jp(i,a){if(a.memoizedState===null&&(i=a.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{Qh(i)}catch(u){Ir(a,a.return,u)}}}function Td(i,a){if(a.memoizedState===null&&(i=a.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Qh(i)}catch(u){Ir(a,a.return,u)}}function Eu(i){switch(i.tag){case 31:case 13:case 19:var a=i.stateNode;return a===null&&(a=i.stateNode=new Pu),a;case 22:return i=i.stateNode,a=i._retryCache,a===null&&(a=i._retryCache=new Pu),a;default:throw Error(n(435,i.tag))}}function tu(i,a){var u=Eu(i);a.forEach(function(g){if(!u.has(g)){u.add(g);var w=Wv.bind(null,i,g);g.then(w,w)}})}function $o(i,a){var u=a.deletions;if(u!==null)for(var g=0;g<u.length;g++){var w=u[g],k=i,V=a,he=V;e:for(;he!==null;){switch(he.tag){case 27:if(Lu(he.type)){is=he.stateNode,ro=!1;break e}break;case 5:is=he.stateNode,ro=!1;break e;case 3:case 4:is=he.stateNode.containerInfo,ro=!0;break e}he=he.return}if(is===null)throw Error(n(160));Zp(k,V,w),is=null,ro=!1,k=w.alternate,k!==null&&(k.return=null),w.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)$h(a,i),a=a.sibling}var mc=null;function $h(i,a){var u=i.alternate,g=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:$o(a,i),so(i),g&4&&(id(3,i,i.return),Wo(3,i),id(5,i,i.return));break;case 1:$o(a,i),so(i),g&512&&(Zs||u===null||io(u,u.return)),g&64&&rd&&(i=i.updateQueue,i!==null&&(g=i.callbacks,g!==null&&(u=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=u===null?g:u.concat(g))));break;case 26:var w=mc;if($o(a,i),so(i),g&512&&(Zs||u===null||io(u,u.return)),g&4){var k=u!==null?u.memoizedState:null;if(g=i.memoizedState,u===null)if(g===null)if(i.stateNode===null){e:{g=i.type,u=i.memoizedProps,w=w.ownerDocument||w;t:switch(g){case"title":k=w.getElementsByTagName("title")[0],(!k||k[$a]||k[Di]||k.namespaceURI==="http://www.w3.org/2000/svg"||k.hasAttribute("itemprop"))&&(k=w.createElement(g),w.head.insertBefore(k,w.querySelector("head > title"))),Co(k,g,u),k[Di]=i,On(k),g=k;break e;case"link":var V=N1("link","href",w).get(g+(u.href||""));if(V){for(var he=0;he<V.length;he++)if(k=V[he],k.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&k.getAttribute("rel")===(u.rel==null?null:u.rel)&&k.getAttribute("title")===(u.title==null?null:u.title)&&k.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){V.splice(he,1);break t}}k=w.createElement(g),Co(k,g,u),w.head.appendChild(k);break;case"meta":if(V=N1("meta","content",w).get(g+(u.content||""))){for(he=0;he<V.length;he++)if(k=V[he],k.getAttribute("content")===(u.content==null?null:""+u.content)&&k.getAttribute("name")===(u.name==null?null:u.name)&&k.getAttribute("property")===(u.property==null?null:u.property)&&k.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&k.getAttribute("charset")===(u.charSet==null?null:u.charSet)){V.splice(he,1);break t}}k=w.createElement(g),Co(k,g,u),w.head.appendChild(k);break;default:throw Error(n(468,g))}k[Di]=i,On(k),g=k}i.stateNode=g}else P1(w,i.type,i.stateNode);else i.stateNode=j1(w,g,i.memoizedProps);else k!==g?(k===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):k.count--,g===null?P1(w,i.type,i.stateNode):j1(w,g,i.memoizedProps)):g===null&&i.stateNode!==null&&ch(i,i.memoizedProps,u.memoizedProps)}break;case 27:$o(a,i),so(i),g&512&&(Zs||u===null||io(u,u.return)),u!==null&&g&4&&ch(i,i.memoizedProps,u.memoizedProps);break;case 5:if($o(a,i),so(i),g&512&&(Zs||u===null||io(u,u.return)),i.flags&32){w=i.stateNode;try{vs(w,"")}catch(bn){Ir(i,i.return,bn)}}g&4&&i.stateNode!=null&&(w=i.memoizedProps,ch(i,w,u!==null?u.memoizedProps:w)),g&1024&&(uh=!0);break;case 6:if($o(a,i),so(i),g&4){if(i.stateNode===null)throw Error(n(162));g=i.memoizedProps,u=i.stateNode;try{u.nodeValue=g}catch(bn){Ir(i,i.return,bn)}}break;case 3:if(ug=null,w=mc,mc=cg(a.containerInfo),$o(a,i),mc=w,so(i),g&4&&u!==null&&u.memoizedState.isDehydrated)try{Qh(a.containerInfo)}catch(bn){Ir(i,i.return,bn)}uh&&(uh=!1,Bf(i));break;case 4:g=mc,mc=cg(i.stateNode.containerInfo),$o(a,i),so(i),mc=g;break;case 12:$o(a,i),so(i);break;case 31:$o(a,i),so(i),g&4&&(g=i.updateQueue,g!==null&&(i.updateQueue=null,tu(i,g)));break;case 13:$o(a,i),so(i),i.child.flags&8192&&i.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(kn=wt()),g&4&&(g=i.updateQueue,g!==null&&(i.updateQueue=null,tu(i,g)));break;case 22:w=i.memoizedState!==null;var Be=u!==null&&u.memoizedState!==null,nt=rd,vt=Zs;if(rd=nt||w,Zs=vt||Be,$o(a,i),Zs=vt,rd=nt,so(i),g&8192)e:for(a=i.stateNode,a._visibility=w?a._visibility&-2:a._visibility|1,w&&(u===null||Be||rd||Zs||Xt(i)),u=null,a=i;;){if(a.tag===5||a.tag===26){if(u===null){Be=u=a;try{if(k=Be.stateNode,w)V=k.style,typeof V.setProperty=="function"?V.setProperty("display","none","important"):V.display="none";else{he=Be.stateNode;var Pt=Be.memoizedProps.style,rt=Pt!=null&&Pt.hasOwnProperty("display")?Pt.display:null;he.style.display=rt==null||typeof rt=="boolean"?"":(""+rt).trim()}}catch(bn){Ir(Be,Be.return,bn)}}}else if(a.tag===6){if(u===null){Be=a;try{Be.stateNode.nodeValue=w?"":Be.memoizedProps}catch(bn){Ir(Be,Be.return,bn)}}}else if(a.tag===18){if(u===null){Be=a;try{var ft=Be.stateNode;w?b1(ft,!0):b1(Be.stateNode,!1)}catch(bn){Ir(Be,Be.return,bn)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===i)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break e;for(;a.sibling===null;){if(a.return===null||a.return===i)break e;u===a&&(u=null),a=a.return}u===a&&(u=null),a.sibling.return=a.return,a=a.sibling}g&4&&(g=i.updateQueue,g!==null&&(u=g.retryQueue,u!==null&&(g.retryQueue=null,tu(i,u))));break;case 19:$o(a,i),so(i),g&4&&(g=i.updateQueue,g!==null&&(i.updateQueue=null,tu(i,g)));break;case 30:break;case 21:break;default:$o(a,i),so(i)}}function so(i){var a=i.flags;if(a&2){try{for(var u,g=i.return;g!==null;){if(Nu(g)){u=g;break}g=g.return}if(u==null)throw Error(n(160));switch(u.tag){case 27:var w=u.stateNode,k=qh(i);eu(i,k,w);break;case 5:var V=u.stateNode;u.flags&32&&(vs(V,""),u.flags&=-33);var he=qh(i);eu(i,he,V);break;case 3:case 4:var Be=u.stateNode.containerInfo,nt=qh(i);zf(i,nt,Be);break;default:throw Error(n(161))}}catch(vt){Ir(i,i.return,vt)}i.flags&=-3}a&4096&&(i.flags&=-4097)}function Bf(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var a=i;Bf(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),i=i.sibling}}function Mc(i,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Wh(i,a.alternate,a),a=a.sibling}function Xt(i){for(i=i.child;i!==null;){var a=i;switch(a.tag){case 0:case 11:case 14:case 15:id(4,a,a.return),Xt(a);break;case 1:io(a,a.return);var u=a.stateNode;typeof u.componentWillUnmount=="function"&&Ao(a,a.return,u),Xt(a);break;case 27:Vf(a.stateNode);case 26:case 5:io(a,a.return),Xt(a);break;case 22:a.memoizedState===null&&Xt(a);break;case 30:Xt(a);break;default:Xt(a)}i=i.sibling}}function Go(i,a,u){for(u=u&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var g=a.alternate,w=i,k=a,V=k.flags;switch(k.tag){case 0:case 11:case 15:Go(w,k,u),Wo(4,k);break;case 1:if(Go(w,k,u),g=k,w=g.stateNode,typeof w.componentDidMount=="function")try{w.componentDidMount()}catch(nt){Ir(g,g.return,nt)}if(g=k,w=g.updateQueue,w!==null){var he=g.stateNode;try{var Be=w.shared.hiddenCallbacks;if(Be!==null)for(w.shared.hiddenCallbacks=null,w=0;w<Be.length;w++)Hr(Be[w],he)}catch(nt){Ir(g,g.return,nt)}}u&&V&64&&If(k),Lc(k,k.return);break;case 27:dh(k);case 26:case 5:Go(w,k,u),u&&g===null&&V&4&&lh(k),Lc(k,k.return);break;case 12:Go(w,k,u);break;case 31:Go(w,k,u),u&&V&4&&Jp(w,k);break;case 13:Go(w,k,u),u&&V&4&&Td(w,k);break;case 22:k.memoizedState===null&&Go(w,k,u),Lc(k,k.return);break;case 30:break;default:Go(w,k,u)}a=a.sibling}}function hh(i,a){var u=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),i=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(i=a.memoizedState.cachePool.pool),i!==u&&(i!=null&&i.refCount++,u!=null&&Ks(u))}function Ff(i,a){i=null,a.alternate!==null&&(i=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==i&&(a.refCount++,i!=null&&Ks(i))}function yc(i,a,u,g){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Qp(i,a,u,g),a=a.sibling}function Qp(i,a,u,g){var w=a.flags;switch(a.tag){case 0:case 11:case 15:yc(i,a,u,g),w&2048&&Wo(9,a);break;case 1:yc(i,a,u,g);break;case 3:yc(i,a,u,g),w&2048&&(i=null,a.alternate!==null&&(i=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==i&&(a.refCount++,i!=null&&Ks(i)));break;case 12:if(w&2048){yc(i,a,u,g),i=a.stateNode;try{var k=a.memoizedProps,V=k.id,he=k.onPostCommit;typeof he=="function"&&he(V,a.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(Be){Ir(a,a.return,Be)}}else yc(i,a,u,g);break;case 31:yc(i,a,u,g);break;case 13:yc(i,a,u,g);break;case 23:break;case 22:k=a.stateNode,V=a.alternate,a.memoizedState!==null?k._visibility&2?yc(i,a,u,g):C(i,a):k._visibility&2?yc(i,a,u,g):(k._visibility|=2,p(i,a,u,g,(a.subtreeFlags&10256)!==0||!1)),w&2048&&hh(V,a);break;case 24:yc(i,a,u,g),w&2048&&Ff(a.alternate,a);break;default:yc(i,a,u,g)}}function p(i,a,u,g,w){for(w=w&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var k=i,V=a,he=u,Be=g,nt=V.flags;switch(V.tag){case 0:case 11:case 15:p(k,V,he,Be,w),Wo(8,V);break;case 23:break;case 22:var vt=V.stateNode;V.memoizedState!==null?vt._visibility&2?p(k,V,he,Be,w):C(k,V):(vt._visibility|=2,p(k,V,he,Be,w)),w&&nt&2048&&hh(V.alternate,V);break;case 24:p(k,V,he,Be,w),w&&nt&2048&&Ff(V.alternate,V);break;default:p(k,V,he,Be,w)}a=a.sibling}}function C(i,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var u=i,g=a,w=g.flags;switch(g.tag){case 22:C(u,g),w&2048&&hh(g.alternate,g);break;case 24:C(u,g),w&2048&&Ff(g.alternate,g);break;default:C(u,g)}a=a.sibling}}var D=8192;function $(i,a,u){if(i.subtreeFlags&D)for(i=i.child;i!==null;)de(i,a,u),i=i.sibling}function de(i,a,u){switch(i.tag){case 26:$(i,a,u),i.flags&D&&i.memoizedState!==null&&Sw(u,mc,i.memoizedState,i.memoizedProps);break;case 5:$(i,a,u);break;case 3:case 4:var g=mc;mc=cg(i.stateNode.containerInfo),$(i,a,u),mc=g;break;case 22:i.memoizedState===null&&(g=i.alternate,g!==null&&g.memoizedState!==null?(g=D,D=16777216,$(i,a,u),D=g):$(i,a,u));break;default:$(i,a,u)}}function be(i){var a=i.alternate;if(a!==null&&(i=a.child,i!==null)){a.child=null;do a=i.sibling,i.sibling=null,i=a;while(i!==null)}}function z(i){var a=i.deletions;if((i.flags&16)!==0){if(a!==null)for(var u=0;u<a.length;u++){var g=a[u];ka=g,Re(g,i)}be(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Pe(i),i=i.sibling}function Pe(i){switch(i.tag){case 0:case 11:case 15:z(i),i.flags&2048&&id(9,i,i.return);break;case 3:z(i);break;case 12:z(i);break;case 22:var a=i.stateNode;i.memoizedState!==null&&a._visibility&2&&(i.return===null||i.return.tag!==13)?(a._visibility&=-3,ve(i)):z(i);break;default:z(i)}}function ve(i){var a=i.deletions;if((i.flags&16)!==0){if(a!==null)for(var u=0;u<a.length;u++){var g=a[u];ka=g,Re(g,i)}be(i)}for(i=i.child;i!==null;){switch(a=i,a.tag){case 0:case 11:case 15:id(8,a,a.return),ve(a);break;case 22:u=a.stateNode,u._visibility&2&&(u._visibility&=-3,ve(a));break;default:ve(a)}i=i.sibling}}function Re(i,a){for(;ka!==null;){var u=ka;switch(u.tag){case 0:case 11:case 15:id(8,u,a);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var g=u.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:Ks(u.memoizedState.cache)}if(g=u.child,g!==null)g.return=u,ka=g;else e:for(u=i;ka!==null;){g=ka;var w=g.sibling,k=g.return;if(Kp(g),g===u){ka=null;break e}if(w!==null){w.return=k,ka=w;break e}ka=k}}}var je={getCacheForType:function(i){var a=tr(Vi),u=a.data.get(i);return u===void 0&&(u=i(),a.data.set(i,u)),u},cacheSignal:function(){return tr(Vi).controller.signal}},_e=typeof WeakMap=="function"?WeakMap:Map,fe=0,ye=null,pe=null,ge=0,Me=0,De=null,$e=!1,ht=!1,xt=!1,Tt=0,Je=0,qt=0,We=0,Ye=0,Ue=0,at=0,dt=null,Rt=null,tn=!1,kn=0,Yn=0,zn=1/0,Un=null,ii=null,nn=0,It=null,An=null,Oi=0,$r=0,Dr=null,zs=null,us=0,ei=null;function xs(){return(fe&2)!==0&&ge!==0?ge&-ge:ie.T!==null?T0():ci()}function bl(){if(Ue===0)if((ge&536870912)===0||Mi){var i=yn;yn<<=1,(yn&3932160)===0&&(yn=262144),Ue=i}else Ue=536870912;return i=Er.current,i!==null&&(i.flags|=32),Ue}function Ul(i,a,u){(i===ye&&(Me===2||Me===9)||i.cancelPendingCommit!==null)&&(Gh(i,0),Ru(i,ge,Ue,!1)),Et(i,u),((fe&2)===0||i!==ye)&&(i===ye&&((fe&2)===0&&(We|=u),Je===4&&Ru(i,ge,Ue,!1)),kd(i))}function Fy(i,a,u){if((fe&6)!==0)throw Error(n(327));var g=!u&&(a&127)===0&&(a&i.expiredLanes)===0||zi(i,a),w=g?Uv(i,a):w0(i,a,!0),k=g;do{if(w===0){ht&&!g&&Ru(i,a,0,!1);break}else{if(u=i.current.alternate,k&&!Fv(u)){w=w0(i,a,!1),k=!1;continue}if(w===2){if(k=a,i.errorRecoveryDisabledLanes&k)var V=0;else V=i.pendingLanes&-536870913,V=V!==0?V:V&536870912?536870912:0;if(V!==0){a=V;e:{var he=i;w=dt;var Be=he.current.memoizedState.isDehydrated;if(Be&&(Gh(he,V).flags|=256),V=w0(he,V,!1),V!==2){if(xt&&!Be){he.errorRecoveryDisabledLanes|=k,We|=k,w=4;break e}k=Rt,Rt=w,k!==null&&(Rt===null?Rt=k:Rt.push.apply(Rt,k))}w=V}if(k=!1,w!==2)continue}}if(w===1){Gh(i,0),Ru(i,a,0,!0);break}e:{switch(g=i,k=w,k){case 0:case 1:throw Error(n(345));case 4:if((a&4194048)!==a)break;case 6:Ru(g,a,Ue,!$e);break e;case 2:Rt=null;break;case 3:case 5:break;default:throw Error(n(329))}if((a&62914560)===a&&(w=kn+300-wt(),10<w)){if(Ru(g,a,Ue,!$e),Ut(g,0,!0)!==0)break e;Oi=a,g.timeoutHandle=m1(Oy.bind(null,g,u,Rt,Un,tn,a,Ue,We,at,$e,k,"Throttled",-0,0),w);break e}Oy(g,u,Rt,Un,tn,a,Ue,We,at,$e,k,null,-0,0)}}break}while(!0);kd(i)}function Oy(i,a,u,g,w,k,V,he,Be,nt,vt,Pt,rt,ft){if(i.timeoutHandle=-1,Pt=a.subtreeFlags,Pt&8192||(Pt&16785408)===16785408){Pt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ho},de(a,k,Pt);var bn=(k&62914560)===k?kn-wt():(k&4194048)===k?Yn-wt():0;if(bn=Aw(Pt,bn),bn!==null){Oi=k,i.cancelPendingCommit=bn(Yy.bind(null,i,a,k,u,g,w,V,he,Be,vt,Pt,null,rt,ft)),Ru(i,k,V,!nt);return}}Yy(i,a,k,u,g,w,V,he,Be)}function Fv(i){for(var a=i;;){var u=a.tag;if((u===0||u===11||u===15)&&a.flags&16384&&(u=a.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var g=0;g<u.length;g++){var w=u[g],k=w.getSnapshot;w=w.value;try{if(!Es(k(),w))return!1}catch{return!1}}if(u=a.child,a.subtreeFlags&16384&&u!==null)u.return=a,a=u;else{if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Ru(i,a,u,g){a&=~Ye,a&=~We,i.suspendedLanes|=a,i.pingedLanes&=~a,g&&(i.warmLanes|=a),g=i.expirationTimes;for(var w=a;0<w;){var k=31-ot(w),V=1<<k;g[k]=-1,w&=~V}u!==0&&vi(i,u,a)}function eg(){return(fe&6)===0?(Of(0),!1):!0}function v0(){if(pe!==null){if(Me===0)var i=pe.return;else i=pe,Ar=nc=null,gu(i),Nt=null,hn=0,i=pe;for(;i!==null;)pc(i.alternate,i),i=i.return;pe=null}}function Gh(i,a){var u=i.timeoutHandle;u!==-1&&(i.timeoutHandle=-1,sw(u)),u=i.cancelPendingCommit,u!==null&&(i.cancelPendingCommit=null,u()),Oi=0,v0(),ye=i,pe=u=Ba(i.current,null),ge=a,Me=0,De=null,$e=!1,ht=zi(i,a),xt=!1,at=Ue=Ye=We=qt=Je=0,Rt=dt=null,tn=!1,(a&8)!==0&&(a|=a&32);var g=i.entangledLanes;if(g!==0)for(i=i.entanglements,g&=a;0<g;){var w=31-ot(g),k=1<<w;a|=i[w],g&=~k}return Tt=a,Bd(),u}function Uy(i,a){Nn=null,ie.H=Zd,a===Fe||a===ke?(a=ut(),Me=3):a===et?(a=ut(),Me=4):Me=a===ih?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,De=a,pe===null&&(Je=1,Mh(i,Fa(a,i.current)))}function Hy(){var i=Er.current;return i===null?!0:(ge&4194048)===ge?Yi===null:(ge&62914560)===ge||(ge&536870912)!==0?i===Yi:!1}function Vy(){var i=ie.H;return ie.H=Zd,i===null?Zd:i}function qy(){var i=ie.A;return ie.A=je,i}function tg(){Je=4,$e||(ge&4194048)!==ge&&Er.current!==null||(ht=!0),(qt&134217727)===0&&(We&134217727)===0||ye===null||Ru(ye,ge,Ue,!1)}function w0(i,a,u){var g=fe;fe|=2;var w=Vy(),k=qy();(ye!==i||ge!==a)&&(Un=null,Gh(i,a)),a=!1;var V=Je;e:do try{if(Me!==0&&pe!==null){var he=pe,Be=De;switch(Me){case 8:v0(),V=6;break e;case 3:case 2:case 9:case 6:Er.current===null&&(a=!0);var nt=Me;if(Me=0,De=null,Yh(i,he,Be,nt),u&&ht){V=0;break e}break;default:nt=Me,Me=0,De=null,Yh(i,he,Be,nt)}}Ov(),V=Je;break}catch(vt){Uy(i,vt)}while(!0);return a&&i.shellSuspendCounter++,Ar=nc=null,fe=g,ie.H=w,ie.A=k,pe===null&&(ye=null,ge=0,Bd()),V}function Ov(){for(;pe!==null;)Wy(pe)}function Uv(i,a){var u=fe;fe|=2;var g=Vy(),w=qy();ye!==i||ge!==a?(Un=null,zn=wt()+500,Gh(i,a)):ht=zi(i,a);e:do try{if(Me!==0&&pe!==null){a=pe;var k=De;t:switch(Me){case 1:Me=0,De=null,Yh(i,a,k,1);break;case 2:case 9:if(Ge(k)){Me=0,De=null,$y(a);break}a=function(){Me!==2&&Me!==9||ye!==i||(Me=7),kd(i)},k.then(a,a);break e;case 3:Me=7;break e;case 4:Me=5;break e;case 7:Ge(k)?(Me=0,De=null,$y(a)):(Me=0,De=null,Yh(i,a,k,7));break;case 5:var V=null;switch(pe.tag){case 26:V=pe.memoizedState;case 5:case 27:var he=pe;if(V?E1(V):he.stateNode.complete){Me=0,De=null;var Be=he.sibling;if(Be!==null)pe=Be;else{var nt=he.return;nt!==null?(pe=nt,ng(nt)):pe=null}break t}}Me=0,De=null,Yh(i,a,k,5);break;case 6:Me=0,De=null,Yh(i,a,k,6);break;case 8:v0(),Je=6;break e;default:throw Error(n(462))}}Hv();break}catch(vt){Uy(i,vt)}while(!0);return Ar=nc=null,ie.H=g,ie.A=w,fe=u,pe!==null?0:(ye=null,ge=0,Bd(),Je)}function Hv(){for(;pe!==null&&!Ne();)Wy(pe)}function Wy(i){var a=Mf(i.alternate,i,Tt);i.memoizedProps=i.pendingProps,a===null?ng(i):pe=a}function $y(i){var a=i,u=a.alternate;switch(a.tag){case 15:case 0:a=Bh(u,a,a.pendingProps,a.type,void 0,ge);break;case 11:a=Bh(u,a,a.pendingProps,a.type.render,a.ref,ge);break;case 5:gu(a);default:pc(u,a),a=pe=Yc(a,Tt),a=Mf(u,a,Tt)}i.memoizedProps=i.pendingProps,a===null?ng(i):pe=a}function Yh(i,a,u,g){Ar=nc=null,gu(a),Nt=null,hn=0;var w=a.return;try{if(Ad(i,w,a,u,ge)){Je=1,Mh(i,Fa(u,i.current)),pe=null;return}}catch(k){if(w!==null)throw pe=w,k;Je=1,Mh(i,Fa(u,i.current)),pe=null;return}a.flags&32768?(Mi||g===1?i=!0:ht||(ge&536870912)!==0?i=!1:($e=i=!0,(g===2||g===9||g===3||g===6)&&(g=Er.current,g!==null&&g.tag===13&&(g.flags|=16384))),Gy(a,i)):ng(a)}function ng(i){var a=i;do{if((a.flags&32768)!==0){Gy(a,$e);return}i=a.return;var u=nd(a.alternate,a,Tt);if(u!==null){pe=u;return}if(a=a.sibling,a!==null){pe=a;return}pe=a=i}while(a!==null);Je===0&&(Je=5)}function Gy(i,a){do{var u=Yp(i.alternate,i);if(u!==null){u.flags&=32767,pe=u;return}if(u=i.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!a&&(i=i.sibling,i!==null)){pe=i;return}pe=i=u}while(i!==null);Je=6,pe=null}function Yy(i,a,u,g,w,k,V,he,Be){i.cancelPendingCommit=null;do ig();while(nn!==0);if((fe&6)!==0)throw Error(n(327));if(a!==null){if(a===i.current)throw Error(n(177));if(k=a.lanes|a.childLanes,k|=za,ti(i,u,k,V,he,Be),i===ye&&(pe=ye=null,ge=0),An=a,It=i,Oi=u,$r=k,Dr=w,zs=g,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,$v(Qe,function(){return Qy(),null})):(i.callbackNode=null,i.callbackPriority=0),g=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||g){g=ie.T,ie.T=null,w=le.p,le.p=2,V=fe,fe|=4;try{Xp(i,a,u)}finally{fe=V,le.p=w,ie.T=g}}nn=1,Xy(),Ky(),Zy()}}function Xy(){if(nn===1){nn=0;var i=It,a=An,u=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||u){u=ie.T,ie.T=null;var g=le.p;le.p=2;var w=fe;fe|=4;try{$h(a,i);var k=D0,V=zo(i.containerInfo),he=k.focusedElem,Be=k.selectionRange;if(V!==he&&he&&he.ownerDocument&&cl(he.ownerDocument.documentElement,he)){if(Be!==null&&ba(he)){var nt=Be.start,vt=Be.end;if(vt===void 0&&(vt=nt),"selectionStart"in he)he.selectionStart=nt,he.selectionEnd=Math.min(vt,he.value.length);else{var Pt=he.ownerDocument||document,rt=Pt&&Pt.defaultView||window;if(rt.getSelection){var ft=rt.getSelection(),bn=he.textContent.length,Zn=Math.min(Be.start,bn),Yr=Be.end===void 0?Zn:Math.min(Be.end,bn);!ft.extend&&Zn>Yr&&(V=Yr,Yr=Zn,Zn=V);var Xe=eo(he,Zn),He=eo(he,Yr);if(Xe&&He&&(ft.rangeCount!==1||ft.anchorNode!==Xe.node||ft.anchorOffset!==Xe.offset||ft.focusNode!==He.node||ft.focusOffset!==He.offset)){var tt=Pt.createRange();tt.setStart(Xe.node,Xe.offset),ft.removeAllRanges(),Zn>Yr?(ft.addRange(tt),ft.extend(He.node,He.offset)):(tt.setEnd(He.node,He.offset),ft.addRange(tt))}}}}for(Pt=[],ft=he;ft=ft.parentNode;)ft.nodeType===1&&Pt.push({element:ft,left:ft.scrollLeft,top:ft.scrollTop});for(typeof he.focus=="function"&&he.focus(),he=0;he<Pt.length;he++){var kt=Pt[he];kt.element.scrollLeft=kt.left,kt.element.scrollTop=kt.top}}gg=!!R0,D0=R0=null}finally{fe=w,le.p=g,ie.T=u}}i.current=a,nn=2}}function Ky(){if(nn===2){nn=0;var i=It,a=An,u=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||u){u=ie.T,ie.T=null;var g=le.p;le.p=2;var w=fe;fe|=4;try{Wh(i,a.alternate,a)}finally{fe=w,le.p=g,ie.T=u}}nn=3}}function Zy(){if(nn===4||nn===3){nn=0,Ct();var i=It,a=An,u=Oi,g=zs;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?nn=5:(nn=0,An=It=null,Jy(i,i.pendingLanes));var w=i.pendingLanes;if(w===0&&(ii=null),Xn(u),a=a.stateNode,rn&&typeof rn.onCommitFiberRoot=="function")try{rn.onCommitFiberRoot(Kt,a,void 0,(a.current.flags&128)===128)}catch{}if(g!==null){a=ie.T,w=le.p,le.p=2,ie.T=null;try{for(var k=i.onRecoverableError,V=0;V<g.length;V++){var he=g[V];k(he.value,{componentStack:he.stack})}}finally{ie.T=a,le.p=w}}(Oi&3)!==0&&ig(),kd(i),w=i.pendingLanes,(u&261930)!==0&&(w&42)!==0?i===ei?us++:(us=0,ei=i):us=0,Of(0)}}function Jy(i,a){(i.pooledCacheLanes&=a)===0&&(a=i.pooledCache,a!=null&&(i.pooledCache=null,Ks(a)))}function ig(){return Xy(),Ky(),Zy(),Qy()}function Qy(){if(nn!==5)return!1;var i=It,a=$r;$r=0;var u=Xn(Oi),g=ie.T,w=le.p;try{le.p=32>u?32:u,ie.T=null,u=Dr,Dr=null;var k=It,V=Oi;if(nn=0,An=It=null,Oi=0,(fe&6)!==0)throw Error(n(331));var he=fe;if(fe|=4,Pe(k.current),Qp(k,k.current,V,u),fe=he,Of(0,!1),rn&&typeof rn.onPostCommitFiberRoot=="function")try{rn.onPostCommitFiberRoot(Kt,k)}catch{}return!0}finally{le.p=w,ie.T=g,Jy(i,a)}}function e1(i,a,u){a=Fa(u,a),a=Ih(i.stateNode,a,2),i=di(i,a,2),i!==null&&(Et(i,2),kd(i))}function Ir(i,a,u){if(i.tag===3)e1(i,i,u);else for(;a!==null;){if(a.tag===3){e1(a,i,u);break}else if(a.tag===1){var g=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(ii===null||!ii.has(g))){i=Fa(u,i),u=Jd(2),g=di(a,u,2),g!==null&&(Rf(u,g,a,i),Et(g,2),kd(g));break}}a=a.return}}function S0(i,a,u){var g=i.pingCache;if(g===null){g=i.pingCache=new _e;var w=new Set;g.set(a,w)}else w=g.get(a),w===void 0&&(w=new Set,g.set(a,w));w.has(u)||(xt=!0,w.add(u),i=Vv.bind(null,i,a,u),a.then(i,i))}function Vv(i,a,u){var g=i.pingCache;g!==null&&g.delete(a),i.pingedLanes|=i.suspendedLanes&u,i.warmLanes&=~u,ye===i&&(ge&u)===u&&(Je===4||Je===3&&(ge&62914560)===ge&&300>wt()-kn?(fe&2)===0&&Gh(i,0):Ye|=u,at===ge&&(at=0)),kd(i)}function t1(i,a){a===0&&(a=Lt()),i=Fo(i,a),i!==null&&(Et(i,a),kd(i))}function qv(i){var a=i.memoizedState,u=0;a!==null&&(u=a.retryLane),t1(i,u)}function Wv(i,a){var u=0;switch(i.tag){case 31:case 13:var g=i.stateNode,w=i.memoizedState;w!==null&&(u=w.retryLane);break;case 19:g=i.stateNode;break;case 22:g=i.stateNode._retryCache;break;default:throw Error(n(314))}g!==null&&g.delete(a),t1(i,u)}function $v(i,a){return on(i,a)}var rg=null,Xh=null,A0=!1,sg=!1,C0=!1,Du=0;function kd(i){i!==Xh&&i.next===null&&(Xh===null?rg=Xh=i:Xh=Xh.next=i),sg=!0,A0||(A0=!0,Yv())}function Of(i,a){if(!C0&&sg){C0=!0;do for(var u=!1,g=rg;g!==null;){if(i!==0){var w=g.pendingLanes;if(w===0)var k=0;else{var V=g.suspendedLanes,he=g.pingedLanes;k=(1<<31-ot(42|i)+1)-1,k&=w&~(V&~he),k=k&201326741?k&201326741|1:k?k|2:0}k!==0&&(u=!0,s1(g,k))}else k=ge,k=Ut(g,g===ye?k:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(k&3)===0||zi(g,k)||(u=!0,s1(g,k));g=g.next}while(u);C0=!1}}function Gv(){n1()}function n1(){sg=A0=!1;var i=0;Du!==0&&rw()&&(i=Du);for(var a=wt(),u=null,g=rg;g!==null;){var w=g.next,k=i1(g,a);k===0?(g.next=null,u===null?rg=w:u.next=w,w===null&&(Xh=u)):(u=g,(i!==0||(k&3)!==0)&&(sg=!0)),g=w}nn!==0&&nn!==5||Of(i),Du!==0&&(Du=0)}function i1(i,a){for(var u=i.suspendedLanes,g=i.pingedLanes,w=i.expirationTimes,k=i.pendingLanes&-62914561;0<k;){var V=31-ot(k),he=1<<V,Be=w[V];Be===-1?((he&u)===0||(he&g)!==0)&&(w[V]=Jn(he,a)):Be<=a&&(i.expiredLanes|=he),k&=~he}if(a=ye,u=ge,u=Ut(i,i===a?u:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),g=i.callbackNode,u===0||i===a&&(Me===2||Me===9)||i.cancelPendingCommit!==null)return g!==null&&g!==null&&ze(g),i.callbackNode=null,i.callbackPriority=0;if((u&3)===0||zi(i,u)){if(a=u&-u,a===i.callbackPriority)return a;switch(g!==null&&ze(g),Xn(u)){case 2:case 8:u=Ot;break;case 32:u=Qe;break;case 268435456:u=Wt;break;default:u=Qe}return g=r1.bind(null,i),u=on(u,g),i.callbackPriority=a,i.callbackNode=u,a}return g!==null&&g!==null&&ze(g),i.callbackPriority=2,i.callbackNode=null,2}function r1(i,a){if(nn!==0&&nn!==5)return i.callbackNode=null,i.callbackPriority=0,null;var u=i.callbackNode;if(ig()&&i.callbackNode!==u)return null;var g=ge;return g=Ut(i,i===ye?g:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),g===0?null:(Fy(i,g,a),i1(i,wt()),i.callbackNode!=null&&i.callbackNode===u?r1.bind(null,i):null)}function s1(i,a){if(ig())return null;Fy(i,a,!0)}function Yv(){aw(function(){(fe&6)!==0?on(pt,Gv):n1()})}function T0(){if(Du===0){var i=x;i===0&&(i=Jt,Jt<<=1,(Jt&261888)===0&&(Jt=256)),Du=i}return Du}function a1(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Kr(""+i)}function o1(i,a){var u=a.ownerDocument.createElement("input");return u.name=a.name,u.value=a.value,i.id&&u.setAttribute("form",i.id),a.parentNode.insertBefore(u,a),i=new FormData(i),u.parentNode.removeChild(u),i}function Xv(i,a,u,g,w){if(a==="submit"&&u&&u.stateNode===w){var k=a1((w[Ni]||null).action),V=g.submitter;V&&(a=(a=V[Ni]||null)?a1(a.formAction):V.getAttribute("formAction"),a!==null&&(k=a,V=null));var he=new Xa("action","action",null,g,w);i.push({event:he,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(Du!==0){var Be=V?o1(w,V):new FormData(w);Ju(u,{pending:!0,data:Be,method:w.method,action:k},null,Be)}}else typeof k=="function"&&(he.preventDefault(),Be=V?o1(w,V):new FormData(w),Ju(u,{pending:!0,data:Be,method:w.method,action:k},k,Be))},currentTarget:w}]})}}for(var k0=0;k0<Rl.length;k0++){var _0=Rl[k0],Kv=_0.toLowerCase(),Zv=_0[0].toUpperCase()+_0.slice(1);br(Kv,"on"+Zv)}br(gs,"onAnimationEnd"),br(wa,"onAnimationIteration"),br(Nl,"onAnimationStart"),br("dblclick","onDoubleClick"),br("focusin","onFocus"),br("focusout","onBlur"),br(ul,"onTransitionRun"),br(Pl,"onTransitionStart"),br(Kl,"onTransitionCancel"),br(El,"onTransitionEnd"),Ea("onMouseEnter",["mouseout","mouseover"]),Ea("onMouseLeave",["mouseout","mouseover"]),Ea("onPointerEnter",["pointerout","pointerover"]),Ea("onPointerLeave",["pointerout","pointerover"]),fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fa("onBeforeInput",["compositionend","keypress","textInput","paste"]),fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Uf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Jv=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Uf));function l1(i,a){a=(a&4)!==0;for(var u=0;u<i.length;u++){var g=i[u],w=g.event;g=g.listeners;e:{var k=void 0;if(a)for(var V=g.length-1;0<=V;V--){var he=g[V],Be=he.instance,nt=he.currentTarget;if(he=he.listener,Be!==k&&w.isPropagationStopped())break e;k=he,w.currentTarget=nt;try{k(w)}catch(vt){Pi(vt)}w.currentTarget=null,k=Be}else for(V=0;V<g.length;V++){if(he=g[V],Be=he.instance,nt=he.currentTarget,he=he.listener,Be!==k&&w.isPropagationStopped())break e;k=he,w.currentTarget=nt;try{k(w)}catch(vt){Pi(vt)}w.currentTarget=null,k=Be}}}}function Xi(i,a){var u=a[ha];u===void 0&&(u=a[ha]=new Set);var g=i+"__bubble";u.has(g)||(c1(a,i,2,!1),u.add(g))}function j0(i,a,u){var g=0;a&&(g|=4),c1(u,i,g,a)}var ag="_reactListening"+Math.random().toString(36).slice(2);function N0(i){if(!i[ag]){i[ag]=!0,Qo.forEach(function(u){u!=="selectionchange"&&(Jv.has(u)||j0(u,!1,i),j0(u,!0,i))});var a=i.nodeType===9?i:i.ownerDocument;a===null||a[ag]||(a[ag]=!0,j0("selectionchange",!1,a))}}function c1(i,a,u,g){switch(B1(a)){case 2:var w=kw;break;case 8:w=_w;break;default:w=q0}u=w.bind(null,a,u,i),w=void 0,!jn||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(w=!0),g?w!==void 0?i.addEventListener(a,u,{capture:!0,passive:w}):i.addEventListener(a,u,!0):w!==void 0?i.addEventListener(a,u,{passive:w}):i.addEventListener(a,u,!1)}function P0(i,a,u,g,w){var k=g;if((a&1)===0&&(a&2)===0&&g!==null)e:for(;;){if(g===null)return;var V=g.tag;if(V===3||V===4){var he=g.stateNode.containerInfo;if(he===w)break;if(V===4)for(V=g.return;V!==null;){var Be=V.tag;if((Be===3||Be===4)&&V.stateNode.containerInfo===w)return;V=V.return}for(;he!==null;){if(V=Qn(he),V===null)return;if(Be=V.tag,Be===5||Be===6||Be===26||Be===27){g=k=V;continue e}he=he.parentNode}}g=g.return}Gc(function(){var nt=k,vt=or(u),Pt=[];e:{var rt=to.get(i);if(rt!==void 0){var ft=Xa,bn=i;switch(i){case"keypress":if(Gt(u)===0)break e;case"keydown":case"keyup":ft=_i;break;case"focusin":bn="focus",ft=wn;break;case"focusout":bn="blur",ft=wn;break;case"beforeblur":case"afterblur":ft=wn;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ft=Yl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ft=Eo;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ft=Ui;break;case gs:case wa:case Nl:ft=j;break;case El:ft=hr;break;case"scroll":case"scrollend":ft=rl;break;case"wheel":ft=Ps;break;case"copy":case"cut":case"paste":ft=Se;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ft=Fi;break;case"toggle":case"beforetoggle":ft=ws}var Zn=(a&4)!==0,Yr=!Zn&&(i==="scroll"||i==="scrollend"),Xe=Zn?rt!==null?rt+"Capture":null:rt;Zn=[];for(var He=nt,tt;He!==null;){var kt=He;if(tt=kt.stateNode,kt=kt.tag,kt!==5&&kt!==26&&kt!==27||tt===null||Xe===null||(kt=ga(He,Xe),kt!=null&&Zn.push(Hf(He,kt,tt))),Yr)break;He=He.return}0<Zn.length&&(rt=new ft(rt,bn,null,u,vt),Pt.push({event:rt,listeners:Zn}))}}if((a&7)===0){e:{if(rt=i==="mouseover"||i==="pointerover",ft=i==="mouseout"||i==="pointerout",rt&&u!==ur&&(bn=u.relatedTarget||u.fromElement)&&(Qn(bn)||bn[Ns]))break e;if((ft||rt)&&(rt=vt.window===vt?vt:(rt=vt.ownerDocument)?rt.defaultView||rt.parentWindow:window,ft?(bn=u.relatedTarget||u.toElement,ft=nt,bn=bn?Qn(bn):null,bn!==null&&(Yr=o(bn),Zn=bn.tag,bn!==Yr||Zn!==5&&Zn!==27&&Zn!==6)&&(bn=null)):(ft=null,bn=nt),ft!==bn)){if(Zn=Yl,kt="onMouseLeave",Xe="onMouseEnter",He="mouse",(i==="pointerout"||i==="pointerover")&&(Zn=Fi,kt="onPointerLeave",Xe="onPointerEnter",He="pointer"),Yr=ft==null?rt:Ti(ft),tt=bn==null?rt:Ti(bn),rt=new Zn(kt,He+"leave",ft,u,vt),rt.target=Yr,rt.relatedTarget=tt,kt=null,Qn(vt)===nt&&(Zn=new Zn(Xe,He+"enter",bn,u,vt),Zn.target=tt,Zn.relatedTarget=Yr,kt=Zn),Yr=kt,ft&&bn)t:{for(Zn=Qv,Xe=ft,He=bn,tt=0,kt=Xe;kt;kt=Zn(kt))tt++;kt=0;for(var Hn=He;Hn;Hn=Zn(Hn))kt++;for(;0<tt-kt;)Xe=Zn(Xe),tt--;for(;0<kt-tt;)He=Zn(He),kt--;for(;tt--;){if(Xe===He||He!==null&&Xe===He.alternate){Zn=Xe;break t}Xe=Zn(Xe),He=Zn(He)}Zn=null}else Zn=null;ft!==null&&d1(Pt,rt,ft,Zn,!1),bn!==null&&Yr!==null&&d1(Pt,Yr,bn,Zn,!0)}}e:{if(rt=nt?Ti(nt):window,ft=rt.nodeName&&rt.nodeName.toLowerCase(),ft==="select"||ft==="input"&&rt.type==="file")var wr=mo;else if(Lo(rt))if(xa)wr=Ma;else{wr=jr;var Rn=fr}else ft=rt.nodeName,!ft||ft.toLowerCase()!=="input"||rt.type!=="checkbox"&&rt.type!=="radio"?nt&&$i(nt.elementType)&&(wr=mo):wr=fd;if(wr&&(wr=wr(i,nt))){ya(Pt,wr,u,vt);break e}Rn&&Rn(i,rt,nt),i==="focusout"&&nt&&rt.type==="number"&&nt.memoizedProps.value!=null&&ta(rt,"number",rt.value)}switch(Rn=nt?Ti(nt):window,i){case"focusin":(Lo(Rn)||Rn.contentEditable==="true")&&(Ia=Rn,Bo=nt,va=null);break;case"focusout":va=Bo=Ia=null;break;case"mousedown":yo=!0;break;case"contextmenu":case"mouseup":case"dragend":yo=!1,er(Pt,u,vt);break;case"selectionchange":if(Ws)break;case"keydown":case"keyup":er(Pt,u,vt)}var Ri;if(Or)e:{switch(i){case"compositionstart":var Ji="onCompositionStart";break e;case"compositionend":Ji="onCompositionEnd";break e;case"compositionupdate":Ji="onCompositionUpdate";break e}Ji=void 0}else Ja?Cc(i,u)&&(Ji="onCompositionEnd"):i==="keydown"&&u.keyCode===229&&(Ji="onCompositionStart");Ji&&(Za&&u.locale!=="ko"&&(Ja||Ji!=="onCompositionStart"?Ji==="onCompositionEnd"&&Ja&&(Ri=du()):(pn=vt,hi="value"in pn?pn.value:pn.textContent,Ja=!0)),Rn=og(nt,Ji),0<Rn.length&&(Ji=new Ve(Ji,i,null,u,vt),Pt.push({event:Ji,listeners:Rn}),Ri?Ji.data=Ri:(Ri=hd(u),Ri!==null&&(Ji.data=Ri)))),(Ri=Ss?qs(i,u):Do(i,u))&&(Ji=og(nt,"onBeforeInput"),0<Ji.length&&(Rn=new Ve("onBeforeInput","beforeinput",null,u,vt),Pt.push({event:Rn,listeners:Ji}),Rn.data=Ri)),Xv(Pt,i,nt,u,vt)}l1(Pt,a)})}function Hf(i,a,u){return{instance:i,listener:a,currentTarget:u}}function og(i,a){for(var u=a+"Capture",g=[];i!==null;){var w=i,k=w.stateNode;if(w=w.tag,w!==5&&w!==26&&w!==27||k===null||(w=ga(i,u),w!=null&&g.unshift(Hf(i,w,k)),w=ga(i,a),w!=null&&g.push(Hf(i,w,k))),i.tag===3)return g;i=i.return}return[]}function Qv(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function d1(i,a,u,g,w){for(var k=a._reactName,V=[];u!==null&&u!==g;){var he=u,Be=he.alternate,nt=he.stateNode;if(he=he.tag,Be!==null&&Be===g)break;he!==5&&he!==26&&he!==27||nt===null||(Be=nt,w?(nt=ga(u,k),nt!=null&&V.unshift(Hf(u,nt,Be))):w||(nt=ga(u,k),nt!=null&&V.push(Hf(u,nt,Be)))),u=u.return}V.length!==0&&i.push({event:a,listeners:V})}var ew=/\r\n?/g,tw=/\u0000|\uFFFD/g;function u1(i){return(typeof i=="string"?i:""+i).replace(ew,`
`).replace(tw,"")}function h1(i,a){return a=u1(a),u1(i)===a}function Gr(i,a,u,g,w,k){switch(u){case"children":typeof g=="string"?a==="body"||a==="textarea"&&g===""||vs(i,g):(typeof g=="number"||typeof g=="bigint")&&a!=="body"&&vs(i,""+g);break;case"className":nl(i,"class",g);break;case"tabIndex":nl(i,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":nl(i,u,g);break;case"style":zt(i,g,k);break;case"data":if(a!=="object"){nl(i,"data",g);break}case"src":case"href":if(g===""&&(a!=="a"||u!=="href")){i.removeAttribute(u);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){i.removeAttribute(u);break}g=Kr(""+g),i.setAttribute(u,g);break;case"action":case"formAction":if(typeof g=="function"){i.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof k=="function"&&(u==="formAction"?(a!=="input"&&Gr(i,a,"name",w.name,w,null),Gr(i,a,"formEncType",w.formEncType,w,null),Gr(i,a,"formMethod",w.formMethod,w,null),Gr(i,a,"formTarget",w.formTarget,w,null)):(Gr(i,a,"encType",w.encType,w,null),Gr(i,a,"method",w.method,w,null),Gr(i,a,"target",w.target,w,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){i.removeAttribute(u);break}g=Kr(""+g),i.setAttribute(u,g);break;case"onClick":g!=null&&(i.onclick=ho);break;case"onScroll":g!=null&&Xi("scroll",i);break;case"onScrollEnd":g!=null&&Xi("scrollend",i);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(n(61));if(u=g.__html,u!=null){if(w.children!=null)throw Error(n(60));i.innerHTML=u}}break;case"multiple":i.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":i.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){i.removeAttribute("xlink:href");break}u=Kr(""+g),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?i.setAttribute(u,""+g):i.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?i.setAttribute(u,""):i.removeAttribute(u);break;case"capture":case"download":g===!0?i.setAttribute(u,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?i.setAttribute(u,g):i.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?i.setAttribute(u,g):i.removeAttribute(u);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?i.removeAttribute(u):i.setAttribute(u,g);break;case"popover":Xi("beforetoggle",i),Xi("toggle",i),dr(i,"popover",g);break;case"xlinkActuate":$n(i,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":$n(i,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":$n(i,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":$n(i,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":$n(i,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":$n(i,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":$n(i,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":$n(i,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":$n(i,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":dr(i,"is",g);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=uo.get(u)||u,dr(i,u,g))}}function E0(i,a,u,g,w,k){switch(u){case"style":zt(i,g,k);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(n(61));if(u=g.__html,u!=null){if(w.children!=null)throw Error(n(60));i.innerHTML=u}}break;case"children":typeof g=="string"?vs(i,g):(typeof g=="number"||typeof g=="bigint")&&vs(i,""+g);break;case"onScroll":g!=null&&Xi("scroll",i);break;case"onScrollEnd":g!=null&&Xi("scrollend",i);break;case"onClick":g!=null&&(i.onclick=ho);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!wi.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(w=u.endsWith("Capture"),a=u.slice(2,w?u.length-7:void 0),k=i[Ni]||null,k=k!=null?k[u]:null,typeof k=="function"&&i.removeEventListener(a,k,w),typeof g=="function")){typeof k!="function"&&k!==null&&(u in i?i[u]=null:i.hasAttribute(u)&&i.removeAttribute(u)),i.addEventListener(a,g,w);break e}u in i?i[u]=g:g===!0?i.setAttribute(u,""):dr(i,u,g)}}}function Co(i,a,u){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Xi("error",i),Xi("load",i);var g=!1,w=!1,k;for(k in u)if(u.hasOwnProperty(k)){var V=u[k];if(V!=null)switch(k){case"src":g=!0;break;case"srcSet":w=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:Gr(i,a,k,V,u,null)}}w&&Gr(i,a,"srcSet",u.srcSet,u,null),g&&Gr(i,a,"src",u.src,u,null);return;case"input":Xi("invalid",i);var he=k=V=w=null,Be=null,nt=null;for(g in u)if(u.hasOwnProperty(g)){var vt=u[g];if(vt!=null)switch(g){case"name":w=vt;break;case"type":V=vt;break;case"checked":Be=vt;break;case"defaultChecked":nt=vt;break;case"value":k=vt;break;case"defaultValue":he=vt;break;case"children":case"dangerouslySetInnerHTML":if(vt!=null)throw Error(n(137,a));break;default:Gr(i,a,g,vt,u,null)}}$c(i,k,he,Be,nt,V,w,!1);return;case"select":Xi("invalid",i),g=V=k=null;for(w in u)if(u.hasOwnProperty(w)&&(he=u[w],he!=null))switch(w){case"value":k=he;break;case"defaultValue":V=he;break;case"multiple":g=he;default:Gr(i,a,w,he,u,null)}a=k,u=V,i.multiple=!!g,a!=null?Hs(i,!!g,a,!1):u!=null&&Hs(i,!!g,u,!0);return;case"textarea":Xi("invalid",i),k=w=g=null;for(V in u)if(u.hasOwnProperty(V)&&(he=u[V],he!=null))switch(V){case"value":g=he;break;case"defaultValue":w=he;break;case"children":k=he;break;case"dangerouslySetInnerHTML":if(he!=null)throw Error(n(91));break;default:Gr(i,a,V,he,u,null)}pa(i,g,w,k);return;case"option":for(Be in u)if(u.hasOwnProperty(Be)&&(g=u[Be],g!=null))switch(Be){case"selected":i.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:Gr(i,a,Be,g,u,null)}return;case"dialog":Xi("beforetoggle",i),Xi("toggle",i),Xi("cancel",i),Xi("close",i);break;case"iframe":case"object":Xi("load",i);break;case"video":case"audio":for(g=0;g<Uf.length;g++)Xi(Uf[g],i);break;case"image":Xi("error",i),Xi("load",i);break;case"details":Xi("toggle",i);break;case"embed":case"source":case"link":Xi("error",i),Xi("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(nt in u)if(u.hasOwnProperty(nt)&&(g=u[nt],g!=null))switch(nt){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:Gr(i,a,nt,g,u,null)}return;default:if($i(a)){for(vt in u)u.hasOwnProperty(vt)&&(g=u[vt],g!==void 0&&E0(i,a,vt,g,u,void 0));return}}for(he in u)u.hasOwnProperty(he)&&(g=u[he],g!=null&&Gr(i,a,he,g,u,null))}function nw(i,a,u,g){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var w=null,k=null,V=null,he=null,Be=null,nt=null,vt=null;for(ft in u){var Pt=u[ft];if(u.hasOwnProperty(ft)&&Pt!=null)switch(ft){case"checked":break;case"value":break;case"defaultValue":Be=Pt;default:g.hasOwnProperty(ft)||Gr(i,a,ft,null,g,Pt)}}for(var rt in g){var ft=g[rt];if(Pt=u[rt],g.hasOwnProperty(rt)&&(ft!=null||Pt!=null))switch(rt){case"type":k=ft;break;case"name":w=ft;break;case"checked":nt=ft;break;case"defaultChecked":vt=ft;break;case"value":V=ft;break;case"defaultValue":he=ft;break;case"children":case"dangerouslySetInnerHTML":if(ft!=null)throw Error(n(137,a));break;default:ft!==Pt&&Gr(i,a,rt,ft,g,Pt)}}Fr(i,V,he,Be,nt,vt,k,w);return;case"select":ft=V=he=rt=null;for(k in u)if(Be=u[k],u.hasOwnProperty(k)&&Be!=null)switch(k){case"value":break;case"multiple":ft=Be;default:g.hasOwnProperty(k)||Gr(i,a,k,null,g,Be)}for(w in g)if(k=g[w],Be=u[w],g.hasOwnProperty(w)&&(k!=null||Be!=null))switch(w){case"value":rt=k;break;case"defaultValue":he=k;break;case"multiple":V=k;default:k!==Be&&Gr(i,a,w,k,g,Be)}a=he,u=V,g=ft,rt!=null?Hs(i,!!u,rt,!1):!!g!=!!u&&(a!=null?Hs(i,!!u,a,!0):Hs(i,!!u,u?[]:"",!1));return;case"textarea":ft=rt=null;for(he in u)if(w=u[he],u.hasOwnProperty(he)&&w!=null&&!g.hasOwnProperty(he))switch(he){case"value":break;case"children":break;default:Gr(i,a,he,null,g,w)}for(V in g)if(w=g[V],k=u[V],g.hasOwnProperty(V)&&(w!=null||k!=null))switch(V){case"value":rt=w;break;case"defaultValue":ft=w;break;case"children":break;case"dangerouslySetInnerHTML":if(w!=null)throw Error(n(91));break;default:w!==k&&Gr(i,a,V,w,g,k)}Gl(i,rt,ft);return;case"option":for(var bn in u)if(rt=u[bn],u.hasOwnProperty(bn)&&rt!=null&&!g.hasOwnProperty(bn))switch(bn){case"selected":i.selected=!1;break;default:Gr(i,a,bn,null,g,rt)}for(Be in g)if(rt=g[Be],ft=u[Be],g.hasOwnProperty(Be)&&rt!==ft&&(rt!=null||ft!=null))switch(Be){case"selected":i.selected=rt&&typeof rt!="function"&&typeof rt!="symbol";break;default:Gr(i,a,Be,rt,g,ft)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Zn in u)rt=u[Zn],u.hasOwnProperty(Zn)&&rt!=null&&!g.hasOwnProperty(Zn)&&Gr(i,a,Zn,null,g,rt);for(nt in g)if(rt=g[nt],ft=u[nt],g.hasOwnProperty(nt)&&rt!==ft&&(rt!=null||ft!=null))switch(nt){case"children":case"dangerouslySetInnerHTML":if(rt!=null)throw Error(n(137,a));break;default:Gr(i,a,nt,rt,g,ft)}return;default:if($i(a)){for(var Yr in u)rt=u[Yr],u.hasOwnProperty(Yr)&&rt!==void 0&&!g.hasOwnProperty(Yr)&&E0(i,a,Yr,void 0,g,rt);for(vt in g)rt=g[vt],ft=u[vt],!g.hasOwnProperty(vt)||rt===ft||rt===void 0&&ft===void 0||E0(i,a,vt,rt,g,ft);return}}for(var Xe in u)rt=u[Xe],u.hasOwnProperty(Xe)&&rt!=null&&!g.hasOwnProperty(Xe)&&Gr(i,a,Xe,null,g,rt);for(Pt in g)rt=g[Pt],ft=u[Pt],!g.hasOwnProperty(Pt)||rt===ft||rt==null&&ft==null||Gr(i,a,Pt,rt,g,ft)}function f1(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function iw(){if(typeof performance.getEntriesByType=="function"){for(var i=0,a=0,u=performance.getEntriesByType("resource"),g=0;g<u.length;g++){var w=u[g],k=w.transferSize,V=w.initiatorType,he=w.duration;if(k&&he&&f1(V)){for(V=0,he=w.responseEnd,g+=1;g<u.length;g++){var Be=u[g],nt=Be.startTime;if(nt>he)break;var vt=Be.transferSize,Pt=Be.initiatorType;vt&&f1(Pt)&&(Be=Be.responseEnd,V+=vt*(Be<he?1:(he-nt)/(Be-nt)))}if(--g,a+=8*(k+V)/(w.duration/1e3),i++,10<i)break}}if(0<i)return a/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var R0=null,D0=null;function lg(i){return i.nodeType===9?i:i.ownerDocument}function p1(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function g1(i,a){if(i===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&a==="foreignObject"?0:i}function L0(i,a){return i==="textarea"||i==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var M0=null;function rw(){var i=window.event;return i&&i.type==="popstate"?i===M0?!1:(M0=i,!0):(M0=null,!1)}var m1=typeof setTimeout=="function"?setTimeout:void 0,sw=typeof clearTimeout=="function"?clearTimeout:void 0,y1=typeof Promise=="function"?Promise:void 0,aw=typeof queueMicrotask=="function"?queueMicrotask:typeof y1<"u"?function(i){return y1.resolve(null).then(i).catch(ow)}:m1;function ow(i){setTimeout(function(){throw i})}function Lu(i){return i==="head"}function x1(i,a){var u=a,g=0;do{var w=u.nextSibling;if(i.removeChild(u),w&&w.nodeType===8)if(u=w.data,u==="/$"||u==="/&"){if(g===0){i.removeChild(w),Qh(a);return}g--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")g++;else if(u==="html")Vf(i.ownerDocument.documentElement);else if(u==="head"){u=i.ownerDocument.head,Vf(u);for(var k=u.firstChild;k;){var V=k.nextSibling,he=k.nodeName;k[$a]||he==="SCRIPT"||he==="STYLE"||he==="LINK"&&k.rel.toLowerCase()==="stylesheet"||u.removeChild(k),k=V}}else u==="body"&&Vf(i.ownerDocument.body);u=w}while(u);Qh(a)}function b1(i,a){var u=i;i=0;do{var g=u.nextSibling;if(u.nodeType===1?a?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(a?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),g&&g.nodeType===8)if(u=g.data,u==="/$"){if(i===0)break;i--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||i++;u=g}while(u)}function I0(i){var a=i.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var u=a;switch(a=a.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":I0(u),No(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}i.removeChild(u)}}function lw(i,a,u,g){for(;i.nodeType===1;){var w=u;if(i.nodeName.toLowerCase()!==a.toLowerCase()){if(!g&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(g){if(!i[$a])switch(a){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(k=i.getAttribute("rel"),k==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(k!==w.rel||i.getAttribute("href")!==(w.href==null||w.href===""?null:w.href)||i.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin)||i.getAttribute("title")!==(w.title==null?null:w.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(k=i.getAttribute("src"),(k!==(w.src==null?null:w.src)||i.getAttribute("type")!==(w.type==null?null:w.type)||i.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin))&&k&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(a==="input"&&i.type==="hidden"){var k=w.name==null?null:""+w.name;if(w.type==="hidden"&&i.getAttribute("name")===k)return i}else return i;if(i=Ic(i.nextSibling),i===null)break}return null}function cw(i,a,u){if(a==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!u||(i=Ic(i.nextSibling),i===null))return null;return i}function v1(i,a){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!a||(i=Ic(i.nextSibling),i===null))return null;return i}function z0(i){return i.data==="$?"||i.data==="$~"}function B0(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function dw(i,a){var u=i.ownerDocument;if(i.data==="$~")i._reactRetry=a;else if(i.data!=="$?"||u.readyState!=="loading")a();else{var g=function(){a(),u.removeEventListener("DOMContentLoaded",g)};u.addEventListener("DOMContentLoaded",g),i._reactRetry=g}}function Ic(i){for(;i!=null;i=i.nextSibling){var a=i.nodeType;if(a===1||a===3)break;if(a===8){if(a=i.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return i}var F0=null;function w1(i){i=i.nextSibling;for(var a=0;i;){if(i.nodeType===8){var u=i.data;if(u==="/$"||u==="/&"){if(a===0)return Ic(i.nextSibling);a--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||a++}i=i.nextSibling}return null}function S1(i){i=i.previousSibling;for(var a=0;i;){if(i.nodeType===8){var u=i.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(a===0)return i;a--}else u!=="/$"&&u!=="/&"||a++}i=i.previousSibling}return null}function A1(i,a,u){switch(a=lg(u),i){case"html":if(i=a.documentElement,!i)throw Error(n(452));return i;case"head":if(i=a.head,!i)throw Error(n(453));return i;case"body":if(i=a.body,!i)throw Error(n(454));return i;default:throw Error(n(451))}}function Vf(i){for(var a=i.attributes;a.length;)i.removeAttributeNode(a[0]);No(i)}var zc=new Map,C1=new Set;function cg(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var nu=le.d;le.d={f:uw,r:hw,D:fw,C:pw,L:gw,m:mw,X:xw,S:yw,M:bw};function uw(){var i=nu.f(),a=eg();return i||a}function hw(i){var a=Us(i);a!==null&&a.tag===5&&a.type==="form"?wu(a):nu.r(i)}var Kh=typeof document>"u"?null:document;function T1(i,a,u){var g=Kh;if(g&&typeof a=="string"&&a){var w=Si(a);w='link[rel="'+i+'"][href="'+w+'"]',typeof u=="string"&&(w+='[crossorigin="'+u+'"]'),C1.has(w)||(C1.add(w),i={rel:i,crossOrigin:u,href:a},g.querySelector(w)===null&&(a=g.createElement("link"),Co(a,"link",i),On(a),g.head.appendChild(a)))}}function fw(i){nu.D(i),T1("dns-prefetch",i,null)}function pw(i,a){nu.C(i,a),T1("preconnect",i,a)}function gw(i,a,u){nu.L(i,a,u);var g=Kh;if(g&&i&&a){var w='link[rel="preload"][as="'+Si(a)+'"]';a==="image"&&u&&u.imageSrcSet?(w+='[imagesrcset="'+Si(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(w+='[imagesizes="'+Si(u.imageSizes)+'"]')):w+='[href="'+Si(i)+'"]';var k=w;switch(a){case"style":k=Zh(i);break;case"script":k=Jh(i)}zc.has(k)||(i=y({rel:"preload",href:a==="image"&&u&&u.imageSrcSet?void 0:i,as:a},u),zc.set(k,i),g.querySelector(w)!==null||a==="style"&&g.querySelector(qf(k))||a==="script"&&g.querySelector(Wf(k))||(a=g.createElement("link"),Co(a,"link",i),On(a),g.head.appendChild(a)))}}function mw(i,a){nu.m(i,a);var u=Kh;if(u&&i){var g=a&&typeof a.as=="string"?a.as:"script",w='link[rel="modulepreload"][as="'+Si(g)+'"][href="'+Si(i)+'"]',k=w;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":k=Jh(i)}if(!zc.has(k)&&(i=y({rel:"modulepreload",href:i},a),zc.set(k,i),u.querySelector(w)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Wf(k)))return}g=u.createElement("link"),Co(g,"link",i),On(g),u.head.appendChild(g)}}}function yw(i,a,u){nu.S(i,a,u);var g=Kh;if(g&&i){var w=Pa(g).hoistableStyles,k=Zh(i);a=a||"default";var V=w.get(k);if(!V){var he={loading:0,preload:null};if(V=g.querySelector(qf(k)))he.loading=5;else{i=y({rel:"stylesheet",href:i,"data-precedence":a},u),(u=zc.get(k))&&O0(i,u);var Be=V=g.createElement("link");On(Be),Co(Be,"link",i),Be._p=new Promise(function(nt,vt){Be.onload=nt,Be.onerror=vt}),Be.addEventListener("load",function(){he.loading|=1}),Be.addEventListener("error",function(){he.loading|=2}),he.loading|=4,dg(V,a,g)}V={type:"stylesheet",instance:V,count:1,state:he},w.set(k,V)}}}function xw(i,a){nu.X(i,a);var u=Kh;if(u&&i){var g=Pa(u).hoistableScripts,w=Jh(i),k=g.get(w);k||(k=u.querySelector(Wf(w)),k||(i=y({src:i,async:!0},a),(a=zc.get(w))&&U0(i,a),k=u.createElement("script"),On(k),Co(k,"link",i),u.head.appendChild(k)),k={type:"script",instance:k,count:1,state:null},g.set(w,k))}}function bw(i,a){nu.M(i,a);var u=Kh;if(u&&i){var g=Pa(u).hoistableScripts,w=Jh(i),k=g.get(w);k||(k=u.querySelector(Wf(w)),k||(i=y({src:i,async:!0,type:"module"},a),(a=zc.get(w))&&U0(i,a),k=u.createElement("script"),On(k),Co(k,"link",i),u.head.appendChild(k)),k={type:"script",instance:k,count:1,state:null},g.set(w,k))}}function k1(i,a,u,g){var w=(w=xe.current)?cg(w):null;if(!w)throw Error(n(446));switch(i){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(a=Zh(u.href),u=Pa(w).hoistableStyles,g=u.get(a),g||(g={type:"style",instance:null,count:0,state:null},u.set(a,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){i=Zh(u.href);var k=Pa(w).hoistableStyles,V=k.get(i);if(V||(w=w.ownerDocument||w,V={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},k.set(i,V),(k=w.querySelector(qf(i)))&&!k._p&&(V.instance=k,V.state.loading=5),zc.has(i)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},zc.set(i,u),k||vw(w,i,u,V.state))),a&&g===null)throw Error(n(528,""));return V}if(a&&g!==null)throw Error(n(529,""));return null;case"script":return a=u.async,u=u.src,typeof u=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Jh(u),u=Pa(w).hoistableScripts,g=u.get(a),g||(g={type:"script",instance:null,count:0,state:null},u.set(a,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,i))}}function Zh(i){return'href="'+Si(i)+'"'}function qf(i){return'link[rel="stylesheet"]['+i+"]"}function _1(i){return y({},i,{"data-precedence":i.precedence,precedence:null})}function vw(i,a,u,g){i.querySelector('link[rel="preload"][as="style"]['+a+"]")?g.loading=1:(a=i.createElement("link"),g.preload=a,a.addEventListener("load",function(){return g.loading|=1}),a.addEventListener("error",function(){return g.loading|=2}),Co(a,"link",u),On(a),i.head.appendChild(a))}function Jh(i){return'[src="'+Si(i)+'"]'}function Wf(i){return"script[async]"+i}function j1(i,a,u){if(a.count++,a.instance===null)switch(a.type){case"style":var g=i.querySelector('style[data-href~="'+Si(u.href)+'"]');if(g)return a.instance=g,On(g),g;var w=y({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return g=(i.ownerDocument||i).createElement("style"),On(g),Co(g,"style",w),dg(g,u.precedence,i),a.instance=g;case"stylesheet":w=Zh(u.href);var k=i.querySelector(qf(w));if(k)return a.state.loading|=4,a.instance=k,On(k),k;g=_1(u),(w=zc.get(w))&&O0(g,w),k=(i.ownerDocument||i).createElement("link"),On(k);var V=k;return V._p=new Promise(function(he,Be){V.onload=he,V.onerror=Be}),Co(k,"link",g),a.state.loading|=4,dg(k,u.precedence,i),a.instance=k;case"script":return k=Jh(u.src),(w=i.querySelector(Wf(k)))?(a.instance=w,On(w),w):(g=u,(w=zc.get(k))&&(g=y({},u),U0(g,w)),i=i.ownerDocument||i,w=i.createElement("script"),On(w),Co(w,"link",g),i.head.appendChild(w),a.instance=w);case"void":return null;default:throw Error(n(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(g=a.instance,a.state.loading|=4,dg(g,u.precedence,i));return a.instance}function dg(i,a,u){for(var g=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),w=g.length?g[g.length-1]:null,k=w,V=0;V<g.length;V++){var he=g[V];if(he.dataset.precedence===a)k=he;else if(k!==w)break}k?k.parentNode.insertBefore(i,k.nextSibling):(a=u.nodeType===9?u.head:u,a.insertBefore(i,a.firstChild))}function O0(i,a){i.crossOrigin==null&&(i.crossOrigin=a.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=a.referrerPolicy),i.title==null&&(i.title=a.title)}function U0(i,a){i.crossOrigin==null&&(i.crossOrigin=a.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=a.referrerPolicy),i.integrity==null&&(i.integrity=a.integrity)}var ug=null;function N1(i,a,u){if(ug===null){var g=new Map,w=ug=new Map;w.set(u,g)}else w=ug,g=w.get(u),g||(g=new Map,w.set(u,g));if(g.has(i))return g;for(g.set(i,null),u=u.getElementsByTagName(i),w=0;w<u.length;w++){var k=u[w];if(!(k[$a]||k[Di]||i==="link"&&k.getAttribute("rel")==="stylesheet")&&k.namespaceURI!=="http://www.w3.org/2000/svg"){var V=k.getAttribute(a)||"";V=i+V;var he=g.get(V);he?he.push(k):g.set(V,[k])}}return g}function P1(i,a,u){i=i.ownerDocument||i,i.head.insertBefore(u,a==="title"?i.querySelector("head > title"):null)}function ww(i,a,u){if(u===1||a.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return i=a.disabled,typeof a.precedence=="string"&&i==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function E1(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function Sw(i,a,u,g){if(u.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var w=Zh(g.href),k=a.querySelector(qf(w));if(k){a=k._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(i.count++,i=hg.bind(i),a.then(i,i)),u.state.loading|=4,u.instance=k,On(k);return}k=a.ownerDocument||a,g=_1(g),(w=zc.get(w))&&O0(g,w),k=k.createElement("link"),On(k);var V=k;V._p=new Promise(function(he,Be){V.onload=he,V.onerror=Be}),Co(k,"link",g),u.instance=k}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(u,a),(a=u.state.preload)&&(u.state.loading&3)===0&&(i.count++,u=hg.bind(i),a.addEventListener("load",u),a.addEventListener("error",u))}}var H0=0;function Aw(i,a){return i.stylesheets&&i.count===0&&pg(i,i.stylesheets),0<i.count||0<i.imgCount?function(u){var g=setTimeout(function(){if(i.stylesheets&&pg(i,i.stylesheets),i.unsuspend){var k=i.unsuspend;i.unsuspend=null,k()}},6e4+a);0<i.imgBytes&&H0===0&&(H0=62500*iw());var w=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&pg(i,i.stylesheets),i.unsuspend)){var k=i.unsuspend;i.unsuspend=null,k()}},(i.imgBytes>H0?50:800)+a);return i.unsuspend=u,function(){i.unsuspend=null,clearTimeout(g),clearTimeout(w)}}:null}function hg(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)pg(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var fg=null;function pg(i,a){i.stylesheets=null,i.unsuspend!==null&&(i.count++,fg=new Map,a.forEach(Cw,i),fg=null,hg.call(i))}function Cw(i,a){if(!(a.state.loading&4)){var u=fg.get(i);if(u)var g=u.get(null);else{u=new Map,fg.set(i,u);for(var w=i.querySelectorAll("link[data-precedence],style[data-precedence]"),k=0;k<w.length;k++){var V=w[k];(V.nodeName==="LINK"||V.getAttribute("media")!=="not all")&&(u.set(V.dataset.precedence,V),g=V)}g&&u.set(null,g)}w=a.instance,V=w.getAttribute("data-precedence"),k=u.get(V)||g,k===g&&u.set(null,w),u.set(V,w),this.count++,g=hg.bind(this),w.addEventListener("load",g),w.addEventListener("error",g),k?k.parentNode.insertBefore(w,k.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(w,i.firstChild)),a.state.loading|=4}}var $f={$$typeof:R,Provider:null,Consumer:null,_currentValue:se,_currentValue2:se,_threadCount:0};function Tw(i,a,u,g,w,k,V,he,Be){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ht(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ht(0),this.hiddenUpdates=Ht(null),this.identifierPrefix=g,this.onUncaughtError=w,this.onCaughtError=k,this.onRecoverableError=V,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Be,this.incompleteTransitions=new Map}function R1(i,a,u,g,w,k,V,he,Be,nt,vt,Pt){return i=new Tw(i,a,u,V,Be,nt,vt,Pt,he),a=1,k===!0&&(a|=24),k=ia(3,null,null,a),i.current=k,k.stateNode=i,a=sa(),a.refCount++,i.pooledCache=a,a.refCount++,k.memoizedState={element:g,isDehydrated:u,cache:a},Vt(k),i}function D1(i){return i?(i=Rs,i):Rs}function L1(i,a,u,g,w,k){w=D1(w),g.context===null?g.context=w:g.pendingContext=w,g=Dn(a),g.payload={element:u},k=k===void 0?null:k,k!==null&&(g.callback=k),u=di(i,g,a),u!==null&&(Ul(u,i,a),nr(u,i,a))}function M1(i,a){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var u=i.retryLane;i.retryLane=u!==0&&u<a?u:a}}function V0(i,a){M1(i,a),(i=i.alternate)&&M1(i,a)}function I1(i){if(i.tag===13||i.tag===31){var a=Fo(i,67108864);a!==null&&Ul(a,i,67108864),V0(i,67108864)}}function z1(i){if(i.tag===13||i.tag===31){var a=xs();a=Fn(a);var u=Fo(i,a);u!==null&&Ul(u,i,a),V0(i,a)}}var gg=!0;function kw(i,a,u,g){var w=ie.T;ie.T=null;var k=le.p;try{le.p=2,q0(i,a,u,g)}finally{le.p=k,ie.T=w}}function _w(i,a,u,g){var w=ie.T;ie.T=null;var k=le.p;try{le.p=8,q0(i,a,u,g)}finally{le.p=k,ie.T=w}}function q0(i,a,u,g){if(gg){var w=W0(g);if(w===null)P0(i,a,g,mg,u),F1(i,g);else if(Nw(w,i,a,u,g))g.stopPropagation();else if(F1(i,g),a&4&&-1<jw.indexOf(i)){for(;w!==null;){var k=Us(w);if(k!==null)switch(k.tag){case 3:if(k=k.stateNode,k.current.memoizedState.isDehydrated){var V=Qt(k.pendingLanes);if(V!==0){var he=k;for(he.pendingLanes|=2,he.entangledLanes|=2;V;){var Be=1<<31-ot(V);he.entanglements[1]|=Be,V&=~Be}kd(k),(fe&6)===0&&(zn=wt()+500,Of(0))}}break;case 31:case 13:he=Fo(k,2),he!==null&&Ul(he,k,2),eg(),V0(k,2)}if(k=W0(g),k===null&&P0(i,a,g,mg,u),k===w)break;w=k}w!==null&&g.stopPropagation()}else P0(i,a,g,null,u)}}function W0(i){return i=or(i),$0(i)}var mg=null;function $0(i){if(mg=null,i=Qn(i),i!==null){var a=o(i);if(a===null)i=null;else{var u=a.tag;if(u===13){if(i=d(a),i!==null)return i;i=null}else if(u===31){if(i=c(a),i!==null)return i;i=null}else if(u===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null)}}return mg=i,null}function B1(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(it()){case pt:return 2;case Ot:return 8;case Qe:case St:return 32;case Wt:return 268435456;default:return 32}default:return 32}}var G0=!1,Mu=null,Iu=null,zu=null,Gf=new Map,Yf=new Map,Bu=[],jw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function F1(i,a){switch(i){case"focusin":case"focusout":Mu=null;break;case"dragenter":case"dragleave":Iu=null;break;case"mouseover":case"mouseout":zu=null;break;case"pointerover":case"pointerout":Gf.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Yf.delete(a.pointerId)}}function Xf(i,a,u,g,w,k){return i===null||i.nativeEvent!==k?(i={blockedOn:a,domEventName:u,eventSystemFlags:g,nativeEvent:k,targetContainers:[w]},a!==null&&(a=Us(a),a!==null&&I1(a)),i):(i.eventSystemFlags|=g,a=i.targetContainers,w!==null&&a.indexOf(w)===-1&&a.push(w),i)}function Nw(i,a,u,g,w){switch(a){case"focusin":return Mu=Xf(Mu,i,a,u,g,w),!0;case"dragenter":return Iu=Xf(Iu,i,a,u,g,w),!0;case"mouseover":return zu=Xf(zu,i,a,u,g,w),!0;case"pointerover":var k=w.pointerId;return Gf.set(k,Xf(Gf.get(k)||null,i,a,u,g,w)),!0;case"gotpointercapture":return k=w.pointerId,Yf.set(k,Xf(Yf.get(k)||null,i,a,u,g,w)),!0}return!1}function O1(i){var a=Qn(i.target);if(a!==null){var u=o(a);if(u!==null){if(a=u.tag,a===13){if(a=d(u),a!==null){i.blockedOn=a,ri(i.priority,function(){z1(u)});return}}else if(a===31){if(a=c(u),a!==null){i.blockedOn=a,ri(i.priority,function(){z1(u)});return}}else if(a===3&&u.stateNode.current.memoizedState.isDehydrated){i.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}i.blockedOn=null}function yg(i){if(i.blockedOn!==null)return!1;for(var a=i.targetContainers;0<a.length;){var u=W0(i.nativeEvent);if(u===null){u=i.nativeEvent;var g=new u.constructor(u.type,u);ur=g,u.target.dispatchEvent(g),ur=null}else return a=Us(u),a!==null&&I1(a),i.blockedOn=u,!1;a.shift()}return!0}function U1(i,a,u){yg(i)&&u.delete(a)}function Pw(){G0=!1,Mu!==null&&yg(Mu)&&(Mu=null),Iu!==null&&yg(Iu)&&(Iu=null),zu!==null&&yg(zu)&&(zu=null),Gf.forEach(U1),Yf.forEach(U1)}function xg(i,a){i.blockedOn===a&&(i.blockedOn=null,G0||(G0=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Pw)))}var bg=null;function H1(i){bg!==i&&(bg=i,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){bg===i&&(bg=null);for(var a=0;a<i.length;a+=3){var u=i[a],g=i[a+1],w=i[a+2];if(typeof g!="function"){if($0(g||u)===null)continue;break}var k=Us(u);k!==null&&(i.splice(a,3),a-=3,Ju(k,{pending:!0,data:w,method:u.method,action:g},g,w))}}))}function Qh(i){function a(Be){return xg(Be,i)}Mu!==null&&xg(Mu,i),Iu!==null&&xg(Iu,i),zu!==null&&xg(zu,i),Gf.forEach(a),Yf.forEach(a);for(var u=0;u<Bu.length;u++){var g=Bu[u];g.blockedOn===i&&(g.blockedOn=null)}for(;0<Bu.length&&(u=Bu[0],u.blockedOn===null);)O1(u),u.blockedOn===null&&Bu.shift();if(u=(i.ownerDocument||i).$$reactFormReplay,u!=null)for(g=0;g<u.length;g+=3){var w=u[g],k=u[g+1],V=w[Ni]||null;if(typeof k=="function")V||H1(u);else if(V){var he=null;if(k&&k.hasAttribute("formAction")){if(w=k,V=k[Ni]||null)he=V.formAction;else if($0(w)!==null)continue}else he=V.action;typeof he=="function"?u[g+1]=he:(u.splice(g,3),g-=3),H1(u)}}}function V1(){function i(k){k.canIntercept&&k.info==="react-transition"&&k.intercept({handler:function(){return new Promise(function(V){return w=V})},focusReset:"manual",scroll:"manual"})}function a(){w!==null&&(w(),w=null),g||setTimeout(u,20)}function u(){if(!g&&!navigation.transition){var k=navigation.currentEntry;k&&k.url!=null&&navigation.navigate(k.url,{state:k.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var g=!1,w=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(u,100),function(){g=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),w!==null&&(w(),w=null)}}}function Y0(i){this._internalRoot=i}vg.prototype.render=Y0.prototype.render=function(i){var a=this._internalRoot;if(a===null)throw Error(n(409));var u=a.current,g=xs();L1(u,g,i,a,null,null)},vg.prototype.unmount=Y0.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var a=i.containerInfo;L1(i.current,2,null,i,null,null),eg(),a[Ns]=null}};function vg(i){this._internalRoot=i}vg.prototype.unstable_scheduleHydration=function(i){if(i){var a=ci();i={blockedOn:null,target:i,priority:a};for(var u=0;u<Bu.length&&a!==0&&a<Bu[u].priority;u++);Bu.splice(u,0,i),u===0&&O1(i)}};var q1=e.version;if(q1!=="19.2.0")throw Error(n(527,q1,"19.2.0"));le.findDOMNode=function(i){var a=i._reactInternals;if(a===void 0)throw typeof i.render=="function"?Error(n(188)):(i=Object.keys(i).join(","),Error(n(268,i)));return i=f(a),i=i!==null?m(i):null,i=i===null?null:i.stateNode,i};var Ew={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:ie,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wg.isDisabled&&wg.supportsFiber)try{Kt=wg.inject(Ew),rn=wg}catch{}}return Zf.createRoot=function(i,a){if(!r(i))throw Error(n(299));var u=!1,g="",w=Op,k=Up,V=qo;return a!=null&&(a.unstable_strictMode===!0&&(u=!0),a.identifierPrefix!==void 0&&(g=a.identifierPrefix),a.onUncaughtError!==void 0&&(w=a.onUncaughtError),a.onCaughtError!==void 0&&(k=a.onCaughtError),a.onRecoverableError!==void 0&&(V=a.onRecoverableError)),a=R1(i,1,!1,null,null,u,g,null,w,k,V,V1),i[Ns]=a.current,N0(i),new Y0(a)},Zf.hydrateRoot=function(i,a,u){if(!r(i))throw Error(n(299));var g=!1,w="",k=Op,V=Up,he=qo,Be=null;return u!=null&&(u.unstable_strictMode===!0&&(g=!0),u.identifierPrefix!==void 0&&(w=u.identifierPrefix),u.onUncaughtError!==void 0&&(k=u.onUncaughtError),u.onCaughtError!==void 0&&(V=u.onCaughtError),u.onRecoverableError!==void 0&&(he=u.onRecoverableError),u.formState!==void 0&&(Be=u.formState)),a=R1(i,1,!0,a,u??null,g,w,Be,k,V,he,V1),a.context=D1(null),u=a.current,g=xs(),g=Fn(g),w=Dn(g),w.callback=null,di(u,w,g),u=g,a.current.lanes=u,Et(a,u),kd(a),i[Ns]=a.current,N0(i),new vg(a)},Zf.version="19.2.0",Zf}var nx;function Hw(){if(nx)return J0.exports;nx=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),J0.exports=Uw(),J0.exports}var Vw=Hw();/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qw=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ww=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),ix=s=>{const e=Ww(s);return e.charAt(0).toUpperCase()+e.slice(1)},t2=(...s)=>s.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim(),$w=s=>{for(const e in s)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Gw={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yw=U.forwardRef(({color:s="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:r="",children:o,iconNode:d,...c},h)=>U.createElement("svg",{ref:h,...Gw,width:e,height:e,stroke:s,strokeWidth:n?Number(t)*24/Number(e):t,className:t2("lucide",r),...!o&&!$w(c)&&{"aria-hidden":"true"},...c},[...d.map(([f,m])=>U.createElement(f,m)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n2=(s,e)=>{const t=U.forwardRef(({className:n,...r},o)=>U.createElement(Yw,{ref:o,iconNode:e,className:t2(`lucide-${qw(ix(s))}`,`lucide-${s}`,n),...r}));return t.displayName=ix(s),t};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xw=[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]],Kw=n2("mouse-pointer",Xw);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zw=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Jw=n2("pen-line",Zw),Qw=JSON.parse('[{"category":"Capacitors","subcategory":"General","type":"Capacitor","displayName":"Capacitor","description":"General purpose capacitor","searchText":"capacitor general","designator":"C","defaultPins":2,"properties":{"capacitorType":"General"},"fields":[{"name":"capacitance","label":"Capacitance","type":"number","units":["pF","nF","F","mF","F"],"defaultUnit":"F","required":false},{"name":"voltage","label":"Voltage Rating","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"tolerance","label":"Tolerance","type":"string","required":false},{"name":"dielectric","label":"Dielectric","type":"string","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false},{"name":"mountingType","label":"Mounting Type","type":"enum","enumValues":["Through-hole","SMD","Surface mount"],"required":false}]},{"category":"Capacitors","subcategory":"Electrolytic","type":"Capacitor","displayName":"Electrolytic","description":"Electrolytic capacitor","searchText":"electrolytic capacitor","designator":"CE","defaultPins":2,"properties":{"capacitorType":"Electrolytic","polarized":true},"fields":[{"name":"capacitance","label":"Capacitance","type":"number","units":["pF","nF","F","mF","F"],"defaultUnit":"F","required":false},{"name":"voltage","label":"Voltage Rating","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"tolerance","label":"Tolerance","type":"string","defaultValue":"20%","required":false},{"name":"esr","label":"ESR","type":"number","units":["m",""],"defaultUnit":"","required":false},{"name":"temperature","label":"Temperature Range","type":"string","required":false},{"name":"ripple","label":"Ripple Current","type":"number","units":["mA","A"],"defaultUnit":"mA","required":false},{"name":"leakageCurrent","label":"Leakage Current","type":"number","units":["A","mA"],"defaultUnit":"A","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false},{"name":"mountingType","label":"Mounting Type","type":"enum","enumValues":["Through-hole","SMD","Surface mount"],"required":false}]},{"category":"Capacitors","subcategory":"Film","type":"Capacitor","displayName":"Film","description":"Film capacitor","searchText":"film capacitor","designator":"CF","defaultPins":2,"properties":{"capacitorType":"Film"},"fields":[{"name":"capacitance","label":"Capacitance","type":"number","units":["pF","nF","F","mF","F"],"defaultUnit":"nF","required":false},{"name":"voltage","label":"Voltage Rating","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"tolerance","label":"Tolerance","type":"string","defaultValue":"10%","required":false},{"name":"filmType","label":"Film Type","type":"enum","enumValues":["Polyester","Polypropylene","Polyethylene","Polystyrene","Teflon"],"defaultValue":"Polyester","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false},{"name":"mountingType","label":"Mounting Type","type":"enum","enumValues":["Through-hole","SMD","Surface mount"],"required":false}]},{"category":"Capacitors","subcategory":"Tantalum","type":"Capacitor","displayName":"Tantalum","description":"Tantalum capacitor","searchText":"tantalum capacitor","designator":"C","defaultPins":2,"properties":{"capacitorType":"Tantalum","dielectric":"Tantalum","polarized":true},"fields":[{"name":"capacitance","label":"Capacitance","type":"number","units":["pF","nF","F","mF","F"],"defaultUnit":"F","required":false},{"name":"voltage","label":"Voltage Rating","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"tolerance","label":"Tolerance","type":"string","required":false},{"name":"esr","label":"ESR","type":"number","units":["m",""],"defaultUnit":"","required":false},{"name":"leakageCurrent","label":"Leakage Current","type":"number","units":["A","mA"],"defaultUnit":"A","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false},{"name":"mountingType","label":"Mounting Type","type":"enum","enumValues":["Through-hole","SMD","Surface mount"],"required":false}]},{"category":"Diodes","subcategory":"Standard","type":"Diode","displayName":"Diode","description":"Standard diode","searchText":"diode standard","designator":"D","defaultPins":2,"subtype":"Standard","properties":{"diodeType":"Standard","polarized":true},"fields":[{"name":"voltage","label":"Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Diodes","subcategory":"Zener","type":"Diode","displayName":"Zener","description":"Zener diode","searchText":"zener diode","designator":"Z","defaultPins":2,"subtype":"Zener","properties":{"diodeType":"Zener","polarized":true},"fields":[{"name":"voltage","label":"Zener Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"mA","required":false},{"name":"power","label":"Power","type":"number","units":["W","mW","kW"],"defaultUnit":"W","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Diodes","subcategory":"LED","type":"Diode","displayName":"LED","description":"LED diode","searchText":"led diode","designator":"LED","defaultPins":2,"subtype":"LED","properties":{"diodeType":"LED","polarized":true},"fields":[{"name":"voltage","label":"Forward Voltage","type":"number","units":["mV","V"],"defaultUnit":"V","required":false},{"name":"current","label":"Forward Current","type":"number","units":["mA","A"],"defaultUnit":"mA","required":false},{"name":"ledColor","label":"Color","type":"string","required":false},{"name":"wavelength","label":"Wavelength","type":"string","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Diodes","subcategory":"Schottky","type":"Diode","displayName":"Schottky","description":"Schottky diode","searchText":"schottky diode","designator":"D","defaultPins":2,"subtype":"Schottky","properties":{"diodeType":"Schottky","polarized":true},"fields":[{"name":"voltage","label":"Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Diodes","subcategory":"Infrared","type":"Diode","displayName":"Infrared","description":"Infrared diode","searchText":"infrared diode","designator":"IR","defaultPins":2,"subtype":"Infrared","properties":{"diodeType":"Infrared","polarized":true},"fields":[{"name":"voltage","label":"Voltage","type":"number","units":["mV","V"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["mA","A"],"defaultUnit":"mA","required":false},{"name":"wavelength","label":"Wavelength","type":"string","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Diodes","subcategory":"Photodiode","type":"Diode","displayName":"Photodiode","description":"Photodiode","searchText":"photodiode diode","designator":"PD","defaultPins":2,"subtype":"Photodiode","properties":{"diodeType":"Photodiode","polarized":true},"fields":[{"name":"voltage","label":"Voltage","type":"number","units":["mV","V"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"wavelength","label":"Wavelength","type":"string","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Resistors","subcategory":"Standard","type":"Resistor","displayName":"Resistor","description":"Standard resistor","searchText":"resistor standard","designator":"R","defaultPins":2,"properties":{"resistorType":"Standard"},"fields":[{"name":"resistance","label":"Resistance","type":"number","units":["","m","k","M"],"defaultUnit":"","required":false},{"name":"power","label":"Power","type":"number","units":["W","mW","kW"],"defaultUnit":"W","required":false},{"name":"tolerance","label":"Tolerance","type":"string","defaultValue":"5%","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false},{"name":"mountingType","label":"Mounting Type","type":"enum","enumValues":["Through-hole","SMD","Surface mount"],"required":false}]},{"category":"Resistors","subcategory":"Network","type":"Resistor","displayName":"Resistor Network","description":"Resistor network","searchText":"resistor network","designator":"RN","defaultPins":8,"properties":{"resistorType":"Network"},"fields":[{"name":"resistance","label":"Resistance","type":"number","units":["","m","k","M"],"defaultUnit":"","required":false},{"name":"configuration","label":"Configuration","type":"enum","enumValues":["Isolated","Bussed","Dual Terminator"],"defaultValue":"Isolated","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false},{"name":"mountingType","label":"Mounting Type","type":"enum","enumValues":["Through-hole","SMD","Surface mount"],"required":false}]},{"category":"Resistors","subcategory":"Thermistor","type":"Resistor","displayName":"Thermistor","description":"Thermistor resistor","searchText":"thermistor resistor","designator":"RT","defaultPins":2,"properties":{"resistorType":"Thermistor"},"fields":[{"name":"resistance","label":"Resistance","type":"number","units":["","m","k","M"],"defaultUnit":"","required":false},{"name":"thermistorType","label":"Thermistor Type","type":"enum","enumValues":["NTC","PTC"],"defaultValue":"NTC","required":false},{"name":"beta","label":"Beta Value","type":"number","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Resistors","subcategory":"Variable","type":"Resistor","displayName":"Variable Resistor","description":"Variable resistor","searchText":"variable resistor","designator":"VR","defaultPins":3,"subtype":"Potentiometer","properties":{"resistorType":"Variable","vrType":"Potentiometer"},"fields":[{"name":"resistance","label":"Resistance","type":"number","units":["","m","k","M"],"defaultUnit":"","required":false},{"name":"power","label":"Power","type":"number","units":["W","mW","kW"],"defaultUnit":"W","required":false},{"name":"taper","label":"Taper","type":"enum","enumValues":["Linear","Logarithmic"],"defaultValue":"Linear","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false},{"name":"mountingType","label":"Mounting Type","type":"enum","enumValues":["Through-hole","SMD","Surface mount"],"required":false}]},{"category":"Resistors","subcategory":"Varistor","type":"Resistor","displayName":"Varistor","description":"Varistor resistor","searchText":"varistor resistor","designator":"RV","defaultPins":3,"subtype":"Varistor","properties":{"resistorType":"Variable","vrType":"Varistor"},"fields":[{"name":"voltage","label":"Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"power","label":"Power","type":"number","units":["W","mW","kW"],"defaultUnit":"W","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Semiconductors","subcategory":"BJT","type":"Semiconductor","displayName":"Transistor, BJT NPN","description":"Bipolar Junction Transistor NPN (Collector, Base, Emitter)","searchText":"bjt transistor bipolar junction base emitter collector npn","designator":"Q","defaultPins":3,"properties":{"semiconductorType":"Transistor","transistorType":"BJT","pinNames":["Collector","Base","Emitter"]},"fields":[{"name":"voltage","label":"Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Semiconductors","subcategory":"BJT PNP","type":"Semiconductor","displayName":"Transistor, BJT PNP","description":"Bipolar Junction Transistor PNP (Emitter, Base, Collector)","searchText":"bjt transistor bipolar junction base emitter collector pnp","designator":"Q","defaultPins":3,"properties":{"semiconductorType":"Transistor","transistorType":"BJT","pinNames":["Emitter","Base","Collector"]},"fields":[{"name":"voltage","label":"Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Semiconductors","subcategory":"MOSFET","type":"Semiconductor","displayName":"Transistor, MOSFET, N-Channel","description":"Metal-Oxide-Semiconductor Field-Effect Transistor N-Channel (Source, Gate, Drain)","searchText":"mosfet transistor metal oxide semiconductor field effect source gate drain n-channel","designator":"Q","defaultPins":3,"properties":{"semiconductorType":"Transistor","transistorType":"MOSFET","pinNames":["Source","Drain","Gate"]},"fields":[{"name":"voltage","label":"Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Semiconductors","subcategory":"MOSFET P-Channel","type":"Semiconductor","displayName":"Transistor, MOSFET, P-Channel","description":"Metal-Oxide-Semiconductor Field-Effect Transistor P-Channel (Source, Gate, Drain)","searchText":"mosfet transistor metal oxide semiconductor field effect source gate drain p-channel","designator":"Q","defaultPins":3,"properties":{"semiconductorType":"Transistor","transistorType":"MOSFET","pinNames":["Source","Drain","Gate"]},"fields":[{"name":"voltage","label":"Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Semiconductors","subcategory":"JFET","type":"Semiconductor","displayName":"Transistor, JFET","description":"Junction Field-Effect Transistor (Source, Gate, Drain)","searchText":"jfet transistor junction field effect source gate drain n-channel p-channel","designator":"Q","defaultPins":3,"properties":{"semiconductorType":"Transistor","transistorType":"JFET","pinNames":["Source","Gate","Drain"]},"fields":[{"name":"polarity","label":"Polarity","type":"enum","enumValues":["N-Channel","P-Channel"],"defaultValue":"N-Channel","required":false},{"name":"voltage","label":"Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Semiconductors","subcategory":"Single Op Amp","type":"Semiconductor","displayName":"Op Amp, Single","description":"Single operational amplifier","searchText":"single op amp operational amplifier opamp","designator":"U","defaultPins":5,"properties":{"semiconductorType":"OpAmp","pinNames":["V+","V-","input+","input-","output"]},"fields":[{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"packageType","label":"Package Type","type":"enum","enumValues":["SOT-23-5","SC70-5","Other"],"defaultValue":"SOT-23-5","required":false},{"name":"voltage","label":"Supply Voltage","type":"number","units":["V","mV"],"defaultUnit":"V","required":false},{"name":"description","label":"Description","type":"string","required":false},{"name":"datasheet","label":"Datasheet URL","type":"string","required":false}]},{"category":"Semiconductors","subcategory":"Dual Op Amp","type":"Semiconductor","displayName":"Op Amp, Dual","description":"Dual operational amplifier","searchText":"dual op amp operational amplifier opamp","designator":"U","defaultPins":8,"properties":{"semiconductorType":"OpAmp","pinNames":["Output 1","Input 1-","Input 1+","VEE / GND","Input 2+","Input 2-","Output 2","VCC / V+"]},"fields":[{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"packageType","label":"Package Type","type":"enum","enumValues":["DIP-8","SOIC-8","DIP-14","SOIC-14","SOT-23-5","Other"],"defaultValue":"DIP-8","required":false},{"name":"voltage","label":"Supply Voltage","type":"number","units":["V","mV"],"defaultUnit":"V","required":false},{"name":"description","label":"Description","type":"string","required":false},{"name":"datasheet","label":"Datasheet URL","type":"string","required":false}]},{"category":"Semiconductors","subcategory":"Quad Op Amp","type":"Semiconductor","displayName":"Op Amp, Quad","description":"Quad operational amplifier","searchText":"quad op amp operational amplifier opamp","designator":"U","defaultPins":14,"properties":{"semiconductorType":"OpAmp","pinNames":["1OUT","1IN-","1IN+","VCC+","2IN+","2IN-","2OUT","3OUT","3IN-","3IN+","VCC-","4IN+","4IN-","4OUT"]},"fields":[{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"packageType","label":"Package Type","type":"enum","enumValues":["DIP-14","SOIC-14","TSSOP-14","Other"],"defaultValue":"DIP-14","required":false},{"name":"voltage","label":"Supply Voltage","type":"number","units":["V","mV"],"defaultUnit":"V","required":false},{"name":"description","label":"Description","type":"string","required":false},{"name":"datasheet","label":"Datasheet URL","type":"string","required":false}]},{"category":"Semiconductors","subcategory":"Integrated Circuit","type":"Semiconductor","displayName":"Integrated Circuit","description":"Integrated circuit","searchText":"integrated circuit semiconductor ic","designator":"U","defaultPins":8,"fixedPinCount":false,"properties":{"semiconductorType":"IntegratedCircuit","pinNames":["CHIP_DEPENDENT"]},"fields":[{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"icType","label":"IC Type","type":"string","required":false},{"name":"packageType","label":"Package Type","type":"enum","enumValues":["DIP","SOIC","QFP","LQFP","TQFP","BGA","SSOP","TSOP","Various","Other"],"required":false},{"name":"description","label":"Description","type":"string","required":false},{"name":"datasheet","label":"Datasheet URL","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Passive Components","subcategory":"Inductor","type":"Inductor","displayName":"Inductor","description":"Inductor","searchText":"inductor","designator":"L","defaultPins":2,"properties":{"passiveType":"Inductor"},"fields":[{"name":"inductance","label":"Inductance","type":"number","units":["nH","H","mH","H"],"defaultUnit":"H","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"resistance","label":"DC Resistance","type":"number","units":["","m","k","M"],"defaultUnit":"","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false},{"name":"mountingType","label":"Mounting Type","type":"enum","enumValues":["Through-hole","SMD","Surface mount"],"required":false}]},{"category":"Passive Components","subcategory":"Ferrite Bead","type":"FerriteBead","displayName":"Ferrite Bead","description":"Ferrite bead","searchText":"ferrite bead passive","designator":"FB","defaultPins":2,"properties":{"passiveType":"FerriteBead"},"fields":[{"name":"impedance","label":"Impedance","type":"number","units":["","m","k"],"defaultUnit":"","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false},{"name":"mountingType","label":"Mounting Type","type":"enum","enumValues":["Through-hole","SMD","Surface mount"],"required":false}]},{"category":"Passive Components","subcategory":"Crystal","type":"Crystal","displayName":"Crystal","description":"Crystal oscillator","searchText":"crystal oscillator passive","designator":"X","defaultPins":2,"properties":{"passiveType":"Crystal"},"fields":[{"name":"frequency","label":"Frequency","type":"string","required":false},{"name":"loadCapacitance","label":"Load Capacitance","type":"string","required":false},{"name":"tolerance","label":"Tolerance","type":"string","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Power & Energy","subcategory":"Battery","type":"PowerEnergy","displayName":"Battery","description":"Battery or battery holder","searchText":"battery power energy","designator":"B","defaultPins":2,"properties":{"powerType":"Battery","polarized":true},"fields":[{"name":"voltage","label":"Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"capacity","label":"Capacity","type":"number","units":["mAh","Ah"],"defaultUnit":"mAh","required":false},{"name":"chemistry","label":"Chemistry","type":"enum","enumValues":["Li-ion","Alkaline","NiMH","NiCd","Lead-acid"],"required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Power & Energy","subcategory":"Power Supply","type":"PowerEnergy","displayName":"Power Supply","description":"Power supply","searchText":"power supply energy","designator":"PS","defaultPins":4,"properties":{"powerType":"PowerSupply"},"fields":[{"name":"inputVoltage","label":"Input Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"outputVoltage","label":"Output Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"efficiency","label":"Efficiency","type":"number","required":false},{"name":"ripple","label":"Ripple","type":"string","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Power & Energy","subcategory":"Fuse","type":"PowerEnergy","displayName":"Fuse","description":"Fuse","searchText":"fuse power energy","designator":"F","defaultPins":2,"properties":{"powerType":"Fuse"},"fields":[{"name":"current","label":"Current Rating","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"voltage","label":"Voltage Rating","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"fuseType","label":"Fuse Type","type":"enum","enumValues":["Fast-blow","Slow-blow","Time-delay"],"defaultValue":"Fast-blow","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"operatingTemperature","label":"Operating Temp","type":"string","required":false}]},{"category":"Connectors & Switches","subcategory":"Connector","type":"Connector","displayName":"Connector","description":"Connector","searchText":"connector","designator":"J","defaultPins":4,"properties":{"connectorType":"Connector"},"fields":[{"name":"connectorType","label":"Connector Type","type":"string","required":false},{"name":"gender","label":"Gender","type":"enum","enumValues":["Male","Female","N/A"],"defaultValue":"N/A","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"mountingType","label":"Mounting Type","type":"enum","enumValues":["Through-hole","SMD","Surface mount"],"required":false}]},{"category":"Connectors & Switches","subcategory":"Jumper","type":"Jumper","displayName":"Jumper","description":"Jumper link","searchText":"jumper link","designator":"JP","defaultPins":3,"properties":{"connectorType":"Jumper"},"fields":[{"name":"positions","label":"Positions","type":"number","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"mountingType","label":"Mounting Type","type":"enum","enumValues":["Through-hole","SMD","Surface mount"],"required":false}]},{"category":"Connectors & Switches","subcategory":"Switch","type":"Switch","displayName":"Switch","description":"Switch","searchText":"switch","designator":"S","defaultPins":2,"properties":{"switchType":"Switch"},"fields":[{"name":"switchType","label":"Switch Type","type":"string","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"voltage","label":"Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"mountingType","label":"Mounting Type","type":"enum","enumValues":["Through-hole","SMD","Surface mount"],"required":false}]},{"category":"Connectors & Switches","subcategory":"Relay","type":"Relay","displayName":"Relay","description":"Relay or contactor","searchText":"relay contactor","designator":"K","defaultPins":5,"properties":{"switchType":"Relay"},"fields":[{"name":"coilVoltage","label":"Coil Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"contactType","label":"Contact Type","type":"string","required":false},{"name":"current","label":"Contact Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false},{"name":"mountingType","label":"Mounting Type","type":"enum","enumValues":["Through-hole","SMD","Surface mount"],"required":false}]},{"category":"Other","subcategory":"Transformer","type":"Transformer","displayName":"Transformer","description":"Transformer","searchText":"transformer","designator":"TR","defaultPins":4,"fields":[{"name":"primaryVoltage","label":"Primary Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"secondaryVoltage","label":"Secondary Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"power","label":"Power","type":"number","units":["W","mW","kW"],"defaultUnit":"W","required":false},{"name":"turns","label":"Turns Ratio","type":"string","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false}]},{"category":"Other","subcategory":"Speaker","type":"Speaker","displayName":"Speaker","description":"Loudspeaker or buzzer","searchText":"speaker loudspeaker buzzer","designator":"LS","defaultPins":2,"fields":[{"name":"impedance","label":"Impedance","type":"number","units":["","m","k"],"defaultUnit":"","required":false},{"name":"power","label":"Power","type":"number","units":["W","mW","kW"],"defaultUnit":"W","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false}]},{"category":"Other","subcategory":"Motor","type":"Motor","displayName":"Motor","description":"Motor","searchText":"motor","designator":"M","defaultPins":2,"fields":[{"name":"motorType","label":"Motor Type","type":"string","required":false},{"name":"voltage","label":"Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false}]},{"category":"Other","subcategory":"Test Point","type":"TestPoint","displayName":"Test Point","description":"Test point","searchText":"test point","designator":"TP","defaultPins":1,"fields":[{"name":"signal","label":"Signal","type":"string","required":false}]},{"category":"Other","subcategory":"Vacuum Tube","type":"VacuumTube","displayName":"Vacuum Tube","description":"Vacuum tube","searchText":"vacuum tube","designator":"V","defaultPins":5,"fields":[{"name":"tubeType","label":"Tube Type","type":"string","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false}]},{"category":"Other","subcategory":"Attenuator","type":"GenericComponent","displayName":"Attenuator","description":"Attenuator or isolator","searchText":"attenuator isolator component","designator":"AT","defaultPins":2,"subtype":"Attenuator","fields":[{"name":"voltage","label":"Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"power","label":"Power","type":"number","units":["W","mW","kW"],"defaultUnit":"W","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false}]},{"category":"Other","subcategory":"Circuit Breaker","type":"GenericComponent","displayName":"Circuit Breaker","description":"Circuit breaker","searchText":"circuit breaker component","designator":"CB","defaultPins":2,"subtype":"CircuitBreaker","fields":[{"name":"voltage","label":"Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"current","label":"Current","type":"number","units":["A","mA","A"],"defaultUnit":"A","required":false},{"name":"power","label":"Power","type":"number","units":["W","mW","kW"],"defaultUnit":"W","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false}]},{"category":"Other","subcategory":"Thermocouple","type":"GenericComponent","displayName":"Thermocouple","description":"Thermocouple","searchText":"thermocouple component","designator":"TC","defaultPins":2,"subtype":"Thermocouple","fields":[{"name":"model","label":"Model","type":"string","required":false},{"name":"voltage","label":"Voltage","type":"number","units":["mV","V","kV"],"defaultUnit":"V","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false}]},{"category":"Other","subcategory":"Tuner","type":"GenericComponent","displayName":"Tuner","description":"Tuner","searchText":"tuner component","designator":"TUN","defaultPins":2,"subtype":"Tuner","fields":[{"name":"frequency","label":"Frequency","type":"string","required":false},{"name":"partNumber","label":"Part Number","type":"string","required":false},{"name":"manufacturer","label":"Manufacturer","type":"string","required":false}]}]'),o0={components:Qw},e5=["#FFFFFF","#BFBFBF","#7F7F7F","#3C3C3C","#000000","#A6CEE3","#56B4E9","#17BECF","#00BFC4","#1F77B4","#0072B2","#332288","#B2DF8A","#B3DE69","#2CA02C","#009E73","#FFED6F","#F0E442","#BCBD22","#E69F00","#FF7F0E","#FB9A99","#F781BF","#E15759","#D62728","#CAB2D6","#CC79A7","#AA4499","#6A3D9A","#9467BD","#9C755F","#8C564B"],nm="#2CA02C",t5="#F0E442",n5="#00BFC4",im="#000000",i5="#00008b",rm="#FF0000",yy={DEFAULT_SIZE:18},lp={};o0.components.forEach(s=>{const e=s.type,t=s.designator;if(!lp[e])lp[e]={prefix:[t],defaultPins:s.defaultPins};else{const n=lp[e],r=[...new Set([...n.prefix,t])];lp[e]={prefix:r,defaultPins:n.defaultPins}}});const xy=lp,ef={};o0.components.forEach(s=>{if(ef[s.category]||(ef[s.category]={}),!ef[s.category][s.subcategory])ef[s.category][s.subcategory]=[s.type];else{const e=ef[s.category][s.subcategory];e.includes(s.type)||(ef[s.category][s.subcategory]=[...e,s.type])}});const sm={DEFAULT_SIZE:18},i2={resistance:{validUnits:["","m","k","M"],defaultUnit:""},capacitance:{validUnits:["pF","nF","F","mF","F"],defaultUnit:"F"},voltage:{validUnits:["mV","V","kV"],defaultUnit:"V"},current:{validUnits:["A","mA","A"],defaultUnit:"A"},power:{validUnits:["W","mW","kW"],defaultUnit:"W"},inductance:{validUnits:["nH","H","mH","H"],defaultUnit:"H"},impedance:{validUnits:["","m","k"],defaultUnit:""},capacity:{validUnits:["mAh","Ah"],defaultUnit:"mAh"},inputVoltage:{validUnits:["mV","V","kV"],defaultUnit:"V"},outputVoltage:{validUnits:["mV","V","kV"],defaultUnit:"V"},coilVoltage:{validUnits:["mV","V","kV"],defaultUnit:"V"},primaryVoltage:{validUnits:["mV","V","kV"],defaultUnit:"V"},secondaryVoltage:{validUnits:["mV","V","kV"],defaultUnit:"V"},esr:{validUnits:["m",""],defaultUnit:""}};function ir(s){return i2[s]?.validUnits||[]}function cn(s){return i2[s]?.defaultUnit||""}function wc(s){return s.includes(" ")?s:s.replace(/([a-z])([A-Z])/g,"$1 $2")}const qa=Math.PI*2;function r2(s){return(s%360+360)%360}function cu(s){return s*Math.PI/180}function r5(s){return s*180/Math.PI}function Hm(s,e){return r2(s+e)}function Jg(s){return Math.tan(s)}function s5(s){return Math.cos(s)}function a5(s){return Math.sin(s)}function o5(s,e){return Math.atan2(s,e)}function l5(s,e){return r5(o5(e,s))}function Vm(s,e){const{x:t,y:n,rotation:r=0,scale:o=1,flipX:d=!1,flipY:c=!1,skewX:h=0,skewY:f=0}=e;if(s.translate(t,n),r!==0&&s.rotate(cu(r)),h!==0||f!==0){const A=Jg(h),v=Jg(f);s.transform(1,v,A,1,0,0)}const m=o*(d?-1:1),y=o*(c?-1:1);(m!==1||y!==1)&&s.scale(m,y)}function rx(s,e,t,n=0,r=!1,o=!1){Vm(s,{x:e,y:t,rotation:n,flipX:r,flipY:o})}function s2(s,e,t){const n=cu(t),r=s5(n),o=a5(n);return{x:s*r-e*o,y:s*o+e*r}}function c5(s,e=0,t=!1){t&&s.scale(-1,1),e!==0&&s.rotate(cu(e))}function d5(s,e=0,t=!1){const n=r2(e),r=n===90||n===270;t&&s.scale(-1,1),e!==0&&s.rotate(cu(-e)),t&&r&&s.rotate(cu(180))}function sx(s,e,t,n=0,r=!1){let o=s/t,d=e/t;if(n!==0){const c=s2(o,d,-n);o=c.x,d=c.y}return r&&(o=-o),{x:o,y:d}}function Jf(s,e,t,n,r=0,o=!1){let d=s-t.x,c=e-t.y;if(d=d/n,c=c/n,o&&(d=-d),r!==0){const h=s2(d,c,-r);d=h.x,c=h.y}return{x:d,y:c}}function u5(s,e=.4){if(s.startsWith("#")){const n=s.slice(1),r=parseInt(n.slice(0,2),16),o=parseInt(n.slice(2,4),16),d=parseInt(n.slice(4,6),16),c=Math.max(0,Math.floor(r*(1-e))),h=Math.max(0,Math.floor(o*(1-e))),f=Math.max(0,Math.floor(d*(1-e)));return`#${c.toString(16).padStart(2,"0")}${h.toString(16).padStart(2,"0")}${f.toString(16).padStart(2,"0")}`}const t=s.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);if(t){const n=parseInt(t[1],10),r=parseInt(t[2],10),o=parseInt(t[3],10),d=t[4]?t[4].trim():"",c=Math.max(0,Math.floor(n*(1-e))),h=Math.max(0,Math.floor(r*(1-e))),f=Math.max(0,Math.floor(o*(1-e)));return s.includes("rgba")?`rgba(${c}, ${h}, ${f}${d?`, ${d}`:", 1"})`:`rgb(${c}, ${h}, ${f})`}return s}let Al=1;const Hc=new Set;function sd(){const s=Al;if(Al++,Hc.has(s)){for(console.error(`CRITICAL ERROR: Duplicate Node ID ${s} would be allocated!`),console.error(`Current counter: ${Al}, Allocated IDs count: ${Hc.size}`);Hc.has(Al);)Al++;const e=Al;return Al++,Hc.add(e),console.error(`Recovered by allocating ID ${e} instead`),e}return Hc.add(s),s}function Sg(s){s<1&&(console.warn(`setPointIdCounter called with invalid value ${s}, using 1`),s=1),Al=s,Hc.clear()}function am(){return Al}function ax(){Al=1,Hc.clear()}function om(s){s>0&&(Hc.add(s),s>=Al&&(Al=s+1))}function Ag(s){if(s>0&&Hc.has(s))if(Hc.delete(s),Hc.size>0){const e=Math.max(...Array.from(Hc));e<Al&&(Al=Math.max(1,e+1))}else Al=1}function a2(s="id"){return`${s}-${Date.now()}-${Math.random().toString(36).slice(2,11)}`}function ox(s){return Math.round(s*1e4)/1e4}function cr(s){return{x:ox(s.x),y:ox(s.y)}}const Wu=o0.components;Wu.map(s=>({designator:s.designator,componentType:s.description}));function Vc(s){if(!s)return;const e=s.componentDefinitionKey;if(e){const n=Wu.find(r=>`${r.category}:${r.subcategory}:${r.type}`===e);if(n)return n}if(typeof s.designator=="string"&&s.designator.trim()!==""){const n=s.designator.trim().match(/^[A-Za-z]+/),r=n?n[0]:null;if(r){const o=Wu.find(d=>Array.isArray(d.designators)&&d.designators.includes(r));if(o)return o}}const t=s.componentType==="Electrolytic Capacitor"||s.componentType==="Film Capacitor"?"Capacitor":s.componentType;return Wu.find(n=>{if(n.type!==t)return!1;if(n.category==="Capacitors"){const r=s.capacitorType||s.dielectric;return!!(r&&n.properties?.capacitorType===r||!r)}if(n.category==="Diodes"){const r=s.diodeType;return!!(r&&n.properties?.diodeType===r||!n.properties?.diodeType)}if(n.category==="Resistors"){const r=s.resistorType,o=s.vrType;return!!(r&&n.properties?.resistorType===r||o&&n.properties?.vrType===o||!n.properties?.resistorType&&!n.properties?.vrType)}if(n.category==="Semiconductors"){const r=s.semiconductorType;return!!(r&&n.properties?.semiconductorType===r||!n.properties?.semiconductorType)}if(n.category==="Passive Components"){const r=s.passiveType;return!!(r&&n.properties?.passiveType===r||!n.properties?.passiveType)}if(n.category==="Power & Energy"){const r=s.powerType;return!!(r&&n.properties?.powerType===r||!n.properties?.powerType)}if(n.category==="Connectors & Switches"){const r=s.connectorType,o=s.switchType;return!!(r&&n.properties?.connectorType===r||o&&n.properties?.switchType===o||!n.properties?.connectorType&&!n.properties?.switchType)}if(s.componentType==="GenericComponent"){const r=s.genericType;return!!(r&&n.subtype===r)}return!0})}function lm(s){return(xy[s]?.prefix||["?"])[0]}function Sp(s){return Vc(s)?.properties?.polarized===!0}function qm(s,e,t){if(!Sp(s)||s.pinCount!==2||!(e.length===2&&e[0]&&e[0].trim()!==""&&e[1]&&e[1].trim()!==""))return null;const r=m=>{const y=parseInt(m,10);if(isNaN(y))return null;for(const A of t)if((A.type==="via"||A.type==="pad")&&A.points.length>0){const v=A.points[0];if(v.id===y)return{x:v.x,y:v.y}}return null},o=r(e[0]),d=r(e[1]);if(!o||!d)return null;const c=Math.hypot(s.x-o.x,s.y-o.y),h=Math.hypot(s.x-d.x,s.y-d.y),f=["",""];return c<h?(f[0]="-",f[1]="+"):(f[0]="+",f[1]="-"),f}function Qf(){return{}}function h5(s){}function f5(s,e,t){let n=0;for(const o of e)if(o.designator){const d=o.designator.match(new RegExp(`^${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(\\d+)$`));if(d){const c=parseInt(d[1],10);c>n&&(n=c)}}const r=t[s]||0;return Math.max(n,r)+1}function lx(s,e,t){const n={...t};return n[s]=Math.max(n[s]||0,e),n}function p5(s){if(s.designator&&s.designator.trim()!=="")return s.designator.trim();switch(s.baseType){case"Capacitor":return"C";case"Diode":return"D";case"Resistor":return"R";case"Semiconductor":return"Q";case"Passive":return"L";case"PowerEnergy":return"PS";case"Connector":return"J";case"Switch":return"S";case"Transformer":return"T";case"Other":default:return"?"}}function g5(s,e,t){let n=0;for(const d of e){if(!d.designator||!d.designator.startsWith(s))continue;const c=parseInt(d.designator.slice(s.length),10);!isNaN(c)&&c>n&&(n=c)}const o=(t[s]??n)+1;return t[s]=o,o}function m5(s,e,t){const n=p5(s),r=g5(n,e,t);return`${n}${r}`}function y5(s){const{definition:e,layer:t,x:n,y:r,color:o,size:d,designator:c,existingComponents:h=[],counters:f={}}=s,m=d&&d>0?d:yy.DEFAULT_SIZE,y=c||m5(e,h,f),A={id:a2("comp"),componentType:e.type,designator:y,layer:t,x:n,y:r,color:o,size:m,pinCount:e.defaultPins,pinConnections:new Array(e.defaultPins).fill(""),pinPolarities:void 0,notes:null,orientation:0,flipX:!1,flipY:!1,description:e.description};if(A.componentDefinitionKey=e.key,e.properties&&Object.assign(A,e.properties),e.properties?.pinNames&&Array.isArray(e.properties.pinNames)){const v=e.properties.pinNames;v.includes("CHIP_DEPENDENT")?A.pinNames=new Array(A.pinCount).fill(""):A.pinNames=new Array(A.pinCount).fill("").map((T,_)=>_<v.length?v[_]:"")}return e.fields&&e.fields.length>0&&e.fields.forEach(v=>{v.defaultValue!==void 0&&v.defaultValue!==""&&(A[v.name]=v.defaultValue),v.units&&v.defaultUnit&&(A[`${v.name}Unit`]=v.defaultUnit)}),A}function x5(){const s=document.createElement("canvas"),e=24;s.width=e,s.height=e;const t=s.getContext("2d");t.strokeStyle="#000",t.lineWidth=3,t.lineCap="round";const n=e/2,r=8;return t.beginPath(),t.moveTo(n,n-r),t.lineTo(n,n-2),t.moveTo(n,n+2),t.lineTo(n,n+r),t.moveTo(n-r,n),t.lineTo(n-2,n),t.moveTo(n+2,n),t.lineTo(n+r,n),t.stroke(),`url(${s.toDataURL()}) ${n} ${n}, crosshair`}function b5(s){const e=document.createElement("canvas"),t=Math.max(12,Math.min(s,32)),r=t+4*2;e.width=r,e.height=r;const o=e.getContext("2d"),d=r/2,c=r/2,h=t/2;return o.fillStyle="#FFFF00",o.strokeStyle="#000000",o.lineWidth=2,o.beginPath(),o.moveTo(d,c-h),o.lineTo(d+h,c),o.lineTo(d,c+h),o.lineTo(d-h,c),o.closePath(),o.fill(),o.stroke(),`url(${e.toDataURL()}) ${d} ${c}, crosshair`}function cx(){const s=new Date,e=s.getFullYear(),t=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0"),r=String(s.getHours()).padStart(2,"0"),o=String(s.getMinutes()).padStart(2,"0"),d=String(s.getSeconds()).padStart(2,"0");return`${e}_${t}_${n}-${r}-${o}-${d}`}function fh(s){let e=s.replace(/\.json$/i,""),t="";for(;t!==e;)t=e,e=e.replace(/_\d{4}_\d{2}_\d{2}-\d{2}-\d{2}-\d{2}$/,""),e=e.replace(/_\d{4}_\d{2}_\d{2}_\d{2}_\d{2}_\d{2}$/,"");return e}function mi(s,e,t,n){if(e==="power"){const o=s[e]||"";return typeof o=="string"&&o.trim()!==""?{value:o.replace(/W$/i,"").trim(),unit:"W"}:{value:"",unit:"W"}}if(s[e]!==void 0||s[t]!==void 0)return{value:s[e]||"",unit:s[t]||n};const r=s[e]||"";return typeof r=="string"&&r.trim()!==""?o2(r):{value:"",unit:n}}function o2(s){if(!s||s.trim()==="")return{value:"",unit:""};const e=s.trim(),t=e.match(/^([\d]+\/[\d]+)\s*([a-zA-ZuW]+)?$/);if(t)return{value:t[1],unit:t[2]||""};const n=e.match(/^([\d.]+)\s*([a-zA-ZuW]+)?$/);return n?{value:n[1],unit:n[2]||""}:{value:e,unit:""}}function ph(s,e){return!s||s.trim()===""?"":!e||e.trim()===""?s.trim():`${s.trim()}${e.trim()}`}function v5(){const[s,e]=U.useState([]),[t,n]=U.useState([]),[r,o]=U.useState(null),[d,c]=U.useState(null),[h,f]=U.useState(null),[m,y]=U.useState(!1),[A,v]=U.useState(null),N=U.useCallback((R,M)=>{M==="top"?e(B=>[...B,R]):n(B=>[...B,R])},[]),T=U.useCallback((R,M,B)=>{B==="top"?e(q=>q.map(G=>G.id===R?{...G,...M}:G)):n(q=>q.map(G=>G.id===R?{...G,...M}:G))},[]),_=U.useCallback((R,M)=>{M==="top"?e(B=>B.filter(q=>q.id!==R)):n(B=>B.filter(q=>q.id!==R))},[]),b=U.useCallback((R,M)=>{if(!R){console.error("[openComponentEditor] Component is null or undefined");return}if(!R.id||typeof R.id!="string"){console.error("[openComponentEditor] Component missing valid id property:",{component:R});return}const B=R.id;if(!R.componentType||typeof R.componentType!="string"){console.error("[openComponentEditor] Component missing valid componentType property:",{componentId:B,component:R});return}const q=R.componentType;if(typeof R.pinCount!="number"||R.pinCount<0){console.error("[openComponentEditor] Component missing valid pinCount property:",{componentId:B,componentType:q,pinCount:R.pinCount,component:R});return}if(M!=="top"&&M!=="bottom"){console.error("[openComponentEditor] Invalid layer parameter:",{layer:M,componentId:R.id});return}const G=R.designator||"",X=R.abbreviation||(G.length>0?G.charAt(0).toUpperCase():""),O=R.componentType,Y={visible:!0,layer:M,id:R.id,designator:G,abbreviation:X,manufacturer:"manufacturer"in R&&R.manufacturer||"",partNumber:"partNumber"in R&&R.partNumber||"",pinCount:R.pinCount,x:R.x,y:R.y,orientation:R.orientation??0,description:R.description||"",datasheet:R.datasheet||"",componentDefinitionKey:R.componentDefinitionKey||""};if(O==="Resistor"){const I=R,J=mi(I,"resistance","resistanceUnit",cn("resistance"));Y.resistance=J.value,Y.resistanceUnit=J.unit;const Z=mi(I,"power","powerUnit","W");Y.power=Z.value||"1/4",Y.tolerance=I.tolerance||"5%"}else if(O==="Capacitor"){const I=R,J=mi(I,"capacitance","capacitanceUnit",cn("capacitance"));Y.capacitance=J.value,Y.capacitanceUnit=J.unit;const Z=mi(I,"voltage","voltageUnit",cn("voltage"));Y.voltage=Z.value,Y.voltageUnit=Z.unit,Y.tolerance=I.tolerance||"10%",Y.dielectric=I.dielectric||"Ceramic"}else if(O==="Electrolytic Capacitor"){const I=R,J=mi(I,"capacitance","capacitanceUnit",cn("capacitance"));Y.capacitance=J.value,Y.capacitanceUnit=J.unit;const Z=mi(I,"voltage","voltageUnit",cn("voltage"));Y.voltage=Z.value,Y.voltageUnit=Z.unit,Y.tolerance=I.tolerance||"20%",Y.polarized=I.polarized!==void 0?I.polarized:!0;const Ce=mi(I,"esr","esrUnit",cn("esr"));Y.esr=Ce.value,Y.esrUnit=Ce.unit,Y.temperature=I.temperature||""}else if(O==="Film Capacitor"){const I=R,J=mi(I,"capacitance","capacitanceUnit",cn("capacitance"));Y.capacitance=J.value,Y.capacitanceUnit=J.unit;const Z=mi(I,"voltage","voltageUnit",cn("voltage"));Y.voltage=Z.value,Y.voltageUnit=Z.unit,Y.tolerance=I.tolerance||"10%",Y.filmType=I.filmType||"Polyester"}else if(O==="Diode"){const I=R;Y.diodeType=I.diodeType||"Standard";const J=mi(I,"voltage","voltageUnit",cn("voltage"));Y.voltage=J.value,Y.voltageUnit=J.unit;const Z=mi(I,"current","currentUnit",cn("current"));Y.current=Z.value,Y.currentUnit=Z.unit,Y.ledColor=I.ledColor||""}else if(O==="Battery"){const I=R,J=mi(I,"voltage","voltageUnit",cn("voltage"));Y.voltage=J.value,Y.voltageUnit=J.unit;const Z=mi(I,"capacity","capacityUnit",cn("capacity"));Y.capacity=Z.value,Y.capacityUnit=Z.unit,Y.chemistry=I.chemistry||"Li-ion"}else if(O==="Fuse"){const I=R,J=mi(I,"current","currentUnit",cn("current"));Y.current=J.value,Y.currentUnit=J.unit;const Z=mi(I,"voltage","voltageUnit",cn("voltage"));Y.voltage=Z.value,Y.voltageUnit=Z.unit,Y.fuseType=I.fuseType||"Fast-blow"}else if(O==="FerriteBead"){const I=R,J=mi(I,"impedance","impedanceUnit",cn("impedance"));Y.impedance=J.value,Y.impedanceUnit=J.unit;const Z=mi(I,"current","currentUnit",cn("current"));Y.current=Z.value,Y.currentUnit=Z.unit}else if(O==="Connector"){const I=R;Y.connectorType=I.connectorType||"",Y.gender=I.gender||"N/A"}else if(O==="Jumper"){const I=R;Y.positions=I.positions||3}else if(O==="Relay"){const I=R,J=mi(I,"coilVoltage","coilVoltageUnit",cn("coilVoltage"));Y.coilVoltage=J.value,Y.coilVoltageUnit=J.unit,Y.contactType=I.contactType||"SPST";const Z=mi(I,"current","currentUnit",cn("current"));Y.current=Z.value,Y.currentUnit=Z.unit}else if(O==="Inductor"){const I=R,J=mi(I,"inductance","inductanceUnit",cn("inductance"));Y.inductance=J.value,Y.inductanceUnit=J.unit;const Z=mi(I,"current","currentUnit",cn("current"));Y.current=Z.value,Y.currentUnit=Z.unit;const Ce=mi(I,"resistance","resistanceUnit",cn("resistance"));Y.resistance=Ce.value,Y.resistanceUnit=Ce.unit}else if(O==="Speaker"){const I=R,J=mi(I,"impedance","impedanceUnit",cn("impedance"));Y.impedance=J.value,Y.impedanceUnit=J.unit;const Z=mi(I,"power","powerUnit","W");Y.power=Z.value||"1"}else if(O==="Motor"){const I=R;Y.motorType=I.motorType||"DC";const J=mi(I,"voltage","voltageUnit",cn("voltage"));Y.voltage=J.value,Y.voltageUnit=J.unit;const Z=mi(I,"current","currentUnit",cn("current"));Y.current=Z.value,Y.currentUnit=Z.unit}else if(O==="PowerSupply"){const I=R,J=mi(I,"inputVoltage","inputVoltageUnit",cn("inputVoltage"));Y.inputVoltage=J.value,Y.inputVoltageUnit=J.unit;const Z=mi(I,"outputVoltage","outputVoltageUnit",cn("outputVoltage"));Y.outputVoltage=Z.value,Y.outputVoltageUnit=Z.unit;const Ce=mi(I,"current","currentUnit",cn("current"));Y.current=Ce.value,Y.currentUnit=Ce.unit}else if(O==="Transistor"){const I=R;Y.transistorType=I.transistorType||"BJT",Y.polarity=I.polarity||"NPN";const J=mi(I,"voltage","voltageUnit",cn("voltage"));Y.voltage=J.value,Y.voltageUnit=J.unit;const Z=mi(I,"current","currentUnit",cn("current"));Y.current=Z.value,Y.currentUnit=Z.unit}else if(O==="ResistorNetwork"){const I=R,J=mi(I,"resistance","resistanceUnit",cn("resistance"));Y.resistance=J.value,Y.resistanceUnit=J.unit,Y.configuration=I.configuration||""}else if(O==="Thermistor"){const I=R,J=mi(I,"resistance","resistanceUnit",cn("resistance"));Y.resistance=J.value,Y.resistanceUnit=J.unit,Y.thermistorType=I.thermistorType||"NTC",Y.beta=I.beta||""}else if(O==="Switch"){const I=R;Y.switchType=I.switchType||"Toggle";const J=mi(I,"current","currentUnit",cn("current"));Y.current=J.value,Y.currentUnit=J.unit;const Z=mi(I,"voltage","voltageUnit",cn("voltage"));Y.voltage=Z.value,Y.voltageUnit=Z.unit}else if(O==="Transformer"){const I=R,J=mi(I,"primaryVoltage","primaryVoltageUnit",cn("primaryVoltage"));Y.primaryVoltage=J.value,Y.primaryVoltageUnit=J.unit;const Z=mi(I,"secondaryVoltage","secondaryVoltageUnit",cn("secondaryVoltage"));Y.secondaryVoltage=Z.value,Y.secondaryVoltageUnit=Z.unit;const Ce=mi(I,"power","powerUnit",cn("power"));Y.power=Ce.value||"1",Y.turns=I.turns||""}else if(O==="TestPoint"){const I=R;Y.signal=I.signal||""}else if(O==="IntegratedCircuit"||O==="Semiconductor"){const I=R;Y.description=I.description||R.designator||"",Y.datasheet=I.datasheet||"",Y.datasheetFileName=I.datasheetFileName||void 0,Y.manufacturer=I.manufacturer||"",Y.partNumber=I.partNumber||"",Y.operatingTemperature=I.operatingTemperature||"",Y.packageType=I.packageType||"",console.log("[useComponents] Loading IC component - datasheet from component:",I.datasheet,"editor datasheet:",Y.datasheet,"datasheetFileName:",I.datasheetFileName),Y.icType=I.icType||"Op-Amp"}else if(O==="VacuumTube"){const I=R;Y.tubeType=I.tubeType||""}else if(O==="VariableResistor"){const I=R;Y.vrType=I.vrType||"Potentiometer";const J=mi(I,"resistance","resistanceUnit",cn("resistance"));Y.resistance=J.value,Y.resistanceUnit=J.unit;const Z=mi(I,"power","powerUnit",cn("power"));Y.power=Z.value||"1/4",Y.taper=I.taper||""}else if(O==="Crystal"){const I=R;Y.frequency=I.frequency||"",Y.loadCapacitance=I.loadCapacitance||"",Y.tolerance=I.tolerance||""}else if(O==="Diode"){const I=R;Y.diodeType=I.diodeType||"Standard";const J=mi(I,"voltage","voltageUnit",cn("voltage"));Y.voltage=J.value,Y.voltageUnit=J.unit;const Z=mi(I,"current","currentUnit",cn("current"));Y.current=Z.value,Y.currentUnit=Z.unit,Y.ledColor=I.ledColor||""}else if(O==="GenericComponent"){const I=R;Y.genericType=I.genericType||"Attenuator";const J=mi(I,"voltage","voltageUnit",cn("voltage"));Y.voltage=J.value,Y.voltageUnit=J.unit;const Z=mi(I,"current","currentUnit",cn("current"));Y.current=Z.value,Y.currentUnit=Z.unit,Y.power=I.power||"",Y.frequency=I.frequency||"",Y.model=I.model||""}const W=R.componentDefinitionKey;if(W){const I=Wu.find(J=>`${J.category}:${J.subcategory}:${J.type}`===W);I&&(Y.componentDefinition=I,Y.componentDefinitionKey=W)}o(Y)},[]),H=U.useCallback(()=>{o(null),c(null)},[]);return{componentsTop:s,setComponentsTop:e,componentsBottom:t,setComponentsBottom:n,componentEditor:r,setComponentEditor:o,connectingPin:d,setConnectingPin:c,componentDialogPosition:h,setComponentDialogPosition:f,isDraggingDialog:m,setIsDraggingDialog:y,dialogDragOffset:A,setDialogDragOffset:v,addComponent:N,updateComponent:T,removeComponent:_,openComponentEditor:b,closeComponentEditor:H}}function gh(s){return{resistance:"",capacitance:"F",inductance:"H",voltage:"V",current:"A",power:"W",impedance:"",capacity:"mAh",esr:"",coilVoltage:"V",inputVoltage:"V",outputVoltage:"V"}[s]||""}function mh(s,e,t,n){if(e==="power"){const o=s[e]||"";return typeof o=="string"&&o.trim()!==""?{value:o.replace(/W$/i,"").trim(),unit:"W"}:{value:"",unit:"W"}}if(s[e]!==void 0||s[t]!==void 0)return{value:s[e]||"",unit:s[t]||n};const r=s[e]||"";return typeof r=="string"&&r.trim()!==""?o2(r):{value:"",unit:n}}function w5(s){if((s.componentType==="Resistor"||s.componentType==="ResistorNetwork"||s.componentType==="Thermistor"||s.componentType==="VariableResistor")&&"resistance"in s){const{value:n,unit:r}=mh(s,"resistance","resistanceUnit",gh("resistance"));if(n&&n.trim()!=="")return ph(n,r)}if((s.componentType==="Capacitor"||s.componentType==="Electrolytic Capacitor"||s.componentType==="Film Capacitor")&&"capacitance"in s){const{value:n,unit:r}=mh(s,"capacitance","capacitanceUnit",gh("capacitance"));if(n&&n.trim()!=="")return ph(n,r)}if(s.componentType==="Inductor"&&"inductance"in s){const{value:n,unit:r}=mh(s,"inductance","inductanceUnit",gh("inductance"));if(n&&n.trim()!=="")return ph(n,r)}if(s.componentType==="Fuse"&&"current"in s){const{value:n,unit:r}=mh(s,"current","currentUnit",gh("current"));if(n&&n.trim()!=="")return ph(n,r)}if(s.componentType==="Battery"){const{value:n,unit:r}=mh(s,"capacity","capacityUnit",gh("capacity"));if(n&&n.trim()!=="")return ph(n,r);const{value:o,unit:d}=mh(s,"voltage","voltageUnit",gh("voltage"));if(o&&o.trim()!=="")return ph(o,d)}if(s.componentType==="PowerSupply"){const{value:n,unit:r}=mh(s,"outputVoltage","outputVoltageUnit",gh("voltage"));if(n&&n.trim()!=="")return ph(n,r)}const e=s.partName?.trim();if(e&&e!=="")return e;const t=s.partNumber?.trim();return t&&t!==""?t:wc(s.componentType)}function S5(s,e,t){const n=[...s,...e],r=n.length,o=new Map;for(const c of n){const h=wc(c.componentType),f=w5(c),m=`${h}|${f}`;if(!o.has(m)){const A=s.some(T=>T.id===c.id),v=e.some(T=>T.id===c.id),N=A&&v?"both":A?"top":"bottom";o.set(m,{componentType:h,value:f,quantity:0,designators:[],packageType:c.packageType,manufacturer:c.manufacturer,partNumber:c.partNumber,description:c.description,notes:c.notes,datasheet:c.datasheet,layer:N})}const y=o.get(m);y.quantity++,c.designator&&c.designator.trim()!==""&&y.designators.push(c.designator.trim())}const d=Array.from(o.values()).sort((c,h)=>c.componentType!==h.componentType?c.componentType.localeCompare(h.componentType):c.value.localeCompare(h.value));return{version:"1.0",exportedAt:new Date().toISOString(),projectName:t,totalComponents:r,uniqueComponents:d.length,items:d}}const A5="modulepreload",C5=function(s){return"/PCB_Reverse_Engineering_Tool/"+s},dx={},cm=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let h=function(f){return Promise.all(f.map(m=>Promise.resolve(m).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),c=d?.nonce||d?.getAttribute("nonce");r=h(t.map(f=>{if(f=C5(f),f in dx)return;dx[f]=!0;const m=f.endsWith(".css"),y=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${y}`))return;const A=document.createElement("link");if(A.rel=m?"stylesheet":A5,m||(A.as="script"),A.crossOrigin="",A.href=f,c&&A.setAttribute("nonce",c),document.head.appendChild(A),m)return new Promise((v,N)=>{A.addEventListener("load",v),A.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${f}`)))})}))}function o(d){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=d,window.dispatchEvent(c),!c.defaultPrevented)throw d}return r.then(d=>{for(const c of d||[])c.status==="rejected"&&o(c.reason);return e().catch(o)})};function zr(s){"@babel/helpers - typeof";return zr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zr(s)}var ld=Uint8Array,Sc=Uint16Array,by=Int32Array,vy=new ld([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wy=new ld([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ux=new ld([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l2=function(s,e){for(var t=new Sc(31),n=0;n<31;++n)t[n]=e+=1<<s[n-1];for(var r=new by(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)r[o]=o-t[n]<<5|n;return{b:t,r}},c2=l2(vy,2),T5=c2.b,Wm=c2.r;T5[28]=258,Wm[258]=28;var k5=l2(wy,0),hx=k5.r,$m=new Sc(32768);for(var bs=0;bs<32768;++bs){var Ou=(bs&43690)>>1|(bs&21845)<<1;Ou=(Ou&52428)>>2|(Ou&13107)<<2,Ou=(Ou&61680)>>4|(Ou&3855)<<4,$m[bs]=((Ou&65280)>>8|(Ou&255)<<8)>>1}var hp=(function(s,e,t){for(var n=s.length,r=0,o=new Sc(e);r<n;++r)s[r]&&++o[s[r]-1];var d=new Sc(e);for(r=1;r<e;++r)d[r]=d[r-1]+o[r-1]<<1;var c;if(t){c=new Sc(1<<e);var h=15-e;for(r=0;r<n;++r)if(s[r])for(var f=r<<4|s[r],m=e-s[r],y=d[s[r]-1]++<<m,A=y|(1<<m)-1;y<=A;++y)c[$m[y]>>h]=f}else for(c=new Sc(n),r=0;r<n;++r)s[r]&&(c[r]=$m[d[s[r]-1]++]>>15-s[r]);return c}),Ch=new ld(288);for(var bs=0;bs<144;++bs)Ch[bs]=8;for(var bs=144;bs<256;++bs)Ch[bs]=9;for(var bs=256;bs<280;++bs)Ch[bs]=7;for(var bs=280;bs<288;++bs)Ch[bs]=8;var Qg=new ld(32);for(var bs=0;bs<32;++bs)Qg[bs]=5;var _5=hp(Ch,9,0),j5=hp(Qg,5,0),d2=function(s){return(s+7)/8|0},N5=function(s,e,t){return(t==null||t>s.length)&&(t=s.length),new ld(s.subarray(e,t))},iu=function(s,e,t){t<<=e&7;var n=e/8|0;s[n]|=t,s[n+1]|=t>>8},ep=function(s,e,t){t<<=e&7;var n=e/8|0;s[n]|=t,s[n+1]|=t>>8,s[n+2]|=t>>16},dm=function(s,e){for(var t=[],n=0;n<s.length;++n)s[n]&&t.push({s:n,f:s[n]});var r=t.length,o=t.slice();if(!r)return{t:h2,l:0};if(r==1){var d=new ld(t[0].s+1);return d[t[0].s]=1,{t:d,l:1}}t.sort(function(B,q){return B.f-q.f}),t.push({s:-1,f:25001});var c=t[0],h=t[1],f=0,m=1,y=2;for(t[0]={s:-1,f:c.f+h.f,l:c,r:h};m!=r-1;)c=t[t[f].f<t[y].f?f++:y++],h=t[f!=m&&t[f].f<t[y].f?f++:y++],t[m++]={s:-1,f:c.f+h.f,l:c,r:h};for(var A=o[0].s,n=1;n<r;++n)o[n].s>A&&(A=o[n].s);var v=new Sc(A+1),N=Gm(t[m-1],v,0);if(N>e){var n=0,T=0,_=N-e,b=1<<_;for(o.sort(function(q,G){return v[G.s]-v[q.s]||q.f-G.f});n<r;++n){var H=o[n].s;if(v[H]>e)T+=b-(1<<N-v[H]),v[H]=e;else break}for(T>>=_;T>0;){var R=o[n].s;v[R]<e?T-=1<<e-v[R]++-1:++n}for(;n>=0&&T;--n){var M=o[n].s;v[M]==e&&(--v[M],++T)}N=e}return{t:new ld(v),l:N}},Gm=function(s,e,t){return s.s==-1?Math.max(Gm(s.l,e,t+1),Gm(s.r,e,t+1)):e[s.s]=t},fx=function(s){for(var e=s.length;e&&!s[--e];);for(var t=new Sc(++e),n=0,r=s[0],o=1,d=function(h){t[n++]=h},c=1;c<=e;++c)if(s[c]==r&&c!=e)++o;else{if(!r&&o>2){for(;o>138;o-=138)d(32754);o>2&&(d(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(d(r),--o;o>6;o-=6)d(8304);o>2&&(d(o-3<<5|8208),o=0)}for(;o--;)d(r);o=1,r=s[c]}return{c:t.subarray(0,n),n:e}},tp=function(s,e){for(var t=0,n=0;n<e.length;++n)t+=s[n]*e[n];return t},u2=function(s,e,t){var n=t.length,r=d2(e+2);s[r]=n&255,s[r+1]=n>>8,s[r+2]=s[r]^255,s[r+3]=s[r+1]^255;for(var o=0;o<n;++o)s[r+o+4]=t[o];return(r+4+n)*8},px=function(s,e,t,n,r,o,d,c,h,f,m){iu(e,m++,t),++r[256];for(var y=dm(r,15),A=y.t,v=y.l,N=dm(o,15),T=N.t,_=N.l,b=fx(A),H=b.c,R=b.n,M=fx(T),B=M.c,q=M.n,G=new Sc(19),X=0;X<H.length;++X)++G[H[X]&31];for(var X=0;X<B.length;++X)++G[B[X]&31];for(var O=dm(G,7),Y=O.t,W=O.l,I=19;I>4&&!Y[ux[I-1]];--I);var J=f+5<<3,Z=tp(r,Ch)+tp(o,Qg)+d,Ce=tp(r,A)+tp(o,T)+d+14+3*I+tp(G,Y)+2*G[16]+3*G[17]+7*G[18];if(h>=0&&J<=Z&&J<=Ce)return u2(e,m,s.subarray(h,h+f));var ie,le,se,Ae;if(iu(e,m,1+(Ce<Z)),m+=2,Ce<Z){ie=hp(A,v,0),le=A,se=hp(T,_,0),Ae=T;var ue=hp(Y,W,0);iu(e,m,R-257),iu(e,m+5,q-1),iu(e,m+10,I-4),m+=14;for(var X=0;X<I;++X)iu(e,m+3*X,Y[ux[X]]);m+=3*I;for(var E=[H,B],L=0;L<2;++L)for(var Q=E[L],X=0;X<Q.length;++X){var ee=Q[X]&31;iu(e,m,ue[ee]),m+=Y[ee],ee>15&&(iu(e,m,Q[X]>>5&127),m+=Q[X]>>12)}}else ie=_5,le=Ch,se=j5,Ae=Qg;for(var X=0;X<c;++X){var oe=n[X];if(oe>255){var ee=oe>>18&31;ep(e,m,ie[ee+257]),m+=le[ee+257],ee>7&&(iu(e,m,oe>>23&31),m+=vy[ee]);var xe=oe&31;ep(e,m,se[xe]),m+=Ae[xe],xe>3&&(ep(e,m,oe>>5&8191),m+=wy[xe])}else ep(e,m,ie[oe]),m+=le[oe]}return ep(e,m,ie[256]),m+le[256]},P5=new by([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),h2=new ld(0),E5=function(s,e,t,n,r,o){var d=o.z||s.length,c=new ld(n+d+5*(1+Math.ceil(d/7e3))+r),h=c.subarray(n,c.length-r),f=o.l,m=(o.r||0)&7;if(e){m&&(h[0]=o.r>>3);for(var y=P5[e-1],A=y>>13,v=y&8191,N=(1<<t)-1,T=o.p||new Sc(32768),_=o.h||new Sc(N+1),b=Math.ceil(t/3),H=2*b,R=function(Mt){return(s[Mt]^s[Mt+1]<<b^s[Mt+2]<<H)&N},M=new by(25e3),B=new Sc(288),q=new Sc(32),G=0,X=0,O=o.i||0,Y=0,W=o.w||0,I=0;O+2<d;++O){var J=R(O),Z=O&32767,Ce=_[J];if(T[Z]=Ce,_[J]=Z,W<=O){var ie=d-O;if((G>7e3||Y>24576)&&(ie>423||!f)){m=px(s,h,0,M,B,q,X,Y,I,O-I,m),Y=G=X=0,I=O;for(var le=0;le<286;++le)B[le]=0;for(var le=0;le<30;++le)q[le]=0}var se=2,Ae=0,ue=v,E=Z-Ce&32767;if(ie>2&&J==R(O-E))for(var L=Math.min(A,ie)-1,Q=Math.min(32767,O),ee=Math.min(258,ie);E<=Q&&--ue&&Z!=Ce;){if(s[O+se]==s[O+se-E]){for(var oe=0;oe<ee&&s[O+oe]==s[O+oe-E];++oe);if(oe>se){if(se=oe,Ae=E,oe>L)break;for(var xe=Math.min(E,oe-2),re=0,le=0;le<xe;++le){var Le=O-E+le&32767,Ee=T[Le],Oe=Le-Ee&32767;Oe>re&&(re=Oe,Ce=Le)}}}Z=Ce,Ce=T[Z],E+=Z-Ce&32767}if(Ae){M[Y++]=268435456|Wm[se]<<18|hx[Ae];var Ze=Wm[se]&31,st=hx[Ae]&31;X+=vy[Ze]+wy[st],++B[257+Ze],++q[st],W=O+se,++G}else M[Y++]=s[O],++B[s[O]]}}for(O=Math.max(O,W);O<d;++O)M[Y++]=s[O],++B[s[O]];m=px(s,h,f,M,B,q,X,Y,I,O-I,m),f||(o.r=m&7|h[m/8|0]<<3,m-=7,o.h=_,o.p=T,o.i=O,o.w=W)}else{for(var O=o.w||0;O<d+f;O+=65535){var mt=O+65535;mt>=d&&(h[m/8|0]=f,mt=d),m=u2(h,m+1,s.subarray(O,mt))}o.i=d}return N5(c,0,n+d2(m)+r)},f2=function(){var s=1,e=0;return{p:function(t){for(var n=s,r=e,o=t.length|0,d=0;d!=o;){for(var c=Math.min(d+2655,o);d<c;++d)r+=n+=t[d];n=(n&65535)+15*(n>>16),r=(r&65535)+15*(r>>16)}s=n,e=r},d:function(){return s%=65521,e%=65521,(s&255)<<24|(s&65280)<<8|(e&255)<<8|e>>8}}},R5=function(s,e,t,n,r){if(!r&&(r={l:1},e.dictionary)){var o=e.dictionary.subarray(-32768),d=new ld(o.length+s.length);d.set(o),d.set(s,o.length),s=d,r.w=o.length}return E5(s,e.level==null?6:e.level,e.mem==null?r.l?Math.ceil(Math.max(8,Math.min(13,Math.log(s.length)))*1.5):20:12+e.mem,t,n,r)},p2=function(s,e,t){for(;t;++e)s[e]=t,t>>>=8},D5=function(s,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;if(s[0]=120,s[1]=n<<6|(e.dictionary&&32),s[1]|=31-(s[0]<<8|s[1])%31,e.dictionary){var r=f2();r.p(e.dictionary),p2(s,2,r.d())}};function Ym(s,e){e||(e={});var t=f2();t.p(s);var n=R5(s,e,e.dictionary?6:2,4);return D5(n,e),p2(n,n.length-4,t.d()),n}var L5=typeof TextDecoder<"u"&&new TextDecoder,M5=0;try{L5.decode(h2,{stream:!0}),M5=1}catch{}function I5(s){if(Array.isArray(s))return s}function z5(s,e){var t=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(t!=null){var n,r,o,d,c=[],h=!0,f=!1;try{if(o=(t=t.call(s)).next,e!==0)for(;!(h=(n=o.call(t)).done)&&(c.push(n.value),c.length!==e);h=!0);}catch(m){f=!0,r=m}finally{try{if(!h&&t.return!=null&&(d=t.return(),Object(d)!==d))return}finally{if(f)throw r}}return c}}function gx(s,e){(e==null||e>s.length)&&(e=s.length);for(var t=0,n=Array(e);t<e;t++)n[t]=s[t];return n}function B5(s,e){if(s){if(typeof s=="string")return gx(s,e);var t={}.toString.call(s).slice(8,-1);return t==="Object"&&s.constructor&&(t=s.constructor.name),t==="Map"||t==="Set"?Array.from(s):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?gx(s,e):void 0}}function F5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mx(s,e){return I5(s)||z5(s,e)||B5(s,e)||F5()}function yx(s,e="utf8"){return new TextDecoder(e).decode(s)}const O5=new TextEncoder;function U5(s){return O5.encode(s)}const H5=1024*8,V5=(()=>{const s=new Uint8Array(4),e=new Uint32Array(s.buffer);return!((e[0]=1)&s[0])})(),um={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Sy{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(e=H5,t={}){let n=!1;typeof e=="number"?e=new ArrayBuffer(e):(n=!0,this.lastWrittenByte=e.byteLength);const r=t.offset?t.offset>>>0:0,o=e.byteLength-r;let d=r;(ArrayBuffer.isView(e)||e instanceof Sy)&&(e.byteLength!==e.buffer.byteLength&&(d=e.byteOffset+r),e=e.buffer),n?this.lastWrittenByte=o:this.lastWrittenByte=0,this.buffer=e,this.length=o,this.byteLength=o,this.byteOffset=d,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,d,o),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const n=(this.offset+e)*2,r=new Uint8Array(n);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=n,this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const n=um[t].BYTES_PER_ELEMENT*e,r=this.byteOffset+this.offset,o=this.buffer.slice(r,r+n);if(this.littleEndian===V5&&t!=="uint8"&&t!=="int8"){const c=new Uint8Array(this.buffer.slice(r,r+n));c.reverse();const h=new um[t](c.buffer);return this.offset+=n,h.reverse(),h}const d=new um[t](o);return this.offset+=n,d}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let n=0;n<e;n++)t+=this.readChar();return t}readUtf8(e=1){return yx(this.readBytes(e))}decodeText(e=1,t="utf8"){return yx(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(U5(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function kf(s){let e=s.length;for(;--e>=0;)s[e]=0}const q5=3,W5=258,g2=29,$5=256,G5=$5+1+g2,m2=30,Y5=512,X5=new Array((G5+2)*2);kf(X5);const K5=new Array(m2*2);kf(K5);const Z5=new Array(Y5);kf(Z5);const J5=new Array(W5-q5+1);kf(J5);const Q5=new Array(g2);kf(Q5);const eS=new Array(m2);kf(eS);const tS=(s,e,t,n)=>{let r=s&65535|0,o=s>>>16&65535|0,d=0;for(;t!==0;){d=t>2e3?2e3:t,t-=d;do r=r+e[n++]|0,o=o+r|0;while(--d);r%=65521,o%=65521}return r|o<<16|0};var Xm=tS;const nS=()=>{let s,e=[];for(var t=0;t<256;t++){s=t;for(var n=0;n<8;n++)s=s&1?3988292384^s>>>1:s>>>1;e[t]=s}return e},iS=new Uint32Array(nS()),rS=(s,e,t,n)=>{const r=iS,o=n+t;s^=-1;for(let d=n;d<o;d++)s=s>>>8^r[(s^e[d])&255];return s^-1};var Nd=rS,Km={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},y2={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const sS=(s,e)=>Object.prototype.hasOwnProperty.call(s,e);var aS=function(s){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const n in t)sS(t,n)&&(s[n]=t[n])}}return s},oS=s=>{let e=0;for(let n=0,r=s.length;n<r;n++)e+=s[n].length;const t=new Uint8Array(e);for(let n=0,r=0,o=s.length;n<o;n++){let d=s[n];t.set(d,r),r+=d.length}return t},x2={assign:aS,flattenChunks:oS};let b2=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{b2=!1}const gp=new Uint8Array(256);for(let s=0;s<256;s++)gp[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;gp[254]=gp[254]=1;var lS=s=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(s);let e,t,n,r,o,d=s.length,c=0;for(r=0;r<d;r++)t=s.charCodeAt(r),(t&64512)===55296&&r+1<d&&(n=s.charCodeAt(r+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),r++)),c+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(c),o=0,r=0;o<c;r++)t=s.charCodeAt(r),(t&64512)===55296&&r+1<d&&(n=s.charCodeAt(r+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),r++)),t<128?e[o++]=t:t<2048?(e[o++]=192|t>>>6,e[o++]=128|t&63):t<65536?(e[o++]=224|t>>>12,e[o++]=128|t>>>6&63,e[o++]=128|t&63):(e[o++]=240|t>>>18,e[o++]=128|t>>>12&63,e[o++]=128|t>>>6&63,e[o++]=128|t&63);return e};const cS=(s,e)=>{if(e<65534&&s.subarray&&b2)return String.fromCharCode.apply(null,s.length===e?s:s.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(s[n]);return t};var dS=(s,e)=>{const t=e||s.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(s.subarray(0,e));let n,r;const o=new Array(t*2);for(r=0,n=0;n<t;){let d=s[n++];if(d<128){o[r++]=d;continue}let c=gp[d];if(c>4){o[r++]=65533,n+=c-1;continue}for(d&=c===2?31:c===3?15:7;c>1&&n<t;)d=d<<6|s[n++]&63,c--;if(c>1){o[r++]=65533;continue}d<65536?o[r++]=d:(d-=65536,o[r++]=55296|d>>10&1023,o[r++]=56320|d&1023)}return cS(o,r)},uS=(s,e)=>{e=e||s.length,e>s.length&&(e=s.length);let t=e-1;for(;t>=0&&(s[t]&192)===128;)t--;return t<0||t===0?e:t+gp[s[t]]>e?t:e},Zm={string2buf:lS,buf2string:dS,utf8border:uS};function hS(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var fS=hS;const Cg=16209,pS=16191;var gS=function(e,t){let n,r,o,d,c,h,f,m,y,A,v,N,T,_,b,H,R,M,B,q,G,X,O,Y;const W=e.state;n=e.next_in,O=e.input,r=n+(e.avail_in-5),o=e.next_out,Y=e.output,d=o-(t-e.avail_out),c=o+(e.avail_out-257),h=W.dmax,f=W.wsize,m=W.whave,y=W.wnext,A=W.window,v=W.hold,N=W.bits,T=W.lencode,_=W.distcode,b=(1<<W.lenbits)-1,H=(1<<W.distbits)-1;e:do{N<15&&(v+=O[n++]<<N,N+=8,v+=O[n++]<<N,N+=8),R=T[v&b];t:for(;;){if(M=R>>>24,v>>>=M,N-=M,M=R>>>16&255,M===0)Y[o++]=R&65535;else if(M&16){B=R&65535,M&=15,M&&(N<M&&(v+=O[n++]<<N,N+=8),B+=v&(1<<M)-1,v>>>=M,N-=M),N<15&&(v+=O[n++]<<N,N+=8,v+=O[n++]<<N,N+=8),R=_[v&H];n:for(;;){if(M=R>>>24,v>>>=M,N-=M,M=R>>>16&255,M&16){if(q=R&65535,M&=15,N<M&&(v+=O[n++]<<N,N+=8,N<M&&(v+=O[n++]<<N,N+=8)),q+=v&(1<<M)-1,q>h){e.msg="invalid distance too far back",W.mode=Cg;break e}if(v>>>=M,N-=M,M=o-d,q>M){if(M=q-M,M>m&&W.sane){e.msg="invalid distance too far back",W.mode=Cg;break e}if(G=0,X=A,y===0){if(G+=f-M,M<B){B-=M;do Y[o++]=A[G++];while(--M);G=o-q,X=Y}}else if(y<M){if(G+=f+y-M,M-=y,M<B){B-=M;do Y[o++]=A[G++];while(--M);if(G=0,y<B){M=y,B-=M;do Y[o++]=A[G++];while(--M);G=o-q,X=Y}}}else if(G+=y-M,M<B){B-=M;do Y[o++]=A[G++];while(--M);G=o-q,X=Y}for(;B>2;)Y[o++]=X[G++],Y[o++]=X[G++],Y[o++]=X[G++],B-=3;B&&(Y[o++]=X[G++],B>1&&(Y[o++]=X[G++]))}else{G=o-q;do Y[o++]=Y[G++],Y[o++]=Y[G++],Y[o++]=Y[G++],B-=3;while(B>2);B&&(Y[o++]=Y[G++],B>1&&(Y[o++]=Y[G++]))}}else if((M&64)===0){R=_[(R&65535)+(v&(1<<M)-1)];continue n}else{e.msg="invalid distance code",W.mode=Cg;break e}break}}else if((M&64)===0){R=T[(R&65535)+(v&(1<<M)-1)];continue t}else if(M&32){W.mode=pS;break e}else{e.msg="invalid literal/length code",W.mode=Cg;break e}break}}while(n<r&&o<c);B=N>>3,n-=B,N-=B<<3,v&=(1<<N)-1,e.next_in=n,e.next_out=o,e.avail_in=n<r?5+(r-n):5-(n-r),e.avail_out=o<c?257+(c-o):257-(o-c),W.hold=v,W.bits=N};const tf=15,xx=852,bx=592,vx=0,hm=1,wx=2,mS=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),yS=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),xS=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),bS=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),vS=(s,e,t,n,r,o,d,c)=>{const h=c.bits;let f=0,m=0,y=0,A=0,v=0,N=0,T=0,_=0,b=0,H=0,R,M,B,q,G,X=null,O;const Y=new Uint16Array(tf+1),W=new Uint16Array(tf+1);let I=null,J,Z,Ce;for(f=0;f<=tf;f++)Y[f]=0;for(m=0;m<n;m++)Y[e[t+m]]++;for(v=h,A=tf;A>=1&&Y[A]===0;A--);if(v>A&&(v=A),A===0)return r[o++]=1<<24|64<<16|0,r[o++]=1<<24|64<<16|0,c.bits=1,0;for(y=1;y<A&&Y[y]===0;y++);for(v<y&&(v=y),_=1,f=1;f<=tf;f++)if(_<<=1,_-=Y[f],_<0)return-1;if(_>0&&(s===vx||A!==1))return-1;for(W[1]=0,f=1;f<tf;f++)W[f+1]=W[f]+Y[f];for(m=0;m<n;m++)e[t+m]!==0&&(d[W[e[t+m]]++]=m);if(s===vx?(X=I=d,O=20):s===hm?(X=mS,I=yS,O=257):(X=xS,I=bS,O=0),H=0,m=0,f=y,G=o,N=v,T=0,B=-1,b=1<<v,q=b-1,s===hm&&b>xx||s===wx&&b>bx)return 1;for(;;){J=f-T,d[m]+1<O?(Z=0,Ce=d[m]):d[m]>=O?(Z=I[d[m]-O],Ce=X[d[m]-O]):(Z=96,Ce=0),R=1<<f-T,M=1<<N,y=M;do M-=R,r[G+(H>>T)+M]=J<<24|Z<<16|Ce|0;while(M!==0);for(R=1<<f-1;H&R;)R>>=1;if(R!==0?(H&=R-1,H+=R):H=0,m++,--Y[f]===0){if(f===A)break;f=e[t+d[m]]}if(f>v&&(H&q)!==B){for(T===0&&(T=v),G+=y,N=f-T,_=1<<N;N+T<A&&(_-=Y[N+T],!(_<=0));)N++,_<<=1;if(b+=1<<N,s===hm&&b>xx||s===wx&&b>bx)return 1;B=H&q,r[B]=v<<24|N<<16|G-o|0}}return H!==0&&(r[G+H]=f-T<<24|64<<16|0),c.bits=v,0};var fp=vS;const wS=0,v2=1,w2=2,{Z_FINISH:Sx,Z_BLOCK:SS,Z_TREES:Tg,Z_OK:Th,Z_STREAM_END:AS,Z_NEED_DICT:CS,Z_STREAM_ERROR:qc,Z_DATA_ERROR:S2,Z_MEM_ERROR:A2,Z_BUF_ERROR:TS,Z_DEFLATED:Ax}=y2,l0=16180,Cx=16181,Tx=16182,kx=16183,_x=16184,jx=16185,Nx=16186,Px=16187,Ex=16188,Rx=16189,e0=16190,ru=16191,fm=16192,Dx=16193,pm=16194,Lx=16195,Mx=16196,Ix=16197,zx=16198,kg=16199,_g=16200,Bx=16201,Fx=16202,Ox=16203,Ux=16204,Hx=16205,gm=16206,Vx=16207,qx=16208,ks=16209,C2=16210,T2=16211,kS=852,_S=592,jS=15,NS=jS,Wx=s=>(s>>>24&255)+(s>>>8&65280)+((s&65280)<<8)+((s&255)<<24);function PS(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const jh=s=>{if(!s)return 1;const e=s.state;return!e||e.strm!==s||e.mode<l0||e.mode>T2?1:0},k2=s=>{if(jh(s))return qc;const e=s.state;return s.total_in=s.total_out=e.total=0,s.msg="",e.wrap&&(s.adler=e.wrap&1),e.mode=l0,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(kS),e.distcode=e.distdyn=new Int32Array(_S),e.sane=1,e.back=-1,Th},_2=s=>{if(jh(s))return qc;const e=s.state;return e.wsize=0,e.whave=0,e.wnext=0,k2(s)},j2=(s,e)=>{let t;if(jh(s))return qc;const n=s.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?qc:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,_2(s))},N2=(s,e)=>{if(!s)return qc;const t=new PS;s.state=t,t.strm=s,t.window=null,t.mode=l0;const n=j2(s,e);return n!==Th&&(s.state=null),n},ES=s=>N2(s,NS);let $x=!0,mm,ym;const RS=s=>{if($x){mm=new Int32Array(512),ym=new Int32Array(32);let e=0;for(;e<144;)s.lens[e++]=8;for(;e<256;)s.lens[e++]=9;for(;e<280;)s.lens[e++]=7;for(;e<288;)s.lens[e++]=8;for(fp(v2,s.lens,0,288,mm,0,s.work,{bits:9}),e=0;e<32;)s.lens[e++]=5;fp(w2,s.lens,0,32,ym,0,s.work,{bits:5}),$x=!1}s.lencode=mm,s.lenbits=9,s.distcode=ym,s.distbits=5},P2=(s,e,t,n)=>{let r;const o=s.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(e.subarray(t-o.wsize,t),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>n&&(r=n),o.window.set(e.subarray(t-n,t-n+r),o.wnext),n-=r,n?(o.window.set(e.subarray(t-n,t),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0},DS=(s,e)=>{let t,n,r,o,d,c,h,f,m,y,A,v,N,T,_=0,b,H,R,M,B,q,G,X;const O=new Uint8Array(4);let Y,W;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(jh(s)||!s.output||!s.input&&s.avail_in!==0)return qc;t=s.state,t.mode===ru&&(t.mode=fm),d=s.next_out,r=s.output,h=s.avail_out,o=s.next_in,n=s.input,c=s.avail_in,f=t.hold,m=t.bits,y=c,A=h,X=Th;e:for(;;)switch(t.mode){case l0:if(t.wrap===0){t.mode=fm;break}for(;m<16;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}if(t.wrap&2&&f===35615){t.wbits===0&&(t.wbits=15),t.check=0,O[0]=f&255,O[1]=f>>>8&255,t.check=Nd(t.check,O,2,0),f=0,m=0,t.mode=Cx;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((f&255)<<8)+(f>>8))%31){s.msg="incorrect header check",t.mode=ks;break}if((f&15)!==Ax){s.msg="unknown compression method",t.mode=ks;break}if(f>>>=4,m-=4,G=(f&15)+8,t.wbits===0&&(t.wbits=G),G>15||G>t.wbits){s.msg="invalid window size",t.mode=ks;break}t.dmax=1<<t.wbits,t.flags=0,s.adler=t.check=1,t.mode=f&512?Rx:ru,f=0,m=0;break;case Cx:for(;m<16;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}if(t.flags=f,(t.flags&255)!==Ax){s.msg="unknown compression method",t.mode=ks;break}if(t.flags&57344){s.msg="unknown header flags set",t.mode=ks;break}t.head&&(t.head.text=f>>8&1),t.flags&512&&t.wrap&4&&(O[0]=f&255,O[1]=f>>>8&255,t.check=Nd(t.check,O,2,0)),f=0,m=0,t.mode=Tx;case Tx:for(;m<32;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}t.head&&(t.head.time=f),t.flags&512&&t.wrap&4&&(O[0]=f&255,O[1]=f>>>8&255,O[2]=f>>>16&255,O[3]=f>>>24&255,t.check=Nd(t.check,O,4,0)),f=0,m=0,t.mode=kx;case kx:for(;m<16;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}t.head&&(t.head.xflags=f&255,t.head.os=f>>8),t.flags&512&&t.wrap&4&&(O[0]=f&255,O[1]=f>>>8&255,t.check=Nd(t.check,O,2,0)),f=0,m=0,t.mode=_x;case _x:if(t.flags&1024){for(;m<16;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}t.length=f,t.head&&(t.head.extra_len=f),t.flags&512&&t.wrap&4&&(O[0]=f&255,O[1]=f>>>8&255,t.check=Nd(t.check,O,2,0)),f=0,m=0}else t.head&&(t.head.extra=null);t.mode=jx;case jx:if(t.flags&1024&&(v=t.length,v>c&&(v=c),v&&(t.head&&(G=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(o,o+v),G)),t.flags&512&&t.wrap&4&&(t.check=Nd(t.check,n,v,o)),c-=v,o+=v,t.length-=v),t.length))break e;t.length=0,t.mode=Nx;case Nx:if(t.flags&2048){if(c===0)break e;v=0;do G=n[o+v++],t.head&&G&&t.length<65536&&(t.head.name+=String.fromCharCode(G));while(G&&v<c);if(t.flags&512&&t.wrap&4&&(t.check=Nd(t.check,n,v,o)),c-=v,o+=v,G)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=Px;case Px:if(t.flags&4096){if(c===0)break e;v=0;do G=n[o+v++],t.head&&G&&t.length<65536&&(t.head.comment+=String.fromCharCode(G));while(G&&v<c);if(t.flags&512&&t.wrap&4&&(t.check=Nd(t.check,n,v,o)),c-=v,o+=v,G)break e}else t.head&&(t.head.comment=null);t.mode=Ex;case Ex:if(t.flags&512){for(;m<16;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}if(t.wrap&4&&f!==(t.check&65535)){s.msg="header crc mismatch",t.mode=ks;break}f=0,m=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),s.adler=t.check=0,t.mode=ru;break;case Rx:for(;m<32;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}s.adler=t.check=Wx(f),f=0,m=0,t.mode=e0;case e0:if(t.havedict===0)return s.next_out=d,s.avail_out=h,s.next_in=o,s.avail_in=c,t.hold=f,t.bits=m,CS;s.adler=t.check=1,t.mode=ru;case ru:if(e===SS||e===Tg)break e;case fm:if(t.last){f>>>=m&7,m-=m&7,t.mode=gm;break}for(;m<3;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}switch(t.last=f&1,f>>>=1,m-=1,f&3){case 0:t.mode=Dx;break;case 1:if(RS(t),t.mode=kg,e===Tg){f>>>=2,m-=2;break e}break;case 2:t.mode=Mx;break;case 3:s.msg="invalid block type",t.mode=ks}f>>>=2,m-=2;break;case Dx:for(f>>>=m&7,m-=m&7;m<32;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}if((f&65535)!==(f>>>16^65535)){s.msg="invalid stored block lengths",t.mode=ks;break}if(t.length=f&65535,f=0,m=0,t.mode=pm,e===Tg)break e;case pm:t.mode=Lx;case Lx:if(v=t.length,v){if(v>c&&(v=c),v>h&&(v=h),v===0)break e;r.set(n.subarray(o,o+v),d),c-=v,o+=v,h-=v,d+=v,t.length-=v;break}t.mode=ru;break;case Mx:for(;m<14;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}if(t.nlen=(f&31)+257,f>>>=5,m-=5,t.ndist=(f&31)+1,f>>>=5,m-=5,t.ncode=(f&15)+4,f>>>=4,m-=4,t.nlen>286||t.ndist>30){s.msg="too many length or distance symbols",t.mode=ks;break}t.have=0,t.mode=Ix;case Ix:for(;t.have<t.ncode;){for(;m<3;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}t.lens[I[t.have++]]=f&7,f>>>=3,m-=3}for(;t.have<19;)t.lens[I[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,Y={bits:t.lenbits},X=fp(wS,t.lens,0,19,t.lencode,0,t.work,Y),t.lenbits=Y.bits,X){s.msg="invalid code lengths set",t.mode=ks;break}t.have=0,t.mode=zx;case zx:for(;t.have<t.nlen+t.ndist;){for(;_=t.lencode[f&(1<<t.lenbits)-1],b=_>>>24,H=_>>>16&255,R=_&65535,!(b<=m);){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}if(R<16)f>>>=b,m-=b,t.lens[t.have++]=R;else{if(R===16){for(W=b+2;m<W;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}if(f>>>=b,m-=b,t.have===0){s.msg="invalid bit length repeat",t.mode=ks;break}G=t.lens[t.have-1],v=3+(f&3),f>>>=2,m-=2}else if(R===17){for(W=b+3;m<W;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}f>>>=b,m-=b,G=0,v=3+(f&7),f>>>=3,m-=3}else{for(W=b+7;m<W;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}f>>>=b,m-=b,G=0,v=11+(f&127),f>>>=7,m-=7}if(t.have+v>t.nlen+t.ndist){s.msg="invalid bit length repeat",t.mode=ks;break}for(;v--;)t.lens[t.have++]=G}}if(t.mode===ks)break;if(t.lens[256]===0){s.msg="invalid code -- missing end-of-block",t.mode=ks;break}if(t.lenbits=9,Y={bits:t.lenbits},X=fp(v2,t.lens,0,t.nlen,t.lencode,0,t.work,Y),t.lenbits=Y.bits,X){s.msg="invalid literal/lengths set",t.mode=ks;break}if(t.distbits=6,t.distcode=t.distdyn,Y={bits:t.distbits},X=fp(w2,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,Y),t.distbits=Y.bits,X){s.msg="invalid distances set",t.mode=ks;break}if(t.mode=kg,e===Tg)break e;case kg:t.mode=_g;case _g:if(c>=6&&h>=258){s.next_out=d,s.avail_out=h,s.next_in=o,s.avail_in=c,t.hold=f,t.bits=m,gS(s,A),d=s.next_out,r=s.output,h=s.avail_out,o=s.next_in,n=s.input,c=s.avail_in,f=t.hold,m=t.bits,t.mode===ru&&(t.back=-1);break}for(t.back=0;_=t.lencode[f&(1<<t.lenbits)-1],b=_>>>24,H=_>>>16&255,R=_&65535,!(b<=m);){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}if(H&&(H&240)===0){for(M=b,B=H,q=R;_=t.lencode[q+((f&(1<<M+B)-1)>>M)],b=_>>>24,H=_>>>16&255,R=_&65535,!(M+b<=m);){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}f>>>=M,m-=M,t.back+=M}if(f>>>=b,m-=b,t.back+=b,t.length=R,H===0){t.mode=Hx;break}if(H&32){t.back=-1,t.mode=ru;break}if(H&64){s.msg="invalid literal/length code",t.mode=ks;break}t.extra=H&15,t.mode=Bx;case Bx:if(t.extra){for(W=t.extra;m<W;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}t.length+=f&(1<<t.extra)-1,f>>>=t.extra,m-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=Fx;case Fx:for(;_=t.distcode[f&(1<<t.distbits)-1],b=_>>>24,H=_>>>16&255,R=_&65535,!(b<=m);){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}if((H&240)===0){for(M=b,B=H,q=R;_=t.distcode[q+((f&(1<<M+B)-1)>>M)],b=_>>>24,H=_>>>16&255,R=_&65535,!(M+b<=m);){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}f>>>=M,m-=M,t.back+=M}if(f>>>=b,m-=b,t.back+=b,H&64){s.msg="invalid distance code",t.mode=ks;break}t.offset=R,t.extra=H&15,t.mode=Ox;case Ox:if(t.extra){for(W=t.extra;m<W;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}t.offset+=f&(1<<t.extra)-1,f>>>=t.extra,m-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){s.msg="invalid distance too far back",t.mode=ks;break}t.mode=Ux;case Ux:if(h===0)break e;if(v=A-h,t.offset>v){if(v=t.offset-v,v>t.whave&&t.sane){s.msg="invalid distance too far back",t.mode=ks;break}v>t.wnext?(v-=t.wnext,N=t.wsize-v):N=t.wnext-v,v>t.length&&(v=t.length),T=t.window}else T=r,N=d-t.offset,v=t.length;v>h&&(v=h),h-=v,t.length-=v;do r[d++]=T[N++];while(--v);t.length===0&&(t.mode=_g);break;case Hx:if(h===0)break e;r[d++]=t.length,h--,t.mode=_g;break;case gm:if(t.wrap){for(;m<32;){if(c===0)break e;c--,f|=n[o++]<<m,m+=8}if(A-=h,s.total_out+=A,t.total+=A,t.wrap&4&&A&&(s.adler=t.check=t.flags?Nd(t.check,r,A,d-A):Xm(t.check,r,A,d-A)),A=h,t.wrap&4&&(t.flags?f:Wx(f))!==t.check){s.msg="incorrect data check",t.mode=ks;break}f=0,m=0}t.mode=Vx;case Vx:if(t.wrap&&t.flags){for(;m<32;){if(c===0)break e;c--,f+=n[o++]<<m,m+=8}if(t.wrap&4&&f!==(t.total&4294967295)){s.msg="incorrect length check",t.mode=ks;break}f=0,m=0}t.mode=qx;case qx:X=AS;break e;case ks:X=S2;break e;case C2:return A2;case T2:default:return qc}return s.next_out=d,s.avail_out=h,s.next_in=o,s.avail_in=c,t.hold=f,t.bits=m,(t.wsize||A!==s.avail_out&&t.mode<ks&&(t.mode<gm||e!==Sx))&&P2(s,s.output,s.next_out,A-s.avail_out),y-=s.avail_in,A-=s.avail_out,s.total_in+=y,s.total_out+=A,t.total+=A,t.wrap&4&&A&&(s.adler=t.check=t.flags?Nd(t.check,r,A,s.next_out-A):Xm(t.check,r,A,s.next_out-A)),s.data_type=t.bits+(t.last?64:0)+(t.mode===ru?128:0)+(t.mode===kg||t.mode===pm?256:0),(y===0&&A===0||e===Sx)&&X===Th&&(X=TS),X},LS=s=>{if(jh(s))return qc;let e=s.state;return e.window&&(e.window=null),s.state=null,Th},MS=(s,e)=>{if(jh(s))return qc;const t=s.state;return(t.wrap&2)===0?qc:(t.head=e,e.done=!1,Th)},IS=(s,e)=>{const t=e.length;let n,r,o;return jh(s)||(n=s.state,n.wrap!==0&&n.mode!==e0)?qc:n.mode===e0&&(r=1,r=Xm(r,e,t,0),r!==n.check)?S2:(o=P2(s,e,t,t),o?(n.mode=C2,A2):(n.havedict=1,Th))};var zS=_2,BS=j2,FS=k2,OS=ES,US=N2,HS=DS,VS=LS,qS=MS,WS=IS,$S="pako inflate (from Nodeca project)",ou={inflateReset:zS,inflateReset2:BS,inflateResetKeep:FS,inflateInit:OS,inflateInit2:US,inflate:HS,inflateEnd:VS,inflateGetHeader:qS,inflateSetDictionary:WS,inflateInfo:$S};function GS(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var YS=GS;const E2=Object.prototype.toString,{Z_NO_FLUSH:XS,Z_FINISH:KS,Z_OK:mp,Z_STREAM_END:xm,Z_NEED_DICT:bm,Z_STREAM_ERROR:ZS,Z_DATA_ERROR:Gx,Z_MEM_ERROR:JS}=y2;function Ap(s){this.options=x2.assign({chunkSize:1024*64,windowBits:15,to:""},s||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(s&&s.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new fS,this.strm.avail_out=0;let t=ou.inflateInit2(this.strm,e.windowBits);if(t!==mp)throw new Error(Km[t]);if(this.header=new YS,ou.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Zm.string2buf(e.dictionary):E2.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=ou.inflateSetDictionary(this.strm,e.dictionary),t!==mp)))throw new Error(Km[t])}Ap.prototype.push=function(s,e){const t=this.strm,n=this.options.chunkSize,r=this.options.dictionary;let o,d,c;if(this.ended)return!1;for(e===~~e?d=e:d=e===!0?KS:XS,E2.call(s)==="[object ArrayBuffer]"?t.input=new Uint8Array(s):t.input=s,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),o=ou.inflate(t,d),o===bm&&r&&(o=ou.inflateSetDictionary(t,r),o===mp?o=ou.inflate(t,d):o===Gx&&(o=bm));t.avail_in>0&&o===xm&&t.state.wrap>0&&s[t.next_in]!==0;)ou.inflateReset(t),o=ou.inflate(t,d);switch(o){case ZS:case Gx:case bm:case JS:return this.onEnd(o),this.ended=!0,!1}if(c=t.avail_out,t.next_out&&(t.avail_out===0||o===xm))if(this.options.to==="string"){let h=Zm.utf8border(t.output,t.next_out),f=t.next_out-h,m=Zm.buf2string(t.output,h);t.next_out=f,t.avail_out=n-f,f&&t.output.set(t.output.subarray(h,h+f),0),this.onData(m)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(o===mp&&c===0)){if(o===xm)return o=ou.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Ap.prototype.onData=function(s){this.chunks.push(s)};Ap.prototype.onEnd=function(s){s===mp&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=x2.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};function QS(s,e){const t=new Ap(e);if(t.push(s),t.err)throw t.msg||Km[t.err];return t.result}var eA=Ap,tA=QS,nA={Inflate:eA,inflate:tA};const{Inflate:iA,inflate:rA}=nA;var Yx=iA,sA=rA;const R2=[];for(let s=0;s<256;s++){let e=s;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;R2[s]=e}const Xx=4294967295;function aA(s,e,t){let n=s;for(let r=0;r<t;r++)n=R2[(n^e[r])&255]^n>>>8;return n}function oA(s,e){return(aA(Xx,s,e)^Xx)>>>0}function Kx(s,e,t){const n=s.readUint32(),r=oA(new Uint8Array(s.buffer,s.byteOffset+s.offset-e-4,e),e);if(r!==n)throw new Error(`CRC mismatch for chunk ${t}. Expected ${n}, found ${r}`)}function D2(s,e,t){for(let n=0;n<t;n++)e[n]=s[n]}function L2(s,e,t,n){let r=0;for(;r<n;r++)e[r]=s[r];for(;r<t;r++)e[r]=s[r]+e[r-n]&255}function M2(s,e,t,n){let r=0;if(t.length===0)for(;r<n;r++)e[r]=s[r];else for(;r<n;r++)e[r]=s[r]+t[r]&255}function I2(s,e,t,n,r){let o=0;if(t.length===0){for(;o<r;o++)e[o]=s[o];for(;o<n;o++)e[o]=s[o]+(e[o-r]>>1)&255}else{for(;o<r;o++)e[o]=s[o]+(t[o]>>1)&255;for(;o<n;o++)e[o]=s[o]+(e[o-r]+t[o]>>1)&255}}function z2(s,e,t,n,r){let o=0;if(t.length===0){for(;o<r;o++)e[o]=s[o];for(;o<n;o++)e[o]=s[o]+e[o-r]&255}else{for(;o<r;o++)e[o]=s[o]+t[o]&255;for(;o<n;o++)e[o]=s[o]+lA(e[o-r],t[o],t[o-r])&255}}function lA(s,e,t){const n=s+e-t,r=Math.abs(n-s),o=Math.abs(n-e),d=Math.abs(n-t);return r<=o&&r<=d?s:o<=d?e:t}function cA(s,e,t,n,r,o){switch(s){case 0:D2(e,t,r);break;case 1:L2(e,t,r,o);break;case 2:M2(e,t,n,r);break;case 3:I2(e,t,n,r,o);break;case 4:z2(e,t,n,r,o);break;default:throw new Error(`Unsupported filter: ${s}`)}}const dA=new Uint16Array([255]),uA=new Uint8Array(dA.buffer),hA=uA[0]===255;function fA(s){const{data:e,width:t,height:n,channels:r,depth:o}=s,d=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],c=Math.ceil(o/8)*r,h=new Uint8Array(n*t*c);let f=0;for(let m=0;m<7;m++){const y=d[m],A=Math.ceil((t-y.x)/y.xStep),v=Math.ceil((n-y.y)/y.yStep);if(A<=0||v<=0)continue;const N=A*c,T=new Uint8Array(N);for(let _=0;_<v;_++){const b=e[f++],H=e.subarray(f,f+N);f+=N;const R=new Uint8Array(N);cA(b,H,R,T,N,c),T.set(R);for(let M=0;M<A;M++){const B=y.x+M*y.xStep,q=y.y+_*y.yStep;if(!(B>=t||q>=n))for(let G=0;G<c;G++)h[(q*t+B)*c+G]=R[M*c+G]}}}if(o===16){const m=new Uint16Array(h.buffer);if(hA)for(let y=0;y<m.length;y++)m[y]=pA(m[y]);return m}else return h}function pA(s){return(s&255)<<8|s>>8&255}const gA=new Uint16Array([255]),mA=new Uint8Array(gA.buffer),yA=mA[0]===255,xA=new Uint8Array(0);function Zx(s){const{data:e,width:t,height:n,channels:r,depth:o}=s,d=Math.ceil(o/8)*r,c=Math.ceil(o/8*r*t),h=new Uint8Array(n*c);let f=xA,m=0,y,A;for(let v=0;v<n;v++){switch(y=e.subarray(m+1,m+1+c),A=h.subarray(v*c,(v+1)*c),e[m]){case 0:D2(y,A,c);break;case 1:L2(y,A,c,d);break;case 2:M2(y,A,f,c);break;case 3:I2(y,A,f,c,d);break;case 4:z2(y,A,f,c,d);break;default:throw new Error(`Unsupported filter: ${e[m]}`)}f=A,m+=c+1}if(o===16){const v=new Uint16Array(h.buffer);if(yA)for(let N=0;N<v.length;N++)v[N]=bA(v[N]);return v}else return h}function bA(s){return(s&255)<<8|s>>8&255}const Vg=Uint8Array.of(137,80,78,71,13,10,26,10);function Jx(s){if(!vA(s.readBytes(Vg.length)))throw new Error("wrong PNG signature")}function vA(s){if(s.length<Vg.length)return!1;for(let e=0;e<Vg.length;e++)if(s[e]!==Vg[e])return!1;return!0}const wA="tEXt",SA=0,B2=new TextDecoder("latin1");function AA(s){if(TA(s),s.length===0||s.length>79)throw new Error("keyword length must be between 1 and 79")}const CA=/^[\u0000-\u00FF]*$/;function TA(s){if(!CA.test(s))throw new Error("invalid latin1 text")}function kA(s,e,t){const n=F2(e);s[n]=_A(e,t-n.length-1)}function F2(s){for(s.mark();s.readByte()!==SA;);const e=s.offset;s.reset();const t=B2.decode(s.readBytes(e-s.offset-1));return s.skip(1),AA(t),t}function _A(s,e){return B2.decode(s.readBytes(e))}const xc={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},vm={UNKNOWN:-1,DEFLATE:0},Qx={UNKNOWN:-1,ADAPTIVE:0},wm={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},jg={NONE:0,BACKGROUND:1,PREVIOUS:2},Sm={SOURCE:0,OVER:1};class jA extends Sy{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(e,t={}){super(e);const{checkCrc:n=!1}=t;this._checkCrc=n,this._inflator=new Yx,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=vm.UNKNOWN,this._filterMethod=Qx.UNKNOWN,this._interlaceMethod=wm.UNKNOWN,this._colorType=xc.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(Jx(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(Jx(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const n=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case wA:kA(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-n!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?Kx(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const n=this.offset;switch(t!=="fdAT"&&t!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=n+e;break}if(this.offset-n!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?Kx(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=NA(this.readUint8());const t=this.readUint8();this._colorType=t;let n;switch(t){case xc.GREYSCALE:n=1;break;case xc.TRUECOLOUR:n=3;break;case xc.INDEXED_COLOUR:n=1;break;case xc.GREYSCALE_ALPHA:n=2;break;case xc.TRUECOLOUR_ALPHA:n=4;break;case xc.UNKNOWN:default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==vm.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const n=[];this._palette=n;for(let r=0;r<t;r++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,n=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,n,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,n=this.offset+this.byteOffset;if(n+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,n,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodetRNS(e){switch(this._colorType){case xc.GREYSCALE:case xc.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break}case xc.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const n=this.readByte();this._palette[t].push(n)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}case xc.UNKNOWN:case xc.GREYSCALE_ALPHA:case xc.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){const t=F2(this),n=this.readUint8();if(n!==vm.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${n}`);const r=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:sA(r)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),n=this.readByte();this._png.resolution={x:e,y:t,unit:n}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},n=this._frames.at(e);if(n){if(n.data=Zx({data:n.data,width:n.width,height:n.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),e===0||n.xOffset===0&&n.yOffset===0&&n.width===this._png.width&&n.height===this._png.height)t.data=n.data;else{const r=this._apng.frames.at(e-1);this.disposeFrame(n,r,t),this.addFrameDataToCanvas(t,n)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,n){switch(e.disposeOp){case jg.NONE:break;case jg.BACKGROUND:for(let r=0;r<this._png.height;r++)for(let o=0;o<this._png.width;o++){const d=(r*e.width+o)*this._png.channels;for(let c=0;c<this._png.channels;c++)n.data[d+c]=0}break;case jg.PREVIOUS:n.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const n=1<<this._png.depth,r=(o,d)=>{const c=((o+t.yOffset)*this._png.width+t.xOffset+d)*this._png.channels,h=(o*t.width+d)*this._png.channels;return{index:c,frameIndex:h}};switch(t.blendOp){case Sm.SOURCE:for(let o=0;o<t.height;o++)for(let d=0;d<t.width;d++){const{index:c,frameIndex:h}=r(o,d);for(let f=0;f<this._png.channels;f++)e.data[c+f]=t.data[h+f]}break;case Sm.OVER:for(let o=0;o<t.height;o++)for(let d=0;d<t.width;d++){const{index:c,frameIndex:h}=r(o,d);for(let f=0;f<this._png.channels;f++){const m=t.data[h+this._png.channels-1]/n,y=f%(this._png.channels-1)===0?1:t.data[h+f],A=Math.floor(m*y+(1-m)*e.data[c+f]);e.data[c+f]+=A}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==Qx.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===wm.NO_INTERLACE)this._png.data=Zx({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===wm.ADAM7)this._png.data=fA({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:jg.NONE,blendOp:Sm.SOURCE,data:e}),this._inflator=new Yx,this._writingDataChunks=!1}}function NA(s){if(s!==1&&s!==2&&s!==4&&s!==8&&s!==16)throw new Error(`invalid bit depth: ${s}`);return s}var eb;(function(s){s[s.UNKNOWN=0]="UNKNOWN",s[s.METRE=1]="METRE"})(eb||(eb={}));function PA(s,e){return new jA(s,e).decode()}var oi=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function Am(){oi.console&&typeof oi.console.log=="function"&&oi.console.log.apply(oi.console,arguments)}var rs={log:Am,warn:function(s){oi.console&&(typeof oi.console.warn=="function"?oi.console.warn.apply(oi.console,arguments):Am.call(null,arguments))},error:function(s){oi.console&&(typeof oi.console.error=="function"?oi.console.error.apply(oi.console,arguments):Am(s))}};function Cm(s,e,t){var n=new XMLHttpRequest;n.open("GET",s),n.responseType="blob",n.onload=function(){yh(n.response,e,t)},n.onerror=function(){rs.error("could not download file")},n.send()}function tb(s){var e=new XMLHttpRequest;e.open("HEAD",s,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function Ng(s){try{s.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),s.dispatchEvent(e)}}var yh=oi.saveAs||((typeof window>"u"?"undefined":zr(window))!=="object"||window!==oi?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(s,e,t){var n=oi.URL||oi.webkitURL,r=document.createElement("a");e=e||s.name||"download",r.download=e,r.rel="noopener",typeof s=="string"?(r.href=s,r.origin!==location.origin?tb(r.href)?Cm(s,e,t):Ng(r,r.target="_blank"):Ng(r)):(r.href=n.createObjectURL(s),setTimeout(function(){n.revokeObjectURL(r.href)},4e4),setTimeout(function(){Ng(r)},0))}:"msSaveOrOpenBlob"in navigator?function(s,e,t){if(e=e||s.name||"download",typeof s=="string")if(tb(s))Cm(s,e,t);else{var n=document.createElement("a");n.href=s,n.target="_blank",setTimeout(function(){Ng(n)})}else navigator.msSaveOrOpenBlob((function(r,o){return o===void 0?o={autoBom:!1}:zr(o)!=="object"&&(rs.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(r.type)?new Blob(["\uFEFF",r],{type:r.type}):r})(s,t),e)}:function(s,e,t,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof s=="string")return Cm(s,e,t);var r=s.type==="application/octet-stream",o=/constructor/i.test(oi.HTMLElement)||oi.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent);if((d||r&&o)&&(typeof FileReader>"u"?"undefined":zr(FileReader))==="object"){var c=new FileReader;c.onloadend=function(){var m=c.result;m=d?m:m.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=m:location=m,n=null},c.readAsDataURL(s)}else{var h=oi.URL||oi.webkitURL,f=h.createObjectURL(s);n?n.location=f:location.href=f,n=null,setTimeout(function(){h.revokeObjectURL(f)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function O2(s){var e;s=s||"",this.ok=!1,s.charAt(0)=="#"&&(s=s.substr(1,6)),s={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[s=(s=s.replace(/ /g,"")).toLowerCase()]||s;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(c){return[parseInt(c[1]),parseInt(c[2]),parseInt(c[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(c){return[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(c){return[parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16),parseInt(c[3]+c[3],16)]}}],n=0;n<t.length;n++){var r=t[n].re,o=t[n].process,d=r.exec(s);d&&(e=o(d),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var c=this.r.toString(16),h=this.g.toString(16),f=this.b.toString(16);return c.length==1&&(c="0"+c),h.length==1&&(h="0"+h),f.length==1&&(f="0"+f),"#"+c+h+f}}var qg=oi.atob.bind(oi),nb=oi.btoa.bind(oi);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function Tm(s,e){var t=s[0],n=s[1],r=s[2],o=s[3];t=Xo(t,n,r,o,e[0],7,-680876936),o=Xo(o,t,n,r,e[1],12,-389564586),r=Xo(r,o,t,n,e[2],17,606105819),n=Xo(n,r,o,t,e[3],22,-1044525330),t=Xo(t,n,r,o,e[4],7,-176418897),o=Xo(o,t,n,r,e[5],12,1200080426),r=Xo(r,o,t,n,e[6],17,-1473231341),n=Xo(n,r,o,t,e[7],22,-45705983),t=Xo(t,n,r,o,e[8],7,1770035416),o=Xo(o,t,n,r,e[9],12,-1958414417),r=Xo(r,o,t,n,e[10],17,-42063),n=Xo(n,r,o,t,e[11],22,-1990404162),t=Xo(t,n,r,o,e[12],7,1804603682),o=Xo(o,t,n,r,e[13],12,-40341101),r=Xo(r,o,t,n,e[14],17,-1502002290),t=Ko(t,n=Xo(n,r,o,t,e[15],22,1236535329),r,o,e[1],5,-165796510),o=Ko(o,t,n,r,e[6],9,-1069501632),r=Ko(r,o,t,n,e[11],14,643717713),n=Ko(n,r,o,t,e[0],20,-373897302),t=Ko(t,n,r,o,e[5],5,-701558691),o=Ko(o,t,n,r,e[10],9,38016083),r=Ko(r,o,t,n,e[15],14,-660478335),n=Ko(n,r,o,t,e[4],20,-405537848),t=Ko(t,n,r,o,e[9],5,568446438),o=Ko(o,t,n,r,e[14],9,-1019803690),r=Ko(r,o,t,n,e[3],14,-187363961),n=Ko(n,r,o,t,e[8],20,1163531501),t=Ko(t,n,r,o,e[13],5,-1444681467),o=Ko(o,t,n,r,e[2],9,-51403784),r=Ko(r,o,t,n,e[7],14,1735328473),t=Zo(t,n=Ko(n,r,o,t,e[12],20,-1926607734),r,o,e[5],4,-378558),o=Zo(o,t,n,r,e[8],11,-2022574463),r=Zo(r,o,t,n,e[11],16,1839030562),n=Zo(n,r,o,t,e[14],23,-35309556),t=Zo(t,n,r,o,e[1],4,-1530992060),o=Zo(o,t,n,r,e[4],11,1272893353),r=Zo(r,o,t,n,e[7],16,-155497632),n=Zo(n,r,o,t,e[10],23,-1094730640),t=Zo(t,n,r,o,e[13],4,681279174),o=Zo(o,t,n,r,e[0],11,-358537222),r=Zo(r,o,t,n,e[3],16,-722521979),n=Zo(n,r,o,t,e[6],23,76029189),t=Zo(t,n,r,o,e[9],4,-640364487),o=Zo(o,t,n,r,e[12],11,-421815835),r=Zo(r,o,t,n,e[15],16,530742520),t=Jo(t,n=Zo(n,r,o,t,e[2],23,-995338651),r,o,e[0],6,-198630844),o=Jo(o,t,n,r,e[7],10,1126891415),r=Jo(r,o,t,n,e[14],15,-1416354905),n=Jo(n,r,o,t,e[5],21,-57434055),t=Jo(t,n,r,o,e[12],6,1700485571),o=Jo(o,t,n,r,e[3],10,-1894986606),r=Jo(r,o,t,n,e[10],15,-1051523),n=Jo(n,r,o,t,e[1],21,-2054922799),t=Jo(t,n,r,o,e[8],6,1873313359),o=Jo(o,t,n,r,e[15],10,-30611744),r=Jo(r,o,t,n,e[6],15,-1560198380),n=Jo(n,r,o,t,e[13],21,1309151649),t=Jo(t,n,r,o,e[4],6,-145523070),o=Jo(o,t,n,r,e[11],10,-1120210379),r=Jo(r,o,t,n,e[2],15,718787259),n=Jo(n,r,o,t,e[9],21,-343485551),s[0]=qu(t,s[0]),s[1]=qu(n,s[1]),s[2]=qu(r,s[2]),s[3]=qu(o,s[3])}function c0(s,e,t,n,r,o){return e=qu(qu(e,s),qu(n,o)),qu(e<<r|e>>>32-r,t)}function Xo(s,e,t,n,r,o,d){return c0(e&t|~e&n,s,e,r,o,d)}function Ko(s,e,t,n,r,o,d){return c0(e&n|t&~n,s,e,r,o,d)}function Zo(s,e,t,n,r,o,d){return c0(e^t^n,s,e,r,o,d)}function Jo(s,e,t,n,r,o,d){return c0(t^(e|~n),s,e,r,o,d)}function U2(s){var e,t=s.length,n=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=s.length;e+=64)Tm(n,EA(s.substring(e-64,e)));s=s.substring(e-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<s.length;e++)r[e>>2]|=s.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(Tm(n,r),e=0;e<16;e++)r[e]=0;return r[14]=8*t,Tm(n,r),n}function EA(s){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=s.charCodeAt(e)+(s.charCodeAt(e+1)<<8)+(s.charCodeAt(e+2)<<16)+(s.charCodeAt(e+3)<<24);return t}var ib="0123456789abcdef".split("");function RA(s){for(var e="",t=0;t<4;t++)e+=ib[s>>8*t+4&15]+ib[s>>8*t&15];return e}function DA(s){return String.fromCharCode(255&s,(65280&s)>>8,(16711680&s)>>16,(4278190080&s)>>24)}function Jm(s){return U2(s).map(DA).join("")}var LA=(function(s){for(var e=0;e<s.length;e++)s[e]=RA(s[e]);return s.join("")})(U2("hello"))!="5d41402abc4b2a76b9719d911017c592";function qu(s,e){if(LA){var t=(65535&s)+(65535&e);return(s>>16)+(e>>16)+(t>>16)<<16|65535&t}return s+e&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function Qm(s,e){var t,n,r,o;if(s!==t){for(var d=(r=s,o=1+(256/s.length|0),new Array(o+1).join(r)),c=[],h=0;h<256;h++)c[h]=h;var f=0;for(h=0;h<256;h++){var m=c[h];f=(f+m+d.charCodeAt(h))%256,c[h]=c[f],c[f]=m}t=s,n=c}else c=n;var y=e.length,A=0,v=0,N="";for(h=0;h<y;h++)v=(v+(m=c[A=(A+1)%256]))%256,c[A]=c[v],c[v]=m,d=c[(c[A]+c[v])%256],N+=String.fromCharCode(e.charCodeAt(h)^d);return N}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var rb={print:4,modify:8,copy:16,"annot-forms":32};function of(s,e,t,n){this.v=1,this.r=2;var r=192;s.forEach(function(c){if(rb.perm!==void 0)throw new Error("Invalid permission: "+c);r+=rb[c]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var o=(e+this.padding).substr(0,32),d=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(o,d),this.P=-(1+(255^r)),this.encryptionKey=Jm(o+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=Qm(this.encryptionKey,this.padding)}function lf(s){if(/[^\u0000-\u00ff]/.test(s))throw new Error("Invalid PDF Name Object: "+s+", Only accept ASCII characters.");for(var e="",t=s.length,n=0;n<t;n++){var r=s.charCodeAt(n);e+=r<33||r===35||r===37||r===40||r===41||r===47||r===60||r===62||r===91||r===93||r===123||r===125||r>126?"#"+("0"+r.toString(16)).slice(-2):s[n]}return e}function sb(s){if(zr(s)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,n,r){if(r=r||!1,typeof t!="string"||typeof n!="function"||typeof r!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var o=Math.random().toString(35);return e[t][o]=[n,!!r],o},this.unsubscribe=function(t){for(var n in e)if(e[n][t])return delete e[n][t],Object.keys(e[n]).length===0&&delete e[n],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var n=Array.prototype.slice.call(arguments,1),r=[];for(var o in e[t]){var d=e[t][o];try{d[0].apply(s,n)}catch(c){oi.console&&rs.error("jsPDF PubSub Error",c.message,c)}d[1]&&r.push(o)}r.length&&r.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function t0(s){if(!(this instanceof t0))return new t0(s);var e="opacity,stroke-opacity".split(",");for(var t in s)s.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=s[t]);this.id="",this.objectNumber=-1}function H2(s,e){this.gState=s,this.matrix=e,this.id="",this.objectNumber=-1}function xh(s,e,t,n,r){if(!(this instanceof xh))return new xh(s,e,t,n,r);this.type=s==="axial"?2:3,this.coords=e,this.colors=t,H2.call(this,n,r)}function hf(s,e,t,n,r){if(!(this instanceof hf))return new hf(s,e,t,n,r);this.boundingBox=s,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,H2.call(this,n,r)}function Mn(s){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],r=arguments[2],o=arguments[3],d=[],c=1,h=16,f="S",m=null;zr(s=s||{})==="object"&&(t=s.orientation,n=s.unit||n,r=s.format||r,o=s.compress||s.compressPdf||o,(m=s.encryption||null)!==null&&(m.userPassword=m.userPassword||"",m.ownerPassword=m.ownerPassword||"",m.userPermissions=m.userPermissions||[]),c=typeof s.userUnit=="number"?Math.abs(s.userUnit):1,s.precision!==void 0&&(e=s.precision),s.floatPrecision!==void 0&&(h=s.floatPrecision),f=s.defaultPathOperation||"S"),d=s.filters||(o===!0?["FlateEncode"]:d),n=n||"mm",t=(""+(t||"P")).toLowerCase();var y=s.putOnlyUsedFonts||!1,A={},v={internal:{},__private__:{}};v.__private__.PubSub=sb;var N="1.3",T=v.__private__.getPdfVersion=function(){return N};v.__private__.setPdfVersion=function(j){N=j};var _={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};v.__private__.getPageFormats=function(){return _};var b=v.__private__.getPageFormat=function(j){return _[j]};r=r||"a4";var H="compat",R="advanced",M=H;function B(){this.saveGraphicsState(),K(new Et(Wt,0,0,-Wt,0,wn()*Wt).toString()+" cm"),this.setFontSize(this.getFontSize()/Wt),f="n",M=R}function q(){this.restoreGraphicsState(),f="S",M=H}var G=v.__private__.combineFontStyleAndFontWeight=function(j,te){if(j=="bold"&&te=="normal"||j=="bold"&&te==400||j=="normal"&&te=="italic"||j=="bold"&&te=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return te&&(j=te==400||te==="normal"?j==="italic"?"italic":"normal":te!=700&&te!=="bold"||j!=="normal"?(te==700?"bold":te)+""+j:"bold"),j};v.advancedAPI=function(j){var te=M===H;return te&&B.call(this),typeof j!="function"||(j(this),te&&q.call(this)),this},v.compatAPI=function(j){var te=M===R;return te&&q.call(this),typeof j!="function"||(j(this),te&&B.call(this)),this},v.isAdvancedAPI=function(){return M===R};var X,O=function(j){if(M!==R)throw new Error(j+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},Y=v.roundToPrecision=v.__private__.roundToPrecision=function(j,te){var Se=e||te;if(isNaN(j)||isNaN(Se))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return j.toFixed(Se).replace(/0+$/,"")};X=v.hpf=v.__private__.hpf=typeof h=="number"?function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.hpf");return Y(j,h)}:h==="smart"?function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.hpf");return Y(j,j>-1&&j<1?16:5)}:function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.hpf");return Y(j,16)};var W=v.f2=v.__private__.f2=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.f2");return Y(j,2)},I=v.__private__.f3=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.f3");return Y(j,3)},J=v.scale=v.__private__.scale=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.scale");return M===H?j*Wt:M===R?j:void 0},Z=function(j){return J((function(te){return M===H?wn()-te:M===R?te:void 0})(j))};v.__private__.setPrecision=v.setPrecision=function(j){typeof parseInt(j,10)=="number"&&(e=parseInt(j,10))};var Ce,ie="00000000000000000000000000000000",le=v.__private__.getFileId=function(){return ie},se=v.__private__.setFileId=function(j){return ie=j!==void 0&&/^[a-fA-F0-9]{32}$/.test(j)?j.toUpperCase():ie.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),m!==null&&(Ki=new of(m.userPermissions,m.userPassword,m.ownerPassword,ie)),ie};v.setFileId=function(j){return se(j),this},v.getFileId=function(){return le()};var Ae=v.__private__.convertDateToPDFDate=function(j){var te=j.getTimezoneOffset(),Se=te<0?"+":"-",Ie=Math.floor(Math.abs(te/60)),Ve=Math.abs(te%60),lt=[Se,ee(Ie),"'",ee(Ve),"'"].join("");return["D:",j.getFullYear(),ee(j.getMonth()+1),ee(j.getDate()),ee(j.getHours()),ee(j.getMinutes()),ee(j.getSeconds()),lt].join("")},ue=v.__private__.convertPDFDateToDate=function(j){var te=parseInt(j.substr(2,4),10),Se=parseInt(j.substr(6,2),10)-1,Ie=parseInt(j.substr(8,2),10),Ve=parseInt(j.substr(10,2),10),lt=parseInt(j.substr(12,2),10),At=parseInt(j.substr(14,2),10);return new Date(te,Se,Ie,Ve,lt,At,0)},E=v.__private__.setCreationDate=function(j){var te;if(j===void 0&&(j=new Date),j instanceof Date)te=Ae(j);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(j))throw new Error("Invalid argument passed to jsPDF.setCreationDate");te=j}return Ce=te},L=v.__private__.getCreationDate=function(j){var te=Ce;return j==="jsDate"&&(te=ue(Ce)),te};v.setCreationDate=function(j){return E(j),this},v.getCreationDate=function(j){return L(j)};var Q,ee=v.__private__.padd2=function(j){return("0"+parseInt(j)).slice(-2)},oe=v.__private__.padd2Hex=function(j){return("00"+(j=j.toString())).substr(j.length)},xe=0,re=[],Le=[],Ee=0,Oe=[],Ze=[],st=!1,mt=Le;v.__private__.setCustomOutputDestination=function(j){st=!0,mt=j};var Mt=function(j){st||(mt=j)};v.__private__.resetCustomOutputDestination=function(){st=!1,mt=Le};var K=v.__private__.out=function(j){return j=j.toString(),Ee+=j.length+1,mt.push(j),mt},jt=v.__private__.write=function(j){return K(arguments.length===1?j.toString():Array.prototype.join.call(arguments," "))},$t=v.__private__.getArrayBuffer=function(j){for(var te=j.length,Se=new ArrayBuffer(te),Ie=new Uint8Array(Se);te--;)Ie[te]=j.charCodeAt(te);return Se},Yt=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];v.__private__.getStandardFonts=function(){return Yt};var yt=s.fontSize||16;v.__private__.setFontSize=v.setFontSize=function(j){return yt=M===R?j/Wt:j,this};var on,ze=v.__private__.getFontSize=v.getFontSize=function(){return M===H?yt:yt*Wt},Ne=s.R2L||!1;v.__private__.setR2L=v.setR2L=function(j){return Ne=j,this},v.__private__.getR2L=v.getR2L=function(){return Ne};var Ct,wt=v.__private__.setZoomMode=function(j){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(j))on=j;else if(isNaN(j)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(j)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+j+'" is not recognized.');on=j}else on=parseInt(j,10)};v.__private__.getZoomMode=function(){return on};var it,pt=v.__private__.setPageMode=function(j){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(j)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+j+'" is not recognized.');Ct=j};v.__private__.getPageMode=function(){return Ct};var Ot=v.__private__.setLayoutMode=function(j){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(j)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+j+'" is not recognized.');it=j};v.__private__.getLayoutMode=function(){return it},v.__private__.setDisplayMode=v.setDisplayMode=function(j,te,Se){return wt(j),Ot(te),pt(Se),this};var Qe={title:"",subject:"",author:"",keywords:"",creator:""};v.__private__.getDocumentProperty=function(j){if(Object.keys(Qe).indexOf(j)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Qe[j]},v.__private__.getDocumentProperties=function(){return Qe},v.__private__.setDocumentProperties=v.setProperties=v.setDocumentProperties=function(j){for(var te in Qe)Qe.hasOwnProperty(te)&&j[te]&&(Qe[te]=j[te]);return this},v.__private__.setDocumentProperty=function(j,te){if(Object.keys(Qe).indexOf(j)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Qe[j]=te};var St,Wt,Bt,Ln,Kt,rn={},un={},ot=[],Zt={},sn={},Ft={},Jt={},yn=null,_n=0,Qt=[],Ut=new sb(v),zi=s.hotfixes||[],Jn={},Lt={},Ht=[],Et=function j(te,Se,Ie,Ve,lt,At){if(!(this instanceof j))return new j(te,Se,Ie,Ve,lt,At);isNaN(te)&&(te=1),isNaN(Se)&&(Se=0),isNaN(Ie)&&(Ie=0),isNaN(Ve)&&(Ve=1),isNaN(lt)&&(lt=0),isNaN(At)&&(At=0),this._matrix=[te,Se,Ie,Ve,lt,At]};Object.defineProperty(Et.prototype,"sx",{get:function(){return this._matrix[0]},set:function(j){this._matrix[0]=j}}),Object.defineProperty(Et.prototype,"shy",{get:function(){return this._matrix[1]},set:function(j){this._matrix[1]=j}}),Object.defineProperty(Et.prototype,"shx",{get:function(){return this._matrix[2]},set:function(j){this._matrix[2]=j}}),Object.defineProperty(Et.prototype,"sy",{get:function(){return this._matrix[3]},set:function(j){this._matrix[3]=j}}),Object.defineProperty(Et.prototype,"tx",{get:function(){return this._matrix[4]},set:function(j){this._matrix[4]=j}}),Object.defineProperty(Et.prototype,"ty",{get:function(){return this._matrix[5]},set:function(j){this._matrix[5]=j}}),Object.defineProperty(Et.prototype,"a",{get:function(){return this._matrix[0]},set:function(j){this._matrix[0]=j}}),Object.defineProperty(Et.prototype,"b",{get:function(){return this._matrix[1]},set:function(j){this._matrix[1]=j}}),Object.defineProperty(Et.prototype,"c",{get:function(){return this._matrix[2]},set:function(j){this._matrix[2]=j}}),Object.defineProperty(Et.prototype,"d",{get:function(){return this._matrix[3]},set:function(j){this._matrix[3]=j}}),Object.defineProperty(Et.prototype,"e",{get:function(){return this._matrix[4]},set:function(j){this._matrix[4]=j}}),Object.defineProperty(Et.prototype,"f",{get:function(){return this._matrix[5]},set:function(j){this._matrix[5]=j}}),Object.defineProperty(Et.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Et.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Et.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Et.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Et.prototype.join=function(j){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(X).join(j)},Et.prototype.multiply=function(j){var te=j.sx*this.sx+j.shy*this.shx,Se=j.sx*this.shy+j.shy*this.sy,Ie=j.shx*this.sx+j.sy*this.shx,Ve=j.shx*this.shy+j.sy*this.sy,lt=j.tx*this.sx+j.ty*this.shx+this.tx,At=j.tx*this.shy+j.ty*this.sy+this.ty;return new Et(te,Se,Ie,Ve,lt,At)},Et.prototype.decompose=function(){var j=this.sx,te=this.shy,Se=this.shx,Ie=this.sy,Ve=this.tx,lt=this.ty,At=Math.sqrt(j*j+te*te),ln=(j/=At)*Se+(te/=At)*Ie;Se-=j*ln,Ie-=te*ln;var Tn=Math.sqrt(Se*Se+Ie*Ie);return ln/=Tn,j*(Ie/=Tn)<te*(Se/=Tn)&&(j=-j,te=-te,ln=-ln,At=-At),{scale:new Et(At,0,0,Tn,0,0),translate:new Et(1,0,0,1,Ve,lt),rotate:new Et(j,te,-te,j,0,0),skew:new Et(1,0,ln,1,0,0)}},Et.prototype.toString=function(j){return this.join(" ")},Et.prototype.inversed=function(){var j=this.sx,te=this.shy,Se=this.shx,Ie=this.sy,Ve=this.tx,lt=this.ty,At=1/(j*Ie-te*Se),ln=Ie*At,Tn=-te*At,Sn=-Se*At,si=j*At;return new Et(ln,Tn,Sn,si,-ln*Ve-Sn*lt,-Tn*Ve-si*lt)},Et.prototype.applyToPoint=function(j){var te=j.x*this.sx+j.y*this.shx+this.tx,Se=j.x*this.shy+j.y*this.sy+this.ty;return new Xa(te,Se)},Et.prototype.applyToRectangle=function(j){var te=this.applyToPoint(j),Se=this.applyToPoint(new Xa(j.x+j.w,j.y+j.h));return new as(te.x,te.y,Se.x-te.x,Se.y-te.y)},Et.prototype.clone=function(){var j=this.sx,te=this.shy,Se=this.shx,Ie=this.sy,Ve=this.tx,lt=this.ty;return new Et(j,te,Se,Ie,Ve,lt)},v.Matrix=Et;var ti=v.matrixMult=function(j,te){return te.multiply(j)},vi=new Et(1,0,0,1,0,0);v.unitMatrix=v.identityMatrix=vi;var ar=function(j,te){if(!sn[j]){var Se=(te instanceof xh?"Sh":"P")+(Object.keys(Zt).length+1).toString(10);te.id=Se,sn[j]=Se,Zt[Se]=te,Ut.publish("addPattern",te)}};v.ShadingPattern=xh,v.TilingPattern=hf,v.addShadingPattern=function(j,te){return O("addShadingPattern()"),ar(j,te),this},v.beginTilingPattern=function(j){O("beginTilingPattern()"),Da(j.boundingBox[0],j.boundingBox[1],j.boundingBox[2]-j.boundingBox[0],j.boundingBox[3]-j.boundingBox[1],j.matrix)},v.endTilingPattern=function(j,te){O("endTilingPattern()"),te.stream=Ze[Q].join(`
`),ar(j,te),Ut.publish("endTilingPattern",te),Ht.pop().restore()};var _t,Fn=v.__private__.newObject=function(){var j=Xn();return ci(j,!0),j},Xn=v.__private__.newObjectDeferred=function(){return xe++,re[xe]=function(){return Ee},xe},ci=function(j,te){return te=typeof te=="boolean"&&te,re[j]=Ee,te&&K(j+" 0 obj"),j},ri=v.__private__.newAdditionalObject=function(){var j={objId:Xn(),content:""};return Oe.push(j),j},Br=Xn(),Di=Xn(),Ni=v.__private__.decodeColorString=function(j){var te=j.split(" ");if(te.length!==2||te[1]!=="g"&&te[1]!=="G")te.length!==5||te[4]!=="k"&&te[4]!=="K"||(te=[(1-te[0])*(1-te[3]),(1-te[1])*(1-te[3]),(1-te[2])*(1-te[3]),"r"]);else{var Se=parseFloat(te[0]);te=[Se,Se,Se,"r"]}for(var Ie="#",Ve=0;Ve<3;Ve++)Ie+=("0"+Math.floor(255*parseFloat(te[Ve])).toString(16)).slice(-2);return Ie},Ns=v.__private__.encodeColorString=function(j){var te;typeof j=="string"&&(j={ch1:j});var Se=j.ch1,Ie=j.ch2,Ve=j.ch3,lt=j.ch4,At=j.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Se=="string"&&Se.charAt(0)!=="#"){var ln=new O2(Se);if(ln.ok)Se=ln.toHex();else if(!/^\d*\.?\d*$/.test(Se))throw new Error('Invalid color "'+Se+'" passed to jsPDF.encodeColorString.')}if(typeof Se=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Se)&&(Se="#"+Se[1]+Se[1]+Se[2]+Se[2]+Se[3]+Se[3]),typeof Se=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Se)){var Tn=parseInt(Se.substr(1),16);Se=Tn>>16&255,Ie=Tn>>8&255,Ve=255&Tn}if(Ie===void 0||lt===void 0&&Se===Ie&&Ie===Ve)te=typeof Se=="string"?Se+" "+At[0]:j.precision===2?W(Se/255)+" "+At[0]:I(Se/255)+" "+At[0];else if(lt===void 0||zr(lt)==="object"){if(lt&&!isNaN(lt.a)&&lt.a===0)return["1.","1.","1.",At[1]].join(" ");te=typeof Se=="string"?[Se,Ie,Ve,At[1]].join(" "):j.precision===2?[W(Se/255),W(Ie/255),W(Ve/255),At[1]].join(" "):[I(Se/255),I(Ie/255),I(Ve/255),At[1]].join(" ")}else te=typeof Se=="string"?[Se,Ie,Ve,lt,At[2]].join(" "):j.precision===2?[W(Se),W(Ie),W(Ve),W(lt),At[2]].join(" "):[I(Se),I(Ie),I(Ve),I(lt),At[2]].join(" ");return te},ha=v.__private__.getFilters=function(){return d},Na=v.__private__.putStream=function(j){var te=(j=j||{}).data||"",Se=j.filters||ha(),Ie=j.alreadyAppliedFilters||[],Ve=j.addLength1||!1,lt=te.length,At=j.objectId,ln=function(Ui){return Ui};if(m!==null&&At===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");m!==null&&(ln=Ki.encryptor(At,0));var Tn={};Se===!0&&(Se=["FlateEncode"]);var Sn=j.additionalKeyValues||[],si=(Tn=Mn.API.processDataByFilters!==void 0?Mn.API.processDataByFilters(te,Se):{data:te,reverseChain:[]}).reverseChain+(Array.isArray(Ie)?Ie.join(" "):Ie.toString());if(Tn.data.length!==0&&(Sn.push({key:"Length",value:Tn.data.length}),Ve===!0&&Sn.push({key:"Length1",value:lt})),si.length!=0)if(si.split("/").length-1==1)Sn.push({key:"Filter",value:si});else{Sn.push({key:"Filter",value:"["+si+"]"});for(var _i=0;_i<Sn.length;_i+=1)if(Sn[_i].key==="DecodeParms"){for(var Zr=[],Fi=0;Fi<Tn.reverseChain.split("/").length-1;Fi+=1)Zr.push("null");Zr.push(Sn[_i].value),Sn[_i].value="["+Zr.join(" ")+"]"}}K("<<");for(var Qi=0;Qi<Sn.length;Qi++)K("/"+Sn[Qi].key+" "+Sn[Qi].value);K(">>"),Tn.data.length!==0&&(K("stream"),K(ln(Tn.data)),K("endstream"))},$l=v.__private__.putPage=function(j){var te=j.number,Se=j.data,Ie=j.objId,Ve=j.contentsObjId;ci(Ie,!0),K("<</Type /Page"),K("/Parent "+j.rootDictionaryObjId+" 0 R"),K("/Resources "+j.resourceDictionaryObjId+" 0 R"),K("/MediaBox ["+parseFloat(X(j.mediaBox.bottomLeftX))+" "+parseFloat(X(j.mediaBox.bottomLeftY))+" "+X(j.mediaBox.topRightX)+" "+X(j.mediaBox.topRightY)+"]"),j.cropBox!==null&&K("/CropBox ["+X(j.cropBox.bottomLeftX)+" "+X(j.cropBox.bottomLeftY)+" "+X(j.cropBox.topRightX)+" "+X(j.cropBox.topRightY)+"]"),j.bleedBox!==null&&K("/BleedBox ["+X(j.bleedBox.bottomLeftX)+" "+X(j.bleedBox.bottomLeftY)+" "+X(j.bleedBox.topRightX)+" "+X(j.bleedBox.topRightY)+"]"),j.trimBox!==null&&K("/TrimBox ["+X(j.trimBox.bottomLeftX)+" "+X(j.trimBox.bottomLeftY)+" "+X(j.trimBox.topRightX)+" "+X(j.trimBox.topRightY)+"]"),j.artBox!==null&&K("/ArtBox ["+X(j.artBox.bottomLeftX)+" "+X(j.artBox.bottomLeftY)+" "+X(j.artBox.topRightX)+" "+X(j.artBox.topRightY)+"]"),typeof j.userUnit=="number"&&j.userUnit!==1&&K("/UserUnit "+j.userUnit),Ut.publish("putPage",{objId:Ie,pageContext:Qt[te],pageNumber:te,page:Se}),K("/Contents "+Ve+" 0 R"),K(">>"),K("endobj");var lt=Se.join(`
`);return M===R&&(lt+=`
Q`),ci(Ve,!0),Na({data:lt,filters:ha(),objectId:Ve}),K("endobj"),Ie},Wa=v.__private__.putPages=function(){var j,te,Se=[];for(j=1;j<=_n;j++)Qt[j].objId=Xn(),Qt[j].contentsObjId=Xn();for(j=1;j<=_n;j++)Se.push($l({number:j,data:Ze[j],objId:Qt[j].objId,contentsObjId:Qt[j].contentsObjId,mediaBox:Qt[j].mediaBox,cropBox:Qt[j].cropBox,bleedBox:Qt[j].bleedBox,trimBox:Qt[j].trimBox,artBox:Qt[j].artBox,userUnit:Qt[j].userUnit,rootDictionaryObjId:Br,resourceDictionaryObjId:Di}));ci(Br,!0),K("<</Type /Pages");var Ie="/Kids [";for(te=0;te<_n;te++)Ie+=Se[te]+" 0 R ";K(Ie+"]"),K("/Count "+_n),K(">>"),K("endobj"),Ut.publish("postPutPages")},$a=function(j){Ut.publish("putFont",{font:j,out:K,newObject:Fn,putStream:Na}),j.isAlreadyPutted!==!0&&(j.objectNumber=Fn(),K("<<"),K("/Type /Font"),K("/BaseFont /"+lf(j.postScriptName)),K("/Subtype /Type1"),typeof j.encoding=="string"&&K("/Encoding /"+j.encoding),K("/FirstChar 32"),K("/LastChar 255"),K(">>"),K("endobj"))},No=function(j){j.objectNumber=Fn();var te=[];te.push({key:"Type",value:"/XObject"}),te.push({key:"Subtype",value:"/Form"}),te.push({key:"BBox",value:"["+[X(j.x),X(j.y),X(j.x+j.width),X(j.y+j.height)].join(" ")+"]"}),te.push({key:"Matrix",value:"["+j.matrix.toString()+"]"});var Se=j.pages[1].join(`
`);Na({data:Se,additionalKeyValues:te,objectId:j.objectNumber}),K("endobj")},Qn=function(j,te){te||(te=21);var Se=Fn(),Ie=(function(At,ln){var Tn,Sn=[],si=1/(ln-1);for(Tn=0;Tn<1;Tn+=si)Sn.push(Tn);if(Sn.push(1),At[0].offset!=0){var _i={offset:0,color:At[0].color};At.unshift(_i)}if(At[At.length-1].offset!=1){var Zr={offset:1,color:At[At.length-1].color};At.push(Zr)}for(var Fi="",Qi=0,Ui=0;Ui<Sn.length;Ui++){for(Tn=Sn[Ui];Tn>At[Qi+1].offset;)Qi++;var Lr=At[Qi].offset,hr=(Tn-Lr)/(At[Qi+1].offset-Lr),fo=At[Qi].color,Ps=At[Qi+1].color;Fi+=oe(Math.round((1-hr)*fo[0]+hr*Ps[0]).toString(16))+oe(Math.round((1-hr)*fo[1]+hr*Ps[1]).toString(16))+oe(Math.round((1-hr)*fo[2]+hr*Ps[2]).toString(16))}return Fi.trim()})(j.colors,te),Ve=[];Ve.push({key:"FunctionType",value:"0"}),Ve.push({key:"Domain",value:"[0.0 1.0]"}),Ve.push({key:"Size",value:"["+te+"]"}),Ve.push({key:"BitsPerSample",value:"8"}),Ve.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Ve.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Na({data:Ie,additionalKeyValues:Ve,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Se}),K("endobj"),j.objectNumber=Fn(),K("<< /ShadingType "+j.type),K("/ColorSpace /DeviceRGB");var lt="/Coords ["+X(parseFloat(j.coords[0]))+" "+X(parseFloat(j.coords[1]))+" ";j.type===2?lt+=X(parseFloat(j.coords[2]))+" "+X(parseFloat(j.coords[3])):lt+=X(parseFloat(j.coords[2]))+" "+X(parseFloat(j.coords[3]))+" "+X(parseFloat(j.coords[4]))+" "+X(parseFloat(j.coords[5])),K(lt+="]"),j.matrix&&K("/Matrix ["+j.matrix.toString()+"]"),K("/Function "+Se+" 0 R"),K("/Extend [true true]"),K(">>"),K("endobj")},Us=function(j,te){var Se=Xn(),Ie=Fn();te.push({resourcesOid:Se,objectOid:Ie}),j.objectNumber=Ie;var Ve=[];Ve.push({key:"Type",value:"/Pattern"}),Ve.push({key:"PatternType",value:"1"}),Ve.push({key:"PaintType",value:"1"}),Ve.push({key:"TilingType",value:"1"}),Ve.push({key:"BBox",value:"["+j.boundingBox.map(X).join(" ")+"]"}),Ve.push({key:"XStep",value:X(j.xStep)}),Ve.push({key:"YStep",value:X(j.yStep)}),Ve.push({key:"Resources",value:Se+" 0 R"}),j.matrix&&Ve.push({key:"Matrix",value:"["+j.matrix.toString()+"]"}),Na({data:j.stream,additionalKeyValues:Ve,objectId:j.objectNumber}),K("endobj")},Ti=function(j){for(var te in j.objectNumber=Fn(),K("<<"),j)switch(te){case"opacity":K("/ca "+W(j[te]));break;case"stroke-opacity":K("/CA "+W(j[te]))}K(">>"),K("endobj")},Pa=function(j){ci(j.resourcesOid,!0),K("<<"),K("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var te in K("/Font <<"),rn)rn.hasOwnProperty(te)&&(y===!1||y===!0&&A.hasOwnProperty(te))&&K("/"+te+" "+rn[te].objectNumber+" 0 R");K(">>")})(),(function(){if(Object.keys(Zt).length>0){for(var te in K("/Shading <<"),Zt)Zt.hasOwnProperty(te)&&Zt[te]instanceof xh&&Zt[te].objectNumber>=0&&K("/"+te+" "+Zt[te].objectNumber+" 0 R");Ut.publish("putShadingPatternDict"),K(">>")}})(),(function(te){if(Object.keys(Zt).length>0){for(var Se in K("/Pattern <<"),Zt)Zt.hasOwnProperty(Se)&&Zt[Se]instanceof v.TilingPattern&&Zt[Se].objectNumber>=0&&Zt[Se].objectNumber<te&&K("/"+Se+" "+Zt[Se].objectNumber+" 0 R");Ut.publish("putTilingPatternDict"),K(">>")}})(j.objectOid),(function(){if(Object.keys(Ft).length>0){var te;for(te in K("/ExtGState <<"),Ft)Ft.hasOwnProperty(te)&&Ft[te].objectNumber>=0&&K("/"+te+" "+Ft[te].objectNumber+" 0 R");Ut.publish("putGStateDict"),K(">>")}})(),(function(){for(var te in K("/XObject <<"),Jn)Jn.hasOwnProperty(te)&&Jn[te].objectNumber>=0&&K("/"+te+" "+Jn[te].objectNumber+" 0 R");Ut.publish("putXobjectDict"),K(">>")})(),K(">>"),K("endobj")},On=function(j){un[j.fontName]=un[j.fontName]||{},un[j.fontName][j.fontStyle]=j.id},Qo=function(j,te,Se,Ie,Ve){var lt={id:"F"+(Object.keys(rn).length+1).toString(10),postScriptName:j,fontName:te,fontStyle:Se,encoding:Ie,isStandardFont:Ve||!1,metadata:{}};return Ut.publish("addFont",{font:lt,instance:this}),rn[lt.id]=lt,On(lt),lt.id},wi=v.__private__.pdfEscape=v.pdfEscape=function(j,te){return(function(Se,Ie){var Ve,lt,At,ln,Tn,Sn,si,_i,Zr;if(At=(Ie=Ie||{}).sourceEncoding||"Unicode",Tn=Ie.outputEncoding,(Ie.autoencode||Tn)&&rn[St].metadata&&rn[St].metadata[At]&&rn[St].metadata[At].encoding&&(ln=rn[St].metadata[At].encoding,!Tn&&rn[St].encoding&&(Tn=rn[St].encoding),!Tn&&ln.codePages&&(Tn=ln.codePages[0]),typeof Tn=="string"&&(Tn=ln[Tn]),Tn)){for(si=!1,Sn=[],Ve=0,lt=Se.length;Ve<lt;Ve++)(_i=Tn[Se.charCodeAt(Ve)])?Sn.push(String.fromCharCode(_i)):Sn.push(Se[Ve]),Sn[Ve].charCodeAt(0)>>8&&(si=!0);Se=Sn.join("")}for(Ve=Se.length;si===void 0&&Ve!==0;)Se.charCodeAt(Ve-1)>>8&&(si=!0),Ve--;if(!si)return Se;for(Sn=Ie.noBOM?[]:[254,255],Ve=0,lt=Se.length;Ve<lt;Ve++){if((Zr=(_i=Se.charCodeAt(Ve))>>8)>>8)throw new Error("Character at position "+Ve+" of string '"+Se+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Sn.push(Zr),Sn.push(_i-(Zr<<8))}return String.fromCharCode.apply(void 0,Sn)})(j,te).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},fa=v.__private__.beginPage=function(j){Ze[++_n]=[],Qt[_n]={objId:0,contentsObjId:0,userUnit:Number(c),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(j[0]),topRightY:Number(j[1])}},tl(_n),Mt(Ze[Q])},Ea=function(j,te){var Se,Ie,Ve;switch(t=te||t,typeof j=="string"&&(Se=b(j.toLowerCase()),Array.isArray(Se)&&(Ie=Se[0],Ve=Se[1])),Array.isArray(j)&&(Ie=j[0]*Wt,Ve=j[1]*Wt),isNaN(Ie)&&(Ie=r[0],Ve=r[1]),(Ie>14400||Ve>14400)&&(rs.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Ie=Math.min(14400,Ie),Ve=Math.min(14400,Ve)),r=[Ie,Ve],t.substr(0,1)){case"l":Ve>Ie&&(r=[Ve,Ie]);break;case"p":Ie>Ve&&(r=[Ve,Ie])}fa(r),qn(or),K(pn),an!==0&&K(an+" J"),Kn!==0&&K(Kn+" j"),Ut.publish("addPage",{pageNumber:_n})},el=function(j){j>0&&j<=_n&&(Ze.splice(j,1),Qt.splice(j,1),_n--,Q>_n&&(Q=_n),this.setPage(Q))},tl=function(j){j>0&&j<=_n&&(Q=j)},Ga=v.__private__.getNumberOfPages=v.getNumberOfPages=function(){return Ze.length-1},ud=function(j,te,Se){var Ie,Ve=void 0;return Se=Se||{},j=j!==void 0?j:rn[St].fontName,te=te!==void 0?te:rn[St].fontStyle,Ie=j.toLowerCase(),un[Ie]!==void 0&&un[Ie][te]!==void 0?Ve=un[Ie][te]:un[j]!==void 0&&un[j][te]!==void 0?Ve=un[j][te]:Se.disableWarning===!1&&rs.warn("Unable to look up font label for font '"+j+"', '"+te+"'. Refer to getFontList() for available fonts."),Ve||Se.noFallback||(Ve=un.times[te])==null&&(Ve=un.times.normal),Ve},dr=v.__private__.putInfo=function(){var j=Fn(),te=function(Ie){return Ie};for(var Se in m!==null&&(te=Ki.encryptor(j,0)),K("<<"),K("/Producer ("+wi(te("jsPDF "+Mn.version))+")"),Qe)Qe.hasOwnProperty(Se)&&Qe[Se]&&K("/"+Se.substr(0,1).toUpperCase()+Se.substr(1)+" ("+wi(te(Qe[Se]))+")");K("/CreationDate ("+wi(te(Ce))+")"),K(">>"),K("endobj")},nl=v.__private__.putCatalog=function(j){var te=(j=j||{}).rootDictionaryObjId||Br;switch(Fn(),K("<<"),K("/Type /Catalog"),K("/Pages "+te+" 0 R"),on||(on="fullwidth"),on){case"fullwidth":K("/OpenAction [3 0 R /FitH null]");break;case"fullheight":K("/OpenAction [3 0 R /FitV null]");break;case"fullpage":K("/OpenAction [3 0 R /Fit]");break;case"original":K("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Se=""+on;Se.substr(Se.length-1)==="%"&&(on=parseInt(on)/100),typeof on=="number"&&K("/OpenAction [3 0 R /XYZ null null "+W(on)+"]")}switch(it||(it="continuous"),it){case"continuous":K("/PageLayout /OneColumn");break;case"single":K("/PageLayout /SinglePage");break;case"two":case"twoleft":K("/PageLayout /TwoColumnLeft");break;case"tworight":K("/PageLayout /TwoColumnRight")}Ct&&K("/PageMode /"+Ct),Ut.publish("putCatalog"),K(">>"),K("endobj")},$n=v.__private__.putTrailer=function(){K("trailer"),K("<<"),K("/Size "+(xe+1)),K("/Root "+xe+" 0 R"),K("/Info "+(xe-1)+" 0 R"),m!==null&&K("/Encrypt "+Ki.oid+" 0 R"),K("/ID [ <"+ie+"> <"+ie+"> ]"),K(">>")},Wn=v.__private__.putHeader=function(){K("%PDF-"+N),K("%")},il=v.__private__.putXRef=function(){var j="0000000000";K("xref"),K("0 "+(xe+1)),K("0000000000 65535 f ");for(var te=1;te<=xe;te++)typeof re[te]=="function"?K((j+re[te]()).slice(-10)+" 00000 n "):re[te]!==void 0?K((j+re[te]).slice(-10)+" 00000 n "):K("0000000000 00000 n ")},co=v.__private__.buildDocument=function(){var j;xe=0,Ee=0,Le=[],re=[],Oe=[],Br=Xn(),Di=Xn(),Mt(Le),Ut.publish("buildDocument"),Wn(),Wa(),(function(){Ut.publish("putAdditionalObjects");for(var Se=0;Se<Oe.length;Se++){var Ie=Oe[Se];ci(Ie.objId,!0),K(Ie.content),K("endobj")}Ut.publish("postPutAdditionalObjects")})(),j=[],(function(){for(var Se in rn)rn.hasOwnProperty(Se)&&(y===!1||y===!0&&A.hasOwnProperty(Se))&&$a(rn[Se])})(),(function(){var Se;for(Se in Ft)Ft.hasOwnProperty(Se)&&Ti(Ft[Se])})(),(function(){for(var Se in Jn)Jn.hasOwnProperty(Se)&&No(Jn[Se])})(),(function(Se){var Ie;for(Ie in Zt)Zt.hasOwnProperty(Ie)&&(Zt[Ie]instanceof xh?Qn(Zt[Ie]):Zt[Ie]instanceof hf&&Us(Zt[Ie],Se))})(j),Ut.publish("putResources"),j.forEach(Pa),Pa({resourcesOid:Di,objectOid:Number.MAX_SAFE_INTEGER}),Ut.publish("postPutResources"),m!==null&&(Ki.oid=Fn(),K("<<"),K("/Filter /Standard"),K("/V "+Ki.v),K("/R "+Ki.r),K("/U <"+Ki.toHexString(Ki.U)+">"),K("/O <"+Ki.toHexString(Ki.O)+">"),K("/P "+Ki.P),K(">>"),K("endobj")),dr(),nl();var te=Ee;return il(),$n(),K("startxref"),K(""+te),K("%%EOF"),Mt(Ze[Q]),Le.join(`
`)},Ra=v.__private__.getBlob=function(j){return new Blob([$t(j)],{type:"application/pdf"})},ea=v.output=v.__private__.output=(_t=function(j,te){switch(typeof(te=te||{})=="string"?te={filename:te}:te.filename=te.filename||"generated.pdf",j){case void 0:return co();case"save":v.save(te.filename);break;case"arraybuffer":return $t(co());case"blob":return Ra(co());case"bloburi":case"bloburl":if(oi.URL!==void 0&&typeof oi.URL.createObjectURL=="function")return oi.URL&&oi.URL.createObjectURL(Ra(co()))||void 0;rs.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Se="",Ie=co();try{Se=nb(Ie)}catch{Se=nb(unescape(encodeURIComponent(Ie)))}return"data:application/pdf;filename="+te.filename+";base64,"+Se;case"pdfobjectnewwindow":if(Object.prototype.toString.call(oi)==="[object Window]"){var Ve="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",lt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';te.pdfObjectUrl&&(Ve=te.pdfObjectUrl,lt="");var At='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Ve+'"'+lt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(te)+");<\/script></body></html>",ln=oi.open();return ln!==null&&ln.document.write(At),ln}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(oi)==="[object Window]"){var Tn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(te.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+te.filename+'" width="500px" height="400px" /></body></html>',Sn=oi.open();if(Sn!==null){Sn.document.write(Tn);var si=this;Sn.document.documentElement.querySelector("#pdfViewer").onload=function(){Sn.document.title=te.filename,Sn.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(si.output("bloburl"))}}return Sn}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(oi)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var _i='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",te)+'"></iframe></body></html>',Zr=oi.open();if(Zr!==null&&(Zr.document.write(_i),Zr.document.title=te.filename),Zr||typeof safari>"u")return Zr;break;case"datauri":case"dataurl":return oi.document.location.href=this.output("datauristring",te);default:return null}},_t.foo=function(){try{return _t.apply(this,arguments)}catch(Se){var j=Se.stack||"";~j.indexOf(" at ")&&(j=j.split(" at ")[1]);var te="Error in function "+j.split(`
`)[0].split("<")[0]+": "+Se.message;if(!oi.console)throw new Error(te);oi.console.error(te,Se),oi.alert&&alert(te)}},_t.foo.bar=_t,_t.foo),ki=function(j){return Array.isArray(zi)===!0&&zi.indexOf(j)>-1};switch(n){case"pt":Wt=1;break;case"mm":Wt=72/25.4;break;case"cm":Wt=72/2.54;break;case"in":Wt=72;break;case"px":Wt=ki("px_scaling")==1?.75:96/72;break;case"pc":case"em":Wt=12;break;case"ex":Wt=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);Wt=n}var Ki=null;E(),se();var Si=v.__private__.getPageInfo=v.getPageInfo=function(j){if(isNaN(j)||j%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Qt[j].objId,pageNumber:j,pageContext:Qt[j]}},Fr=v.__private__.getPageInfoByObjId=function(j){if(isNaN(j)||j%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var te in Qt)if(Qt[te].objId===j)break;return Si(te)},$c=v.__private__.getCurrentPageInfo=v.getCurrentPageInfo=function(){return{objId:Qt[Q].objId,pageNumber:Q,pageContext:Qt[Q]}};v.addPage=function(){return Ea.apply(this,arguments),this},v.setPage=function(){return tl.apply(this,arguments),Mt.call(this,Ze[Q]),this},v.insertPage=function(j){return this.addPage(),this.movePage(Q,j),this},v.movePage=function(j,te){var Se,Ie;if(j>te){Se=Ze[j],Ie=Qt[j];for(var Ve=j;Ve>te;Ve--)Ze[Ve]=Ze[Ve-1],Qt[Ve]=Qt[Ve-1];Ze[te]=Se,Qt[te]=Ie,this.setPage(te)}else if(j<te){Se=Ze[j],Ie=Qt[j];for(var lt=j;lt<te;lt++)Ze[lt]=Ze[lt+1],Qt[lt]=Qt[lt+1];Ze[te]=Se,Qt[te]=Ie,this.setPage(te)}return this},v.deletePage=function(){return el.apply(this,arguments),this},v.__private__.text=v.text=function(j,te,Se,Ie,Ve){var lt,At,ln,Tn,Sn,si,_i,Zr,Fi,Qi=(Ie=Ie||{}).scope||this;if(typeof j=="number"&&typeof te=="number"&&(typeof Se=="string"||Array.isArray(Se))){var Ui=Se;Se=te,te=j,j=Ui}if(arguments[3]instanceof Et==0?(ln=arguments[4],Tn=arguments[5],zr(_i=arguments[3])==="object"&&_i!==null||(typeof ln=="string"&&(Tn=ln,ln=null),typeof _i=="string"&&(Tn=_i,_i=null),typeof _i=="number"&&(ln=_i,_i=null),Ie={flags:_i,angle:ln,align:Tn})):(O("The transform parameter of text() with a Matrix value"),Fi=Ve),isNaN(te)||isNaN(Se)||j==null)throw new Error("Invalid arguments passed to jsPDF.text");if(j.length===0)return Qi;var Lr,hr="",fo=typeof Ie.lineHeightFactor=="number"?Ie.lineHeightFactor:ur,Ps=Qi.internal.scaleFactor;function al(er){return er=er.split("	").join(Array(Ie.TabLen||9).join(" ")),wi(er,_i)}function ws(er){for(var Hi,Nr=er.concat(),ps=[],jl=Nr.length;jl--;)typeof(Hi=Nr.shift())=="string"?ps.push(Hi):Array.isArray(er)&&(Hi.length===1||Hi[1]===void 0&&Hi[2]===void 0)?ps.push(Hi[0]):ps.push([Hi[0],Hi[1],Hi[2]]);return ps}function ol(er,Hi){var Nr;if(typeof er=="string")Nr=Hi(er)[0];else if(Array.isArray(er)){for(var ps,jl,dl=er.concat(),gs=[],wa=dl.length;wa--;)typeof(ps=dl.shift())=="string"?gs.push(Hi(ps)[0]):Array.isArray(ps)&&typeof ps[0]=="string"&&(jl=Hi(ps[0],ps[1],ps[2]),gs.push([jl[0],jl[1],jl[2]]));Nr=gs}return Nr}var Or=!1,ma=!0;if(typeof j=="string")Or=!0;else if(Array.isArray(j)){var Ss=j.concat();At=[];for(var Za,fi=Ss.length;fi--;)(typeof(Za=Ss.shift())!="string"||Array.isArray(Za)&&typeof Za[0]!="string")&&(ma=!1);Or=ma}if(Or===!1)throw new Error('Type of text must be string or Array. "'+j+'" is not recognized.');typeof j=="string"&&(j=j.match(/[\r?\n]/)?j.split(/\r\n|\r|\n/g):[j]);var po=yt/Qi.internal.scaleFactor,Cc=po*(fo-1);switch(Ie.baseline){case"bottom":Se-=Cc;break;case"top":Se+=po-Cc;break;case"hanging":Se+=po-2*Cc;break;case"middle":Se+=po/2-Cc}if((si=Ie.maxWidth||0)>0&&(typeof j=="string"?j=Qi.splitTextToSize(j,si):Object.prototype.toString.call(j)==="[object Array]"&&(j=j.reduce(function(er,Hi){return er.concat(Qi.splitTextToSize(Hi,si))},[]))),lt={text:j,x:te,y:Se,options:Ie,mutex:{pdfEscape:wi,activeFontKey:St,fonts:rn,activeFontSize:yt}},Ut.publish("preProcessText",lt),j=lt.text,ln=(Ie=lt.options).angle,Fi instanceof Et==0&&ln&&typeof ln=="number"){ln*=Math.PI/180,Ie.rotationDirection===0&&(ln=-ln),M===R&&(ln=-ln);var hd=Math.cos(ln),Ja=Math.sin(ln);Fi=new Et(hd,Ja,-Ja,hd,0,0)}else ln&&ln instanceof Et&&(Fi=ln);M!==R||Fi||(Fi=vi),(Sn=Ie.charSpace||Gt)!==void 0&&(hr+=X(J(Sn))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Zr=Ie.horizontalScale)!==void 0&&(hr+=X(100*Zr)+` Tz
`),Ie.lang;var qs=-1,Do=Ie.renderingMode!==void 0?Ie.renderingMode:Ie.stroke,Tc=Qi.internal.getCurrentPageInfo().pageContext;switch(Do){case 0:case!1:case"fill":qs=0;break;case 1:case!0:case"stroke":qs=1;break;case 2:case"fillThenStroke":qs=2;break;case 3:case"invisible":qs=3;break;case 4:case"fillAndAddForClipping":qs=4;break;case 5:case"strokeAndAddPathForClipping":qs=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":qs=6;break;case 7:case"addToPathForClipping":qs=7}var Lo=Tc.usedRenderingMode!==void 0?Tc.usedRenderingMode:-1;qs!==-1?hr+=qs+` Tr
`:Lo!==-1&&(hr+=`0 Tr
`),qs!==-1&&(Tc.usedRenderingMode=qs),Tn=Ie.align||"left";var ya,hs=yt*fo,Qa=Qi.internal.pageSize.getWidth(),ll=rn[St];Sn=Ie.charSpace||Gt,si=Ie.maxWidth||0,_i=Object.assign({autoencode:!0,noBOM:!0},Ie.flags);var go=[],mo=function(er){return Qi.getStringUnitWidth(er,{font:ll,charSpace:Sn,fontSize:yt,doKerning:!1})*yt/Ps};if(Object.prototype.toString.call(j)==="[object Array]"){var xa;At=ws(j),Tn!=="left"&&(ya=At.map(mo));var fs,Mo=0;if(Tn==="right"){te-=ya[0],j=[],fi=At.length;for(var La=0;La<fi;La++)La===0?(fs=ga(te),xa=gn(Se)):(fs=J(Mo-ya[La]),xa=-hs),j.push([At[La],fs,xa]),Mo=ya[La]}else if(Tn==="center"){te-=ya[0]/2,j=[],fi=At.length;for(var Li=0;Li<fi;Li++)Li===0?(fs=ga(te),xa=gn(Se)):(fs=J((Mo-ya[Li])/2),xa=-hs),j.push([At[Li],fs,xa]),Mo=ya[Li]}else if(Tn==="left"){j=[],fi=At.length;for(var Io=0;Io<fi;Io++)j.push(At[Io])}else if(Tn==="justify"&&ll.encoding==="Identity-H"){j=[],fi=At.length,si=si!==0?si:Qa;for(var fr=0,jr=0;jr<fi;jr++)if(xa=jr===0?gn(Se):-hs,fs=jr===0?ga(te):fr,jr<fi-1){var fd=J((si-ya[jr])/(At[jr].split(" ").length-1)),Ma=At[jr].split(" ");j.push([Ma[0]+" ",fs,xa]),fr=0;for(var _l=1;_l<Ma.length;_l++){var Es=(mo(Ma[_l-1]+" "+Ma[_l])-mo(Ma[_l]))*Ps+fd;_l==Ma.length-1?j.push([Ma[_l],Es,0]):j.push([Ma[_l]+" ",Es,0]),fr-=Es}}else j.push([At[jr],fs,xa]);j.push(["",fr,0])}else{if(Tn!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(j=[],fi=At.length,si=si!==0?si:Qa,jr=0;jr<fi;jr++){xa=jr===0?gn(Se):-hs,fs=jr===0?ga(te):0;var Xl=At[jr].split(" ").length-1,pd=Xl>0?(si-ya[jr])/Xl:0;jr<fi-1?go.push(X(J(pd))):go.push(0),j.push([At[jr],fs,xa])}}}(typeof Ie.R2L=="boolean"?Ie.R2L:Ne)===!0&&(j=ol(j,function(er,Hi,Nr){return[er.split("").reverse().join(""),Hi,Nr]})),lt={text:j,x:te,y:Se,options:Ie,mutex:{pdfEscape:wi,activeFontKey:St,fonts:rn,activeFontSize:yt}},Ut.publish("postProcessText",lt),j=lt.text,Lr=lt.mutex.isHex||!1;var eo=rn[St].encoding;eo!=="WinAnsiEncoding"&&eo!=="StandardEncoding"||(j=ol(j,function(er,Hi,Nr){return[al(er),Hi,Nr]})),At=ws(j),j=[];for(var cl,zo,ba,Ws=Array.isArray(At[0])?1:0,Ia="",Bo=function(er,Hi,Nr){var ps="";return Nr instanceof Et?(Nr=typeof Ie.angle=="number"?ti(Nr,new Et(1,0,0,1,er,Hi)):ti(new Et(1,0,0,1,er,Hi),Nr),M===R&&(Nr=ti(new Et(1,0,0,-1,0,0),Nr)),ps=Nr.join(" ")+` Tm
`):ps=X(er)+" "+X(Hi)+` Td
`,ps},va=0;va<At.length;va++){switch(Ia="",Ws){case 1:ba=(Lr?"<":"(")+At[va][0]+(Lr?">":")"),cl=parseFloat(At[va][1]),zo=parseFloat(At[va][2]);break;case 0:ba=(Lr?"<":"(")+At[va]+(Lr?">":")"),cl=ga(te),zo=gn(Se)}go!==void 0&&go[va]!==void 0&&(Ia=go[va]+` Tw
`),va===0?j.push(Ia+Bo(cl,zo,Fi)+ba):Ws===0?j.push(Ia+ba):Ws===1&&j.push(Ia+Bo(cl,zo,Fi)+ba)}j=Ws===0?j.join(` Tj
T* `):j.join(` Tj
`),j+=` Tj
`;var yo=`BT
/`;return yo+=St+" "+yt+` Tf
`,yo+=X(yt*fo)+` TL
`,yo+=xn+`
`,yo+=hr,yo+=j,K(yo+="ET"),A[St]=!0,Qi};var ta=v.__private__.clip=v.clip=function(j){return K(j==="evenodd"?"W*":"W"),this};v.clipEvenOdd=function(){return ta("evenodd")},v.__private__.discardPath=v.discardPath=function(){return K("n"),this};var Hs=v.__private__.isValidStyle=function(j){var te=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(j)!==-1&&(te=!0),te};v.__private__.setDefaultPathOperation=v.setDefaultPathOperation=function(j){return Hs(j)&&(f=j),this};var Gl=v.__private__.getStyle=v.getStyle=function(j){var te=f;switch(j){case"D":case"S":te="S";break;case"F":te="f";break;case"FD":case"DF":te="B";break;case"f":case"f*":case"B":case"B*":te=j}return te},pa=v.close=function(){return K("h"),this};v.stroke=function(){return K("S"),this},v.fill=function(j){return vs("f",j),this},v.fillEvenOdd=function(j){return vs("f*",j),this},v.fillStroke=function(j){return vs("B",j),this},v.fillStrokeEvenOdd=function(j){return vs("B*",j),this};var vs=function(j,te){zr(te)==="object"?zt(te,j):K(j)},na=function(j){j===null||M===R&&j===void 0||(j=Gl(j),K(j))};function Ya(j,te,Se,Ie,Ve){var lt=new hf(te||this.boundingBox,Se||this.xStep,Ie||this.yStep,this.gState,Ve||this.matrix);lt.stream=this.stream;var At=j+"$$"+this.cloneIndex+++"$$";return ar(At,lt),lt}var zt=function(j,te){var Se=sn[j.key],Ie=Zt[Se];if(Ie instanceof xh)K("q"),K($i(te)),Ie.gState&&v.setGState(Ie.gState),K(j.matrix.toString()+" cm"),K("/"+Se+" sh"),K("Q");else if(Ie instanceof hf){var Ve=new Et(1,0,0,-1,0,wn());j.matrix&&(Ve=Ve.multiply(j.matrix||vi),Se=Ya.call(Ie,j.key,j.boundingBox,j.xStep,j.yStep,Ve).id),K("q"),K("/Pattern cs"),K("/"+Se+" scn"),Ie.gState&&v.setGState(Ie.gState),K(te),K("Q")}},$i=function(j){switch(j){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},uo=v.moveTo=function(j,te){return K(X(J(j))+" "+X(Z(te))+" m"),this},Tl=v.lineTo=function(j,te){return K(X(J(j))+" "+X(Z(te))+" l"),this},Kr=v.curveTo=function(j,te,Se,Ie,Ve,lt){return K([X(J(j)),X(Z(te)),X(J(Se)),X(Z(Ie)),X(J(Ve)),X(Z(lt)),"c"].join(" ")),this};v.__private__.line=v.line=function(j,te,Se,Ie,Ve){if(isNaN(j)||isNaN(te)||isNaN(Se)||isNaN(Ie)||!Hs(Ve))throw new Error("Invalid arguments passed to jsPDF.line");return M===H?this.lines([[Se-j,Ie-te]],j,te,[1,1],Ve||"S"):this.lines([[Se-j,Ie-te]],j,te,[1,1]).stroke()},v.__private__.lines=v.lines=function(j,te,Se,Ie,Ve,lt){var At,ln,Tn,Sn,si,_i,Zr,Fi,Qi,Ui,Lr,hr;if(typeof j=="number"&&(hr=Se,Se=te,te=j,j=hr),Ie=Ie||[1,1],lt=lt||!1,isNaN(te)||isNaN(Se)||!Array.isArray(j)||!Array.isArray(Ie)||!Hs(Ve)||typeof lt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(uo(te,Se),At=Ie[0],ln=Ie[1],Sn=j.length,Ui=te,Lr=Se,Tn=0;Tn<Sn;Tn++)(si=j[Tn]).length===2?(Ui=si[0]*At+Ui,Lr=si[1]*ln+Lr,Tl(Ui,Lr)):(_i=si[0]*At+Ui,Zr=si[1]*ln+Lr,Fi=si[2]*At+Ui,Qi=si[3]*ln+Lr,Ui=si[4]*At+Ui,Lr=si[5]*ln+Lr,Kr(_i,Zr,Fi,Qi,Ui,Lr));return lt&&pa(),na(Ve),this},v.path=function(j){for(var te=0;te<j.length;te++){var Se=j[te],Ie=Se.c;switch(Se.op){case"m":uo(Ie[0],Ie[1]);break;case"l":Tl(Ie[0],Ie[1]);break;case"c":Kr.apply(this,Ie);break;case"h":pa()}}return this},v.__private__.rect=v.rect=function(j,te,Se,Ie,Ve){if(isNaN(j)||isNaN(te)||isNaN(Se)||isNaN(Ie)||!Hs(Ve))throw new Error("Invalid arguments passed to jsPDF.rect");return M===H&&(Ie=-Ie),K([X(J(j)),X(Z(te)),X(J(Se)),X(J(Ie)),"re"].join(" ")),na(Ve),this},v.__private__.triangle=v.triangle=function(j,te,Se,Ie,Ve,lt,At){if(isNaN(j)||isNaN(te)||isNaN(Se)||isNaN(Ie)||isNaN(Ve)||isNaN(lt)||!Hs(At))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Se-j,Ie-te],[Ve-Se,lt-Ie],[j-Ve,te-lt]],j,te,[1,1],At,!0),this},v.__private__.roundedRect=v.roundedRect=function(j,te,Se,Ie,Ve,lt,At){if(isNaN(j)||isNaN(te)||isNaN(Se)||isNaN(Ie)||isNaN(Ve)||isNaN(lt)||!Hs(At))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var ln=4/3*(Math.SQRT2-1);return Ve=Math.min(Ve,.5*Se),lt=Math.min(lt,.5*Ie),this.lines([[Se-2*Ve,0],[Ve*ln,0,Ve,lt-lt*ln,Ve,lt],[0,Ie-2*lt],[0,lt*ln,-Ve*ln,lt,-Ve,lt],[2*Ve-Se,0],[-Ve*ln,0,-Ve,-lt*ln,-Ve,-lt],[0,2*lt-Ie],[0,-lt*ln,Ve*ln,-lt,Ve,-lt]],j+Ve,te,[1,1],At,!0),this},v.__private__.ellipse=v.ellipse=function(j,te,Se,Ie,Ve){if(isNaN(j)||isNaN(te)||isNaN(Se)||isNaN(Ie)||!Hs(Ve))throw new Error("Invalid arguments passed to jsPDF.ellipse");var lt=4/3*(Math.SQRT2-1)*Se,At=4/3*(Math.SQRT2-1)*Ie;return uo(j+Se,te),Kr(j+Se,te-At,j+lt,te-Ie,j,te-Ie),Kr(j-lt,te-Ie,j-Se,te-At,j-Se,te),Kr(j-Se,te+At,j-lt,te+Ie,j,te+Ie),Kr(j+lt,te+Ie,j+Se,te+At,j+Se,te),na(Ve),this},v.__private__.circle=v.circle=function(j,te,Se,Ie){if(isNaN(j)||isNaN(te)||isNaN(Se)||!Hs(Ie))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(j,te,Se,Se,Ie)},v.setFont=function(j,te,Se){return Se&&(te=G(te,Se)),St=ud(j,te,{disableWarning:!1}),this};var ho=v.__private__.getFont=v.getFont=function(){return rn[ud.apply(v,arguments)]};v.__private__.getFontList=v.getFontList=function(){var j,te,Se={};for(j in un)if(un.hasOwnProperty(j))for(te in Se[j]=[],un[j])un[j].hasOwnProperty(te)&&Se[j].push(te);return Se},v.addFont=function(j,te,Se,Ie,Ve){var lt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&lt.indexOf(arguments[3])!==-1?Ve=arguments[3]:arguments[3]&&lt.indexOf(arguments[3])==-1&&(Se=G(Se,Ie)),Qo.call(this,j,te,Se,Ve=Ve||"Identity-H")};var ur,or=s.lineWidth||.200025,Po=v.__private__.getLineWidth=v.getLineWidth=function(){return or},qn=v.__private__.setLineWidth=v.setLineWidth=function(j){return or=j,K(X(J(j))+" w"),this};v.__private__.setLineDash=Mn.API.setLineDash=Mn.API.setLineDashPattern=function(j,te){if(j=j||[],te=te||0,isNaN(te)||!Array.isArray(j))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return j=j.map(function(Se){return X(J(Se))}).join(" "),te=X(J(te)),K("["+j+"] "+te+" d"),this};var li=v.__private__.getLineHeight=v.getLineHeight=function(){return yt*ur};v.__private__.getLineHeight=v.getLineHeight=function(){return yt*ur};var Pn=v.__private__.setLineHeightFactor=v.setLineHeightFactor=function(j){return typeof(j=j||1.15)=="number"&&(ur=j),this},Gc=v.__private__.getLineHeightFactor=v.getLineHeightFactor=function(){return ur};Pn(s.lineHeight);var ga=v.__private__.getHorizontalCoordinate=function(j){return J(j)},gn=v.__private__.getVerticalCoordinate=function(j){return M===R?j:Qt[Q].mediaBox.topRightY-Qt[Q].mediaBox.bottomLeftY-J(j)},jn=v.__private__.getHorizontalCoordinateString=v.getHorizontalCoordinateString=function(j){return X(ga(j))},ui=v.__private__.getVerticalCoordinateString=v.getVerticalCoordinateString=function(j){return X(gn(j))},pn=s.strokeColor||"0 G";v.__private__.getStrokeColor=v.getDrawColor=function(){return Ni(pn)},v.__private__.setStrokeColor=v.setDrawColor=function(j,te,Se,Ie){return pn=Ns({ch1:j,ch2:te,ch3:Se,ch4:Ie,pdfColorType:"draw",precision:2}),K(pn),this};var hi=s.fillColor||"0 g";v.__private__.getFillColor=v.getFillColor=function(){return Ni(hi)},v.__private__.setFillColor=v.setFillColor=function(j,te,Se,Ie){return hi=Ns({ch1:j,ch2:te,ch3:Se,ch4:Ie,pdfColorType:"fill",precision:2}),K(hi),this};var xn=s.textColor||"0 g",du=v.__private__.getTextColor=v.getTextColor=function(){return Ni(xn)};v.__private__.setTextColor=v.setTextColor=function(j,te,Se,Ie){return xn=Ns({ch1:j,ch2:te,ch3:Se,ch4:Ie,pdfColorType:"text",precision:3}),this};var Gt=s.charSpace,Bi=v.__private__.getCharSpace=v.getCharSpace=function(){return parseFloat(Gt||0)};v.__private__.setCharSpace=v.setCharSpace=function(j){if(isNaN(j))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Gt=j,this};var an=0;v.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},v.__private__.setLineCap=v.setLineCap=function(j){var te=v.CapJoinStyles[j];if(te===void 0)throw new Error("Line cap style of '"+j+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return an=te,K(te+" J"),this};var Kn=0;v.__private__.setLineJoin=v.setLineJoin=function(j){var te=v.CapJoinStyles[j];if(te===void 0)throw new Error("Line join style of '"+j+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Kn=te,K(te+" j"),this},v.__private__.setLineMiterLimit=v.__private__.setMiterLimit=v.setLineMiterLimit=v.setMiterLimit=function(j){if(j=j||0,isNaN(j))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return K(X(J(j))+" M"),this},v.GState=t0,v.setGState=function(j){(j=typeof j=="string"?Ft[Jt[j]]:Vs(null,j)).equals(yn)||(K("/"+j.id+" gs"),yn=j)};var Vs=function(j,te){if(!j||!Jt[j]){var Se=!1;for(var Ie in Ft)if(Ft.hasOwnProperty(Ie)&&Ft[Ie].equals(te)){Se=!0;break}if(Se)te=Ft[Ie];else{var Ve="GS"+(Object.keys(Ft).length+1).toString(10);Ft[Ve]=te,te.id=Ve}return j&&(Jt[j]=te.id),Ut.publish("addGState",te),te}};v.addGState=function(j,te){return Vs(j,te),this},v.saveGraphicsState=function(){return K("q"),ot.push({key:St,size:yt,color:xn}),this},v.restoreGraphicsState=function(){K("Q");var j=ot.pop();return St=j.key,yt=j.size,xn=j.color,yn=null,this},v.setCurrentTransformationMatrix=function(j){return K(j.toString()+" cm"),this},v.comment=function(j){return K("#"+j),this};var Xa=function(j,te){var Se=j||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Se},set:function(lt){isNaN(lt)||(Se=parseFloat(lt))}});var Ie=te||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Ie},set:function(lt){isNaN(lt)||(Ie=parseFloat(lt))}});var Ve="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Ve},set:function(lt){Ve=lt.toString()}}),this},as=function(j,te,Se,Ie){Xa.call(this,j,te),this.type="rect";var Ve=Se||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Ve},set:function(At){isNaN(At)||(Ve=parseFloat(At))}});var lt=Ie||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return lt},set:function(At){isNaN(At)||(lt=parseFloat(At))}}),this},rl=function(){this.page=_n,this.currentPage=Q,this.pages=Ze.slice(0),this.pagesContext=Qt.slice(0),this.x=Bt,this.y=Ln,this.matrix=Kt,this.width=sl(Q),this.height=Yl(Q),this.outputDestination=mt,this.id="",this.objectNumber=-1};rl.prototype.restore=function(){_n=this.page,Q=this.currentPage,Qt=this.pagesContext,Ze=this.pages,Bt=this.x,Ln=this.y,Kt=this.matrix,Ac(Q,this.width),kl(Q,this.height),mt=this.outputDestination};var Da=function(j,te,Se,Ie,Ve){Ht.push(new rl),_n=Q=0,Ze=[],Bt=j,Ln=te,Kt=Ve,fa([Se,Ie])};for(var Ka in v.beginFormObject=function(j,te,Se,Ie,Ve){return Da(j,te,Se,Ie,Ve),this},v.endFormObject=function(j){return(function(te){if(Lt[te])Ht.pop().restore();else{var Se=new rl,Ie="Xo"+(Object.keys(Jn).length+1).toString(10);Se.id=Ie,Lt[te]=Ie,Jn[Ie]=Se,Ut.publish("addFormObject",Se),Ht.pop().restore()}})(j),this},v.doFormObject=function(j,te){var Se=Jn[Lt[j]];return K("q"),K(te.toString()+" cm"),K("/"+Se.id+" Do"),K("Q"),this},v.getFormObject=function(j){var te=Jn[Lt[j]];return{x:te.x,y:te.y,width:te.width,height:te.height,matrix:te.matrix}},v.save=function(j,te){return j=j||"generated.pdf",(te=te||{}).returnPromise=te.returnPromise||!1,te.returnPromise===!1?(yh(Ra(co()),j),typeof yh.unload=="function"&&oi.setTimeout&&setTimeout(yh.unload,911),this):new Promise(function(Se,Ie){try{var Ve=yh(Ra(co()),j);typeof yh.unload=="function"&&oi.setTimeout&&setTimeout(yh.unload,911),Se(Ve)}catch(lt){Ie(lt.message)}})},Mn.API)Mn.API.hasOwnProperty(Ka)&&(Ka==="events"&&Mn.API.events.length?(function(j,te){var Se,Ie,Ve;for(Ve=te.length-1;Ve!==-1;Ve--)Se=te[Ve][0],Ie=te[Ve][1],j.subscribe.apply(j,[Se].concat(typeof Ie=="function"?[Ie]:Ie))})(Ut,Mn.API.events):v[Ka]=Mn.API[Ka]);function sl(j){return Qt[j].mediaBox.topRightX-Qt[j].mediaBox.bottomLeftX}function Ac(j,te){Qt[j].mediaBox.topRightX=te+Qt[j].mediaBox.bottomLeftX}function Yl(j){return Qt[j].mediaBox.topRightY-Qt[j].mediaBox.bottomLeftY}function kl(j,te){Qt[j].mediaBox.topRightY=te+Qt[j].mediaBox.bottomLeftY}var Eo=v.getPageWidth=function(j){return sl(j=j||Q)/Wt},uu=v.setPageWidth=function(j,te){Ac(j,te*Wt)},wn=v.getPageHeight=function(j){return Yl(j=j||Q)/Wt},Ro=v.setPageHeight=function(j,te){kl(j,te*Wt)};return v.internal={pdfEscape:wi,getStyle:Gl,getFont:ho,getFontSize:ze,getCharSpace:Bi,getTextColor:du,getLineHeight:li,getLineHeightFactor:Gc,getLineWidth:Po,write:jt,getHorizontalCoordinate:ga,getVerticalCoordinate:gn,getCoordinateString:jn,getVerticalCoordinateString:ui,collections:{},newObject:Fn,newAdditionalObject:ri,newObjectDeferred:Xn,newObjectDeferredBegin:ci,getFilters:ha,putStream:Na,events:Ut,scaleFactor:Wt,pageSize:{getWidth:function(){return Eo(Q)},setWidth:function(j){uu(Q,j)},getHeight:function(){return wn(Q)},setHeight:function(j){Ro(Q,j)}},encryptionOptions:m,encryption:Ki,getEncryptor:function(j){return m!==null?Ki.encryptor(j,0):function(te){return te}},output:ea,getNumberOfPages:Ga,get pages(){return Ze},out:K,f2:W,f3:I,getPageInfo:Si,getPageInfoByObjId:Fr,getCurrentPageInfo:$c,getPDFVersion:T,Point:Xa,Rectangle:as,Matrix:Et,hasHotfix:ki},Object.defineProperty(v.internal.pageSize,"width",{get:function(){return Eo(Q)},set:function(j){uu(Q,j)},enumerable:!0,configurable:!0}),Object.defineProperty(v.internal.pageSize,"height",{get:function(){return wn(Q)},set:function(j){Ro(Q,j)},enumerable:!0,configurable:!0}),(function(j){for(var te=0,Se=Yt.length;te<Se;te++){var Ie=Qo.call(this,j[te][0],j[te][1],j[te][2],Yt[te][3],!0);y===!1&&(A[Ie]=!0);var Ve=j[te][0].split("-");On({id:Ie,fontName:Ve[0],fontStyle:Ve[1]||""})}Ut.publish("addFonts",{fonts:rn,dictionary:un})}).call(v,Yt),St="F1",Ea(r,t),Ut.publish("initialized"),v}of.prototype.lsbFirstWord=function(s){return String.fromCharCode(255&s,s>>8&255,s>>16&255,s>>24&255)},of.prototype.toHexString=function(s){return s.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},of.prototype.hexToBytes=function(s){for(var e=[],t=0;t<s.length;t+=2)e.push(String.fromCharCode(parseInt(s.substr(t,2),16)));return e.join("")},of.prototype.processOwnerPassword=function(s,e){return Qm(Jm(e).substr(0,5),s)},of.prototype.encryptor=function(s,e){var t=Jm(this.encryptionKey+String.fromCharCode(255&s,s>>8&255,s>>16&255,255&e,e>>8&255)).substr(0,10);return function(n){return Qm(t,n)}},t0.prototype.equals=function(s){var e,t="id,objectNumber,equals";if(!s||zr(s)!==zr(this))return!1;var n=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!s.hasOwnProperty(e)||this[e]!==s[e])return!1;n++}for(e in s)s.hasOwnProperty(e)&&t.indexOf(e)<0&&n--;return n===0},Mn.API={events:[]},Mn.version="3.0.4";var Js=Mn.API,Ay=1,Nh=function(s){return s.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},nf=function(s){return s.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},yi=function(s){return s.toFixed(2)},Uu=function(s){return s.toFixed(5)};Js.__acroform__={};var Wl=function(s,e){s.prototype=Object.create(e.prototype),s.prototype.constructor=s},ab=function(s){return s*Ay},Rd=function(s){var e=new q2,t=Cn.internal.getHeight(s)||0,n=Cn.internal.getWidth(s)||0;return e.BBox=[0,0,Number(yi(n)),Number(yi(t))],e},MA=Js.__acroform__.setBit=function(s,e){if(s=s||0,e=e||0,isNaN(s)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return s|1<<e},IA=Js.__acroform__.clearBit=function(s,e){if(s=s||0,e=e||0,isNaN(s)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return s&~(1<<e)},zA=Js.__acroform__.getBit=function(s,e){if(isNaN(s)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return s&1<<e?1:0},ca=Js.__acroform__.getBitForPdf=function(s,e){if(isNaN(s)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return zA(s,e-1)},da=Js.__acroform__.setBitForPdf=function(s,e){if(isNaN(s)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return MA(s,e-1)},ua=Js.__acroform__.clearBitForPdf=function(s,e){if(isNaN(s)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return IA(s,e-1)},BA=Js.__acroform__.calculateCoordinates=function(s,e){var t=e.internal.getHorizontalCoordinate,n=e.internal.getVerticalCoordinate,r=s[0],o=s[1],d=s[2],c=s[3],h={};return h.lowerLeft_X=t(r)||0,h.lowerLeft_Y=n(o+c)||0,h.upperRight_X=t(r+d)||0,h.upperRight_Y=n(o)||0,[Number(yi(h.lowerLeft_X)),Number(yi(h.lowerLeft_Y)),Number(yi(h.upperRight_X)),Number(yi(h.upperRight_Y))]},FA=function(s){if(s.appearanceStreamContent)return s.appearanceStreamContent;if(s.V||s.DV){var e=[],t=s._V||s.DV,n=ey(s,t),r=s.scope.internal.getFont(s.fontName,s.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(s.scope.__private__.encodeColorString(s.color)),e.push("/"+r+" "+yi(n.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(n.text),e.push("ET"),e.push("Q"),e.push("EMC");var o=Rd(s);return o.scope=s.scope,o.stream=e.join(`
`),o}},ey=function(s,e){var t=s.fontSize===0?s.maxFontSize:s.fontSize,n={text:"",fontSize:""},r=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");r=s.multiline?r.map(function(W){return W.split(`
`)}):r.map(function(W){return[W]});var o=t,d=Cn.internal.getHeight(s)||0;d=d<0?-d:d;var c=Cn.internal.getWidth(s)||0;c=c<0?-c:c;var h=function(W,I,J){if(W+1<r.length){var Z=I+" "+r[W+1][0];return Pg(Z,s,J).width<=c-4}return!1};o++;e:for(;o>0;){e="",o--;var f,m,y=Pg("3",s,o).height,A=s.multiline?d-o:(d-y)/2,v=A+=2,N=0,T=0,_=0;if(o<=0){e=`(...) Tj
`,e+="% Width of Text: "+Pg(e,s,o=12).width+", FieldWidth:"+c+`
`;break}for(var b="",H=0,R=0;R<r.length;R++)if(r.hasOwnProperty(R)){var M=!1;if(r[R].length!==1&&_!==r[R].length-1){if((y+2)*(H+2)+2>d)continue e;b+=r[R][_],M=!0,T=R,R--}else{b=(b+=r[R][_]+" ").substr(b.length-1)==" "?b.substr(0,b.length-1):b;var B=parseInt(R),q=h(B,b,o),G=R>=r.length-1;if(q&&!G){b+=" ",_=0;continue}if(q||G){if(G)T=B;else if(s.multiline&&(y+2)*(H+2)+2>d)continue e}else{if(!s.multiline||(y+2)*(H+2)+2>d)continue e;T=B}}for(var X="",O=N;O<=T;O++){var Y=r[O];if(s.multiline){if(O===T){X+=Y[_]+" ",_=(_+1)%Y.length;continue}if(O===N){X+=Y[Y.length-1]+" ";continue}}X+=Y[0]+" "}switch(X=X.substr(X.length-1)==" "?X.substr(0,X.length-1):X,m=Pg(X,s,o).width,s.textAlign){case"right":f=c-m-2;break;case"center":f=(c-m)/2;break;default:f=2}e+=yi(f)+" "+yi(v)+` Td
`,e+="("+Nh(X)+`) Tj
`,e+=-yi(f)+` 0 Td
`,v=-(o+2),m=0,N=M?T:T+1,H++,b=""}break}return n.text=e,n.fontSize=o,n},Pg=function(s,e,t){var n=e.scope.internal.getFont(e.fontName,e.fontStyle),r=e.scope.getStringUnitWidth(s,{font:n,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:r}},OA={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},UA=function(s,e){var t={type:"reference",object:s};e.internal.getPageInfo(s.page).pageContext.annotations.find(function(n){return n.type===t.type&&n.object===t.object})===void 0&&e.internal.getPageInfo(s.page).pageContext.annotations.push(t)},HA=function(s,e){if(e.scope=s,s.internal!==void 0&&(s.internal.acroformPlugin===void 0||s.internal.acroformPlugin.isInitialized===!1)){if(cd.FieldNum=0,s.internal.acroformPlugin=JSON.parse(JSON.stringify(OA)),s.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Ay=s.internal.scaleFactor,s.internal.acroformPlugin.acroFormDictionaryRoot=new W2,s.internal.acroformPlugin.acroFormDictionaryRoot.scope=s,s.internal.acroformPlugin.acroFormDictionaryRoot._eventID=s.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(s)}),s.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var r in n)if(n.hasOwnProperty(r)){var o=n[r];o.objId=void 0,o.hasAnnotation&&UA(o,t)}})(s)}),s.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(s)}),s.internal.events.subscribe("postPutPages",function(t){(function(n,r){var o=!n;for(var d in n||(r.internal.newObjectDeferredBegin(r.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),r.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||r.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(d)){var c=n[d],h=[],f=c.Rect;if(c.Rect&&(c.Rect=BA(c.Rect,r)),r.internal.newObjectDeferredBegin(c.objId,!0),c.DA=Cn.createDefaultAppearanceStream(c),zr(c)==="object"&&typeof c.getKeyValueListForStream=="function"&&(h=c.getKeyValueListForStream()),c.Rect=f,c.hasAppearanceStream&&!c.appearanceStreamContent){var m=FA(c);h.push({key:"AP",value:"<</N "+m+">>"}),r.internal.acroformPlugin.xForms.push(m)}if(c.appearanceStreamContent){var y="";for(var A in c.appearanceStreamContent)if(c.appearanceStreamContent.hasOwnProperty(A)){var v=c.appearanceStreamContent[A];if(y+="/"+A+" ",y+="<<",Object.keys(v).length>=1||Array.isArray(v)){for(var d in v)if(v.hasOwnProperty(d)){var N=v[d];typeof N=="function"&&(N=N.call(r,c)),y+="/"+d+" "+N+" ",r.internal.acroformPlugin.xForms.indexOf(N)>=0||r.internal.acroformPlugin.xForms.push(N)}}else typeof(N=v)=="function"&&(N=N.call(r,c)),y+="/"+d+" "+N,r.internal.acroformPlugin.xForms.indexOf(N)>=0||r.internal.acroformPlugin.xForms.push(N);y+=">>"}h.push({key:"AP",value:`<<
`+y+">>"})}r.internal.putStream({additionalKeyValues:h,objectId:c.objId}),r.internal.out("endobj")}o&&(function(T,_){for(var b in T)if(T.hasOwnProperty(b)){var H=b,R=T[b];_.internal.newObjectDeferredBegin(R.objId,!0),zr(R)==="object"&&typeof R.putStream=="function"&&R.putStream(),delete T[H]}})(r.internal.acroformPlugin.xForms,r)})(t,s)}),s.internal.acroformPlugin.isInitialized=!0}},V2=Js.__acroform__.arrayToPdfArray=function(s,e,t){var n=function(d){return d};if(Array.isArray(s)){for(var r="[",o=0;o<s.length;o++)switch(o!==0&&(r+=" "),zr(s[o])){case"boolean":case"number":case"object":r+=s[o].toString();break;case"string":s[o].substr(0,1)!=="/"?(e!==void 0&&t&&(n=t.internal.getEncryptor(e)),r+="("+Nh(n(s[o].toString()))+")"):r+=s[o].toString()}return r+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},km=function(s,e,t){var n=function(r){return r};return e!==void 0&&t&&(n=t.internal.getEncryptor(e)),(s=s||"").toString(),"("+Nh(n(s))+")"},Md=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(s){this._objId=s}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Md.prototype.toString=function(){return this.objId+" 0 R"},Md.prototype.putStream=function(){var s=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:s,objectId:this.objId}),this.scope.internal.out("endobj")},Md.prototype.getKeyValueListForStream=function(){var s=[],e=Object.getOwnPropertyNames(this).filter(function(o){return o!="content"&&o!="appearanceStreamContent"&&o!="scope"&&o!="objId"&&o.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var n=e[t],r=this[n];r&&(Array.isArray(r)?s.push({key:n,value:V2(r,this.objId,this.scope)}):r instanceof Md?(r.scope=this.scope,s.push({key:n,value:r.objId+" 0 R"})):typeof r!="function"&&s.push({key:n,value:r}))}return s};var q2=function(){Md.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var s,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){s=t.trim()},get:function(){return s||null}})};Wl(q2,Md);var W2=function(){Md.call(this);var s,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(s){var t=function(n){return n};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Nh(t(s))+")"}},set:function(t){s=t}})};Wl(W2,Md);var cd=function s(){Md.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(b){if(isNaN(b))throw new Error('Invalid value "'+b+'" for attribute F supplied.');e=b}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!ca(e,3)},set:function(b){b?this.F=da(e,3):this.F=ua(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(b){if(isNaN(b))throw new Error('Invalid value "'+b+'" for attribute Ff supplied.');t=b}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(b){n=b!==void 0?b:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(b){n[0]=b}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(b){n[1]=b}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(b){n[2]=b}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(b){n[3]=b}});var r="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return r},set:function(b){switch(b){case"/Btn":case"/Tx":case"/Ch":case"/Sig":r=b;break;default:throw new Error('Invalid value "'+b+'" for attribute FT supplied.')}}});var o=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!o||o.length<1){if(this instanceof n0)return;o="FieldObject"+s.FieldNum++}var b=function(H){return H};return this.scope&&(b=this.scope.internal.getEncryptor(this.objId)),"("+Nh(b(o))+")"},set:function(b){o=b.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return o},set:function(b){o=b}});var d="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return d},set:function(b){d=b}});var c="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return c},set:function(b){c=b}});var h=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return h},set:function(b){h=b}});var f=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return f===void 0?50/Ay:f},set:function(b){f=b}});var m="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return m},set:function(b){m=b}});var y="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!y||this instanceof n0||this instanceof Ah))return km(y,this.objId,this.scope)},set:function(b){b=b.toString(),y=b}});var A=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(A)return this instanceof lo==0?km(A,this.objId,this.scope):A},set:function(b){b=b.toString(),A=this instanceof lo==0?b.substr(0,1)==="("?nf(b.substr(1,b.length-2)):nf(b):b}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof lo==1?nf(A.substr(1,A.length-1)):A},set:function(b){b=b.toString(),A=this instanceof lo==1?"/"+b:b}});var v=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(v)return v},set:function(b){this.V=b}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(v)return this instanceof lo==0?km(v,this.objId,this.scope):v},set:function(b){b=b.toString(),v=this instanceof lo==0?b.substr(0,1)==="("?nf(b.substr(1,b.length-2)):nf(b):b}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof lo==1?nf(v.substr(1,v.length-1)):v},set:function(b){b=b.toString(),v=this instanceof lo==1?"/"+b:b}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var N,T=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return T},set:function(b){b=!!b,T=b}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(N)return N},set:function(b){N=b}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,1)},set:function(b){b?this.Ff=da(this.Ff,1):this.Ff=ua(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,2)},set:function(b){b?this.Ff=da(this.Ff,2):this.Ff=ua(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,3)},set:function(b){b?this.Ff=da(this.Ff,3):this.Ff=ua(this.Ff,3)}});var _=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(_!==null)return _},set:function(b){if([0,1,2].indexOf(b)===-1)throw new Error('Invalid value "'+b+'" for attribute Q supplied.');_=b}}),Object.defineProperty(this,"textAlign",{get:function(){var b;switch(_){case 0:default:b="left";break;case 1:b="center";break;case 2:b="right"}return b},configurable:!0,enumerable:!0,set:function(b){switch(b){case"right":case 2:_=2;break;case"center":case 1:_=1;break;default:_=0}}})};Wl(cd,Md);var mf=function(){cd.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var s=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return s},set:function(t){s=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return s},set:function(t){s=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return V2(e,this.objId,this.scope)},set:function(t){var n,r;r=[],typeof(n=t)=="string"&&(r=(function(o,d,c){c||(c=1);for(var h,f=[];h=d.exec(o);)f.push(h[c]);return f})(n,/\((.*?)\)/g)),e=r}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,n){for(n=n||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,18)},set:function(t){t?this.Ff=da(this.Ff,18):this.Ff=ua(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=da(this.Ff,19):this.Ff=ua(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,20)},set:function(t){t?(this.Ff=da(this.Ff,20),e.sort()):this.Ff=ua(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,22)},set:function(t){t?this.Ff=da(this.Ff,22):this.Ff=ua(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,23)},set:function(t){t?this.Ff=da(this.Ff,23):this.Ff=ua(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,27)},set:function(t){t?this.Ff=da(this.Ff,27):this.Ff=ua(this.Ff,27)}}),this.hasAppearanceStream=!1};Wl(mf,cd);var yf=function(){mf.call(this),this.fontName="helvetica",this.combo=!1};Wl(yf,mf);var xf=function(){yf.call(this),this.combo=!0};Wl(xf,yf);var Wg=function(){xf.call(this),this.edit=!0};Wl(Wg,xf);var lo=function(){cd.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,15)},set:function(t){t?this.Ff=da(this.Ff,15):this.Ff=ua(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,16)},set:function(t){t?this.Ff=da(this.Ff,16):this.Ff=ua(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,17)},set:function(t){t?this.Ff=da(this.Ff,17):this.Ff=ua(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,26)},set:function(t){t?this.Ff=da(this.Ff,26):this.Ff=ua(this.Ff,26)}});var s,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(o){return o};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var n,r=[];for(n in r.push("<<"),e)r.push("/"+n+" ("+Nh(t(e[n]))+")");return r.push(">>"),r.join(`
`)}},set:function(t){zr(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return s},set:function(t){s=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return s.substr(1,s.length-1)},set:function(t){s="/"+t}})};Wl(lo,cd);var $g=function(){lo.call(this),this.pushButton=!0};Wl($g,lo);var bf=function(){lo.call(this),this.radio=!0,this.pushButton=!1;var s=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return s},set:function(e){s=e!==void 0?e:[]}})};Wl(bf,lo);var n0=function(){var s,e;cd.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return s},set:function(r){s=r}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(r){e=r}});var t,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(c){return c};this.scope&&(r=this.scope.internal.getEncryptor(this.objId));var o,d=[];for(o in d.push("<<"),n)d.push("/"+o+" ("+Nh(r(n[o]))+")");return d.push(">>"),d.join(`
`)},set:function(r){zr(r)==="object"&&(n=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(r){typeof r=="string"&&(n.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(r){t="/"+r}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Cn.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Wl(n0,cd),bf.prototype.setAppearance=function(s){if(!("createAppearanceStream"in s)||!("getCA"in s))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=s.createAppearanceStream(t.optionName),t.caption=s.getCA()}},bf.prototype.createOption=function(s){var e=new n0;return e.Parent=this,e.optionName=s,this.Kids.push(e),VA.call(this.scope,e),e};var Gg=function(){lo.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Cn.CheckBox.createAppearanceStream()};Wl(Gg,lo);var Ah=function(){cd.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,13)},set:function(e){e?this.Ff=da(this.Ff,13):this.Ff=ua(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,21)},set:function(e){e?this.Ff=da(this.Ff,21):this.Ff=ua(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,23)},set:function(e){e?this.Ff=da(this.Ff,23):this.Ff=ua(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,24)},set:function(e){e?this.Ff=da(this.Ff,24):this.Ff=ua(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,25)},set:function(e){e?this.Ff=da(this.Ff,25):this.Ff=ua(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,26)},set:function(e){e?this.Ff=da(this.Ff,26):this.Ff=ua(this.Ff,26)}});var s=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return s},set:function(e){s=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return s},set:function(e){Number.isInteger(e)&&(s=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Wl(Ah,cd);var Yg=function(){Ah.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!ca(this.Ff,14)},set:function(s){s?this.Ff=da(this.Ff,14):this.Ff=ua(this.Ff,14)}}),this.password=!0};Wl(Yg,Ah);var Cn={CheckBox:{createAppearanceStream:function(){return{N:{On:Cn.CheckBox.YesNormal},D:{On:Cn.CheckBox.YesPushDown,Off:Cn.CheckBox.OffPushDown}}},YesPushDown:function(s){var e=Rd(s);e.scope=s.scope;var t=[],n=s.scope.internal.getFont(s.fontName,s.fontStyle).id,r=s.scope.__private__.encodeColorString(s.color),o=ey(s,s.caption);return t.push("0.749023 g"),t.push("0 0 "+yi(Cn.internal.getWidth(s))+" "+yi(Cn.internal.getHeight(s))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+n+" "+yi(o.fontSize)+" Tf "+r),t.push("BT"),t.push(o.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(s){var e=Rd(s);e.scope=s.scope;var t=s.scope.internal.getFont(s.fontName,s.fontStyle).id,n=s.scope.__private__.encodeColorString(s.color),r=[],o=Cn.internal.getHeight(s),d=Cn.internal.getWidth(s),c=ey(s,s.caption);return r.push("1 g"),r.push("0 0 "+yi(d)+" "+yi(o)+" re"),r.push("f"),r.push("q"),r.push("0 0 1 rg"),r.push("0 0 "+yi(d-1)+" "+yi(o-1)+" re"),r.push("W"),r.push("n"),r.push("0 g"),r.push("BT"),r.push("/"+t+" "+yi(c.fontSize)+" Tf "+n),r.push(c.text),r.push("ET"),r.push("Q"),e.stream=r.join(`
`),e},OffPushDown:function(s){var e=Rd(s);e.scope=s.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+yi(Cn.internal.getWidth(s))+" "+yi(Cn.internal.getHeight(s))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(s){var e={D:{Off:Cn.RadioButton.Circle.OffPushDown},N:{}};return e.N[s]=Cn.RadioButton.Circle.YesNormal,e.D[s]=Cn.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(s){var e=Rd(s);e.scope=s.scope;var t=[],n=Cn.internal.getWidth(s)<=Cn.internal.getHeight(s)?Cn.internal.getWidth(s)/4:Cn.internal.getHeight(s)/4;n=Number((.9*n).toFixed(5));var r=Cn.internal.Bezier_C,o=Number((n*r).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+Uu(Cn.internal.getWidth(s)/2)+" "+Uu(Cn.internal.getHeight(s)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),t.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),t.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),t.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(s){var e=Rd(s);e.scope=s.scope;var t=[],n=Cn.internal.getWidth(s)<=Cn.internal.getHeight(s)?Cn.internal.getWidth(s)/4:Cn.internal.getHeight(s)/4;n=Number((.9*n).toFixed(5));var r=Number((2*n).toFixed(5)),o=Number((r*Cn.internal.Bezier_C).toFixed(5)),d=Number((n*Cn.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Uu(Cn.internal.getWidth(s)/2)+" "+Uu(Cn.internal.getHeight(s)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+o+" "+o+" "+r+" 0 "+r+" c"),t.push("-"+o+" "+r+" -"+r+" "+o+" -"+r+" 0 c"),t.push("-"+r+" -"+o+" -"+o+" -"+r+" 0 -"+r+" c"),t.push(o+" -"+r+" "+r+" -"+o+" "+r+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+Uu(Cn.internal.getWidth(s)/2)+" "+Uu(Cn.internal.getHeight(s)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+d+" "+d+" "+n+" 0 "+n+" c"),t.push("-"+d+" "+n+" -"+n+" "+d+" -"+n+" 0 c"),t.push("-"+n+" -"+d+" -"+d+" -"+n+" 0 -"+n+" c"),t.push(d+" -"+n+" "+n+" -"+d+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(s){var e=Rd(s);e.scope=s.scope;var t=[],n=Cn.internal.getWidth(s)<=Cn.internal.getHeight(s)?Cn.internal.getWidth(s)/4:Cn.internal.getHeight(s)/4;n=Number((.9*n).toFixed(5));var r=Number((2*n).toFixed(5)),o=Number((r*Cn.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Uu(Cn.internal.getWidth(s)/2)+" "+Uu(Cn.internal.getHeight(s)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+o+" "+o+" "+r+" 0 "+r+" c"),t.push("-"+o+" "+r+" -"+r+" "+o+" -"+r+" 0 c"),t.push("-"+r+" -"+o+" -"+o+" -"+r+" 0 -"+r+" c"),t.push(o+" -"+r+" "+r+" -"+o+" "+r+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(s){var e={D:{Off:Cn.RadioButton.Cross.OffPushDown},N:{}};return e.N[s]=Cn.RadioButton.Cross.YesNormal,e.D[s]=Cn.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(s){var e=Rd(s);e.scope=s.scope;var t=[],n=Cn.internal.calculateCross(s);return t.push("q"),t.push("1 1 "+yi(Cn.internal.getWidth(s)-2)+" "+yi(Cn.internal.getHeight(s)-2)+" re"),t.push("W"),t.push("n"),t.push(yi(n.x1.x)+" "+yi(n.x1.y)+" m"),t.push(yi(n.x2.x)+" "+yi(n.x2.y)+" l"),t.push(yi(n.x4.x)+" "+yi(n.x4.y)+" m"),t.push(yi(n.x3.x)+" "+yi(n.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(s){var e=Rd(s);e.scope=s.scope;var t=Cn.internal.calculateCross(s),n=[];return n.push("0.749023 g"),n.push("0 0 "+yi(Cn.internal.getWidth(s))+" "+yi(Cn.internal.getHeight(s))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+yi(Cn.internal.getWidth(s)-2)+" "+yi(Cn.internal.getHeight(s)-2)+" re"),n.push("W"),n.push("n"),n.push(yi(t.x1.x)+" "+yi(t.x1.y)+" m"),n.push(yi(t.x2.x)+" "+yi(t.x2.y)+" l"),n.push(yi(t.x4.x)+" "+yi(t.x4.y)+" m"),n.push(yi(t.x3.x)+" "+yi(t.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(s){var e=Rd(s);e.scope=s.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+yi(Cn.internal.getWidth(s))+" "+yi(Cn.internal.getHeight(s))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(s){var e=s.scope.internal.getFont(s.fontName,s.fontStyle).id,t=s.scope.__private__.encodeColorString(s.color);return"/"+e+" "+s.fontSize+" Tf "+t}};Cn.internal={Bezier_C:.551915024494,calculateCross:function(s){var e=Cn.internal.getWidth(s),t=Cn.internal.getHeight(s),n=Math.min(e,t);return{x1:{x:(e-n)/2,y:(t-n)/2+n},x2:{x:(e-n)/2+n,y:(t-n)/2},x3:{x:(e-n)/2,y:(t-n)/2},x4:{x:(e-n)/2+n,y:(t-n)/2+n}}}},Cn.internal.getWidth=function(s){var e=0;return zr(s)==="object"&&(e=ab(s.Rect[2])),e},Cn.internal.getHeight=function(s){var e=0;return zr(s)==="object"&&(e=ab(s.Rect[3])),e};var VA=Js.addField=function(s){if(HA(this,s),!(s instanceof cd))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=s).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),s.page=s.scope.internal.getCurrentPageInfo().pageNumber,this};Js.AcroFormChoiceField=mf,Js.AcroFormListBox=yf,Js.AcroFormComboBox=xf,Js.AcroFormEditBox=Wg,Js.AcroFormButton=lo,Js.AcroFormPushButton=$g,Js.AcroFormRadioButton=bf,Js.AcroFormCheckBox=Gg,Js.AcroFormTextField=Ah,Js.AcroFormPasswordField=Yg,Js.AcroFormAppearance=Cn,Js.AcroForm={ChoiceField:mf,ListBox:yf,ComboBox:xf,EditBox:Wg,Button:lo,PushButton:$g,RadioButton:bf,CheckBox:Gg,TextField:Ah,PasswordField:Yg,Appearance:Cn},Mn.AcroForm={ChoiceField:mf,ListBox:yf,ComboBox:xf,EditBox:Wg,Button:lo,PushButton:$g,RadioButton:bf,CheckBox:Gg,TextField:Ah,PasswordField:Yg,Appearance:Cn};Mn.AcroForm;function $2(s){return s.reduce(function(e,t,n){return e[t]=n,e},{})}(function(s){var e="addImage_";s.__addimage__={};var t="UNKNOWN",n={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=s.__addimage__.getImageFileTypeByImageData=function(W,I){var J,Z,Ce,ie,le,se=t;if((I=I||t)==="RGBA"||W.data!==void 0&&W.data instanceof Uint8ClampedArray&&"height"in W&&"width"in W)return"RGBA";if(q(W))for(le in n)for(Ce=n[le],J=0;J<Ce.length;J+=1){for(ie=!0,Z=0;Z<Ce[J].length;Z+=1)if(Ce[J][Z]!==void 0&&Ce[J][Z]!==W[Z]){ie=!1;break}if(ie===!0){se=le;break}}else for(le in n)for(Ce=n[le],J=0;J<Ce.length;J+=1){for(ie=!0,Z=0;Z<Ce[J].length;Z+=1)if(Ce[J][Z]!==void 0&&Ce[J][Z]!==W.charCodeAt(Z)){ie=!1;break}if(ie===!0){se=le;break}}return se===t&&I!==t&&(se=I),se},o=function W(I){for(var J=this.internal.write,Z=this.internal.putStream,Ce=(0,this.internal.getFilters)();Ce.indexOf("FlateEncode")!==-1;)Ce.splice(Ce.indexOf("FlateEncode"),1);I.objectId=this.internal.newObject();var ie=[];if(ie.push({key:"Type",value:"/XObject"}),ie.push({key:"Subtype",value:"/Image"}),ie.push({key:"Width",value:I.width}),ie.push({key:"Height",value:I.height}),I.colorSpace===b.INDEXED?ie.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(I.palette.length/3-1)+" "+("sMask"in I&&I.sMask!==void 0?I.objectId+2:I.objectId+1)+" 0 R]"}):(ie.push({key:"ColorSpace",value:"/"+I.colorSpace}),I.colorSpace===b.DEVICE_CMYK&&ie.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),ie.push({key:"BitsPerComponent",value:I.bitsPerComponent}),"decodeParameters"in I&&I.decodeParameters!==void 0&&ie.push({key:"DecodeParms",value:"<<"+I.decodeParameters+">>"}),"transparency"in I&&Array.isArray(I.transparency)&&I.transparency.length>0){for(var le="",se=0,Ae=I.transparency.length;se<Ae;se++)le+=I.transparency[se]+" "+I.transparency[se]+" ";ie.push({key:"Mask",value:"["+le+"]"})}I.sMask!==void 0&&ie.push({key:"SMask",value:I.objectId+1+" 0 R"});var ue=I.filter!==void 0?["/"+I.filter]:void 0;if(Z({data:I.data,additionalKeyValues:ie,alreadyAppliedFilters:ue,objectId:I.objectId}),J("endobj"),"sMask"in I&&I.sMask!==void 0){var E,L=(E=I.sMaskBitsPerComponent)!==null&&E!==void 0?E:I.bitsPerComponent,Q={width:I.width,height:I.height,colorSpace:"DeviceGray",bitsPerComponent:L,data:I.sMask};"filter"in I&&(Q.decodeParameters="/Predictor ".concat(I.predictor," /Colors 1 /BitsPerComponent ").concat(L," /Columns ").concat(I.width),Q.filter=I.filter),W.call(this,Q)}if(I.colorSpace===b.INDEXED){var ee=this.internal.newObject();Z({data:X(new Uint8Array(I.palette)),objectId:ee}),J("endobj")}},d=function(){var W=this.internal.collections[e+"images"];for(var I in W)o.call(this,W[I])},c=function(){var W,I=this.internal.collections[e+"images"],J=this.internal.write;for(var Z in I)J("/I"+(W=I[Z]).index,W.objectId,"0","R")},h=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",d),this.internal.events.subscribe("putXobjectDict",c))},f=function(){var W=this.internal.collections[e+"images"];return h.call(this),W},m=function(){return Object.keys(this.internal.collections[e+"images"]).length},y=function(W){return typeof s["process"+W.toUpperCase()]=="function"},A=function(W){return zr(W)==="object"&&W.nodeType===1},v=function(W,I){if(W.nodeName==="IMG"&&W.hasAttribute("src")){var J=""+W.getAttribute("src");if(J.indexOf("data:image/")===0)return qg(unescape(J).split("base64,").pop());var Z=s.loadFile(J,!0);if(Z!==void 0)return Z}if(W.nodeName==="CANVAS"){if(W.width===0||W.height===0)throw new Error("Given canvas must have data. Canvas width: "+W.width+", height: "+W.height);var Ce;switch(I){case"PNG":Ce="image/png";break;case"WEBP":Ce="image/webp";break;default:Ce="image/jpeg"}return qg(W.toDataURL(Ce,1).split("base64,").pop())}},N=function(W){var I=this.internal.collections[e+"images"];if(I){for(var J in I)if(W===I[J].alias)return I[J]}},T=function(W,I,J){return W||I||(W=-96,I=-96),W<0&&(W=-1*J.width*72/W/this.internal.scaleFactor),I<0&&(I=-1*J.height*72/I/this.internal.scaleFactor),W===0&&(W=I*J.width/J.height),I===0&&(I=W*J.height/J.width),[W,I]},_=function(W,I,J,Z,Ce,ie){var le=T.call(this,J,Z,Ce),se=this.internal.getCoordinateString,Ae=this.internal.getVerticalCoordinateString,ue=f.call(this);if(J=le[0],Z=le[1],ue[Ce.index]=Ce,ie){ie*=Math.PI/180;var E=Math.cos(ie),L=Math.sin(ie),Q=function(oe){return oe.toFixed(4)},ee=[Q(E),Q(L),Q(-1*L),Q(E),0,0,"cm"]}this.internal.write("q"),ie?(this.internal.write([1,"0","0",1,se(W),Ae(I+Z),"cm"].join(" ")),this.internal.write(ee.join(" ")),this.internal.write([se(J),"0","0",se(Z),"0","0","cm"].join(" "))):this.internal.write([se(J),"0","0",se(Z),se(W),Ae(I+Z),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Ce.index+" Do"),this.internal.write("Q")},b=s.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};s.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var H=s.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},R=s.__addimage__.sHashCode=function(W){var I,J,Z=0;if(typeof W=="string")for(J=W.length,I=0;I<J;I++)Z=(Z<<5)-Z+W.charCodeAt(I),Z|=0;else if(q(W))for(J=W.byteLength/2,I=0;I<J;I++)Z=(Z<<5)-Z+W[I],Z|=0;return Z},M=s.__addimage__.validateStringAsBase64=function(W){(W=W||"").toString().trim();var I=!0;return W.length===0&&(I=!1),W.length%4!=0&&(I=!1),/^[A-Za-z0-9+/]+$/.test(W.substr(0,W.length-2))===!1&&(I=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(W.substr(-2))===!1&&(I=!1),I},B=s.__addimage__.extractImageFromDataUrl=function(W){if(W==null||!(W=W.trim()).startsWith("data:"))return null;var I=W.indexOf(",");return I<0?null:W.substring(0,I).trim().endsWith("base64")?W.substring(I+1):null};s.__addimage__.isArrayBuffer=function(W){return W instanceof ArrayBuffer};var q=s.__addimage__.isArrayBufferView=function(W){return W instanceof Int8Array||W instanceof Uint8Array||W instanceof Uint8ClampedArray||W instanceof Int16Array||W instanceof Uint16Array||W instanceof Int32Array||W instanceof Uint32Array||W instanceof Float32Array||W instanceof Float64Array},G=s.__addimage__.binaryStringToUint8Array=function(W){for(var I=W.length,J=new Uint8Array(I),Z=0;Z<I;Z++)J[Z]=W.charCodeAt(Z);return J},X=s.__addimage__.arrayBufferToBinaryString=function(W){for(var I="",J=q(W)?W:new Uint8Array(W),Z=0;Z<J.length;Z+=8192)I+=String.fromCharCode.apply(null,J.subarray(Z,Z+8192));return I};s.addImage=function(){var W,I,J,Z,Ce,ie,le,se,Ae;if(typeof arguments[1]=="number"?(I=t,J=arguments[1],Z=arguments[2],Ce=arguments[3],ie=arguments[4],le=arguments[5],se=arguments[6],Ae=arguments[7]):(I=arguments[1],J=arguments[2],Z=arguments[3],Ce=arguments[4],ie=arguments[5],le=arguments[6],se=arguments[7],Ae=arguments[8]),zr(W=arguments[0])==="object"&&!A(W)&&"imageData"in W){var ue=W;W=ue.imageData,I=ue.format||I||t,J=ue.x||J||0,Z=ue.y||Z||0,Ce=ue.w||ue.width||Ce,ie=ue.h||ue.height||ie,le=ue.alias||le,se=ue.compression||se,Ae=ue.rotation||ue.angle||Ae}var E=this.internal.getFilters();if(se===void 0&&E.indexOf("FlateEncode")!==-1&&(se="SLOW"),isNaN(J)||isNaN(Z))throw new Error("Invalid coordinates passed to jsPDF.addImage");h.call(this);var L=O.call(this,W,I,le,se);return _.call(this,J,Z,Ce,ie,L,Ae),this};var O=function(W,I,J,Z){var Ce,ie,le;if(typeof W=="string"&&r(W)===t){W=unescape(W);var se=Y(W,!1);(se!==""||(se=s.loadFile(W,!0))!==void 0)&&(W=se)}if(A(W)&&(W=v(W,I)),I=r(W,I),!y(I))throw new Error("addImage does not support files of type '"+I+"', please ensure that a plugin for '"+I+"' support is added.");if(((le=J)==null||le.length===0)&&(J=(function(Ae){return typeof Ae=="string"||q(Ae)?R(Ae):q(Ae.data)?R(Ae.data):null})(W)),(Ce=N.call(this,J))||(W instanceof Uint8Array||I==="RGBA"||(ie=W,W=G(W)),Ce=this["process"+I.toUpperCase()](W,m.call(this),J,(function(Ae){return Ae&&typeof Ae=="string"&&(Ae=Ae.toUpperCase()),Ae in s.image_compression?Ae:H.NONE})(Z),ie)),!Ce)throw new Error("An unknown error occurred whilst processing the image.");return Ce},Y=s.__addimage__.convertBase64ToBinaryString=function(W,I){I=typeof I!="boolean"||I;var J,Z="";if(typeof W=="string"){var Ce;J=(Ce=B(W))!==null&&Ce!==void 0?Ce:W;try{Z=qg(J)}catch(ie){if(I)throw M(J)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+ie.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Z};s.getImageProperties=function(W){var I,J,Z="";if(A(W)&&(W=v(W)),typeof W=="string"&&r(W)===t&&((Z=Y(W,!1))===""&&(Z=s.loadFile(W)||""),W=Z),J=r(W),!y(J))throw new Error("addImage does not support files of type '"+J+"', please ensure that a plugin for '"+J+"' support is added.");if(W instanceof Uint8Array||(W=G(W)),!(I=this["process"+J.toUpperCase()](W)))throw new Error("An unknown error occurred whilst processing the image");return I.fileType=J,I}})(Mn.API),(function(s){var e=function(t){if(t!==void 0&&t!="")return!0};Mn.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),s.events.push(["putPage",function(t){for(var n,r,o,d=this.internal.getCoordinateString,c=this.internal.getVerticalCoordinateString,h=this.internal.getPageInfoByObjId(t.objId),f=t.pageContext.annotations,m=!1,y=0;y<f.length&&!m;y++)switch((n=f[y]).type){case"link":(e(n.options.url)||e(n.options.pageNumber))&&(m=!0);break;case"reference":case"text":case"freetext":m=!0}if(m!=0){this.internal.write("/Annots [");for(var A=0;A<f.length;A++){n=f[A];var v=this.internal.pdfEscape,N=this.internal.getEncryptor(t.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var T=this.internal.newAdditionalObject(),_=this.internal.newAdditionalObject(),b=this.internal.getEncryptor(T.objId),H=n.title||"Note";o="<</Type /Annot /Subtype /Text "+(r="/Rect ["+d(n.bounds.x)+" "+c(n.bounds.y+n.bounds.h)+" "+d(n.bounds.x+n.bounds.w)+" "+c(n.bounds.y)+"] ")+"/Contents ("+v(b(n.contents))+")",o+=" /Popup "+_.objId+" 0 R",o+=" /P "+h.objId+" 0 R",o+=" /T ("+v(b(H))+") >>",T.content=o;var R=T.objId+" 0 R";o="<</Type /Annot /Subtype /Popup "+(r="/Rect ["+d(n.bounds.x+30)+" "+c(n.bounds.y+n.bounds.h)+" "+d(n.bounds.x+n.bounds.w+30)+" "+c(n.bounds.y)+"] ")+" /Parent "+R,n.open&&(o+=" /Open true"),o+=" >>",_.content=o,this.internal.write(T.objId,"0 R",_.objId,"0 R");break;case"freetext":r="/Rect ["+d(n.bounds.x)+" "+c(n.bounds.y)+" "+d(n.bounds.x+n.bounds.w)+" "+c(n.bounds.y+n.bounds.h)+"] ";var M=n.color||"#000000";o="<</Type /Annot /Subtype /FreeText "+r+"/Contents ("+v(N(n.contents))+")",o+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+M+")",o+=" /Border [0 0 0]",o+=" >>",this.internal.write(o);break;case"link":if(n.options.name){var B=this.annotations._nameMap[n.options.name];n.options.pageNumber=B.page,n.options.top=B.y}else n.options.top||(n.options.top=0);if(r="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",o="",n.options.url)o="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /A <</S /URI /URI ("+v(N(n.options.url))+") >>";else if(n.options.pageNumber)switch(o="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":o+=" /Fit]";break;case"FitH":o+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,o+=" /FitV "+n.options.left+"]";break;default:var q=c(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),o+=" /XYZ "+n.options.left+" "+q+" "+n.options.zoom+"]"}o!=""&&(o+=" >>",this.internal.write(o))}}this.internal.write("]")}}]),s.createAnnotation=function(t){var n=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":n.pageContext.annotations.push(t)}},s.link=function(t,n,r,o,d){var c=this.internal.getCurrentPageInfo(),h=this.internal.getCoordinateString,f=this.internal.getVerticalCoordinateString;c.pageContext.annotations.push({finalBounds:{x:h(t),y:f(n),w:h(t+r),h:f(n+o)},options:d,type:"link"})},s.textWithLink=function(t,n,r,o){var d,c,h=this.getTextWidth(t),f=this.internal.getLineHeight()/this.internal.scaleFactor;if(o.maxWidth!==void 0){c=o.maxWidth;var m=this.splitTextToSize(t,c).length;d=Math.ceil(f*m)}else c=h,d=f;return this.text(t,n,r,o),r+=.2*f,o.align==="center"&&(n-=h/2),o.align==="right"&&(n-=h),this.link(n,r-f,c,d,o),h},s.getTextWidth=function(t){var n=this.internal.getFontSize();return this.getStringUnitWidth(t)*n/this.internal.scaleFactor}})(Mn.API),(function(s){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},r=[1570,1571,1573,1575];s.__arabicParser__={};var o=s.__arabicParser__.isInArabicSubstitutionA=function(T){return e[T.charCodeAt(0)]!==void 0},d=s.__arabicParser__.isArabicLetter=function(T){return typeof T=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(T)},c=s.__arabicParser__.isArabicEndLetter=function(T){return d(T)&&o(T)&&e[T.charCodeAt(0)].length<=2},h=s.__arabicParser__.isArabicAlfLetter=function(T){return d(T)&&r.indexOf(T.charCodeAt(0))>=0};s.__arabicParser__.arabicLetterHasIsolatedForm=function(T){return d(T)&&o(T)&&e[T.charCodeAt(0)].length>=1};var f=s.__arabicParser__.arabicLetterHasFinalForm=function(T){return d(T)&&o(T)&&e[T.charCodeAt(0)].length>=2};s.__arabicParser__.arabicLetterHasInitialForm=function(T){return d(T)&&o(T)&&e[T.charCodeAt(0)].length>=3};var m=s.__arabicParser__.arabicLetterHasMedialForm=function(T){return d(T)&&o(T)&&e[T.charCodeAt(0)].length==4},y=s.__arabicParser__.resolveLigatures=function(T){var _=0,b=t,H="",R=0;for(_=0;_<T.length;_+=1)b[T.charCodeAt(_)]!==void 0?(R++,typeof(b=b[T.charCodeAt(_)])=="number"&&(H+=String.fromCharCode(b),b=t,R=0),_===T.length-1&&(b=t,H+=T.charAt(_-(R-1)),_-=R-1,R=0)):(b=t,H+=T.charAt(_-R),_-=R,R=0);return H};s.__arabicParser__.isArabicDiacritic=function(T){return T!==void 0&&n[T.charCodeAt(0)]!==void 0};var A=s.__arabicParser__.getCorrectForm=function(T,_,b){return d(T)?o(T)===!1?-1:!f(T)||!d(_)&&!d(b)||!d(b)&&c(_)||c(T)&&!d(_)||c(T)&&h(_)||c(T)&&c(_)?0:m(T)&&d(_)&&!c(_)&&d(b)&&f(b)?3:c(T)||!d(b)?1:2:-1},v=function(T){var _=0,b=0,H=0,R="",M="",B="",q=(T=T||"").split("\\s+"),G=[];for(_=0;_<q.length;_+=1){for(G.push(""),b=0;b<q[_].length;b+=1)R=q[_][b],M=q[_][b-1],B=q[_][b+1],d(R)?(H=A(R,M,B),G[_]+=H!==-1?String.fromCharCode(e[R.charCodeAt(0)][H]):R):G[_]+=R;G[_]=y(G[_])}return G.join(" ")},N=s.__arabicParser__.processArabic=s.processArabic=function(){var T,_=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,b=[];if(Array.isArray(_)){var H=0;for(b=[],H=0;H<_.length;H+=1)Array.isArray(_[H])?b.push([v(_[H][0]),_[H][1],_[H][2]]):b.push([v(_[H])]);T=b}else T=v(_);return typeof arguments[0]=="string"?T:(arguments[0].text=T,arguments[0])};s.events.push(["preProcessText",N])})(Mn.API),Mn.API.autoPrint=function(s){var e;return(s=s||{}).variant=s.variant||"non-conform",s.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},(function(s){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(c){t=c}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(c){n=isNaN(c)||Number.isInteger(c)===!1||c<0?150:c,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var r=300;Object.defineProperty(this,"height",{get:function(){return r},set:function(c){r=isNaN(c)||Number.isInteger(c)===!1||c<0?300:c,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=r+1)}});var o=[];Object.defineProperty(this,"childNodes",{get:function(){return o},set:function(c){o=c}});var d={};Object.defineProperty(this,"style",{get:function(){return d},set:function(c){d=c}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,n){var r;if((t=t||"2d")!=="2d")return null;for(r in n)this.pdf.context2d.hasOwnProperty(r)&&(this.pdf.context2d[r]=n[r]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},s.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])})(Mn.API),(function(s){var e={left:0,top:0,bottom:0,right:0},t=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),r.call(this))},r=function(){this.internal.__cell__.lastCell=new o,this.internal.__cell__.pages=1},o=function(){var h=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return h},set:function(T){h=T}});var f=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return f},set:function(T){f=T}});var m=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return m},set:function(T){m=T}});var y=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return y},set:function(T){y=T}});var A=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return A},set:function(T){A=T}});var v=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return v},set:function(T){v=T}});var N=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return N},set:function(T){N=T}}),this};o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},o.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},s.setHeaderFunction=function(h){return n.call(this),this.internal.__cell__.headerFunction=typeof h=="function"?h:void 0,this},s.getTextDimensions=function(h,f){n.call(this);var m=(f=f||{}).fontSize||this.getFontSize(),y=f.font||this.getFont(),A=f.scaleFactor||this.internal.scaleFactor,v=0,N=0,T=0,_=this;if(!Array.isArray(h)&&typeof h!="string"){if(typeof h!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");h=String(h)}var b=f.maxWidth;b>0?typeof h=="string"?h=this.splitTextToSize(h,b):Object.prototype.toString.call(h)==="[object Array]"&&(h=h.reduce(function(R,M){return R.concat(_.splitTextToSize(M,b))},[])):h=Array.isArray(h)?h:[h];for(var H=0;H<h.length;H++)v<(T=this.getStringUnitWidth(h[H],{font:y})*m)&&(v=T);return v!==0&&(N=h.length),{w:v/=A,h:Math.max((N*m*this.getLineHeightFactor()-m*(this.getLineHeightFactor()-1))/A,0)}},s.cellAddPage=function(){n.call(this),this.addPage();var h=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new o(h.left,h.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var d=s.cell=function(){var h;h=arguments[0]instanceof o?arguments[0]:new o(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),n.call(this);var f=this.internal.__cell__.lastCell,m=this.internal.__cell__.padding,y=this.internal.__cell__.margins||e,A=this.internal.__cell__.tableHeaderRow,v=this.internal.__cell__.printHeaders;return f.lineNumber!==void 0&&(f.lineNumber===h.lineNumber?(h.x=(f.x||0)+(f.width||0),h.y=f.y||0):f.y+f.height+h.height+y.bottom>this.getPageHeight()?(this.cellAddPage(),h.y=y.top,v&&A&&(this.printHeaderRow(h.lineNumber,!0),h.y+=A[0].height)):h.y=f.y+f.height||h.y),h.text[0]!==void 0&&(this.rect(h.x,h.y,h.width,h.height,t===!0?"FD":void 0),h.align==="right"?this.text(h.text,h.x+h.width-m,h.y+m,{align:"right",baseline:"top"}):h.align==="center"?this.text(h.text,h.x+h.width/2,h.y+m,{align:"center",baseline:"top",maxWidth:h.width-m-m}):this.text(h.text,h.x+m,h.y+m,{align:"left",baseline:"top",maxWidth:h.width-m-m})),this.internal.__cell__.lastCell=h,this};s.table=function(h,f,m,y,A){if(n.call(this),!m)throw new Error("No data for PDF table.");var v,N,T,_,b=[],H=[],R=[],M={},B={},q=[],G=[],X=(A=A||{}).autoSize||!1,O=A.printHeaders!==!1,Y=A.css&&A.css["font-size"]!==void 0?16*A.css["font-size"]:A.fontSize||12,W=A.margins||Object.assign({width:this.getPageWidth()},e),I=typeof A.padding=="number"?A.padding:3,J=A.headerBackgroundColor||"#c8c8c8",Z=A.headerTextColor||"#000";if(r.call(this),this.internal.__cell__.printHeaders=O,this.internal.__cell__.margins=W,this.internal.__cell__.table_font_size=Y,this.internal.__cell__.padding=I,this.internal.__cell__.headerBackgroundColor=J,this.internal.__cell__.headerTextColor=Z,this.setFontSize(Y),y==null)H=b=Object.keys(m[0]),R=b.map(function(){return"left"});else if(Array.isArray(y)&&zr(y[0])==="object")for(b=y.map(function(ue){return ue.name}),H=y.map(function(ue){return ue.prompt||ue.name||""}),R=y.map(function(ue){return ue.align||"left"}),v=0;v<y.length;v+=1)B[y[v].name]=.7499990551181103*y[v].width;else Array.isArray(y)&&typeof y[0]=="string"&&(H=b=y,R=b.map(function(){return"left"}));if(X||Array.isArray(y)&&typeof y[0]=="string")for(v=0;v<b.length;v+=1){for(M[_=b[v]]=m.map(function(ue){return ue[_]}),this.setFont(void 0,"bold"),q.push(this.getTextDimensions(H[v],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),N=M[_],this.setFont(void 0,"normal"),T=0;T<N.length;T+=1)q.push(this.getTextDimensions(N[T],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);B[_]=Math.max.apply(null,q)+I+I,q=[]}if(O){var Ce={};for(v=0;v<b.length;v+=1)Ce[b[v]]={},Ce[b[v]].text=H[v],Ce[b[v]].align=R[v];var ie=c.call(this,Ce,B);G=b.map(function(ue){return new o(h,f,B[ue],ie,Ce[ue].text,void 0,Ce[ue].align)}),this.setTableHeaderRow(G),this.printHeaderRow(1,!1)}var le=y.reduce(function(ue,E){return ue[E.name]=E.align,ue},{});for(v=0;v<m.length;v+=1){"rowStart"in A&&A.rowStart instanceof Function&&A.rowStart({row:v,data:m[v]},this);var se=c.call(this,m[v],B);for(T=0;T<b.length;T+=1){var Ae=m[v][b[T]];"cellStart"in A&&A.cellStart instanceof Function&&A.cellStart({row:v,col:T,data:Ae},this),d.call(this,new o(h,f,B[b[T]],se,Ae,v+2,le[b[T]]))}}return this.internal.__cell__.table_x=h,this.internal.__cell__.table_y=f,this};var c=function(h,f){var m=this.internal.__cell__.padding,y=this.internal.__cell__.table_font_size,A=this.internal.scaleFactor;return Object.keys(h).map(function(v){var N=h[v];return this.splitTextToSize(N.hasOwnProperty("text")?N.text:N,f[v]-m-m)},this).map(function(v){return this.getLineHeightFactor()*v.length*y/A+m+m},this).reduce(function(v,N){return Math.max(v,N)},0)};s.setTableHeaderRow=function(h){n.call(this),this.internal.__cell__.tableHeaderRow=h},s.printHeaderRow=function(h,f){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var m;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var y=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new o(y[0],y[1],y[2],y[3],void 0,-1)}this.setFont(void 0,"bold");for(var A=[],v=0;v<this.internal.__cell__.tableHeaderRow.length;v+=1){m=this.internal.__cell__.tableHeaderRow[v].clone(),f&&(m.y=this.internal.__cell__.margins.top||0,A.push(m)),m.lineNumber=h;var N=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),d.call(this,m),this.setTextColor(N)}A.length>0&&this.setTableHeaderRow(A),this.setFont(void 0,"normal"),t=!1}})(Mn.API);var G2={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},Y2=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],ty=$2(Y2),X2=[100,200,300,400,500,600,700,800,900],qA=$2(X2);function _m(s){var e=s.family.replace(/"|'/g,"").toLowerCase(),t=(function(o){return G2[o=o||"normal"]?o:"normal"})(s.style),n=(function(o){return o?typeof o=="number"?o>=100&&o<=900&&o%100==0?o:400:/^\d00$/.test(o)?parseInt(o):o==="bold"?700:400:400})(s.weight),r=(function(o){return typeof ty[o=o||"normal"]=="number"?o:"normal"})(s.stretch);return{family:e,style:t,weight:n,stretch:r,src:s.src||[],ref:s.ref||{name:e,style:[r,t,n].join(" ")}}}function ob(s,e,t,n){var r;for(r=t;r>=0&&r<e.length;r+=n)if(s[e[r]])return s[e[r]];for(r=t;r>=0&&r<e.length;r-=n)if(s[e[r]])return s[e[r]]}var WA={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},lb={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function cb(s){return[s.stretch,s.style,s.weight,s.family].join(" ")}function db(s){return s.trimLeft()}function $A(s,e){for(var t=0;t<s.length;){if(s.charAt(t)===e)return[s.substring(0,t),s.substring(t+1)];t+=1}return null}function GA(s){var e=s.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],s.substring(e[0].length)]}var Eg,ub,hb,rf,Rg,fb,pb,gb,jm=["times"];function mb(s,e,t,n,r){var o=4,d=xb;switch(r){case Mn.API.image_compression.FAST:o=1,d=yb;break;case Mn.API.image_compression.MEDIUM:o=6,d=bb;break;case Mn.API.image_compression.SLOW:o=9,d=vb}s=(function(h,f,m,y){for(var A,v=h.length/f,N=new Uint8Array(h.length+v),T=[YA,yb,xb,bb,vb],_=0;_<v;_+=1){var b=_*f,H=h.subarray(b,b+f);if(y)N.set(y(H,m,A),b+_);else{for(var R=T.length,M=[],B=0;B<R;B+=1)M[B]=T[B](H,m,A);var q=KA(M.concat());N.set(M[q],b+_)}A=H}return N})(s,e,Math.ceil(t*n/8),d);var c=Ym(s,{level:o});return Mn.API.__addimage__.arrayBufferToBinaryString(c)}function YA(s){var e=Array.apply([],s);return e.unshift(0),e}function yb(s,e){var t=s.length,n=[];n[0]=1;for(var r=0;r<t;r+=1){var o=s[r-e]||0;n[r+1]=s[r]-o+256&255}return n}function xb(s,e,t){var n=s.length,r=[];r[0]=2;for(var o=0;o<n;o+=1){var d=t&&t[o]||0;r[o+1]=s[o]-d+256&255}return r}function bb(s,e,t){var n=s.length,r=[];r[0]=3;for(var o=0;o<n;o+=1){var d=s[o-e]||0,c=t&&t[o]||0;r[o+1]=s[o]+256-(d+c>>>1)&255}return r}function vb(s,e,t){var n=s.length,r=[];r[0]=4;for(var o=0;o<n;o+=1){var d=XA(s[o-e]||0,t&&t[o]||0,t&&t[o-e]||0);r[o+1]=s[o]-d+256&255}return r}function XA(s,e,t){if(s===e&&e===t)return s;var n=Math.abs(e-t),r=Math.abs(s-t),o=Math.abs(s+e-t-t);return n<=r&&n<=o?s:r<=o?e:t}function KA(s){var e=s.map(function(t){return t.reduce(function(n,r){return n+Math.abs(r)},0)});return e.indexOf(Math.min.apply(null,e))}function Nm(s,e,t){var n=e*t,r=Math.floor(n/8),o=16-(n-8*r+t),d=(1<<t)-1;return K2(s,r)>>o&d}function wb(s,e,t,n){var r=t*n,o=Math.floor(r/8),d=16-(r-8*o+n),c=(1<<n)-1,h=(e&c)<<d;(function(f,m,y){if(m+1<f.byteLength)f.setUint16(m,y,!1);else{var A=y>>8&255;f.setUint8(m,A)}})(s,o,K2(s,o)&~(c<<d)&65535|h)}function K2(s,e){return e+1<s.byteLength?s.getUint16(e,!1):s.getUint8(e)<<8}function ZA(s){var e=0;if(s[e++]!==71||s[e++]!==73||s[e++]!==70||s[e++]!==56||(s[e++]+1&253)!=56||s[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=s[e++]|s[e++]<<8,n=s[e++]|s[e++]<<8,r=s[e++],o=r>>7,d=1<<1+(7&r);s[e++],s[e++];var c=null,h=null;o&&(c=e,h=d,e+=3*d);var f=!0,m=[],y=0,A=null,v=0,N=null;for(this.width=t,this.height=n;f&&e<s.length;)switch(s[e++]){case 33:switch(s[e++]){case 255:if(s[e]!==11||s[e+1]==78&&s[e+2]==69&&s[e+3]==84&&s[e+4]==83&&s[e+5]==67&&s[e+6]==65&&s[e+7]==80&&s[e+8]==69&&s[e+9]==50&&s[e+10]==46&&s[e+11]==48&&s[e+12]==3&&s[e+13]==1&&s[e+16]==0)e+=14,N=s[e++]|s[e++]<<8,e++;else for(e+=12;;){if(!((W=s[e++])>=0))throw Error("Invalid block size");if(W===0)break;e+=W}break;case 249:if(s[e++]!==4||s[e+4]!==0)throw new Error("Invalid graphics extension block.");var T=s[e++];y=s[e++]|s[e++]<<8,A=s[e++],1&T||(A=null),v=T>>2&7,e++;break;case 254:for(;;){if(!((W=s[e++])>=0))throw Error("Invalid block size");if(W===0)break;e+=W}break;default:throw new Error("Unknown graphic control label: 0x"+s[e-1].toString(16))}break;case 44:var _=s[e++]|s[e++]<<8,b=s[e++]|s[e++]<<8,H=s[e++]|s[e++]<<8,R=s[e++]|s[e++]<<8,M=s[e++],B=M>>6&1,q=1<<1+(7&M),G=c,X=h,O=!1;M>>7&&(O=!0,G=e,X=q,e+=3*q);var Y=e;for(e++;;){var W;if(!((W=s[e++])>=0))throw Error("Invalid block size");if(W===0)break;e+=W}m.push({x:_,y:b,width:H,height:R,has_local_palette:O,palette_offset:G,palette_size:X,data_offset:Y,data_length:e-Y,transparent_index:A,interlaced:!!B,delay:y,disposal:v});break;case 59:f=!1;break;default:throw new Error("Unknown gif block: 0x"+s[e-1].toString(16))}this.numFrames=function(){return m.length},this.loopCount=function(){return N},this.frameInfo=function(I){if(I<0||I>=m.length)throw new Error("Frame index out of range.");return m[I]},this.decodeAndBlitFrameBGRA=function(I,J){var Z=this.frameInfo(I),Ce=Z.width*Z.height,ie=new Uint8Array(Ce);Sb(s,Z.data_offset,ie,Ce);var le=Z.palette_offset,se=Z.transparent_index;se===null&&(se=256);var Ae=Z.width,ue=t-Ae,E=Ae,L=4*(Z.y*t+Z.x),Q=4*((Z.y+Z.height)*t+Z.x),ee=L,oe=4*ue;Z.interlaced===!0&&(oe+=4*t*7);for(var xe=8,re=0,Le=ie.length;re<Le;++re){var Ee=ie[re];if(E===0&&(E=Ae,(ee+=oe)>=Q&&(oe=4*ue+4*t*(xe-1),ee=L+(Ae+ue)*(xe<<1),xe>>=1)),Ee===se)ee+=4;else{var Oe=s[le+3*Ee],Ze=s[le+3*Ee+1],st=s[le+3*Ee+2];J[ee++]=st,J[ee++]=Ze,J[ee++]=Oe,J[ee++]=255}--E}},this.decodeAndBlitFrameRGBA=function(I,J){var Z=this.frameInfo(I),Ce=Z.width*Z.height,ie=new Uint8Array(Ce);Sb(s,Z.data_offset,ie,Ce);var le=Z.palette_offset,se=Z.transparent_index;se===null&&(se=256);var Ae=Z.width,ue=t-Ae,E=Ae,L=4*(Z.y*t+Z.x),Q=4*((Z.y+Z.height)*t+Z.x),ee=L,oe=4*ue;Z.interlaced===!0&&(oe+=4*t*7);for(var xe=8,re=0,Le=ie.length;re<Le;++re){var Ee=ie[re];if(E===0&&(E=Ae,(ee+=oe)>=Q&&(oe=4*ue+4*t*(xe-1),ee=L+(Ae+ue)*(xe<<1),xe>>=1)),Ee===se)ee+=4;else{var Oe=s[le+3*Ee],Ze=s[le+3*Ee+1],st=s[le+3*Ee+2];J[ee++]=Oe,J[ee++]=Ze,J[ee++]=st,J[ee++]=255}--E}}}function Sb(s,e,t,n){for(var r=s[e++],o=1<<r,d=o+1,c=d+1,h=r+1,f=(1<<h)-1,m=0,y=0,A=0,v=s[e++],N=new Int32Array(4096),T=null;;){for(;m<16&&v!==0;)y|=s[e++]<<m,m+=8,v===1?v=s[e++]:--v;if(m<h)break;var _=y&f;if(y>>=h,m-=h,_!==o){if(_===d)break;for(var b=_<c?_:T,H=0,R=b;R>o;)R=N[R]>>8,++H;var M=R;if(A+H+(b!==_?1:0)>n)return void rs.log("Warning, gif stream longer than expected.");t[A++]=M;var B=A+=H;for(b!==_&&(t[A++]=M),R=b;H--;)R=N[R],t[--B]=255&R,R>>=8;T!==null&&c<4096&&(N[c++]=T<<8|M,c>=f+1&&h<12&&(++h,f=f<<1|1)),T=_}else c=d+1,f=(1<<(h=r+1))-1,T=null}return A!==n&&rs.log("Warning, gif stream shorter than expected."),t}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function Pm(s){var e,t,n,r,o,d=Math.floor,c=new Array(64),h=new Array(64),f=new Array(64),m=new Array(64),y=new Array(65535),A=new Array(65535),v=new Array(64),N=new Array(64),T=[],_=0,b=7,H=new Array(64),R=new Array(64),M=new Array(64),B=new Array(256),q=new Array(2048),G=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],X=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],O=[0,1,2,3,4,5,6,7,8,9,10,11],Y=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],W=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],I=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],J=[0,1,2,3,4,5,6,7,8,9,10,11],Z=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Ce=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ie(L,Q){for(var ee=0,oe=0,xe=new Array,re=1;re<=16;re++){for(var Le=1;Le<=L[re];Le++)xe[Q[oe]]=[],xe[Q[oe]][0]=ee,xe[Q[oe]][1]=re,oe++,ee++;ee*=2}return xe}function le(L){for(var Q=L[0],ee=L[1]-1;ee>=0;)Q&1<<ee&&(_|=1<<b),ee--,--b<0&&(_==255?(se(255),se(0)):se(_),b=7,_=0)}function se(L){T.push(L)}function Ae(L){se(L>>8&255),se(255&L)}function ue(L,Q,ee,oe,xe){for(var re,Le=xe[0],Ee=xe[240],Oe=(function(yt,on){var ze,Ne,Ct,wt,it,pt,Ot,Qe,St,Wt,Bt=0;for(St=0;St<8;++St){ze=yt[Bt],Ne=yt[Bt+1],Ct=yt[Bt+2],wt=yt[Bt+3],it=yt[Bt+4],pt=yt[Bt+5],Ot=yt[Bt+6];var Ln=ze+(Qe=yt[Bt+7]),Kt=ze-Qe,rn=Ne+Ot,un=Ne-Ot,ot=Ct+pt,Zt=Ct-pt,sn=wt+it,Ft=wt-it,Jt=Ln+sn,yn=Ln-sn,_n=rn+ot,Qt=rn-ot;yt[Bt]=Jt+_n,yt[Bt+4]=Jt-_n;var Ut=.707106781*(Qt+yn);yt[Bt+2]=yn+Ut,yt[Bt+6]=yn-Ut;var zi=.382683433*((Jt=Ft+Zt)-(Qt=un+Kt)),Jn=.5411961*Jt+zi,Lt=1.306562965*Qt+zi,Ht=.707106781*(_n=Zt+un),Et=Kt+Ht,ti=Kt-Ht;yt[Bt+5]=ti+Jn,yt[Bt+3]=ti-Jn,yt[Bt+1]=Et+Lt,yt[Bt+7]=Et-Lt,Bt+=8}for(Bt=0,St=0;St<8;++St){ze=yt[Bt],Ne=yt[Bt+8],Ct=yt[Bt+16],wt=yt[Bt+24],it=yt[Bt+32],pt=yt[Bt+40],Ot=yt[Bt+48];var vi=ze+(Qe=yt[Bt+56]),ar=ze-Qe,_t=Ne+Ot,Fn=Ne-Ot,Xn=Ct+pt,ci=Ct-pt,ri=wt+it,Br=wt-it,Di=vi+ri,Ni=vi-ri,Ns=_t+Xn,ha=_t-Xn;yt[Bt]=Di+Ns,yt[Bt+32]=Di-Ns;var Na=.707106781*(ha+Ni);yt[Bt+16]=Ni+Na,yt[Bt+48]=Ni-Na;var $l=.382683433*((Di=Br+ci)-(ha=Fn+ar)),Wa=.5411961*Di+$l,$a=1.306562965*ha+$l,No=.707106781*(Ns=ci+Fn),Qn=ar+No,Us=ar-No;yt[Bt+40]=Us+Wa,yt[Bt+24]=Us-Wa,yt[Bt+8]=Qn+$a,yt[Bt+56]=Qn-$a,Bt++}for(St=0;St<64;++St)Wt=yt[St]*on[St],v[St]=Wt>0?Wt+.5|0:Wt-.5|0;return v})(L,Q),Ze=0;Ze<64;++Ze)N[G[Ze]]=Oe[Ze];var st=N[0]-ee;ee=N[0],st==0?le(oe[0]):(le(oe[A[re=32767+st]]),le(y[re]));for(var mt=63;mt>0&&N[mt]==0;)mt--;if(mt==0)return le(Le),ee;for(var Mt,K=1;K<=mt;){for(var jt=K;N[K]==0&&K<=mt;)++K;var $t=K-jt;if($t>=16){Mt=$t>>4;for(var Yt=1;Yt<=Mt;++Yt)le(Ee);$t&=15}re=32767+N[K],le(xe[($t<<4)+A[re]]),le(y[re]),K++}return mt!=63&&le(Le),ee}function E(L){L=Math.min(Math.max(L,1),100),o!=L&&((function(Q){for(var ee=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],oe=0;oe<64;oe++){var xe=d((ee[oe]*Q+50)/100);xe=Math.min(Math.max(xe,1),255),c[G[oe]]=xe}for(var re=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Le=0;Le<64;Le++){var Ee=d((re[Le]*Q+50)/100);Ee=Math.min(Math.max(Ee,1),255),h[G[Le]]=Ee}for(var Oe=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Ze=0,st=0;st<8;st++)for(var mt=0;mt<8;mt++)f[Ze]=1/(c[G[Ze]]*Oe[st]*Oe[mt]*8),m[Ze]=1/(h[G[Ze]]*Oe[st]*Oe[mt]*8),Ze++})(L<50?Math.floor(5e3/L):Math.floor(200-2*L)),o=L)}this.encode=function(L,Q){Q&&E(Q),T=new Array,_=0,b=7,Ae(65496),Ae(65504),Ae(16),se(74),se(70),se(73),se(70),se(0),se(1),se(1),se(0),Ae(1),Ae(1),se(0),se(0),(function(){Ae(65499),Ae(132),se(0);for(var Ne=0;Ne<64;Ne++)se(c[Ne]);se(1);for(var Ct=0;Ct<64;Ct++)se(h[Ct])})(),(function(Ne,Ct){Ae(65472),Ae(17),se(8),Ae(Ct),Ae(Ne),se(3),se(1),se(17),se(0),se(2),se(17),se(1),se(3),se(17),se(1)})(L.width,L.height),(function(){Ae(65476),Ae(418),se(0);for(var Ne=0;Ne<16;Ne++)se(X[Ne+1]);for(var Ct=0;Ct<=11;Ct++)se(O[Ct]);se(16);for(var wt=0;wt<16;wt++)se(Y[wt+1]);for(var it=0;it<=161;it++)se(W[it]);se(1);for(var pt=0;pt<16;pt++)se(I[pt+1]);for(var Ot=0;Ot<=11;Ot++)se(J[Ot]);se(17);for(var Qe=0;Qe<16;Qe++)se(Z[Qe+1]);for(var St=0;St<=161;St++)se(Ce[St])})(),Ae(65498),Ae(12),se(3),se(1),se(0),se(2),se(17),se(3),se(17),se(0),se(63),se(0);var ee=0,oe=0,xe=0;_=0,b=7,this.encode.displayName="_encode_";for(var re,Le,Ee,Oe,Ze,st,mt,Mt,K,jt=L.data,$t=L.width,Yt=L.height,yt=4*$t,on=0;on<Yt;){for(re=0;re<yt;){for(Ze=yt*on+re,mt=-1,Mt=0,K=0;K<64;K++)st=Ze+(Mt=K>>3)*yt+(mt=4*(7&K)),on+Mt>=Yt&&(st-=yt*(on+1+Mt-Yt)),re+mt>=yt&&(st-=re+mt-yt+4),Le=jt[st++],Ee=jt[st++],Oe=jt[st++],H[K]=(q[Le]+q[Ee+256|0]+q[Oe+512|0]>>16)-128,R[K]=(q[Le+768|0]+q[Ee+1024|0]+q[Oe+1280|0]>>16)-128,M[K]=(q[Le+1280|0]+q[Ee+1536|0]+q[Oe+1792|0]>>16)-128;ee=ue(H,f,ee,e,n),oe=ue(R,m,oe,t,r),xe=ue(M,m,xe,t,r),re+=32}on+=8}if(b>=0){var ze=[];ze[1]=b+1,ze[0]=(1<<b+1)-1,le(ze)}return Ae(65497),new Uint8Array(T)},s=s||50,(function(){for(var L=String.fromCharCode,Q=0;Q<256;Q++)B[Q]=L(Q)})(),e=ie(X,O),t=ie(I,J),n=ie(Y,W),r=ie(Z,Ce),(function(){for(var L=1,Q=2,ee=1;ee<=15;ee++){for(var oe=L;oe<Q;oe++)A[32767+oe]=ee,y[32767+oe]=[],y[32767+oe][1]=ee,y[32767+oe][0]=oe;for(var xe=-(Q-1);xe<=-L;xe++)A[32767+xe]=ee,y[32767+xe]=[],y[32767+xe][1]=ee,y[32767+xe][0]=Q-1+xe;L<<=1,Q<<=1}})(),(function(){for(var L=0;L<256;L++)q[L]=19595*L,q[L+256|0]=38470*L,q[L+512|0]=7471*L+32768,q[L+768|0]=-11059*L,q[L+1024|0]=-21709*L,q[L+1280|0]=32768*L+8421375,q[L+1536|0]=-27439*L,q[L+1792|0]=-5329*L})(),E(s)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function ad(s,e){if(this.pos=0,this.buffer=s,this.datav=new DataView(s.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function Ab(s){function e(O){if(!O)throw Error("assert :P")}function t(O,Y,W){for(var I=0;4>I;I++)if(O[Y+I]!=W.charCodeAt(I))return!0;return!1}function n(O,Y,W,I,J){for(var Z=0;Z<J;Z++)O[Y+Z]=W[I+Z]}function r(O,Y,W,I){for(var J=0;J<I;J++)O[Y+J]=W}function o(O){return new Int32Array(O)}function d(O,Y){for(var W=[],I=0;I<O;I++)W.push(new Y);return W}function c(O,Y){var W=[];return(function I(J,Z,Ce){for(var ie=Ce[Z],le=0;le<ie&&(J.push(Ce.length>Z+1?[]:new Y),!(Ce.length<Z+1));le++)I(J[le],Z+1,Ce)})(W,0,O),W}var h=function(){var O=this;function Y(x,S){for(var P=1<<S-1>>>0;x&P;)P>>>=1;return P?(x&P-1)+P:x}function W(x,S,P,F,ne){e(!(F%P));do x[S+(F-=P)]=ne;while(0<F)}function I(x,S,P,F,ne){if(e(2328>=ne),512>=ne)var ae=o(512);else if((ae=o(ne))==null)return 0;return(function(ce,me,we,Te,Fe,et){var ke,qe,Ge=me,ct=1<<we,Ke=o(16),gt=o(16);for(e(Fe!=0),e(Te!=null),e(ce!=null),e(0<we),qe=0;qe<Fe;++qe){if(15<Te[qe])return 0;++Ke[Te[qe]]}if(Ke[0]==Fe)return 0;for(gt[1]=0,ke=1;15>ke;++ke){if(Ke[ke]>1<<ke)return 0;gt[ke+1]=gt[ke]+Ke[ke]}for(qe=0;qe<Fe;++qe)ke=Te[qe],0<Te[qe]&&(et[gt[ke]++]=qe);if(gt[15]==1)return(Te=new J).g=0,Te.value=et[0],W(ce,Ge,1,ct,Te),ct;var ut,bt=-1,Nt=ct-1,hn=0,dn=1,ni=1,fn=1<<we;for(qe=0,ke=1,Fe=2;ke<=we;++ke,Fe<<=1){if(dn+=ni<<=1,0>(ni-=Ke[ke]))return 0;for(;0<Ke[ke];--Ke[ke])(Te=new J).g=ke,Te.value=et[qe++],W(ce,Ge+hn,Fe,fn,Te),hn=Y(hn,ke)}for(ke=we+1,Fe=2;15>=ke;++ke,Fe<<=1){if(dn+=ni<<=1,0>(ni-=Ke[ke]))return 0;for(;0<Ke[ke];--Ke[ke]){if(Te=new J,(hn&Nt)!=bt){for(Ge+=fn,ut=1<<(bt=ke)-we;15>bt&&!(0>=(ut-=Ke[bt]));)++bt,ut<<=1;ct+=fn=1<<(ut=bt-we),ce[me+(bt=hn&Nt)].g=ut+we,ce[me+bt].value=Ge-me-bt}Te.g=ke-we,Te.value=et[qe++],W(ce,Ge+(hn>>we),Fe,fn,Te),hn=Y(hn,ke)}}return dn!=2*gt[15]-1?0:ct})(x,S,P,F,ne,ae)}function J(){this.value=this.g=0}function Z(){this.value=this.g=0}function Ce(){this.G=d(5,J),this.H=o(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=d(mo,Z)}function ie(x,S,P,F){e(x!=null),e(S!=null),e(2147483648>F),x.Ca=254,x.I=0,x.b=-8,x.Ka=0,x.oa=S,x.pa=P,x.Jd=S,x.Yc=P+F,x.Zc=4<=F?P+F-4+1:P,Le(x)}function le(x,S){for(var P=0;0<S--;)P|=Oe(x,128)<<S;return P}function se(x,S){var P=le(x,S);return Ee(x)?-P:P}function Ae(x,S,P,F){var ne,ae=0;for(e(x!=null),e(S!=null),e(4294967288>F),x.Sb=F,x.Ra=0,x.u=0,x.h=0,4<F&&(F=4),ne=0;ne<F;++ne)ae+=S[P+ne]<<8*ne;x.Ra=ae,x.bb=F,x.oa=S,x.pa=P}function ue(x){for(;8<=x.u&&x.bb<x.Sb;)x.Ra>>>=8,x.Ra+=x.oa[x.pa+x.bb]<<Mo-8>>>0,++x.bb,x.u-=8;oe(x)&&(x.h=1,x.u=0)}function E(x,S){if(e(0<=S),!x.h&&S<=fs){var P=ee(x)&xa[S];return x.u+=S,ue(x),P}return x.h=1,x.u=0}function L(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Q(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function ee(x){return x.Ra>>>(x.u&Mo-1)>>>0}function oe(x){return e(x.bb<=x.Sb),x.h||x.bb==x.Sb&&x.u>Mo}function xe(x,S){x.u=S,x.h=oe(x)}function re(x){x.u>=La&&(e(x.u>=La),ue(x))}function Le(x){e(x!=null&&x.oa!=null),x.pa<x.Zc?(x.I=(x.oa[x.pa++]|x.I<<8)>>>0,x.b+=8):(e(x!=null&&x.oa!=null),x.pa<x.Yc?(x.b+=8,x.I=x.oa[x.pa++]|x.I<<8):x.Ka?x.b=0:(x.I<<=8,x.b+=8,x.Ka=1))}function Ee(x){return le(x,1)}function Oe(x,S){var P=x.Ca;0>x.b&&Le(x);var F=x.b,ne=P*S>>>8,ae=(x.I>>>F>ne)+0;for(ae?(P-=ne,x.I-=ne+1<<F>>>0):P=ne+1,F=P,ne=0;256<=F;)ne+=8,F>>=8;return F=7^ne+Li[F],x.b-=F,x.Ca=(P<<F)-1,ae}function Ze(x,S,P){x[S+0]=P>>24&255,x[S+1]=P>>16&255,x[S+2]=P>>8&255,x[S+3]=255&P}function st(x,S){return x[S+0]|x[S+1]<<8}function mt(x,S){return st(x,S)|x[S+2]<<16}function Mt(x,S){return st(x,S)|st(x,S+2)<<16}function K(x,S){var P=1<<S;return e(x!=null),e(0<S),x.X=o(P),x.X==null?0:(x.Mb=32-S,x.Xa=S,1)}function jt(x,S){e(x!=null),e(S!=null),e(x.Xa==S.Xa),n(S.X,0,x.X,0,1<<S.Xa)}function $t(){this.X=[],this.Xa=this.Mb=0}function Yt(x,S,P,F){e(P!=null),e(F!=null);var ne=P[0],ae=F[0];return ne==0&&(ne=(x*ae+S/2)/S),ae==0&&(ae=(S*ne+x/2)/x),0>=ne||0>=ae?0:(P[0]=ne,F[0]=ae,1)}function yt(x,S){return x+(1<<S)-1>>>S}function on(x,S){return((4278255360&x)+(4278255360&S)>>>0&4278255360)+((16711935&x)+(16711935&S)>>>0&16711935)>>>0}function ze(x,S){O[S]=function(P,F,ne,ae,ce,me,we){var Te;for(Te=0;Te<ce;++Te){var Fe=O[x](me[we+Te-1],ne,ae+Te);me[we+Te]=on(P[F+Te],Fe)}}}function Ne(){this.ud=this.hd=this.jd=0}function Ct(x,S){return((4278124286&(x^S))>>>1)+(x&S)>>>0}function wt(x){return 0<=x&&256>x?x:0>x?0:255<x?255:void 0}function it(x,S){return wt(x+(x-S+.5>>1))}function pt(x,S,P){return Math.abs(S-P)-Math.abs(x-P)}function Ot(x,S,P,F,ne,ae,ce){for(F=ae[ce-1],P=0;P<ne;++P)ae[ce+P]=F=on(x[S+P],F)}function Qe(x,S,P,F,ne){var ae;for(ae=0;ae<P;++ae){var ce=x[S+ae],me=ce>>8&255,we=16711935&(we=(we=16711935&ce)+((me<<16)+me));F[ne+ae]=(4278255360&ce)+we>>>0}}function St(x,S){S.jd=255&x,S.hd=x>>8&255,S.ud=x>>16&255}function Wt(x,S,P,F,ne,ae){var ce;for(ce=0;ce<F;++ce){var me=S[P+ce],we=me>>>8,Te=me,Fe=255&(Fe=(Fe=me>>>16)+((x.jd<<24>>24)*(we<<24>>24)>>>5));Te=255&(Te=(Te+=(x.hd<<24>>24)*(we<<24>>24)>>>5)+((x.ud<<24>>24)*(Fe<<24>>24)>>>5)),ne[ae+ce]=(4278255360&me)+(Fe<<16)+Te}}function Bt(x,S,P,F,ne){O[S]=function(ae,ce,me,we,Te,Fe,et,ke,qe){for(we=et;we<ke;++we)for(et=0;et<qe;++et)Te[Fe++]=ne(me[F(ae[ce++])])},O[x]=function(ae,ce,me,we,Te,Fe,et){var ke=8>>ae.b,qe=ae.Ea,Ge=ae.K[0],ct=ae.w;if(8>ke)for(ae=(1<<ae.b)-1,ct=(1<<ke)-1;ce<me;++ce){var Ke,gt=0;for(Ke=0;Ke<qe;++Ke)Ke&ae||(gt=F(we[Te++])),Fe[et++]=ne(Ge[gt&ct]),gt>>=ke}else O["VP8LMapColor"+P](we,Te,Ge,ct,Fe,et,ce,me,qe)}}function Ln(x,S,P,F,ne){for(P=S+P;S<P;){var ae=x[S++];F[ne++]=ae>>16&255,F[ne++]=ae>>8&255,F[ne++]=255&ae}}function Kt(x,S,P,F,ne){for(P=S+P;S<P;){var ae=x[S++];F[ne++]=ae>>16&255,F[ne++]=ae>>8&255,F[ne++]=255&ae,F[ne++]=ae>>24&255}}function rn(x,S,P,F,ne){for(P=S+P;S<P;){var ae=(ce=x[S++])>>16&240|ce>>12&15,ce=240&ce|ce>>28&15;F[ne++]=ae,F[ne++]=ce}}function un(x,S,P,F,ne){for(P=S+P;S<P;){var ae=(ce=x[S++])>>16&248|ce>>13&7,ce=ce>>5&224|ce>>3&31;F[ne++]=ae,F[ne++]=ce}}function ot(x,S,P,F,ne){for(P=S+P;S<P;){var ae=x[S++];F[ne++]=255&ae,F[ne++]=ae>>8&255,F[ne++]=ae>>16&255}}function Zt(x,S,P,F,ne,ae){if(ae==0)for(P=S+P;S<P;)Ze(F,((ae=x[S++])[0]>>24|ae[1]>>8&65280|ae[2]<<8&16711680|ae[3]<<24)>>>0),ne+=32;else n(F,ne,x,S,P)}function sn(x,S){O[S][0]=O[x+"0"],O[S][1]=O[x+"1"],O[S][2]=O[x+"2"],O[S][3]=O[x+"3"],O[S][4]=O[x+"4"],O[S][5]=O[x+"5"],O[S][6]=O[x+"6"],O[S][7]=O[x+"7"],O[S][8]=O[x+"8"],O[S][9]=O[x+"9"],O[S][10]=O[x+"10"],O[S][11]=O[x+"11"],O[S][12]=O[x+"12"],O[S][13]=O[x+"13"],O[S][14]=O[x+"0"],O[S][15]=O[x+"0"]}function Ft(x){return x==fl||x==kc||x==Oo||x==Jl}function Jt(){this.eb=[],this.size=this.A=this.fb=0}function yn(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function _n(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Jt,this.f.kb=new yn,this.sd=null}function Qt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Ut(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function zi(x){return alert("todo:WebPSamplerProcessPlane"),x.T}function Jn(x,S){var P=x.T,F=S.ba.f.RGBA,ne=F.eb,ae=F.fb+x.ka*F.A,ce=Ur[S.ba.S],me=x.y,we=x.O,Te=x.f,Fe=x.N,et=x.ea,ke=x.W,qe=S.cc,Ge=S.dc,ct=S.Mc,Ke=S.Nc,gt=x.ka,ut=x.ka+x.T,bt=x.U,Nt=bt+1>>1;for(gt==0?ce(me,we,null,null,Te,Fe,et,ke,Te,Fe,et,ke,ne,ae,null,null,bt):(ce(S.ec,S.fc,me,we,qe,Ge,ct,Ke,Te,Fe,et,ke,ne,ae-F.A,ne,ae,bt),++P);gt+2<ut;gt+=2)qe=Te,Ge=Fe,ct=et,Ke=ke,Fe+=x.Rc,ke+=x.Rc,ae+=2*F.A,ce(me,(we+=2*x.fa)-x.fa,me,we,qe,Ge,ct,Ke,Te,Fe,et,ke,ne,ae-F.A,ne,ae,bt);return we+=x.fa,x.j+ut<x.o?(n(S.ec,S.fc,me,we,bt),n(S.cc,S.dc,Te,Fe,Nt),n(S.Mc,S.Nc,et,ke,Nt),P--):1&ut||ce(me,we,null,null,Te,Fe,et,ke,Te,Fe,et,ke,ne,ae+F.A,null,null,bt),P}function Lt(x,S,P){var F=x.F,ne=[x.J];if(F!=null){var ae=x.U,ce=S.ba.S,me=ce==Yc||ce==Oo;S=S.ba.f.RGBA;var we=[0],Te=x.ka;we[0]=x.T,x.Kb&&(Te==0?--we[0]:(--Te,ne[0]-=x.width),x.j+x.ka+x.T==x.o&&(we[0]=x.o-x.j-Te));var Fe=S.eb;Te=S.fb+Te*S.A,x=Pi(F,ne[0],x.width,ae,we,Fe,Te+(me?0:3),S.A),e(P==we),x&&Ft(ce)&&Rl(Fe,Te,me,ae,we,S.A)}return 0}function Ht(x){var S=x.ma,P=S.ba.S,F=11>P,ne=P==ia||P==Ba||P==Yc||P==Dl||P==12||Ft(P);if(S.memory=null,S.Ib=null,S.Jb=null,S.Nd=null,!Qa(S.Oa,x,ne?11:12))return 0;if(ne&&Ft(P)&&ws(),x.da)alert("todo:use_scaling");else{if(F){if(S.Ib=zi,x.Kb){if(P=x.U+1>>1,S.memory=o(x.U+2*P),S.memory==null)return 0;S.ec=S.memory,S.fc=0,S.cc=S.ec,S.dc=S.fc+x.U,S.Mc=S.cc,S.Nc=S.dc+P,S.Ib=Jn,ws()}}else alert("todo:EmitYUV");ne&&(S.Jb=Lt,F&&Ps())}if(F&&!Xs){for(x=0;256>x;++x)tr[x]=89858*(x-128)+Sa>>Cr,ic[x]=-22014*(x-128)+Sa,So[x]=-45773*(x-128),no[x]=113618*(x-128)+Sa>>Cr;for(x=cs;x<Gs;++x)S=76283*(x-16)+Sa>>Cr,Uo[x-cs]=dr(S,255),rc[x-cs]=dr(S+8>>4,15);Xs=1}return 1}function Et(x){var S=x.ma,P=x.U,F=x.T;return e(!(1&x.ka)),0>=P||0>=F?0:(P=S.Ib(x,S),S.Jb!=null&&S.Jb(x,S,P),S.Dc+=P,1)}function ti(x){x.ma.memory=null}function vi(x,S,P,F){return E(x,8)!=47?0:(S[0]=E(x,14)+1,P[0]=E(x,14)+1,F[0]=E(x,1),E(x,3)!=0?0:!x.h)}function ar(x,S){if(4>x)return x+1;var P=x-2>>1;return(2+(1&x)<<P)+E(S,P)+1}function _t(x,S){return 120<S?S-120:1<=(P=((P=ms[S-1])>>4)*x+(8-(15&P)))?P:1;var P}function Fn(x,S,P){var F=ee(P),ne=x[S+=255&F].g-8;return 0<ne&&(xe(P,P.u+8),F=ee(P),S+=x[S].value,S+=F&(1<<ne)-1),xe(P,P.u+x[S].g),x[S].value}function Xn(x,S,P){return P.g+=x.g,P.value+=x.value<<S>>>0,e(8>=P.g),x.g}function ci(x,S,P){var F=x.xc;return e((S=F==0?0:x.vc[x.md*(P>>F)+(S>>F)])<x.Wb),x.Ya[S]}function ri(x,S,P,F){var ne=x.ab,ae=x.c*S,ce=x.C;S=ce+S;var me=P,we=F;for(F=x.Ta,P=x.Ua;0<ne--;){var Te=x.gc[ne],Fe=ce,et=S,ke=me,qe=we,Ge=(we=F,me=P,Te.Ea);switch(e(Fe<et),e(et<=Te.nc),Te.hc){case 2:jr(ke,qe,(et-Fe)*Ge,we,me);break;case 0:var ct=Fe,Ke=et,gt=we,ut=me,bt=(fn=Te).Ea;ct==0&&(Io(ke,qe,null,null,1,gt,ut),Ot(ke,qe+1,0,0,bt-1,gt,ut+1),qe+=bt,ut+=bt,++ct);for(var Nt=1<<fn.b,hn=Nt-1,dn=yt(bt,fn.b),ni=fn.K,fn=fn.w+(ct>>fn.b)*dn;ct<Ke;){var In=ni,Ei=fn,Gn=1;for(fr(ke,qe,gt,ut-bt,1,gt,ut);Gn<bt;){var en=(Gn&~hn)+Nt;en>bt&&(en=bt),(0,Xl[In[Ei++]>>8&15])(ke,qe+ +Gn,gt,ut+Gn-bt,en-Gn,gt,ut+Gn),Gn=en}qe+=bt,ut+=bt,++ct&hn||(fn+=dn)}et!=Te.nc&&n(we,me-Ge,we,me+(et-Fe-1)*Ge,Ge);break;case 1:for(Ge=ke,Ke=qe,bt=(ke=Te.Ea)-(ut=ke&~(gt=(qe=1<<Te.b)-1)),ct=yt(ke,Te.b),Nt=Te.K,Te=Te.w+(Fe>>Te.b)*ct;Fe<et;){for(hn=Nt,dn=Te,ni=new Ne,fn=Ke+ut,In=Ke+ke;Ke<fn;)St(hn[dn++],ni),pd(ni,Ge,Ke,qe,we,me),Ke+=qe,me+=qe;Ke<In&&(St(hn[dn++],ni),pd(ni,Ge,Ke,bt,we,me),Ke+=bt,me+=bt),++Fe&gt||(Te+=ct)}break;case 3:if(ke==we&&qe==me&&0<Te.b){for(Ke=we,ke=Ge=me+(et-Fe)*Ge-(ut=(et-Fe)*yt(Te.Ea,Te.b)),qe=we,gt=me,ct=[],ut=(bt=ut)-1;0<=ut;--ut)ct[ut]=qe[gt+ut];for(ut=bt-1;0<=ut;--ut)Ke[ke+ut]=ct[ut];fd(Te,Fe,et,we,Ge,we,me)}else fd(Te,Fe,et,ke,qe,we,me)}me=F,we=P}we!=P&&n(F,P,me,we,ae)}function Br(x,S){var P=x.V,F=x.Ba+x.c*x.C,ne=S-x.C;if(e(S<=x.l.o),e(16>=ne),0<ne){var ae=x.l,ce=x.Ta,me=x.Ua,we=ae.width;if(ri(x,ne,P,F),ne=me=[me],e((P=x.C)<(F=S)),e(ae.v<ae.va),F>ae.o&&(F=ae.o),P<ae.j){var Te=ae.j-P;P=ae.j,ne[0]+=Te*we}if(P>=F?P=0:(ne[0]+=4*ae.v,ae.ka=P-ae.j,ae.U=ae.va-ae.v,ae.T=F-P,P=1),P){if(me=me[0],11>(P=x.ca).S){var Fe=P.f.RGBA,et=(F=P.S,ne=ae.U,ae=ae.T,Te=Fe.eb,Fe.A),ke=ae;for(Fe=Fe.fb+x.Ma*Fe.A;0<ke--;){var qe=ce,Ge=me,ct=ne,Ke=Te,gt=Fe;switch(F){case Od:eo(qe,Ge,ct,Ke,gt);break;case ia:cl(qe,Ge,ct,Ke,gt);break;case fl:cl(qe,Ge,ct,Ke,gt),Rl(Ke,gt,0,ct,1,0);break;case gd:Ws(qe,Ge,ct,Ke,gt);break;case Ba:Zt(qe,Ge,ct,Ke,gt,1);break;case kc:Zt(qe,Ge,ct,Ke,gt,1),Rl(Ke,gt,0,ct,1,0);break;case Yc:Zt(qe,Ge,ct,Ke,gt,0);break;case Oo:Zt(qe,Ge,ct,Ke,gt,0),Rl(Ke,gt,1,ct,1,0);break;case Dl:zo(qe,Ge,ct,Ke,gt);break;case Jl:zo(qe,Ge,ct,Ke,gt),br(Ke,gt,ct,1,0);break;case Zl:ba(qe,Ge,ct,Ke,gt);break;default:e(0)}me+=we,Fe+=et}x.Ma+=ae}else alert("todo:EmitRescaledRowsYUVA");e(x.Ma<=P.height)}}x.C=S,e(x.C<=x.i)}function Di(x){var S;if(0<x.ua)return 0;for(S=0;S<x.Wb;++S){var P=x.Ya[S].G,F=x.Ya[S].H;if(0<P[1][F[1]+0].g||0<P[2][F[2]+0].g||0<P[3][F[3]+0].g)return 0}return 1}function Ni(x,S,P,F,ne,ae){if(x.Z!=0){var ce=x.qd,me=x.rd;for(e(Il[x.Z]!=null);S<P;++S)Il[x.Z](ce,me,F,ne,F,ne,ae),ce=F,me=ne,ne+=ae;x.qd=ce,x.rd=me}}function Ns(x,S){var P=x.l.ma,F=P.Z==0||P.Z==1?x.l.j:x.C;if(F=x.C<F?F:x.C,e(S<=x.l.o),S>F){var ne=x.l.width,ae=P.ca,ce=P.tb+ne*F,me=x.V,we=x.Ba+x.c*F,Te=x.gc;e(x.ab==1),e(Te[0].hc==3),_l(Te[0],F,S,me,we,ae,ce),Ni(P,F,S,ae,ce,ne)}x.C=x.Ma=S}function ha(x,S,P,F,ne,ae,ce){var me=x.$/F,we=x.$%F,Te=x.m,Fe=x.s,et=P+x.$,ke=et;ne=P+F*ne;var qe=P+F*ae,Ge=280+Fe.ua,ct=x.Pb?me:16777216,Ke=0<Fe.ua?Fe.Wa:null,gt=Fe.wc,ut=et<qe?ci(Fe,we,me):null;e(x.C<ae),e(qe<=ne);var bt=!1;e:for(;;){for(;bt||et<qe;){var Nt=0;if(me>=ct){var hn=et-P;e((ct=x).Pb),ct.wd=ct.m,ct.xd=hn,0<ct.s.ua&&jt(ct.s.Wa,ct.s.vb),ct=me+os}if(we&gt||(ut=ci(Fe,we,me)),e(ut!=null),ut.Qb&&(S[et]=ut.qb,bt=!0),!bt)if(re(Te),ut.jc){Nt=Te,hn=S;var dn=et,ni=ut.pd[ee(Nt)&mo-1];e(ut.jc),256>ni.g?(xe(Nt,Nt.u+ni.g),hn[dn]=ni.value,Nt=0):(xe(Nt,Nt.u+ni.g-256),e(256<=ni.value),Nt=ni.value),Nt==0&&(bt=!0)}else Nt=Fn(ut.G[0],ut.H[0],Te);if(Te.h)break;if(bt||256>Nt){if(!bt)if(ut.nd)S[et]=(ut.qb|Nt<<8)>>>0;else{if(re(Te),bt=Fn(ut.G[1],ut.H[1],Te),re(Te),hn=Fn(ut.G[2],ut.H[2],Te),dn=Fn(ut.G[3],ut.H[3],Te),Te.h)break;S[et]=(dn<<24|bt<<16|Nt<<8|hn)>>>0}if(bt=!1,++et,++we>=F&&(we=0,++me,ce!=null&&me<=ae&&!(me%16)&&ce(x,me),Ke!=null))for(;ke<et;)Nt=S[ke++],Ke.X[(506832829*Nt&4294967295)>>>Ke.Mb]=Nt}else if(280>Nt){if(Nt=ar(Nt-256,Te),hn=Fn(ut.G[4],ut.H[4],Te),re(Te),hn=_t(F,hn=ar(hn,Te)),Te.h)break;if(et-P<hn||ne-et<Nt)break e;for(dn=0;dn<Nt;++dn)S[et+dn]=S[et+dn-hn];for(et+=Nt,we+=Nt;we>=F;)we-=F,++me,ce!=null&&me<=ae&&!(me%16)&&ce(x,me);if(e(et<=ne),we&gt&&(ut=ci(Fe,we,me)),Ke!=null)for(;ke<et;)Nt=S[ke++],Ke.X[(506832829*Nt&4294967295)>>>Ke.Mb]=Nt}else{if(!(Nt<Ge))break e;for(bt=Nt-280,e(Ke!=null);ke<et;)Nt=S[ke++],Ke.X[(506832829*Nt&4294967295)>>>Ke.Mb]=Nt;Nt=et,e(!(bt>>>(hn=Ke).Xa)),S[Nt]=hn.X[bt],bt=!0}bt||e(Te.h==oe(Te))}if(x.Pb&&Te.h&&et<ne)e(x.m.h),x.a=5,x.m=x.wd,x.$=x.xd,0<x.s.ua&&jt(x.s.vb,x.s.Wa);else{if(Te.h)break e;ce?.(x,me>ae?ae:me),x.a=0,x.$=et-P}return 1}return x.a=3,0}function Na(x){e(x!=null),x.vc=null,x.yc=null,x.Ya=null;var S=x.Wa;S!=null&&(S.X=null),x.vb=null,e(x!=null)}function $l(){var x=new Sn;return x==null?null:(x.a=0,x.xb=hu,sn("Predictor","VP8LPredictors"),sn("Predictor","VP8LPredictors_C"),sn("PredictorAdd","VP8LPredictorsAdd"),sn("PredictorAdd","VP8LPredictorsAdd_C"),jr=Qe,pd=Wt,eo=Ln,cl=Kt,zo=rn,ba=un,Ws=ot,O.VP8LMapColor32b=Ma,O.VP8LMapColor8b=Es,x)}function Wa(x,S,P,F,ne){var ae=1,ce=[x],me=[S],we=F.m,Te=F.s,Fe=null,et=0;e:for(;;){if(P)for(;ae&&E(we,1);){var ke=ce,qe=me,Ge=F,ct=1,Ke=Ge.m,gt=Ge.gc[Ge.ab],ut=E(Ke,2);if(Ge.Oc&1<<ut)ae=0;else{switch(Ge.Oc|=1<<ut,gt.hc=ut,gt.Ea=ke[0],gt.nc=qe[0],gt.K=[null],++Ge.ab,e(4>=Ge.ab),ut){case 0:case 1:gt.b=E(Ke,3)+2,ct=Wa(yt(gt.Ea,gt.b),yt(gt.nc,gt.b),0,Ge,gt.K),gt.K=gt.K[0];break;case 3:var bt,Nt=E(Ke,8)+1,hn=16<Nt?0:4<Nt?1:2<Nt?2:3;if(ke[0]=yt(gt.Ea,hn),gt.b=hn,bt=ct=Wa(Nt,1,0,Ge,gt.K)){var dn,ni=Nt,fn=gt,In=1<<(8>>fn.b),Ei=o(In);if(Ei==null)bt=0;else{var Gn=fn.K[0],en=fn.w;for(Ei[0]=fn.K[0][0],dn=1;dn<1*ni;++dn)Ei[dn]=on(Gn[en+dn],Ei[dn-1]);for(;dn<4*In;++dn)Ei[dn]=0;fn.K[0]=null,fn.K[0]=Ei,bt=1}}ct=bt;break;case 2:break;default:e(0)}ae=ct}}if(ce=ce[0],me=me[0],ae&&E(we,1)&&!(ae=1<=(et=E(we,4))&&11>=et)){F.a=3;break e}var Vt;if(Vt=ae)t:{var lr,Dn,di,nr=F,gr=ce,mr=me,Ai=et,yr=P,Hr=nr.m,Vr=nr.s,pi=[null],ai=1,Tr=0,Gi=bo[Ai];n:for(;;){if(yr&&E(Hr,1)){var Cs=E(Hr,3)+2,Er=yt(gr,Cs),Yi=yt(mr,Cs),es=Er*Yi;if(!Wa(Er,Yi,0,nr,pi))break n;for(pi=pi[0],Vr.xc=Cs,lr=0;lr<es;++lr){var Ii=pi[lr]>>8&65535;pi[lr]=Ii,Ii>=ai&&(ai=Ii+1)}}if(Hr.h)break n;for(Dn=0;5>Dn;++Dn){var Mr=xo[Dn];!Dn&&0<Ai&&(Mr+=1<<Ai),Tr<Mr&&(Tr=Mr)}var ts=d(ai*Gi,J),xr=ai,qi=d(xr,Ce);if(qi==null)var Ls=null;else e(65536>=xr),Ls=qi;var ns=o(Tr);if(Ls==null||ns==null||ts==null){nr.a=1;break n}var Nn=ts;for(lr=di=0;lr<ai;++lr){var En=Ls[lr],Wi=En.G,aa=En.H,oa=0,Ms=1,ds=0;for(Dn=0;5>Dn;++Dn){Mr=xo[Dn],Wi[Dn]=Nn,aa[Dn]=di,!Dn&&0<Ai&&(Mr+=1<<Ai);r:{var Bl,pl=Mr,xd=nr,vr=ns,pu=Nn,jc=di,Nc=0,gl=xd.m,Xu=E(gl,1);if(r(vr,0,0,pl),Xu){var bd=E(gl,1)+1,Ud=E(gl,1),gu=E(gl,Ud==0?1:8);vr[gu]=1,bd==2&&(vr[gu=E(gl,8)]=1);var qr=1}else{var Wr=o(19),sc=E(gl,4)+4;if(19<sc){xd.a=3;var ac=0;break r}for(Bl=0;Bl<sc;++Bl)Wr[md[Bl]]=E(gl,3);var Xc=void 0,Fl=void 0,ml=xd,oc=Wr,Pc=pl,Hd=vr,Vd=0,Ho=ml.m,vd=8,Ec=d(128,J);i:for(;I(Ec,0,7,oc,19);){if(E(Ho,1)){var qd=2+2*E(Ho,3);if((Xc=2+E(Ho,qd))>Pc)break i}else Xc=Pc;for(Fl=0;Fl<Pc&&Xc--;){re(Ho);var Kc=Ec[0+(127&ee(Ho))];xe(Ho,Ho.u+Kc.g);var Rc=Kc.value;if(16>Rc)Hd[Fl++]=Rc,Rc!=0&&(vd=Rc);else{var mu=Rc==16,Rh=Rc-16,Wd=Ql[Rh],Vo=E(Ho,Fa[Rh])+Wd;if(Fl+Vo>Pc)break i;for(var yl=mu?vd:0;0<Vo--;)Hd[Fl++]=yl}}Vd=1;break i}Vd||(ml.a=3),qr=Vd}(qr=qr&&!gl.h)&&(Nc=I(pu,jc,8,vr,pl)),qr&&Nc!=0?ac=Nc:(xd.a=3,ac=0)}if(ac==0)break n;if(Ms&&Ll[Dn]==1&&(Ms=Nn[di].g==0),oa+=Nn[di].g,di+=ac,3>=Dn){var Ca,yu=ns[0];for(Ca=1;Ca<Mr;++Ca)ns[Ca]>yu&&(yu=ns[Ca]);ds+=yu}}if(En.nd=Ms,En.Qb=0,Ms&&(En.qb=(Wi[3][aa[3]+0].value<<24|Wi[1][aa[1]+0].value<<16|Wi[2][aa[2]+0].value)>>>0,oa==0&&256>Wi[0][aa[0]+0].value&&(En.Qb=1,En.qb+=Wi[0][aa[0]+0].value<<8)),En.jc=!En.Qb&&6>ds,En.jc){var $d,Ol=En;for($d=0;$d<mo;++$d){var lc=$d,cc=Ol.pd[lc],xu=Ol.G[0][Ol.H[0]+lc];256<=xu.value?(cc.g=xu.g+256,cc.value=xu.value):(cc.g=0,cc.value=0,lc>>=Xn(xu,8,cc),lc>>=Xn(Ol.G[1][Ol.H[1]+lc],16,cc),lc>>=Xn(Ol.G[2][Ol.H[2]+lc],0,cc),Xn(Ol.G[3][Ol.H[3]+lc],24,cc))}}}Vr.vc=pi,Vr.Wb=ai,Vr.Ya=Ls,Vr.yc=ts,Vt=1;break t}Vt=0}if(!(ae=Vt)){F.a=3;break e}if(0<et){if(Te.ua=1<<et,!K(Te.Wa,et)){F.a=1,ae=0;break e}}else Te.ua=0;var Gd=F,Dc=ce,xl=me,Zc=Gd.s,wd=Zc.xc;if(Gd.c=Dc,Gd.i=xl,Zc.md=yt(Dc,wd),Zc.wc=wd==0?-1:(1<<wd)-1,P){F.xb=tc;break e}if((Fe=o(ce*me))==null){F.a=1,ae=0;break e}ae=(ae=ha(F,Fe,0,ce,me,me,null))&&!we.h;break e}return ae?(ne!=null?ne[0]=Fe:(e(Fe==null),e(P)),F.$=0,P||Na(Te)):Na(Te),ae}function $a(x,S){var P=x.c*x.i,F=P+S+16*S;return e(x.c<=S),x.V=o(F),x.V==null?(x.Ta=null,x.Ua=0,x.a=1,0):(x.Ta=x.V,x.Ua=x.Ba+P+S,1)}function No(x,S){var P=x.C,F=S-P,ne=x.V,ae=x.Ba+x.c*P;for(e(S<=x.l.o);0<F;){var ce=16<F?16:F,me=x.l.ma,we=x.l.width,Te=we*ce,Fe=me.ca,et=me.tb+we*P,ke=x.Ta,qe=x.Ua;ri(x,ce,ne,ae),Jr(ke,qe,Fe,et,Te),Ni(me,P,P+ce,Fe,et,we),F-=ce,ne+=ce*x.c,P+=ce}e(P==S),x.C=x.Ma=S}function Qn(){this.ub=this.yd=this.td=this.Rb=0}function Us(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Ti(){this.Fb=this.Bb=this.Cb=0,this.Zb=o(4),this.Lb=o(4)}function Pa(){this.Yb=(function(){var x=[];return(function S(P,F,ne){for(var ae=ne[F],ce=0;ce<ae&&(P.push(ne.length>F+1?[]:0),!(ne.length<F+1));ce++)S(P[ce],F+1,ne)})(x,0,[3,11]),x})()}function On(){this.jb=o(3),this.Wc=c([4,8],Pa),this.Xc=c([4,17],Pa)}function Qo(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new o(4),this.od=new o(4)}function wi(){this.ld=this.La=this.dd=this.tc=0}function fa(){this.Na=this.la=0}function Ea(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function el(){this.ad=o(384),this.Za=0,this.Ob=o(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function tl(){this.uc=this.M=this.Nb=0,this.wa=Array(new wi),this.Y=0,this.ya=Array(new el),this.aa=0,this.l=new nl}function Ga(){this.y=o(16),this.f=o(8),this.ea=o(8)}function ud(){this.cb=this.a=0,this.sc="",this.m=new L,this.Od=new Qn,this.Kc=new Us,this.ed=new Qo,this.Qa=new Ti,this.Ic=this.$c=this.Aa=0,this.D=new tl,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=d(8,L),this.ia=0,this.pb=d(4,Ea),this.Pa=new On,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Ga),this.Hd=0,this.rb=Array(new fa),this.sb=0,this.wa=Array(new wi),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new el),this.L=this.aa=0,this.gd=c([4,2],wi),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function dr(x,S){return 0>x?0:x>S?S:x}function nl(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function $n(){var x=new ud;return x!=null&&(x.a=0,x.sc="OK",x.cb=0,x.Xb=0,Ds||(Ds=Ra)),x}function Wn(x,S,P){return x.a==0&&(x.a=S,x.sc=P,x.cb=0),0}function il(x,S,P){return 3<=P&&x[S+0]==157&&x[S+1]==1&&x[S+2]==42}function co(x,S){if(x==null)return 0;if(x.a=0,x.sc="OK",S==null)return Wn(x,2,"null VP8Io passed to VP8GetHeaders()");var P=S.data,F=S.w,ne=S.ha;if(4>ne)return Wn(x,7,"Truncated header.");var ae=P[F+0]|P[F+1]<<8|P[F+2]<<16,ce=x.Od;if(ce.Rb=!(1&ae),ce.td=ae>>1&7,ce.yd=ae>>4&1,ce.ub=ae>>5,3<ce.td)return Wn(x,3,"Incorrect keyframe parameters.");if(!ce.yd)return Wn(x,4,"Frame not displayable.");F+=3,ne-=3;var me=x.Kc;if(ce.Rb){if(7>ne)return Wn(x,7,"cannot parse picture header");if(!il(P,F,ne))return Wn(x,3,"Bad code word");me.c=16383&(P[F+4]<<8|P[F+3]),me.Td=P[F+4]>>6,me.i=16383&(P[F+6]<<8|P[F+5]),me.Ud=P[F+6]>>6,F+=7,ne-=7,x.za=me.c+15>>4,x.Ub=me.i+15>>4,S.width=me.c,S.height=me.i,S.Da=0,S.j=0,S.v=0,S.va=S.width,S.o=S.height,S.da=0,S.ib=S.width,S.hb=S.height,S.U=S.width,S.T=S.height,r((ae=x.Pa).jb,0,255,ae.jb.length),e((ae=x.Qa)!=null),ae.Cb=0,ae.Bb=0,ae.Fb=1,r(ae.Zb,0,0,ae.Zb.length),r(ae.Lb,0,0,ae.Lb)}if(ce.ub>ne)return Wn(x,7,"bad partition length");ie(ae=x.m,P,F,ce.ub),F+=ce.ub,ne-=ce.ub,ce.Rb&&(me.Ld=Ee(ae),me.Kd=Ee(ae)),me=x.Qa;var we,Te=x.Pa;if(e(ae!=null),e(me!=null),me.Cb=Ee(ae),me.Cb){if(me.Bb=Ee(ae),Ee(ae)){for(me.Fb=Ee(ae),we=0;4>we;++we)me.Zb[we]=Ee(ae)?se(ae,7):0;for(we=0;4>we;++we)me.Lb[we]=Ee(ae)?se(ae,6):0}if(me.Bb)for(we=0;3>we;++we)Te.jb[we]=Ee(ae)?le(ae,8):255}else me.Bb=0;if(ae.Ka)return Wn(x,3,"cannot parse segment header");if((me=x.ed).zd=Ee(ae),me.Tb=le(ae,6),me.wb=le(ae,3),me.Pc=Ee(ae),me.Pc&&Ee(ae)){for(Te=0;4>Te;++Te)Ee(ae)&&(me.vd[Te]=se(ae,6));for(Te=0;4>Te;++Te)Ee(ae)&&(me.od[Te]=se(ae,6))}if(x.L=me.Tb==0?0:me.zd?1:2,ae.Ka)return Wn(x,3,"cannot parse filter header");var Fe=ne;if(ne=we=F,F=we+Fe,me=Fe,x.Xb=(1<<le(x.m,2))-1,Fe<3*(Te=x.Xb))P=7;else{for(we+=3*Te,me-=3*Te,Fe=0;Fe<Te;++Fe){var et=P[ne+0]|P[ne+1]<<8|P[ne+2]<<16;et>me&&(et=me),ie(x.Jc[+Fe],P,we,et),we+=et,me-=et,ne+=3}ie(x.Jc[+Te],P,we,me),P=we<F?0:5}if(P!=0)return Wn(x,P,"cannot parse partitions");for(P=le(we=x.m,7),ne=Ee(we)?se(we,4):0,F=Ee(we)?se(we,4):0,me=Ee(we)?se(we,4):0,Te=Ee(we)?se(we,4):0,we=Ee(we)?se(we,4):0,Fe=x.Qa,et=0;4>et;++et){if(Fe.Cb){var ke=Fe.Zb[et];Fe.Fb||(ke+=P)}else{if(0<et){x.pb[et]=x.pb[0];continue}ke=P}var qe=x.pb[et];qe.Sc[0]=Oa[dr(ke+ne,127)],qe.Sc[1]=vo[dr(ke+0,127)],qe.Eb[0]=2*Oa[dr(ke+F,127)],qe.Eb[1]=101581*vo[dr(ke+me,127)]>>16,8>qe.Eb[1]&&(qe.Eb[1]=8),qe.Qc[0]=Oa[dr(ke+Te,117)],qe.Qc[1]=vo[dr(ke+we,127)],qe.lc=ke+we}if(!ce.Rb)return Wn(x,4,"Not a key frame.");for(Ee(ae),ce=x.Pa,P=0;4>P;++P){for(ne=0;8>ne;++ne)for(F=0;3>F;++F)for(me=0;11>me;++me)Te=Oe(ae,Pr[P][ne][F][me])?le(ae,8):Ml[P][ne][F][me],ce.Wc[P][ne].Yb[F][me]=Te;for(ne=0;17>ne;++ne)ce.Xc[P][ne]=ce.Wc[P][Mi[ne]]}return x.kc=Ee(ae),x.kc&&(x.Bd=le(ae,8)),x.cb=1}function Ra(x,S,P,F,ne,ae,ce){var me=S[ne].Yb[P];for(P=0;16>ne;++ne){if(!Oe(x,me[P+0]))return ne;for(;!Oe(x,me[P+1]);)if(me=S[++ne].Yb[0],P=0,ne==16)return 16;var we=S[ne+1].Yb;if(Oe(x,me[P+2])){var Te=x,Fe=0;if(Oe(Te,(ke=me)[(et=P)+3]))if(Oe(Te,ke[et+6])){for(me=0,et=2*(Fe=Oe(Te,ke[et+8]))+(ke=Oe(Te,ke[et+9+Fe])),Fe=0,ke=_c[et];ke[me];++me)Fe+=Fe+Oe(Te,ke[me]);Fe+=3+(8<<et)}else Oe(Te,ke[et+7])?(Fe=7+2*Oe(Te,165),Fe+=Oe(Te,145)):Fe=5+Oe(Te,159);else Fe=Oe(Te,ke[et+4])?3+Oe(Te,ke[et+5]):2;me=we[2]}else Fe=1,me=we[1];we=ce+yd[ne],0>(Te=x).b&&Le(Te);var et,ke=Te.b,qe=(et=Te.Ca>>1)-(Te.I>>ke)>>31;--Te.b,Te.Ca+=qe,Te.Ca|=1,Te.I-=(et+1&qe)<<ke,ae[we]=((Fe^qe)-qe)*F[(0<ne)+0]}return 16}function ea(x){var S=x.rb[x.sb-1];S.la=0,S.Na=0,r(x.zc,0,0,x.zc.length),x.ja=0}function ki(x,S,P,F,ne){ne=x[S+P+32*F]+(ne>>3),x[S+P+32*F]=-256&ne?0>ne?0:255:ne}function Ki(x,S,P,F,ne,ae){ki(x,S,0,P,F+ne),ki(x,S,1,P,F+ae),ki(x,S,2,P,F-ae),ki(x,S,3,P,F-ne)}function Si(x){return(20091*x>>16)+x}function Fr(x,S,P,F){var ne,ae=0,ce=o(16);for(ne=0;4>ne;++ne){var me=x[S+0]+x[S+8],we=x[S+0]-x[S+8],Te=(35468*x[S+4]>>16)-Si(x[S+12]),Fe=Si(x[S+4])+(35468*x[S+12]>>16);ce[ae+0]=me+Fe,ce[ae+1]=we+Te,ce[ae+2]=we-Te,ce[ae+3]=me-Fe,ae+=4,S++}for(ne=ae=0;4>ne;++ne)me=(x=ce[ae+0]+4)+ce[ae+8],we=x-ce[ae+8],Te=(35468*ce[ae+4]>>16)-Si(ce[ae+12]),ki(P,F,0,0,me+(Fe=Si(ce[ae+4])+(35468*ce[ae+12]>>16))),ki(P,F,1,0,we+Te),ki(P,F,2,0,we-Te),ki(P,F,3,0,me-Fe),ae++,F+=32}function $c(x,S,P,F){var ne=x[S+0]+4,ae=35468*x[S+4]>>16,ce=Si(x[S+4]),me=35468*x[S+1]>>16;Ki(P,F,0,ne+ce,x=Si(x[S+1]),me),Ki(P,F,1,ne+ae,x,me),Ki(P,F,2,ne-ae,x,me),Ki(P,F,3,ne-ce,x,me)}function ta(x,S,P,F,ne){Fr(x,S,P,F),ne&&Fr(x,S+16,P,F+4)}function Hs(x,S,P,F){Bo(x,S+0,P,F,1),Bo(x,S+32,P,F+128,1)}function Gl(x,S,P,F){var ne;for(x=x[S+0]+4,ne=0;4>ne;++ne)for(S=0;4>S;++S)ki(P,F,S,ne,x)}function pa(x,S,P,F){x[S+0]&&er(x,S+0,P,F),x[S+16]&&er(x,S+16,P,F+4),x[S+32]&&er(x,S+32,P,F+128),x[S+48]&&er(x,S+48,P,F+128+4)}function vs(x,S,P,F){var ne,ae=o(16);for(ne=0;4>ne;++ne){var ce=x[S+0+ne]+x[S+12+ne],me=x[S+4+ne]+x[S+8+ne],we=x[S+4+ne]-x[S+8+ne],Te=x[S+0+ne]-x[S+12+ne];ae[0+ne]=ce+me,ae[8+ne]=ce-me,ae[4+ne]=Te+we,ae[12+ne]=Te-we}for(ne=0;4>ne;++ne)ce=(x=ae[0+4*ne]+3)+ae[3+4*ne],me=ae[1+4*ne]+ae[2+4*ne],we=ae[1+4*ne]-ae[2+4*ne],Te=x-ae[3+4*ne],P[F+0]=ce+me>>3,P[F+16]=Te+we>>3,P[F+32]=ce-me>>3,P[F+48]=Te-we>>3,F+=64}function na(x,S,P){var F,ne=S-32,ae=pr,ce=255-x[ne-1];for(F=0;F<P;++F){var me,we=ae,Te=ce+x[S-1];for(me=0;me<P;++me)x[S+me]=we[Te+x[ne+me]];S+=32}}function Ya(x,S){na(x,S,4)}function zt(x,S){na(x,S,8)}function $i(x,S){na(x,S,16)}function uo(x,S){var P;for(P=0;16>P;++P)n(x,S+32*P,x,S-32,16)}function Tl(x,S){var P;for(P=16;0<P;--P)r(x,S,x[S-1],16),S+=32}function Kr(x,S,P){var F;for(F=0;16>F;++F)r(S,P+32*F,x,16)}function ho(x,S){var P,F=16;for(P=0;16>P;++P)F+=x[S-1+32*P]+x[S+P-32];Kr(F>>5,x,S)}function ur(x,S){var P,F=8;for(P=0;16>P;++P)F+=x[S-1+32*P];Kr(F>>4,x,S)}function or(x,S){var P,F=8;for(P=0;16>P;++P)F+=x[S+P-32];Kr(F>>4,x,S)}function Po(x,S){Kr(128,x,S)}function qn(x,S,P){return x+2*S+P+2>>2}function li(x,S){var P,F=S-32;for(F=new Uint8Array([qn(x[F-1],x[F+0],x[F+1]),qn(x[F+0],x[F+1],x[F+2]),qn(x[F+1],x[F+2],x[F+3]),qn(x[F+2],x[F+3],x[F+4])]),P=0;4>P;++P)n(x,S+32*P,F,0,F.length)}function Pn(x,S){var P=x[S-1],F=x[S-1+32],ne=x[S-1+64],ae=x[S-1+96];Ze(x,S+0,16843009*qn(x[S-1-32],P,F)),Ze(x,S+32,16843009*qn(P,F,ne)),Ze(x,S+64,16843009*qn(F,ne,ae)),Ze(x,S+96,16843009*qn(ne,ae,ae))}function Gc(x,S){var P,F=4;for(P=0;4>P;++P)F+=x[S+P-32]+x[S-1+32*P];for(F>>=3,P=0;4>P;++P)r(x,S+32*P,F,4)}function ga(x,S){var P=x[S-1+0],F=x[S-1+32],ne=x[S-1+64],ae=x[S-1-32],ce=x[S+0-32],me=x[S+1-32],we=x[S+2-32],Te=x[S+3-32];x[S+0+96]=qn(F,ne,x[S-1+96]),x[S+1+96]=x[S+0+64]=qn(P,F,ne),x[S+2+96]=x[S+1+64]=x[S+0+32]=qn(ae,P,F),x[S+3+96]=x[S+2+64]=x[S+1+32]=x[S+0+0]=qn(ce,ae,P),x[S+3+64]=x[S+2+32]=x[S+1+0]=qn(me,ce,ae),x[S+3+32]=x[S+2+0]=qn(we,me,ce),x[S+3+0]=qn(Te,we,me)}function gn(x,S){var P=x[S+1-32],F=x[S+2-32],ne=x[S+3-32],ae=x[S+4-32],ce=x[S+5-32],me=x[S+6-32],we=x[S+7-32];x[S+0+0]=qn(x[S+0-32],P,F),x[S+1+0]=x[S+0+32]=qn(P,F,ne),x[S+2+0]=x[S+1+32]=x[S+0+64]=qn(F,ne,ae),x[S+3+0]=x[S+2+32]=x[S+1+64]=x[S+0+96]=qn(ne,ae,ce),x[S+3+32]=x[S+2+64]=x[S+1+96]=qn(ae,ce,me),x[S+3+64]=x[S+2+96]=qn(ce,me,we),x[S+3+96]=qn(me,we,we)}function jn(x,S){var P=x[S-1+0],F=x[S-1+32],ne=x[S-1+64],ae=x[S-1-32],ce=x[S+0-32],me=x[S+1-32],we=x[S+2-32],Te=x[S+3-32];x[S+0+0]=x[S+1+64]=ae+ce+1>>1,x[S+1+0]=x[S+2+64]=ce+me+1>>1,x[S+2+0]=x[S+3+64]=me+we+1>>1,x[S+3+0]=we+Te+1>>1,x[S+0+96]=qn(ne,F,P),x[S+0+64]=qn(F,P,ae),x[S+0+32]=x[S+1+96]=qn(P,ae,ce),x[S+1+32]=x[S+2+96]=qn(ae,ce,me),x[S+2+32]=x[S+3+96]=qn(ce,me,we),x[S+3+32]=qn(me,we,Te)}function ui(x,S){var P=x[S+0-32],F=x[S+1-32],ne=x[S+2-32],ae=x[S+3-32],ce=x[S+4-32],me=x[S+5-32],we=x[S+6-32],Te=x[S+7-32];x[S+0+0]=P+F+1>>1,x[S+1+0]=x[S+0+64]=F+ne+1>>1,x[S+2+0]=x[S+1+64]=ne+ae+1>>1,x[S+3+0]=x[S+2+64]=ae+ce+1>>1,x[S+0+32]=qn(P,F,ne),x[S+1+32]=x[S+0+96]=qn(F,ne,ae),x[S+2+32]=x[S+1+96]=qn(ne,ae,ce),x[S+3+32]=x[S+2+96]=qn(ae,ce,me),x[S+3+64]=qn(ce,me,we),x[S+3+96]=qn(me,we,Te)}function pn(x,S){var P=x[S-1+0],F=x[S-1+32],ne=x[S-1+64],ae=x[S-1+96];x[S+0+0]=P+F+1>>1,x[S+2+0]=x[S+0+32]=F+ne+1>>1,x[S+2+32]=x[S+0+64]=ne+ae+1>>1,x[S+1+0]=qn(P,F,ne),x[S+3+0]=x[S+1+32]=qn(F,ne,ae),x[S+3+32]=x[S+1+64]=qn(ne,ae,ae),x[S+3+64]=x[S+2+64]=x[S+0+96]=x[S+1+96]=x[S+2+96]=x[S+3+96]=ae}function hi(x,S){var P=x[S-1+0],F=x[S-1+32],ne=x[S-1+64],ae=x[S-1+96],ce=x[S-1-32],me=x[S+0-32],we=x[S+1-32],Te=x[S+2-32];x[S+0+0]=x[S+2+32]=P+ce+1>>1,x[S+0+32]=x[S+2+64]=F+P+1>>1,x[S+0+64]=x[S+2+96]=ne+F+1>>1,x[S+0+96]=ae+ne+1>>1,x[S+3+0]=qn(me,we,Te),x[S+2+0]=qn(ce,me,we),x[S+1+0]=x[S+3+32]=qn(P,ce,me),x[S+1+32]=x[S+3+64]=qn(F,P,ce),x[S+1+64]=x[S+3+96]=qn(ne,F,P),x[S+1+96]=qn(ae,ne,F)}function xn(x,S){var P;for(P=0;8>P;++P)n(x,S+32*P,x,S-32,8)}function du(x,S){var P;for(P=0;8>P;++P)r(x,S,x[S-1],8),S+=32}function Gt(x,S,P){var F;for(F=0;8>F;++F)r(S,P+32*F,x,8)}function Bi(x,S){var P,F=8;for(P=0;8>P;++P)F+=x[S+P-32]+x[S-1+32*P];Gt(F>>4,x,S)}function an(x,S){var P,F=4;for(P=0;8>P;++P)F+=x[S+P-32];Gt(F>>3,x,S)}function Kn(x,S){var P,F=4;for(P=0;8>P;++P)F+=x[S-1+32*P];Gt(F>>3,x,S)}function Vs(x,S){Gt(128,x,S)}function Xa(x,S,P){var F=x[S-P],ne=x[S+0],ae=3*(ne-F)+Fo[1020+x[S-2*P]-x[S+P]],ce=Zi[112+(ae+4>>3)];x[S-P]=pr[255+F+Zi[112+(ae+3>>3)]],x[S+0]=pr[255+ne-ce]}function as(x,S,P,F){var ne=x[S+0],ae=x[S+P];return Rs[255+x[S-2*P]-x[S-P]]>F||Rs[255+ae-ne]>F}function rl(x,S,P,F){return 4*Rs[255+x[S-P]-x[S+0]]+Rs[255+x[S-2*P]-x[S+P]]<=F}function Da(x,S,P,F,ne){var ae=x[S-3*P],ce=x[S-2*P],me=x[S-P],we=x[S+0],Te=x[S+P],Fe=x[S+2*P],et=x[S+3*P];return 4*Rs[255+me-we]+Rs[255+ce-Te]>F?0:Rs[255+x[S-4*P]-ae]<=ne&&Rs[255+ae-ce]<=ne&&Rs[255+ce-me]<=ne&&Rs[255+et-Fe]<=ne&&Rs[255+Fe-Te]<=ne&&Rs[255+Te-we]<=ne}function Ka(x,S,P,F){var ne=2*F+1;for(F=0;16>F;++F)rl(x,S+F,P,ne)&&Xa(x,S+F,P)}function sl(x,S,P,F){var ne=2*F+1;for(F=0;16>F;++F)rl(x,S+F*P,1,ne)&&Xa(x,S+F*P,1)}function Ac(x,S,P,F){var ne;for(ne=3;0<ne;--ne)Ka(x,S+=4*P,P,F)}function Yl(x,S,P,F){var ne;for(ne=3;0<ne;--ne)sl(x,S+=4,P,F)}function kl(x,S,P,F,ne,ae,ce,me){for(ae=2*ae+1;0<ne--;){if(Da(x,S,P,ae,ce))if(as(x,S,P,me))Xa(x,S,P);else{var we=x,Te=S,Fe=P,et=we[Te-2*Fe],ke=we[Te-Fe],qe=we[Te+0],Ge=we[Te+Fe],ct=we[Te+2*Fe],Ke=27*(ut=Fo[1020+3*(qe-ke)+Fo[1020+et-Ge]])+63>>7,gt=18*ut+63>>7,ut=9*ut+63>>7;we[Te-3*Fe]=pr[255+we[Te-3*Fe]+ut],we[Te-2*Fe]=pr[255+et+gt],we[Te-Fe]=pr[255+ke+Ke],we[Te+0]=pr[255+qe-Ke],we[Te+Fe]=pr[255+Ge-gt],we[Te+2*Fe]=pr[255+ct-ut]}S+=F}}function Eo(x,S,P,F,ne,ae,ce,me){for(ae=2*ae+1;0<ne--;){if(Da(x,S,P,ae,ce))if(as(x,S,P,me))Xa(x,S,P);else{var we=x,Te=S,Fe=P,et=we[Te-Fe],ke=we[Te+0],qe=we[Te+Fe],Ge=Zi[112+(4+(ct=3*(ke-et))>>3)],ct=Zi[112+(ct+3>>3)],Ke=Ge+1>>1;we[Te-2*Fe]=pr[255+we[Te-2*Fe]+Ke],we[Te-Fe]=pr[255+et+ct],we[Te+0]=pr[255+ke-Ge],we[Te+Fe]=pr[255+qe-Ke]}S+=F}}function uu(x,S,P,F,ne,ae){kl(x,S,P,1,16,F,ne,ae)}function wn(x,S,P,F,ne,ae){kl(x,S,1,P,16,F,ne,ae)}function Ro(x,S,P,F,ne,ae){var ce;for(ce=3;0<ce;--ce)Eo(x,S+=4*P,P,1,16,F,ne,ae)}function j(x,S,P,F,ne,ae){var ce;for(ce=3;0<ce;--ce)Eo(x,S+=4,1,P,16,F,ne,ae)}function te(x,S,P,F,ne,ae,ce,me){kl(x,S,ne,1,8,ae,ce,me),kl(P,F,ne,1,8,ae,ce,me)}function Se(x,S,P,F,ne,ae,ce,me){kl(x,S,1,ne,8,ae,ce,me),kl(P,F,1,ne,8,ae,ce,me)}function Ie(x,S,P,F,ne,ae,ce,me){Eo(x,S+4*ne,ne,1,8,ae,ce,me),Eo(P,F+4*ne,ne,1,8,ae,ce,me)}function Ve(x,S,P,F,ne,ae,ce,me){Eo(x,S+4,1,ne,8,ae,ce,me),Eo(P,F+4,1,ne,8,ae,ce,me)}function lt(){this.ba=new _n,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Ut,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function At(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function ln(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Tn(){this.ua=0,this.Wa=new $t,this.vb=new $t,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Ce,this.yc=new J}function Sn(){this.xb=this.a=0,this.l=new nl,this.ca=new _n,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Q,this.Pb=0,this.wd=new Q,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Tn,this.ab=0,this.gc=d(4,ln),this.Oc=0}function si(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new nl,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function _i(x,S,P,F,ne,ae,ce){for(x=x==null?0:x[S+0],S=0;S<ce;++S)ne[ae+S]=x+P[F+S]&255,x=ne[ae+S]}function Zr(x,S,P,F,ne,ae,ce){var me;if(x==null)_i(null,null,P,F,ne,ae,ce);else for(me=0;me<ce;++me)ne[ae+me]=x[S+me]+P[F+me]&255}function Fi(x,S,P,F,ne,ae,ce){if(x==null)_i(null,null,P,F,ne,ae,ce);else{var me,we=x[S+0],Te=we,Fe=we;for(me=0;me<ce;++me)Te=Fe+(we=x[S+me])-Te,Fe=P[F+me]+(-256&Te?0>Te?0:255:Te)&255,Te=we,ne[ae+me]=Fe}}function Qi(x,S,P,F){var ne=S.width,ae=S.o;if(e(x!=null&&S!=null),0>P||0>=F||P+F>ae)return null;if(!x.Cc){if(x.ga==null){var ce;if(x.ga=new si,(ce=x.ga==null)||(ce=S.width*S.o,e(x.Gb.length==0),x.Gb=o(ce),x.Uc=0,x.Gb==null?ce=0:(x.mb=x.Gb,x.nb=x.Uc,x.rc=null,ce=1),ce=!ce),!ce){ce=x.ga;var me=x.Fa,we=x.P,Te=x.qc,Fe=x.mb,et=x.nb,ke=we+1,qe=Te-1,Ge=ce.l;if(e(me!=null&&Fe!=null&&S!=null),Il[0]=null,Il[1]=_i,Il[2]=Zr,Il[3]=Fi,ce.ca=Fe,ce.tb=et,ce.c=S.width,ce.i=S.height,e(0<ce.c&&0<ce.i),1>=Te)S=0;else if(ce.$a=3&me[we+0],ce.Z=me[we+0]>>2&3,ce.Lc=me[we+0]>>4&3,we=me[we+0]>>6&3,0>ce.$a||1<ce.$a||4<=ce.Z||1<ce.Lc||we)S=0;else if(Ge.put=Et,Ge.ac=Ht,Ge.bc=ti,Ge.ma=ce,Ge.width=S.width,Ge.height=S.height,Ge.Da=S.Da,Ge.v=S.v,Ge.va=S.va,Ge.j=S.j,Ge.o=S.o,ce.$a)e:{e(ce.$a==1),S=$l();t:for(;;){if(S==null){S=0;break e}if(e(ce!=null),ce.mc=S,S.c=ce.c,S.i=ce.i,S.l=ce.l,S.l.ma=ce,S.l.width=ce.c,S.l.height=ce.i,S.a=0,Ae(S.m,me,ke,qe),!Wa(ce.c,ce.i,1,S,null)||(S.ab==1&&S.gc[0].hc==3&&Di(S.s)?(ce.ic=1,me=S.c*S.i,S.Ta=null,S.Ua=0,S.V=o(me),S.Ba=0,S.V==null?(S.a=1,S=0):S=1):(ce.ic=0,S=$a(S,ce.c)),!S))break t;S=1;break e}ce.mc=null,S=0}else S=qe>=ce.c*ce.i;ce=!S}if(ce)return null;x.ga.Lc!=1?x.Ga=0:F=ae-P}e(x.ga!=null),e(P+F<=ae);e:{if(S=(me=x.ga).c,ae=me.l.o,me.$a==0){if(ke=x.rc,qe=x.Vc,Ge=x.Fa,we=x.P+1+P*S,Te=x.mb,Fe=x.nb+P*S,e(we<=x.P+x.qc),me.Z!=0)for(e(Il[me.Z]!=null),ce=0;ce<F;++ce)Il[me.Z](ke,qe,Ge,we,Te,Fe,S),ke=Te,qe=Fe,Fe+=S,we+=S;else for(ce=0;ce<F;++ce)n(Te,Fe,Ge,we,S),ke=Te,qe=Fe,Fe+=S,we+=S;x.rc=ke,x.Vc=qe}else{if(e(me.mc!=null),S=P+F,e((ce=me.mc)!=null),e(S<=ce.i),ce.C>=S)S=1;else if(me.ic||Ps(),me.ic){me=ce.V,ke=ce.Ba,qe=ce.c;var ct=ce.i,Ke=(Ge=1,we=ce.$/qe,Te=ce.$%qe,Fe=ce.m,et=ce.s,ce.$),gt=qe*ct,ut=qe*S,bt=et.wc,Nt=Ke<ut?ci(et,Te,we):null;e(Ke<=gt),e(S<=ct),e(Di(et));t:for(;;){for(;!Fe.h&&Ke<ut;){if(Te&bt||(Nt=ci(et,Te,we)),e(Nt!=null),re(Fe),256>(ct=Fn(Nt.G[0],Nt.H[0],Fe)))me[ke+Ke]=ct,++Ke,++Te>=qe&&(Te=0,++we<=S&&!(we%16)&&Ns(ce,we));else{if(!(280>ct)){Ge=0;break t}ct=ar(ct-256,Fe);var hn,dn=Fn(Nt.G[4],Nt.H[4],Fe);if(re(Fe),!(Ke>=(dn=_t(qe,dn=ar(dn,Fe)))&&gt-Ke>=ct)){Ge=0;break t}for(hn=0;hn<ct;++hn)me[ke+Ke+hn]=me[ke+Ke+hn-dn];for(Ke+=ct,Te+=ct;Te>=qe;)Te-=qe,++we<=S&&!(we%16)&&Ns(ce,we);Ke<ut&&Te&bt&&(Nt=ci(et,Te,we))}e(Fe.h==oe(Fe))}Ns(ce,we>S?S:we);break t}!Ge||Fe.h&&Ke<gt?(Ge=0,ce.a=Fe.h?5:3):ce.$=Ke,S=Ge}else S=ha(ce,ce.V,ce.Ba,ce.c,ce.i,S,No);if(!S){F=0;break e}}P+F>=ae&&(x.Cc=1),F=1}if(!F)return null;if(x.Cc&&((F=x.ga)!=null&&(F.mc=null),x.ga=null,0<x.Ga))return alert("todo:WebPDequantizeLevels"),null}return x.nb+P*ne}function Ui(x,S,P,F,ne,ae){for(;0<ne--;){var ce,me=x,we=S+(P?1:0),Te=x,Fe=S+(P?0:3);for(ce=0;ce<F;++ce){var et=Te[Fe+4*ce];et!=255&&(et*=32897,me[we+4*ce+0]=me[we+4*ce+0]*et>>23,me[we+4*ce+1]=me[we+4*ce+1]*et>>23,me[we+4*ce+2]=me[we+4*ce+2]*et>>23)}S+=ae}}function Lr(x,S,P,F,ne){for(;0<F--;){var ae;for(ae=0;ae<P;++ae){var ce=x[S+2*ae+0],me=15&(Te=x[S+2*ae+1]),we=4369*me,Te=(240&Te|Te>>4)*we>>16;x[S+2*ae+0]=(240&ce|ce>>4)*we>>16&240|(15&ce|ce<<4)*we>>16>>4&15,x[S+2*ae+1]=240&Te|me}S+=ne}}function hr(x,S,P,F,ne,ae,ce,me){var we,Te,Fe=255;for(Te=0;Te<ne;++Te){for(we=0;we<F;++we){var et=x[S+we];ae[ce+4*we]=et,Fe&=et}S+=P,ce+=me}return Fe!=255}function fo(x,S,P,F,ne){var ae;for(ae=0;ae<ne;++ae)P[F+ae]=x[S+ae]>>8}function Ps(){Rl=Ui,br=Lr,Pi=hr,Jr=fo}function al(x,S,P){O[x]=function(F,ne,ae,ce,me,we,Te,Fe,et,ke,qe,Ge,ct,Ke,gt,ut,bt){var Nt,hn=bt-1>>1,dn=me[we+0]|Te[Fe+0]<<16,ni=et[ke+0]|qe[Ge+0]<<16;e(F!=null);var fn=3*dn+ni+131074>>2;for(S(F[ne+0],255&fn,fn>>16,ct,Ke),ae!=null&&(fn=3*ni+dn+131074>>2,S(ae[ce+0],255&fn,fn>>16,gt,ut)),Nt=1;Nt<=hn;++Nt){var In=me[we+Nt]|Te[Fe+Nt]<<16,Ei=et[ke+Nt]|qe[Ge+Nt]<<16,Gn=dn+In+ni+Ei+524296,en=Gn+2*(In+ni)>>3;fn=en+dn>>1,dn=(Gn=Gn+2*(dn+Ei)>>3)+In>>1,S(F[ne+2*Nt-1],255&fn,fn>>16,ct,Ke+(2*Nt-1)*P),S(F[ne+2*Nt-0],255&dn,dn>>16,ct,Ke+(2*Nt-0)*P),ae!=null&&(fn=Gn+ni>>1,dn=en+Ei>>1,S(ae[ce+2*Nt-1],255&fn,fn>>16,gt,ut+(2*Nt-1)*P),S(ae[ce+2*Nt+0],255&dn,dn>>16,gt,ut+(2*Nt+0)*P)),dn=In,ni=Ei}1&bt||(fn=3*dn+ni+131074>>2,S(F[ne+bt-1],255&fn,fn>>16,ct,Ke+(bt-1)*P),ae!=null&&(fn=3*ni+dn+131074>>2,S(ae[ce+bt-1],255&fn,fn>>16,gt,ut+(bt-1)*P)))}}function ws(){Ur[Od]=ys,Ur[ia]=As,Ur[gd]=zl,Ur[Ba]=fu,Ur[Yc]=nc,Ur[Dl]=Ar,Ur[Zl]=$s,Ur[fl]=As,Ur[kc]=fu,Ur[Oo]=nc,Ur[Jl]=Ar}function ol(x){return x&-16384?0>x?0:255:x>>Ys}function Or(x,S){return ol((19077*x>>8)+(26149*S>>8)-14234)}function ma(x,S,P){return ol((19077*x>>8)-(6419*S>>8)-(13320*P>>8)+8708)}function Ss(x,S){return ol((19077*x>>8)+(33050*S>>8)-17685)}function Za(x,S,P,F,ne){F[ne+0]=Or(x,P),F[ne+1]=ma(x,S,P),F[ne+2]=Ss(x,S)}function fi(x,S,P,F,ne){F[ne+0]=Ss(x,S),F[ne+1]=ma(x,S,P),F[ne+2]=Or(x,P)}function po(x,S,P,F,ne){var ae=ma(x,S,P);S=ae<<3&224|Ss(x,S)>>3,F[ne+0]=248&Or(x,P)|ae>>5,F[ne+1]=S}function Cc(x,S,P,F,ne){var ae=240&Ss(x,S)|15;F[ne+0]=240&Or(x,P)|ma(x,S,P)>>4,F[ne+1]=ae}function hd(x,S,P,F,ne){F[ne+0]=255,Za(x,S,P,F,ne+1)}function Ja(x,S,P,F,ne){fi(x,S,P,F,ne),F[ne+3]=255}function qs(x,S,P,F,ne){Za(x,S,P,F,ne),F[ne+3]=255}function Do(x,S,P){O[x]=function(F,ne,ae,ce,me,we,Te,Fe,et){for(var ke=Fe+(-2&et)*P;Fe!=ke;)S(F[ne+0],ae[ce+0],me[we+0],Te,Fe),S(F[ne+1],ae[ce+0],me[we+0],Te,Fe+P),ne+=2,++ce,++we,Fe+=2*P;1&et&&S(F[ne+0],ae[ce+0],me[we+0],Te,Fe)}}function Tc(x,S,P){return P==0?x==0?S==0?6:5:S==0?4:0:P}function Lo(x,S,P,F,ne){switch(x>>>30){case 3:Bo(S,P,F,ne,0);break;case 2:va(S,P,F,ne);break;case 1:er(S,P,F,ne)}}function ya(x,S){var P,F,ne=S.M,ae=S.Nb,ce=x.oc,me=x.pc+40,we=x.oc,Te=x.pc+584,Fe=x.oc,et=x.pc+600;for(P=0;16>P;++P)ce[me+32*P-1]=129;for(P=0;8>P;++P)we[Te+32*P-1]=129,Fe[et+32*P-1]=129;for(0<ne?ce[me-1-32]=we[Te-1-32]=Fe[et-1-32]=129:(r(ce,me-32-1,127,21),r(we,Te-32-1,127,9),r(Fe,et-32-1,127,9)),F=0;F<x.za;++F){var ke=S.ya[S.aa+F];if(0<F){for(P=-1;16>P;++P)n(ce,me+32*P-4,ce,me+32*P+12,4);for(P=-1;8>P;++P)n(we,Te+32*P-4,we,Te+32*P+4,4),n(Fe,et+32*P-4,Fe,et+32*P+4,4)}var qe=x.Gd,Ge=x.Hd+F,ct=ke.ad,Ke=ke.Hc;if(0<ne&&(n(ce,me-32,qe[Ge].y,0,16),n(we,Te-32,qe[Ge].f,0,8),n(Fe,et-32,qe[Ge].ea,0,8)),ke.Za){var gt=ce,ut=me-32+16;for(0<ne&&(F>=x.za-1?r(gt,ut,qe[Ge].y[15],4):n(gt,ut,qe[Ge+1].y,0,4)),P=0;4>P;P++)gt[ut+128+P]=gt[ut+256+P]=gt[ut+384+P]=gt[ut+0+P];for(P=0;16>P;++P,Ke<<=2)gt=ce,ut=me+Vi[P],ls[ke.Ob[P]](gt,ut),Lo(Ke,ct,16*+P,gt,ut)}else if(gt=Tc(F,ne,ke.Ob[0]),Ua[gt](ce,me),Ke!=0)for(P=0;16>P;++P,Ke<<=2)Lo(Ke,ct,16*+P,ce,me+Vi[P]);for(P=ke.Gc,gt=Tc(F,ne,ke.Dd),wo[gt](we,Te),wo[gt](Fe,et),Ke=ct,gt=we,ut=Te,255&(ke=0|P)&&(170&ke?yo(Ke,256,gt,ut):Hi(Ke,256,gt,ut)),ke=Fe,Ke=et,255&(P>>=8)&&(170&P?yo(ct,320,ke,Ke):Hi(ct,320,ke,Ke)),ne<x.Ub-1&&(n(qe[Ge].y,0,ce,me+480,16),n(qe[Ge].f,0,we,Te+224,8),n(qe[Ge].ea,0,Fe,et+224,8)),P=8*ae*x.B,qe=x.sa,Ge=x.ta+16*F+16*ae*x.R,ct=x.qa,ke=x.ra+8*F+P,Ke=x.Ha,gt=x.Ia+8*F+P,P=0;16>P;++P)n(qe,Ge+P*x.R,ce,me+32*P,16);for(P=0;8>P;++P)n(ct,ke+P*x.B,we,Te+32*P,8),n(Ke,gt+P*x.B,Fe,et+32*P,8)}}function hs(x,S,P,F,ne,ae,ce,me,we){var Te=[0],Fe=[0],et=0,ke=we!=null?we.kd:0,qe=we??new At;if(x==null||12>P)return 7;qe.data=x,qe.w=S,qe.ha=P,S=[S],P=[P],qe.gb=[qe.gb];e:{var Ge=S,ct=P,Ke=qe.gb;if(e(x!=null),e(ct!=null),e(Ke!=null),Ke[0]=0,12<=ct[0]&&!t(x,Ge[0],"RIFF")){if(t(x,Ge[0]+8,"WEBP")){Ke=3;break e}var gt=Mt(x,Ge[0]+4);if(12>gt||4294967286<gt){Ke=3;break e}if(ke&&gt>ct[0]-8){Ke=7;break e}Ke[0]=gt,Ge[0]+=12,ct[0]-=12}Ke=0}if(Ke!=0)return Ke;for(gt=0<qe.gb[0],P=P[0];;){e:{var ut=x;ct=S,Ke=P;var bt=Te,Nt=Fe,hn=Ge=[0];if((fn=et=[et])[0]=0,8>Ke[0])Ke=7;else{if(!t(ut,ct[0],"VP8X")){if(Mt(ut,ct[0]+4)!=10){Ke=3;break e}if(18>Ke[0]){Ke=7;break e}var dn=Mt(ut,ct[0]+8),ni=1+mt(ut,ct[0]+12);if(2147483648<=ni*(ut=1+mt(ut,ct[0]+15))){Ke=3;break e}hn!=null&&(hn[0]=dn),bt!=null&&(bt[0]=ni),Nt!=null&&(Nt[0]=ut),ct[0]+=18,Ke[0]-=18,fn[0]=1}Ke=0}}if(et=et[0],Ge=Ge[0],Ke!=0)return Ke;if(ct=!!(2&Ge),!gt&&et)return 3;if(ae!=null&&(ae[0]=!!(16&Ge)),ce!=null&&(ce[0]=ct),me!=null&&(me[0]=0),ce=Te[0],Ge=Fe[0],et&&ct&&we==null){Ke=0;break}if(4>P){Ke=7;break}if(gt&&et||!gt&&!et&&!t(x,S[0],"ALPH")){P=[P],qe.na=[qe.na],qe.P=[qe.P],qe.Sa=[qe.Sa];e:{dn=x,Ke=S,gt=P;var fn=qe.gb;bt=qe.na,Nt=qe.P,hn=qe.Sa,ni=22,e(dn!=null),e(gt!=null),ut=Ke[0];var In=gt[0];for(e(bt!=null),e(hn!=null),bt[0]=null,Nt[0]=null,hn[0]=0;;){if(Ke[0]=ut,gt[0]=In,8>In){Ke=7;break e}var Ei=Mt(dn,ut+4);if(4294967286<Ei){Ke=3;break e}var Gn=8+Ei+1&-2;if(ni+=Gn,0<fn&&ni>fn){Ke=3;break e}if(!t(dn,ut,"VP8 ")||!t(dn,ut,"VP8L")){Ke=0;break e}if(In[0]<Gn){Ke=7;break e}t(dn,ut,"ALPH")||(bt[0]=dn,Nt[0]=ut+8,hn[0]=Ei),ut+=Gn,In-=Gn}}if(P=P[0],qe.na=qe.na[0],qe.P=qe.P[0],qe.Sa=qe.Sa[0],Ke!=0)break}P=[P],qe.Ja=[qe.Ja],qe.xa=[qe.xa];e:if(fn=x,Ke=S,gt=P,bt=qe.gb[0],Nt=qe.Ja,hn=qe.xa,dn=Ke[0],ut=!t(fn,dn,"VP8 "),ni=!t(fn,dn,"VP8L"),e(fn!=null),e(gt!=null),e(Nt!=null),e(hn!=null),8>gt[0])Ke=7;else{if(ut||ni){if(fn=Mt(fn,dn+4),12<=bt&&fn>bt-12){Ke=3;break e}if(ke&&fn>gt[0]-8){Ke=7;break e}Nt[0]=fn,Ke[0]+=8,gt[0]-=8,hn[0]=ni}else hn[0]=5<=gt[0]&&fn[dn+0]==47&&!(fn[dn+4]>>5),Nt[0]=gt[0];Ke=0}if(P=P[0],qe.Ja=qe.Ja[0],qe.xa=qe.xa[0],S=S[0],Ke!=0)break;if(4294967286<qe.Ja)return 3;if(me==null||ct||(me[0]=qe.xa?2:1),ce=[ce],Ge=[Ge],qe.xa){if(5>P){Ke=7;break}me=ce,ke=Ge,ct=ae,x==null||5>P?x=0:5<=P&&x[S+0]==47&&!(x[S+4]>>5)?(gt=[0],fn=[0],bt=[0],Ae(Nt=new Q,x,S,P),vi(Nt,gt,fn,bt)?(me!=null&&(me[0]=gt[0]),ke!=null&&(ke[0]=fn[0]),ct!=null&&(ct[0]=bt[0]),x=1):x=0):x=0}else{if(10>P){Ke=7;break}me=Ge,x==null||10>P||!il(x,S+3,P-3)?x=0:(ke=x[S+0]|x[S+1]<<8|x[S+2]<<16,ct=16383&(x[S+7]<<8|x[S+6]),x=16383&(x[S+9]<<8|x[S+8]),1&ke||3<(ke>>1&7)||!(ke>>4&1)||ke>>5>=qe.Ja||!ct||!x?x=0:(ce&&(ce[0]=ct),me&&(me[0]=x),x=1))}if(!x||(ce=ce[0],Ge=Ge[0],et&&(Te[0]!=ce||Fe[0]!=Ge)))return 3;we!=null&&(we[0]=qe,we.offset=S-we.w,e(4294967286>S-we.w),e(we.offset==we.ha-P));break}return Ke==0||Ke==7&&et&&we==null?(ae!=null&&(ae[0]|=qe.na!=null&&0<qe.na.length),F!=null&&(F[0]=ce),ne!=null&&(ne[0]=Ge),0):Ke}function Qa(x,S,P){var F=S.width,ne=S.height,ae=0,ce=0,me=F,we=ne;if(S.Da=x!=null&&0<x.Da,S.Da&&(me=x.cd,we=x.bd,ae=x.v,ce=x.j,11>P||(ae&=-2,ce&=-2),0>ae||0>ce||0>=me||0>=we||ae+me>F||ce+we>ne))return 0;if(S.v=ae,S.j=ce,S.va=ae+me,S.o=ce+we,S.U=me,S.T=we,S.da=x!=null&&0<x.da,S.da){if(!Yt(me,we,P=[x.ib],ae=[x.hb]))return 0;S.ib=P[0],S.hb=ae[0]}return S.ob=x!=null&&x.ob,S.Kb=x==null||!x.Sd,S.da&&(S.ob=S.ib<3*F/4&&S.hb<3*ne/4,S.Kb=0),1}function ll(x){if(x==null)return 2;if(11>x.S){var S=x.f.RGBA;S.fb+=(x.height-1)*S.A,S.A=-S.A}else S=x.f.kb,x=x.height,S.O+=(x-1)*S.fa,S.fa=-S.fa,S.N+=(x-1>>1)*S.Ab,S.Ab=-S.Ab,S.W+=(x-1>>1)*S.Db,S.Db=-S.Db,S.F!=null&&(S.J+=(x-1)*S.lb,S.lb=-S.lb);return 0}function go(x,S,P,F){if(F==null||0>=x||0>=S)return 2;if(P!=null){if(P.Da){var ne=P.cd,ae=P.bd,ce=-2&P.v,me=-2&P.j;if(0>ce||0>me||0>=ne||0>=ae||ce+ne>x||me+ae>S)return 2;x=ne,S=ae}if(P.da){if(!Yt(x,S,ne=[P.ib],ae=[P.hb]))return 2;x=ne[0],S=ae[0]}}F.width=x,F.height=S;e:{var we=F.width,Te=F.height;if(x=F.S,0>=we||0>=Te||!(x>=Od&&13>x))x=2;else{if(0>=F.Rd&&F.sd==null){ce=ae=ne=S=0;var Fe=(me=we*Ha[x])*Te;if(11>x||(ae=(Te+1)/2*(S=(we+1)/2),x==12&&(ce=(ne=we)*Te)),(Te=o(Fe+2*ae+ce))==null){x=1;break e}F.sd=Te,11>x?((we=F.f.RGBA).eb=Te,we.fb=0,we.A=me,we.size=Fe):((we=F.f.kb).y=Te,we.O=0,we.fa=me,we.Fd=Fe,we.f=Te,we.N=0+Fe,we.Ab=S,we.Cd=ae,we.ea=Te,we.W=0+Fe+ae,we.Db=S,we.Ed=ae,x==12&&(we.F=Te,we.J=0+Fe+2*ae),we.Tc=ce,we.lb=ne)}if(S=1,ne=F.S,ae=F.width,ce=F.height,ne>=Od&&13>ne)if(11>ne)x=F.f.RGBA,S&=(me=Math.abs(x.A))*(ce-1)+ae<=x.size,S&=me>=ae*Ha[ne],S&=x.eb!=null;else{x=F.f.kb,me=(ae+1)/2,Fe=(ce+1)/2,we=Math.abs(x.fa),Te=Math.abs(x.Ab);var et=Math.abs(x.Db),ke=Math.abs(x.lb),qe=ke*(ce-1)+ae;S&=we*(ce-1)+ae<=x.Fd,S&=Te*(Fe-1)+me<=x.Cd,S=(S&=et*(Fe-1)+me<=x.Ed)&we>=ae&Te>=me&et>=me,S&=x.y!=null,S&=x.f!=null,S&=x.ea!=null,ne==12&&(S&=ke>=ae,S&=qe<=x.Tc,S&=x.F!=null)}else S=0;x=S?0:2}}return x!=0||P!=null&&P.fd&&(x=ll(F)),x}var mo=64,xa=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],fs=24,Mo=32,La=8,Li=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];ze("Predictor0","PredictorAdd0"),O.Predictor0=function(){return 4278190080},O.Predictor1=function(x){return x},O.Predictor2=function(x,S,P){return S[P+0]},O.Predictor3=function(x,S,P){return S[P+1]},O.Predictor4=function(x,S,P){return S[P-1]},O.Predictor5=function(x,S,P){return Ct(Ct(x,S[P+1]),S[P+0])},O.Predictor6=function(x,S,P){return Ct(x,S[P-1])},O.Predictor7=function(x,S,P){return Ct(x,S[P+0])},O.Predictor8=function(x,S,P){return Ct(S[P-1],S[P+0])},O.Predictor9=function(x,S,P){return Ct(S[P+0],S[P+1])},O.Predictor10=function(x,S,P){return Ct(Ct(x,S[P-1]),Ct(S[P+0],S[P+1]))},O.Predictor11=function(x,S,P){var F=S[P+0];return 0>=pt(F>>24&255,x>>24&255,(S=S[P-1])>>24&255)+pt(F>>16&255,x>>16&255,S>>16&255)+pt(F>>8&255,x>>8&255,S>>8&255)+pt(255&F,255&x,255&S)?F:x},O.Predictor12=function(x,S,P){var F=S[P+0];return(wt((x>>24&255)+(F>>24&255)-((S=S[P-1])>>24&255))<<24|wt((x>>16&255)+(F>>16&255)-(S>>16&255))<<16|wt((x>>8&255)+(F>>8&255)-(S>>8&255))<<8|wt((255&x)+(255&F)-(255&S)))>>>0},O.Predictor13=function(x,S,P){var F=S[P-1];return(it((x=Ct(x,S[P+0]))>>24&255,F>>24&255)<<24|it(x>>16&255,F>>16&255)<<16|it(x>>8&255,F>>8&255)<<8|it(255&x,255&F))>>>0};var Io=O.PredictorAdd0;O.PredictorAdd1=Ot,ze("Predictor2","PredictorAdd2"),ze("Predictor3","PredictorAdd3"),ze("Predictor4","PredictorAdd4"),ze("Predictor5","PredictorAdd5"),ze("Predictor6","PredictorAdd6"),ze("Predictor7","PredictorAdd7"),ze("Predictor8","PredictorAdd8"),ze("Predictor9","PredictorAdd9"),ze("Predictor10","PredictorAdd10"),ze("Predictor11","PredictorAdd11"),ze("Predictor12","PredictorAdd12"),ze("Predictor13","PredictorAdd13");var fr=O.PredictorAdd2;Bt("ColorIndexInverseTransform","MapARGB","32b",function(x){return x>>8&255},function(x){return x}),Bt("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(x){return x},function(x){return x>>8&255});var jr,fd=O.ColorIndexInverseTransform,Ma=O.MapARGB,_l=O.VP8LColorIndexInverseTransformAlpha,Es=O.MapAlpha,Xl=O.VP8LPredictorsAdd=[];Xl.length=16,(O.VP8LPredictors=[]).length=16,(O.VP8LPredictorsAdd_C=[]).length=16,(O.VP8LPredictors_C=[]).length=16;var pd,eo,cl,zo,ba,Ws,Ia,Bo,va,yo,er,Hi,Nr,ps,jl,dl,gs,wa,Nl,ul,Pl,Kl,El,to,Rl,br,Pi,Jr,Qr=o(511),za=o(2041),Bd=o(225),hl=o(767),Fd=0,Fo=za,Zi=Bd,pr=hl,Rs=Qr,Od=0,ia=1,gd=2,Ba=3,Yc=4,Dl=5,Zl=6,fl=7,kc=8,Oo=9,Jl=10,Fa=[2,3,7],Ql=[3,3,11],xo=[280,256,256,256,40],Ll=[0,1,1,1,0],md=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],ms=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],bo=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],os=8,Oa=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],vo=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Ds=null,_c=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],yd=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],ec=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Ml=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],ra=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Pr=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Mi=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Ua=[],ls=[],wo=[],tc=1,hu=2,Il=[],Ur=[];al("UpsampleRgbLinePair",Za,3),al("UpsampleBgrLinePair",fi,3),al("UpsampleRgbaLinePair",qs,4),al("UpsampleBgraLinePair",Ja,4),al("UpsampleArgbLinePair",hd,4),al("UpsampleRgba4444LinePair",Cc,2),al("UpsampleRgb565LinePair",po,2);var ys=O.UpsampleRgbLinePair,zl=O.UpsampleBgrLinePair,As=O.UpsampleRgbaLinePair,fu=O.UpsampleBgraLinePair,nc=O.UpsampleArgbLinePair,Ar=O.UpsampleRgba4444LinePair,$s=O.UpsampleRgb565LinePair,Cr=16,Sa=1<<Cr-1,cs=-227,Gs=482,Ys=6,Xs=0,tr=o(256),no=o(256),So=o(256),ic=o(256),Uo=o(Gs-cs),rc=o(Gs-cs);Do("YuvToRgbRow",Za,3),Do("YuvToBgrRow",fi,3),Do("YuvToRgbaRow",qs,4),Do("YuvToBgraRow",Ja,4),Do("YuvToArgbRow",hd,4),Do("YuvToRgba4444Row",Cc,2),Do("YuvToRgb565Row",po,2);var Vi=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],sa=[0,2,8],Ks=[8,7,6,4,4,2,2,2,1,1,1,1],Aa=1;this.WebPDecodeRGBA=function(x,S,P,F,ne){var ae=ia,ce=new lt,me=new _n;ce.ba=me,me.S=ae,me.width=[me.width],me.height=[me.height];var we=me.width,Te=me.height,Fe=new Qt;if(Fe==null||x==null)var et=2;else e(Fe!=null),et=hs(x,S,P,Fe.width,Fe.height,Fe.Pd,Fe.Qd,Fe.format,null);if(et!=0?we=0:(we!=null&&(we[0]=Fe.width[0]),Te!=null&&(Te[0]=Fe.height[0]),we=1),we){me.width=me.width[0],me.height=me.height[0],F!=null&&(F[0]=me.width),ne!=null&&(ne[0]=me.height);e:{if(F=new nl,(ne=new At).data=x,ne.w=S,ne.ha=P,ne.kd=1,S=[0],e(ne!=null),((x=hs(ne.data,ne.w,ne.ha,null,null,null,S,null,ne))==0||x==7)&&S[0]&&(x=4),(S=x)==0){if(e(ce!=null),F.data=ne.data,F.w=ne.w+ne.offset,F.ha=ne.ha-ne.offset,F.put=Et,F.ac=Ht,F.bc=ti,F.ma=ce,ne.xa){if((x=$l())==null){ce=1;break e}if((function(ke,qe){var Ge=[0],ct=[0],Ke=[0];t:for(;;){if(ke==null)return 0;if(qe==null)return ke.a=2,0;if(ke.l=qe,ke.a=0,Ae(ke.m,qe.data,qe.w,qe.ha),!vi(ke.m,Ge,ct,Ke)){ke.a=3;break t}if(ke.xb=hu,qe.width=Ge[0],qe.height=ct[0],!Wa(Ge[0],ct[0],1,ke,null))break t;return 1}return e(ke.a!=0),0})(x,F)){if(F=(S=go(F.width,F.height,ce.Oa,ce.ba))==0){t:{F=x;n:for(;;){if(F==null){F=0;break t}if(e(F.s.yc!=null),e(F.s.Ya!=null),e(0<F.s.Wb),e((P=F.l)!=null),e((ne=P.ma)!=null),F.xb!=0){if(F.ca=ne.ba,F.tb=ne.tb,e(F.ca!=null),!Qa(ne.Oa,P,Ba)){F.a=2;break n}if(!$a(F,P.width)||P.da)break n;if((P.da||Ft(F.ca.S))&&Ps(),11>F.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),F.ca.f.kb.F!=null&&Ps()),F.Pb&&0<F.s.ua&&F.s.vb.X==null&&!K(F.s.vb,F.s.Wa.Xa)){F.a=1;break n}F.xb=0}if(!ha(F,F.V,F.Ba,F.c,F.i,P.o,Br))break n;ne.Dc=F.Ma,F=1;break t}e(F.a!=0),F=0}F=!F}F&&(S=x.a)}else S=x.a}else{if((x=new $n)==null){ce=1;break e}if(x.Fa=ne.na,x.P=ne.P,x.qc=ne.Sa,co(x,F)){if((S=go(F.width,F.height,ce.Oa,ce.ba))==0){if(x.Aa=0,P=ce.Oa,e((ne=x)!=null),P!=null){if(0<(we=0>(we=P.Md)?0:100<we?255:255*we/100)){for(Te=Fe=0;4>Te;++Te)12>(et=ne.pb[Te]).lc&&(et.ia=we*Ks[0>et.lc?0:et.lc]>>3),Fe|=et.ia;Fe&&(alert("todo:VP8InitRandom"),ne.ia=1)}ne.Ga=P.Id,100<ne.Ga?ne.Ga=100:0>ne.Ga&&(ne.Ga=0)}(function(ke,qe){if(ke==null)return 0;if(qe==null)return Wn(ke,2,"NULL VP8Io parameter in VP8Decode().");if(!ke.cb&&!co(ke,qe))return 0;if(e(ke.cb),qe.ac==null||qe.ac(qe)){qe.ob&&(ke.L=0);var Ge=sa[ke.L];if(ke.L==2?(ke.yb=0,ke.zb=0):(ke.yb=qe.v-Ge>>4,ke.zb=qe.j-Ge>>4,0>ke.yb&&(ke.yb=0),0>ke.zb&&(ke.zb=0)),ke.Va=qe.o+15+Ge>>4,ke.Hb=qe.va+15+Ge>>4,ke.Hb>ke.za&&(ke.Hb=ke.za),ke.Va>ke.Ub&&(ke.Va=ke.Ub),0<ke.L){var ct=ke.ed;for(Ge=0;4>Ge;++Ge){var Ke;if(ke.Qa.Cb){var gt=ke.Qa.Lb[Ge];ke.Qa.Fb||(gt+=ct.Tb)}else gt=ct.Tb;for(Ke=0;1>=Ke;++Ke){var ut=ke.gd[Ge][Ke],bt=gt;if(ct.Pc&&(bt+=ct.vd[0],Ke&&(bt+=ct.od[0])),0<(bt=0>bt?0:63<bt?63:bt)){var Nt=bt;0<ct.wb&&(Nt=4<ct.wb?Nt>>2:Nt>>1)>9-ct.wb&&(Nt=9-ct.wb),1>Nt&&(Nt=1),ut.dd=Nt,ut.tc=2*bt+Nt,ut.ld=40<=bt?2:15<=bt?1:0}else ut.tc=0;ut.La=Ke}}}Ge=0}else Wn(ke,6,"Frame setup failed"),Ge=ke.a;if(Ge=Ge==0){if(Ge){ke.$c=0,0<ke.Aa||(ke.Ic=Aa);t:{Ge=ke.Ic,ct=4*(Nt=ke.za);var hn=32*Nt,dn=Nt+1,ni=0<ke.L?Nt*(0<ke.Aa?2:1):0,fn=(ke.Aa==2?2:1)*Nt;if((ut=ct+832+(Ke=3*(16*Ge+sa[ke.L])/2*hn)+(gt=ke.Fa!=null&&0<ke.Fa.length?ke.Kc.c*ke.Kc.i:0))!=ut)Ge=0;else{if(ut>ke.Vb){if(ke.Vb=0,ke.Ec=o(ut),ke.Fc=0,ke.Ec==null){Ge=Wn(ke,1,"no memory during frame initialization.");break t}ke.Vb=ut}ut=ke.Ec,bt=ke.Fc,ke.Ac=ut,ke.Bc=bt,bt+=ct,ke.Gd=d(hn,Ga),ke.Hd=0,ke.rb=d(dn+1,fa),ke.sb=1,ke.wa=ni?d(ni,wi):null,ke.Y=0,ke.D.Nb=0,ke.D.wa=ke.wa,ke.D.Y=ke.Y,0<ke.Aa&&(ke.D.Y+=Nt),e(!0),ke.oc=ut,ke.pc=bt,bt+=832,ke.ya=d(fn,el),ke.aa=0,ke.D.ya=ke.ya,ke.D.aa=ke.aa,ke.Aa==2&&(ke.D.aa+=Nt),ke.R=16*Nt,ke.B=8*Nt,Nt=(hn=sa[ke.L])*ke.R,hn=hn/2*ke.B,ke.sa=ut,ke.ta=bt+Nt,ke.qa=ke.sa,ke.ra=ke.ta+16*Ge*ke.R+hn,ke.Ha=ke.qa,ke.Ia=ke.ra+8*Ge*ke.B+hn,ke.$c=0,bt+=Ke,ke.mb=gt?ut:null,ke.nb=gt?bt:null,e(bt+gt<=ke.Fc+ke.Vb),ea(ke),r(ke.Ac,ke.Bc,0,ct),Ge=1}}if(Ge){if(qe.ka=0,qe.y=ke.sa,qe.O=ke.ta,qe.f=ke.qa,qe.N=ke.ra,qe.ea=ke.Ha,qe.Vd=ke.Ia,qe.fa=ke.R,qe.Rc=ke.B,qe.F=null,qe.J=0,!Fd){for(Ge=-255;255>=Ge;++Ge)Qr[255+Ge]=0>Ge?-Ge:Ge;for(Ge=-1020;1020>=Ge;++Ge)za[1020+Ge]=-128>Ge?-128:127<Ge?127:Ge;for(Ge=-112;112>=Ge;++Ge)Bd[112+Ge]=-16>Ge?-16:15<Ge?15:Ge;for(Ge=-255;510>=Ge;++Ge)hl[255+Ge]=0>Ge?0:255<Ge?255:Ge;Fd=1}Ia=vs,Bo=ta,yo=Hs,er=Gl,Hi=pa,va=$c,Nr=uu,ps=wn,jl=te,dl=Se,gs=Ro,wa=j,Nl=Ie,ul=Ve,Pl=Ka,Kl=sl,El=Ac,to=Yl,ls[0]=Gc,ls[1]=Ya,ls[2]=li,ls[3]=Pn,ls[4]=ga,ls[5]=jn,ls[6]=gn,ls[7]=ui,ls[8]=hi,ls[9]=pn,Ua[0]=ho,Ua[1]=$i,Ua[2]=uo,Ua[3]=Tl,Ua[4]=ur,Ua[5]=or,Ua[6]=Po,wo[0]=Bi,wo[1]=zt,wo[2]=xn,wo[3]=du,wo[4]=Kn,wo[5]=an,wo[6]=Vs,Ge=1}else Ge=0}Ge&&(Ge=(function(In,Ei){for(In.M=0;In.M<In.Va;++In.M){var Gn,en=In.Jc[In.M&In.Xb],Vt=In.m,lr=In;for(Gn=0;Gn<lr.za;++Gn){var Dn=Vt,di=lr,nr=di.Ac,gr=di.Bc+4*Gn,mr=di.zc,Ai=di.ya[di.aa+Gn];if(di.Qa.Bb?Ai.$b=Oe(Dn,di.Pa.jb[0])?2+Oe(Dn,di.Pa.jb[2]):Oe(Dn,di.Pa.jb[1]):Ai.$b=0,di.kc&&(Ai.Ad=Oe(Dn,di.Bd)),Ai.Za=!Oe(Dn,145)+0,Ai.Za){var yr=Ai.Ob,Hr=0;for(di=0;4>di;++di){var Vr,pi=mr[0+di];for(Vr=0;4>Vr;++Vr){pi=ra[nr[gr+Vr]][pi];for(var ai=ec[Oe(Dn,pi[0])];0<ai;)ai=ec[2*ai+Oe(Dn,pi[ai])];pi=-ai,nr[gr+Vr]=pi}n(yr,Hr,nr,gr,4),Hr+=4,mr[0+di]=pi}}else pi=Oe(Dn,156)?Oe(Dn,128)?1:3:Oe(Dn,163)?2:0,Ai.Ob[0]=pi,r(nr,gr,pi,4),r(mr,0,pi,4);Ai.Dd=Oe(Dn,142)?Oe(Dn,114)?Oe(Dn,183)?1:3:2:0}if(lr.m.Ka)return Wn(In,7,"Premature end-of-partition0 encountered.");for(;In.ja<In.za;++In.ja){if(lr=en,Dn=(Vt=In).rb[Vt.sb-1],nr=Vt.rb[Vt.sb+Vt.ja],Gn=Vt.ya[Vt.aa+Vt.ja],gr=Vt.kc?Gn.Ad:0)Dn.la=nr.la=0,Gn.Za||(Dn.Na=nr.Na=0),Gn.Hc=0,Gn.Gc=0,Gn.ia=0;else{var Tr,Gi;if(Dn=nr,nr=lr,gr=Vt.Pa.Xc,mr=Vt.ya[Vt.aa+Vt.ja],Ai=Vt.pb[mr.$b],di=mr.ad,yr=0,Hr=Vt.rb[Vt.sb-1],pi=Vr=0,r(di,yr,0,384),mr.Za)var Cs=0,Er=gr[3];else{ai=o(16);var Yi=Dn.Na+Hr.Na;if(Yi=Ds(nr,gr[1],Yi,Ai.Eb,0,ai,0),Dn.Na=Hr.Na=(0<Yi)+0,1<Yi)Ia(ai,0,di,yr);else{var es=ai[0]+3>>3;for(ai=0;256>ai;ai+=16)di[yr+ai]=es}Cs=1,Er=gr[0]}var Ii=15&Dn.la,Mr=15&Hr.la;for(ai=0;4>ai;++ai){var ts=1&Mr;for(es=Gi=0;4>es;++es)Ii=Ii>>1|(ts=(Yi=Ds(nr,Er,Yi=ts+(1&Ii),Ai.Sc,Cs,di,yr))>Cs)<<7,Gi=Gi<<2|(3<Yi?3:1<Yi?2:di[yr+0]!=0),yr+=16;Ii>>=4,Mr=Mr>>1|ts<<7,Vr=(Vr<<8|Gi)>>>0}for(Er=Ii,Cs=Mr>>4,Tr=0;4>Tr;Tr+=2){for(Gi=0,Ii=Dn.la>>4+Tr,Mr=Hr.la>>4+Tr,ai=0;2>ai;++ai){for(ts=1&Mr,es=0;2>es;++es)Yi=ts+(1&Ii),Ii=Ii>>1|(ts=0<(Yi=Ds(nr,gr[2],Yi,Ai.Qc,0,di,yr)))<<3,Gi=Gi<<2|(3<Yi?3:1<Yi?2:di[yr+0]!=0),yr+=16;Ii>>=2,Mr=Mr>>1|ts<<5}pi|=Gi<<4*Tr,Er|=Ii<<4<<Tr,Cs|=(240&Mr)<<Tr}Dn.la=Er,Hr.la=Cs,mr.Hc=Vr,mr.Gc=pi,mr.ia=43690&pi?0:Ai.ia,gr=!(Vr|pi)}if(0<Vt.L&&(Vt.wa[Vt.Y+Vt.ja]=Vt.gd[Gn.$b][Gn.Za],Vt.wa[Vt.Y+Vt.ja].La|=!gr),lr.Ka)return Wn(In,7,"Premature end-of-file encountered.")}if(ea(In),Vt=Ei,lr=1,Gn=(en=In).D,Dn=0<en.L&&en.M>=en.zb&&en.M<=en.Va,en.Aa==0)t:{if(Gn.M=en.M,Gn.uc=Dn,ya(en,Gn),lr=1,Gn=(Gi=en.D).Nb,Dn=(pi=sa[en.L])*en.R,nr=pi/2*en.B,ai=16*Gn*en.R,es=8*Gn*en.B,gr=en.sa,mr=en.ta-Dn+ai,Ai=en.qa,di=en.ra-nr+es,yr=en.Ha,Hr=en.Ia-nr+es,Mr=(Ii=Gi.M)==0,Vr=Ii>=en.Va-1,en.Aa==2&&ya(en,Gi),Gi.uc)for(ts=(Yi=en).D.M,e(Yi.D.uc),Gi=Yi.yb;Gi<Yi.Hb;++Gi){Cs=Gi,Er=ts;var xr=(qi=(ds=Yi).D).Nb;Tr=ds.R;var qi=qi.wa[qi.Y+Cs],Ls=ds.sa,ns=ds.ta+16*xr*Tr+16*Cs,Nn=qi.dd,En=qi.tc;if(En!=0)if(e(3<=En),ds.L==1)0<Cs&&Kl(Ls,ns,Tr,En+4),qi.La&&to(Ls,ns,Tr,En),0<Er&&Pl(Ls,ns,Tr,En+4),qi.La&&El(Ls,ns,Tr,En);else{var Wi=ds.B,aa=ds.qa,oa=ds.ra+8*xr*Wi+8*Cs,Ms=ds.Ha,ds=ds.Ia+8*xr*Wi+8*Cs;xr=qi.ld,0<Cs&&(ps(Ls,ns,Tr,En+4,Nn,xr),dl(aa,oa,Ms,ds,Wi,En+4,Nn,xr)),qi.La&&(wa(Ls,ns,Tr,En,Nn,xr),ul(aa,oa,Ms,ds,Wi,En,Nn,xr)),0<Er&&(Nr(Ls,ns,Tr,En+4,Nn,xr),jl(aa,oa,Ms,ds,Wi,En+4,Nn,xr)),qi.La&&(gs(Ls,ns,Tr,En,Nn,xr),Nl(aa,oa,Ms,ds,Wi,En,Nn,xr))}}if(en.ia&&alert("todo:DitherRow"),Vt.put!=null){if(Gi=16*Ii,Ii=16*(Ii+1),Mr?(Vt.y=en.sa,Vt.O=en.ta+ai,Vt.f=en.qa,Vt.N=en.ra+es,Vt.ea=en.Ha,Vt.W=en.Ia+es):(Gi-=pi,Vt.y=gr,Vt.O=mr,Vt.f=Ai,Vt.N=di,Vt.ea=yr,Vt.W=Hr),Vr||(Ii-=pi),Ii>Vt.o&&(Ii=Vt.o),Vt.F=null,Vt.J=null,en.Fa!=null&&0<en.Fa.length&&Gi<Ii&&(Vt.J=Qi(en,Vt,Gi,Ii-Gi),Vt.F=en.mb,Vt.F==null&&Vt.F.length==0)){lr=Wn(en,3,"Could not decode alpha data.");break t}Gi<Vt.j&&(pi=Vt.j-Gi,Gi=Vt.j,e(!(1&pi)),Vt.O+=en.R*pi,Vt.N+=en.B*(pi>>1),Vt.W+=en.B*(pi>>1),Vt.F!=null&&(Vt.J+=Vt.width*pi)),Gi<Ii&&(Vt.O+=Vt.v,Vt.N+=Vt.v>>1,Vt.W+=Vt.v>>1,Vt.F!=null&&(Vt.J+=Vt.v),Vt.ka=Gi-Vt.j,Vt.U=Vt.va-Vt.v,Vt.T=Ii-Gi,lr=Vt.put(Vt))}Gn+1!=en.Ic||Vr||(n(en.sa,en.ta-Dn,gr,mr+16*en.R,Dn),n(en.qa,en.ra-nr,Ai,di+8*en.B,nr),n(en.Ha,en.Ia-nr,yr,Hr+8*en.B,nr))}if(!lr)return Wn(In,6,"Output aborted.")}return 1})(ke,qe)),qe.bc!=null&&qe.bc(qe),Ge&=1}return Ge?(ke.cb=0,Ge):0})(x,F)||(S=x.a)}}else S=x.a}S==0&&ce.Oa!=null&&ce.Oa.fd&&(S=ll(ce.ba))}ce=S}ae=ce!=0?null:11>ae?me.f.RGBA.eb:me.f.kb.y}else ae=null;return ae};var Ha=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function f(O,Y){for(var W="",I=0;I<4;I++)W+=String.fromCharCode(O[Y++]);return W}function m(O,Y){return O[Y+0]|O[Y+1]<<8}function y(O,Y){return(O[Y+0]|O[Y+1]<<8|O[Y+2]<<16)>>>0}function A(O,Y){return(O[Y+0]|O[Y+1]<<8|O[Y+2]<<16|O[Y+3]<<24)>>>0}new h;var v=[0],N=[0],T=[],_=new h,b=s,H=(function(O,Y){var W={},I=0,J=!1,Z=0,Ce=0;if(W.frames=[],!(function(L,Q){for(var ee=0;ee<4;ee++)if(L[Q+ee]!="RIFF".charCodeAt(ee))return!0;return!1})(O,Y)){for(A(O,Y+=4),Y+=8;Y<O.length;){var ie=f(O,Y),le=A(O,Y+=4);Y+=4;var se=le+(1&le);switch(ie){case"VP8 ":case"VP8L":W.frames[I]===void 0&&(W.frames[I]={}),(E=W.frames[I]).src_off=J?Ce:Y-8,E.src_size=Z+le+8,I++,J&&(J=!1,Z=0,Ce=0);break;case"VP8X":(E=W.header={}).feature_flags=O[Y];var Ae=Y+4;E.canvas_width=1+y(O,Ae),Ae+=3,E.canvas_height=1+y(O,Ae),Ae+=3;break;case"ALPH":J=!0,Z=se+8,Ce=Y-8;break;case"ANIM":(E=W.header).bgcolor=A(O,Y),Ae=Y+4,E.loop_count=m(O,Ae),Ae+=2;break;case"ANMF":var ue,E;(E=W.frames[I]={}).offset_x=2*y(O,Y),Y+=3,E.offset_y=2*y(O,Y),Y+=3,E.width=1+y(O,Y),Y+=3,E.height=1+y(O,Y),Y+=3,E.duration=y(O,Y),Y+=3,ue=O[Y++],E.dispose=1&ue,E.blend=ue>>1&1}ie!="ANMF"&&(Y+=se)}return W}})(b,0);H.response=b,H.rgbaoutput=!0,H.dataurl=!1;var R=H.header?H.header:null,M=H.frames?H.frames:null;if(R){R.loop_counter=R.loop_count,v=[R.canvas_height],N=[R.canvas_width];for(var B=0;B<M.length&&M[B].blend!=0;B++);}var q=M[0],G=_.WebPDecodeRGBA(b,q.src_off,q.src_size,N,v);q.rgba=G,q.imgwidth=N[0],q.imgheight=v[0];for(var X=0;X<N[0]*v[0]*4;X++)T[X]=G[X];return this.width=N,this.height=v,this.data=T,this}(function(s){var e,t,n,r,o,d,c,h,f,m=function(L){return L=L||{},this.isStrokeTransparent=L.isStrokeTransparent||!1,this.strokeOpacity=L.strokeOpacity||1,this.strokeStyle=L.strokeStyle||"#000000",this.fillStyle=L.fillStyle||"#000000",this.isFillTransparent=L.isFillTransparent||!1,this.fillOpacity=L.fillOpacity||1,this.font=L.font||"10px sans-serif",this.textBaseline=L.textBaseline||"alphabetic",this.textAlign=L.textAlign||"left",this.lineWidth=L.lineWidth||1,this.lineJoin=L.lineJoin||"miter",this.lineCap=L.lineCap||"butt",this.path=L.path||[],this.transform=L.transform!==void 0?L.transform.clone():new h,this.globalCompositeOperation=L.globalCompositeOperation||"normal",this.globalAlpha=L.globalAlpha||1,this.clip_path=L.clip_path||[],this.currentPoint=L.currentPoint||new d,this.miterLimit=L.miterLimit||10,this.lastPoint=L.lastPoint||new d,this.lineDashOffset=L.lineDashOffset||0,this.lineDash=L.lineDash||[],this.margin=L.margin||[0,0,0,0],this.prevPageLastElemOffset=L.prevPageLastElemOffset||0,this.ignoreClearRect=typeof L.ignoreClearRect!="boolean"||L.ignoreClearRect,this};s.events.push(["initialized",function(){this.context2d=new y(this),e=this.internal.f2,t=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,r=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,d=this.internal.Point,c=this.internal.Rectangle,h=this.internal.Matrix,f=new m}]);var y=function(L){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Q=L;Object.defineProperty(this,"pdf",{get:function(){return Q}});var ee=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return ee},set:function(K){ee=!!K}});var oe=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return oe},set:function(K){oe=!!K}});var xe=0;Object.defineProperty(this,"posX",{get:function(){return xe},set:function(K){isNaN(K)||(xe=K)}});var re=0;Object.defineProperty(this,"posY",{get:function(){return re},set:function(K){isNaN(K)||(re=K)}}),Object.defineProperty(this,"margin",{get:function(){return f.margin},set:function(K){var jt;typeof K=="number"?jt=[K,K,K,K]:((jt=new Array(4))[0]=K[0],jt[1]=K.length>=2?K[1]:jt[0],jt[2]=K.length>=3?K[2]:jt[0],jt[3]=K.length>=4?K[3]:jt[1]),f.margin=jt}});var Le=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Le},set:function(K){Le=K}});var Ee=0;Object.defineProperty(this,"lastBreak",{get:function(){return Ee},set:function(K){Ee=K}});var Oe=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Oe},set:function(K){Oe=K}}),Object.defineProperty(this,"ctx",{get:function(){return f},set:function(K){K instanceof m&&(f=K)}}),Object.defineProperty(this,"path",{get:function(){return f.path},set:function(K){f.path=K}});var Ze=[];Object.defineProperty(this,"ctxStack",{get:function(){return Ze},set:function(K){Ze=K}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(K){var jt;jt=A(K),this.ctx.fillStyle=jt.style,this.ctx.isFillTransparent=jt.a===0,this.ctx.fillOpacity=jt.a,this.pdf.setFillColor(jt.r,jt.g,jt.b,{a:jt.a}),this.pdf.setTextColor(jt.r,jt.g,jt.b,{a:jt.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(K){var jt=A(K);this.ctx.strokeStyle=jt.style,this.ctx.isStrokeTransparent=jt.a===0,this.ctx.strokeOpacity=jt.a,jt.a===0?this.pdf.setDrawColor(255,255,255):(jt.a,this.pdf.setDrawColor(jt.r,jt.g,jt.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(K){["butt","round","square"].indexOf(K)!==-1&&(this.ctx.lineCap=K,this.pdf.setLineCap(K))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(K){isNaN(K)||(this.ctx.lineWidth=K,this.pdf.setLineWidth(K))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(K){["bevel","round","miter"].indexOf(K)!==-1&&(this.ctx.lineJoin=K,this.pdf.setLineJoin(K))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(K){isNaN(K)||(this.ctx.miterLimit=K,this.pdf.setMiterLimit(K))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(K){this.ctx.textBaseline=K}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(K){["right","end","center","left","start"].indexOf(K)!==-1&&(this.ctx.textAlign=K)}});var st=null,mt=null,Mt=null;Object.defineProperty(this,"fontFaces",{get:function(){return Mt},set:function(K){st=null,mt=null,Mt=K}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(K){var jt;if(this.ctx.font=K,(jt=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(K))!==null){var $t=jt[1];jt[2];var Yt=jt[3],yt=jt[4];jt[5];var on=jt[6],ze=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(yt)[2];yt=Math.floor(ze==="px"?parseFloat(yt)*this.pdf.internal.scaleFactor:ze==="em"?parseFloat(yt)*this.pdf.getFontSize():parseFloat(yt)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(yt);var Ne=(function(Bt){var Ln,Kt,rn=[],un=Bt.trim();if(un==="")return jm;if(un in lb)return[lb[un]];for(;un!=="";){switch(Kt=null,Ln=(un=db(un)).charAt(0)){case'"':case"'":Kt=$A(un.substring(1),Ln);break;default:Kt=GA(un)}if(Kt===null||(rn.push(Kt[0]),(un=db(Kt[1]))!==""&&un.charAt(0)!==","))return jm;un=un.replace(/^,/,"")}return rn})(on);if(this.fontFaces){var Ct=(function(Bt,Ln){var Kt=Bt.getFontList(),rn=JSON.stringify(Kt);if(st===null||mt!==rn){var un=(function(ot){var Zt=[];return Object.keys(ot).forEach(function(sn){ot[sn].forEach(function(Ft){var Jt=null;switch(Ft){case"bold":Jt={family:sn,weight:"bold"};break;case"italic":Jt={family:sn,style:"italic"};break;case"bolditalic":Jt={family:sn,weight:"bold",style:"italic"};break;case"":case"normal":Jt={family:sn}}Jt!==null&&(Jt.ref={name:sn,style:Ft},Zt.push(Jt))})}),Zt})(Kt);st=(function(ot){for(var Zt={},sn=0;sn<ot.length;++sn){var Ft=_m(ot[sn]),Jt=Ft.family,yn=Ft.stretch,_n=Ft.style,Qt=Ft.weight;Zt[Jt]=Zt[Jt]||{},Zt[Jt][yn]=Zt[Jt][yn]||{},Zt[Jt][yn][_n]=Zt[Jt][yn][_n]||{},Zt[Jt][yn][_n][Qt]=Ft}return Zt})(un.concat(Ln)),mt=rn}return st})(this.pdf,this.fontFaces),wt=Ne.map(function(Bt){return{family:Bt,stretch:"normal",weight:Yt,style:$t}}),it=(function(Bt,Ln,Kt){for(var rn=(Kt=Kt||{}).defaultFontFamily||"times",un=Object.assign({},WA,Kt.genericFontFamilies||{}),ot=null,Zt=null,sn=0;sn<Ln.length;++sn)if(un[(ot=_m(Ln[sn])).family]&&(ot.family=un[ot.family]),Bt.hasOwnProperty(ot.family)){Zt=Bt[ot.family];break}if(!(Zt=Zt||Bt[rn]))throw new Error("Could not find a font-family for the rule '"+cb(ot)+"' and default family '"+rn+"'.");if(Zt=(function(Ft,Jt){if(Jt[Ft])return Jt[Ft];var yn=ty[Ft],_n=yn<=ty.normal?-1:1,Qt=ob(Jt,Y2,yn,_n);if(!Qt)throw new Error("Could not find a matching font-stretch value for "+Ft);return Qt})(ot.stretch,Zt),Zt=(function(Ft,Jt){if(Jt[Ft])return Jt[Ft];for(var yn=G2[Ft],_n=0;_n<yn.length;++_n)if(Jt[yn[_n]])return Jt[yn[_n]];throw new Error("Could not find a matching font-style for "+Ft)})(ot.style,Zt),!(Zt=(function(Ft,Jt){if(Jt[Ft])return Jt[Ft];if(Ft===400&&Jt[500])return Jt[500];if(Ft===500&&Jt[400])return Jt[400];var yn=qA[Ft],_n=ob(Jt,X2,yn,Ft<400?-1:1);if(!_n)throw new Error("Could not find a matching font-weight for value "+Ft);return _n})(ot.weight,Zt)))throw new Error("Failed to resolve a font for the rule '"+cb(ot)+"'.");return Zt})(Ct,wt);this.pdf.setFont(it.ref.name,it.ref.style)}else{var pt="";(Yt==="bold"||parseInt(Yt,10)>=700||$t==="bold")&&(pt="bold"),$t==="italic"&&(pt+="italic"),pt.length===0&&(pt="normal");for(var Ot="",Qe={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},St=0;St<Ne.length;St++){if(this.pdf.internal.getFont(Ne[St],pt,{noFallback:!0,disableWarning:!0})!==void 0){Ot=Ne[St];break}if(pt==="bolditalic"&&this.pdf.internal.getFont(Ne[St],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Ot=Ne[St],pt="bold";else if(this.pdf.internal.getFont(Ne[St],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Ot=Ne[St],pt="normal";break}}if(Ot===""){for(var Wt=0;Wt<Ne.length;Wt++)if(Qe[Ne[Wt]]){Ot=Qe[Ne[Wt]];break}}Ot=Ot===""?"Times":Ot,this.pdf.setFont(Ot,pt)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(K){this.ctx.globalCompositeOperation=K}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(K){this.ctx.globalAlpha=K}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(K){this.ctx.lineDashOffset=K,E.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(K){this.ctx.lineDash=K,E.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(K){this.ctx.ignoreClearRect=!!K}})};y.prototype.setLineDash=function(L){this.lineDash=L},y.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},y.prototype.fill=function(){M.call(this,"fill",!1)},y.prototype.stroke=function(){M.call(this,"stroke",!1)},y.prototype.beginPath=function(){this.path=[{type:"begin"}]},y.prototype.moveTo=function(L,Q){if(isNaN(L)||isNaN(Q))throw rs.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var ee=this.ctx.transform.applyToPoint(new d(L,Q));this.path.push({type:"mt",x:ee.x,y:ee.y}),this.ctx.lastPoint=new d(L,Q)},y.prototype.closePath=function(){var L=new d(0,0),Q=0;for(Q=this.path.length-1;Q!==-1;Q--)if(this.path[Q].type==="begin"&&zr(this.path[Q+1])==="object"&&typeof this.path[Q+1].x=="number"){L=new d(this.path[Q+1].x,this.path[Q+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new d(L.x,L.y)},y.prototype.lineTo=function(L,Q){if(isNaN(L)||isNaN(Q))throw rs.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var ee=this.ctx.transform.applyToPoint(new d(L,Q));this.path.push({type:"lt",x:ee.x,y:ee.y}),this.ctx.lastPoint=new d(ee.x,ee.y)},y.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),M.call(this,null,!0)},y.prototype.quadraticCurveTo=function(L,Q,ee,oe){if(isNaN(ee)||isNaN(oe)||isNaN(L)||isNaN(Q))throw rs.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var xe=this.ctx.transform.applyToPoint(new d(ee,oe)),re=this.ctx.transform.applyToPoint(new d(L,Q));this.path.push({type:"qct",x1:re.x,y1:re.y,x:xe.x,y:xe.y}),this.ctx.lastPoint=new d(xe.x,xe.y)},y.prototype.bezierCurveTo=function(L,Q,ee,oe,xe,re){if(isNaN(xe)||isNaN(re)||isNaN(L)||isNaN(Q)||isNaN(ee)||isNaN(oe))throw rs.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Le=this.ctx.transform.applyToPoint(new d(xe,re)),Ee=this.ctx.transform.applyToPoint(new d(L,Q)),Oe=this.ctx.transform.applyToPoint(new d(ee,oe));this.path.push({type:"bct",x1:Ee.x,y1:Ee.y,x2:Oe.x,y2:Oe.y,x:Le.x,y:Le.y}),this.ctx.lastPoint=new d(Le.x,Le.y)},y.prototype.arc=function(L,Q,ee,oe,xe,re){if(isNaN(L)||isNaN(Q)||isNaN(ee)||isNaN(oe)||isNaN(xe))throw rs.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(re=!!re,!this.ctx.transform.isIdentity){var Le=this.ctx.transform.applyToPoint(new d(L,Q));L=Le.x,Q=Le.y;var Ee=this.ctx.transform.applyToPoint(new d(0,ee)),Oe=this.ctx.transform.applyToPoint(new d(0,0));ee=Math.sqrt(Math.pow(Ee.x-Oe.x,2)+Math.pow(Ee.y-Oe.y,2))}Math.abs(xe-oe)>=2*Math.PI&&(oe=0,xe=2*Math.PI),this.path.push({type:"arc",x:L,y:Q,radius:ee,startAngle:oe,endAngle:xe,counterclockwise:re})},y.prototype.arcTo=function(L,Q,ee,oe,xe){throw new Error("arcTo not implemented.")},y.prototype.rect=function(L,Q,ee,oe){if(isNaN(L)||isNaN(Q)||isNaN(ee)||isNaN(oe))throw rs.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(L,Q),this.lineTo(L+ee,Q),this.lineTo(L+ee,Q+oe),this.lineTo(L,Q+oe),this.lineTo(L,Q),this.lineTo(L+ee,Q),this.lineTo(L,Q)},y.prototype.fillRect=function(L,Q,ee,oe){if(isNaN(L)||isNaN(Q)||isNaN(ee)||isNaN(oe))throw rs.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!v.call(this)){var xe={};this.lineCap!=="butt"&&(xe.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(xe.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(L,Q,ee,oe),this.fill(),xe.hasOwnProperty("lineCap")&&(this.lineCap=xe.lineCap),xe.hasOwnProperty("lineJoin")&&(this.lineJoin=xe.lineJoin)}},y.prototype.strokeRect=function(L,Q,ee,oe){if(isNaN(L)||isNaN(Q)||isNaN(ee)||isNaN(oe))throw rs.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");N.call(this)||(this.beginPath(),this.rect(L,Q,ee,oe),this.stroke())},y.prototype.clearRect=function(L,Q,ee,oe){if(isNaN(L)||isNaN(Q)||isNaN(ee)||isNaN(oe))throw rs.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(L,Q,ee,oe))},y.prototype.save=function(L){L=typeof L!="boolean"||L;for(var Q=this.pdf.internal.getCurrentPageInfo().pageNumber,ee=0;ee<this.pdf.internal.getNumberOfPages();ee++)this.pdf.setPage(ee+1),this.pdf.internal.out("q");if(this.pdf.setPage(Q),L){this.ctx.fontSize=this.pdf.internal.getFontSize();var oe=new m(this.ctx);this.ctxStack.push(this.ctx),this.ctx=oe}},y.prototype.restore=function(L){L=typeof L!="boolean"||L;for(var Q=this.pdf.internal.getCurrentPageInfo().pageNumber,ee=0;ee<this.pdf.internal.getNumberOfPages();ee++)this.pdf.setPage(ee+1),this.pdf.internal.out("Q");this.pdf.setPage(Q),L&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},y.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var A=function(L){var Q,ee,oe,xe;if(L.isCanvasGradient===!0&&(L=L.getColor()),!L)return{r:0,g:0,b:0,a:0,style:L};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(L))Q=0,ee=0,oe=0,xe=0;else{var re=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(L);if(re!==null)Q=parseInt(re[1]),ee=parseInt(re[2]),oe=parseInt(re[3]),xe=1;else if((re=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(L))!==null)Q=parseInt(re[1]),ee=parseInt(re[2]),oe=parseInt(re[3]),xe=parseFloat(re[4]);else{if(xe=1,typeof L=="string"&&L.charAt(0)!=="#"){var Le=new O2(L);L=Le.ok?Le.toHex():"#000000"}L.length===4?(Q=L.substring(1,2),Q+=Q,ee=L.substring(2,3),ee+=ee,oe=L.substring(3,4),oe+=oe):(Q=L.substring(1,3),ee=L.substring(3,5),oe=L.substring(5,7)),Q=parseInt(Q,16),ee=parseInt(ee,16),oe=parseInt(oe,16)}}return{r:Q,g:ee,b:oe,a:xe,style:L}},v=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},N=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};y.prototype.fillText=function(L,Q,ee,oe){if(isNaN(Q)||isNaN(ee)||typeof L!="string")throw rs.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(oe=isNaN(oe)?void 0:oe,!v.call(this)){var xe=se(this.ctx.transform.rotation),re=this.ctx.transform.scaleX;I.call(this,{text:L,x:Q,y:ee,scale:re,angle:xe,align:this.textAlign,maxWidth:oe})}},y.prototype.strokeText=function(L,Q,ee,oe){if(isNaN(Q)||isNaN(ee)||typeof L!="string")throw rs.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!N.call(this)){oe=isNaN(oe)?void 0:oe;var xe=se(this.ctx.transform.rotation),re=this.ctx.transform.scaleX;I.call(this,{text:L,x:Q,y:ee,scale:re,renderingMode:"stroke",angle:xe,align:this.textAlign,maxWidth:oe})}},y.prototype.measureText=function(L){if(typeof L!="string")throw rs.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Q=this.pdf,ee=this.pdf.internal.scaleFactor,oe=Q.internal.getFontSize(),xe=Q.getStringUnitWidth(L)*oe/Q.internal.scaleFactor;return new function(re){var Le=(re=re||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return Le}}),this}({width:xe*=Math.round(96*ee/72*1e4)/1e4})},y.prototype.scale=function(L,Q){if(isNaN(L)||isNaN(Q))throw rs.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var ee=new h(L,0,0,Q,0,0);this.ctx.transform=this.ctx.transform.multiply(ee)},y.prototype.rotate=function(L){if(isNaN(L))throw rs.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Q=new h(Math.cos(L),Math.sin(L),-Math.sin(L),Math.cos(L),0,0);this.ctx.transform=this.ctx.transform.multiply(Q)},y.prototype.translate=function(L,Q){if(isNaN(L)||isNaN(Q))throw rs.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var ee=new h(1,0,0,1,L,Q);this.ctx.transform=this.ctx.transform.multiply(ee)},y.prototype.transform=function(L,Q,ee,oe,xe,re){if(isNaN(L)||isNaN(Q)||isNaN(ee)||isNaN(oe)||isNaN(xe)||isNaN(re))throw rs.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Le=new h(L,Q,ee,oe,xe,re);this.ctx.transform=this.ctx.transform.multiply(Le)},y.prototype.setTransform=function(L,Q,ee,oe,xe,re){L=isNaN(L)?1:L,Q=isNaN(Q)?0:Q,ee=isNaN(ee)?0:ee,oe=isNaN(oe)?1:oe,xe=isNaN(xe)?0:xe,re=isNaN(re)?0:re,this.ctx.transform=new h(L,Q,ee,oe,xe,re)};var T=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};y.prototype.drawImage=function(L,Q,ee,oe,xe,re,Le,Ee,Oe){var Ze=this.pdf.getImageProperties(L),st=1,mt=1,Mt=1,K=1;oe!==void 0&&Ee!==void 0&&(Mt=Ee/oe,K=Oe/xe,st=Ze.width/oe*Ee/oe,mt=Ze.height/xe*Oe/xe),re===void 0&&(re=Q,Le=ee,Q=0,ee=0),oe!==void 0&&Ee===void 0&&(Ee=oe,Oe=xe),oe===void 0&&Ee===void 0&&(Ee=Ze.width,Oe=Ze.height);var jt=this.ctx.transform.decompose(),$t=se(jt.rotate.shx),Yt=new h,yt=(Yt=(Yt=(Yt=Yt.multiply(jt.translate)).multiply(jt.skew)).multiply(jt.scale)).applyToRectangle(new c(re-Q*Mt,Le-ee*K,oe*st,xe*mt));if(this.autoPaging){for(var on,ze=_.call(this,yt),Ne=[],Ct=0;Ct<ze.length;Ct+=1)Ne.indexOf(ze[Ct])===-1&&Ne.push(ze[Ct]);R(Ne);for(var wt=Ne[0],it=Ne[Ne.length-1],pt=wt;pt<it+1;pt++){this.pdf.setPage(pt);var Ot=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Qe=pt===1?this.posY+this.margin[0]:this.margin[0],St=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Wt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Bt=pt===1?0:St+(pt-2)*Wt;if(this.ctx.clip_path.length!==0){var Ln=this.path;on=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=H(on,this.posX+this.margin[3],-Bt+Qe+this.ctx.prevPageLastElemOffset),B.call(this,"fill",!0),this.path=Ln}var Kt=JSON.parse(JSON.stringify(yt));Kt=H([Kt],this.posX+this.margin[3],-Bt+Qe+this.ctx.prevPageLastElemOffset)[0];var rn=(pt>wt||pt<it)&&T.call(this);rn&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ot,Wt,null).clip().discardPath()),this.pdf.addImage(L,"JPEG",Kt.x,Kt.y,Kt.w,Kt.h,null,null,$t),rn&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(L,"JPEG",yt.x,yt.y,yt.w,yt.h,null,null,$t)};var _=function(L,Q,ee){var oe=[];Q=Q||this.pdf.internal.pageSize.width,ee=ee||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var xe=this.posY+this.ctx.prevPageLastElemOffset;switch(L.type){default:case"mt":case"lt":oe.push(Math.floor((L.y+xe)/ee)+1);break;case"arc":oe.push(Math.floor((L.y+xe-L.radius)/ee)+1),oe.push(Math.floor((L.y+xe+L.radius)/ee)+1);break;case"qct":var re=Ae(this.ctx.lastPoint.x,this.ctx.lastPoint.y,L.x1,L.y1,L.x,L.y);oe.push(Math.floor((re.y+xe)/ee)+1),oe.push(Math.floor((re.y+re.h+xe)/ee)+1);break;case"bct":var Le=ue(this.ctx.lastPoint.x,this.ctx.lastPoint.y,L.x1,L.y1,L.x2,L.y2,L.x,L.y);oe.push(Math.floor((Le.y+xe)/ee)+1),oe.push(Math.floor((Le.y+Le.h+xe)/ee)+1);break;case"rect":oe.push(Math.floor((L.y+xe)/ee)+1),oe.push(Math.floor((L.y+L.h+xe)/ee)+1)}for(var Ee=0;Ee<oe.length;Ee+=1)for(;this.pdf.internal.getNumberOfPages()<oe[Ee];)b.call(this);return oe},b=function(){var L=this.fillStyle,Q=this.strokeStyle,ee=this.font,oe=this.lineCap,xe=this.lineWidth,re=this.lineJoin;this.pdf.addPage(),this.fillStyle=L,this.strokeStyle=Q,this.font=ee,this.lineCap=oe,this.lineWidth=xe,this.lineJoin=re},H=function(L,Q,ee){for(var oe=0;oe<L.length;oe++)switch(L[oe].type){case"bct":L[oe].x2+=Q,L[oe].y2+=ee;case"qct":L[oe].x1+=Q,L[oe].y1+=ee;default:L[oe].x+=Q,L[oe].y+=ee}return L},R=function(L){return L.sort(function(Q,ee){return Q-ee})},M=function(L,Q){var ee=this.fillStyle,oe=this.strokeStyle,xe=this.lineCap,re=this.lineWidth,Le=Math.abs(re*this.ctx.transform.scaleX),Ee=this.lineJoin;if(this.autoPaging){for(var Oe,Ze,st=JSON.parse(JSON.stringify(this.path)),mt=JSON.parse(JSON.stringify(this.path)),Mt=[],K=0;K<mt.length;K++)if(mt[K].x!==void 0)for(var jt=_.call(this,mt[K]),$t=0;$t<jt.length;$t+=1)Mt.indexOf(jt[$t])===-1&&Mt.push(jt[$t]);for(var Yt=0;Yt<Mt.length;Yt++)for(;this.pdf.internal.getNumberOfPages()<Mt[Yt];)b.call(this);R(Mt);for(var yt=Mt[0],on=Mt[Mt.length-1],ze=yt;ze<on+1;ze++){this.pdf.setPage(ze),this.fillStyle=ee,this.strokeStyle=oe,this.lineCap=xe,this.lineWidth=Le,this.lineJoin=Ee;var Ne=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Ct=ze===1?this.posY+this.margin[0]:this.margin[0],wt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],it=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],pt=ze===1?0:wt+(ze-2)*it;if(this.ctx.clip_path.length!==0){var Ot=this.path;Oe=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=H(Oe,this.posX+this.margin[3],-pt+Ct+this.ctx.prevPageLastElemOffset),B.call(this,L,!0),this.path=Ot}if(Ze=JSON.parse(JSON.stringify(st)),this.path=H(Ze,this.posX+this.margin[3],-pt+Ct+this.ctx.prevPageLastElemOffset),Q===!1||ze===0){var Qe=(ze>yt||ze<on)&&T.call(this);Qe&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ne,it,null).clip().discardPath()),B.call(this,L,Q),Qe&&this.pdf.restoreGraphicsState()}this.lineWidth=re}this.path=st}else this.lineWidth=Le,B.call(this,L,Q),this.lineWidth=re},B=function(L,Q){if((L!=="stroke"||Q||!N.call(this))&&(L==="stroke"||Q||!v.call(this))){for(var ee,oe,xe=[],re=this.path,Le=0;Le<re.length;Le++){var Ee=re[Le];switch(Ee.type){case"begin":xe.push({begin:!0});break;case"close":xe.push({close:!0});break;case"mt":xe.push({start:Ee,deltas:[],abs:[]});break;case"lt":var Oe=xe.length;if(re[Le-1]&&!isNaN(re[Le-1].x)&&(ee=[Ee.x-re[Le-1].x,Ee.y-re[Le-1].y],Oe>0)){for(;Oe>=0;Oe--)if(xe[Oe-1].close!==!0&&xe[Oe-1].begin!==!0){xe[Oe-1].deltas.push(ee),xe[Oe-1].abs.push(Ee);break}}break;case"bct":ee=[Ee.x1-re[Le-1].x,Ee.y1-re[Le-1].y,Ee.x2-re[Le-1].x,Ee.y2-re[Le-1].y,Ee.x-re[Le-1].x,Ee.y-re[Le-1].y],xe[xe.length-1].deltas.push(ee);break;case"qct":var Ze=re[Le-1].x+2/3*(Ee.x1-re[Le-1].x),st=re[Le-1].y+2/3*(Ee.y1-re[Le-1].y),mt=Ee.x+2/3*(Ee.x1-Ee.x),Mt=Ee.y+2/3*(Ee.y1-Ee.y),K=Ee.x,jt=Ee.y;ee=[Ze-re[Le-1].x,st-re[Le-1].y,mt-re[Le-1].x,Mt-re[Le-1].y,K-re[Le-1].x,jt-re[Le-1].y],xe[xe.length-1].deltas.push(ee);break;case"arc":xe.push({deltas:[],abs:[],arc:!0}),Array.isArray(xe[xe.length-1].abs)&&xe[xe.length-1].abs.push(Ee)}}oe=Q?null:L==="stroke"?"stroke":"fill";for(var $t=!1,Yt=0;Yt<xe.length;Yt++)if(xe[Yt].arc)for(var yt=xe[Yt].abs,on=0;on<yt.length;on++){var ze=yt[on];ze.type==="arc"?X.call(this,ze.x,ze.y,ze.radius,ze.startAngle,ze.endAngle,ze.counterclockwise,void 0,Q,!$t):J.call(this,ze.x,ze.y),$t=!0}else if(xe[Yt].close===!0)this.pdf.internal.out("h"),$t=!1;else if(xe[Yt].begin!==!0){var Ne=xe[Yt].start.x,Ct=xe[Yt].start.y;Z.call(this,xe[Yt].deltas,Ne,Ct),$t=!0}oe&&O.call(this,oe),Q&&Y.call(this)}},q=function(L){var Q=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,ee=Q*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return L-ee;case"top":return L+Q-ee;case"hanging":return L+Q-2*ee;case"middle":return L+Q/2-ee;default:return L}},G=function(L){return L+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};y.prototype.createLinearGradient=function(){var L=function(){};return L.colorStops=[],L.addColorStop=function(Q,ee){this.colorStops.push([Q,ee])},L.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},L.isCanvasGradient=!0,L},y.prototype.createPattern=function(){return this.createLinearGradient()},y.prototype.createRadialGradient=function(){return this.createLinearGradient()};var X=function(L,Q,ee,oe,xe,re,Le,Ee,Oe){for(var Ze=ie.call(this,ee,oe,xe,re),st=0;st<Ze.length;st++){var mt=Ze[st];st===0&&(Oe?W.call(this,mt.x1+L,mt.y1+Q):J.call(this,mt.x1+L,mt.y1+Q)),Ce.call(this,L,Q,mt.x2,mt.y2,mt.x3,mt.y3,mt.x4,mt.y4)}Ee?Y.call(this):O.call(this,Le)},O=function(L){switch(L){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},Y=function(){this.pdf.clip(),this.pdf.discardPath()},W=function(L,Q){this.pdf.internal.out(t(L)+" "+n(Q)+" m")},I=function(L){var Q;switch(L.align){case"right":case"end":Q="right";break;case"center":Q="center";break;default:Q="left"}var ee,oe,xe,re=this.pdf.getTextDimensions(L.text),Le=q.call(this,L.y),Ee=G.call(this,Le)-re.h,Oe=this.ctx.transform.applyToPoint(new d(L.x,Le));if(this.autoPaging){var Ze=this.ctx.transform.decompose(),st=new h;st=(st=(st=st.multiply(Ze.translate)).multiply(Ze.skew)).multiply(Ze.scale);for(var mt=this.ctx.transform.applyToRectangle(new c(L.x,Le,re.w,re.h)),Mt=st.applyToRectangle(new c(L.x,Ee,re.w,re.h)),K=_.call(this,Mt),jt=[],$t=0;$t<K.length;$t+=1)jt.indexOf(K[$t])===-1&&jt.push(K[$t]);R(jt);for(var Yt=jt[0],yt=jt[jt.length-1],on=Yt;on<yt+1;on++){this.pdf.setPage(on);var ze=on===1?this.posY+this.margin[0]:this.margin[0],Ne=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ct=this.pdf.internal.pageSize.height-this.margin[2],wt=Ct-this.margin[0],it=this.pdf.internal.pageSize.width-this.margin[1],pt=it-this.margin[3],Ot=on===1?0:Ne+(on-2)*wt;if(this.ctx.clip_path.length!==0){var Qe=this.path;ee=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=H(ee,this.posX+this.margin[3],-1*Ot+ze),B.call(this,"fill",!0),this.path=Qe}var St=H([JSON.parse(JSON.stringify(Mt))],this.posX+this.margin[3],-Ot+ze+this.ctx.prevPageLastElemOffset)[0];L.scale>=.01&&(oe=this.pdf.internal.getFontSize(),this.pdf.setFontSize(oe*L.scale),xe=this.lineWidth,this.lineWidth=xe*L.scale);var Wt=this.autoPaging!=="text";if(Wt||St.y+St.h<=Ct){if(Wt||St.y>=ze&&St.x<=it){var Bt=Wt?L.text:this.pdf.splitTextToSize(L.text,L.maxWidth||it-St.x)[0],Ln=H([JSON.parse(JSON.stringify(mt))],this.posX+this.margin[3],-Ot+ze+this.ctx.prevPageLastElemOffset)[0],Kt=Wt&&(on>Yt||on<yt)&&T.call(this);Kt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],pt,wt,null).clip().discardPath()),this.pdf.text(Bt,Ln.x,Ln.y,{angle:L.angle,align:Q,renderingMode:L.renderingMode}),Kt&&this.pdf.restoreGraphicsState()}}else St.y<Ct&&(this.ctx.prevPageLastElemOffset+=Ct-St.y);L.scale>=.01&&(this.pdf.setFontSize(oe),this.lineWidth=xe)}}else L.scale>=.01&&(oe=this.pdf.internal.getFontSize(),this.pdf.setFontSize(oe*L.scale),xe=this.lineWidth,this.lineWidth=xe*L.scale),this.pdf.text(L.text,Oe.x+this.posX,Oe.y+this.posY,{angle:L.angle,align:Q,renderingMode:L.renderingMode,maxWidth:L.maxWidth}),L.scale>=.01&&(this.pdf.setFontSize(oe),this.lineWidth=xe)},J=function(L,Q,ee,oe){ee=ee||0,oe=oe||0,this.pdf.internal.out(t(L+ee)+" "+n(Q+oe)+" l")},Z=function(L,Q,ee){return this.pdf.lines(L,Q,ee,null,null)},Ce=function(L,Q,ee,oe,xe,re,Le,Ee){this.pdf.internal.out([e(r(ee+L)),e(o(oe+Q)),e(r(xe+L)),e(o(re+Q)),e(r(Le+L)),e(o(Ee+Q)),"c"].join(" "))},ie=function(L,Q,ee,oe){for(var xe=2*Math.PI,re=Math.PI/2;Q>ee;)Q-=xe;var Le=Math.abs(ee-Q);Le<xe&&oe&&(Le=xe-Le);for(var Ee=[],Oe=oe?-1:1,Ze=Q;Le>1e-5;){var st=Ze+Oe*Math.min(Le,re);Ee.push(le.call(this,L,Ze,st)),Le-=Math.abs(st-Ze),Ze=st}return Ee},le=function(L,Q,ee){var oe=(ee-Q)/2,xe=L*Math.cos(oe),re=L*Math.sin(oe),Le=xe,Ee=-re,Oe=Le*Le+Ee*Ee,Ze=Oe+Le*xe+Ee*re,st=4/3*(Math.sqrt(2*Oe*Ze)-Ze)/(Le*re-Ee*xe),mt=Le-st*Ee,Mt=Ee+st*Le,K=mt,jt=-Mt,$t=oe+Q,Yt=Math.cos($t),yt=Math.sin($t);return{x1:L*Math.cos(Q),y1:L*Math.sin(Q),x2:mt*Yt-Mt*yt,y2:mt*yt+Mt*Yt,x3:K*Yt-jt*yt,y3:K*yt+jt*Yt,x4:L*Math.cos(ee),y4:L*Math.sin(ee)}},se=function(L){return 180*L/Math.PI},Ae=function(L,Q,ee,oe,xe,re){var Le=L+.5*(ee-L),Ee=Q+.5*(oe-Q),Oe=xe+.5*(ee-xe),Ze=re+.5*(oe-re),st=Math.min(L,xe,Le,Oe),mt=Math.max(L,xe,Le,Oe),Mt=Math.min(Q,re,Ee,Ze),K=Math.max(Q,re,Ee,Ze);return new c(st,Mt,mt-st,K-Mt)},ue=function(L,Q,ee,oe,xe,re,Le,Ee){var Oe,Ze,st,mt,Mt,K,jt,$t,Yt,yt,on,ze,Ne,Ct,wt=ee-L,it=oe-Q,pt=xe-ee,Ot=re-oe,Qe=Le-xe,St=Ee-re;for(Ze=0;Ze<41;Ze++)Yt=(jt=(st=L+(Oe=Ze/40)*wt)+Oe*((Mt=ee+Oe*pt)-st))+Oe*(Mt+Oe*(xe+Oe*Qe-Mt)-jt),yt=($t=(mt=Q+Oe*it)+Oe*((K=oe+Oe*Ot)-mt))+Oe*(K+Oe*(re+Oe*St-K)-$t),Ze==0?(on=Yt,ze=yt,Ne=Yt,Ct=yt):(on=Math.min(on,Yt),ze=Math.min(ze,yt),Ne=Math.max(Ne,Yt),Ct=Math.max(Ct,yt));return new c(Math.round(on),Math.round(ze),Math.round(Ne-on),Math.round(Ct-ze))},E=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var L,Q,ee=(L=this.ctx.lineDash,Q=this.ctx.lineDashOffset,JSON.stringify({lineDash:L,lineDashOffset:Q}));this.prevLineDash!==ee&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=ee)}}})(Mn.API),(function(s){var e=function(d){var c,h,f,m,y,A,v,N,T,_;for(h=[],f=0,m=(d+=c="\0\0\0\0".slice(d.length%4||4)).length;m>f;f+=4)(y=(d.charCodeAt(f)<<24)+(d.charCodeAt(f+1)<<16)+(d.charCodeAt(f+2)<<8)+d.charCodeAt(f+3))!==0?(A=(y=((y=((y=((y=(y-(_=y%85))/85)-(T=y%85))/85)-(N=y%85))/85)-(v=y%85))/85)%85,h.push(A+33,v+33,N+33,T+33,_+33)):h.push(122);return(function(b,H){for(var R=H;R>0;R--)b.pop()})(h,c.length),String.fromCharCode.apply(String,h)+"~>"},t=function(d){var c,h,f,m,y,A=String,v="length",N=255,T="charCodeAt",_="slice",b="replace";for(d[_](-2),d=d[_](0,-2)[b](/\s/g,"")[b]("z","!!!!!"),f=[],m=0,y=(d+=c="uuuuu"[_](d[v]%5||5))[v];y>m;m+=5)h=52200625*(d[T](m)-33)+614125*(d[T](m+1)-33)+7225*(d[T](m+2)-33)+85*(d[T](m+3)-33)+(d[T](m+4)-33),f.push(N&h>>24,N&h>>16,N&h>>8,N&h);return(function(H,R){for(var M=R;M>0;M--)H.pop()})(f,c[v]),A.fromCharCode.apply(A,f)},n=function(d){return d.split("").map(function(c){return("0"+c.charCodeAt().toString(16)).slice(-2)}).join("")+">"},r=function(d){var c=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((d=d.replace(/\s/g,"")).indexOf(">")!==-1&&(d=d.substr(0,d.indexOf(">"))),d.length%2&&(d+="0"),c.test(d)===!1)return"";for(var h="",f=0;f<d.length;f+=2)h+=String.fromCharCode("0x"+(d[f]+d[f+1]));return h},o=function(d){for(var c=new Uint8Array(d.length),h=d.length;h--;)c[h]=d.charCodeAt(h);return(c=Ym(c)).reduce(function(f,m){return f+String.fromCharCode(m)},"")};s.processDataByFilters=function(d,c){var h=0,f=d||"",m=[];for(typeof(c=c||[])=="string"&&(c=[c]),h=0;h<c.length;h+=1)switch(c[h]){case"ASCII85Decode":case"/ASCII85Decode":f=t(f),m.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":f=e(f),m.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":f=r(f),m.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":f=n(f),m.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":f=o(f),m.push("/FlateDecode");break;default:throw new Error('The filter: "'+c[h]+'" is not implemented')}return{data:f,reverseChain:m.reverse().join(" ")}}})(Mn.API),(function(s){s.loadFile=function(e,t,n){return(function(r,o,d){o=o!==!1,d=typeof d=="function"?d:function(){};var c=void 0;try{c=(function(h,f,m){var y=new XMLHttpRequest,A=0,v=function(N){var T=N.length,_=[],b=String.fromCharCode;for(A=0;A<T;A+=1)_.push(b(255&N.charCodeAt(A)));return _.join("")};if(y.open("GET",h,!f),y.overrideMimeType("text/plain; charset=x-user-defined"),f===!1&&(y.onload=function(){y.status===200?m(v(this.responseText)):m(void 0)}),y.send(null),f&&y.status===200)return v(y.responseText)})(r,o,d)}catch{}return c})(e,t,n)},s.loadImageFile=s.loadFile})(Mn.API),(function(s){function e(){return(oi.html2canvas?Promise.resolve(oi.html2canvas):cm(()=>import("./html2canvas.esm-B0tyYwQk.js"),[])).catch(function(c){return Promise.reject(new Error("Could not load html2canvas: "+c))}).then(function(c){return c.default?c.default:c})}function t(){return(oi.DOMPurify?Promise.resolve(oi.DOMPurify):cm(()=>import("./purify.es-B6FQ9oRL.js"),[])).catch(function(c){return Promise.reject(new Error("Could not load dompurify: "+c))}).then(function(c){return c.default?c.default:c})}var n=function(c){var h=zr(c);return h==="undefined"?"undefined":h==="string"||c instanceof String?"string":h==="number"||c instanceof Number?"number":h==="function"||c instanceof Function?"function":c&&c.constructor===Array?"array":c&&c.nodeType===1?"element":h==="object"?"object":"unknown"},r=function(c,h){var f=document.createElement(c);for(var m in h.className&&(f.className=h.className),h.innerHTML&&h.dompurify&&(f.innerHTML=h.dompurify.sanitize(h.innerHTML)),h.style)f.style[m]=h.style[m];return f},o=function c(h,f){for(var m=h.nodeType===3?document.createTextNode(h.nodeValue):h.cloneNode(!1),y=h.firstChild;y;y=y.nextSibling)f!==!0&&y.nodeType===1&&y.nodeName==="SCRIPT"||m.appendChild(c(y,f));return h.nodeType===1&&(h.nodeName==="CANVAS"?(m.width=h.width,m.height=h.height,m.getContext("2d").drawImage(h,0,0)):h.nodeName!=="TEXTAREA"&&h.nodeName!=="SELECT"||(m.value=h.value),m.addEventListener("load",function(){m.scrollTop=h.scrollTop,m.scrollLeft=h.scrollLeft},!0)),m},d=function c(h){var f=Object.assign(c.convert(Promise.resolve()),JSON.parse(JSON.stringify(c.template))),m=c.convert(Promise.resolve(),f);return(m=m.setProgress(1,c,1,[c])).set(h)};(d.prototype=Object.create(Promise.prototype)).constructor=d,d.convert=function(c,h){return c.__proto__=h||d.prototype,c},d.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},d.prototype.from=function(c,h){return this.then(function(){switch(h=h||(function(f){switch(n(f)){case"string":return"string";case"element":return f.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(c),h){case"string":return this.then(t).then(function(f){return this.set({src:r("div",{innerHTML:c,dompurify:f})})});case"element":return this.set({src:c});case"canvas":return this.set({canvas:c});case"img":return this.set({img:c});default:return this.error("Unknown source type.")}})},d.prototype.to=function(c){switch(c){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},d.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var c={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},h=o(this.prop.src,this.opt.html2canvas.javascriptEnabled);h.tagName==="BODY"&&(c.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=r("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=r("div",{className:"html2pdf__container",style:c}),this.prop.container.appendChild(h),this.prop.container.firstChild.appendChild(r("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},d.prototype.toCanvas=function(){var c=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(c).then(e).then(function(h){var f=Object.assign({},this.opt.html2canvas);return delete f.onrendered,h(this.prop.container,f)}).then(function(h){(this.opt.html2canvas.onrendered||function(){})(h),this.prop.canvas=h,document.body.removeChild(this.prop.overlay)})},d.prototype.toContext2d=function(){var c=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(c).then(e).then(function(h){var f=this.opt.jsPDF,m=this.opt.fontFaces,y=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,A=Object.assign({async:!0,allowTaint:!0,scale:y,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete A.onrendered,f.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,f.context2d.posX=this.opt.x,f.context2d.posY=this.opt.y,f.context2d.margin=this.opt.margin,f.context2d.fontFaces=m,m)for(var v=0;v<m.length;++v){var N=m[v],T=N.src.find(function(_){return _.format==="truetype"});T&&f.addFont(T.url,N.ref.name,N.ref.style)}return A.windowHeight=A.windowHeight||0,A.windowHeight=A.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):A.windowHeight,f.context2d.save(!0),h(this.prop.container,A)}).then(function(h){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(h),this.prop.canvas=h,document.body.removeChild(this.prop.overlay)})},d.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var c=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=c})},d.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},d.prototype.output=function(c,h,f){return(f=f||"pdf").toLowerCase()==="img"||f.toLowerCase()==="image"?this.outputImg(c,h):this.outputPdf(c,h)},d.prototype.outputPdf=function(c,h){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(c,h)})},d.prototype.outputImg=function(c){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(c){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+c+'" is not supported.'}})},d.prototype.save=function(c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(c?{filename:c}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},d.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},d.prototype.set=function(c){if(n(c)!=="object")return this;var h=Object.keys(c||{}).map(function(f){if(f in d.template.prop)return function(){this.prop[f]=c[f]};switch(f){case"margin":return this.setMargin.bind(this,c.margin);case"jsPDF":return function(){return this.opt.jsPDF=c.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,c.pageSize);default:return function(){this.opt[f]=c[f]}}},this);return this.then(function(){return this.thenList(h)})},d.prototype.get=function(c,h){return this.then(function(){var f=c in d.template.prop?this.prop[c]:this.opt[c];return h?h(f):f})},d.prototype.setMargin=function(c){return this.then(function(){switch(n(c)){case"number":c=[c,c,c,c];case"array":if(c.length===2&&(c=[c[0],c[1],c[0],c[1]]),c.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=c}).then(this.setPageSize)},d.prototype.setPageSize=function(c){function h(f,m){return Math.floor(f*m/72*96)}return this.then(function(){(c=c||Mn.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(c.inner={width:c.width-this.opt.margin[1]-this.opt.margin[3],height:c.height-this.opt.margin[0]-this.opt.margin[2]},c.inner.px={width:h(c.inner.width,c.k),height:h(c.inner.height,c.k)},c.inner.ratio=c.inner.height/c.inner.width),this.prop.pageSize=c})},d.prototype.setProgress=function(c,h,f,m){return c!=null&&(this.progress.val=c),h!=null&&(this.progress.state=h),f!=null&&(this.progress.n=f),m!=null&&(this.progress.stack=m),this.progress.ratio=this.progress.val/this.progress.state,this},d.prototype.updateProgress=function(c,h,f,m){return this.setProgress(c?this.progress.val+c:null,h||null,f?this.progress.n+f:null,m?this.progress.stack.concat(m):null)},d.prototype.then=function(c,h){var f=this;return this.thenCore(c,h,function(m,y){return f.updateProgress(null,null,1,[m]),Promise.prototype.then.call(this,function(A){return f.updateProgress(null,m),A}).then(m,y).then(function(A){return f.updateProgress(1),A})})},d.prototype.thenCore=function(c,h,f){f=f||Promise.prototype.then;var m=this;c&&(c=c.bind(m)),h&&(h=h.bind(m));var y=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?m:d.convert(Object.assign({},m),Promise.prototype),A=f.call(y,c,h);return d.convert(A,m.__proto__)},d.prototype.thenExternal=function(c,h){return Promise.prototype.then.call(this,c,h)},d.prototype.thenList=function(c){var h=this;return c.forEach(function(f){h=h.thenCore(f)}),h},d.prototype.catch=function(c){c&&(c=c.bind(this));var h=Promise.prototype.catch.call(this,c);return d.convert(h,this)},d.prototype.catchExternal=function(c){return Promise.prototype.catch.call(this,c)},d.prototype.error=function(c){return this.then(function(){throw new Error(c)})},d.prototype.using=d.prototype.set,d.prototype.saveAs=d.prototype.save,d.prototype.export=d.prototype.output,d.prototype.run=d.prototype.then,Mn.getPageSize=function(c,h,f){if(zr(c)==="object"){var m=c;c=m.orientation,h=m.unit||h,f=m.format||f}h=h||"mm",f=f||"a4",c=(""+(c||"P")).toLowerCase();var y,A=(""+f).toLowerCase(),v={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(h){case"pt":y=1;break;case"mm":y=72/25.4;break;case"cm":y=72/2.54;break;case"in":y=72;break;case"px":y=.75;break;case"pc":case"em":y=12;break;case"ex":y=6;break;default:throw"Invalid unit: "+h}var N,T=0,_=0;if(v.hasOwnProperty(A))T=v[A][1]/y,_=v[A][0]/y;else try{T=f[1],_=f[0]}catch{throw new Error("Invalid format: "+f)}if(c==="p"||c==="portrait")c="p",_>T&&(N=_,_=T,T=N);else{if(c!=="l"&&c!=="landscape")throw"Invalid orientation: "+c;c="l",T>_&&(N=_,_=T,T=N)}return{width:_,height:T,unit:h,k:y,orientation:c}},s.html=function(c,h){(h=h||{}).callback=h.callback||function(){},h.html2canvas=h.html2canvas||{},h.html2canvas.canvas=h.html2canvas.canvas||this.canvas,h.jsPDF=h.jsPDF||this,h.fontFaces=h.fontFaces?h.fontFaces.map(_m):null;var f=new d(h);return h.worker?f:f.from(c).doCallback()}})(Mn.API),Mn.API.addJS=function(s){return hb=s,this.internal.events.subscribe("postPutResources",function(){Eg=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Eg+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),ub=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+hb+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Eg!==void 0&&ub!==void 0&&this.internal.out("/Names <</JavaScript "+Eg+" 0 R>>")}),this},(function(s){var e;s.events.push(["postPutResources",function(){var t=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var r=t.outline.render().split(/\r\n/),o=0;o<r.length;o++){var d=r[o],c=n.exec(d);if(c!=null){var h=c[1];t.internal.newObjectDeferredBegin(h,!1)}t.internal.write(d)}if(this.outline.createNamedDestinations){var f=this.internal.pages.length,m=[];for(o=0;o<f;o++){var y=t.internal.newObject();m.push(y);var A=t.internal.getPageInfo(o+1);t.internal.write("<< /D["+A.objId+" 0 R /XYZ null null null]>> endobj")}var v=t.internal.newObject();for(t.internal.write("<< /Names [ "),o=0;o<m.length;o++)t.internal.write("(page_"+(o+1)+")"+m[o]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+v+" 0 R"),t.internal.write(">>","endobj")}}]),s.events.push(["putCatalog",function(){var t=this;t.outline.root.children.length>0&&(t.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&t.internal.write("/Names "+e+" 0 R"))}]),s.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(n,r,o){var d={title:r,options:o,children:[]};return n==null&&(n=this.root),n.children.push(d),d},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(n){n.id=t.internal.newObjectDeferred();for(var r=0;r<n.children.length;r++)this.genIds_r(n.children[r])},t.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},t.outline.renderItems=function(n){for(var r=this.ctx.pdf.internal.getVerticalCoordinateString,o=0;o<n.children.length;o++){var d=n.children[o];this.objStart(d),this.line("/Title "+this.makeString(d.title)),this.line("/Parent "+this.makeRef(n)),o>0&&this.line("/Prev "+this.makeRef(n.children[o-1])),o<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[o+1])),d.children.length>0&&(this.line("/First "+this.makeRef(d.children[0])),this.line("/Last "+this.makeRef(d.children[d.children.length-1])));var c=this.count=this.count_r({count:0},d);if(c>0&&this.line("/Count "+c),d.options&&d.options.pageNumber){var h=t.internal.getPageInfo(d.options.pageNumber);this.line("/Dest ["+h.objId+" 0 R /XYZ 0 "+r(0)+" 0]")}this.objEnd()}for(var f=0;f<n.children.length;f++)this.renderItems(n.children[f])},t.outline.line=function(n){this.ctx.val+=n+`\r
`},t.outline.makeRef=function(n){return n.id+" 0 R"},t.outline.makeString=function(n){return"("+t.internal.pdfEscape(n)+")"},t.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(n,r){for(var o=0;o<r.children.length;o++)n.count++,this.count_r(n,r.children[o]);return n.count}}])})(Mn.API),(function(s){var e=[192,193,194,195,196,197,198,199];s.processJPEG=function(t,n,r,o,d,c){var h,f=this.decode.DCT_DECODE,m=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=d||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,h=(function(y){for(var A,v=256*y.charCodeAt(4)+y.charCodeAt(5),N=y.length,T={width:0,height:0,numcomponents:1},_=4;_<N;_+=2){if(_+=v,e.indexOf(y.charCodeAt(_+1))!==-1){A=256*y.charCodeAt(_+5)+y.charCodeAt(_+6),T={width:256*y.charCodeAt(_+7)+y.charCodeAt(_+8),height:A,numcomponents:y.charCodeAt(_+9)};break}v=256*y.charCodeAt(_+2)+y.charCodeAt(_+3)}return T})(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t),h.numcomponents){case 1:c=this.color_spaces.DEVICE_GRAY;break;case 4:c=this.color_spaces.DEVICE_CMYK;break;case 3:c=this.color_spaces.DEVICE_RGB}m={data:t,width:h.width,height:h.height,colorSpace:c,bitsPerComponent:8,filter:f,index:n,alias:r}}return m}})(Mn.API),Mn.API.processPNG=function(s,e,t,n){if(this.__addimage__.isArrayBuffer(s)&&(s=new Uint8Array(s)),this.__addimage__.isArrayBufferView(s)){var r,o=PA(s,{checkCrc:!0}),d=o.width,c=o.height,h=o.channels,f=o.palette,m=o.depth;r=f&&h===1?(function(X){for(var O=X.width,Y=X.height,W=X.data,I=X.palette,J=X.depth,Z=!1,Ce=[],ie=[],le=void 0,se=!1,Ae=0,ue=0;ue<I.length;ue++){var E=mx(I[ue],4),L=E[0],Q=E[1],ee=E[2],oe=E[3];Ce.push(L,Q,ee),oe!=null&&(oe===0?(Ae++,ie.length<1&&ie.push(ue)):oe<255&&(se=!0))}if(se||Ae>1){Z=!0,ie=void 0;var xe=O*Y;le=new Uint8Array(xe);for(var re=new DataView(W.buffer),Le=0;Le<xe;Le++){var Ee=Nm(re,Le,J),Oe=mx(I[Ee],4)[3];le[Le]=Oe}}else Ae===0&&(ie=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:Z?8:void 0,colorBytes:W,alphaBytes:le,needSMask:Z,palette:Ce,mask:ie}})(o):h===2||h===4?(function(X){for(var O=X.data,Y=X.width,W=X.height,I=X.channels,J=X.depth,Z=I===2?"DeviceGray":"DeviceRGB",Ce=I-1,ie=Y*W,le=Ce,se=ie*le,Ae=1*ie,ue=Math.ceil(se*J/8),E=Math.ceil(Ae*J/8),L=new Uint8Array(ue),Q=new Uint8Array(E),ee=new DataView(O.buffer),oe=new DataView(L.buffer),xe=new DataView(Q.buffer),re=!1,Le=0;Le<ie;Le++){for(var Ee=Le*I,Oe=0;Oe<le;Oe++)wb(oe,Nm(ee,Ee+Oe,J),Le*le+Oe,J);var Ze=Nm(ee,Ee+le,J);Ze<(1<<J)-1&&(re=!0),wb(xe,Ze,1*Le,J)}return{colorSpace:Z,colorsPerPixel:Ce,sMaskBitsPerComponent:re?J:void 0,colorBytes:L,alphaBytes:Q,needSMask:re}})(o):(function(X){var O=X.data,Y=X.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:Y,colorsPerPixel:Y==="DeviceGray"?1:3,colorBytes:O instanceof Uint16Array?(function(W){for(var I=W.length,J=new Uint8Array(2*I),Z=new DataView(J.buffer,J.byteOffset,J.byteLength),Ce=0;Ce<I;Ce++)Z.setUint16(2*Ce,W[Ce],!1);return J})(O):O,needSMask:!1}})(o);var y,A,v,N=r,T=N.colorSpace,_=N.colorsPerPixel,b=N.sMaskBitsPerComponent,H=N.colorBytes,R=N.alphaBytes,M=N.needSMask,B=N.palette,q=N.mask,G=null;return n!==Mn.API.image_compression.NONE&&typeof Ym=="function"?(G=(function(X){var O;switch(X){case Mn.API.image_compression.FAST:O=11;break;case Mn.API.image_compression.MEDIUM:O=13;break;case Mn.API.image_compression.SLOW:O=14;break;default:O=12}return O})(n),y=this.decode.FLATE_DECODE,A="/Predictor ".concat(G," /Colors ").concat(_," /BitsPerComponent ").concat(m," /Columns ").concat(d),s=mb(H,Math.ceil(d*_*m/8),_,m,n),M&&(v=mb(R,Math.ceil(d*b/8),1,b,n))):(y=void 0,A=void 0,s=H,M&&(v=R)),(this.__addimage__.isArrayBuffer(s)||this.__addimage__.isArrayBufferView(s))&&(s=this.__addimage__.arrayBufferToBinaryString(s)),(v&&this.__addimage__.isArrayBuffer(v)||this.__addimage__.isArrayBufferView(v))&&(v=this.__addimage__.arrayBufferToBinaryString(v)),{alias:t,data:s,index:e,filter:y,decodeParameters:A,transparency:q,palette:B,sMask:v,predictor:G,width:d,height:c,bitsPerComponent:m,sMaskBitsPerComponent:b,colorSpace:T}}},(function(s){s.processGIF89A=function(e,t,n,r){var o=new ZA(e),d=o.width,c=o.height,h=[];o.decodeAndBlitFrameRGBA(0,h);var f={data:h,width:d,height:c},m=new Pm(100).encode(f,100);return s.processJPEG.call(this,m,t,n,r)},s.processGIF87A=s.processGIF89A})(Mn.API),ad.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var s=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(s);for(var e=0;e<s;e++){var t=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:r,green:n,blue:t,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},ad.prototype.parseBGR=function(){this.pos=this.offset;try{var s="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[s]()}catch(t){rs.log("bit decode error:"+t)}},ad.prototype.bit1=function(){var s,e=Math.ceil(this.width/8),t=e%4;for(s=this.height-1;s>=0;s--){for(var n=this.bottom_up?s:this.height-1-s,r=0;r<e;r++)for(var o=this.datav.getUint8(this.pos++,!0),d=n*this.width*4+8*r*4,c=0;c<8&&8*r+c<this.width;c++){var h=this.palette[o>>7-c&1];this.data[d+4*c]=h.blue,this.data[d+4*c+1]=h.green,this.data[d+4*c+2]=h.red,this.data[d+4*c+3]=255}t!==0&&(this.pos+=4-t)}},ad.prototype.bit4=function(){for(var s=Math.ceil(this.width/2),e=s%4,t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,r=0;r<s;r++){var o=this.datav.getUint8(this.pos++,!0),d=n*this.width*4+2*r*4,c=o>>4,h=15&o,f=this.palette[c];if(this.data[d]=f.blue,this.data[d+1]=f.green,this.data[d+2]=f.red,this.data[d+3]=255,2*r+1>=this.width)break;f=this.palette[h],this.data[d+4]=f.blue,this.data[d+4+1]=f.green,this.data[d+4+2]=f.red,this.data[d+4+3]=255}e!==0&&(this.pos+=4-e)}},ad.prototype.bit8=function(){for(var s=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*n;if(r<this.palette.length){var d=this.palette[r];this.data[o]=d.red,this.data[o+1]=d.green,this.data[o+2]=d.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}s!==0&&(this.pos+=4-s)}},ad.prototype.bit15=function(){for(var s=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var d=(o&e)/e*255|0,c=(o>>5&e)/e*255|0,h=(o>>10&e)/e*255|0,f=o>>15?255:0,m=n*this.width*4+4*r;this.data[m]=h,this.data[m+1]=c,this.data[m+2]=d,this.data[m+3]=f}this.pos+=s}},ad.prototype.bit16=function(){for(var s=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,o=0;o<this.width;o++){var d=this.datav.getUint16(this.pos,!0);this.pos+=2;var c=(d&e)/e*255|0,h=(d>>5&t)/t*255|0,f=(d>>11)/e*255|0,m=r*this.width*4+4*o;this.data[m]=f,this.data[m+1]=h,this.data[m+2]=c,this.data[m+3]=255}this.pos+=s}},ad.prototype.bit24=function(){for(var s=this.height-1;s>=0;s--){for(var e=this.bottom_up?s:this.height-1-s,t=0;t<this.width;t++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),d=e*this.width*4+4*t;this.data[d]=o,this.data[d+1]=r,this.data[d+2]=n,this.data[d+3]=255}this.pos+=this.width%4}},ad.prototype.bit32=function(){for(var s=this.height-1;s>=0;s--)for(var e=this.bottom_up?s:this.height-1-s,t=0;t<this.width;t++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),d=this.datav.getUint8(this.pos++,!0),c=e*this.width*4+4*t;this.data[c]=o,this.data[c+1]=r,this.data[c+2]=n,this.data[c+3]=d}},ad.prototype.getData=function(){return this.data},(function(s){s.processBMP=function(e,t,n,r){var o=new ad(e,!1),d=o.width,c=o.height,h={data:o.getData(),width:d,height:c},f=new Pm(100).encode(h,100);return s.processJPEG.call(this,f,t,n,r)}})(Mn.API),Ab.prototype.getData=function(){return this.data},(function(s){s.processWEBP=function(e,t,n,r){var o=new Ab(e),d=o.width,c=o.height,h={data:o.getData(),width:d,height:c},f=new Pm(100).encode(h,100);return s.processJPEG.call(this,f,t,n,r)}})(Mn.API),Mn.API.processRGBA=function(s,e,t){for(var n=s.data,r=n.length,o=new Uint8Array(r/4*3),d=new Uint8Array(r/4),c=0,h=0,f=0;f<r;f+=4){var m=n[f],y=n[f+1],A=n[f+2],v=n[f+3];o[c++]=m,o[c++]=y,o[c++]=A,d[h++]=v}var N=this.__addimage__.arrayBufferToBinaryString(o);return{alpha:this.__addimage__.arrayBufferToBinaryString(d),data:N,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:s.width,height:s.height}},Mn.API.setLanguage=function(s){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[s]!==void 0&&(this.internal.languageSettings.languageCode=s,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},rf=Mn.API,Rg=rf.getCharWidthsArray=function(s,e){var t,n,r=(e=e||{}).font||this.internal.getFont(),o=e.fontSize||this.internal.getFontSize(),d=e.charSpace||this.internal.getCharSpace(),c=e.widths?e.widths:r.metadata.Unicode.widths,h=c.fof?c.fof:1,f=e.kerning?e.kerning:r.metadata.Unicode.kerning,m=f.fof?f.fof:1,y=e.doKerning!==!1,A=0,v=s.length,N=0,T=c[0]||h,_=[];for(t=0;t<v;t++)n=s.charCodeAt(t),typeof r.metadata.widthOfString=="function"?_.push((r.metadata.widthOfGlyph(r.metadata.characterToGlyph(n))+d*(1e3/o)||0)/1e3):(A=y&&zr(f[n])==="object"&&!isNaN(parseInt(f[n][N],10))?f[n][N]/m:0,_.push((c[n]||T)/h+A)),N=n;return _},fb=rf.getStringUnitWidth=function(s,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),n=e.font||this.internal.getFont(),r=e.charSpace||this.internal.getCharSpace();return rf.processArabic&&(s=rf.processArabic(s)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(s,t,r)/t:Rg.apply(this,arguments).reduce(function(o,d){return o+d},0)},pb=function(s,e,t,n){for(var r=[],o=0,d=s.length,c=0;o!==d&&c+e[o]<t;)c+=e[o],o++;r.push(s.slice(0,o));var h=o;for(c=0;o!==d;)c+e[o]>n&&(r.push(s.slice(h,o)),c=0,h=o),c+=e[o],o++;return h!==o&&r.push(s.slice(h,o)),r},gb=function(s,e,t){t||(t={});var n,r,o,d,c,h,f,m=[],y=[m],A=t.textIndent||0,v=0,N=0,T=s.split(" "),_=Rg.apply(this,[" ",t])[0];if(h=t.lineIndent===-1?T[0].length+2:t.lineIndent||0){var b=Array(h).join(" "),H=[];T.map(function(M){(M=M.split(/\s*\n/)).length>1?H=H.concat(M.map(function(B,q){return(q&&B.length?`
`:"")+B})):H.push(M[0])}),T=H,h=fb.apply(this,[b,t])}for(o=0,d=T.length;o<d;o++){var R=0;if(n=T[o],h&&n[0]==`
`&&(n=n.substr(1),R=1),A+v+(N=(r=Rg.apply(this,[n,t])).reduce(function(M,B){return M+B},0))>e||R){if(N>e){for(c=pb.apply(this,[n,r,e-(A+v),e]),m.push(c.shift()),m=[c.pop()];c.length;)y.push([c.shift()]);N=r.slice(n.length-(m[0]?m[0].length:0)).reduce(function(M,B){return M+B},0)}else m=[n];y.push(m),A=N+h,v=_}else m.push(n),A+=v+N,v=_}return f=h?function(M,B){return(B?b:"")+M.join(" ")}:function(M){return M.join(" ")},y.map(f)},rf.splitTextToSize=function(s,e,t){var n,r=(t=t||{}).fontSize||this.internal.getFontSize(),o=(function(m){if(m.widths&&m.kerning)return{widths:m.widths,kerning:m.kerning};var y=this.internal.getFont(m.fontName,m.fontStyle),A="Unicode";return y.metadata[A]?{widths:y.metadata[A].widths||{0:1},kerning:y.metadata[A].kerning||{}}:{font:y.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);n=Array.isArray(s)?s:String(s).split(/\r?\n/);var d=1*this.internal.scaleFactor*e/r;o.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/r:0,o.lineIndent=t.lineIndent;var c,h,f=[];for(c=0,h=n.length;c<h;c++)f=f.concat(gb.apply(this,[n[c],d,o]));return f},(function(s){s.__fontmetrics__=s.__fontmetrics__||{};for(var e="0123456789abcdef",t="klmnopqrstuvwxyz",n={},r={},o=0;o<16;o++)n[t[o]]=e[o],r[e[o]]=t[o];var d=function(A){return"0x"+parseInt(A,10).toString(16)},c=s.__fontmetrics__.compress=function(A){var v,N,T,_,b=["{"];for(var H in A){if(v=A[H],isNaN(parseInt(H,10))?N="'"+H+"'":(H=parseInt(H,10),N=(N=d(H).slice(2)).slice(0,-1)+r[N.slice(-1)]),typeof v=="number")v<0?(T=d(v).slice(3),_="-"):(T=d(v).slice(2),_=""),T=_+T.slice(0,-1)+r[T.slice(-1)];else{if(zr(v)!=="object")throw new Error("Don't know what to do with value type "+zr(v)+".");T=c(v)}b.push(N+T)}return b.push("}"),b.join("")},h=s.__fontmetrics__.uncompress=function(A){if(typeof A!="string")throw new Error("Invalid argument passed to uncompress.");for(var v,N,T,_,b={},H=1,R=b,M=[],B="",q="",G=A.length-1,X=1;X<G;X+=1)(_=A[X])=="'"?v?(T=v.join(""),v=void 0):v=[]:v?v.push(_):_=="{"?(M.push([R,T]),R={},T=void 0):_=="}"?((N=M.pop())[0][N[1]]=R,T=void 0,R=N[0]):_=="-"?H=-1:T===void 0?n.hasOwnProperty(_)?(B+=n[_],T=parseInt(B,16)*H,H=1,B=""):B+=_:n.hasOwnProperty(_)?(q+=n[_],R[T]=parseInt(q,16)*H,H=1,T=void 0,q=""):q+=_;return b},f={codePages:["WinAnsiEncoding"],WinAnsiEncoding:h("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},m={Unicode:{Courier:f,"Courier-Bold":f,"Courier-BoldOblique":f,"Courier-Oblique":f,Helvetica:f,"Helvetica-Bold":f,"Helvetica-BoldOblique":f,"Helvetica-Oblique":f,"Times-Roman":f,"Times-Bold":f,"Times-BoldItalic":f,"Times-Italic":f}},y={Unicode:{"Courier-Oblique":h("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":h("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":h("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:h("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":h("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":h("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:h("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:h("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":h("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:h("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":h("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":h("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":h("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":h("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};s.events.push(["addFont",function(A){var v=A.font,N=y.Unicode[v.postScriptName];N&&(v.metadata.Unicode={},v.metadata.Unicode.widths=N.widths,v.metadata.Unicode.kerning=N.kerning);var T=m.Unicode[v.postScriptName];T&&(v.metadata.Unicode.encoding=T,v.encoding=T.codePages[0])}])})(Mn.API),(function(s){var e=function(t){for(var n=t.length,r=new Uint8Array(n),o=0;o<n;o++)r[o]=t.charCodeAt(o);return r};s.API.events.push(["addFont",function(t){var n=void 0,r=t.font,o=t.instance;if(!r.isStandardFont){if(o===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+r.postScriptName+"').");if(typeof(n=o.existsFileInVFS(r.postScriptName)===!1?o.loadFile(r.postScriptName):o.getFileFromVFS(r.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+r.postScriptName+"').");(function(d,c){c=/^\x00\x01\x00\x00/.test(c)?e(c):e(qg(c)),d.metadata=s.API.TTFFont.open(c),d.metadata.Unicode=d.metadata.Unicode||{encoding:{},kerning:{},widths:[]},d.metadata.glyIdsUsed=[0]})(r,n)}}])})(Mn),Mn.API.addSvgAsImage=function(s,e,t,n,r,o,d,c){if(isNaN(e)||isNaN(t))throw rs.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(n)||isNaN(r))throw rs.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var h=document.createElement("canvas");h.width=n,h.height=r;var f=h.getContext("2d");f.fillStyle="#fff",f.fillRect(0,0,h.width,h.height);var m={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},y=this;return(oi.canvg?Promise.resolve(oi.canvg):cm(()=>import("./index.es-BKfI8m2z.js"),[])).catch(function(A){return Promise.reject(new Error("Could not load canvg: "+A))}).then(function(A){return A.default?A.default:A}).then(function(A){return A.fromString(f,s,m)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(A){return A.render(m)}).then(function(){y.addImage(h.toDataURL("image/jpeg",1),e,t,n,r,d,c)})},Mn.API.putTotalPages=function(s){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(s,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(s,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var r=0;r<this.internal.pages[n].length;r++)this.internal.pages[n][r]=this.internal.pages[n][r].replace(e,t);return this},Mn.API.viewerPreferences=function(s,e){var t;s=s||{},e=e||!1;var n,r,o,d={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},c=Object.keys(d),h=[],f=0,m=0,y=0;function A(N,T){var _,b=!1;for(_=0;_<N.length;_+=1)N[_]===T&&(b=!0);return b}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(d)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,s==="reset"||e===!0){var v=c.length;for(y=0;y<v;y+=1)t[c[y]].value=t[c[y]].defaultValue,t[c[y]].explicitSet=!1}if(zr(s)==="object"){for(r in s)if(o=s[r],A(c,r)&&o!==void 0){if(t[r].type==="boolean"&&typeof o=="boolean")t[r].value=o;else if(t[r].type==="name"&&A(t[r].valueSet,o))t[r].value=o;else if(t[r].type==="integer"&&Number.isInteger(o))t[r].value=o;else if(t[r].type==="array"){for(f=0;f<o.length;f+=1)if(n=!0,o[f].length===1&&typeof o[f][0]=="number")h.push(String(o[f]-1));else if(o[f].length>1){for(m=0;m<o[f].length;m+=1)typeof o[f][m]!="number"&&(n=!1);n===!0&&h.push([o[f][0]-1,o[f][1]-1].join(" "))}t[r].value="["+h.join(" ")+"]"}else t[r].value=t[r].defaultValue;t[r].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var N,T=[];for(N in t)t[N].explicitSet===!0&&(t[N].type==="name"?T.push("/"+N+" /"+t[N].value):T.push("/"+N+" "+t[N].value));T.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+T.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},(function(s){var e=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',r=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),o=unescape(encodeURIComponent(n)),d=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),c=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),h=unescape(encodeURIComponent("</x:xmpmeta>")),f=o.length+d.length+c.length+r.length+h.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+f+" >>"),this.internal.write("stream"),this.internal.write(r+o+d+c+h),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};s.addMetadata=function(n,r){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:r||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}})(Mn.API),(function(s){var e=s.API,t=e.pdfEscape16=function(o,d){for(var c,h=d.metadata.Unicode.widths,f=["","0","00","000","0000"],m=[""],y=0,A=o.length;y<A;++y){if(c=d.metadata.characterToGlyph(o.charCodeAt(y)),d.metadata.glyIdsUsed.push(c),d.metadata.toUnicode[c]=o.charCodeAt(y),h.indexOf(c)==-1&&(h.push(c),h.push([parseInt(d.metadata.widthOfGlyph(c),10)])),c=="0")return m.join("");c=c.toString(16),m.push(f[4-c.length],c)}return m.join("")},n=function(o){var d,c,h,f,m,y,A;for(m=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,h=[],y=0,A=(c=Object.keys(o).sort(function(v,N){return v-N})).length;y<A;y++)d=c[y],h.length>=100&&(m+=`
`+h.length+` beginbfchar
`+h.join(`
`)+`
endbfchar`,h=[]),o[d]!==void 0&&o[d]!==null&&typeof o[d].toString=="function"&&(f=("0000"+o[d].toString(16)).slice(-4),d=("0000"+(+d).toString(16)).slice(-4),h.push("<"+d+"><"+f+">"));return h.length&&(m+=`
`+h.length+` beginbfchar
`+h.join(`
`)+`
endbfchar
`),m+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(o){(function(d){var c=d.font,h=d.out,f=d.newObject,m=d.putStream;if(c.metadata instanceof s.API.TTFFont&&c.encoding==="Identity-H"){for(var y=c.metadata.Unicode.widths,A=c.metadata.subset.encode(c.metadata.glyIdsUsed,1),v="",N=0;N<A.length;N++)v+=String.fromCharCode(A[N]);var T=f();m({data:v,addLength1:!0,objectId:T}),h("endobj");var _=f();m({data:n(c.metadata.toUnicode),addLength1:!0,objectId:_}),h("endobj");var b=f();h("<<"),h("/Type /FontDescriptor"),h("/FontName /"+lf(c.fontName)),h("/FontFile2 "+T+" 0 R"),h("/FontBBox "+s.API.PDFObject.convert(c.metadata.bbox)),h("/Flags "+c.metadata.flags),h("/StemV "+c.metadata.stemV),h("/ItalicAngle "+c.metadata.italicAngle),h("/Ascent "+c.metadata.ascender),h("/Descent "+c.metadata.decender),h("/CapHeight "+c.metadata.capHeight),h(">>"),h("endobj");var H=f();h("<<"),h("/Type /Font"),h("/BaseFont /"+lf(c.fontName)),h("/FontDescriptor "+b+" 0 R"),h("/W "+s.API.PDFObject.convert(y)),h("/CIDToGIDMap /Identity"),h("/DW 1000"),h("/Subtype /CIDFontType2"),h("/CIDSystemInfo"),h("<<"),h("/Supplement 0"),h("/Registry (Adobe)"),h("/Ordering ("+c.encoding+")"),h(">>"),h(">>"),h("endobj"),c.objectNumber=f(),h("<<"),h("/Type /Font"),h("/Subtype /Type0"),h("/ToUnicode "+_+" 0 R"),h("/BaseFont /"+lf(c.fontName)),h("/Encoding /"+c.encoding),h("/DescendantFonts ["+H+" 0 R]"),h(">>"),h("endobj"),c.isAlreadyPutted=!0}})(o)}]),e.events.push(["putFont",function(o){(function(d){var c=d.font,h=d.out,f=d.newObject,m=d.putStream;if(c.metadata instanceof s.API.TTFFont&&c.encoding==="WinAnsiEncoding"){for(var y=c.metadata.rawData,A="",v=0;v<y.length;v++)A+=String.fromCharCode(y[v]);var N=f();m({data:A,addLength1:!0,objectId:N}),h("endobj");var T=f();m({data:n(c.metadata.toUnicode),addLength1:!0,objectId:T}),h("endobj");var _=f();h("<<"),h("/Descent "+c.metadata.decender),h("/CapHeight "+c.metadata.capHeight),h("/StemV "+c.metadata.stemV),h("/Type /FontDescriptor"),h("/FontFile2 "+N+" 0 R"),h("/Flags 96"),h("/FontBBox "+s.API.PDFObject.convert(c.metadata.bbox)),h("/FontName /"+lf(c.fontName)),h("/ItalicAngle "+c.metadata.italicAngle),h("/Ascent "+c.metadata.ascender),h(">>"),h("endobj"),c.objectNumber=f();for(var b=0;b<c.metadata.hmtx.widths.length;b++)c.metadata.hmtx.widths[b]=parseInt(c.metadata.hmtx.widths[b]*(1e3/c.metadata.head.unitsPerEm));h("<</Subtype/TrueType/Type/Font/ToUnicode "+T+" 0 R/BaseFont/"+lf(c.fontName)+"/FontDescriptor "+_+" 0 R/Encoding/"+c.encoding+" /FirstChar 29 /LastChar 255 /Widths "+s.API.PDFObject.convert(c.metadata.hmtx.widths)+">>"),h("endobj"),c.isAlreadyPutted=!0}})(o)}]);var r=function(o){var d,c=o.text||"",h=o.x,f=o.y,m=o.options||{},y=o.mutex||{},A=y.pdfEscape,v=y.activeFontKey,N=y.fonts,T=v,_="",b=0,H="",R=N[T].encoding;if(N[T].encoding!=="Identity-H")return{text:c,x:h,y:f,options:m,mutex:y};for(H=c,T=v,Array.isArray(c)&&(H=c[0]),b=0;b<H.length;b+=1)N[T].metadata.hasOwnProperty("cmap")&&(d=N[T].metadata.cmap.unicode.codeMap[H[b].charCodeAt(0)]),d||H[b].charCodeAt(0)<256&&N[T].metadata.hasOwnProperty("Unicode")?_+=H[b]:_+="";var M="";return parseInt(T.slice(1))<14||R==="WinAnsiEncoding"?M=A(_,T).split("").map(function(B){return B.charCodeAt(0).toString(16)}).join(""):R==="Identity-H"&&(M=t(_,N[T])),y.isHex=!0,{text:M,x:h,y:f,options:m,mutex:y}};e.events.push(["postProcessText",function(o){var d=o.text||"",c=[],h={text:d,x:o.x,y:o.y,options:o.options,mutex:o.mutex};if(Array.isArray(d)){var f=0;for(f=0;f<d.length;f+=1)Array.isArray(d[f])&&d[f].length===3?c.push([r(Object.assign({},h,{text:d[f][0]})).text,d[f][1],d[f][2]]):c.push(r(Object.assign({},h,{text:d[f]})).text);o.text=c}else o.text=r(Object.assign({},h,{text:d})).text}])})(Mn),(function(s){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};s.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},s.addFileToVFS=function(t,n){return e.call(this),this.internal.vFS[t]=n,this},s.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}})(Mn.API),(function(s){s.__bidiEngine__=s.prototype.__bidiEngine__=function(n){var r,o,d,c,h,f,m,y=e,A=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],v=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],N={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},T={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},_=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],b=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),H=!1,R=0;this.__bidiEngine__={};var M=function(W){var I=W.charCodeAt(),J=I>>8,Z=T[J];return Z!==void 0?y[256*Z+(255&I)]:J===252||J===253?"AL":b.test(J)?"L":J===8?"R":"N"},B=function(W){for(var I,J=0;J<W.length;J++){if((I=M(W.charAt(J)))==="L")return!1;if(I==="R")return!0}return!1},q=function(W,I,J,Z){var Ce,ie,le,se,Ae=I[Z];switch(Ae){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":H=!1;break;case"N":case"AN":break;case"EN":H&&(Ae="AN");break;case"AL":H=!0,Ae="R";break;case"WS":case"BN":Ae="N";break;case"CS":Z<1||Z+1>=I.length||(Ce=J[Z-1])!=="EN"&&Ce!=="AN"||(ie=I[Z+1])!=="EN"&&ie!=="AN"?Ae="N":H&&(ie="AN"),Ae=ie===Ce?ie:"N";break;case"ES":Ae=(Ce=Z>0?J[Z-1]:"B")==="EN"&&Z+1<I.length&&I[Z+1]==="EN"?"EN":"N";break;case"ET":if(Z>0&&J[Z-1]==="EN"){Ae="EN";break}if(H){Ae="N";break}for(le=Z+1,se=I.length;le<se&&I[le]==="ET";)le++;Ae=le<se&&I[le]==="EN"?"EN":"N";break;case"NSM":if(d&&!c){for(se=I.length,le=Z+1;le<se&&I[le]==="NSM";)le++;if(le<se){var ue=W[Z],E=ue>=1425&&ue<=2303||ue===64286;if(Ce=I[le],E&&(Ce==="R"||Ce==="AL")){Ae="R";break}}}Ae=Z<1||(Ce=I[Z-1])==="B"?"N":J[Z-1];break;case"B":H=!1,r=!0,Ae=R;break;case"S":o=!0,Ae="N"}return Ae},G=function(W,I,J){var Z=W.split("");return J&&X(Z,J,{hiLevel:R}),Z.reverse(),I&&I.reverse(),Z.join("")},X=function(W,I,J){var Z,Ce,ie,le,se,Ae=-1,ue=W.length,E=0,L=[],Q=R?v:A,ee=[];for(H=!1,r=!1,o=!1,Ce=0;Ce<ue;Ce++)ee[Ce]=M(W[Ce]);for(ie=0;ie<ue;ie++){if(se=E,L[ie]=q(W,ee,L,ie),Z=240&(E=Q[se][N[L[ie]]]),E&=15,I[ie]=le=Q[E][5],Z>0)if(Z===16){for(Ce=Ae;Ce<ie;Ce++)I[Ce]=1;Ae=-1}else Ae=-1;if(Q[E][6])Ae===-1&&(Ae=ie);else if(Ae>-1){for(Ce=Ae;Ce<ie;Ce++)I[Ce]=le;Ae=-1}ee[ie]==="B"&&(I[ie]=0),J.hiLevel|=le}o&&(function(oe,xe,re){for(var Le=0;Le<re;Le++)if(oe[Le]==="S"){xe[Le]=R;for(var Ee=Le-1;Ee>=0&&oe[Ee]==="WS";Ee--)xe[Ee]=R}})(ee,I,ue)},O=function(W,I,J,Z,Ce){if(!(Ce.hiLevel<W)){if(W===1&&R===1&&!r)return I.reverse(),void(J&&J.reverse());for(var ie,le,se,Ae,ue=I.length,E=0;E<ue;){if(Z[E]>=W){for(se=E+1;se<ue&&Z[se]>=W;)se++;for(Ae=E,le=se-1;Ae<le;Ae++,le--)ie=I[Ae],I[Ae]=I[le],I[le]=ie,J&&(ie=J[Ae],J[Ae]=J[le],J[le]=ie);E=se}E++}}},Y=function(W,I,J){var Z=W.split(""),Ce={hiLevel:R};return J||(J=[]),X(Z,J,Ce),(function(ie,le,se){if(se.hiLevel!==0&&m)for(var Ae,ue=0;ue<ie.length;ue++)le[ue]===1&&(Ae=_.indexOf(ie[ue]))>=0&&(ie[ue]=_[Ae+1])})(Z,J,Ce),O(2,Z,I,J,Ce),O(1,Z,I,J,Ce),Z.join("")};return this.__bidiEngine__.doBidiReorder=function(W,I,J){if((function(Ce,ie){if(ie)for(var le=0;le<Ce.length;le++)ie[le]=le;c===void 0&&(c=B(Ce)),f===void 0&&(f=B(Ce))})(W,I),d||!h||f)if(d&&h&&c^f)R=c?1:0,W=G(W,I,J);else if(!d&&h&&f)R=c?1:0,W=Y(W,I,J),W=G(W,I);else if(!d||c||h||f){if(d&&!h&&c^f)W=G(W,I),c?(R=0,W=Y(W,I,J)):(R=1,W=Y(W,I,J),W=G(W,I));else if(d&&c&&!h&&f)R=1,W=Y(W,I,J),W=G(W,I);else if(!d&&!h&&c^f){var Z=m;c?(R=1,W=Y(W,I,J),R=0,m=!1,W=Y(W,I,J),m=Z):(R=0,W=Y(W,I,J),W=G(W,I),R=1,m=!1,W=Y(W,I,J),m=Z,W=G(W,I))}}else R=0,W=Y(W,I,J);else R=c?1:0,W=Y(W,I,J);return W},this.__bidiEngine__.setOptions=function(W){W&&(d=W.isInputVisual,h=W.isOutputVisual,c=W.isInputRtl,f=W.isOutputRtl,m=W.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new s.__bidiEngine__({isInputVisual:!0});s.API.events.push(["postProcessText",function(n){var r=n.text;n.x,n.y;var o=n.options||{};n.mutex,o.lang;var d=[];if(o.isInputVisual=typeof o.isInputVisual!="boolean"||o.isInputVisual,t.setOptions(o),Object.prototype.toString.call(r)==="[object Array]"){var c=0;for(d=[],c=0;c<r.length;c+=1)Object.prototype.toString.call(r[c])==="[object Array]"?d.push([t.doBidiReorder(r[c][0]),r[c][1],r[c][2]]):d.push([t.doBidiReorder(r[c])]);n.text=d}else n.text=t.doBidiReorder(r);t.setOptions({isInputVisual:!0})}])})(Mn),Mn.API.TTFFont=(function(){function s(e){var t;if(this.rawData=e,t=this.contents=new $u(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new hC(this),this.registerTTF()}return s.open=function(e){return new s(e)},s.prototype.parse=function(){return this.directory=new JA(this.contents),this.head=new eC(this),this.name=new sC(this),this.cmap=new Z2(this),this.toUnicode={},this.hhea=new tC(this),this.maxp=new aC(this),this.hmtx=new oC(this),this.post=new iC(this),this.os2=new nC(this),this.loca=new uC(this),this.glyf=new lC(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},s.prototype.registerTTF=function(){var e,t,n,r,o;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var d,c,h,f;for(f=[],d=0,c=(h=this.bbox).length;d<c;d++)e=h[d],f.push(Math.round(e*this.scaleFactor));return f}).call(this),this.stemV=0,this.post.exists?(n=255&(r=this.post.italic_angle),32768&(t=r>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(o=this.familyClass)===1||o===2||o===3||o===4||o===5||o===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},s.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},s.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},s.prototype.widthOfString=function(e,t,n){var r,o,d,c;for(d=0,o=0,c=(e=""+e).length;0<=c?o<c:o>c;o=0<=c?++o:--o)r=e.charCodeAt(o),d+=this.widthOfGlyph(this.characterToGlyph(r))+n*(1e3/t)||0;return d*(t/1e3)},s.prototype.lineHeight=function(e,t){var n;return t==null&&(t=!1),n=t?this.lineGap:0,(this.ascender+n-this.decender)/1e3*e},s})();var dd,$u=(function(){function s(e){this.data=e??[],this.pos=0,this.length=this.data.length}return s.prototype.readByte=function(){return this.data[this.pos++]},s.prototype.writeByte=function(e){return this.data[this.pos++]=e},s.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},s.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},s.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},s.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},s.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},s.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},s.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},s.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},s.prototype.readString=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)n[t]=String.fromCharCode(this.readByte());return n.join("")},s.prototype.writeString=function(e){var t,n,r;for(r=[],t=0,n=e.length;0<=n?t<n:t>n;t=0<=n?++t:--t)r.push(this.writeByte(e.charCodeAt(t)));return r},s.prototype.readShort=function(){return this.readInt16()},s.prototype.writeShort=function(e){return this.writeInt16(e)},s.prototype.readLongLong=function(){var e,t,n,r,o,d,c,h;return e=this.readByte(),t=this.readByte(),n=this.readByte(),r=this.readByte(),o=this.readByte(),d=this.readByte(),c=this.readByte(),h=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^n)+4294967296*(255^r)+16777216*(255^o)+65536*(255^d)+256*(255^c)+(255^h)+1):72057594037927940*e+281474976710656*t+1099511627776*n+4294967296*r+16777216*o+65536*d+256*c+h},s.prototype.writeLongLong=function(e){var t,n;return t=Math.floor(e/4294967296),n=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},s.prototype.readInt=function(){return this.readInt32()},s.prototype.writeInt=function(e){return this.writeInt32(e)},s.prototype.read=function(e){var t,n;for(t=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)t.push(this.readByte());return t},s.prototype.write=function(e){var t,n,r,o;for(o=[],n=0,r=e.length;n<r;n++)t=e[n],o.push(this.writeByte(t));return o},s})(),JA=(function(){var s;function e(t){var n,r,o;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},r=0,o=this.tableCount;0<=o?r<o:r>o;r=0<=o?++r:--r)n={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[n.tag]=n}return e.prototype.encode=function(t){var n,r,o,d,c,h,f,m,y,A,v,N,T;for(T in v=Object.keys(t).length,h=Math.log(2),y=16*Math.floor(Math.log(v)/h),d=Math.floor(y/h),m=16*v-y,(r=new $u).writeInt(this.scalarType),r.writeShort(v),r.writeShort(y),r.writeShort(d),r.writeShort(m),o=16*v,f=r.pos+o,c=null,N=[],t)for(A=t[T],r.writeString(T),r.writeInt(s(A)),r.writeInt(f),r.writeInt(A.length),N=N.concat(A),T==="head"&&(c=f),f+=A.length;f%4;)N.push(0),f++;return r.write(N),n=2981146554-s(r.data),r.pos=c+8,r.writeUInt32(n),r.data},s=function(t){var n,r,o,d;for(t=J2.call(t);t.length%4;)t.push(0);for(o=new $u(t),r=0,n=0,d=t.length;n<d;n=n+=4)r+=o.readUInt32();return 4294967295&r},e})(),QA={}.hasOwnProperty,zd=function(s,e){for(var t in e)QA.call(e,t)&&(s[t]=e[t]);function n(){this.constructor=s}return n.prototype=e.prototype,s.prototype=new n,s.__super__=e.prototype,s};dd=(function(){function s(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return s.prototype.parse=function(){},s.prototype.encode=function(){},s.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},s})();var eC=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return zd(s,dd),s.prototype.tag="head",s.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},s.prototype.encode=function(e){var t;return(t=new $u).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},s})(),Cb=(function(){function s(e,t){var n,r,o,d,c,h,f,m,y,A,v,N,T,_,b,H,R;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),y=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(h=0;h<256;++h)this.codeMap[h]=e.readByte();break;case 4:for(v=e.readUInt16(),A=v/2,e.pos+=6,o=(function(){var M,B;for(B=[],h=M=0;0<=A?M<A:M>A;h=0<=A?++M:--M)B.push(e.readUInt16());return B})(),e.pos+=2,T=(function(){var M,B;for(B=[],h=M=0;0<=A?M<A:M>A;h=0<=A?++M:--M)B.push(e.readUInt16());return B})(),f=(function(){var M,B;for(B=[],h=M=0;0<=A?M<A:M>A;h=0<=A?++M:--M)B.push(e.readUInt16());return B})(),m=(function(){var M,B;for(B=[],h=M=0;0<=A?M<A:M>A;h=0<=A?++M:--M)B.push(e.readUInt16());return B})(),r=(this.length-e.pos+this.offset)/2,c=(function(){var M,B;for(B=[],h=M=0;0<=r?M<r:M>r;h=0<=r?++M:--M)B.push(e.readUInt16());return B})(),h=b=0,R=o.length;b<R;h=++b)for(_=o[h],n=H=N=T[h];N<=_?H<=_:H>=_;n=N<=_?++H:--H)m[h]===0?d=n+f[h]:(d=c[m[h]/2+(n-N)-(A-h)]||0)!==0&&(d+=f[h]),this.codeMap[n]=65535&d}e.pos=y}return s.encode=function(e,t){var n,r,o,d,c,h,f,m,y,A,v,N,T,_,b,H,R,M,B,q,G,X,O,Y,W,I,J,Z,Ce,ie,le,se,Ae,ue,E,L,Q,ee,oe,xe,re,Le,Ee,Oe,Ze,st;switch(Z=new $u,d=Object.keys(e).sort(function(mt,Mt){return mt-Mt}),t){case"macroman":for(T=0,_=(function(){var mt=[];for(N=0;N<256;++N)mt.push(0);return mt})(),H={0:0},o={},Ce=0,Ae=d.length;Ce<Ae;Ce++)H[Ee=e[r=d[Ce]]]==null&&(H[Ee]=++T),o[r]={old:e[r],new:H[e[r]]},_[r]=H[e[r]];return Z.writeUInt16(1),Z.writeUInt16(0),Z.writeUInt32(12),Z.writeUInt16(0),Z.writeUInt16(262),Z.writeUInt16(0),Z.write(_),{charMap:o,subtable:Z.data,maxGlyphID:T+1};case"unicode":for(I=[],y=[],R=0,H={},n={},b=f=null,ie=0,ue=d.length;ie<ue;ie++)H[B=e[r=d[ie]]]==null&&(H[B]=++R),n[r]={old:B,new:H[B]},c=H[B]-r,b!=null&&c===f||(b&&y.push(b),I.push(r),f=c),b=r;for(b&&y.push(b),y.push(65535),I.push(65535),Y=2*(O=I.length),X=2*Math.pow(Math.log(O)/Math.LN2,2),A=Math.log(X/2)/Math.LN2,G=2*O-X,h=[],q=[],v=[],N=le=0,E=I.length;le<E;N=++le){if(W=I[N],m=y[N],W===65535){h.push(0),q.push(0);break}if(W-(J=n[W].new)>=32768)for(h.push(0),q.push(2*(v.length+O-N)),r=se=W;W<=m?se<=m:se>=m;r=W<=m?++se:--se)v.push(n[r].new);else h.push(J-W),q.push(0)}for(Z.writeUInt16(3),Z.writeUInt16(1),Z.writeUInt32(12),Z.writeUInt16(4),Z.writeUInt16(16+8*O+2*v.length),Z.writeUInt16(0),Z.writeUInt16(Y),Z.writeUInt16(X),Z.writeUInt16(A),Z.writeUInt16(G),re=0,L=y.length;re<L;re++)r=y[re],Z.writeUInt16(r);for(Z.writeUInt16(0),Le=0,Q=I.length;Le<Q;Le++)r=I[Le],Z.writeUInt16(r);for(Oe=0,ee=h.length;Oe<ee;Oe++)c=h[Oe],Z.writeUInt16(c);for(Ze=0,oe=q.length;Ze<oe;Ze++)M=q[Ze],Z.writeUInt16(M);for(st=0,xe=v.length;st<xe;st++)T=v[st],Z.writeUInt16(T);return{charMap:n,subtable:Z.data,maxGlyphID:R+1}}},s})(),Z2=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return zd(s,dd),s.prototype.tag="cmap",s.prototype.parse=function(e){var t,n,r;for(e.pos=this.offset,this.version=e.readUInt16(),r=e.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=r?n<r:n>r;n=0<=r?++n:--n)t=new Cb(e,this.offset),this.tables.push(t),t.isUnicode&&this.unicode==null&&(this.unicode=t);return!0},s.encode=function(e,t){var n,r;return t==null&&(t="macroman"),n=Cb.encode(e,t),(r=new $u).writeUInt16(0),r.writeUInt16(1),n.table=r.data.concat(n.subtable),n},s})(),tC=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return zd(s,dd),s.prototype.tag="hhea",s.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},s})(),nC=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return zd(s,dd),s.prototype.tag="OS/2",s.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=(function(){var t,n;for(n=[],t=0;t<10;++t)n.push(e.readByte());return n})(),this.charRange=(function(){var t,n;for(n=[],t=0;t<4;++t)n.push(e.readInt());return n})(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=(function(){var t,n;for(n=[],t=0;t<2;t=++t)n.push(e.readInt());return n})(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},s})(),iC=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return zd(s,dd),s.prototype.tag="post",s.prototype.parse=function(e){var t,n,r;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var o;for(n=e.readUInt16(),this.glyphNameIndex=[],o=0;0<=n?o<n:o>n;o=0<=n?++o:--o)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],r=[];e.pos<this.offset+this.length;)t=e.readByte(),r.push(this.names.push(e.readString(t)));return r;case 151552:return n=e.readUInt16(),this.offsets=e.read(n);case 262144:return this.map=(function(){var d,c,h;for(h=[],o=d=0,c=this.file.maxp.numGlyphs;0<=c?d<c:d>c;o=0<=c?++d:--d)h.push(e.readUInt32());return h}).call(this)}},s})(),rC=function(s,e){this.raw=s,this.length=s.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},sC=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return zd(s,dd),s.prototype.tag="name",s.prototype.parse=function(e){var t,n,r,o,d,c,h,f,m,y,A;for(e.pos=this.offset,e.readShort(),t=e.readShort(),c=e.readShort(),n=[],o=0;0<=t?o<t:o>t;o=0<=t?++o:--o)n.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+c+e.readShort()});for(h={},o=m=0,y=n.length;m<y;o=++m)r=n[o],e.pos=r.offset,f=e.readString(r.length),d=new rC(f,r),h[A=r.nameID]==null&&(h[A]=[]),h[r.nameID].push(d);this.strings=h,this.copyright=h[0],this.fontFamily=h[1],this.fontSubfamily=h[2],this.uniqueSubfamily=h[3],this.fontName=h[4],this.version=h[5];try{this.postscriptName=h[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=h[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=h[7],this.manufacturer=h[8],this.designer=h[9],this.description=h[10],this.vendorUrl=h[11],this.designerUrl=h[12],this.license=h[13],this.licenseUrl=h[14],this.preferredFamily=h[15],this.preferredSubfamily=h[17],this.compatibleFull=h[18],this.sampleText=h[19]},s})(),aC=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return zd(s,dd),s.prototype.tag="maxp",s.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},s})(),oC=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return zd(s,dd),s.prototype.tag="hmtx",s.prototype.parse=function(e){var t,n,r,o,d,c,h;for(e.pos=this.offset,this.metrics=[],t=0,c=this.file.hhea.numberOfMetrics;0<=c?t<c:t>c;t=0<=c?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(r=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var f,m;for(m=[],t=f=0;0<=r?f<r:f>r;t=0<=r?++f:--f)m.push(e.readInt16());return m})(),this.widths=(function(){var f,m,y,A;for(A=[],f=0,m=(y=this.metrics).length;f<m;f++)o=y[f],A.push(o.advance);return A}).call(this),n=this.widths[this.widths.length-1],h=[],t=d=0;0<=r?d<r:d>r;t=0<=r?++d:--d)h.push(this.widths.push(n));return h},s.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},s})(),J2=[].slice,lC=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return zd(s,dd),s.prototype.tag="glyf",s.prototype.parse=function(){return this.cache={}},s.prototype.glyphFor=function(e){var t,n,r,o,d,c,h,f,m,y;return e in this.cache?this.cache[e]:(o=this.file.loca,t=this.file.contents,n=o.indexOf(e),(r=o.lengthOf(e))===0?this.cache[e]=null:(t.pos=this.offset+n,d=(c=new $u(t.read(r))).readShort(),f=c.readShort(),y=c.readShort(),h=c.readShort(),m=c.readShort(),this.cache[e]=d===-1?new dC(c,f,y,h,m):new cC(c,d,f,y,h,m),this.cache[e]))},s.prototype.encode=function(e,t,n){var r,o,d,c,h;for(d=[],o=[],c=0,h=t.length;c<h;c++)r=e[t[c]],o.push(d.length),r&&(d=d.concat(r.encode(n)));return o.push(d.length),{table:d,offsets:o}},s})(),cC=(function(){function s(e,t,n,r,o,d){this.raw=e,this.numberOfContours=t,this.xMin=n,this.yMin=r,this.xMax=o,this.yMax=d,this.compound=!1}return s.prototype.encode=function(){return this.raw.data},s})(),dC=(function(){function s(e,t,n,r,o){var d,c;for(this.raw=e,this.xMin=t,this.yMin=n,this.xMax=r,this.yMax=o,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],d=this.raw;c=d.readShort(),this.glyphOffsets.push(d.pos),this.glyphIDs.push(d.readUInt16()),32&c;)d.pos+=1&c?4:2,128&c?d.pos+=8:64&c?d.pos+=4:8&c&&(d.pos+=2)}return s.prototype.encode=function(){var e,t,n;for(t=new $u(J2.call(this.raw.data)),e=0,n=this.glyphIDs.length;e<n;++e)t.pos=this.glyphOffsets[e];return t.data},s})(),uC=(function(){function s(){return s.__super__.constructor.apply(this,arguments)}return zd(s,dd),s.prototype.tag="loca",s.prototype.parse=function(e){var t,n;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=t===0?(function(){var r,o;for(o=[],n=0,r=this.length;n<r;n+=2)o.push(2*e.readUInt16());return o}).call(this):(function(){var r,o;for(o=[],n=0,r=this.length;n<r;n+=4)o.push(e.readUInt32());return o}).call(this)},s.prototype.indexOf=function(e){return this.offsets[e]},s.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},s.prototype.encode=function(e,t){for(var n=new Uint32Array(this.offsets.length),r=0,o=0,d=0;d<n.length;++d)if(n[d]=r,o<t.length&&t[o]==d){++o,n[d]=r;var c=this.offsets[d],h=this.offsets[d+1]-c;h>0&&(r+=h)}for(var f=new Array(4*n.length),m=0;m<n.length;++m)f[4*m+3]=255&n[m],f[4*m+2]=(65280&n[m])>>8,f[4*m+1]=(16711680&n[m])>>16,f[4*m]=(4278190080&n[m])>>24;return f},s})(),hC=(function(){function s(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return s.prototype.generateCmap=function(){var e,t,n,r,o;for(t in r=this.font.cmap.tables[0].codeMap,e={},o=this.subset)n=o[t],e[t]=r[n];return e},s.prototype.glyphsFor=function(e){var t,n,r,o,d,c,h;for(r={},d=0,c=e.length;d<c;d++)r[o=e[d]]=this.font.glyf.glyphFor(o);for(o in t=[],r)(n=r[o])!=null&&n.compound&&t.push.apply(t,n.glyphIDs);if(t.length>0)for(o in h=this.glyphsFor(t))n=h[o],r[o]=n;return r},s.prototype.encode=function(e,t){var n,r,o,d,c,h,f,m,y,A,v,N,T,_,b;for(r in n=Z2.encode(this.generateCmap(),"unicode"),d=this.glyphsFor(e),v={0:0},b=n.charMap)v[(h=b[r]).old]=h.new;for(N in A=n.maxGlyphID,d)N in v||(v[N]=A++);return m=(function(H){var R,M;for(R in M={},H)M[H[R]]=R;return M})(v),y=Object.keys(m).sort(function(H,R){return H-R}),T=(function(){var H,R,M;for(M=[],H=0,R=y.length;H<R;H++)c=y[H],M.push(m[c]);return M})(),o=this.font.glyf.encode(d,T,v),f=this.font.loca.encode(o.offsets,T),_={cmap:this.font.cmap.raw(),glyf:o.table,loca:f,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(_["OS/2"]=this.font.os2.raw()),this.font.directory.encode(_)},s})();Mn.API.PDFObject=(function(){var s;function e(){}return s=function(t,n){return(Array(n+1).join("0")+t).slice(-n)},e.convert=function(t){var n,r,o,d;if(Array.isArray(t))return"["+(function(){var c,h,f;for(f=[],c=0,h=t.length;c<h;c++)n=t[c],f.push(e.convert(n));return f})().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t?.isString)return"("+t+")";if(t instanceof Date)return"(D:"+s(t.getUTCFullYear(),4)+s(t.getUTCMonth(),2)+s(t.getUTCDate(),2)+s(t.getUTCHours(),2)+s(t.getUTCMinutes(),2)+s(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(r in o=["<<"],t)d=t[r],o.push("/"+r+" "+e.convert(d));return o.push(">>"),o.join(`
`)}return""+t},e})();const Em=s=>{const e=xy[s];return!e||!e.prefix||e.prefix.length<1?"?":e.prefix[0].substring(0,1).toUpperCase()},Bc=(s,e,t)=>({color:e,size:t}),Tb=(s,e,t)=>{},_s=(s,e,t,n)=>({color:t,size:n}),sf=(s,e,t,n)=>{},fC=()=>{const s=new Map,e={top:"#0072B2",bottom:"#56B4E9"},t={top:18,bottom:18},n={top:"#FFFF00",bottom:"#FFFF00"},r={top:18,bottom:18},o={top:"#AA4499",bottom:"#F781BF"},d={top:6,bottom:6},c={top:"#6A3D9A",bottom:"#9467BD"},h={top:18,bottom:18};return s.set("select",{id:"select",name:"Select",toolType:"select",icon:"",shortcut:"S",tooltip:"Select objects or groups",colorReflective:!1,settings:Bc("select","#ff0000",10),layerSettings:new Map([["top",_s("select","top","#ff0000",10)],["bottom",_s("select","bottom","#ff0000",10)]])}),s.set("via",{id:"via",name:"Via",toolType:"draw",drawingMode:"via",icon:"",shortcut:"V",tooltip:"Place via connection",colorReflective:!0,settings:Bc("via",nm,sm.DEFAULT_SIZE),layerSettings:new Map([["top",_s("via","top",nm,sm.DEFAULT_SIZE)],["bottom",_s("via","bottom",nm,sm.DEFAULT_SIZE)]]),defaultLayer:"top"}),s.set("pad",{id:"pad",name:"Pad",toolType:"draw",drawingMode:"pad",icon:"",shortcut:"P",tooltip:"Place pad connection",colorReflective:!0,settings:Bc("pad",i5,18),layerSettings:new Map([["top",_s("pad","top",e.top,t.top)],["bottom",_s("pad","bottom",e.bottom,t.bottom)]]),defaultLayer:"top"}),s.set("testPoint",{id:"testPoint",name:"Test Point",toolType:"draw",drawingMode:"testPoint",icon:"",shortcut:"Y",tooltip:"Place test point",colorReflective:!0,settings:Bc("testPoint","#FFFF00",18),layerSettings:new Map([["top",_s("testPoint","top",n.top,r.top)],["bottom",_s("testPoint","bottom",n.bottom,r.bottom)]]),defaultLayer:"top"}),s.set("trace",{id:"trace",name:"Trace",toolType:"draw",drawingMode:"trace",icon:"",shortcut:"T",tooltip:"Draw copper traces",colorReflective:!0,settings:Bc("trace",t5,6),layerSettings:new Map([["top",_s("trace","top",o.top,d.top)],["bottom",_s("trace","bottom",o.bottom,d.bottom)]]),defaultLayer:"top"}),s.set("component",{id:"component",name:"Component",toolType:"component",icon:"",shortcut:"C",tooltip:"Place component",colorReflective:!0,settings:Bc("component",n5,yy.DEFAULT_SIZE),layerSettings:new Map([["top",_s("component","top",c.top,h.top)],["bottom",_s("component","bottom",c.bottom,h.bottom)]]),defaultLayer:"top"}),s.set("componentConnection",{id:"componentConnection",name:"Component Connections",toolType:"componentConnection",icon:"",shortcut:"",tooltip:"Component connection lines",colorReflective:!1,settings:Bc("componentConnection","#E69F00",3),layerSettings:new Map([["top",_s("componentConnection","top","#E69F00",3)],["bottom",_s("componentConnection","bottom","#E69F00",3)]])}),s.set("power",{id:"power",name:"Power",toolType:"power",icon:"",shortcut:"B",tooltip:"Place power node",colorReflective:!0,settings:Bc("power",rm,18),layerSettings:new Map([["top",_s("power","top",rm,18)],["bottom",_s("power","bottom",rm,18)]]),defaultLayer:"top"}),s.set("ground",{id:"ground",name:"Ground",toolType:"ground",icon:"",shortcut:"G",tooltip:"Place ground symbol",colorReflective:!0,settings:Bc("ground",im,18),layerSettings:new Map([["top",_s("ground","top",im,18)],["bottom",_s("ground","bottom",im,18)]]),defaultLayer:"top"}),s.set("erase",{id:"erase",name:"Erase",toolType:"erase",icon:"",shortcut:"E",tooltip:"Erase objects",colorReflective:!1,settings:Bc("erase","#f5a3b3",18),layerSettings:new Map([["top",_s("erase","top","#f5a3b3",18)],["bottom",_s("erase","bottom","#f5a3b3",18)]])}),s.set("pan",{id:"pan",name:"Move",toolType:"pan",icon:"",shortcut:"H",tooltip:"Pan the view",colorReflective:!1,settings:Bc("pan","#ff0000",10),layerSettings:new Map([["top",_s("pan","top","#ff0000",10)],["bottom",_s("pan","bottom","#ff0000",10)]])}),s.set("magnify",{id:"magnify",name:"Zoom",toolType:"magnify",icon:"+",shortcut:"M",tooltip:"Magnify",colorReflective:!1,settings:Bc("magnify","#ff0000",10),layerSettings:new Map([["top",_s("magnify","top","#ff0000",10)],["bottom",_s("magnify","bottom","#ff0000",10)]])}),s},kb={via:{color:"#2CA02C",size:18},padTop:{color:"#0072B2",size:18},padBottom:{color:"#56B4E9",size:18},testPointTop:{color:"#FFFF00",size:18},testPointBottom:{color:"#FFFF00",size:18},traceTop:{color:"#AA4499",size:6},traceBottom:{color:"#F781BF",size:6},componentTop:{color:"#6A3D9A",size:18},componentBottom:{color:"#9467BD",size:18},power:{color:"#ff0000",size:18},ground:{color:"#000000",size:18}},np={via:"Via",padTop:"Pad (Top)",padBottom:"Pad (Bottom)",testPointTop:"Test Point (Top)",testPointBottom:"Test Point (Bottom)",traceTop:"Trace (Top)",traceBottom:"Trace (Bottom)",componentTop:"Component (Top)",componentBottom:"Component (Bottom)",power:"Power",ground:"Ground"};class pC{instances=new Map;listeners=new Map;initialize(){for(const e of Object.keys(kb)){const t=kb[e];this.instances.set(e,{id:e,name:np[e],color:t.color,size:t.size}),this.listeners.set(e,new Set)}}initializeFromProject(e){if(this.initialize(),e?.toolInstances)for(const[t,n]of Object.entries(e.toolInstances))this.instances.has(t)&&this.instances.set(t,n)}get(e){const t=this.instances.get(e);if(!t)throw new Error(`Tool instance ${e} not found`);return t}getColor(e){const t=this.instances.get(e);if(!t)throw new Error(`Tool instance ${e} not found`);const n=np[e];return console.log(`${n}, returning color value=${t.color}`),t.color}getSize(e){const t=this.instances.get(e);if(!t)throw new Error(`Tool instance ${e} not found`);const n=np[e];return console.log(`${n}, returning size value=${t.size}`),t.size}setColor(e,t){const n=this.instances.get(e);if(n){const r=np[e];console.log(`${r}, setting color value=${t}`),n.color=t,this.notifyListeners(e)}}setSize(e,t){const n=this.instances.get(e);if(n){const r=np[e];console.log(`${r}, setting size value=${t}`),n.size=t,this.notifyListeners(e)}}getAll(){const e={};for(const[t,n]of this.instances.entries())e[t]=n;return e}subscribe(e,t){const n=this.listeners.get(e);return n?(n.add(t),()=>{n.delete(t)}):()=>{}}notifyListeners(e){const t=this.listeners.get(e);t&&t.forEach(n=>n())}}const Bn=new pC;Bn.initialize();function Dg(s,e){switch(s){case"via":return"via";case"pad":return e==="bottom"?"padBottom":"padTop";case"testPoint":return e==="bottom"?"testPointBottom":"testPointTop";case"trace":return e==="bottom"?"traceBottom":"traceTop";case"component":return e==="bottom"?"componentBottom":"componentTop";case"power":return"power";case"ground":return"ground";default:throw new Error(`Unknown tool: ${s}`)}}const gC=({visible:s,toolRegistry:e,currentTool:t,drawingMode:n,traceToolLayer:r,padToolLayer:o,testPointToolLayer:d,componentToolLayer:c,updateToolSettings:h,updateToolLayerSettings:f,setBrushSize:m,saveToolSettings:y,saveToolLayerSettings:A,setTopTraceSize:v,setBottomTraceSize:N,setTopPadSize:T,setBottomPadSize:_,setTopTestPointSize:b,setBottomTestPointSize:H,setTopComponentSize:R,setBottomComponentSize:M,setComponentConnectionSize:B,saveDefaultSize:q,onClose:G})=>{const[X,O]=U.useState({}),Y=[{id:"via",name:"Via",instanceId:"via"},{id:"pad",name:"Pad",layer:"top",instanceId:"padTop"},{id:"pad",name:"Pad",layer:"bottom",instanceId:"padBottom"},{id:"testPoint",name:"Test Point",layer:"top",instanceId:"testPointTop"},{id:"testPoint",name:"Test Point",layer:"bottom",instanceId:"testPointBottom"},{id:"trace",name:"Trace",layer:"top",instanceId:"traceTop"},{id:"trace",name:"Trace",layer:"bottom",instanceId:"traceBottom"},{id:"component",name:"Component",layer:"top",instanceId:"componentTop"},{id:"component",name:"Component",layer:"bottom",instanceId:"componentBottom"},{id:"componentConnection",name:"Component Connections"},{id:"power",name:"Power",instanceId:"power"},{id:"ground",name:"Ground",instanceId:"ground"},{id:"erase",name:"Erase"}];U.useEffect(()=>{if(s){const J={};for(const Z of Y){const Ce=Z.instanceId||Z.id;if(Z.instanceId)try{const ie=Bn.get(Z.instanceId);J[Ce]=ie.size}catch{const ie=e.get(Z.id);ie&&(J[Ce]=Z.layer?ie.layerSettings.get(Z.layer)?.size??ie.settings.size??10:ie.settings.size??10)}else{const ie=e.get(Z.id);ie&&(J[Ce]=ie.settings.size??10)}}O(J)}},[s]);const W=U.useCallback((J,Z,Ce,ie)=>{if(!e.get(J)&&J!=="componentConnection")return;const se=ie||J;O(ue=>({...ue,[se]:Z})),["trace","pad","testPoint","component"].includes(J)&&Ce&&ie?(Bn.setSize(ie,Z),(J==="trace"&&t==="draw"&&n==="trace"||J==="pad"&&t==="draw"&&n==="pad"||J==="testPoint"&&t==="draw"&&n==="testPoint"||J==="component"&&t==="component")&&((J==="trace"?r:J==="pad"?o:J==="testPoint"?d:c)||"top")===Ce&&m(Z)):ie?(Bn.setSize(ie,Z),(J==="via"&&t==="draw"&&n==="via"||J==="power"&&t==="power"||J==="ground"&&t==="ground")&&m(Z)):(J==="componentConnection"&&(B(Z),q("componentConnection",Z)),J==="erase"&&t==="erase"&&m(Z))},[e,t,n,r,o,d,c,m,B,q]);if(!s)return null;const I=Array.from({length:50},(J,Z)=>Z+1);return l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10004},onClick:J=>{J.target===J.currentTarget&&G()},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"16px",width:"fit-content",maxWidth:"400px",maxHeight:"85vh",overflowY:"auto",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid #1f1f24"},onClick:J=>J.stopPropagation(),children:[l.jsx("h3",{style:{margin:"0 0 12px 0",color:"#fff",fontSize:"16px",fontWeight:600},children:"Set Tool Size"}),l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:Y.map((J,Z)=>{if(!e.get(J.id)&&J.id!=="componentConnection")return null;const ie=J.layer?`${J.name} (${J.layer==="top"?"Top":"Bottom"})`:J.name,le=J.instanceId||J.id,se=X[le]??10;return l.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"6px 10px",background:"#1f1f24",borderRadius:4},children:[l.jsxs("label",{style:{color:"#f2f2f2",fontSize:"13px",width:"140px",flexShrink:0,marginRight:"8px"},children:[ie,":"]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[l.jsx("select",{value:se,onChange:Ae=>{const ue=parseInt(Ae.target.value,10);W(J.id,ue,J.layer,J.instanceId)},style:{width:"50px",padding:"4px 6px",background:"#2b2b31",border:"1px solid #3a3a44",borderRadius:4,color:"#f2f2f2",fontSize:"12px",cursor:"pointer"},children:I.map(Ae=>l.jsx("option",{value:Ae,style:{background:"#2b2b31",color:"#f2f2f2"},children:Ae},Ae))}),l.jsx("span",{style:{color:"#f2f2f2",fontSize:"12px"},children:"px"})]})]},`${J.id}-${J.layer||"default"}-${Z}`)})}),l.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"16px"},children:l.jsx("button",{onClick:G,style:{padding:"6px 12px",background:"#4CAF50",color:"#fff",border:"1px solid #45a049",borderRadius:6,cursor:"pointer",fontSize:"13px",fontWeight:600},children:"Close"})})]})})},mC=({visible:s,toolRegistry:e,currentTool:t,drawingMode:n,traceToolLayer:r,padToolLayer:o,testPointToolLayer:d,componentToolLayer:c,updateToolSettings:h,updateToolLayerSettings:f,saveToolSettings:m,saveToolLayerSettings:y,setBrushColor:A,setTopTraceColor:v,setBottomTraceColor:N,setTopPadColor:T,setBottomPadColor:_,setTopTestPointColor:b,setBottomTestPointColor:H,setTopComponentColor:R,setBottomComponentColor:M,setComponentConnectionColor:B,saveDefaultColor:q,colorPalette:G,onClose:X})=>{const[O,Y]=Dt.useState(null),[W,I]=Dt.useState(0);if(Dt.useEffect(()=>{const le=[];return[{id:"via"},{id:"pad",layer:"top"},{id:"pad",layer:"bottom"},{id:"testPoint",layer:"top"},{id:"testPoint",layer:"bottom"},{id:"trace",layer:"top"},{id:"trace",layer:"bottom"},{id:"component",layer:"top"},{id:"component",layer:"bottom"},{id:"power"},{id:"ground"}].forEach(({id:Ae,layer:ue})=>{try{const E=Dg(Ae,ue),L=Bn.subscribe(E,()=>{I(Q=>Q+1)});le.push(L)}catch{}}),()=>{le.forEach(Ae=>Ae())}},[]),!s)return null;const J=["pad","testPoint","trace","component"],Z=[{id:"via",name:"Via"},{id:"pad",name:"Pad",layer:"top"},{id:"pad",name:"Pad",layer:"bottom"},{id:"testPoint",name:"Test Point",layer:"top"},{id:"testPoint",name:"Test Point",layer:"bottom"},{id:"trace",name:"Trace",layer:"top"},{id:"trace",name:"Trace",layer:"bottom"},{id:"component",name:"Component",layer:"top"},{id:"component",name:"Component",layer:"bottom"},{id:"componentConnection",name:"Component Connections"},{id:"power",name:"Power"},{id:"ground",name:"Ground"},{id:"erase",name:"Erase"}],Ce=(le,se,Ae)=>{if(le==="componentConnection"){B(se),q("componentConnection",se),Y(null);return}if(le==="erase"){const ue=e.get(le);ue&&(h(le,{...ue.settings,color:se}),m(le,se,ue.settings.size)),Y(null);return}try{let ue;Ae&&J.includes(le)?ue=Dg(le,Ae):ue=Dg(le),Bn.setColor(ue,se),(le==="via"&&t==="draw"&&n==="via"||le==="trace"&&t==="draw"&&n==="trace"||le==="pad"&&t==="draw"&&n==="pad"||le==="testPoint"&&t==="draw"&&n==="testPoint"||le==="component"&&t==="component"||le==="power"&&t==="power"||le==="ground"&&t==="ground")&&(Ae&&J.includes(le)?((le==="trace"?r:le==="pad"?o:le==="testPoint"?d:c)||"top")===Ae&&A(se):A(se))}catch(ue){console.error(`Error updating color for tool ${le}:`,ue);const E=e.get(le);E&&(Ae&&J.includes(le)?(f(le,Ae,{...E.layerSettings.get(Ae),color:se}),y(le,Ae,se,E.layerSettings.get(Ae)?.size||E.settings.size)):(h(le,{...E.settings,color:se}),m(le,se,E.settings.size)))}Y(null)},ie=(le,se)=>{let Ae;try{const L=Dg(le,se);Ae=Bn.get(L).color}catch{const L=e.get(le);if(!L)return null;Ae=L.settings.color??"#000000"}const ue=se?`${le}-${se}`:le,E=O?.toolId===le&&O?.layer===se;return l.jsxs("div",{style:{position:"relative",display:"inline-block",zIndex:10005},children:[l.jsx("button",{className:"color-swatch-button",onClick:L=>{L.stopPropagation(),Y(E?null:{toolId:le,layer:se})},style:{width:"40px",height:"24px",background:Ae,backgroundColor:Ae,backgroundImage:"none",border:"1px solid #3a3a44",borderRadius:3,cursor:"pointer",padding:0,margin:0,display:"block","--swatch-color":Ae},title:Ae},`${ue}-button-${Ae}-${W}`),E&&l.jsx("div",{onClick:L=>{L.stopPropagation()},style:{position:"absolute",top:0,left:"100%",marginLeft:"4px",padding:8,background:"#fff",border:"1px solid #ddd",borderRadius:6,boxShadow:"0 8px 18px rgba(0,0,0,0.18)",zIndex:100},children:l.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(8, 22px)",gap:4},children:G.map(L=>l.jsx("div",{onClick:()=>Ce(le,L,se),title:L,style:{width:22,height:22,backgroundColor:L,border:L===Ae?"2px solid #333":"1px solid #ccc",cursor:"pointer"}},L))})})]},`${ue}-${Ae}-${W}`)};return l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10004},onClick:le=>{le.target===le.currentTarget&&(X(),Y(null))},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"16px",width:"fit-content",minWidth:"450px",maxWidth:"600px",maxHeight:"85vh",overflowY:"auto",overflowX:"visible",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid #1f1f24"},onClick:le=>le.stopPropagation(),children:[l.jsx("h3",{style:{margin:"0 0 12px 0",color:"#fff",fontSize:"16px",fontWeight:600},children:"Set Tool Color"}),l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:Z.map((le,se)=>{if(!e.get(le.id))return null;const ue=le.layer?`${le.name} (${le.layer==="top"?"Top":"Bottom"})`:le.name;return l.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"6px 10px",background:"#1f1f24",borderRadius:4},children:[l.jsxs("label",{style:{color:"#f2f2f2",fontSize:"13px",width:"140px",flexShrink:0,marginRight:"8px"},children:[ue,":"]}),ie(le.id,le.layer)]},`${le.id}-${le.layer||"default"}-${se}`)})}),l.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"16px"},children:l.jsx("button",{onClick:()=>{X(),Y(null)},style:{padding:"6px 12px",background:"#4CAF50",color:"#fff",border:"1px solid #45a049",borderRadius:6,cursor:"pointer",fontSize:"13px",fontWeight:600},children:"Close"})})]})})},yC=({openMenu:s,setOpenMenu:e,isReadOnlyMode:t,currentProjectFilePath:n,isProjectActive:r,autoSaveEnabled:o,autoSaveInterval:d,hasUnsavedChangesState:c,onNewProject:h,onOpenProject:f,onSaveProject:m,onPrint:y,onExportBOM:A,hasUnsavedChanges:v,bomExportFormat:N,setBomExportFormat:T,setNewProjectDialog:_,setAutoSaveDialog:b,onShowGeminiSettings:H,topImage:R,bottomImage:M,setCurrentTool:B,resetImageTransform:q,areImagesLocked:G,setAreImagesLocked:X,onEnterBoardDimensions:O,fileInputTopRef:Y,fileInputBottomRef:W,openProjectRef:I,increaseSize:J,decreaseSize:Z,brushSize:Ce,drawingStrokes:ie,selectedIds:le,selectedComponentIds:se,selectedPowerIds:Ae,selectedGroundIds:ue,componentsTop:E,componentsBottom:L,powers:Q,grounds:ee,powerNodeNames:oe,groundNodeNames:xe,setSetSizeDialog:re,areViasLocked:Le,setAreViasLocked:Ee,arePadsLocked:Oe,setArePadsLocked:Ze,areTestPointsLocked:st,setAreTestPointsLocked:mt,areTracesLocked:Mt,setAreTracesLocked:K,areComponentsLocked:jt,setAreComponentsLocked:$t,areGroundNodesLocked:Yt,setAreGroundNodesLocked:yt,arePowerNodesLocked:on,setArePowerNodesLocked:ze,showTraceCornerDots:Ne,setShowTraceCornerDots:Ct,setSelectedIds:wt,setSelectedComponentIds:it,setSelectedPowerIds:pt,setSelectedGroundIds:Ot,selectAllVias:Qe,selectAllTraces:St,selectAllPads:Wt,selectAllComponents:Bt,selectDisconnectedComponents:Ln,selectAllComponentConnections:Kt,selectAllPowerNodes:rn,selectAllGroundNodes:un,selectPowerNodesByName:ot,selectGroundNodesByName:Zt,setShowPowerBusManager:sn,setShowGroundBusManager:Ft,setShowPastMachine:Jt,toolRegistry:yn,updateToolSettings:_n,updateToolLayerSettings:Qt,setBrushSize:Ut,setBrushColor:zi,saveToolSettings:Jn,saveToolLayerSettings:Lt,colorPalette:Ht,currentTool:Et,drawingMode:ti,traceToolLayer:vi,padToolLayer:ar,testPointToolLayer:_t,componentToolLayer:Fn,setTopTraceSize:Xn,setBottomTraceSize:ci,setTopPadSize:ri,setBottomPadSize:Br,setTopTestPointSize:Di,setBottomTestPointSize:Ni,setTopComponentSize:Ns,setBottomComponentSize:ha,setComponentConnectionSize:Na,topTraceColor:$l,bottomTraceColor:Wa,topPadColor:$a,bottomPadColor:No,topTestPointColor:Qn,bottomTestPointColor:Us,topComponentColor:Ti,bottomComponentColor:Pa,setTopTraceColor:On,setBottomTraceColor:Qo,setTopPadColor:wi,setBottomPadColor:fa,setTopTestPointColor:Ea,setBottomTestPointColor:el,setTopComponentColor:tl,setBottomComponentColor:Ga,setComponentConnectionColor:ud,saveDefaultSize:dr,saveDefaultColor:nl,menuBarRef:$n,onOpenProjectNotes:Wn,onOpenTransformImages:il,onOpenTransformAll:co})=>{const[Ra,ea]=Dt.useState(null),ki=Dt.useRef(null),[Ki,Si]=Dt.useState(null),Fr=Dt.useRef(null),[$c,ta]=Dt.useState(!1),[Hs,Gl]=Dt.useState(!1),pa=zt=>{if(!r){alert("Please create a new project (File  New Project) or open an existing project (File  Open Project) before using this feature."),e(null);return}const $i=zt();$i instanceof Promise&&$i.catch(uo=>{const Tl=uo instanceof Error?uo.message:String(uo);console.error("Error in requireProject action:",uo),alert(`An error occurred:

${Tl}

See console for details.`)})},vs=zt=>{const $i=zt==="power"?oe:xe,uo=$i.length>0,Tl=zt==="power"?"Select Power Nodes":"Select Ground Nodes";return l.jsxs("div",{onMouseEnter:()=>{ki.current&&(clearTimeout(ki.current),ki.current=null),ea(zt)},onMouseLeave:()=>{ki.current=window.setTimeout(()=>{ea(Kr=>Kr===zt?null:Kr)},200)},style:{position:"absolute",top:0,left:"100%",marginLeft:"4px",minWidth:220,background:"#2b2b31",border:"1px solid #1f1f24",borderRadius:6,boxShadow:"0 6px 18px rgba(0,0,0,0.25)",padding:6,zIndex:10},children:[l.jsxs("div",{style:{padding:"4px 10px",fontSize:12,color:"#bbb"},children:[Tl," by Name"]}),l.jsxs("button",{onClick:()=>{zt==="power"?rn():un(),ea(null),e(null)},style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:"#f2f2f2",background:"transparent",border:"none",cursor:"pointer"},children:["All ",zt==="power"?"Power Nodes":"Ground Nodes"]}),l.jsx("div",{style:{height:1,background:"#eee",margin:"6px 0"}}),uo?$i.map(Kr=>l.jsx("button",{onClick:()=>{zt==="power"?ot(Kr):Zt(Kr),ea(null),e(null)},style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:"#f2f2f2",background:"transparent",border:"none",cursor:"pointer"},children:Kr},Kr)):l.jsxs("div",{style:{padding:"4px 10px",fontSize:12,color:"#bbb"},children:["No ",zt==="power"?"power":"ground"," nodes available."]})]})},na=()=>l.jsxs("div",{onMouseEnter:()=>{Fr.current&&(clearTimeout(Fr.current),Fr.current=null),Si("lock")},onMouseLeave:()=>{Fr.current=window.setTimeout(()=>{Si(zt=>zt==="lock"?null:zt)},200)},style:{position:"absolute",top:0,left:"100%",marginLeft:"4px",minWidth:220,background:"#2b2b31",border:"1px solid #1f1f24",borderRadius:6,boxShadow:"0 6px 18px rgba(0,0,0,0.25)",padding:6,zIndex:10},children:[l.jsxs("label",{onClick:zt=>{zt.stopPropagation()},style:{display:"flex",alignItems:"center",width:"100%",padding:"6px 10px",color:"#f2f2f2",cursor:"pointer",userSelect:"none"},children:[l.jsx("input",{type:"checkbox",checked:Le,onChange:()=>{Ee(zt=>!zt)},style:{marginRight:"8px",cursor:"pointer",width:"16px",height:"16px",accentColor:"#4a9eff"}}),l.jsx("span",{children:"Lock Vias"})]}),l.jsxs("label",{onClick:zt=>{zt.stopPropagation()},style:{display:"flex",alignItems:"center",width:"100%",padding:"6px 10px",color:"#f2f2f2",cursor:"pointer",userSelect:"none"},children:[l.jsx("input",{type:"checkbox",checked:Oe,onChange:()=>{Ze(zt=>!zt)},style:{marginRight:"8px",cursor:"pointer",width:"16px",height:"16px",accentColor:"#4a9eff"}}),l.jsx("span",{children:"Lock Pads"})]}),l.jsxs("label",{onClick:zt=>{zt.stopPropagation()},style:{display:"flex",alignItems:"center",width:"100%",padding:"6px 10px",color:"#f2f2f2",cursor:"pointer",userSelect:"none"},children:[l.jsx("input",{type:"checkbox",checked:st,onChange:()=>{mt(zt=>!zt)},style:{marginRight:"8px",cursor:"pointer",width:"16px",height:"16px",accentColor:"#4a9eff"}}),l.jsx("span",{children:"Lock Test Points"})]}),l.jsxs("label",{onClick:zt=>{zt.stopPropagation()},style:{display:"flex",alignItems:"center",width:"100%",padding:"6px 10px",color:"#f2f2f2",cursor:"pointer",userSelect:"none"},children:[l.jsx("input",{type:"checkbox",checked:Mt,onChange:()=>{K(zt=>!zt)},style:{marginRight:"8px",cursor:"pointer",width:"16px",height:"16px",accentColor:"#4a9eff"}}),l.jsx("span",{children:"Lock Traces"})]}),l.jsxs("label",{onClick:zt=>{zt.stopPropagation()},style:{display:"flex",alignItems:"center",width:"100%",padding:"6px 10px",color:"#f2f2f2",cursor:"pointer",userSelect:"none"},children:[l.jsx("input",{type:"checkbox",checked:jt,onChange:()=>{$t(zt=>!zt)},style:{marginRight:"8px",cursor:"pointer",width:"16px",height:"16px",accentColor:"#4a9eff"}}),l.jsx("span",{children:"Lock Components"})]}),l.jsxs("label",{onClick:zt=>{zt.stopPropagation()},style:{display:"flex",alignItems:"center",width:"100%",padding:"6px 10px",color:"#f2f2f2",cursor:"pointer",userSelect:"none"},children:[l.jsx("input",{type:"checkbox",checked:Yt,onChange:()=>{yt(zt=>!zt)},style:{marginRight:"8px",cursor:"pointer",width:"16px",height:"16px",accentColor:"#4a9eff"}}),l.jsx("span",{children:"Lock Ground Node"})]}),l.jsxs("label",{onClick:zt=>{zt.stopPropagation()},style:{display:"flex",alignItems:"center",width:"100%",padding:"6px 10px",color:"#f2f2f2",cursor:"pointer",userSelect:"none"},children:[l.jsx("input",{type:"checkbox",checked:on,onChange:()=>{ze(zt=>!zt)},style:{marginRight:"8px",cursor:"pointer",width:"16px",height:"16px",accentColor:"#4a9eff"}}),l.jsx("span",{children:"Lock Power Nodes"})]})]}),Ya=()=>l.jsxs("div",{onMouseEnter:()=>{Fr.current&&(clearTimeout(Fr.current),Fr.current=null),Si("select")},onMouseLeave:()=>{Fr.current=window.setTimeout(()=>{Si(zt=>zt==="select"?null:zt)},200)},style:{position:"absolute",top:0,left:"100%",marginLeft:"4px",minWidth:220,background:"#2b2b31",border:"1px solid #1f1f24",borderRadius:6,boxShadow:"0 6px 18px rgba(0,0,0,0.25)",padding:6,zIndex:10},children:[l.jsx("button",{onClick:()=>{Qe(),Si(null),e(null)},style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:"#f2f2f2",background:"transparent",border:"none"},children:"All Vias"}),l.jsx("button",{onClick:()=>{St(),Si(null),e(null)},style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:"#f2f2f2",background:"transparent",border:"none"},children:"All Traces"}),l.jsx("button",{onClick:()=>{Wt(),Si(null),e(null)},style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:"#f2f2f2",background:"transparent",border:"none"},children:"All Pads"}),l.jsx("button",{onClick:()=>{const zt=new Set(ie.filter($i=>$i.type==="testPoint").map($i=>$i.id));wt(zt),it(new Set),pt(new Set),Ot(new Set),Si(null),e(null)},style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:"#f2f2f2",background:"transparent",border:"none"},children:"All Test Points"}),l.jsx("button",{onClick:()=>{Bt(),Si(null),e(null)},style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:"#f2f2f2",background:"transparent",border:"none"},children:"All Components"}),l.jsx("button",{onClick:()=>{Kt(),Si(null),e(null)},style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:"#f2f2f2",background:"transparent",border:"none"},children:"All Component Connections"}),l.jsxs("div",{style:{position:"relative"},children:[l.jsx("button",{onMouseEnter:()=>{ki.current&&(clearTimeout(ki.current),ki.current=null),ea("power")},onMouseLeave:()=>{ki.current=window.setTimeout(()=>{ea(zt=>zt==="power"?null:zt)},200)},onClick:()=>{ea(zt=>zt==="power"?null:"power")},style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:"#f2f2f2",background:"transparent",border:"none",cursor:"pointer"},children:"Power Nodes "}),Ra==="power"&&vs("power")]}),l.jsxs("div",{style:{position:"relative"},children:[l.jsx("button",{onMouseEnter:()=>{ki.current&&(clearTimeout(ki.current),ki.current=null),ea("ground")},onMouseLeave:()=>{ki.current=window.setTimeout(()=>{ea(zt=>zt==="ground"?null:zt)},200)},onClick:()=>{ea(zt=>zt==="ground"?null:"ground")},style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:"#f2f2f2",background:"transparent",border:"none",cursor:"pointer"},children:"Ground Nodes "}),Ra==="ground"&&vs("ground")]}),l.jsx("button",{onClick:()=>{Ln(),Si(null),e(null)},style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:"#f2f2f2",background:"transparent",border:"none"},children:"Disconnected Components"})]});return l.jsxs(l.Fragment,{children:[l.jsxs("div",{ref:$n,style:{position:"relative",background:"rgba(250,250,255,0.9)",borderBottom:"1px solid #e6e6ef",padding:"6px 12px",display:"flex",gap:16,alignItems:"center",zIndex:3},children:[l.jsxs("div",{style:{position:"relative"},children:[l.jsx("button",{onClick:zt=>{zt.stopPropagation(),e($i=>$i==="file"?null:"file")},style:{padding:"6px 10px",borderRadius:6,border:"1px solid #ddd",background:s==="file"?"#eef3ff":"#fff",fontWeight:600,color:"#222"},children:"File "}),s==="file"&&l.jsxs("div",{style:{position:"absolute",top:"calc(100% + 6px)",left:0,minWidth:200,background:"#2b2b31",border:"1px solid #1f1f24",borderRadius:6,boxShadow:"0 6px 18px rgba(0,0,0,0.25)",padding:6},children:[l.jsx("button",{onClick:()=>{t||(e(null),v()?_({visible:!0}):h())},disabled:t,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:t?"#777":"#f2f2f2",background:"transparent",border:"none",cursor:t?"not-allowed":"pointer"},children:"New Project"}),l.jsx("button",{onClick:async()=>{await f(),e(null)},style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:"#f2f2f2",background:"transparent",border:"none"},children:"Open Project"}),l.jsx("div",{style:{height:1,background:"#eee",margin:"6px 0"}}),l.jsx("button",{onClick:()=>{t||pa(()=>{m(),e(null)})},disabled:t||!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:t||!r?"#777":"#f2f2f2",background:"transparent",border:"none",cursor:t||!r?"not-allowed":"pointer"},children:"Save Project"}),l.jsx("button",{onClick:()=>{t||pa(()=>{b({visible:!0,interval:5}),e(null)})},disabled:t||!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:t||!r?"#777":"#f2f2f2",background:"transparent",border:"none",cursor:t||!r?"not-allowed":"pointer"},children:"Auto Save"}),l.jsx("div",{style:{height:1,background:"#eee",margin:"6px 0"}}),l.jsx("button",{onClick:()=>{Jt(!0),e(null)},style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:"#f2f2f2",background:"transparent",border:"none",cursor:"pointer"},children:"Restore from History"}),l.jsx("div",{style:{height:1,background:"#eee",margin:"6px 0"}}),l.jsx("button",{onClick:()=>{H(),e(null)},style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:"#f2f2f2",background:"transparent",border:"none",cursor:"pointer"},children:"AI Settings"}),l.jsx("button",{onClick:async()=>{if(!t){if(!r){alert("Please create a new project (File  New Project) or open an existing project (File  Open Project) before using this feature."),e(null);return}try{await A(),e(null)}catch(zt){console.error("Error exporting BOM:",zt)}}},disabled:t||!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:t||!r?"#777":"#f2f2f2",background:"transparent",border:"none",cursor:t||!r?"not-allowed":"pointer"},children:"Export BOM"}),l.jsx("div",{style:{height:1,background:"#eee",margin:"6px 0"}}),l.jsx("button",{onClick:()=>{pa(()=>{y(),e(null)})},disabled:!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:r?"#f2f2f2":"#777",background:"transparent",border:"none",cursor:r?"pointer":"not-allowed"},children:"Print"}),l.jsx("button",{onClick:()=>{pa(()=>{y(),e(null)})},disabled:!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:r?"#f2f2f2":"#777",background:"transparent",border:"none",cursor:r?"pointer":"not-allowed"},children:"Printer Settings"})]})]}),l.jsxs("div",{style:{position:"relative"},children:[l.jsx("button",{onClick:zt=>{t||(zt.stopPropagation(),e($i=>$i==="transform"?null:"transform"))},disabled:t,style:{padding:"6px 10px",borderRadius:6,border:"1px solid #ddd",background:s==="transform"?"#eef3ff":"#fff",fontWeight:600,color:t?"#999":"#222",cursor:t?"not-allowed":"pointer",opacity:t?.5:1},children:"Images "}),s==="transform"&&l.jsxs("div",{style:{position:"absolute",top:"calc(100% + 6px)",left:0,minWidth:260,background:"#2b2b31",border:"1px solid #1f1f24",borderRadius:6,boxShadow:"0 6px 18px rgba(0,0,0,0.25)",padding:6},children:[l.jsx("button",{onClick:()=>{!t&&!G&&r&&(Y.current?.click(),e(null))},disabled:t||G||!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:t||G||!r?"#777":"#f2f2f2",background:"transparent",border:"none",cursor:t||G||!r?"not-allowed":"pointer"},children:"Load Top PCB"}),l.jsx("button",{onClick:()=>{!t&&!G&&r&&(W.current?.click(),e(null))},disabled:t||G||!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:t||G||!r?"#777":"#f2f2f2",background:"transparent",border:"none",cursor:t||G||!r?"not-allowed":"pointer"},children:"Load Bottom PCB"}),l.jsx("div",{style:{height:1,background:"#eee",margin:"6px 0"}}),l.jsx("button",{onClick:()=>{!G&&r&&(O(),e(null))},disabled:G||!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:G||!r?"#777":"#f2f2f2",background:"transparent",border:"none",cursor:G||!r?"not-allowed":"pointer"},children:"Enter PCB Dimensions"}),l.jsx("div",{style:{height:1,background:"#eee",margin:"6px 0"}}),l.jsx("button",{onClick:()=>{r&&(il(),e(null))},disabled:!R&&!M||G||!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:!R&&!M||G||!r?"#777":"#f2f2f2",background:"transparent",border:"none",cursor:!R&&!M||G||!r?"not-allowed":"pointer"},children:"Transform Images"}),l.jsx("button",{onClick:()=>{!G&&r&&(B("transform"),q(),e(null))},disabled:G||!R&&!M||!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:G||!R&&!M||!r?"#777":"#f2f2f2",background:"transparent",border:"none",cursor:G||!R&&!M||!r?"not-allowed":"pointer"},children:"Reset Transform"}),l.jsx("div",{style:{height:1,background:"#eee",margin:"6px 0"}}),l.jsx("button",{onClick:()=>{r&&(X(zt=>!zt),e(null))},disabled:!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:r?"#f2f2f2":"#777",background:"transparent",border:"none",cursor:r?"pointer":"not-allowed"},children:G?"Unlock Images ":"Lock Images"})]})]}),l.jsxs("div",{style:{position:"relative"},children:[l.jsx("button",{onClick:zt=>{t||(zt.stopPropagation(),e($i=>$i==="tools"?null:"tools"))},disabled:t,style:{padding:"6px 10px",borderRadius:6,border:"1px solid #ddd",background:s==="tools"?"#eef3ff":"#fff",fontWeight:600,color:t?"#999":"#222",cursor:t?"not-allowed":"pointer",opacity:t?.5:1},children:"Tools "}),s==="tools"&&l.jsxs("div",{style:{position:"absolute",top:"calc(100% + 6px)",left:0,minWidth:220,background:"#2b2b31",border:"1px solid #1f1f24",borderRadius:6,boxShadow:"0 6px 18px rgba(0,0,0,0.25)",padding:6},children:[l.jsx("button",{onClick:()=>{r&&(co(),e(null))},disabled:!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:r?"#f2f2f2":"#777",background:"transparent",border:"none",cursor:r?"pointer":"not-allowed"},children:"Change Perspective"}),l.jsx("div",{style:{height:1,background:"#eee",margin:"6px 0"}}),l.jsx("button",{onClick:zt=>{r&&(J(zt.shiftKey?5:1),e(null))},disabled:!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:r?"#f2f2f2":"#777",background:"transparent",border:"none",cursor:r?"pointer":"not-allowed"},children:"Increase Size (+)"}),l.jsx("button",{onClick:zt=>{r&&(Z(zt.shiftKey?5:1),e(null))},disabled:!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:r?"#f2f2f2":"#777",background:"transparent",border:"none",cursor:r?"pointer":"not-allowed"},children:"Decrease Size (-)"}),l.jsx("div",{style:{height:1,background:"#eee",margin:"6px 0"}}),l.jsxs("div",{style:{position:"relative"},children:[l.jsx("button",{onMouseEnter:()=>{r&&Fr.current&&(clearTimeout(Fr.current),Fr.current=null),r&&Si("lock")},onMouseLeave:()=>{r&&(Fr.current=window.setTimeout(()=>{Si(zt=>zt==="lock"?null:zt)},200))},onClick:()=>{r&&Si(zt=>zt==="lock"?null:"lock")},disabled:!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:r?"#f2f2f2":"#777",background:"transparent",border:"none",cursor:r?"pointer":"not-allowed"},children:"Lock "}),Ki==="lock"&&r&&na()]}),l.jsxs("div",{style:{position:"relative"},children:[l.jsx("button",{onMouseEnter:()=>{r&&Fr.current&&(clearTimeout(Fr.current),Fr.current=null),r&&Si("select")},onMouseLeave:()=>{r&&(Fr.current=window.setTimeout(()=>{Si(zt=>zt==="select"?null:zt)},200))},onClick:()=>{r&&Si(zt=>zt==="select"?null:"select")},disabled:!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:r?"#f2f2f2":"#777",background:"transparent",border:"none",cursor:r?"pointer":"not-allowed"},children:"Select "}),Ki==="select"&&r&&Ya()]}),l.jsx("div",{style:{height:1,background:"#eee",margin:"6px 0"}}),l.jsx("button",{onClick:()=>{r&&(Wn(),e(null))},disabled:!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:r?"#f2f2f2":"#777",background:"transparent",border:"none",cursor:r?"pointer":"not-allowed"},children:"Open Project Notes"}),l.jsx("div",{style:{height:1,background:"#eee",margin:"6px 0"}}),l.jsx("button",{onClick:()=>{r&&(ta(!0),e(null))},disabled:!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:r?"#f2f2f2":"#777",background:"transparent",border:"none",cursor:r?"pointer":"not-allowed"},children:"Set Tool Sizes"}),l.jsx("button",{onClick:()=>{r&&(Gl(!0),e(null))},disabled:!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:r?"#f2f2f2":"#777",background:"transparent",border:"none",cursor:r?"pointer":"not-allowed"},children:"Set Tool Colors"}),l.jsx("div",{style:{height:1,background:"#eee",margin:"6px 0"}}),l.jsx("button",{onClick:()=>{r&&(sn(!0),e(null))},disabled:!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:r?"#f2f2f2":"#777",background:"transparent",border:"none",cursor:r?"pointer":"not-allowed"},children:"Manage Power Buses"}),l.jsx("button",{onClick:()=>{r&&(Ft(!0),e(null))},disabled:!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:r?"#f2f2f2":"#777",background:"transparent",border:"none",cursor:r?"pointer":"not-allowed"},children:"Manage Ground Buses"}),l.jsx("div",{style:{height:1,background:"#eee",margin:"6px 0"}}),l.jsxs("button",{onClick:()=>{r&&(Ct(!Ne),e(null))},disabled:!r,style:{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",color:r?"#f2f2f2":"#777",background:"transparent",border:"none",cursor:r?"pointer":"not-allowed"},children:[Ne?" ":"   ","Show Trace Corner Dots"]})]})]}),l.jsxs("div",{style:{position:"relative"},children:[l.jsx("button",{onClick:zt=>{zt.stopPropagation(),e($i=>$i==="about"?null:"about")},style:{padding:"6px 10px",borderRadius:6,border:"1px solid #ddd",background:s==="about"?"#eef3ff":"#fff",fontWeight:600,color:"#222"},children:"About "}),s==="about"&&l.jsx("div",{style:{position:"absolute",top:"calc(100% + 6px)",left:0,minWidth:500,maxWidth:700,maxHeight:"80vh",background:"#2b2b31",border:"1px solid #1f1f24",borderRadius:6,boxShadow:"0 6px 18px rgba(0,0,0,0.25)",padding:20,overflowY:"auto",zIndex:100},children:l.jsxs("div",{style:{marginBottom:16},children:[l.jsx("h2",{style:{margin:"0 0 16px 0",color:"#f2f2f2",fontSize:"20px",fontWeight:700},children:"PCB Tracer"}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"About"}),l.jsx("p",{style:{margin:"0 0 12px 0",color:"#f2f2f2",fontSize:"14px",lineHeight:"1.6"},children:"A specialized tool useful for both reverse engineering and troubleshooting electronics by tracing and documenting circuit connections from PCB images. This application supports typical 2 to 4 layer PCBs and enables comprehensive PCB analysis and documentation."}),l.jsx("p",{style:{margin:"0 0 12px 0",color:"#f2f2f2",fontSize:"14px",lineHeight:"1.6"},children:"This tool can assist in troubleshooting by tracing circuits, holding contextual notes, comparing test results, and documenting findings during the debugging process."})]}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"Technologies"}),l.jsxs("p",{style:{margin:"0 0 12px 0",color:"#f2f2f2",fontSize:"14px",lineHeight:"1.6"},children:["Built with ",l.jsx("strong",{children:"TypeScript"})," and ",l.jsx("strong",{children:"React"}),", with ",l.jsx("strong",{children:"Gemini AI"})," integration for intelligent pin name extraction from datasheets. The application runs entirely client-side in the browser, providing a responsive, interactive drawing experience with no backend server requirements."]})]}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"Features"}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("p",{style:{margin:"0 0 8px 0",color:"#f2f2f2",fontSize:"14px",fontWeight:600},children:"Via/Pad Placement"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"13px",lineHeight:"1.6"},children:[l.jsxs("li",{children:["Alt/Option+click the Via or Pad tool, or press ",l.jsx("code",{children:"Alt/Option+V"})," or ",l.jsx("code",{children:"Alt/Option+P"})," to open the placement dialog"]}),l.jsx("li",{children:"Place multiple vias or pads in Linear, 2-Sided, or 4-Sided arrangements"}),l.jsx("li",{children:"Automatic counter-clockwise numbering starting from Pin 1"}),l.jsx("li",{children:"Supports chip orientations of 0, 90, 180, or 270"}),l.jsx("li",{children:"Click and drag to define the placement area"}),l.jsx("li",{children:"Tool automatically returns to Select tool after placement"})]})]}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("p",{style:{margin:"0 0 8px 0",color:"#f2f2f2",fontSize:"14px",fontWeight:600},children:"Tools & Shortcuts"}),l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"4px 16px",fontSize:"13px",color:"#f2f2f2"},children:[l.jsx("div",{children:l.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Select"}),"  ",l.jsx("code",{children:"S"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Via"}),"  ",l.jsx("code",{children:"V"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Pad"}),"  ",l.jsx("code",{children:"P"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Test Point"}),"  ",l.jsx("code",{children:"Y"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Trace"}),"  ",l.jsx("code",{children:"T"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Component"}),"  ",l.jsx("code",{children:"C"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Component Properties"}),"  double-click component"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Resize Icons"}),"  ",l.jsx("code",{children:"+"})," / ",l.jsx("code",{children:"-"})," (",l.jsx("code",{children:"Shift"})," + ",l.jsx("code",{children:"+"})," / ",l.jsx("code",{children:"-"})," = 5x faster)"]})]})}),l.jsx("div",{children:l.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Power"}),"  ",l.jsx("code",{children:"B"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Ground"}),"  ",l.jsx("code",{children:"G"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Move (Pan)"}),"  ",l.jsx("code",{children:"H"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Magnify"}),"  ",l.jsx("code",{children:"M"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Set View"}),"  ",l.jsx("code",{children:"X"})," then ",l.jsx("code",{children:"0-9"})," to save view"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Recall View"}),"  ",l.jsx("code",{children:"0-9"})," to recall saved view"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Default View 0"}),"  ",l.jsx("code",{children:"0"})," to recall default view (origin with all images contained)"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Information Dialog"}),"  ",l.jsx("code",{children:"I"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Notes Dialog"}),"  ",l.jsx("code",{children:"N"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Project Notes / TODO"}),"  ",l.jsx("code",{children:"L"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Undo"}),"  ",l.jsx("code",{children:"Ctrl"})," + ",l.jsx("code",{children:"Z"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Copy Component"}),"  ",l.jsx("code",{children:"Ctrl"})," + ",l.jsx("code",{children:"C"})," / ",l.jsx("code",{children:"Cmd"})," + ",l.jsx("code",{children:"C"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Paste Component"}),"  ",l.jsx("code",{children:"Ctrl"})," + ",l.jsx("code",{children:"V"})," / ",l.jsx("code",{children:"Cmd"})," + ",l.jsx("code",{children:"V"})]})]})})]}),l.jsxs("div",{style:{marginTop:"12px",fontSize:"13px",color:"#f2f2f2"},children:[l.jsx("p",{style:{margin:"0 0 8px 0",fontWeight:600,color:"#f2f2f2"},children:"Arrow Keys"}),l.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Move Selected Components"}),"  Arrow keys to nudge selected components (1 unit per press, ",l.jsx("code",{children:"Shift"})," = 10 units)"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Switch Perspective"}),"  ",l.jsx("code",{children:"Shift"})," + ",l.jsx("code",{children:""})," / ",l.jsx("code",{children:""})," or ",l.jsx("code",{children:"Caps Lock"})," + ",l.jsx("code",{children:""})," / ",l.jsx("code",{children:""})," to switch between top/bottom view"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Rotate Perspective"}),"  ",l.jsx("code",{children:"Shift"})," + ",l.jsx("code",{children:""})," / ",l.jsx("code",{children:""})," or ",l.jsx("code",{children:"Caps Lock"})," + ",l.jsx("code",{children:""})," / ",l.jsx("code",{children:""})," to rotate in 90 increments (",l.jsx("code",{children:""})," = counter-clockwise, ",l.jsx("code",{children:""})," = clockwise)"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Image Transformations"}),"  Arrow keys for scaling, rotating, and adjusting image transformations (when image is selected for transform)"]}),l.jsx("li",{children:"Click a slider first, then use arrow keys for precise adjustment"})]})]})]}),l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px 20px"},children:[l.jsxs("div",{children:[l.jsx("p",{style:{margin:"0 0 8px 0",color:"#f2f2f2",fontSize:"14px",fontWeight:600},children:"Image Management"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"13px",lineHeight:"1.6"},children:[l.jsx("li",{children:"Load top and bottom PCB images"}),l.jsx("li",{children:"Image alignment and transformation"}),l.jsx("li",{children:"Transform modes: nudge, scale, rotate, slant, keystone"}),l.jsx("li",{children:"Horizontal and vertical flip controls"}),l.jsx("li",{children:"Brightness and contrast controls"}),l.jsx("li",{children:"Grayscale mode"}),l.jsx("li",{children:"Automated transparency slider"}),l.jsx("li",{children:"Board dimensions configuration"})]})]}),l.jsxs("div",{children:[l.jsx("p",{style:{margin:"0 0 8px 0",color:"#f2f2f2",fontSize:"14px",fontWeight:600},children:"Drawing Tools"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"13px",lineHeight:"1.6"},children:[l.jsx("li",{children:"Draw copper traces (top and bottom layers)"}),l.jsx("li",{children:"Place vias for layer connections"}),l.jsx("li",{children:"Place component pads (SMD and through-hole)"}),l.jsx("li",{children:"Place test points for circuit testing"}),l.jsx("li",{children:"Place and annotate components"}),l.jsx("li",{children:"Place power and ground nodes"}),l.jsx("li",{children:"Erase tool for removing elements"})]})]}),l.jsxs("div",{children:[l.jsx("p",{style:{margin:"0 0 8px 0",color:"#f2f2f2",fontSize:"14px",fontWeight:600},children:"Layer Management"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"13px",lineHeight:"1.6"},children:[l.jsx("li",{children:"14 independent layers to manage PCB element types"}),l.jsx("li",{children:"Separate top and bottom layer support"}),l.jsx("li",{children:"Layer-specific color customization"}),l.jsx("li",{children:"Layer-specific size controls"}),l.jsx("li",{children:"Layer visibility toggles"}),l.jsx("li",{children:"Overlay view mode"})]})]}),l.jsxs("div",{children:[l.jsx("p",{style:{margin:"0 0 8px 0",color:"#f2f2f2",fontSize:"14px",fontWeight:600},children:"Component Management"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"13px",lineHeight:"1.6"},children:[l.jsx("li",{children:"Component placement with pin counts"}),l.jsx("li",{children:"Pin connection tracking"}),l.jsx("li",{children:"Component type classification"}),l.jsx("li",{children:"Designator and value annotation"}),l.jsx("li",{children:"Component editor dialog"}),l.jsx("li",{children:"Find and center component"})]})]}),l.jsxs("div",{children:[l.jsx("p",{style:{margin:"0 0 8px 0",color:"#f2f2f2",fontSize:"14px",fontWeight:600},children:"Selection & Locking"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"13px",lineHeight:"1.6"},children:[l.jsx("li",{children:"Select individual elements or groups"}),l.jsx("li",{children:"Select all vias, traces, pads, or components"}),l.jsx("li",{children:"Select power/ground nodes by name"}),l.jsx("li",{children:"Select disconnected components"}),l.jsx("li",{children:"Lock/unlock elements by type"}),l.jsx("li",{children:"Image locking for protection"})]})]}),l.jsxs("div",{children:[l.jsx("p",{style:{margin:"0 0 8px 0",color:"#f2f2f2",fontSize:"14px",fontWeight:600},children:"Power & Ground"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"13px",lineHeight:"1.6"},children:[l.jsx("li",{children:"Multiple voltage power nodes"}),l.jsx("li",{children:"Power bus management"}),l.jsx("li",{children:"Ground node placement"}),l.jsx("li",{children:"Ground bus management"}),l.jsx("li",{children:"Node naming and organization"})]})]}),l.jsxs("div",{children:[l.jsx("p",{style:{margin:"0 0 8px 0",color:"#f2f2f2",fontSize:"14px",fontWeight:600},children:"Customization"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"13px",lineHeight:"1.6"},children:[l.jsx("li",{children:"Customizable colors per layer"}),l.jsx("li",{children:"Adjustable brush/tool sizes"}),l.jsx("li",{children:"Size presets for common tools"}),l.jsx("li",{children:"Color palette management"}),l.jsx("li",{children:"Tool settings persistence"})]})]}),l.jsxs("div",{children:[l.jsx("p",{style:{margin:"0 0 8px 0",color:"#f2f2f2",fontSize:"14px",fontWeight:600},children:"Project Management"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"13px",lineHeight:"1.6"},children:[l.jsx("li",{children:"Create, open, and save projects"}),l.jsx("li",{children:"Auto-save with configurable intervals"}),l.jsx("li",{children:"File history automatically saved in history subdirectory when Auto Save is enabled"}),l.jsx("li",{children:"Project Notes / TODO list with spreadsheet-like editing"}),l.jsx("li",{children:"Project file format (JSON)"}),l.jsx("li",{children:"Print functionality"}),l.jsx("li",{children:"Export to KiCad schematic format (future feature, not yet implemented)"})]})]}),l.jsxs("div",{children:[l.jsx("p",{style:{margin:"0 0 8px 0",color:"#f2f2f2",fontSize:"14px",fontWeight:600},children:"View Controls"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"13px",lineHeight:"1.6"},children:[l.jsx("li",{children:"Zoom in/out with mouse wheel"}),l.jsx("li",{children:"Pan view with hand tool"}),l.jsx("li",{children:"Zoom to fit"}),l.jsx("li",{children:"View mode switching (top/bottom/overlay)"}),l.jsx("li",{children:"Save up to 10 view locations (X + 0-9)"}),l.jsx("li",{children:"Recall saved views instantly (0-9 keys)"}),l.jsxs("li",{children:["Default View 0: Press ",l.jsx("code",{children:"0"})," to recall the default view showing the origin with all loaded images fully contained within the canvas"]}),l.jsx("li",{children:"Change Perspective (Tools menu) - switch between top/bottom view and rotate all elements"}),l.jsx("li",{children:"Detailed information dialog"})]})]})]})]}),l.jsx("div",{style:{marginTop:20,paddingTop:16,borderTop:"1px solid #444"},children:l.jsxs("p",{style:{margin:"0 0 8px 0",color:"#bbb",fontSize:"12px",lineHeight:"1.5"},children:["Use the ",l.jsx("strong",{children:"File"})," menu to manage projects, the ",l.jsx("strong",{children:"Images"})," menu for image loading and transformation, and the ",l.jsx("strong",{children:"Tools"})," menu for selection, locking, and customization options."]})}),l.jsxs("div",{style:{marginTop:20,paddingTop:16,borderTop:"1px solid #444"},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"Future / TODO List"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"13px",lineHeight:"1.6"},children:[l.jsx("li",{children:"A searchable list of common components"}),l.jsx("li",{children:"Output schematics (perhaps as KiCad files)"}),l.jsx("li",{children:"Dynamic layers"}),l.jsx("li",{children:"Create a desktop version of this application using Electron"})]})]})]})})]}),l.jsxs("div",{style:{position:"relative"},children:[l.jsx("button",{onClick:zt=>{zt.stopPropagation(),e($i=>$i==="help"?null:"help")},style:{padding:"6px 10px",borderRadius:6,border:"1px solid #ddd",background:s==="help"?"#eef3ff":"#fff",fontWeight:600,color:"#222"},children:"Help "}),s==="help"&&l.jsx("div",{style:{position:"absolute",top:"calc(100% + 6px)",left:0,minWidth:500,maxWidth:700,maxHeight:"80vh",background:"#2b2b31",border:"1px solid #1f1f24",borderRadius:6,boxShadow:"0 6px 18px rgba(0,0,0,0.25)",padding:20,overflowY:"auto",zIndex:100},children:l.jsxs("div",{style:{marginBottom:16},children:[l.jsx("h2",{style:{margin:"0 0 16px 0",color:"#f2f2f2",fontSize:"20px",fontWeight:700},children:"Help: Typical Usage Steps"}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"Step 1: Create or Open a Project"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"14px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"New Project:"})," File  New Project. Choose a project name and location."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Open Project:"})," File  Open Project. Select an existing project file (.json)."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Auto-Save:"})," File  Auto Save  Enable to automatically save your work at regular intervals."]})]})]}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"Step 2: Load PCB Images"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"14px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Load Top Image:"})," Images  Load Top Image. Select your top-side PCB photo (.png or .jpeg)."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Load Bottom Image:"})," Images  Load Bottom Image. Select your bottom-side PCB photo."]}),l.jsxs("li",{children:["Images are automatically copied to the ",l.jsx("code",{style:{background:"#1f1f24",padding:"2px 4px",borderRadius:3,color:"#fff"},children:"images/"})," subdirectory."]})]})]}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"Step 3: Align and Transform Images"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"14px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Enter Transform Mode:"})," Images  Transform Images. Select which image (Top or Bottom) to transform."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Transform Operations:"})," Use Move, Nudge, Scale, Rotate, Slant, or Keystone to align images."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Image Adjustments:"})," Adjust brightness, contrast, sharpness, and grayscale as needed."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Flip Images:"})," Use horizontal or vertical flip if your images are mirrored."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Arrow Keys:"})," When transform tool is active, use arrow keys for precise image adjustments."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Move Components:"})," Select components, then use arrow keys to move them (1 unit per press, ",l.jsx("code",{children:"Shift"})," = 10 units for larger steps)."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Change Perspective:"})," Tools  Change Perspective (or press ",l.jsx("code",{children:"E"}),") to switch between top/bottom view or rotate all elements (images, components, traces) together by 90, 180, or 270."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Quick Perspective Switch:"})," Press ",l.jsx("code",{children:"Shift"})," + ",l.jsx("code",{children:""})," / ",l.jsx("code",{children:""})," or ",l.jsx("code",{children:"Caps Lock"})," + ",l.jsx("code",{children:""})," / ",l.jsx("code",{children:""})," to quickly switch between top/bottom view."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Quick Perspective Rotation:"})," Press ",l.jsx("code",{children:"Shift"})," + ",l.jsx("code",{children:""})," / ",l.jsx("code",{children:""})," or ",l.jsx("code",{children:"Caps Lock"})," + ",l.jsx("code",{children:""})," / ",l.jsx("code",{children:""})," to rotate perspective in 90 increments (",l.jsx("code",{children:""})," = counter-clockwise, ",l.jsx("code",{children:""})," = clockwise)."]})]})]}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"Step 4: Set Board Dimensions"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"14px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Enter Dimensions:"})," Images  Enter Board Dimensions. Specify the actual physical dimensions of your PCB."]}),l.jsx("li",{children:"This helps ensure accurate measurements and scaling for your reverse engineering work."})]})]}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"Step 5: Trace Connections"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"14px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Place Vias:"})," Click the Via tool (",l.jsx("code",{children:"V"}),") and click on the PCB where vias connect layers."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Place Pads:"})," Click the Pad tool (",l.jsx("code",{children:"P"}),") and mark component pad locations."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Place Multiple Vias/Pads:"})," Alt/Option+click the Via or Pad tool, or press ",l.jsx("code",{children:"Alt/Option+V"})," (vias) or ",l.jsx("code",{children:"Alt/Option+P"})," (pads) to open the placement dialog. Choose arrangement (Linear, 2-Sided, or 4-Sided), number of pins, orientation, and layer. Click and drag on the canvas to define the placement area. Vias/pads are automatically arranged in counter-clockwise order starting from Pin 1."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Place Test Points:"})," Click the Test Point tool (",l.jsx("code",{children:"Y"}),") to mark test points."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Draw Traces:"})," Click the Trace tool (",l.jsx("code",{children:"T"}),"), select Top or Bottom layer, then click to start a trace. Click again to add segments. Press ",l.jsx("code",{children:"Enter"})," or click outside to finish."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Snapping:"})," Traces automatically snap to nearby vias, pads, power nodes, and ground nodes."]})]})]}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"Step 6: Place Components"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"14px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Place Component:"})," Click the Component tool (",l.jsx("code",{children:"C"}),"), select component type, then click on the PCB."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Edit Component:"})," Double-click a component or select a component and press ",l.jsx("code",{children:"A"})," to open the Component Properties dialog. If multiple components are selected, opens the most recently selected one."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Set Properties:"})," Enter designator (e.g., R1, C2), value, and other component details."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Connect Pins:"})," Click on pads or vias to connect component pins to the circuit."]})]})]}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"Step 7: Add Power and Ground Nodes"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"14px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Manage Power Buses:"})," Tools  Manage Power Buses to create and configure voltage buses (e.g., +5V, +3.3V)."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Place Power Nodes:"})," Click the Power tool (",l.jsx("code",{children:"B"}),"), select a voltage bus, then click on the PCB."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Manage Ground Buses:"})," Tools  Manage Ground Buses to configure ground connections."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Place Ground Nodes:"})," Click the Ground tool (",l.jsx("code",{children:"G"}),"), select a ground bus, then click on the PCB."]})]})]}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"Step 8: Add Notes and Documentation"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"14px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Element Notes:"})," Press ",l.jsx("code",{children:"N"})," to open the Notes dialog for selected elements (vias, pads, traces, etc.)."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Project Notes:"})," Press ",l.jsx("code",{children:"L"})," to open Project Notes / TODO list for general project documentation."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Information Dialog:"})," Press ",l.jsx("code",{children:"I"})," to see detailed information about selected elements."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Find Elements:"})," Use the Find button in the Information dialog to center and highlight specific elements."]})]})]}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"Step 9: Save Your Work"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"14px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Manual Save:"})," File  Save Project to save your work manually."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Auto-Save:"})," If enabled, your project is automatically saved at regular intervals."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"History:"})," Auto-saved versions are stored in the ",l.jsx("code",{style:{background:"#1f1f24",padding:"2px 4px",borderRadius:3,color:"#fff"},children:"history/"})," subdirectory."]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Restore from History:"})," File  Restore from History to access previous versions."]})]})]}),l.jsxs("div",{style:{marginBottom:20,paddingTop:16,borderTop:"1px solid #444"},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"Keyboard Shortcuts"}),l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"4px 16px",fontSize:"13px",color:"#f2f2f2"},children:[l.jsxs("div",{children:[l.jsx("p",{style:{margin:"0 0 8px 0",fontWeight:600,color:"#f2f2f2"},children:"Drawing Tools"}),l.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Select"}),"  ",l.jsx("code",{children:"S"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Via"}),"  ",l.jsx("code",{children:"V"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Via Pattern"}),"  ",l.jsx("code",{children:"Alt/Option+V"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Pad"}),"  ",l.jsx("code",{children:"P"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Pad Pattern"}),"  ",l.jsx("code",{children:"Alt/Option+P"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Test Point"}),"  ",l.jsx("code",{children:"Y"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Trace"}),"  ",l.jsx("code",{children:"T"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Component"}),"  ",l.jsx("code",{children:"C"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Component Properties"}),"  ",l.jsx("code",{children:"A"})," (opens dialog for selected component)"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Power"}),"  ",l.jsx("code",{children:"B"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Ground"}),"  ",l.jsx("code",{children:"G"})]})]})]}),l.jsxs("div",{children:[l.jsx("p",{style:{margin:"0 0 8px 0",fontWeight:600,color:"#f2f2f2"},children:"View & Navigation"}),l.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Move (Pan)"}),"  ",l.jsx("code",{children:"H"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Magnify"}),"  ",l.jsx("code",{children:"M"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Set View"}),"  ",l.jsx("code",{children:"X"})," then ",l.jsx("code",{children:"0-9"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Recall View"}),"  ",l.jsx("code",{children:"0-9"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Default View 0"}),"  ",l.jsx("code",{children:"0"})," (origin with all images contained)"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Default View 0"}),"  ",l.jsx("code",{children:"0"})," (origin with all images contained)"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Information"}),"  ",l.jsx("code",{children:"I"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Notes"}),"  ",l.jsx("code",{children:"N"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Project Notes"}),"  ",l.jsx("code",{children:"L"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Undo"}),"  ",l.jsx("code",{children:"Ctrl+Z"})," / ",l.jsx("code",{children:"Cmd+Z"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Copy Component"}),"  ",l.jsx("code",{children:"Ctrl+C"})," / ",l.jsx("code",{children:"Cmd+C"})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Paste Component"}),"  ",l.jsx("code",{children:"Ctrl+V"})," / ",l.jsx("code",{children:"Cmd+V"})]})]})]})]}),l.jsxs("div",{style:{marginTop:"12px",fontSize:"13px",color:"#f2f2f2"},children:[l.jsx("p",{style:{margin:"0 0 8px 0",fontWeight:600,color:"#f2f2f2"},children:"Arrow Keys"}),l.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:"1.6"},children:[l.jsxs("li",{children:[l.jsx("strong",{children:"Move Selected Components"}),"  Arrow keys to nudge selected components (1 unit per press, ",l.jsx("code",{children:"Shift"})," = 10 units)"]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Switch Perspective"}),"  ",l.jsx("code",{children:"Shift"})," + ",l.jsx("code",{children:""})," / ",l.jsx("code",{children:""})," or ",l.jsx("code",{children:"Caps Lock"})," + ",l.jsx("code",{children:""})," / ",l.jsx("code",{children:""})]}),l.jsxs("li",{children:[l.jsx("strong",{children:"Rotate Perspective"}),"  ",l.jsx("code",{children:"Shift"})," + ",l.jsx("code",{children:""})," / ",l.jsx("code",{children:""})," or ",l.jsx("code",{children:"Caps Lock"})," + ",l.jsx("code",{children:""})," / ",l.jsx("code",{children:""})," (",l.jsx("code",{children:""})," = counter-clockwise, ",l.jsx("code",{children:""})," = clockwise)"]}),l.jsx("li",{children:"Use arrow keys to adjust image transformations (when transform tool is active)"}),l.jsx("li",{children:"Click a slider first, then use arrow keys for precise adjustment"})]})]})]}),l.jsxs("div",{style:{marginBottom:20},children:[l.jsx("h3",{style:{margin:"0 0 10px 0",color:"#f2f2f2",fontSize:"16px",fontWeight:600},children:"Tips & Tricks"}),l.jsxs("ul",{style:{margin:"0 0 12px 0",paddingLeft:"20px",color:"#f2f2f2",fontSize:"13px",lineHeight:"1.6"},children:[l.jsx("li",{children:"Double-click any slider to reset it to the default value"}),l.jsx("li",{children:"Double-click a component to edit its properties"}),l.jsxs("li",{children:["Hold ",l.jsx("code",{children:"Shift"})," while clicking to add to selection"]}),l.jsxs("li",{children:["Use the Information dialog (",l.jsx("code",{children:"I"}),") to see details about selected elements"]}),l.jsx("li",{children:"Lock layers (Tools  Lock) to prevent accidental modifications"}),l.jsx("li",{children:"Use the Find button in the Information dialog to center elements in view"}),l.jsxs("li",{children:["Save views with ",l.jsx("code",{children:"X"})," + number key for quick navigation"]}),l.jsxs("li",{children:["Use ",l.jsx("code",{children:"+"})," and ",l.jsx("code",{children:"-"})," keys to resize tool icons (",l.jsx("code",{children:"Shift"})," + ",l.jsx("code",{children:"+"})," / ",l.jsx("code",{children:"-"})," changes size 5 times faster)"]})]})]}),l.jsx("div",{style:{marginTop:20,paddingTop:16,borderTop:"1px solid #444"},children:l.jsxs("p",{style:{margin:"0 0 8px 0",color:"#bbb",fontSize:"12px",lineHeight:"1.5"},children:["For more detailed feature information, see the ",l.jsx("strong",{children:"About"})," menu."]})})]})})]}),n&&l.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:"8px",paddingLeft:"16px"},children:[l.jsx("div",{style:{fontSize:"12px",color:"#333",fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"40vw"},title:n,children:n}),l.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"50%",border:"1px solid #666",backgroundColor:c?o?"#ffaa00":"#ff0000":"#00ff00",flexShrink:0},title:c?o?`Changes detected  Auto Save: ON  Will be saved automatically every ${d||1} minute${d===1?"":"s"}`:"Changes detected  Auto Save: OFF  You need to save manually (File  Save Project)":"Project saved  No unsaved changes  Auto Save: "+(o?"ON":"OFF")})]})]}),l.jsx(gC,{visible:$c,toolRegistry:yn,currentTool:Et,drawingMode:ti,traceToolLayer:vi,padToolLayer:ar,testPointToolLayer:_t,componentToolLayer:Fn,updateToolSettings:_n,updateToolLayerSettings:Qt,setBrushSize:Ut,saveToolSettings:Jn,saveToolLayerSettings:Lt,setTopTraceSize:Xn,setBottomTraceSize:ci,setTopPadSize:ri,setBottomPadSize:Br,setTopTestPointSize:Di,setBottomTestPointSize:Ni,setTopComponentSize:Ns,setBottomComponentSize:ha,setComponentConnectionSize:Na,saveDefaultSize:dr,onClose:()=>ta(!1)}),l.jsx(mC,{visible:Hs,toolRegistry:yn,currentTool:Et,drawingMode:ti,traceToolLayer:vi,padToolLayer:ar,testPointToolLayer:_t,componentToolLayer:Fn,updateToolSettings:_n,updateToolLayerSettings:Qt,saveToolSettings:Jn,saveToolLayerSettings:Lt,setBrushColor:zi,setTopTraceColor:On,setBottomTraceColor:Qo,setTopPadColor:wi,setBottomPadColor:fa,setTopTestPointColor:Ea,setBottomTestPointColor:el,setTopComponentColor:tl,setBottomComponentColor:Ga,setComponentConnectionColor:ud,saveDefaultColor:nl,colorPalette:Ht,onClose:()=>Gl(!1)})]})},xC=({visible:s,canvasSize:e={width:960,height:600},canvasPosition:t={left:244,top:6},onDismiss:n})=>{const r=U.useRef(null),o=U.useRef(null),[d,c]=U.useState(!0),h=U.useCallback(()=>{r.current&&(r.current.pause(),r.current.src="",r.current.load()),c(!1),n&&n()},[n]);return U.useEffect(()=>{s&&c(!0)},[s]),U.useEffect(()=>{if(!s)return;const f=()=>{h()};return document.addEventListener("click",f,{once:!0}),document.addEventListener("mousedown",f,{once:!0}),()=>{document.removeEventListener("click",f),document.removeEventListener("mousedown",f)}},[s,h]),U.useEffect(()=>{s&&d&&r.current?r.current.play().catch(f=>{console.warn("Video autoplay failed:",f)}):(!s||!d)&&r.current&&r.current&&(r.current.pause(),r.current.src="",r.current.load())},[s,d]),s?l.jsxs("div",{ref:o,style:{position:"absolute",left:0,top:0,right:0,bottom:0,pointerEvents:"none",zIndex:10},children:[d&&l.jsx("video",{ref:r,src:"/PCB_Reverse_Engineering_Tool/SplashLoop.mp4",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,style:{position:"absolute",left:`${t.left}px`,top:`${t.top}px`,width:`${e.width}px`,height:`${e.height}px`,objectFit:"cover",pointerEvents:"none",zIndex:1}}),l.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",padding:"24px 32px",background:"rgba(255, 255, 255, 0.85)",borderRadius:8,border:"2px solid #4CAF50",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",maxWidth:"500px",pointerEvents:"auto",zIndex:2},children:[l.jsx("div",{style:{fontSize:"16px",fontWeight:600,color:"#000",marginBottom:"12px"},children:"PCB Tracer: An Electronics Tool"}),l.jsxs("div",{style:{fontSize:"16px",fontWeight:600,color:"#000",marginBottom:"16px",lineHeight:"1.5"},children:["Reverse Engineer, Troubleshoot, Repair, Signal Trace,",l.jsx("br",{}),"Document Test Results"]}),l.jsx("div",{style:{fontSize:"13px",color:"#555",marginBottom:"8px",lineHeight:"1.5",textAlign:"left"},children:"1) Use the File menu to start a new project."}),l.jsx("div",{style:{fontSize:"13px",color:"#555",marginBottom:"8px",lineHeight:"1.5",textAlign:"left"},children:"2) Use the Images menu to load images."}),l.jsx("div",{style:{fontSize:"13px",color:"#555",marginBottom:"12px",lineHeight:"1.5",textAlign:"left"},children:"3) Use the tools to draw vias, traces, components, etc."}),l.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"16px",textAlign:"center",fontStyle:"italic",fontWeight:"bold"},children:"Best viewed in browser's full screen mode."})]})]}):null},Q2=({visible:s,title:e,message:t,onClose:n})=>s?l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10004},onClick:r=>{r.target===r.currentTarget&&n()},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"24px",minWidth:"300px",maxWidth:"500px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"2px solid #ff4444"},onClick:r=>r.stopPropagation(),children:[l.jsxs("div",{style:{marginBottom:"16px",display:"flex",alignItems:"center",gap:"12px"},children:[l.jsx("div",{style:{fontSize:"24px",color:"#ff4444"},children:""}),l.jsx("h3",{style:{margin:0,color:"#fff",fontSize:"18px",fontWeight:600},children:e})]}),l.jsx("div",{style:{marginBottom:"20px",color:"#ddd",fontSize:"14px",lineHeight:"1.5"},children:t}),l.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:l.jsx("button",{onClick:n,style:{padding:"8px 16px",background:"#4CAF50",color:"#fff",border:"1px solid #45a049",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"OK"})})]})}):null,bC=({visible:s,selectedIds:e,selectedComponentIds:t,selectedPowerIds:n,selectedGroundIds:r,drawingStrokes:o,componentsTop:d,componentsBottom:c,powers:h,grounds:f,powerBuses:m,onClose:y,setComponentsTop:A,setComponentsBottom:v,determineViaType:N,determinePadType:T,determineTestPointType:_,onFindComponent:b,onFindStroke:H,onFindPower:R,onFindGround:M,position:B,isDragging:q,onDragStart:G,onOpenNotesDialog:X})=>{const[O,Y]=U.useState({visible:!1,title:"",message:""}),[W,I]=U.useState(()=>{const ue=localStorage.getItem("detailedInfoDialogSize");if(ue)try{return JSON.parse(ue)}catch{return{width:400,height:window.innerHeight*.8}}return{width:400,height:window.innerHeight*.8}}),[J,Z]=U.useState(!1),[Ce,ie]=U.useState({x:0,y:0,width:0,height:0});U.useEffect(()=>{if(!J)return;const ue=L=>{const Q=L.clientX-Ce.x,ee=L.clientY-Ce.y,oe=Math.max(300,Math.min(window.innerWidth-20,Ce.width+Q)),xe=Math.max(200,Math.min(window.innerHeight-20,Ce.height+ee)),re={width:oe,height:xe};I(re),localStorage.setItem("detailedInfoDialogSize",JSON.stringify(re))},E=()=>{Z(!1)};return document.addEventListener("mousemove",ue),document.addEventListener("mouseup",E),()=>{document.removeEventListener("mousemove",ue),document.removeEventListener("mouseup",E)}},[J,Ce]);const le=ue=>{ue.preventDefault(),ue.stopPropagation(),Z(!0),ie({x:ue.clientX,y:ue.clientY,width:W.width,height:W.height})};if(!s)return null;const se=B?{position:"fixed",left:`${B.x}px`,top:`${B.y}px`,backgroundColor:"#fff",borderRadius:8,minWidth:"300px",width:`${W.width}px`,height:`${W.height}px`,maxHeight:`${window.innerHeight-20}px`,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",border:"1px solid #ddd",zIndex:1e4,display:"flex",flexDirection:"column",cursor:q?"grabbing":"default"}:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"transparent",display:"flex",alignItems:"flex-start",justifyContent:"flex-end",paddingRight:"20px",paddingTop:"80px",zIndex:1e4,pointerEvents:"none"},Ae={padding:"20px",overflow:"auto",flex:1};return l.jsxs("div",{style:se,children:[l.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",flexDirection:"column",...B?{}:{backgroundColor:"#fff",borderRadius:8,minWidth:"300px",width:`${W.width}px`,height:`${W.height}px`,maxHeight:`${window.innerHeight-20}px`,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",border:"1px solid #ddd",pointerEvents:"auto"}},children:[l.jsxs("div",{onMouseDown:ue=>{const E=ue.target;E.tagName==="BUTTON"||E.closest("button")||B&&G(ue)},style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px",borderBottom:"1px solid #e0e0e0",background:"#888",cursor:q?"grabbing":B?"grab":"default",userSelect:"none",flexShrink:0},children:[l.jsx("h2",{style:{margin:0,fontSize:"12px",color:"#fff",fontWeight:600},children:"Information (I)"}),l.jsx("button",{onClick:y,style:{background:"transparent",border:"none",fontSize:"14px",cursor:"pointer",color:"#fff",padding:0,width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]}),l.jsx("div",{style:Ae,children:l.jsxs("div",{style:{margin:0,padding:0,backgroundColor:"#f5f5f5",borderRadius:4,fontSize:"12px",fontFamily:"monospace",maxHeight:"calc(80vh - 100px)",overflow:"auto",color:"#000"},children:[(()=>{const ue=o.filter(oe=>e.has(oe.id)).length,E=[...d,...c].filter(oe=>t.has(oe.id)).length,L=h.filter(oe=>n.has(oe.id)).length,Q=f.filter(oe=>r.has(oe.id)).length,ee=ue+E+L+Q;return l.jsx("div",{style:{padding:"12px 16px",backgroundColor:ee>0?"#e8e8e8":"#fff3cd",borderBottom:"2px solid #ccc",fontSize:"13px",fontWeight:600,color:ee>0?"#333":"#856404",marginBottom:"8px"},children:ee>0?`${ee} Object${ee!==1?"s":""} Selected`:"Zero Objects Selected"})})(),t.size>0&&(()=>{const ue=o.some(E=>e.has(E.id)&&(E.type==="via"||E.type==="pad"));return[...d,...c].filter(E=>t.has(E.id)).map(E=>{const L=Vc(E),Q=L?.fields,ee=Q&&Q.length>0?l.jsx("div",{style:{marginTop:"6px",marginBottom:"6px",padding:"4px 0"},children:Q.map(oe=>{const xe=E[oe.name];if(xe==null||xe==="")return null;const re=E[`${oe.name}Unit`],Le=typeof xe=="boolean"?xe?"Yes":"No":xe;return l.jsxs("div",{style:{fontSize:"11px",color:"#444",marginBottom:"2px"},children:[oe.label,": ",Le,re?` ${re}`:""]},oe.name)})}):l.jsx("div",{style:{padding:"6px 0",fontSize:"11px",color:"#856404",background:"#fff3cd",border:"1px solid #ffeeba",borderRadius:4,marginTop:"6px",marginBottom:"6px"},children:"Component definition missing for this instance. Please ensure componentDefinitions.json entry and componentDefinitionKey are set."});return l.jsxs("div",{style:{marginTop:"16px",padding:0,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{backgroundColor:"#000",marginBottom:"12px",display:"flex",flexDirection:"column",gap:"4px",padding:"8px 12px",minHeight:"32px"},children:[l.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:l.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Category:"}),l.jsx("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:L?.category||"N/A"})]})}),l.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Type:"}),l.jsx("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:L?.displayName?E.componentType==="Capacitor"&&!L.displayName.toLowerCase().includes("capacitor")?`${L.displayName} Capacitor`:L.displayName:E.componentType==="GenericComponent"&&E.genericType?wc(E.genericType):E.componentType==="Diode"&&E.diodeType&&E.diodeType!=="Standard"?wc(E.diodeType):E.componentType==="VariableResistor"&&E.vrType&&E.vrType!=="Potentiometer"?wc(E.vrType):E.componentType==="Capacitor"&&E.dielectric==="Tantalum"?"Tantalum Capacitor":E.componentType==="Capacitor"&&E.capacitorType==="Electrolytic"?"Electrolytic Capacitor":E.componentType==="Capacitor"&&E.capacitorType==="Film"?"Film Capacitor":wc(E.componentType)})]}),b&&l.jsx("button",{onClick:()=>{b(E.id,E.x,E.y)},style:{padding:"2px 8px",fontSize:"10px",backgroundColor:"#4CAF50",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:500,whiteSpace:"nowrap",marginLeft:"8px"},onMouseEnter:oe=>{oe.currentTarget.style.backgroundColor="#45a049"},onMouseLeave:oe=>{oe.currentTarget.style.backgroundColor="#4CAF50"},children:"Find"})]})]}),l.jsxs("div",{style:{fontSize:"11px",color:"#666",marginTop:"8px"},children:[ee,l.jsxs("div",{children:["Layer: ",E.layer]}),E.componentType==="IntegratedCircuit"&&l.jsxs(l.Fragment,{children:[E.description&&l.jsxs("div",{children:["Description: ",E.description]}),E.icType&&l.jsxs("div",{children:["IC Type: ",E.icType]})]}),l.jsxs("div",{style:{marginTop:"4px",display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#666",whiteSpace:"nowrap",flexShrink:0},children:"Notes:"}),l.jsx("input",{type:"text",value:E.notes||"",readOnly:!0,onClick:X,placeholder:"Click to edit notes...",maxLength:200,style:{flex:1,padding:"4px 6px",fontSize:"11px",fontFamily:"sans-serif",backgroundColor:"#f9f9f9",color:"#333",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",minWidth:0}})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[l.jsxs("span",{children:["Designator: ",E.designator||"(empty)"]}),ue&&l.jsx("button",{onClick:()=>{const oe=[...d,...c].filter(K=>t.has(K.id)&&K.componentType===E.componentType),xe=oe.length,re=o.filter(K=>e.has(K.id)&&K.type==="pad"&&K.points.length>0&&K.points[0].id!==void 0).map(K=>{const jt=K.points[0].id;if(jt===void 0)throw new Error("Unexpected undefined id");return{stroke:K,nodeId:jt}}).sort((K,jt)=>K.nodeId-jt.nodeId),Le=re.length>0?re:o.filter(K=>e.has(K.id)&&K.type==="via"&&K.points.length>0&&K.points[0].id!==void 0).map(K=>{const jt=K.points[0].id;if(jt===void 0)throw new Error("Unexpected undefined id");return{stroke:K,nodeId:jt}}).sort((K,jt)=>K.nodeId-jt.nodeId),Ee=Le.length;if(Ee===0){console.warn("No vias or pads with Node IDs found in selection");return}const Oe=Math.floor(Ee/xe);if(Oe===0){console.warn(`Not enough ${re.length>0?"pads":"vias"} (${Ee}) for ${xe} components`);return}const Ze=Vc(oe[0]);if(Ze?.fixedPinCount!==!1){const K=oe[0]?.pinCount??Ze?.defaultPins??Oe;if(oe.every($t=>($t.pinCount??Ze?.defaultPins)===K)||console.warn("Selected components have different pin counts"),Oe!==K){const $t=re.length>0?"pads":"vias";console.warn(`Cannot change pin count for ${E.componentType}. Expected ${K} ${$t} per component, but got ${Oe}. This component has a fixed pin count.`),Y({visible:!0,title:"Cannot Connect Components",message:`${E.componentType} has a fixed pin count of ${K}. Please select exactly ${K*xe} ${$t} (${K} per component).`});return}}[...oe].sort((K,jt)=>K.id.localeCompare(jt.id)).forEach((K,jt)=>{const $t=jt*Oe,Yt=$t+Oe,on=Le.slice($t,Yt).map(Ne=>Ne.nodeId.toString()),ze=qm(K,on,o);K.layer==="top"?A(Ne=>Ne.map(Ct=>{if(Ct.id===K.id){const wt={...Ct,pinCount:Oe,pinConnections:on};if(ze&&(wt.pinPolarities=ze),Ct.pinNames){const it=Ct.pinNames||[];wt.pinNames=new Array(Oe).fill("").map((pt,Ot)=>Ot<it.length?it[Ot]:"")}return wt}return Ct})):v(Ne=>Ne.map(Ct=>{if(Ct.id===K.id){const wt={...Ct,pinCount:Oe,pinConnections:on};if(ze&&(wt.pinPolarities=ze),Ct.pinNames){const it=Ct.pinNames||[];wt.pinNames=new Array(Oe).fill("").map((pt,Ot)=>Ot<it.length?it[Ot]:"")}return wt}return Ct}))});const Mt=re.length>0?"pads":"vias";console.log(`Connected ${xe} components of type ${E.componentType} to ${Ee} ${Mt} (${Oe} pins each)`)},style:{padding:"2px 8px",fontSize:"10px",backgroundColor:"#4CAF50",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:500,whiteSpace:"nowrap"},onMouseEnter:oe=>{oe.currentTarget.style.backgroundColor="#45a049"},onMouseLeave:oe=>{oe.currentTarget.style.backgroundColor="#4CAF50"},children:"Connect"})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("span",{children:"Color:"}),l.jsx("div",{style:{width:"16px",height:"16px",backgroundColor:E.color,border:"1px solid #ccc",borderRadius:2}}),l.jsx("span",{children:E.color})]}),l.jsxs("div",{children:["Size: ",E.size]}),l.jsxs("div",{children:["Pin Count: ",E.pinCount]}),E.componentType==="Resistor"&&l.jsxs(l.Fragment,{children:[E.resistance&&l.jsxs("div",{children:["Resistance: ",E.resistance]}),E.power&&l.jsxs("div",{children:["Power: ",E.power]}),E.tolerance&&l.jsxs("div",{children:["Tolerance: ",E.tolerance]})]}),E.componentType==="Capacitor"&&l.jsxs(l.Fragment,{children:[E.capacitance&&l.jsxs("div",{children:["Capacitance: ",E.capacitance]}),E.voltage&&l.jsxs("div",{children:["Voltage: ",E.voltage]}),E.dielectric&&l.jsxs("div",{children:["Dielectric: ",E.dielectric]}),E.tolerance&&l.jsxs("div",{children:["Tolerance: ",E.tolerance]})]}),E.componentType==="Electrolytic Capacitor"&&l.jsxs(l.Fragment,{children:[E.capacitance&&l.jsxs("div",{children:["Capacitance: ",E.capacitance]}),E.voltage&&l.jsxs("div",{children:["Voltage: ",E.voltage]}),E.tolerance&&l.jsxs("div",{children:["Tolerance: ",E.tolerance]}),E.polarized!==void 0&&l.jsxs("div",{children:["Polarized: ",E.polarized?"Yes":"No"]}),E.esr&&l.jsxs("div",{children:["ESR: ",E.esr]}),E.temperature&&l.jsxs("div",{children:["Temperature: ",E.temperature]})]}),E.pinConnections&&E.pinConnections.length>0&&(()=>{const oe=Sp(E),xe=Vc(E),re=E?.pinNames,Le=xe?.properties?.pinNames,Oe=Le&&Le.length>0;return l.jsxs("div",{style:{marginTop:"8px",marginBottom:"8px"},children:[l.jsx("div",{style:{marginBottom:"4px",fontWeight:600},children:"Pin Connections:"}),l.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"10px",border:"1px solid #ddd"},children:[l.jsx("thead",{children:l.jsxs("tr",{style:{backgroundColor:"#f0f0f0"},children:[l.jsx("th",{style:{padding:"4px 8px",textAlign:"left",border:"1px solid #ddd",fontWeight:600},children:"Pin #"}),Oe&&l.jsx("th",{style:{padding:"4px 8px",textAlign:"left",border:"1px solid #ddd",fontWeight:600},children:"Pin Name"}),oe&&l.jsx("th",{style:{padding:"4px 8px",textAlign:"left",border:"1px solid #ddd",fontWeight:600},children:"Polarity"}),l.jsx("th",{style:{padding:"4px 8px",textAlign:"left",border:"1px solid #ddd",fontWeight:600},children:"Node ID"})]})}),l.jsx("tbody",{children:E.pinConnections.map((Ze,st)=>{const mt=E.pinPolarities&&E.pinPolarities.length>st?E.pinPolarities[st]:"",Mt=re&&st<re.length?re[st]:"",K=Le&&st<Le.length?Le[st]:"",jt=K==="CHIP_DEPENDENT",$t=Mt&&Mt.trim()!==""?Mt:jt?"":K;return l.jsxs("tr",{style:{backgroundColor:st%2===0?"#fff":"#f9f9f9"},children:[l.jsx("td",{style:{padding:"4px 8px",border:"1px solid #ddd"},children:st+1}),Oe&&l.jsx("td",{style:{padding:"4px 8px",border:"1px solid #ddd",fontSize:"9px",fontStyle:"italic",color:"#555"},children:$t||"-"}),oe&&l.jsx("td",{style:{padding:"4px 8px",border:"1px solid #ddd",textAlign:"center",fontFamily:"monospace",fontWeight:600,color:mt==="+"?"#d32f2f":mt==="-"?"#1976d2":"#999"},children:mt||"-"}),l.jsx("td",{style:{padding:"4px 8px",border:"1px solid #ddd"},children:Ze||"(not connected)"})]},st)})})]})]})})(),"manufacturer"in E&&E.manufacturer&&l.jsxs("div",{children:["Manufacturer: ",E.manufacturer]}),"partNumber"in E&&E.partNumber&&l.jsxs("div",{children:["Part Number: ",E.partNumber]}),E.componentType==="Diode"&&l.jsxs(l.Fragment,{children:[E.diodeType&&l.jsxs("div",{children:["Type: ",E.diodeType]}),E.voltage&&l.jsxs("div",{children:["Voltage: ",E.voltage]}),E.current&&l.jsxs("div",{children:["Current: ",E.current]}),E.ledColor&&l.jsxs("div",{children:["LED Color: ",E.ledColor]})]}),E.componentType==="Battery"&&l.jsxs(l.Fragment,{children:[E.voltage&&l.jsxs("div",{children:["Voltage: ",E.voltage]}),E.capacity&&l.jsxs("div",{children:["Capacity: ",E.capacity]}),E.chemistry&&l.jsxs("div",{children:["Chemistry: ",E.chemistry]})]}),E.componentType==="Fuse"&&l.jsxs(l.Fragment,{children:[E.current&&l.jsxs("div",{children:["Current: ",E.current]}),E.voltage&&l.jsxs("div",{children:["Voltage: ",E.voltage]}),E.fuseType&&l.jsxs("div",{children:["Type: ",E.fuseType]})]}),E.componentType==="FerriteBead"&&l.jsxs(l.Fragment,{children:[E.impedance&&l.jsxs("div",{children:["Impedance: ",E.impedance]}),E.current&&l.jsxs("div",{children:["Current: ",E.current]})]}),E.componentType==="Connector"&&l.jsxs(l.Fragment,{children:[E.connectorType&&l.jsxs("div",{children:["Type: ",E.connectorType]}),E.gender&&l.jsxs("div",{children:["Gender: ",E.gender]})]}),E.componentType==="Jumper"&&l.jsx(l.Fragment,{children:E.positions&&l.jsxs("div",{children:["Positions: ",E.positions]})}),E.componentType==="Relay"&&l.jsxs(l.Fragment,{children:[E.coilVoltage&&l.jsxs("div",{children:["Coil Voltage: ",E.coilVoltage]}),E.contactType&&l.jsxs("div",{children:["Contact Type: ",E.contactType]}),E.current&&l.jsxs("div",{children:["Current: ",E.current]})]}),E.componentType==="Inductor"&&l.jsxs(l.Fragment,{children:[E.inductance&&l.jsxs("div",{children:["Inductance: ",E.inductance]}),E.current&&l.jsxs("div",{children:["Current: ",E.current]}),E.resistance&&l.jsxs("div",{children:["DC Resistance: ",E.resistance]})]}),E.componentType==="Speaker"&&l.jsxs(l.Fragment,{children:[E.impedance&&l.jsxs("div",{children:["Impedance: ",E.impedance]}),E.power&&l.jsxs("div",{children:["Power: ",E.power]})]}),E.componentType==="Motor"&&l.jsxs(l.Fragment,{children:[E.motorType&&l.jsxs("div",{children:["Type: ",E.motorType]}),E.voltage&&l.jsxs("div",{children:["Voltage: ",E.voltage]}),E.current&&l.jsxs("div",{children:["Current: ",E.current]})]}),E.componentType==="PowerSupply"&&l.jsxs(l.Fragment,{children:[E.inputVoltage&&l.jsxs("div",{children:["Input Voltage: ",E.inputVoltage]}),E.outputVoltage&&l.jsxs("div",{children:["Output Voltage: ",E.outputVoltage]}),E.current&&l.jsxs("div",{children:["Current: ",E.current]})]}),E.componentType==="Transistor"&&l.jsxs(l.Fragment,{children:[E.transistorType&&l.jsxs("div",{children:["Type: ",E.transistorType]}),E.polarized!==void 0&&l.jsxs("div",{children:["Polarized: ",E.polarized?"Yes":"No"]}),E.voltage&&l.jsxs("div",{children:["Voltage: ",E.voltage]}),E.current&&l.jsxs("div",{children:["Current: ",E.current]})]}),E.componentType==="ResistorNetwork"&&l.jsxs(l.Fragment,{children:[E.resistance&&l.jsxs("div",{children:["Resistance: ",E.resistance]}),E.configuration&&l.jsxs("div",{children:["Configuration: ",E.configuration]})]}),E.componentType==="Thermistor"&&l.jsxs(l.Fragment,{children:[E.resistance&&l.jsxs("div",{children:["Resistance: ",E.resistance]}),E.thermistorType&&l.jsxs("div",{children:["Type: ",E.thermistorType]}),E.beta&&l.jsxs("div",{children:["Beta: ",E.beta]})]}),E.componentType==="Switch"&&l.jsxs(l.Fragment,{children:[E.switchType&&l.jsxs("div",{children:["Type: ",E.switchType]}),E.current&&l.jsxs("div",{children:["Current: ",E.current]}),E.voltage&&l.jsxs("div",{children:["Voltage: ",E.voltage]})]}),E.componentType==="Transformer"&&l.jsxs(l.Fragment,{children:[E.primaryVoltage&&l.jsxs("div",{children:["Primary Voltage: ",E.primaryVoltage]}),E.secondaryVoltage&&l.jsxs("div",{children:["Secondary Voltage: ",E.secondaryVoltage]}),E.power&&l.jsxs("div",{children:["Power: ",E.power]}),E.turns&&l.jsxs("div",{children:["Turns Ratio: ",E.turns]})]}),E.componentType==="TestPoint"&&l.jsx(l.Fragment,{children:E.signal&&l.jsxs("div",{children:["Signal: ",E.signal]})}),E.componentType==="IntegratedCircuit"&&l.jsxs(l.Fragment,{children:[E.datasheet&&(()=>{const oe=E.datasheet.trim(),xe=oe.match(/^https?:\/\//)?oe:`https://${oe}`;return l.jsxs("div",{children:["Datasheet URL:"," ",l.jsx("a",{href:xe,target:"_blank",rel:"noopener noreferrer",style:{color:"#0066cc",textDecoration:"underline"},children:oe})]})})(),E.datasheetFileName&&(()=>{const xe=E.datasheetFileName.split("/").pop();return l.jsxs("div",{children:["Datasheet File:"," ",l.jsxs("span",{style:{color:"#666",fontStyle:"italic"},title:"Re-choose the datasheet file in Component Properties to open it",children:[xe," (re-choose file to open)"]})]})})()]}),E.componentType==="VacuumTube"&&l.jsx(l.Fragment,{children:E.tubeType&&l.jsxs("div",{children:["Type: ",E.tubeType]})}),E.componentType==="VariableResistor"&&l.jsxs(l.Fragment,{children:[E.vrType&&l.jsxs("div",{children:["Type: ",E.vrType]}),E.resistance&&l.jsxs("div",{children:["Resistance: ",E.resistance]}),E.power&&l.jsxs("div",{children:["Power: ",E.power]}),E.taper&&l.jsxs("div",{children:["Taper: ",E.taper]})]}),E.componentType==="Crystal"&&l.jsxs(l.Fragment,{children:[E.frequency&&l.jsxs("div",{children:["Frequency: ",E.frequency]}),E.loadCapacitance&&l.jsxs("div",{children:["Load Capacitance: ",E.loadCapacitance]}),E.tolerance&&l.jsxs("div",{children:["Tolerance: ",E.tolerance]})]}),E.componentType==="GenericComponent"&&l.jsxs(l.Fragment,{children:[E.genericType&&l.jsxs("div",{children:["Type: ",E.genericType]}),E.voltage&&l.jsxs("div",{children:["Voltage: ",E.voltage," ",E.voltageUnit||"V"]}),E.current&&l.jsxs("div",{children:["Current: ",E.current," ",E.currentUnit||"A"]}),E.power&&l.jsxs("div",{children:["Power: ",E.power]}),E.frequency&&l.jsxs("div",{children:["Frequency: ",E.frequency]}),E.model&&l.jsxs("div",{children:["Model: ",E.model]})]}),l.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid #eee",fontSize:"10px",color:"#999"},children:l.jsxs("div",{children:["Position: x=",E.x.toFixed(2),", y=",E.y.toFixed(2)]})})]})]},E.id)})})(),e.size>0&&o.filter(ue=>e.has(ue.id)&&ue.type==="via"&&ue.points.length>0).map(ue=>{const E=ue.points[0],L=ue.viaType||(E.id!==void 0?N(E.id,m):"Via");return l.jsxs("div",{style:{marginTop:"16px",padding:0,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{backgroundColor:"#000",marginBottom:"12px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",minHeight:"32px"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Type:"}),l.jsx("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:L})]}),H&&l.jsx("button",{onClick:()=>{H(ue.id,E.x,E.y)},style:{padding:"2px 8px",fontSize:"10px",backgroundColor:"#4CAF50",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:500,whiteSpace:"nowrap",marginLeft:"8px"},onMouseEnter:Q=>{Q.currentTarget.style.backgroundColor="#45a049"},onMouseLeave:Q=>{Q.currentTarget.style.backgroundColor="#4CAF50"},children:"Find"})]}),l.jsxs("div",{style:{fontSize:"11px",color:"#666",marginTop:"8px"},children:[E.id&&l.jsxs("div",{children:["Node ID: ",E.id]}),l.jsx("div",{children:"Layer: Top and Bottom"}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("span",{children:"Color:"}),l.jsx("div",{style:{width:"16px",height:"16px",backgroundColor:ue.color,border:"1px solid #ccc",borderRadius:2}}),l.jsx("span",{children:ue.color})]}),l.jsxs("div",{children:["Size: ",ue.size]}),l.jsxs("div",{children:["Position: x=",E.x.toFixed(2),", y=",E.y.toFixed(2)]}),l.jsxs("div",{style:{marginTop:"4px",display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#666",whiteSpace:"nowrap",flexShrink:0},children:"Notes:"}),l.jsx("input",{type:"text",value:ue.notes||"",readOnly:!0,onClick:X,placeholder:"Click to edit notes...",maxLength:200,style:{flex:1,padding:"4px 6px",fontSize:"11px",fontFamily:"sans-serif",backgroundColor:"#f9f9f9",color:"#333",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",minWidth:0}})]})]})]},ue.id)}),e.size>0&&o.filter(ue=>e.has(ue.id)&&ue.type==="pad"&&ue.points.length>0).map(ue=>{const E=ue.points[0],L=ue.padType||(E.id!==void 0?T(E.id,m):"Pad");return l.jsxs("div",{style:{marginTop:"16px",padding:0,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{backgroundColor:"#000",marginBottom:"12px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",minHeight:"32px"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Type:"}),l.jsx("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:L})]}),H&&l.jsx("button",{onClick:()=>{H(ue.id,E.x,E.y)},style:{padding:"2px 8px",fontSize:"10px",backgroundColor:"#4CAF50",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:500,whiteSpace:"nowrap",marginLeft:"8px"},onMouseEnter:Q=>{Q.currentTarget.style.backgroundColor="#45a049"},onMouseLeave:Q=>{Q.currentTarget.style.backgroundColor="#4CAF50"},children:"Find"})]}),l.jsxs("div",{style:{fontSize:"11px",color:"#666",marginTop:"8px"},children:[E.id&&l.jsxs("div",{children:["Node ID: ",E.id]}),l.jsxs("div",{children:["Layer: ",ue.layer]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("span",{children:"Color:"}),l.jsx("div",{style:{width:"16px",height:"16px",backgroundColor:ue.color,border:"1px solid #ccc",borderRadius:2}}),l.jsx("span",{children:ue.color})]}),l.jsxs("div",{children:["Size: ",ue.size]}),l.jsxs("div",{children:["Position: x=",E.x.toFixed(2),", y=",E.y.toFixed(2)]}),l.jsxs("div",{style:{marginTop:"4px",display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#666",whiteSpace:"nowrap",flexShrink:0},children:"Notes:"}),l.jsx("input",{type:"text",value:ue.notes||"",readOnly:!0,onClick:X,placeholder:"Click to edit notes...",maxLength:200,style:{flex:1,padding:"4px 6px",fontSize:"11px",fontFamily:"sans-serif",backgroundColor:"#f9f9f9",color:"#333",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",minWidth:0}})]})]})]},ue.id)}),e.size>0&&o.filter(ue=>e.has(ue.id)&&ue.type==="testPoint"&&ue.points.length>0).map(ue=>{const E=ue.points[0],L=E.id!==void 0?_(E.id,m):"Test Point";return l.jsxs("div",{style:{marginTop:"16px",padding:0,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{backgroundColor:"#000",marginBottom:"12px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",minHeight:"32px"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Type:"}),l.jsx("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:L})]}),H&&l.jsx("button",{onClick:()=>{H(ue.id,E.x,E.y)},style:{padding:"2px 8px",fontSize:"10px",backgroundColor:"#4CAF50",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:500,whiteSpace:"nowrap",marginLeft:"8px"},onMouseEnter:Q=>{Q.currentTarget.style.backgroundColor="#45a049"},onMouseLeave:Q=>{Q.currentTarget.style.backgroundColor="#4CAF50"},children:"Find"})]}),l.jsxs("div",{style:{fontSize:"11px",color:"#666",marginTop:"8px"},children:[E.id&&l.jsxs("div",{children:["Node ID: ",E.id]}),l.jsxs("div",{children:["Layer: ",ue.layer]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("span",{children:"Color:"}),l.jsx("div",{style:{width:"16px",height:"16px",backgroundColor:ue.color,border:"1px solid #ccc",borderRadius:2}}),l.jsx("span",{children:ue.color})]}),l.jsxs("div",{children:["Size: ",ue.size]}),l.jsxs("div",{children:["Position: x=",E.x.toFixed(2),", y=",E.y.toFixed(2)]}),l.jsxs("div",{style:{marginTop:"4px",display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#666",whiteSpace:"nowrap",flexShrink:0},children:"Notes:"}),l.jsx("input",{type:"text",value:ue.notes||"",readOnly:!0,onClick:X,placeholder:"Click to edit notes...",maxLength:200,style:{flex:1,padding:"4px 6px",fontSize:"11px",fontFamily:"sans-serif",backgroundColor:"#f9f9f9",color:"#333",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",minWidth:0}})]})]})]},ue.id)}),e.size>0&&o.filter(ue=>e.has(ue.id)&&ue.type==="trace").map(ue=>{const E=ue.points.length>0?ue.points.reduce((Q,ee)=>Q+ee.x,0)/ue.points.length:0,L=ue.points.length>0?ue.points.reduce((Q,ee)=>Q+ee.y,0)/ue.points.length:0;return l.jsxs("div",{style:{marginTop:"16px",padding:0,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{backgroundColor:"#000",marginBottom:"12px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",minHeight:"32px"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Type:"}),l.jsx("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:ue.type||"unknown"})]}),H&&ue.points.length>0&&l.jsx("button",{onClick:()=>{H(ue.id,E,L)},style:{padding:"2px 8px",fontSize:"10px",backgroundColor:"#4CAF50",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:500,whiteSpace:"nowrap",marginLeft:"8px"},onMouseEnter:Q=>{Q.currentTarget.style.backgroundColor="#45a049"},onMouseLeave:Q=>{Q.currentTarget.style.backgroundColor="#4CAF50"},children:"Find"})]}),l.jsxs("div",{style:{fontSize:"11px",color:"#666",marginTop:"8px"},children:[ue.points.length>0&&l.jsxs("div",{style:{marginTop:"8px",marginBottom:"8px"},children:[l.jsxs("div",{style:{marginBottom:"4px",fontWeight:600},children:["Points: ",ue.points.length]}),l.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"10px",border:"1px solid #ddd"},children:[l.jsx("thead",{children:l.jsxs("tr",{style:{backgroundColor:"#f0f0f0"},children:[l.jsx("th",{style:{padding:"4px 8px",textAlign:"left",border:"1px solid #ddd",fontWeight:600},children:"Point #"}),l.jsx("th",{style:{padding:"4px 8px",textAlign:"left",border:"1px solid #ddd",fontWeight:600},children:"x"}),l.jsx("th",{style:{padding:"4px 8px",textAlign:"left",border:"1px solid #ddd",fontWeight:600},children:"y"}),l.jsx("th",{style:{padding:"4px 8px",textAlign:"left",border:"1px solid #ddd",fontWeight:600},children:"Node ID"})]})}),l.jsx("tbody",{children:ue.points.map((Q,ee)=>l.jsxs("tr",{style:{backgroundColor:ee%2===0?"#fff":"#f9f9f9"},children:[l.jsx("td",{style:{padding:"4px 8px",border:"1px solid #ddd"},children:ee}),l.jsx("td",{style:{padding:"4px 8px",border:"1px solid #ddd"},children:Q.x.toFixed(2)}),l.jsx("td",{style:{padding:"4px 8px",border:"1px solid #ddd"},children:Q.y.toFixed(2)}),l.jsx("td",{style:{padding:"4px 8px",border:"1px solid #ddd"},children:Q.id||"(none)"})]},ee))})]})]}),l.jsxs("div",{style:{marginTop:"4px"},children:["Layer: ",ue.layer]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("span",{children:"Color:"}),l.jsx("div",{style:{width:"16px",height:"16px",backgroundColor:ue.color,border:"1px solid #ccc",borderRadius:2}}),l.jsx("span",{children:ue.color})]}),l.jsxs("div",{children:["Size: ",ue.size]}),l.jsxs("div",{style:{marginTop:"4px",display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#666",whiteSpace:"nowrap",flexShrink:0},children:"Notes:"}),l.jsx("input",{type:"text",value:ue.notes||"",readOnly:!0,onClick:X,placeholder:"Click to edit notes...",maxLength:200,style:{flex:1,padding:"4px 6px",fontSize:"11px",fontFamily:"sans-serif",backgroundColor:"#f9f9f9",color:"#333",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",minWidth:0}})]})]})]},ue.id)}),n.size>0&&h.filter(ue=>n.has(ue.id)).map(ue=>{const E=m.find(L=>L.id===ue.powerBusId);return l.jsxs("div",{style:{marginTop:"16px",padding:0,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{backgroundColor:"#000",marginBottom:"12px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",minHeight:"32px"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Type:"}),l.jsx("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:ue.type||(E?`${E.name} Power Node`:"Power Node")})]}),R&&l.jsx("button",{onClick:()=>{R(ue.id,ue.x,ue.y)},style:{padding:"2px 8px",fontSize:"10px",backgroundColor:"#4CAF50",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:500,whiteSpace:"nowrap",marginLeft:"8px"},onMouseEnter:L=>{L.currentTarget.style.backgroundColor="#45a049"},onMouseLeave:L=>{L.currentTarget.style.backgroundColor="#4CAF50"},children:"Find"})]}),l.jsxs("div",{style:{fontSize:"11px",color:"#666",marginTop:"8px"},children:[l.jsxs("div",{children:["Node ID: ",ue.pointId||"(not assigned)"]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("span",{children:"Color:"}),l.jsx("div",{style:{width:"16px",height:"16px",backgroundColor:ue.color,border:"1px solid #ccc",borderRadius:2}}),l.jsx("span",{children:ue.color})]}),l.jsxs("div",{children:["Size: ",ue.size]}),l.jsxs("div",{children:["Layer: ",ue.layer]}),l.jsxs("div",{children:["Power Bus: ",E?.name||ue.powerBusId||"(unknown)"]}),l.jsxs("div",{children:["Position: x=",ue.x.toFixed(2),", y=",ue.y.toFixed(2)]}),l.jsxs("div",{style:{marginTop:"4px",display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#666",whiteSpace:"nowrap",flexShrink:0},children:"Notes:"}),l.jsx("input",{type:"text",value:ue.notes||"",readOnly:!0,onClick:X,placeholder:"Click to edit notes...",maxLength:200,style:{flex:1,padding:"4px 6px",fontSize:"11px",fontFamily:"sans-serif",backgroundColor:"#f9f9f9",color:"#333",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",minWidth:0}})]})]})]},ue.id)}),r.size>0&&f.filter(ue=>r.has(ue.id)).map(ue=>l.jsxs("div",{style:{marginTop:"16px",padding:0,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{backgroundColor:"#000",marginBottom:"12px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",minHeight:"32px"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Type:"}),l.jsx("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:ue.type||"Ground Node"})]}),M&&l.jsx("button",{onClick:()=>{M(ue.id,ue.x,ue.y)},style:{padding:"2px 8px",fontSize:"10px",backgroundColor:"#4CAF50",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:500,whiteSpace:"nowrap",marginLeft:"8px"},onMouseEnter:E=>{E.currentTarget.style.backgroundColor="#45a049"},onMouseLeave:E=>{E.currentTarget.style.backgroundColor="#4CAF50"},children:"Find"})]}),l.jsxs("div",{style:{fontSize:"11px",color:"#666",marginTop:"8px"},children:[l.jsxs("div",{children:["Node ID: ",ue.pointId||"(not assigned)"]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("span",{children:"Color:"}),l.jsx("div",{style:{width:"16px",height:"16px",backgroundColor:ue.color,border:"1px solid #ccc",borderRadius:2}}),l.jsx("span",{children:ue.color})]}),l.jsxs("div",{children:["Size: ",ue.size]}),l.jsxs("div",{children:["Position: x=",ue.x.toFixed(2),", y=",ue.y.toFixed(2)]}),l.jsxs("div",{style:{marginTop:"4px",display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#666",whiteSpace:"nowrap",flexShrink:0},children:"Notes:"}),l.jsx("input",{type:"text",value:ue.notes||"",readOnly:!0,onClick:X,placeholder:"Click to edit notes...",maxLength:200,style:{flex:1,padding:"4px 6px",fontSize:"11px",fontFamily:"sans-serif",backgroundColor:"#f9f9f9",color:"#333",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",minWidth:0}})]})]})]},ue.id))]})}),l.jsx("div",{onMouseDown:le,style:{position:"absolute",bottom:0,right:0,width:"20px",height:"20px",cursor:"nwse-resize",background:"linear-gradient(135deg, transparent 0%, transparent 40%, #ccc 40%, #ccc 45%, transparent 45%, transparent 55%, #ccc 55%, #ccc 60%, transparent 60%)",zIndex:10001},title:"Drag to resize"})]}),l.jsx(Q2,{visible:O.visible,title:O.title,message:O.message,onClose:()=>Y({visible:!1,title:"",message:""})})]})},Bs=500,vC=({visible:s,selectedIds:e,selectedComponentIds:t,selectedPowerIds:n,selectedGroundIds:r,drawingStrokes:o,componentsTop:d,componentsBottom:c,powers:h,grounds:f,powerBuses:m,onClose:y,setComponentsTop:A,setComponentsBottom:v,setDrawingStrokes:N,setPowerSymbols:T,setGroundSymbols:_,determineViaType:b,determinePadType:H,determineTestPointType:R,position:M,isDragging:B,onDragStart:q})=>{const[G,X]=U.useState(new Map),O=U.useRef(""),[Y,W]=U.useState(()=>{const re=localStorage.getItem("notesDialogSize");if(re)try{return JSON.parse(re)}catch{return{width:400,height:window.innerHeight*.8}}return{width:400,height:window.innerHeight*.8}}),[I,J]=U.useState(!1),[Z,Ce]=U.useState({x:0,y:0,width:0,height:0}),ie=()=>[...Array.from(e).sort(),...Array.from(t).sort(),...Array.from(n).sort(),...Array.from(r).sort()].join(",");U.useEffect(()=>{if(!s)return;const re=ie();re!==O.current&&(O.current=re,X(Le=>{const Ee=new Map;return[...d,...c].filter(Oe=>t.has(Oe.id)).forEach(Oe=>{const Ze=Le.get(Oe.id);Ee.set(Oe.id,Ze!==void 0?Ze:Oe.notes||"")}),o.filter(Oe=>e.has(Oe.id)).forEach(Oe=>{const Ze=Le.get(Oe.id);Ee.set(Oe.id,Ze!==void 0?Ze:Oe.notes||"")}),h.filter(Oe=>n.has(Oe.id)).forEach(Oe=>{const Ze=Le.get(Oe.id);Ee.set(Oe.id,Ze!==void 0?Ze:Oe.notes||"")}),f.filter(Oe=>r.has(Oe.id)).forEach(Oe=>{const Ze=Le.get(Oe.id);Ee.set(Oe.id,Ze!==void 0?Ze:Oe.notes||"")}),Ee}))},[s,e,t,n,r,o,d,c,h,f]),U.useEffect(()=>{if(!I)return;const re=Ee=>{const Oe=Ee.clientX-Z.x,Ze=Ee.clientY-Z.y,st=Math.max(300,Math.min(window.innerWidth-20,Z.width+Oe)),mt=Math.max(200,Math.min(window.innerHeight-20,Z.height+Ze)),Mt={width:st,height:mt};W(Mt),localStorage.setItem("notesDialogSize",JSON.stringify(Mt))},Le=()=>{J(!1)};return document.addEventListener("mousemove",re),document.addEventListener("mouseup",Le),()=>{document.removeEventListener("mousemove",re),document.removeEventListener("mouseup",Le)}},[I,Z]);const le=re=>{re.preventDefault(),re.stopPropagation(),J(!0),Ce({x:re.clientX,y:re.clientY,width:Y.width,height:Y.height})};if(!s)return null;const se=M?{position:"fixed",left:`${M.x}px`,top:`${M.y}px`,backgroundColor:"#fff",borderRadius:8,minWidth:"300px",width:`${Y.width}px`,height:`${Y.height}px`,maxHeight:`${window.innerHeight-20}px`,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",border:"1px solid #ddd",zIndex:1e4,display:"flex",flexDirection:"column",cursor:B?"grabbing":"default"}:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"transparent",display:"flex",alignItems:"flex-start",justifyContent:"flex-end",paddingRight:"20px",paddingTop:"80px",zIndex:1e4,pointerEvents:"none"},Ae={padding:"20px",overflow:"auto",flex:1},ue=o.filter(re=>e.has(re.id)).length,E=[...d,...c].filter(re=>t.has(re.id)).length,L=h.filter(re=>n.has(re.id)).length,Q=f.filter(re=>r.has(re.id)).length,ee=ue+E+L+Q,oe=(re,Le)=>{const Ee=Le.length>Bs?Le.substring(0,Bs):Le;X(Oe=>{const Ze=new Map(Oe);return Ze.set(re,Ee),Ze})},xe=()=>{A(re=>re.map(Le=>{if(t.has(Le.id)&&G.has(Le.id)){const Ee=G.get(Le.id)||"";return{...Le,notes:Ee.trim()===""?void 0:Ee.trim()}}return Le})),v(re=>re.map(Le=>{if(t.has(Le.id)&&G.has(Le.id)){const Ee=G.get(Le.id)||"";return{...Le,notes:Ee.trim()===""?void 0:Ee.trim()}}return Le})),N(re=>re.map(Le=>{if(e.has(Le.id)&&G.has(Le.id)){const Ee=G.get(Le.id)||"";return{...Le,notes:Ee.trim()===""?null:Ee.trim()}}return Le})),T(re=>re.map(Le=>{if(n.has(Le.id)&&G.has(Le.id)){const Ee=G.get(Le.id)||"";return{...Le,notes:Ee.trim()===""?null:Ee.trim()}}return Le})),_(re=>re.map(Le=>{if(r.has(Le.id)&&G.has(Le.id)){const Ee=G.get(Le.id)||"";return{...Le,notes:Ee.trim()===""?null:Ee.trim()}}return Le}))};return l.jsx("div",{style:se,children:l.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",flexDirection:"column",...M?{}:{backgroundColor:"#fff",borderRadius:8,minWidth:"300px",width:`${Y.width}px`,height:`${Y.height}px`,maxHeight:`${window.innerHeight-20}px`,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",border:"1px solid #ddd",pointerEvents:"auto"}},children:[l.jsxs("div",{onMouseDown:re=>{const Le=re.target;Le.tagName==="BUTTON"||Le.closest("button")||M&&q(re)},style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px",borderBottom:"1px solid #e0e0e0",background:"#888",cursor:B?"grabbing":M?"grab":"default",userSelect:"none",flexShrink:0},children:[l.jsx("h2",{style:{margin:0,fontSize:"12px",color:"#fff",fontWeight:600},children:"Notes (N)"}),l.jsx("button",{onClick:y,style:{background:"transparent",border:"none",fontSize:"14px",cursor:"pointer",color:"#fff",padding:0,width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]}),l.jsx("div",{style:Ae,children:l.jsxs("div",{style:{margin:0,padding:0,backgroundColor:"#f5f5f5",borderRadius:4,fontSize:"12px",fontFamily:"monospace",maxHeight:"calc(80vh - 100px)",overflow:"auto",color:"#000"},children:[l.jsx("div",{style:{padding:"12px 16px",backgroundColor:ee>0?"#e8e8e8":"#fff3cd",borderBottom:"2px solid #ccc",fontSize:"13px",fontWeight:600,color:ee>0?"#333":"#856404",marginBottom:"8px"},children:ee>0?`${ee} Object${ee!==1?"s":""} Selected`:"Zero Objects Selected"}),ee===0?l.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#666"},children:"No objects selected. Select one or more objects to add or edit notes."}):l.jsxs(l.Fragment,{children:[[...d,...c].filter(re=>t.has(re.id)).map(re=>{const Le=G.get(re.id)||"",Ee=Le.length;return l.jsxs("div",{style:{marginTop:"8px",padding:0,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{backgroundColor:"#000",marginBottom:"8px",display:"flex",alignItems:"center",padding:"8px 12px",minHeight:"32px"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Type: "}),l.jsxs("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:[wc(re.componentType),re.designator&&re.designator.trim()?` (${re.designator.trim()})`:""]})]}),l.jsxs("div",{style:{padding:"8px"},children:[l.jsx("textarea",{value:Le,onChange:Oe=>oe(re.id,Oe.target.value),placeholder:"Enter notes (max 200 characters)...",maxLength:Bs,style:{width:"100%",minHeight:"50px",padding:"8px",fontSize:"11px",fontFamily:"sans-serif",backgroundColor:"#fff",color:"#000",border:"1px solid #ccc",borderRadius:4,resize:"vertical",boxSizing:"border-box"}}),l.jsxs("div",{style:{marginTop:"4px",fontSize:"10px",color:Ee>=Bs?"#d32f2f":"#666",textAlign:"right"},children:[Ee," / ",Bs]})]})]},re.id)}),o.filter(re=>e.has(re.id)&&re.type==="via"&&re.points.length>0).map(re=>{const Le=re.points[0],Ee=re.viaType||(Le.id!==void 0?b(Le.id,m):"Via"),Oe=G.get(re.id)||"",Ze=Oe.length;return l.jsxs("div",{style:{marginTop:"8px",padding:0,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{backgroundColor:"#000",marginBottom:"8px",display:"flex",alignItems:"center",padding:"8px 12px",minHeight:"32px"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Type: "}),l.jsx("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:Ee})]}),l.jsxs("div",{style:{padding:"8px"},children:[l.jsx("div",{style:{fontSize:"11px",color:"#666",marginBottom:"4px"},children:Le.id&&l.jsxs("div",{children:["Node ID: ",Le.id]})}),l.jsx("textarea",{value:Oe,onChange:st=>oe(re.id,st.target.value),placeholder:"Enter notes (max 200 characters)...",maxLength:Bs,style:{width:"100%",minHeight:"50px",padding:"8px",fontSize:"11px",fontFamily:"sans-serif",backgroundColor:"#fff",color:"#000",border:"1px solid #ccc",borderRadius:4,resize:"vertical",boxSizing:"border-box"}}),l.jsxs("div",{style:{marginTop:"4px",fontSize:"10px",color:Ze>=Bs?"#d32f2f":"#666",textAlign:"right"},children:[Ze," / ",Bs]})]})]},re.id)}),o.filter(re=>e.has(re.id)&&re.type==="pad"&&re.points.length>0).map(re=>{const Le=re.points[0],Ee=re.padType||(Le.id!==void 0?H(Le.id,m):"Pad"),Oe=G.get(re.id)||"",Ze=Oe.length;return l.jsxs("div",{style:{marginTop:"8px",padding:0,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{backgroundColor:"#000",marginBottom:"8px",display:"flex",alignItems:"center",padding:"8px 12px",minHeight:"32px"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Type: "}),l.jsx("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:Ee})]}),l.jsxs("div",{style:{padding:"8px"},children:[l.jsx("div",{style:{fontSize:"11px",color:"#666",marginBottom:"4px"},children:Le.id&&l.jsxs("div",{children:["Node ID: ",Le.id]})}),l.jsx("textarea",{value:Oe,onChange:st=>oe(re.id,st.target.value),placeholder:"Enter notes (max 200 characters)...",maxLength:Bs,style:{width:"100%",minHeight:"50px",padding:"8px",fontSize:"11px",fontFamily:"sans-serif",backgroundColor:"#fff",color:"#000",border:"1px solid #ccc",borderRadius:4,resize:"vertical",boxSizing:"border-box"}}),l.jsxs("div",{style:{marginTop:"4px",fontSize:"10px",color:Ze>=Bs?"#d32f2f":"#666",textAlign:"right"},children:[Ze," / ",Bs]})]})]},re.id)}),o.filter(re=>e.has(re.id)&&re.type==="testPoint"&&re.points.length>0).map(re=>{const Le=re.points[0],Ee=Le.id!==void 0?R(Le.id,m):"Test Point",Oe=G.get(re.id)||"",Ze=Oe.length;return l.jsxs("div",{style:{marginTop:"8px",padding:0,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{backgroundColor:"#000",marginBottom:"8px",display:"flex",alignItems:"center",padding:"8px 12px",minHeight:"32px"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Type: "}),l.jsx("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:Ee})]}),l.jsxs("div",{style:{padding:"8px"},children:[l.jsx("div",{style:{fontSize:"11px",color:"#666",marginBottom:"4px"},children:Le.id&&l.jsxs("div",{children:["Node ID: ",Le.id]})}),l.jsx("textarea",{value:Oe,onChange:st=>oe(re.id,st.target.value),placeholder:"Enter notes (max 200 characters)...",maxLength:Bs,style:{width:"100%",minHeight:"50px",padding:"8px",fontSize:"11px",fontFamily:"sans-serif",backgroundColor:"#fff",color:"#000",border:"1px solid #ccc",borderRadius:4,resize:"vertical",boxSizing:"border-box"}}),l.jsxs("div",{style:{marginTop:"4px",fontSize:"10px",color:Ze>=Bs?"#d32f2f":"#666",textAlign:"right"},children:[Ze," / ",Bs]})]})]},re.id)}),o.filter(re=>e.has(re.id)&&re.type==="trace").map(re=>{const Le=G.get(re.id)||"",Ee=Le.length;return l.jsxs("div",{style:{marginTop:"8px",padding:0,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{backgroundColor:"#000",marginBottom:"8px",display:"flex",alignItems:"center",padding:"8px 12px",minHeight:"32px"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Type: "}),l.jsx("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:re.type||"unknown"})]}),l.jsxs("div",{style:{padding:"8px"},children:[l.jsx("textarea",{value:Le,onChange:Oe=>oe(re.id,Oe.target.value),placeholder:"Enter notes (max 200 characters)...",maxLength:Bs,style:{width:"100%",minHeight:"50px",padding:"8px",fontSize:"11px",fontFamily:"sans-serif",backgroundColor:"#fff",color:"#000",border:"1px solid #ccc",borderRadius:4,resize:"vertical",boxSizing:"border-box"}}),l.jsxs("div",{style:{marginTop:"4px",fontSize:"10px",color:Ee>=Bs?"#d32f2f":"#666",textAlign:"right"},children:[Ee," / ",Bs]})]})]},re.id)}),h.filter(re=>n.has(re.id)).map(re=>{const Le=m.find(st=>st.id===re.powerBusId),Ee=re.type||(Le?`${Le.name} Power Node`:"Power Node"),Oe=G.get(re.id)||"",Ze=Oe.length;return l.jsxs("div",{style:{marginTop:"8px",padding:0,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{backgroundColor:"#000",marginBottom:"8px",display:"flex",alignItems:"center",padding:"8px 12px",minHeight:"32px"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Type: "}),l.jsx("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:Ee})]}),l.jsxs("div",{style:{padding:"8px"},children:[l.jsx("div",{style:{fontSize:"11px",color:"#666",marginBottom:"4px"},children:l.jsxs("div",{children:["Node ID: ",re.pointId||"(not assigned)"]})}),l.jsx("textarea",{value:Oe,onChange:st=>oe(re.id,st.target.value),placeholder:"Enter notes (max 200 characters)...",maxLength:Bs,style:{width:"100%",minHeight:"50px",padding:"8px",fontSize:"11px",fontFamily:"sans-serif",backgroundColor:"#fff",color:"#000",border:"1px solid #ccc",borderRadius:4,resize:"vertical",boxSizing:"border-box"}}),l.jsxs("div",{style:{marginTop:"4px",fontSize:"10px",color:Ze>=Bs?"#d32f2f":"#666",textAlign:"right"},children:[Ze," / ",Bs]})]})]},re.id)}),f.filter(re=>r.has(re.id)).map(re=>{const Le=re.type||"Ground Node",Ee=G.get(re.id)||"",Oe=Ee.length;return l.jsxs("div",{style:{marginTop:"8px",padding:0,backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{backgroundColor:"#000",marginBottom:"8px",display:"flex",alignItems:"center",padding:"8px 12px",minHeight:"32px"},children:[l.jsx("label",{style:{fontSize:"11px",color:"#fff",marginRight:"8px"},children:"Type: "}),l.jsx("div",{style:{color:"#fff",padding:"4px 8px",fontSize:"12px",fontWeight:500},children:Le})]}),l.jsxs("div",{style:{padding:"8px"},children:[l.jsx("div",{style:{fontSize:"11px",color:"#666",marginBottom:"4px"},children:l.jsxs("div",{children:["Node ID: ",re.pointId||"(not assigned)"]})}),l.jsx("textarea",{value:Ee,onChange:Ze=>oe(re.id,Ze.target.value),placeholder:"Enter notes (max 200 characters)...",maxLength:Bs,style:{width:"100%",minHeight:"50px",padding:"8px",fontSize:"11px",fontFamily:"sans-serif",backgroundColor:"#fff",color:"#000",border:"1px solid #ccc",borderRadius:4,resize:"vertical",boxSizing:"border-box"}}),l.jsxs("div",{style:{marginTop:"4px",fontSize:"10px",color:Oe>=Bs?"#d32f2f":"#666",textAlign:"right"},children:[Oe," / ",Bs]})]})]},re.id)}),l.jsxs("div",{style:{marginTop:"20px",padding:"12px",display:"flex",justifyContent:"flex-end",gap:"8px",borderTop:"1px solid #ddd"},children:[l.jsx("button",{onClick:y,style:{padding:"8px 16px",fontSize:"12px",backgroundColor:"#757575",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:500},onMouseEnter:re=>{re.currentTarget.style.backgroundColor="#616161"},onMouseLeave:re=>{re.currentTarget.style.backgroundColor="#757575"},children:"Close"}),l.jsx("button",{onClick:xe,style:{padding:"8px 16px",fontSize:"12px",backgroundColor:"#2196F3",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:500},onMouseEnter:re=>{re.currentTarget.style.backgroundColor="#1976D2"},onMouseLeave:re=>{re.currentTarget.style.backgroundColor="#2196F3"},children:"Save"})]})]})]})}),l.jsx("div",{onMouseDown:le,style:{position:"absolute",bottom:0,right:0,width:"20px",height:"20px",cursor:"nwse-resize",background:"linear-gradient(135deg, transparent 0%, transparent 40%, #ccc 40%, #ccc 45%, transparent 45%, transparent 55%, #ccc 55%, #ccc 60%, transparent 60%)",zIndex:10001},title:"Drag to resize"})]})})},wC=({visible:s,projectNotes:e,setProjectNotes:t,onClose:n,position:r,isDragging:o,onDragStart:d})=>{const[c,h]=U.useState([]),[f,m]=U.useState(null),[y,A]=U.useState(null),v=U.useRef(new Map),[N,T]=U.useState({width:Math.min(window.innerWidth*.85,1400),height:window.innerHeight*.7}),[_,b]=U.useState(!1),[H,R]=U.useState({x:0,y:0,width:0,height:0}),[M,B]=U.useState("");U.useEffect(()=>{s&&(h([...e]),m(null),A(null),B(""))},[s,e]);const q=M.trim()===""?c:c.filter(se=>{const Ae=M.toLowerCase(),ue=se.name.toLowerCase().includes(Ae),E=se.value.toLowerCase().includes(Ae);return ue||E});U.useEffect(()=>{if(!_)return;const se=ue=>{const E=ue.clientX-H.x,L=ue.clientY-H.y,Q=Math.max(400,Math.min(window.innerWidth-20,H.width+E)),ee=Math.max(300,Math.min(window.innerHeight-20,H.height+L));T({width:Q,height:ee})},Ae=()=>{b(!1)};return document.addEventListener("mousemove",se),document.addEventListener("mouseup",Ae),()=>{document.removeEventListener("mousemove",se),document.removeEventListener("mouseup",Ae)}},[_,H]);const G=se=>{se.preventDefault(),se.stopPropagation(),b(!0),R({x:se.clientX,y:se.clientY,width:N.width,height:N.height})};if(!s)return null;const X=()=>{const se={name:"",value:"",checked:!1};h([...c,se]),m(c.length),A("name")},O=se=>{const Ae=c.filter((ue,E)=>E!==se);h(Ae),f===se?(m(null),A(null)):f!==null&&f>se&&m(f-1)},Y=()=>{const se=c.filter(Ae=>Ae.name.trim()!==""||Ae.value.trim()!=="");t(se),n()},W=()=>{h([...e]),m(null),A(null),n()},I=(se,Ae,ue)=>{const E=[...c];E[se]={...E[se],[Ae]:ue},h(E)},J=(se,Ae)=>{const ue=[...c];ue[se]={...ue[se],checked:Ae},h(ue)},Z=(se,Ae,ue)=>{se.stopPropagation();const E=se.currentTarget,L=E.selectionStart,Q=E.value.length,ee=E.selectionStart!==E.selectionEnd;if(!(se.key==="Enter"&&se.altKey)){if(se.key==="ArrowRight"&&!se.ctrlKey&&!se.shiftKey&&!se.altKey){if(L===Q&&!ee&&ue==="name"){se.preventDefault();const oe=`${Ae}-value`,xe=v.current.get(oe);xe&&(xe.focus(),xe.setSelectionRange(0,0))}return}if(se.key==="ArrowLeft"&&!se.ctrlKey&&!se.shiftKey&&!se.altKey){if(L===0&&!ee&&ue==="value"){se.preventDefault();const oe=`${Ae}-name`,xe=v.current.get(oe);xe&&(xe.focus(),xe.setSelectionRange(xe.value.length,xe.value.length))}return}if(se.key==="ArrowDown"&&!se.ctrlKey&&!se.shiftKey&&!se.altKey){if(se.preventDefault(),Ae<c.length-1){const oe=`${Ae+1}-${ue}`,xe=v.current.get(oe);if(xe){xe.focus();const re=Math.min(L,xe.value.length);xe.setSelectionRange(re,re)}}else{const oe=c.length;X(),setTimeout(()=>{const xe=`${oe}-${ue}`,re=v.current.get(xe);re&&(re.focus(),re.setSelectionRange(0,0))},0)}return}if(se.key==="ArrowUp"&&!se.ctrlKey&&!se.shiftKey&&!se.altKey){if(se.preventDefault(),Ae>0){const oe=`${Ae-1}-${ue}`,xe=v.current.get(oe);if(xe){xe.focus();const re=Math.min(L,xe.value.length);xe.setSelectionRange(re,re)}}return}if(se.key==="Enter"&&!se.altKey&&!se.shiftKey){if(se.preventDefault(),ue==="name"){const oe=`${Ae}-value`,xe=v.current.get(oe);xe&&(xe.focus(),xe.setSelectionRange(0,0))}else if(ue==="value")if(Ae<c.length-1){const oe=`${Ae+1}-name`,xe=v.current.get(oe);xe&&(xe.focus(),xe.setSelectionRange(0,0))}else{const oe=c.length;X(),setTimeout(()=>{const xe=`${oe}-name`,re=v.current.get(xe);re&&(re.focus(),re.setSelectionRange(0,0))},0)}return}if(se.key==="Tab"&&!se.shiftKey){if(se.preventDefault(),ue==="name"){const oe=`${Ae}-value`,xe=v.current.get(oe);xe&&(xe.focus(),xe.select())}else if(ue==="value")if(Ae<c.length-1){const oe=`${Ae+1}-name`,xe=v.current.get(oe);xe&&(xe.focus(),xe.select())}else{const oe=c.length;X(),setTimeout(()=>{const xe=`${oe}-name`,re=v.current.get(xe);re&&re.focus()},0)}return}if(se.key==="Tab"&&se.shiftKey){if(se.preventDefault(),ue==="value"){const oe=`${Ae}-name`,xe=v.current.get(oe);xe&&(xe.focus(),xe.select())}else if(ue==="name"&&Ae>0){const oe=`${Ae-1}-value`,xe=v.current.get(oe);xe&&(xe.focus(),xe.select())}return}}},Ce=(se,Ae)=>{m(se),A(Ae)},ie=()=>{},le={position:"fixed",top:r?.y??100,left:r?.x??(window.innerWidth-N.width)/2,width:`${N.width}px`,height:`${N.height}px`,backgroundColor:"#fff",borderRadius:8,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",border:"1px solid #ddd",zIndex:1e4,display:"flex",flexDirection:"column",cursor:o?"grabbing":"default",overflow:"hidden"};return l.jsxs("div",{style:le,children:[l.jsxs("div",{style:{padding:"8px 12px",borderBottom:"1px solid #e0e0e0",background:"#888",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"move",userSelect:"none"},onMouseDown:d,children:[l.jsx("h2",{style:{margin:0,fontSize:"12px",color:"#fff",fontWeight:600},children:"Project Notes / TODO List (L)"}),l.jsx("button",{onClick:W,style:{background:"transparent",border:"none",fontSize:"14px",cursor:"pointer",color:"#fff",padding:"0 4px",lineHeight:1},title:"Close",children:""})]}),l.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e0e0e0",backgroundColor:"#f5f5f5",display:"flex",gap:"8px",alignItems:"center",flexShrink:0},children:[l.jsx("input",{type:"text",value:M,onChange:se=>B(se.target.value),onKeyDown:se=>{se.key==="Enter"&&se.preventDefault()},placeholder:"Search notes...",style:{flex:1,padding:"6px 12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"13px",color:"#000",background:"#fff",outline:"none"}}),l.jsx("button",{onClick:()=>{M.trim()!==""&&B("")},style:{padding:"6px 16px",background:M.trim()!==""?"#4CAF50":"#888",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"13px",fontWeight:500,whiteSpace:"nowrap"},children:M.trim()!==""?"Clear":"Search"})]}),l.jsxs("div",{className:"project-notes-content",style:{padding:0,flex:1,overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column",minHeight:0,scrollbarWidth:"thin",scrollbarColor:"#888 #f0f0f0"},children:[l.jsxs("div",{style:{border:"none",borderTop:"1px solid #ccc",borderRadius:0,overflow:"visible",marginBottom:"16px",backgroundColor:"#e0e0e0",flexShrink:0},children:[l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"40px 1fr 3fr auto",backgroundColor:"#e0e0e0",borderBottom:"1px solid #ccc",position:"sticky",top:0,zIndex:10},children:[l.jsx("div",{style:{padding:"8px 12px",fontWeight:600,fontSize:"12px",borderRight:"1px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center",color:"#000"},children:l.jsx("label",{className:"radio-label",style:{margin:0,cursor:"default"},children:l.jsx("input",{type:"checkbox",disabled:!0,style:{opacity:.5}})})}),l.jsx("div",{style:{padding:"8px 12px",fontWeight:600,fontSize:"12px",borderRight:"1px solid #ccc",color:"#000"},children:"Item"}),l.jsx("div",{style:{padding:"8px 12px",fontWeight:600,fontSize:"12px",borderRight:"1px solid #ccc",color:"#000"},children:"Notes"}),l.jsx("div",{style:{padding:"8px 12px",fontWeight:600,fontSize:"12px",color:"#000"}})]}),l.jsx("div",{children:c.length===0?l.jsx("div",{style:{padding:"24px",textAlign:"center",color:"#999",fontSize:"13px"},children:'No notes. Click "Add Note" to create one.'}):q.length===0?l.jsxs("div",{style:{padding:"24px",textAlign:"center",color:"#999",fontSize:"13px"},children:['No matches found for "',M,'".']}):q.map(se=>{const Ae=c.findIndex(ue=>ue===se);return l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"40px 1fr 3fr auto",borderBottom:"1px solid #ccc",backgroundColor:"#fff"},children:[l.jsx("div",{style:{padding:"8px 12px",borderRight:"1px solid #ccc",display:"flex",alignItems:"center",justifyContent:"center"},children:l.jsx("label",{className:"radio-label",style:{margin:0,cursor:"pointer"},children:l.jsx("input",{type:"checkbox",checked:se.checked||!1,onChange:ue=>J(Ae,ue.target.checked)})})}),l.jsx("div",{style:{padding:"4px",borderRight:"1px solid #ccc"},children:l.jsx("textarea",{ref:ue=>{ue?v.current.set(`${Ae}-name`,ue):v.current.delete(`${Ae}-name`)},value:se.name,onChange:ue=>I(Ae,"name",ue.target.value),onFocus:()=>Ce(Ae,"name"),onBlur:ie,onKeyDown:ue=>Z(ue,Ae,"name"),placeholder:"Item name...",rows:1,style:{width:"100%",padding:"4px 6px",border:f===Ae&&y==="name"?"2px solid #0b5fff":"1px solid transparent",borderRadius:3,fontSize:"12px",backgroundColor:"#fff",color:"#000",fontFamily:"inherit",resize:"none",minHeight:"24px",lineHeight:"1.4",overflow:"hidden",outline:"none",boxSizing:"border-box"},onInput:ue=>{const E=ue.target;E.style.height="auto",E.style.height=`${E.scrollHeight}px`}})}),l.jsx("div",{style:{padding:"4px",borderRight:"1px solid #ccc"},children:l.jsx("textarea",{ref:ue=>{ue?v.current.set(`${Ae}-value`,ue):v.current.delete(`${Ae}-value`)},value:se.value,onChange:ue=>I(Ae,"value",ue.target.value),onFocus:()=>Ce(Ae,"value"),onBlur:ie,onKeyDown:ue=>Z(ue,Ae,"value"),placeholder:"Notes...",rows:1,style:{width:"100%",padding:"4px 6px",border:f===Ae&&y==="value"?"2px solid #0b5fff":"1px solid transparent",borderRadius:3,fontSize:"12px",backgroundColor:"#fff",color:"#000",fontFamily:"inherit",resize:"none",minHeight:"24px",lineHeight:"1.4",overflow:"hidden",outline:"none",boxSizing:"border-box"},onInput:ue=>{const E=ue.target;E.style.height="auto",E.style.height=`${E.scrollHeight}px`}})}),l.jsx("div",{style:{padding:"8px 12px",display:"flex",alignItems:"center",justifyContent:"center"},children:l.jsx("button",{onClick:()=>O(Ae),style:{background:"#f44336",color:"#fff",border:"none",borderRadius:3,padding:"4px 8px",cursor:"pointer",fontSize:"11px"},title:"Delete note",children:"Delete"})})]},Ae)})})]}),l.jsx("div",{style:{padding:"16px",flexShrink:0},children:l.jsx("button",{onClick:X,style:{background:"#888",color:"#fff",border:"none",borderRadius:4,padding:"8px 16px",cursor:"pointer",fontSize:"12px",fontWeight:500,alignSelf:"flex-start"},children:"+ Add Note"})})]}),l.jsxs("div",{style:{padding:"12px 16px",borderTop:"1px solid #ddd",display:"flex",justifyContent:"flex-end",gap:"8px",flexShrink:0},children:[l.jsx("button",{onClick:W,style:{background:"#f5f5f5",color:"#000",border:"1px solid #ddd",borderRadius:4,padding:"6px 16px",cursor:"pointer",fontSize:"12px"},children:"Cancel"}),l.jsx("button",{onClick:Y,style:{background:"#0b5fff",color:"#fff",border:"none",borderRadius:4,padding:"6px 16px",cursor:"pointer",fontSize:"12px",fontWeight:500},children:"Save"})]}),l.jsx("div",{onMouseDown:G,style:{position:"absolute",bottom:0,right:0,width:"20px",height:"20px",cursor:"nwse-resize",background:"linear-gradient(135deg, transparent 0%, transparent 40%, #ccc 40%, #ccc 45%, transparent 45%, transparent 55%, #ccc 55%, #ccc 60%, transparent 60%)",zIndex:10001},title:"Drag to resize"})]})},SC=({visible:s,drawingStrokes:e,onClose:t,onFindTestPoint:n,position:r,isDragging:o,onDragStart:d,determineTestPointType:c,powerBuses:h})=>{const[f,m]=U.useState("");if(U.useEffect(()=>{s&&m("")},[s]),!s)return null;const y=e.filter(T=>T.type==="testPoint"&&T.points.length>0),A=f.trim()===""?y:y.filter(T=>(T.notes||"").toLowerCase().includes(f.toLowerCase())),v=r?{position:"fixed",left:`${r.x}px`,top:`${r.y}px`,backgroundColor:"#fff",borderRadius:8,minWidth:"150px",maxWidth:"500px",width:"fit-content",maxHeight:"80%",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",border:"1px solid #ddd",zIndex:1e4,display:"flex",flexDirection:"column",cursor:o?"grabbing":"default"}:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},N={padding:"20px",overflow:"auto",flex:1};return l.jsxs("div",{style:v,children:[l.jsxs("div",{onMouseDown:T=>{const _=T.target;_.tagName==="BUTTON"||_.closest("button")||r&&d(T)},style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px",borderBottom:"1px solid #e0e0e0",background:"#888",cursor:o?"grabbing":r?"grab":"default",userSelect:"none",flexShrink:0},children:[l.jsx("h2",{style:{margin:0,fontSize:"12px",color:"#fff",fontWeight:600},children:"Test Points"}),l.jsx("button",{onClick:t,style:{background:"transparent",border:"none",fontSize:"14px",cursor:"pointer",color:"#fff",padding:0,width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]}),l.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e0e0e0",backgroundColor:"#f5f5f5",display:"flex",gap:"8px",alignItems:"center",flexShrink:0},children:[l.jsx("input",{type:"text",value:f,onChange:T=>m(T.target.value),onKeyDown:T=>{T.key==="Enter"&&T.preventDefault()},placeholder:"Search test point notes...",style:{flex:1,padding:"6px 12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"13px",color:"#000",background:"#fff",outline:"none"}}),l.jsx("button",{onClick:()=>{f.trim()!==""&&m("")},style:{padding:"6px 16px",background:f.trim()!==""?"#4CAF50":"#888",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"13px",fontWeight:500,whiteSpace:"nowrap"},children:f.trim()!==""?"Clear":"Search"})]}),l.jsx("div",{style:N,children:y.length===0?l.jsx("div",{style:{padding:"24px",textAlign:"center",color:"#999",fontSize:"13px"},children:"No test points found."}):A.length===0?l.jsxs("div",{style:{padding:"24px",textAlign:"center",color:"#999",fontSize:"13px"},children:['No matches found for "',f,'".']}):l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:A.map(T=>{const _=T.points[0],b=_.id!==void 0?c(_.id,h):"Test Point",H=b.includes("(")?b.substring(0,b.indexOf("(")).trim():b;return l.jsxs("div",{style:{padding:"12px",backgroundColor:"#fff",borderRadius:4,border:"1px solid #ddd"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[l.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{flexShrink:0},children:l.jsx("path",{d:"M 12 5 L 19 12 L 12 19 L 5 12 Z",fill:"#FFD700",stroke:"#000",strokeWidth:"1.5"})}),l.jsx("div",{style:{fontSize:"12px",fontWeight:500,color:"#000"},children:H})]}),n&&l.jsx("button",{onClick:()=>{n(T.id,_.x,_.y)},style:{padding:"4px 12px",fontSize:"11px",backgroundColor:"#4CAF50",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:500,whiteSpace:"nowrap"},onMouseEnter:R=>{R.currentTarget.style.backgroundColor="#45a049"},onMouseLeave:R=>{R.currentTarget.style.backgroundColor="#4CAF50"},children:"Find"})]}),T.notes&&T.notes.trim()!==""?l.jsx("div",{style:{fontSize:"11px",color:"#666",marginTop:"8px",padding:"8px",backgroundColor:"#f5f5f5",borderRadius:"3px",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:T.notes}):l.jsx("div",{style:{fontSize:"11px",color:"#999",fontStyle:"italic",marginTop:"8px"},children:"No notes"}),l.jsxs("div",{style:{fontSize:"10px",color:"#999",marginTop:"8px"},children:["Layer: ",T.layer," | Position: (",_.x.toFixed(2),", ",_.y.toFixed(2),")"]})]},T.id)})})})]})},AC=({visible:s,dimensions:e,onSave:t,onClose:n})=>{const[r,o]=U.useState(""),[d,c]=U.useState(""),[h,f]=U.useState("inches");U.useEffect(()=>{s&&e?(o(e.width.toString()),c(e.height.toString()),f(e.unit)):s&&(o(""),c(""),f("inches"))},[s,e]);const m=()=>{const A=parseFloat(r),v=parseFloat(d);if(isNaN(A)||A<=0){alert("Please enter a valid width greater than 0");return}if(isNaN(v)||v<=0){alert("Please enter a valid height greater than 0");return}t({width:A,height:v,unit:h}),n()},y=()=>{n()};return s?l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10004},onClick:A=>{A.target===A.currentTarget&&y()},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"24px",minWidth:"320px",maxWidth:"400px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid #444"},onClick:A=>A.stopPropagation(),children:[l.jsx("h3",{style:{margin:"0 0 20px 0",color:"#fff",fontSize:"18px",fontWeight:600},children:"Board Dimensions"}),l.jsxs("div",{style:{marginBottom:"16px"},children:[l.jsx("label",{style:{display:"block",marginBottom:"6px",color:"#ddd",fontSize:"14px"},children:"Width"}),l.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[l.jsx("input",{type:"number",step:"0.001",min:"0.001",value:r,onChange:A=>o(A.target.value),style:{flex:1,padding:"8px 12px",background:"#1f1f24",border:"1px solid #444",borderRadius:4,color:"#fff",fontSize:"14px"},placeholder:"0.000"}),l.jsxs("select",{value:h,onChange:A=>f(A.target.value),style:{padding:"8px 12px",background:"#1f1f24",border:"1px solid #444",borderRadius:4,color:"#fff",fontSize:"14px",cursor:"pointer"},children:[l.jsx("option",{value:"inches",children:"inches"}),l.jsx("option",{value:"mm",children:"mm"})]})]})]}),l.jsxs("div",{style:{marginBottom:"20px"},children:[l.jsx("label",{style:{display:"block",marginBottom:"6px",color:"#ddd",fontSize:"14px"},children:"Height"}),l.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[l.jsx("input",{type:"number",step:"0.001",min:"0.001",value:d,onChange:A=>c(A.target.value),style:{flex:1,padding:"8px 12px",background:"#1f1f24",border:"1px solid #444",borderRadius:4,color:"#fff",fontSize:"14px"},placeholder:"0.000"}),l.jsxs("select",{value:h,onChange:A=>f(A.target.value),style:{padding:"8px 12px",background:"#1f1f24",border:"1px solid #444",borderRadius:4,color:"#fff",fontSize:"14px",cursor:"pointer"},children:[l.jsx("option",{value:"inches",children:"inches"}),l.jsx("option",{value:"mm",children:"mm"})]})]})]}),l.jsx("div",{style:{marginBottom:"12px",padding:"10px",background:"#1f1f24",borderRadius:4,fontSize:"12px",color:"#bbb"},children:"This information will be used to convert pixel coordinates to real-world measurements."}),l.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[l.jsx("button",{onClick:y,style:{padding:"8px 16px",background:"#444",color:"#fff",border:"1px solid #555",borderRadius:6,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),l.jsx("button",{onClick:m,style:{padding:"8px 16px",background:"#4CAF50",color:"#fff",border:"1px solid #45a049",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"Save"})]})]})}):null},CC=({visible:s,onClose:e,topImage:t,bottomImage:n,selectedImageForTransform:r,setSelectedImageForTransform:o,transformMode:d,setTransformMode:c,updateImageTransform:h,resetImageTransform:f,setCurrentTool:m,isGrayscale:y,setIsGrayscale:A,areImagesLocked:v})=>{const[N,T]=U.useState(null),[_,b]=U.useState(!1),H=U.useRef({x:0,y:0}),R=U.useRef(null);U.useEffect(()=>{s&&N===null&&T({x:window.innerWidth-320-20,y:80})},[s,N]),U.useEffect(()=>{s||T(null)},[s]);const M=U.useCallback(ee=>{if(R.current){const oe=R.current.getBoundingClientRect();H.current={x:ee.clientX-oe.left,y:ee.clientY-oe.top},b(!0)}},[]);if(U.useEffect(()=>{if(!_)return;const ee=xe=>{const re=xe.clientX-H.current.x,Le=xe.clientY-H.current.y,Ee=R.current?.offsetWidth||320,Oe=R.current?.offsetHeight||600,Ze=Math.max(0,Math.min(re,window.innerWidth-Ee)),st=Math.max(0,Math.min(Le,window.innerHeight-Oe));T({x:Ze,y:st})},oe=()=>{b(!1)};return document.addEventListener("mousemove",ee),document.addEventListener("mouseup",oe),()=>{document.removeEventListener("mousemove",ee),document.removeEventListener("mouseup",oe)}},[_]),!s)return null;const B=t!==null,q=n!==null,G=B||q,X=B&&q,O=r||(B?"top":q?"bottom":null),Y=()=>O==="top"&&t?t.brightness??100:O==="bottom"&&n?n.brightness??100:O==="both"&&t?t.brightness??100:100,W=()=>O==="top"&&t?t.contrast??100:O==="bottom"&&n?n.contrast??100:O==="both"&&t?t.contrast??100:100,I=Y(),J=W(),Z=!G||v,Ce=()=>{if(!(!O||Z))if(O==="both"){const ee=!t?.flipX;h("both",{flipX:ee})}else{const ee=O==="top"?t?.flipX||!1:n?.flipX||!1;h(O,{flipX:!ee})}},ie=()=>{if(!(!O||Z))if(O==="both"){const ee=!t?.flipY;h("both",{flipY:ee})}else{const ee=O==="top"?t?.flipY||!1:n?.flipY||!1;h(O,{flipY:!ee})}},le=ee=>{Z||(O&&o(O),c(ee),m("transform"))},se=ee=>{!O||Z||h(O,{brightness:ee})},Ae=ee=>{!O||Z||h(O,{contrast:ee})},ue=()=>{Z||(O&&o(O),m("transform"),A(!y))},E=()=>{Z||(m("transform"),f())},L=(ee,oe=!1)=>({display:"block",width:"100%",textAlign:"left",padding:"8px 12px",color:ee?"#666":"#f2f2f2",background:oe?"#3a3a42":"transparent",border:"none",borderRadius:4,cursor:ee?"not-allowed":"pointer",fontSize:"13px",transition:"background 0.15s"}),Q=(ee,oe)=>({display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",color:ee?"#666":"#f2f2f2",cursor:ee?"not-allowed":"pointer",fontSize:"13px",background:oe?"#3a3a42":"transparent",borderRadius:4,transition:"background 0.15s"});return l.jsxs("div",{ref:R,style:{position:"fixed",top:N?.y??80,left:N?.x??window.innerWidth-340,backgroundColor:"#2b2b31",borderRadius:8,minWidth:"320px",maxWidth:"400px",maxHeight:"calc(100vh - 100px)",overflowY:"auto",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid #1f1f24",zIndex:10001},children:[l.jsxs("div",{onMouseDown:M,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 16px",background:"linear-gradient(to bottom, #3a3a42, #2b2b31)",borderTopLeftRadius:8,borderTopRightRadius:8,borderBottom:"1px solid #1f1f24",cursor:_?"grabbing":"grab",userSelect:"none"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[l.jsx("span",{style:{color:"#888",fontSize:"14px"},children:""}),l.jsx("h2",{style:{margin:0,fontSize:"14px",fontWeight:600,color:"#f2f2f2"},children:"Transform Images"})]}),l.jsx("button",{onClick:e,style:{background:"transparent",border:"none",color:"#888",fontSize:"16px",cursor:"pointer",padding:"2px 6px",lineHeight:1,borderRadius:4},onMouseEnter:ee=>{ee.currentTarget.style.background="#444",ee.currentTarget.style.color="#fff"},onMouseLeave:ee=>{ee.currentTarget.style.background="transparent",ee.currentTarget.style.color="#888"},children:""})]}),l.jsxs("div",{style:{padding:"16px"},children:[l.jsxs("div",{style:{marginBottom:"16px"},children:[l.jsx("div",{style:{fontSize:"12px",color:"#888",marginBottom:"8px",fontWeight:500},children:"Apply to:"}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[l.jsxs("label",{style:Q(!B,O==="top"),children:[l.jsx("input",{type:"radio",name:"imageSelection",checked:O==="top",onChange:()=>o("top"),disabled:!B,style:{accentColor:"#6b9fff"}}),"Top Image",!B&&l.jsx("span",{style:{fontSize:"11px",color:"#666",marginLeft:"auto"},children:"(not loaded)"})]}),l.jsxs("label",{style:Q(!q,O==="bottom"),children:[l.jsx("input",{type:"radio",name:"imageSelection",checked:O==="bottom",onChange:()=>o("bottom"),disabled:!q,style:{accentColor:"#6b9fff"}}),"Bottom Image",!q&&l.jsx("span",{style:{fontSize:"11px",color:"#666",marginLeft:"auto"},children:"(not loaded)"})]}),l.jsxs("label",{style:Q(!X,O==="both"),children:[l.jsx("input",{type:"radio",name:"imageSelection",checked:O==="both",onChange:()=>o("both"),disabled:!X,style:{accentColor:"#6b9fff"}}),"Both Images",!X&&l.jsx("span",{style:{fontSize:"11px",color:"#666",marginLeft:"auto"},children:"(need both)"})]})]})]}),l.jsx("div",{style:{height:1,background:"#444",margin:"16px 0"}}),l.jsxs("div",{style:{marginBottom:"12px"},children:[l.jsx("button",{onClick:Ce,disabled:Z,style:L(Z),onMouseEnter:ee=>!Z&&(ee.currentTarget.style.background="#3a3a42"),onMouseLeave:ee=>ee.currentTarget.style.background="transparent",children:"Horizontal Flip"}),l.jsx("button",{onClick:ie,disabled:Z,style:L(Z),onMouseEnter:ee=>!Z&&(ee.currentTarget.style.background="#3a3a42"),onMouseLeave:ee=>ee.currentTarget.style.background="transparent",children:"Vertical Flip"})]}),l.jsx("div",{style:{height:1,background:"#444",margin:"16px 0"}}),l.jsx("div",{style:{marginBottom:"12px"},children:["nudge","scale","rotate","slant","keystone"].map(ee=>l.jsxs("button",{onClick:()=>le(ee),disabled:Z,style:L(Z,d===ee),onMouseEnter:oe=>!Z&&d!==ee&&(oe.currentTarget.style.background="#3a3a42"),onMouseLeave:oe=>d!==ee&&(oe.currentTarget.style.background="transparent"),children:[d===ee?" ":"","Mode: ",ee.charAt(0).toUpperCase()+ee.slice(1)]},ee))}),l.jsx("div",{style:{height:1,background:"#444",margin:"16px 0"}}),l.jsxs("div",{style:{marginBottom:"16px"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},children:[l.jsx("label",{style:{color:"#f2f2f2",fontSize:"13px",fontWeight:500},children:"Brightness"}),l.jsxs("span",{style:{color:"#888",fontSize:"12px",minWidth:"45px",textAlign:"right"},children:[I,"%"]})]}),l.jsx("input",{type:"range",min:"0",max:"200",step:"1",value:I,onChange:ee=>se(parseInt(ee.target.value,10)),disabled:Z,style:{width:"100%",cursor:Z?"not-allowed":"pointer",accentColor:"#6b9fff"}})]}),l.jsxs("div",{style:{marginBottom:"16px"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},children:[l.jsx("label",{style:{color:"#f2f2f2",fontSize:"13px",fontWeight:500},children:"Contrast"}),l.jsxs("span",{style:{color:"#888",fontSize:"12px",minWidth:"45px",textAlign:"right"},children:[J,"%"]})]}),l.jsx("input",{type:"range",min:"0",max:"200",step:"1",value:J,onChange:ee=>Ae(parseInt(ee.target.value,10)),disabled:Z,style:{width:"100%",cursor:Z?"not-allowed":"pointer",accentColor:"#6b9fff"}})]}),l.jsx("div",{style:{height:1,background:"#444",margin:"16px 0"}}),l.jsx("div",{style:{marginBottom:"12px"},children:l.jsxs("button",{onClick:ue,disabled:Z,style:L(Z,y),onMouseEnter:ee=>!Z&&!y&&(ee.currentTarget.style.background="#3a3a42"),onMouseLeave:ee=>!y&&(ee.currentTarget.style.background="transparent"),children:[y?" ":"","Grayscale Mode"]})}),l.jsx("div",{style:{height:1,background:"#444",margin:"16px 0"}}),l.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"16px"},children:[l.jsx("button",{onClick:E,disabled:Z,style:{padding:"8px 16px",background:Z?"#444":"#555",color:Z?"#777":"#f2f2f2",border:"1px solid #666",borderRadius:6,cursor:Z?"not-allowed":"pointer",fontSize:"13px",fontWeight:500},children:"Reset Transform"}),l.jsx("button",{onClick:e,style:{padding:"8px 16px",background:"#4a9eff",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:"13px",fontWeight:500},onMouseEnter:ee=>ee.currentTarget.style.background="#3a8ee6",onMouseLeave:ee=>ee.currentTarget.style.background="#4a9eff",children:"Close"})]}),v&&l.jsx("div",{style:{marginTop:"12px",padding:"8px 12px",background:"#3d2b2b",border:"1px solid #5a3a3a",borderRadius:4,fontSize:"12px",color:"#e88"},children:" Images are locked. Unlock via Images  Lock Images to make changes."})]})]})},TC=({visible:s,onClose:e,topImage:t,bottomImage:n,setTopImage:r,setBottomImage:o,componentsTop:d,componentsBottom:c,setComponentsTop:h,setComponentsBottom:f,drawingStrokes:m,setDrawingStrokes:y,powerSymbols:A,groundSymbols:v,setPowerSymbols:N,setGroundSymbols:T,canvasRef:_,isBottomView:b,setIsBottomView:H,originalTopFlipX:R,setOriginalTopFlipX:M,originalBottomFlipX:B,setOriginalBottomFlipX:q,originalTopFlipY:G,setOriginalTopFlipY:X,originalBottomFlipY:O,setOriginalBottomFlipY:Y,cameraWorldCenter:W,setCameraWorldCenter:I,viewScale:J,viewRotation:Z,setViewRotation:Ce,viewFlipX:ie,setViewFlipX:le,contentBorder:se,setTransparency:Ae})=>{const[ue,E]=U.useState(null),[L,Q]=U.useState(!1),ee=U.useRef({x:0,y:0}),oe=U.useRef(null),xe=U.useCallback((st,mt,Mt,K)=>{const jt=window.innerWidth,$t=window.innerHeight,Yt=10,yt=Math.max(Yt,Math.min(st,jt-Mt-Yt)),on=Math.max(Yt,Math.min(mt,$t-K-Yt));return{x:yt,y:on}},[]);U.useEffect(()=>{if(s&&ue===null){const st=localStorage.getItem("transformAllDialogPosition"),mt=320,Mt=400,K=20,jt=150;let $t;if(st)try{const Yt=JSON.parse(st);$t=xe(Yt.x,Yt.y,mt,Mt)}catch{$t=xe(window.innerWidth-mt-K,jt,mt,Mt)}else $t=xe(window.innerWidth-mt-K,jt,mt,Mt);E($t)}},[s,ue,xe]);const re=U.useCallback(st=>{if(oe.current){const mt=oe.current.getBoundingClientRect();ee.current={x:st.clientX-mt.left,y:st.clientY-mt.top},Q(!0)}},[]);U.useEffect(()=>{if(!L)return;const st=Mt=>{const K=Mt.clientX-ee.current.x,jt=Mt.clientY-ee.current.y,$t=oe.current?.offsetWidth||320,Yt=oe.current?.offsetHeight||400,yt=xe(K,jt,$t,Yt);E(yt),localStorage.setItem("transformAllDialogPosition",JSON.stringify(yt))},mt=()=>{Q(!1)};return document.addEventListener("mousemove",st),document.addEventListener("mouseup",mt),()=>{document.removeEventListener("mousemove",st),document.removeEventListener("mouseup",mt)}},[L,xe]);const Le=U.useCallback(()=>{b||(le(!0),H(!0),Ae(100))},[b,le,H,Ae]),Ee=U.useCallback(()=>{b&&(le(!1),H(!1),Ae(0))},[b,le,H,Ae]),Oe=U.useCallback(st=>{Ce(mt=>Hm(mt,st))},[Ce,Hm]);if(!s)return null;const Ze=(st=!1)=>({display:"block",width:"100%",textAlign:"left",padding:"8px 12px",color:st?"#999":"#222",background:"transparent",border:"none",borderRadius:4,cursor:st?"not-allowed":"pointer",fontSize:"13px",transition:"background 0.15s"});return l.jsxs("div",{ref:oe,style:{position:"fixed",top:ue?.y??150,left:ue?.x??window.innerWidth-340,backgroundColor:"#fff",borderRadius:8,minWidth:"320px",maxWidth:"400px",maxHeight:"calc(100vh - 100px)",overflowY:"auto",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",border:"1px solid #ddd",zIndex:10001,display:"flex",flexDirection:"column"},children:[l.jsxs("div",{onMouseDown:re,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px",borderBottom:"1px solid #e0e0e0",background:"#888",cursor:L?"grabbing":"grab",userSelect:"none",flexShrink:0},children:[l.jsx("h2",{style:{margin:0,fontSize:"12px",color:"#fff",fontWeight:600},children:"Change Perspective"}),l.jsx("button",{onClick:e,style:{background:"transparent",border:"none",fontSize:"14px",cursor:"pointer",color:"#fff",padding:0,width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]}),l.jsxs("div",{style:{padding:"20px",overflow:"auto",flex:1},children:[l.jsxs("div",{style:{marginBottom:"16px"},children:[l.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px",fontWeight:500},children:"View:"}),l.jsx("button",{onClick:b?Ee:Le,style:Ze(!1),onMouseEnter:st=>st.currentTarget.style.background="#f0f0f0",onMouseLeave:st=>st.currentTarget.style.background="transparent",children:b?"Switch to Top View":"Switch to Bottom View"}),l.jsx("div",{style:{fontSize:"10px",color:"#999",marginTop:"6px",fontStyle:"italic"},children:"Shortcut: Shift-Left/Right Arrow Keys"})]}),l.jsx("div",{style:{height:1,background:"#e0e0e0",margin:"16px 0"}}),l.jsxs("div",{style:{marginBottom:"16px"},children:[l.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px",fontWeight:500},children:"Rotate (clockwise):"}),l.jsx("button",{onClick:()=>Oe(90),style:Ze(),onMouseEnter:st=>st.currentTarget.style.background="#f0f0f0",onMouseLeave:st=>st.currentTarget.style.background="transparent",children:"Rotate 90"}),l.jsx("button",{onClick:()=>Oe(180),style:Ze(),onMouseEnter:st=>st.currentTarget.style.background="#f0f0f0",onMouseLeave:st=>st.currentTarget.style.background="transparent",children:"Rotate 180"}),l.jsx("button",{onClick:()=>Oe(270),style:Ze(),onMouseEnter:st=>st.currentTarget.style.background="#f0f0f0",onMouseLeave:st=>st.currentTarget.style.background="transparent",children:"Rotate 270"}),l.jsx("div",{style:{fontSize:"10px",color:"#999",marginTop:"6px",fontStyle:"italic"},children:"Shortcut: Shift-Up/Down Arrow Keys"})]}),l.jsx("div",{style:{height:1,background:"#e0e0e0",margin:"16px 0"}}),l.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"16px"},children:l.jsx("button",{onClick:e,style:{padding:"8px 16px",background:"#4a9eff",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:"13px",fontWeight:500},onMouseEnter:st=>st.currentTarget.style.background="#3a8ee6",onMouseLeave:st=>st.currentTarget.style.background="#4a9eff",children:"Close"})})]})]})},_b=({visible:s,title:e,message:t,onClose:n,type:r="info",onShowResponse:o})=>{if(!s)return null;const d=r==="success"?"#4CAF50":"#2196F3",c=r==="success"?"#4CAF50":"#2196F3",h=r==="success"?"":"";return l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10004},onClick:f=>{f.target===f.currentTarget&&n()},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"24px",minWidth:"300px",maxWidth:"500px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:`2px solid ${c}`},onClick:f=>f.stopPropagation(),children:[l.jsxs("div",{style:{marginBottom:"16px",display:"flex",alignItems:"center",gap:"12px"},children:[l.jsx("div",{style:{fontSize:"24px",color:d},children:h}),l.jsx("h3",{style:{margin:0,color:"#fff",fontSize:"18px",fontWeight:600},children:e})]}),l.jsx("div",{style:{marginBottom:"20px",color:"#ddd",fontSize:"14px",lineHeight:"1.5",whiteSpace:"pre-line"},children:t}),l.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[o&&l.jsx("button",{onClick:()=>{o(),n()},style:{padding:"8px 16px",background:"#555",color:"#fff",border:"1px solid #666",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"Show Response"}),l.jsx("button",{onClick:n,style:{padding:"8px 16px",background:"#4CAF50",color:"#fff",border:"1px solid #45a049",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"OK"})]})]})})},kC=({component:s,componentEditor:e,componentDefinition:t,setComponentEditor:n,areComponentsLocked:r,componentsTop:o,componentsBottom:d,setComponentsTop:c,setComponentsBottom:h,uploadedDatasheetFile:f,setUploadedDatasheetFile:m})=>{if(!s||!s.id||!s.componentType||typeof s.pinCount!="number")return console.error("[ComponentTypeFields] Component missing required properties:",{comp:s,hasId:!!s?.id,hasComponentType:!!s?.componentType,componentType:s?.componentType,pinCount:s?.pinCount,pinCountType:typeof s?.pinCount}),null;const A=(t||e?.componentDefinition||Vc(s))?.fields,v=s.componentType,N=v==="IntegratedCircuit"||v==="Semiconductor",T=v==="Semiconductor",_=v==="IntegratedCircuit";if(A&&A.length>0&&!_){const b=(R,M,B)=>B?R==="capacitance"||R==="resistance"||R==="voltage"||R==="current"?"80px":R==="power"||R==="inductance"||R==="impedance"||R==="esr"||R==="ripple"||R==="leakageCurrent"?"70px":"80px":R==="tolerance"||R==="pinCount"?"60px":R==="partNumber"||R==="manufacturer"?"150px":R==="description"||R==="operatingTemperature"?"180px":M==="string"&&!R.includes("Unit")?"150px":"120px",H=R=>{const M=s.componentType,B=M==="IntegratedCircuit"||M==="Semiconductor";if(B&&R.name==="datasheet"||B&&(R.name==="manufacturer"||R.name==="partNumber")||R.name==="description")return null;const q=R.name,G=`${R.name}Unit`,X=e[q]??s[q]??R.defaultValue??"",O=e[G]??s[G]??(R.units&&R.defaultUnit?R.defaultUnit:""),Y=Z=>{n({...e,[q]:Z})},W=Z=>{n({...e,[G]:Z})},I=!!(R.units&&R.units.length>0),J=b(R.name,R.type,I);return l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"6px"},children:[l.jsxs("label",{style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:[R.label,":"]}),R.type==="enum"?l.jsx("select",{value:X,onChange:Z=>Y(Z.target.value),disabled:r,style:{width:J,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:(R.enumValues||[]).map(Z=>l.jsx("option",{value:Z,children:Z},Z))}):l.jsx("input",{type:"text",value:X,onChange:Z=>Y(Z.target.value),disabled:r,style:{width:J,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:I?"8px":"0"},placeholder:R.defaultValue!==void 0?String(R.defaultValue):""}),I&&R.units&&l.jsx("select",{value:O||R.defaultUnit||R.units[0],onChange:Z=>W(Z.target.value),disabled:r,style:{width:"70px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,flexShrink:0},children:R.units.map(Z=>l.jsx("option",{value:Z,children:Z},Z))})]},R.name)};if(!T)return l.jsx(l.Fragment,{children:A.map(H).filter(Boolean)})}return N?l.jsxs(l.Fragment,{children:[s.componentType==="Resistor"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-resistance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Resistance:"}),l.jsx("input",{id:`component-resistance-${s.id}`,type:"text",value:e.resistance||"",onChange:b=>n({...e,resistance:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 10"}),l.jsx("select",{value:e.resistanceUnit||cn("resistance"),onChange:b=>n({...e,resistanceUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("resistance").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-power-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Power:"}),l.jsxs("select",{id:`component-power-${s.id}`,value:e.power||"1/4",onChange:b=>n({...e,power:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"12px"},children:[l.jsx("option",{value:"1/20",children:"1/20 W"}),l.jsx("option",{value:"1/16",children:"1/16 W"}),l.jsx("option",{value:"1/10",children:"1/10 W"}),l.jsx("option",{value:"1/8",children:"1/8 W"}),l.jsx("option",{value:"1/4",children:"1/4 W"}),l.jsx("option",{value:"1/2",children:"1/2 W"}),l.jsx("option",{value:"1",children:"1 W"}),l.jsx("option",{value:"2",children:"2 W"}),l.jsx("option",{value:"3",children:"3 W"}),l.jsx("option",{value:"5",children:"5 W"}),l.jsx("option",{value:"10",children:"10 W"}),l.jsx("option",{value:"25",children:"25 W"}),l.jsx("option",{value:"50",children:"50 W"}),l.jsx("option",{value:"100",children:"100 W"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-tolerance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Tolerance:"}),l.jsxs("select",{id:`component-tolerance-${s.id}`,value:e.tolerance||"5%",onChange:b=>n({...e,tolerance:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"0.05%",children:"0.05%"}),l.jsx("option",{value:"0.1%",children:"0.1%"}),l.jsx("option",{value:"0.25%",children:"0.25%"}),l.jsx("option",{value:"0.5%",children:"0.5%"}),l.jsx("option",{value:"1%",children:"1%"}),l.jsx("option",{value:"2%",children:"2%"}),l.jsx("option",{value:"5%",children:"5%"}),l.jsx("option",{value:"10%",children:"10%"}),l.jsx("option",{value:"20%",children:"20%"})]})]})]}),s.componentType==="Capacitor"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-capacitance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Capacitance:"}),l.jsx("input",{id:`component-capacitance-${s.id}`,type:"text",value:e.capacitance||"",onChange:b=>n({...e,capacitance:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 100"}),l.jsx("select",{value:e.capacitanceUnit||cn("capacitance"),onChange:b=>n({...e,capacitanceUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("capacitance").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-voltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Voltage:"}),l.jsx("input",{id:`component-voltage-${s.id}`,type:"text",value:e.voltage||"",onChange:b=>n({...e,voltage:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 50"}),l.jsx("select",{value:e.voltageUnit||cn("voltage"),onChange:b=>n({...e,voltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-dielectric-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Dielectric:"}),l.jsxs("select",{id:`component-dielectric-${s.id}`,value:e.dielectric||"Ceramic",onChange:b=>n({...e,dielectric:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"Ceramic",children:"Ceramic"}),l.jsx("option",{value:"Tantalum",children:"Tantalum"}),l.jsx("option",{value:"Film",children:"Film"}),l.jsx("option",{value:"Polyester",children:"Polyester"}),l.jsx("option",{value:"Polypropylene",children:"Polypropylene"}),l.jsx("option",{value:"Mica",children:"Mica"}),l.jsx("option",{value:"Paper",children:"Paper"}),l.jsx("option",{value:"Glass",children:"Glass"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-tolerance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Tolerance:"}),l.jsxs("select",{id:`component-tolerance-${s.id}`,value:e.tolerance||"10%",onChange:b=>n({...e,tolerance:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"0.5%",children:"0.5%"}),l.jsx("option",{value:"1%",children:"1%"}),l.jsx("option",{value:"2%",children:"2%"}),l.jsx("option",{value:"5%",children:"5%"}),l.jsx("option",{value:"10%",children:"10%"}),l.jsx("option",{value:"20%",children:"20%"})]})]})]}),s.componentType==="Film Capacitor"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-capacitance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Capacitance:"}),l.jsx("input",{id:`component-capacitance-${s.id}`,type:"text",value:e.capacitance||"",onChange:b=>n({...e,capacitance:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 100"}),l.jsx("select",{value:e.capacitanceUnit||cn("capacitance"),onChange:b=>n({...e,capacitanceUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("capacitance").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-voltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Voltage:"}),l.jsx("input",{id:`component-voltage-${s.id}`,type:"text",value:e.voltage||"",onChange:b=>n({...e,voltage:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 50"}),l.jsx("select",{value:e.voltageUnit||cn("voltage"),onChange:b=>n({...e,voltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-filmtype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Film Type:"}),l.jsxs("select",{id:`component-filmtype-${s.id}`,value:e.filmType||"Polyester",onChange:b=>n({...e,filmType:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"Polyester",children:"Polyester"}),l.jsx("option",{value:"Polypropylene",children:"Polypropylene"}),l.jsx("option",{value:"Polyethylene",children:"Polyethylene"}),l.jsx("option",{value:"Polystyrene",children:"Polystyrene"}),l.jsx("option",{value:"Polycarbonate",children:"Polycarbonate"}),l.jsx("option",{value:"PTFE",children:"PTFE (Teflon)"}),l.jsx("option",{value:"PPS",children:"PPS (Polyphenylene Sulfide)"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-tolerance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Tolerance:"}),l.jsxs("select",{id:`component-tolerance-${s.id}`,value:e.tolerance||"10%",onChange:b=>n({...e,tolerance:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"0.5%",children:"0.5%"}),l.jsx("option",{value:"1%",children:"1%"}),l.jsx("option",{value:"2%",children:"2%"}),l.jsx("option",{value:"5%",children:"5%"}),l.jsx("option",{value:"10%",children:"10%"}),l.jsx("option",{value:"20%",children:"20%"})]})]})]}),s.componentType==="Electrolytic Capacitor"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-capacitance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Capacitance:"}),l.jsx("input",{id:`component-capacitance-${s.id}`,type:"text",value:e.capacitance||"",onChange:b=>n({...e,capacitance:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 100"}),l.jsxs("select",{value:e.capacitanceUnit||"F",onChange:b=>n({...e,capacitanceUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:[l.jsx("option",{value:"pF",children:"pF"}),l.jsx("option",{value:"nF",children:"nF"}),l.jsx("option",{value:"F",children:"F"}),l.jsx("option",{value:"mF",children:"mF"}),l.jsx("option",{value:"F",children:"F"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-voltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Voltage:"}),l.jsx("input",{id:`component-voltage-${s.id}`,type:"text",value:e.voltage||"",onChange:b=>n({...e,voltage:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 25"}),l.jsx("select",{value:e.voltageUnit||cn("voltage"),onChange:b=>n({...e,voltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-tolerance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Tolerance:"}),l.jsxs("select",{id:`component-tolerance-${s.id}`,value:e.tolerance||"20%",onChange:b=>n({...e,tolerance:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},children:[l.jsx("option",{value:"0.5%",children:"0.5%"}),l.jsx("option",{value:"1%",children:"1%"}),l.jsx("option",{value:"2%",children:"2%"}),l.jsx("option",{value:"5%",children:"5%"}),l.jsx("option",{value:"10%",children:"10%"}),l.jsx("option",{value:"20%",children:"20%"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-polarized-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Polarized:"}),l.jsx("input",{id:`component-polarized-${s.id}`,type:"checkbox",checked:Sp(s),disabled:!0,style:{opacity:.6,cursor:"not-allowed"},title:"Polarized is a fixed property determined by component type"})]})]}),s.componentType==="Inductor"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-inductance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Inductance:"}),l.jsx("input",{id:`component-inductance-${s.id}`,type:"text",value:e.inductance||"",onChange:b=>n({...e,inductance:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 10"}),l.jsx("select",{value:e.inductanceUnit||cn("inductance"),onChange:b=>n({...e,inductanceUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("inductance").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-current-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Current:"}),l.jsx("input",{id:`component-current-${s.id}`,type:"text",value:e.current||"",onChange:b=>n({...e,current:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 1"}),l.jsx("select",{value:e.currentUnit||cn("current"),onChange:b=>n({...e,currentUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("current").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-resistance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"DC Resistance:"}),l.jsx("input",{id:`component-resistance-${s.id}`,type:"text",value:e.resistance||"",onChange:b=>n({...e,resistance:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 50"}),l.jsx("select",{value:e.resistanceUnit||"",onChange:b=>n({...e,resistanceUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("resistance").map(b=>l.jsx("option",{value:b,children:b},b))})]})]}),s.componentType==="Diode"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-diodetype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Diode Type:"}),l.jsxs("select",{id:`component-diodetype-${s.id}`,value:e.diodeType||"Standard",onChange:b=>n({...e,diodeType:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"Standard",children:"Standard"}),l.jsx("option",{value:"Zener",children:"Zener"}),l.jsx("option",{value:"LED",children:"LED"}),l.jsx("option",{value:"Schottky",children:"Schottky"}),l.jsx("option",{value:"Infrared",children:"Infrared"}),l.jsx("option",{value:"Photodiode",children:"Photodiode"}),l.jsx("option",{value:"Other",children:"Other"})]})]}),e.diodeType==="LED"&&l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-ledcolor-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"LED Color:"}),l.jsxs("select",{id:`component-ledcolor-${s.id}`,value:e.ledColor||"",onChange:b=>n({...e,ledColor:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"",children:"Select..."}),l.jsx("option",{value:"Red",children:"Red"}),l.jsx("option",{value:"Green",children:"Green"}),l.jsx("option",{value:"Blue",children:"Blue"}),l.jsx("option",{value:"Yellow",children:"Yellow"}),l.jsx("option",{value:"Orange",children:"Orange"}),l.jsx("option",{value:"White",children:"White"}),l.jsx("option",{value:"RGB",children:"RGB"}),l.jsx("option",{value:"IR",children:"IR (Infrared)"}),l.jsx("option",{value:"UV",children:"UV (Ultraviolet)"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-voltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Voltage:"}),l.jsx("input",{id:`component-voltage-${s.id}`,type:"text",value:e.voltage||"",onChange:b=>n({...e,voltage:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 50"}),l.jsx("select",{value:e.voltageUnit||cn("voltage"),onChange:b=>n({...e,voltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-current-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Current:"}),l.jsx("input",{id:`component-current-${s.id}`,type:"text",value:e.current||"",onChange:b=>n({...e,current:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 1"}),l.jsx("select",{value:e.currentUnit||cn("current"),onChange:b=>n({...e,currentUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("current").map(b=>l.jsx("option",{value:b,children:b},b))})]})]}),s.componentType==="Battery"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-voltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Voltage:"}),l.jsx("input",{id:`component-voltage-${s.id}`,type:"text",value:e.voltage||"",onChange:b=>n({...e,voltage:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 3.7"}),l.jsx("select",{value:e.voltageUnit||"V",onChange:b=>n({...e,voltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-capacity-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Capacity:"}),l.jsx("input",{id:`component-capacity-${s.id}`,type:"text",value:e.capacity||"",onChange:b=>n({...e,capacity:b.target.value}),disabled:r,style:{width:"120px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 2000mAh"})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-chemistry-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Chemistry:"}),l.jsxs("select",{id:`component-chemistry-${s.id}`,value:e.chemistry||"Li-ion",onChange:b=>n({...e,chemistry:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"Li-ion",children:"Li-ion"}),l.jsx("option",{value:"LiPo",children:"LiPo"}),l.jsx("option",{value:"NiMH",children:"NiMH"}),l.jsx("option",{value:"NiCd",children:"NiCd"}),l.jsx("option",{value:"Alkaline",children:"Alkaline"}),l.jsx("option",{value:"Lead-Acid",children:"Lead-Acid"}),l.jsx("option",{value:"Lithium",children:"Lithium"}),l.jsx("option",{value:"Zinc-Carbon",children:"Zinc-Carbon"})]})]})]}),s.componentType==="Fuse"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-current-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Current:"}),l.jsx("input",{id:`component-current-${s.id}`,type:"text",value:e.current||"",onChange:b=>n({...e,current:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 5"}),l.jsx("select",{value:e.currentUnit||"A",onChange:b=>n({...e,currentUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("current").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-voltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Voltage:"}),l.jsx("input",{id:`component-voltage-${s.id}`,type:"text",value:e.voltage||"",onChange:b=>n({...e,voltage:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 250"}),l.jsx("select",{value:e.voltageUnit||"V",onChange:b=>n({...e,voltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-fusetype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Fuse Type:"}),l.jsxs("select",{id:`component-fusetype-${s.id}`,value:e.fuseType||"Fast-blow",onChange:b=>n({...e,fuseType:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"Fast-blow",children:"Fast-blow"}),l.jsx("option",{value:"Slow-blow",children:"Slow-blow"}),l.jsx("option",{value:"Time-delay",children:"Time-delay"}),l.jsx("option",{value:"Resettable",children:"Resettable"}),l.jsx("option",{value:"Cartridge",children:"Cartridge"}),l.jsx("option",{value:"Glass",children:"Glass"}),l.jsx("option",{value:"Ceramic",children:"Ceramic"})]})]})]}),s.componentType==="Relay"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-coilvoltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Coil Voltage:"}),l.jsx("input",{id:`component-coilvoltage-${s.id}`,type:"text",value:e.coilVoltage||"",onChange:b=>n({...e,coilVoltage:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 12"}),l.jsx("select",{value:e.coilVoltageUnit||cn("voltage"),onChange:b=>n({...e,coilVoltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-contacttype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Contact Type:"}),l.jsxs("select",{id:`component-contacttype-${s.id}`,value:e.contactType||"SPST",onChange:b=>n({...e,contactType:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"SPST",children:"SPST (Single Pole Single Throw)"}),l.jsx("option",{value:"SPDT",children:"SPDT (Single Pole Double Throw)"}),l.jsx("option",{value:"DPST",children:"DPST (Double Pole Single Throw)"}),l.jsx("option",{value:"DPDT",children:"DPDT (Double Pole Double Throw)"}),l.jsx("option",{value:"3PDT",children:"3PDT (3 Pole Double Throw)"}),l.jsx("option",{value:"4PDT",children:"4PDT (4 Pole Double Throw)"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-current-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Current:"}),l.jsx("input",{id:`component-current-${s.id}`,type:"text",value:e.current||"",onChange:b=>n({...e,current:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 10"}),l.jsx("select",{value:e.currentUnit||cn("current"),onChange:b=>n({...e,currentUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("current").map(b=>l.jsx("option",{value:b,children:b},b))})]})]}),s.componentType==="Motor"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-motortype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Motor Type:"}),l.jsxs("select",{id:`component-motortype-${s.id}`,value:e.motorType||"DC",onChange:b=>n({...e,motorType:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"DC",children:"DC Motor"}),l.jsx("option",{value:"Stepper",children:"Stepper Motor"}),l.jsx("option",{value:"Servo",children:"Servo Motor"}),l.jsx("option",{value:"Brushless",children:"Brushless DC"}),l.jsx("option",{value:"AC",children:"AC Motor"}),l.jsx("option",{value:"Synchronous",children:"Synchronous"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-voltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Voltage:"}),l.jsx("input",{id:`component-voltage-${s.id}`,type:"text",value:e.voltage||"",onChange:b=>n({...e,voltage:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 12"}),l.jsx("select",{value:e.voltageUnit||cn("voltage"),onChange:b=>n({...e,voltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-current-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Current:"}),l.jsx("input",{id:`component-current-${s.id}`,type:"text",value:e.current||"",onChange:b=>n({...e,current:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 1"}),l.jsx("select",{value:e.currentUnit||cn("current"),onChange:b=>n({...e,currentUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("current").map(b=>l.jsx("option",{value:b,children:b},b))})]})]}),s.componentType==="Switch"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-switchtype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Switch Type:"}),l.jsxs("select",{id:`component-switchtype-${s.id}`,value:e.switchType||"Toggle",onChange:b=>n({...e,switchType:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"Toggle",children:"Toggle"}),l.jsx("option",{value:"Push-button",children:"Push-button"}),l.jsx("option",{value:"Slide",children:"Slide"}),l.jsx("option",{value:"Rotary",children:"Rotary"}),l.jsx("option",{value:"DIP",children:"DIP Switch"}),l.jsx("option",{value:"Momentary",children:"Momentary"}),l.jsx("option",{value:"Latching",children:"Latching"}),l.jsx("option",{value:"Reed",children:"Reed Switch"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-current-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Current:"}),l.jsx("input",{id:`component-current-${s.id}`,type:"text",value:e.current||"",onChange:b=>n({...e,current:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 5"}),l.jsx("select",{value:e.currentUnit||cn("current"),onChange:b=>n({...e,currentUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("current").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-voltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Voltage:"}),l.jsx("input",{id:`component-voltage-${s.id}`,type:"text",value:e.voltage||"",onChange:b=>n({...e,voltage:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 250"}),l.jsx("select",{value:e.voltageUnit||cn("voltage"),onChange:b=>n({...e,voltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]})]}),s.componentType==="FerriteBead"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-impedance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Impedance:"}),l.jsx("input",{id:`component-impedance-${s.id}`,type:"text",value:e.impedance||"",onChange:b=>n({...e,impedance:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 100"}),l.jsx("select",{value:e.impedanceUnit||cn("impedance"),onChange:b=>n({...e,impedanceUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("impedance").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-current-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Current:"}),l.jsx("input",{id:`component-current-${s.id}`,type:"text",value:e.current||"",onChange:b=>n({...e,current:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 1"}),l.jsx("select",{value:e.currentUnit||cn("current"),onChange:b=>n({...e,currentUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("current").map(b=>l.jsx("option",{value:b,children:b},b))})]})]}),s.componentType==="Connector"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-connectortype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Connector Type:"}),l.jsx("input",{id:`component-connectortype-${s.id}`,type:"text",value:e.connectorType||"",onChange:b=>n({...e,connectorType:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},placeholder:"e.g., USB-A, HDMI"})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-gender-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Gender:"}),l.jsxs("select",{id:`component-gender-${s.id}`,value:e.gender||"N/A",onChange:b=>n({...e,gender:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"Male",children:"Male"}),l.jsx("option",{value:"Female",children:"Female"}),l.jsx("option",{value:"N/A",children:"N/A"})]})]})]}),s.componentType==="Jumper"&&l.jsx(l.Fragment,{children:l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-positions-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Positions:"}),l.jsx("input",{id:`component-positions-${s.id}`,type:"number",min:"2",value:e.positions||3,onChange:b=>n({...e,positions:parseInt(b.target.value)||3}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"}})]})}),s.componentType==="Speaker"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-impedance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Impedance:"}),l.jsx("input",{id:`component-impedance-${s.id}`,type:"text",value:e.impedance||"",onChange:b=>n({...e,impedance:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 8"}),l.jsx("select",{value:e.impedanceUnit||cn("impedance"),onChange:b=>n({...e,impedanceUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("impedance").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-power-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Power:"}),l.jsxs("select",{id:`component-power-${s.id}`,value:e.power||"1/4",onChange:b=>n({...e,power:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"12px"},children:[l.jsx("option",{value:"1/20",children:"1/20 W"}),l.jsx("option",{value:"1/16",children:"1/16 W"}),l.jsx("option",{value:"1/10",children:"1/10 W"}),l.jsx("option",{value:"1/8",children:"1/8 W"}),l.jsx("option",{value:"1/4",children:"1/4 W"}),l.jsx("option",{value:"1/2",children:"1/2 W"}),l.jsx("option",{value:"1",children:"1 W"}),l.jsx("option",{value:"2",children:"2 W"}),l.jsx("option",{value:"3",children:"3 W"}),l.jsx("option",{value:"5",children:"5 W"}),l.jsx("option",{value:"10",children:"10 W"}),l.jsx("option",{value:"25",children:"25 W"}),l.jsx("option",{value:"50",children:"50 W"}),l.jsx("option",{value:"100",children:"100 W"})]})]})]}),s.componentType==="PowerSupply"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-inputvoltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Input Voltage:"}),l.jsx("input",{id:`component-inputvoltage-${s.id}`,type:"text",value:e.inputVoltage||"",onChange:b=>n({...e,inputVoltage:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 120"}),l.jsx("select",{value:e.inputVoltageUnit||cn("voltage"),onChange:b=>n({...e,inputVoltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-outputvoltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Output Voltage:"}),l.jsx("input",{id:`component-outputvoltage-${s.id}`,type:"text",value:e.outputVoltage||"",onChange:b=>n({...e,outputVoltage:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 12"}),l.jsx("select",{value:e.outputVoltageUnit||cn("voltage"),onChange:b=>n({...e,outputVoltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-current-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Current:"}),l.jsx("input",{id:`component-current-${s.id}`,type:"text",value:e.current||"",onChange:b=>n({...e,current:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 1"}),l.jsx("select",{value:e.currentUnit||cn("current"),onChange:b=>n({...e,currentUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("current").map(b=>l.jsx("option",{value:b,children:b},b))})]})]}),s.componentType==="Transistor"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-transistortype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Transistor Type:"}),l.jsxs("select",{id:`component-transistortype-${s.id}`,value:e.transistorType||"BJT",onChange:b=>n({...e,transistorType:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"BJT",children:"BJT (Bipolar Junction Transistor)"}),l.jsx("option",{value:"FET",children:"FET (Field Effect Transistor)"}),l.jsx("option",{value:"MOSFET",children:"MOSFET"}),l.jsx("option",{value:"IGBT",children:"IGBT"}),l.jsx("option",{value:"JFET",children:"JFET"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-polarity-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Polarity:"}),l.jsxs("select",{id:`component-polarity-${s.id}`,value:e.polarity||"NPN",onChange:b=>n({...e,polarity:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"NPN",children:"NPN"}),l.jsx("option",{value:"PNP",children:"PNP"}),l.jsx("option",{value:"N-Channel",children:"N-Channel"}),l.jsx("option",{value:"P-Channel",children:"P-Channel"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-voltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Voltage:"}),l.jsx("input",{id:`component-voltage-${s.id}`,type:"text",value:e.voltage||"",onChange:b=>n({...e,voltage:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 50"}),l.jsx("select",{value:e.voltageUnit||cn("voltage"),onChange:b=>n({...e,voltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-current-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Current:"}),l.jsx("input",{id:`component-current-${s.id}`,type:"text",value:e.current||"",onChange:b=>n({...e,current:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 1"}),l.jsx("select",{value:e.currentUnit||cn("current"),onChange:b=>n({...e,currentUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("current").map(b=>l.jsx("option",{value:b,children:b},b))})]})]}),s.componentType==="ResistorNetwork"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-resistance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Resistance:"}),l.jsx("input",{id:`component-resistance-${s.id}`,type:"text",value:e.resistance||"",onChange:b=>n({...e,resistance:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 10"}),l.jsx("select",{value:e.resistanceUnit||cn("resistance"),onChange:b=>n({...e,resistanceUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("resistance").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-configuration-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Configuration:"}),l.jsx("input",{id:`component-configuration-${s.id}`,type:"text",value:e.configuration||"",onChange:b=>n({...e,configuration:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},placeholder:"e.g., Isolated, Bussed"})]})]}),s.componentType==="Thermistor"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-resistance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Resistance:"}),l.jsx("input",{id:`component-resistance-${s.id}`,type:"text",value:e.resistance||"",onChange:b=>n({...e,resistance:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 10"}),l.jsx("select",{value:e.resistanceUnit||cn("resistance"),onChange:b=>n({...e,resistanceUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("resistance").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-thermistortype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Thermistor Type:"}),l.jsxs("select",{id:`component-thermistortype-${s.id}`,value:e.thermistorType||"NTC",onChange:b=>n({...e,thermistorType:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"NTC",children:"NTC (Negative Temperature Coefficient)"}),l.jsx("option",{value:"PTC",children:"PTC (Positive Temperature Coefficient)"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-beta-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Beta ():"}),l.jsx("input",{id:`component-beta-${s.id}`,type:"text",value:e.beta||"",onChange:b=>n({...e,beta:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},placeholder:"e.g., 3950"})]})]}),s.componentType==="Transformer"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-primaryvoltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Primary Voltage:"}),l.jsx("input",{id:`component-primaryvoltage-${s.id}`,type:"text",value:e.primaryVoltage||"",onChange:b=>n({...e,primaryVoltage:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 120"}),l.jsx("select",{value:e.primaryVoltageUnit||cn("voltage"),onChange:b=>n({...e,primaryVoltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-secondaryvoltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Secondary Voltage:"}),l.jsx("input",{id:`component-secondaryvoltage-${s.id}`,type:"text",value:e.secondaryVoltage||"",onChange:b=>n({...e,secondaryVoltage:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 12"}),l.jsx("select",{value:e.secondaryVoltageUnit||cn("voltage"),onChange:b=>n({...e,secondaryVoltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-power-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Power:"}),l.jsxs("select",{id:`component-power-${s.id}`,value:e.power||"1/4",onChange:b=>n({...e,power:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"12px"},children:[l.jsx("option",{value:"1/20",children:"1/20 W"}),l.jsx("option",{value:"1/16",children:"1/16 W"}),l.jsx("option",{value:"1/10",children:"1/10 W"}),l.jsx("option",{value:"1/8",children:"1/8 W"}),l.jsx("option",{value:"1/4",children:"1/4 W"}),l.jsx("option",{value:"1/2",children:"1/2 W"}),l.jsx("option",{value:"1",children:"1 W"}),l.jsx("option",{value:"2",children:"2 W"}),l.jsx("option",{value:"3",children:"3 W"}),l.jsx("option",{value:"5",children:"5 W"}),l.jsx("option",{value:"10",children:"10 W"}),l.jsx("option",{value:"25",children:"25 W"}),l.jsx("option",{value:"50",children:"50 W"}),l.jsx("option",{value:"100",children:"100 W"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-turns-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Turns Ratio:"}),l.jsx("input",{id:`component-turns-${s.id}`,type:"text",value:e.turns||"",onChange:b=>n({...e,turns:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},placeholder:"e.g., 10:1"})]})]}),s.componentType==="TestPoint"&&l.jsx(l.Fragment,{children:l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-signal-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Signal:"}),l.jsx("input",{id:`component-signal-${s.id}`,type:"text",value:e.signal||"",onChange:b=>n({...e,signal:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},placeholder:"e.g., VCC, GND, CLK"})]})}),(s.componentType==="IntegratedCircuit"||s.componentType==="Semiconductor")&&l.jsxs(l.Fragment,{children:[T&&A&&A.length>0&&(()=>{const b=(q,G,X)=>X?"80px":q==="partNumber"||q==="manufacturer"?"150px":q==="description"||q==="operatingTemperature"?"180px":G==="string"&&!q.includes("Unit")?"150px":"120px",H=q=>{if(q.name==="datasheet"||q.name==="description"||q.name==="operatingTemperature"||T&&(q.name==="manufacturer"||q.name==="partNumber")||q.name==="icType"||T&&!q.name)return null;const G=q.name,X=`${q.name}Unit`,O=e[G]??s[G]??q.defaultValue??"",Y=e[X]??s[X]??(q.units&&q.defaultUnit?q.defaultUnit:""),W=Ce=>{n({...e,[G]:Ce})},I=Ce=>{n({...e,[X]:Ce})},J=!!(q.units&&q.units.length>0),Z=b(q.name,q.type,J);return l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"6px"},children:[l.jsxs("label",{style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:[q.label,":"]}),q.type==="enum"?l.jsx("select",{value:O,onChange:Ce=>W(Ce.target.value),disabled:r,style:{width:Z,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:(q.enumValues||[]).map(Ce=>l.jsx("option",{value:Ce,children:Ce},Ce))}):l.jsx("input",{type:"text",value:O,onChange:Ce=>W(Ce.target.value),disabled:r,style:{width:Z,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:J?"8px":"0"},placeholder:q.defaultValue!==void 0?String(q.defaultValue):""}),J&&q.units&&l.jsx("select",{value:Y||q.defaultUnit||q.units[0],onChange:Ce=>I(Ce.target.value),disabled:r,style:{width:"70px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,flexShrink:0},children:q.units.map(Ce=>l.jsx("option",{value:Ce,children:Ce},Ce))})]},q.name)},R=A.map(H).filter(Boolean),M=T?l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"6px"},children:[l.jsx("label",{htmlFor:`component-ictype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"IC Type:"}),l.jsxs("select",{id:`component-ictype-${s.id}`,value:e.icType||"Other",onChange:q=>n({...e,icType:q.target.value}),disabled:r,style:{width:"150px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"Op-Amp",children:"Op-Amp"}),l.jsx("option",{value:"Microcontroller",children:"Microcontroller"}),l.jsx("option",{value:"Microprocessor",children:"Microprocessor"}),l.jsx("option",{value:"Logic",children:"Logic"}),l.jsx("option",{value:"Memory",children:"Memory"}),l.jsx("option",{value:"Voltage Regulator",children:"Voltage Regulator"}),l.jsx("option",{value:"Timer",children:"Timer"}),l.jsx("option",{value:"ADC",children:"ADC (Analog-to-Digital)"}),l.jsx("option",{value:"DAC",children:"DAC (Digital-to-Analog)"}),l.jsx("option",{value:"Comparator",children:"Comparator"}),l.jsx("option",{value:"Transceiver",children:"Transceiver"}),l.jsx("option",{value:"Driver",children:"Driver"}),l.jsx("option",{value:"Amplifier",children:"Amplifier"}),l.jsx("option",{value:"Other",children:"Other"})]})]},"icType"):null,B=R.findIndex(q=>q?.key==="manufacturer");return B>=0&&M?R.splice(B+1,0,M):M&&R.push(M),R})(),_&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"6px"},children:[l.jsx("label",{htmlFor:`component-ictype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"IC Type:"}),l.jsxs("select",{id:`component-ictype-${s.id}`,value:e.icType||"Other",onChange:b=>n({...e,icType:b.target.value}),disabled:r,style:{width:"150px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},children:[l.jsx("option",{value:"Op-Amp",children:"Op-Amp"}),l.jsx("option",{value:"Microcontroller",children:"Microcontroller"}),l.jsx("option",{value:"Microprocessor",children:"Microprocessor"}),l.jsx("option",{value:"Logic",children:"Logic"}),l.jsx("option",{value:"Memory",children:"Memory"}),l.jsx("option",{value:"Voltage Regulator",children:"Voltage Regulator"}),l.jsx("option",{value:"Timer",children:"Timer"}),l.jsx("option",{value:"ADC",children:"ADC (Analog-to-Digital)"}),l.jsx("option",{value:"DAC",children:"DAC (Digital-to-Analog)"}),l.jsx("option",{value:"Comparator",children:"Comparator"}),l.jsx("option",{value:"Transceiver",children:"Transceiver"}),l.jsx("option",{value:"Driver",children:"Driver"}),l.jsx("option",{value:"Amplifier",children:"Amplifier"}),l.jsx("option",{value:"Other",children:"Other"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"6px"},children:[l.jsx("label",{htmlFor:`component-packagetype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Package Type:"}),l.jsxs("select",{id:`component-packagetype-${s.id}`,value:e.packageType||"",onChange:b=>n({...e,packageType:b.target.value}),disabled:r,style:{width:"150px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},children:[l.jsx("option",{value:"",children:"-- Select --"}),l.jsx("option",{value:"DIP",children:"DIP"}),l.jsx("option",{value:"PDIP",children:"PDIP"}),l.jsx("option",{value:"SOIC",children:"SOIC"}),l.jsx("option",{value:"QFP",children:"QFP"}),l.jsx("option",{value:"LQFP",children:"LQFP"}),l.jsx("option",{value:"TQFP",children:"TQFP"}),l.jsx("option",{value:"BGA",children:"BGA"}),l.jsx("option",{value:"SSOP",children:"SSOP"}),l.jsx("option",{value:"TSOP",children:"TSOP"}),l.jsx("option",{value:"Various",children:"Various"}),l.jsx("option",{value:"Other",children:"Other"})]})]})]})]}),s.componentType==="VacuumTube"&&l.jsx(l.Fragment,{children:l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-tubetype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Tube Type:"}),l.jsx("input",{id:`component-tubetype-${s.id}`,type:"text",value:e.tubeType||"",onChange:b=>n({...e,tubeType:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},placeholder:"e.g., 12AX7, 6L6"})]})}),s.componentType==="VariableResistor"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-vrtype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"VR Type:"}),l.jsxs("select",{id:`component-vrtype-${s.id}`,value:e.vrType||"Potentiometer",onChange:b=>n({...e,vrType:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"Potentiometer",children:"Potentiometer"}),l.jsx("option",{value:"Rheostat",children:"Rheostat"}),l.jsx("option",{value:"Trimmer",children:"Trimmer"}),l.jsx("option",{value:"Varistor",children:"Varistor"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-resistance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Resistance:"}),l.jsx("input",{id:`component-resistance-${s.id}`,type:"text",value:e.resistance||"",onChange:b=>n({...e,resistance:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 10"}),l.jsx("select",{value:e.resistanceUnit||cn("resistance"),onChange:b=>n({...e,resistanceUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("resistance").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-power-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Power:"}),l.jsxs("select",{id:`component-power-${s.id}`,value:e.power||"1/4",onChange:b=>n({...e,power:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"12px"},children:[l.jsx("option",{value:"1/20",children:"1/20 W"}),l.jsx("option",{value:"1/16",children:"1/16 W"}),l.jsx("option",{value:"1/10",children:"1/10 W"}),l.jsx("option",{value:"1/8",children:"1/8 W"}),l.jsx("option",{value:"1/4",children:"1/4 W"}),l.jsx("option",{value:"1/2",children:"1/2 W"}),l.jsx("option",{value:"1",children:"1 W"}),l.jsx("option",{value:"2",children:"2 W"}),l.jsx("option",{value:"3",children:"3 W"}),l.jsx("option",{value:"5",children:"5 W"}),l.jsx("option",{value:"10",children:"10 W"}),l.jsx("option",{value:"25",children:"25 W"}),l.jsx("option",{value:"50",children:"50 W"}),l.jsx("option",{value:"100",children:"100 W"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-taper-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Taper:"}),l.jsxs("select",{id:`component-taper-${s.id}`,value:e.taper||"Linear",onChange:b=>n({...e,taper:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"Linear",children:"Linear"}),l.jsx("option",{value:"Logarithmic",children:"Logarithmic"}),l.jsx("option",{value:"Audio",children:"Audio"})]})]})]}),s.componentType==="Crystal"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-frequency-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Frequency:"}),l.jsx("input",{id:`component-frequency-${s.id}`,type:"text",value:e.frequency||"",onChange:b=>n({...e,frequency:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},placeholder:"e.g., 16.000 MHz"})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-loadcapacitance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Load Capacitance:"}),l.jsx("input",{id:`component-loadcapacitance-${s.id}`,type:"text",value:e.loadCapacitance||"",onChange:b=>n({...e,loadCapacitance:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},placeholder:"e.g., 18pF"})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-tolerance-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Tolerance:"}),l.jsxs("select",{id:`component-tolerance-${s.id}`,value:e.tolerance||"10ppm",onChange:b=>n({...e,tolerance:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"10ppm",children:"10ppm"}),l.jsx("option",{value:"20ppm",children:"20ppm"}),l.jsx("option",{value:"30ppm",children:"30ppm"}),l.jsx("option",{value:"50ppm",children:"50ppm"}),l.jsx("option",{value:"100ppm",children:"100ppm"})]})]})]}),s.componentType==="GenericComponent"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-generictype-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Type:"}),l.jsxs("select",{id:`component-generictype-${s.id}`,value:s.genericType||"Attenuator",onChange:b=>n({...e,genericType:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},children:[l.jsx("option",{value:"Attenuator",children:"Attenuator"}),l.jsx("option",{value:"CircuitBreaker",children:"Circuit Breaker"}),l.jsx("option",{value:"Thermocouple",children:"Thermocouple"}),l.jsx("option",{value:"Tuner",children:"Tuner"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-voltage-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Voltage:"}),l.jsx("input",{id:`component-voltage-${s.id}`,type:"text",value:e.voltage||"",onChange:b=>n({...e,voltage:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 50"}),l.jsx("select",{value:e.voltageUnit||cn("voltage"),onChange:b=>n({...e,voltageUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("voltage").map(b=>l.jsx("option",{value:b,children:b},b))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-current-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Current:"}),l.jsx("input",{id:`component-current-${s.id}`,type:"text",value:e.current||"",onChange:b=>n({...e,current:b.target.value}),disabled:r,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1},placeholder:"e.g., 1"}),l.jsx("select",{value:e.currentUnit||cn("current"),onChange:b=>n({...e,currentUnit:b.target.value}),disabled:r,style:{padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,width:"60px",marginRight:"12px"},children:ir("current").map(b=>l.jsx("option",{value:b,children:b},b))})]}),s.genericType==="Tuner"&&l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-frequency-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Frequency:"}),l.jsx("input",{id:`component-frequency-${s.id}`,type:"text",value:e.frequency||"",onChange:b=>n({...e,frequency:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},placeholder:"e.g., 100MHz"})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-power-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Power:"}),l.jsx("input",{id:`component-power-${s.id}`,type:"text",value:e.power||"",onChange:b=>n({...e,power:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},placeholder:"e.g., 1W"})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-model-${s.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"90px",flexShrink:0},children:"Model:"}),l.jsx("input",{id:`component-model-${s.id}`,type:"text",value:e.model||"",onChange:b=>n({...e,model:b.target.value}),disabled:r,style:{flex:1,padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:r?.6:1,marginRight:"8px"},placeholder:"Part number or model"})]})]})]}):l.jsx("div",{style:{padding:"8px",background:"#fff3cd",border:"1px solid #ffeeba",borderRadius:4,color:"#856404",marginBottom:"8px",fontSize:"11px"},children:"Component definition missing for this instance. Using legacy fields. Please ensure the component has a definition in componentDefinitions.json and a valid componentDefinitionKey."})},wl=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),ny=[.001,0,0,.001,0,0],Rm=1.35,bc={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Hu={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},yp="pdfjs_internal_editor_",Ci={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},rr={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},_C={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},iy={TRIANGLES:1,LATTICE:2},To={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Xg={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ja={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},cf={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},d0={ERRORS:0,WARNINGS:1,INFOS:5},xp={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},ip={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},jC={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let u0=d0.WARNINGS;function NC(s){Number.isInteger(s)&&(u0=s)}function PC(){return u0}function h0(s){u0>=d0.INFOS&&console.info(`Info: ${s}`)}function xi(s){u0>=d0.WARNINGS&&console.warn(`Warning: ${s}`)}function ss(s){throw new Error(s)}function sr(s,e){s||ss(e)}function EC(s){switch(s?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function ev(s,e=null,t=null){if(!s)return null;if(t&&typeof s=="string"&&(t.addDefaultProtocol&&s.startsWith("www.")&&s.match(/\./g)?.length>=2&&(s=`http://${s}`),t.tryConvertEncoding))try{s=IC(s)}catch{}const n=e?URL.parse(s,e):URL.parse(s);return EC(n)?n:null}function tv(s,e,t=!1){const n=URL.parse(s);return n?(n.hash=e,n.href):t&&ev(s,"http://example.com")?s.split("#",1)[0]+`${e?`#${e}`:""}`:""}function bi(s,e,t,n=!1){return Object.defineProperty(s,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}const Ph=(function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e})();class jb extends Ph{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Dm extends Ph{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class ry extends Ph{constructor(e){super(e,"InvalidPDFException")}}class i0 extends Ph{constructor(e,t,n){super(e,"ResponseException"),this.status=t,this.missing=n}}class RC extends Ph{constructor(e){super(e,"FormatError")}}class Gu extends Ph{constructor(e){super(e,"AbortException")}}function nv(s){(typeof s!="object"||s?.length===void 0)&&ss("Invalid argument for bytesToString");const e=s.length,t=8192;if(e<t)return String.fromCharCode.apply(null,s);const n=[];for(let r=0;r<e;r+=t){const o=Math.min(r+t,e),d=s.subarray(r,o);n.push(String.fromCharCode.apply(null,d))}return n.join("")}function Cp(s){typeof s!="string"&&ss("Invalid argument for stringToBytes");const e=s.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=s.charCodeAt(n)&255;return t}function DC(s){return String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255)}function LC(){const s=new Uint8Array(4);return s[0]=1,new Uint32Array(s.buffer,0,1)[0]===1}function MC(){try{return new Function(""),!0}catch{return!1}}class jo{static get isLittleEndian(){return bi(this,"isLittleEndian",LC())}static get isEvalSupported(){return bi(this,"isEvalSupported",MC())}static get isOffscreenCanvasSupported(){return bi(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return bi(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return bi(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return bi(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return bi(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){return bi(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Lm=Array.from(Array(256).keys(),s=>s.toString(16).padStart(2,"0"));class vn{static makeHexColor(e,t,n){return`#${Lm[e]}${Lm[t]}${Lm[n]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,n=0){const r=e[n],o=e[n+1];e[n]=r*t[0]+o*t[2]+t[4],e[n+1]=r*t[1]+o*t[3]+t[5]}static applyTransformToBezier(e,t,n=0){const r=t[0],o=t[1],d=t[2],c=t[3],h=t[4],f=t[5];for(let m=0;m<6;m+=2){const y=e[n+m],A=e[n+m+1];e[n+m]=y*r+A*d+h,e[n+m+1]=y*o+A*c+f}}static applyInverseTransform(e,t){const n=e[0],r=e[1],o=t[0]*t[3]-t[1]*t[2];e[0]=(n*t[3]-r*t[2]+t[2]*t[5]-t[4]*t[3])/o,e[1]=(-n*t[1]+r*t[0]+t[4]*t[1]-t[5]*t[0])/o}static axialAlignedBoundingBox(e,t,n){const r=t[0],o=t[1],d=t[2],c=t[3],h=t[4],f=t[5],m=e[0],y=e[1],A=e[2],v=e[3];let N=r*m+h,T=N,_=r*A+h,b=_,H=c*y+f,R=H,M=c*v+f,B=M;if(o!==0||d!==0){const q=o*m,G=o*A,X=d*y,O=d*v;N+=X,b+=X,_+=O,T+=O,H+=q,B+=q,M+=G,R+=G}n[0]=Math.min(n[0],N,_,T,b),n[1]=Math.min(n[1],H,M,R,B),n[2]=Math.max(n[2],N,_,T,b),n[3]=Math.max(n[3],H,M,R,B)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const n=e[0],r=e[1],o=e[2],d=e[3],c=n**2+r**2,h=n*o+r*d,f=o**2+d**2,m=(c+f)/2,y=Math.sqrt(m**2-(c*f-h**2));t[0]=Math.sqrt(m+y||1),t[1]=Math.sqrt(m-y||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>r)return null;const o=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),d=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return o>d?null:[n,o,r,d]}static pointBoundingBox(e,t,n){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}static rectBoundingBox(e,t,n,r,o){o[0]=Math.min(o[0],e,n),o[1]=Math.min(o[1],t,r),o[2]=Math.max(o[2],e,n),o[3]=Math.max(o[3],t,r)}static#e(e,t,n,r,o,d,c,h,f,m){if(f<=0||f>=1)return;const y=1-f,A=f*f,v=A*f,N=y*(y*(y*e+3*f*t)+3*A*n)+v*r,T=y*(y*(y*o+3*f*d)+3*A*c)+v*h;m[0]=Math.min(m[0],N),m[1]=Math.min(m[1],T),m[2]=Math.max(m[2],N),m[3]=Math.max(m[3],T)}static#t(e,t,n,r,o,d,c,h,f,m,y,A){if(Math.abs(f)<1e-12){Math.abs(m)>=1e-12&&this.#e(e,t,n,r,o,d,c,h,-y/m,A);return}const v=m**2-4*y*f;if(v<0)return;const N=Math.sqrt(v),T=2*f;this.#e(e,t,n,r,o,d,c,h,(-m+N)/T,A),this.#e(e,t,n,r,o,d,c,h,(-m-N)/T,A)}static bezierBoundingBox(e,t,n,r,o,d,c,h,f){f[0]=Math.min(f[0],e,c),f[1]=Math.min(f[1],t,h),f[2]=Math.max(f[2],e,c),f[3]=Math.max(f[3],t,h),this.#t(e,n,o,c,t,r,d,h,3*(-e+3*(n-o)+c),6*(e-2*n+o),3*(n-e),f),this.#t(e,n,o,c,t,r,d,h,3*(-t+3*(r-d)+h),6*(t-2*r+d),3*(r-t),f)}}function IC(s){return decodeURIComponent(escape(s))}let Mm=null,Nb=null;function zC(s){return Mm||(Mm=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Nb=new Map([["","t"]])),s.replaceAll(Mm,(e,t,n)=>t?t.normalize("NFKC"):Nb.get(n))}function iv(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const s=new Uint8Array(32);return crypto.getRandomValues(s),nv(s)}const ff="pdfjs_internal_id_";function BC(s,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[n,r,...o]=t;if(!s(n)&&!Number.isInteger(n)||!e(r))return!1;const d=o.length;let c=!0;switch(r.name){case"XYZ":if(d<2||d>3)return!1;break;case"Fit":case"FitB":return d===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(d>1)return!1;break;case"FitR":if(d!==4)return!1;c=!1;break;default:return!1}for(const h of o)if(!(typeof h=="number"||c&&h===null))return!1;return!0}function Sl(s,e,t){return Math.min(Math.max(s,e),t)}function rv(s){return Uint8Array.prototype.toBase64?s.toBase64():btoa(nv(s))}function FC(s){return Uint8Array.fromBase64?Uint8Array.fromBase64(s):Cp(atob(s))}typeof Promise.try!="function"&&(Promise.try=function(s,...e){return new Promise(t=>{t(s(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(s){return s.reduce((e,t)=>e+t,0)});class bp{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};function r(o){if(!o)return;let d=null;const c=o.name;if(c==="#text")d=o.value;else if(bp.shouldBuildText(c))o?.attributes?.textContent?d=o.attributes.textContent:o.value&&(d=o.value);else return;if(d!==null&&t.push({str:d}),!!o.children)for(const h of o.children)r(h)}return r(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class sv{static setupStorage(e,t,n,r,o){const d=r.getValue(t,{value:null});switch(n.name){case"textarea":if(d.value!==null&&(e.textContent=d.value),o==="print")break;e.addEventListener("input",c=>{r.setValue(t,{value:c.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(d.value===n.attributes.xfaOn?e.setAttribute("checked",!0):d.value===n.attributes.xfaOff&&e.removeAttribute("checked"),o==="print")break;e.addEventListener("change",c=>{r.setValue(t,{value:c.target.checked?c.target.getAttribute("xfaOn"):c.target.getAttribute("xfaOff")})})}else{if(d.value!==null&&e.setAttribute("value",d.value),o==="print")break;e.addEventListener("input",c=>{r.setValue(t,{value:c.target.value})})}break;case"select":if(d.value!==null){e.setAttribute("value",d.value);for(const c of n.children)c.attributes.value===d.value?c.attributes.selected=!0:c.attributes.hasOwnProperty("selected")&&delete c.attributes.selected}e.addEventListener("input",c=>{const h=c.target.options,f=h.selectedIndex===-1?"":h[h.selectedIndex].value;r.setValue(t,{value:f})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:r,linkService:o}){const{attributes:d}=t,c=e instanceof HTMLAnchorElement;d.type==="radio"&&(d.name=`${d.name}-${r}`);for(const[h,f]of Object.entries(d))if(f!=null)switch(h){case"class":f.length&&e.setAttribute(h,f.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",f);break;case"style":Object.assign(e.style,f);break;case"textContent":e.textContent=f;break;default:(!c||h!=="href"&&h!=="newWindow")&&e.setAttribute(h,f)}c&&o.addLinkAttributes(e,d.href,d.newWindow),n&&d.dataId&&this.setupStorage(e,d.dataId,t,n)}static render(e){const t=e.annotationStorage,n=e.linkService,r=e.xfaHtml,o=e.intent||"display",d=document.createElement(r.name);r.attributes&&this.setAttributes({html:d,element:r,intent:o,linkService:n});const c=o!=="richText",h=e.div;if(h.append(d),e.viewport){const y=`matrix(${e.viewport.transform.join(",")})`;h.style.transform=y}c&&h.setAttribute("class","xfaLayer xfaFont");const f=[];if(r.children.length===0){if(r.value){const y=document.createTextNode(r.value);d.append(y),c&&bp.shouldBuildText(r.name)&&f.push(y)}return{textDivs:f}}const m=[[r,-1,d]];for(;m.length>0;){const[y,A,v]=m.at(-1);if(A+1===y.children.length){m.pop();continue}const N=y.children[++m.at(-1)[1]];if(N===null)continue;const{name:T}=N;if(T==="#text"){const b=document.createTextNode(N.value);f.push(b),v.append(b);continue}const _=N?.attributes?.xmlns?document.createElementNS(N.attributes.xmlns,T):document.createElement(T);if(v.append(_),N.attributes&&this.setAttributes({html:_,element:N,storage:t,intent:o,linkService:n}),N.children?.length>0)m.push([N,-1,_]);else if(N.value){const b=document.createTextNode(N.value);c&&bp.shouldBuildText(T)&&f.push(b),_.append(b)}}for(const y of h.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))y.setAttribute("readOnly",!0);return{textDivs:f}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const su="http://www.w3.org/2000/svg";class Tf{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function Tp(s,e="text"){if(cp(s,document.baseURI)){const t=await fetch(s);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{const r=new XMLHttpRequest;r.open("GET",s,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(r.response);return}t(r.responseText);return}n(new Error(r.statusText))}},r.send(null)})}class kp{constructor({viewBox:e,userUnit:t,scale:n,rotation:r,offsetX:o=0,offsetY:d=0,dontFlip:c=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=r,this.offsetX=o,this.offsetY=d,n*=t;const h=(e[2]+e[0])/2,f=(e[3]+e[1])/2;let m,y,A,v;switch(r%=360,r<0&&(r+=360),r){case 180:m=-1,y=0,A=0,v=1;break;case 90:m=0,y=1,A=1,v=0;break;case 270:m=0,y=-1,A=-1,v=0;break;case 0:m=1,y=0,A=0,v=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}c&&(A=-A,v=-v);let N,T,_,b;m===0?(N=Math.abs(f-e[1])*n+o,T=Math.abs(h-e[0])*n+d,_=(e[3]-e[1])*n,b=(e[2]-e[0])*n):(N=Math.abs(h-e[0])*n+o,T=Math.abs(f-e[1])*n+d,_=(e[2]-e[0])*n,b=(e[3]-e[1])*n),this.transform=[m*n,y*n,A*n,v*n,N-m*n*h-A*n*f,T-y*n*h-v*n*f],this.width=_,this.height=b}get rawDims(){const e=this.viewBox;return bi(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:r=this.offsetY,dontFlip:o=!1}={}){return new kp({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:o})}convertToViewportPoint(e,t){const n=[e,t];return vn.applyTransform(n,this.transform),n}convertToViewportRectangle(e){const t=[e[0],e[1]];vn.applyTransform(t,this.transform);const n=[e[2],e[3]];return vn.applyTransform(n,this.transform),[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){const n=[e,t];return vn.applyInverseTransform(n,this.transform),n}}class Cy extends Ph{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function f0(s){const e=s.length;let t=0;for(;t<e&&s[t].trim()==="";)t++;return s.substring(t,t+5).toLowerCase()==="data:"}function Ty(s){return typeof s=="string"&&/\.pdf$/i.test(s)}function OC(s){return[s]=s.split(/[#?]/,1),s.substring(s.lastIndexOf("/")+1)}function UC(s,e="document.pdf"){if(typeof s!="string")return e;if(f0(s))return xi('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const n=(c=>{try{return new URL(c)}catch{try{return new URL(decodeURIComponent(c))}catch{try{return new URL(c,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(c),"https://foo.bar")}catch{return null}}}}})(s);if(!n)return e;const r=c=>{try{let h=decodeURIComponent(c);return h.includes("/")?(h=h.split("/").at(-1),h.test(/^\.pdf$/i)?h:c):h}catch{return c}},o=/\.pdf$/i,d=n.pathname.split("/").at(-1);if(o.test(d))return r(d);if(n.searchParams.size>0){const c=Array.from(n.searchParams.values()).reverse();for(const f of c)if(o.test(f))return r(f);const h=Array.from(n.searchParams.keys()).reverse();for(const f of h)if(o.test(f))return r(f)}if(n.hash){const h=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(h)return r(h[0])}return e}class Pb{started=Object.create(null);times=[];time(e){e in this.started&&xi(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||xi(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:r,end:o}of this.times)e.push(`${n.padEnd(t)} ${o-r}ms
`);return e.join("")}}function cp(s,e){const t=e?URL.parse(s,e):URL.parse(s);return t?.protocol==="http:"||t?.protocol==="https:"}function Wc(s){s.preventDefault()}function Qs(s){s.preventDefault(),s.stopPropagation()}function HC(s){console.log("Deprecated API usage: "+s)}class sy{static#e;static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;this.#e||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=this.#e.exec(e);if(!t)return null;const n=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let o=parseInt(t[3],10);o=o>=1&&o<=31?o:1;let d=parseInt(t[4],10);d=d>=0&&d<=23?d:0;let c=parseInt(t[5],10);c=c>=0&&c<=59?c:0;let h=parseInt(t[6],10);h=h>=0&&h<=59?h:0;const f=t[7]||"Z";let m=parseInt(t[8],10);m=m>=0&&m<=23?m:0;let y=parseInt(t[9],10)||0;return y=y>=0&&y<=59?y:0,f==="-"?(d+=m,c+=y):f==="+"&&(d-=m,c-=y),new Date(Date.UTC(n,r,o,d,c,h))}}function VC(s,{scale:e=1,rotation:t=0}){const{width:n,height:r}=s.attributes.style,o=[0,0,parseInt(n),parseInt(r)];return new kp({viewBox:o,userUnit:1,scale:e,rotation:t})}function _p(s){if(s.startsWith("#")){const e=parseInt(s.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return s.startsWith("rgb(")?s.slice(4,-1).split(",").map(e=>parseInt(e)):s.startsWith("rgba(")?s.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(xi(`Not a valid color format: "${s}"`),[0,0,0])}function qC(s){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of s.keys()){e.style.color=t;const n=window.getComputedStyle(e).color;s.set(t,_p(n))}e.remove()}function Fs(s){const{a:e,b:t,c:n,d:r,e:o,f:d}=s.getTransform();return[e,t,n,r,o,d]}function Pd(s){const{a:e,b:t,c:n,d:r,e:o,f:d}=s.getTransform().invertSelf();return[e,t,n,r,o,d]}function kh(s,e,t=!1,n=!0){if(e instanceof kp){const{pageWidth:r,pageHeight:o}=e.rawDims,{style:d}=s,c=jo.isCSSRoundSupported,h=`var(--total-scale-factor) * ${r}px`,f=`var(--total-scale-factor) * ${o}px`,m=c?`round(down, ${h}, var(--scale-round-x))`:`calc(${h})`,y=c?`round(down, ${f}, var(--scale-round-y))`:`calc(${f})`;!t||e.rotation%180===0?(d.width=m,d.height=y):(d.width=y,d.height=m)}n&&s.setAttribute("data-main-rotation",e.rotation)}class Id{constructor(){const{pixelRatio:e}=Id;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,n,r,o=-1){let d=1/0,c=1/0,h=1/0;n=Id.capPixels(n,o),n>0&&(d=Math.sqrt(n/(e*t))),r!==-1&&(c=r/e,h=r/t);const f=Math.min(d,c,h);return this.sx>f||this.sy>f?(this.sx=f,this.sy=f,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,n):n}return e}}const ay=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class WC{static get isDarkMode(){return bi(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class $C{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:n}=window.getComputedStyle(e);return e.remove(),bi(this,"commentForegroundColor",_p(n))}}function GC(s,e,t,n){n=Math.min(Math.max(n??1,0),1);const r=255*(1-n);return s=Math.round(s*n+r),e=Math.round(e*n+r),t=Math.round(t*n+r),[s,e,t]}function Eb(s,e){const t=s[0]/255,n=s[1]/255,r=s[2]/255,o=Math.max(t,n,r),d=Math.min(t,n,r),c=(o+d)/2;if(o===d)e[0]=e[1]=0;else{const h=o-d;switch(e[1]=c<.5?h/(o+d):h/(2-o-d),o){case t:e[0]=((n-r)/h+(n<r?6:0))*60;break;case n:e[0]=((r-t)/h+2)*60;break;case r:e[0]=((t-n)/h+4)*60;break}}e[2]=c}function oy(s,e){const t=s[0],n=s[1],r=s[2],o=(1-Math.abs(2*r-1))*n,d=o*(1-Math.abs(t/60%2-1)),c=r-o/2;switch(Math.floor(t/60)){case 0:e[0]=o+c,e[1]=d+c,e[2]=c;break;case 1:e[0]=d+c,e[1]=o+c,e[2]=c;break;case 2:e[0]=c,e[1]=o+c,e[2]=d+c;break;case 3:e[0]=c,e[1]=d+c,e[2]=o+c;break;case 4:e[0]=d+c,e[1]=c,e[2]=o+c;break;case 5:case 6:e[0]=o+c,e[1]=c,e[2]=d+c;break}}function Rb(s){return s<=.03928?s/12.92:((s+.055)/1.055)**2.4}function Db(s,e,t){oy(s,t),t.map(Rb);const n=.2126*t[0]+.7152*t[1]+.0722*t[2];oy(e,t),t.map(Rb);const r=.2126*t[0]+.7152*t[1]+.0722*t[2];return n>r?(n+.05)/(r+.05):(r+.05)/(n+.05)}const Lb=new Map;function YC(s,e){const t=s[0]+s[1]*256+s[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let n=Lb.get(t);if(n)return n;const r=new Float32Array(9),o=r.subarray(0,3),d=r.subarray(3,6);Eb(s,d);const c=r.subarray(6,9);Eb(e,c);const h=c[2]<.5,f=h?12:4.5;if(d[2]=h?Math.sqrt(d[2]):1-Math.sqrt(1-d[2]),Db(d,c,o)<f){let m,y;h?(m=d[2],y=1):(m=0,y=d[2]);const A=.005;for(;y-m>A;){const v=d[2]=(m+y)/2;h===Db(d,c,o)<f?m=v:y=v}d[2]=h?y:m}return oy(d,o),n=vn.makeHexColor(Math.round(o[0]*255),Math.round(o[1]*255),Math.round(o[2]*255)),Lb.set(t,n),n}function av({html:s,dir:e,className:t},n){const r=document.createDocumentFragment();if(typeof s=="string"){const o=document.createElement("p");o.dir=e||"auto";const d=s.split(/(?:\r\n?|\n)/);for(let c=0,h=d.length;c<h;++c){const f=d[c];o.append(document.createTextNode(f)),c<h-1&&o.append(document.createElement("br"))}r.append(o)}else sv.render({xfaHtml:s,div:r,intent:"richText"});r.firstElementChild.classList.add("richText",t),n.append(r)}function ov(s){const e=new Path2D;if(!s)return e;for(let t=0,n=s.length;t<n;)switch(s[t++]){case ip.moveTo:e.moveTo(s[t++],s[t++]);break;case ip.lineTo:e.lineTo(s[t++],s[t++]);break;case ip.curveTo:e.bezierCurveTo(s[t++],s[t++],s[t++],s[t++],s[t++],s[t++]);break;case ip.quadraticCurveTo:e.quadraticCurveTo(s[t++],s[t++],s[t++],s[t++]);break;case ip.closePath:e.closePath();break;default:xi(`Unrecognized drawing path operator: ${s[t-1]}`);break}return e}class pp{#e=null;#t=null;#i;#n=null;#a=null;#s=null;#r=null;#o=null;static#c=null;constructor(e){this.#i=e,pp.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const e=this.#e=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=this.#i._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",Wc,{signal:t}),e.addEventListener("pointerdown",pp.#l,{signal:t}));const n=this.#n=document.createElement("div");n.className="buttons",e.append(n);const r=this.#i.toolbarPosition;if(r){const{style:o}=e,d=this.#i._uiManager.direction==="ltr"?1-r[0]:r[0];o.insetInlineEnd=`${100*d}%`,o.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return this.#e}static#l(e){e.stopPropagation()}#h(e){this.#i._focusEventsAllowed=!1,Qs(e)}#u(e){this.#i._focusEventsAllowed=!0,Qs(e)}#f(e){const t=this.#i._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",this.#h.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#u.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Wc,{signal:t}),!0)}hide(){this.#e.classList.add("hidden"),this.#t?.hideDropdown()}show(){this.#e.classList.remove("hidden"),this.#a?.shown(),this.#s?.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=this.#i,n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",pp.#c[e]),this.#f(n)&&n.addEventListener("click",r=>{t.delete()},{signal:t._signal}),this.#n.append(n)}get#m(){const e=document.createElement("div");return e.className="divider",e}async addAltText(e){const t=await e.render();this.#f(t),this.#n.append(t,this.#m),this.#a=e}addComment(e,t=null){if(this.#s)return;const n=e.renderForToolbar();if(!n)return;this.#f(n);const r=this.#r=this.#m;t?(this.#n.insertBefore(n,t),this.#n.insertBefore(r,t)):this.#n.append(n,r),this.#s=e,e.toolbar=this}addColorPicker(e){if(this.#t)return;this.#t=e;const t=e.renderButton();this.#f(t),this.#n.append(t,this.#m)}async addEditSignatureButton(e){const t=this.#o=await e.renderEditButton(this.#i);this.#f(t),this.#n.append(t,this.#m)}removeButton(e){switch(e){case"comment":this.#s?.removeToolbarCommentButton(),this.#s=null,this.#r?.remove(),this.#r=null;break}}async addButton(e,t){switch(e){case"colorPicker":t&&this.addColorPicker(t);break;case"altText":t&&await this.addAltText(t);break;case"editSignature":t&&await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":t&&this.addComment(t);break}}async addButtonBefore(e,t,n){if(!t&&e==="comment")return;const r=this.#n.querySelector(n);r&&e==="comment"&&this.addComment(t,r)}updateEditSignatureButton(e){this.#o&&(this.#o.title=e)}remove(){this.#e.remove(),this.#t?.destroy(),this.#t=null}}class XC{#e=null;#t=null;#i;constructor(e){this.#i=e}#n(){const e=this.#t=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar");const t=this.#i._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",Wc,{signal:t});const n=this.#e=document.createElement("div");return n.className="buttons",e.append(n),this.#i.hasCommentManager()&&this.#s("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#i.commentSelection("floating_button")}),this.#s("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#i.highlightSelection("floating_button")}),e}#a(e,t){let n=0,r=0;for(const o of e){const d=o.y+o.height;if(d<n)continue;const c=o.x+(t?o.width:0);if(d>n){r=c,n=d;continue}t?c>r&&(r=c):c<r&&(r=c)}return[t?1-r:r,n]}show(e,t,n){const[r,o]=this.#a(t,n),{style:d}=this.#t||=this.#n();e.append(this.#t),d.insetInlineEnd=`${100*r}%`,d.top=`calc(${100*o}% + var(--editor-toolbar-vert-offset))`}hide(){this.#t.remove()}#s(e,t,n,r){const o=document.createElement("button");o.classList.add("basic",e),o.tabIndex=0,o.setAttribute("data-l10n-id",t);const d=document.createElement("span");o.append(d),d.className="visuallyHidden",d.setAttribute("data-l10n-id",n);const c=this.#i._signal;c instanceof AbortSignal&&!c.aborted&&(o.addEventListener("contextmenu",Wc,{signal:c}),o.addEventListener("click",r,{signal:c})),this.#e.append(o)}}function lv(s,e,t){for(const n of t)e.addEventListener(n,s[n].bind(s))}class _r{static#e=NaN;static#t=null;static#i=NaN;static#n=null;static initializeAndAddPointerId(e){(_r.#t||=new Set).add(e)}static setPointer(e,t){_r.#e||=t,_r.#n??=e}static setTimeStamp(e){_r.#i=e}static isSamePointerId(e){return _r.#e===e}static isSamePointerIdOrRemove(e){return _r.#e===e?!0:(_r.#t?.delete(e),!1)}static isSamePointerType(e){return _r.#n===e}static isInitializedAndDifferentPointerType(e){return _r.#n!==null&&!_r.isSamePointerType(e)}static isSameTimeStamp(e){return _r.#i===e}static isUsingMultiplePointers(){return _r.#t?.size>=1}static clearPointerType(){_r.#n=null}static clearPointerIds(){_r.#e=NaN,_r.#t=null}static clearTimeStamp(){_r.#i=NaN}}class KC{#e=0;get id(){return`${yp}${this.#e++}`}}class ky{#e=iv();#t=0;#i=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=e;const o=r.decode().then(()=>(n.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return bi(this,"_isSVGFittingCanvas",o)}async#n(e,t){this.#i||=new Map;let n=this.#i.get(e);if(n===null)return null;if(n?.bitmap)return n.refCounter+=1,n;try{n||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let r;if(typeof t=="string"?(n.url=t,r=await Tp(t,"blob")):t instanceof File?r=n.file=t:t instanceof Blob&&(r=t),r.type==="image/svg+xml"){const o=ky._isSVGFittingCanvas,d=new FileReader,c=new Image,h=new Promise((f,m)=>{c.onload=()=>{n.bitmap=c,n.isSvg=!0,f()},d.onload=async()=>{const y=n.svgUrl=d.result;c.src=await o?`${y}#svgView(preserveAspectRatio(none))`:y},c.onerror=d.onerror=m});d.readAsDataURL(r),await h}else n.bitmap=await createImageBitmap(r);n.refCounter=1}catch(r){xi(r),n=null}return this.#i.set(e,n),n&&this.#i.set(n.id,n),n}async getFromFile(e){const{lastModified:t,name:n,size:r,type:o}=e;return this.#n(`${t}_${n}_${r}_${o}`,e)}async getFromUrl(e){return this.#n(e,e)}async getFromBlob(e,t){const n=await t;return this.#n(e,n)}async getFromId(e){this.#i||=new Map;const t=this.#i.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){this.#i||=new Map;let n=this.#i.get(e);if(n?.bitmap)return n.refCounter+=1,n;const r=new OffscreenCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),n={bitmap:r.transferToImageBitmap(),id:`image_${this.#e}_${this.#t++}`,refCounter:1,isSvg:!1},this.#i.set(e,n),this.#i.set(n.id,n),n}getSvgUrl(e){const t=this.#i.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#i||=new Map;const t=this.#i.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:n}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(n.width,n.height);r.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=r.convertToBlob()}n.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#e}_`)}}class ZC{#e=[];#t=!1;#i;#n=-1;constructor(e=128){this.#i=e}add({cmd:e,undo:t,post:n,mustExec:r,type:o=NaN,overwriteIfSameType:d=!1,keepUndo:c=!1}){if(r&&e(),this.#t)return;const h={cmd:e,undo:t,post:n,type:o};if(this.#n===-1){this.#e.length>0&&(this.#e.length=0),this.#n=0,this.#e.push(h);return}if(d&&this.#e[this.#n].type===o){c&&(h.undo=this.#e[this.#n].undo),this.#e[this.#n]=h;return}const f=this.#n+1;f===this.#i?this.#e.splice(0,1):(this.#n=f,f<this.#e.length&&this.#e.splice(f)),this.#e.push(h)}undo(){if(this.#n===-1)return;this.#t=!0;const{undo:e,post:t}=this.#e[this.#n];e(),t?.(),this.#t=!1,this.#n-=1}redo(){if(this.#n<this.#e.length-1){this.#n+=1,this.#t=!0;const{cmd:e,post:t}=this.#e[this.#n];e(),t?.(),this.#t=!1}}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#e.length-1}cleanType(e){if(this.#n!==-1){for(let t=this.#n;t>=0;t--)if(this.#e[t].type!==e){this.#e.splice(t+1,this.#n-t),this.#n=t;return}this.#e.length=0,this.#n=-1}}destroy(){this.#e=null}}class jp{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=jo.platform;for(const[n,r,o={}]of e)for(const d of n){const c=d.startsWith("mac+");t&&c?(this.callbacks.set(d.slice(4),{callback:r,options:o}),this.allKeys.add(d.split("+").at(-1))):!t&&!c&&(this.callbacks.set(d,{callback:r,options:o}),this.allKeys.add(d.split("+").at(-1)))}}#e(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(this.#e(t));if(!n)return;const{callback:r,options:{bubbles:o=!1,args:d=[],checker:c=null}}=n;c&&!c(e,t)||(r.bind(e,...d,t)(),o||Qs(t))}}class _y{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return qC(e),bi(this,"_colors",e)}convert(e){const t=_p(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,r]of this._colors)if(r.every((o,d)=>o===t[d]))return _y._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?vn.makeHexColor(...t):e}}class Yu{#e=new AbortController;#t=null;#i=null;#n=new Map;#a=new Map;#s=null;#r=null;#o=null;#c=new ZC;#l=null;#h=null;#u=null;#f=0;#m=new Set;#g=null;#d=null;#p=new Set;_editorUndoBar=null;#y=!1;#b=!1;#x=!1;#T=null;#A=null;#w=null;#_=null;#v=!1;#C=null;#P=new KC;#j=!1;#N=!1;#z=!1;#R=null;#L=null;#B=null;#M=null;#q=null;#k=Ci.NONE;#S=new Set;#D=null;#F=null;#U=null;#G=null;#$=null;#Y={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#H=[0,0];#I=null;#W=null;#J=null;#Q=null;#O=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=Yu.prototype,t=d=>d.#W.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&d.hasSomethingToControl(),n=(d,{target:c})=>{if(c instanceof HTMLInputElement){const{type:h}=c;return h!=="text"&&h!=="number"}return!0},r=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return bi(this,"_keyboardManager",new jp([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(d,{target:c})=>!(c instanceof HTMLButtonElement)&&d.#W.contains(c)&&!d.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(d,{target:c})=>!(c instanceof HTMLButtonElement)&&d.#W.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-o,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[o,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-o],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,o],checker:t}]]))}constructor(e,t,n,r,o,d,c,h,f,m,y,A,v,N,T,_){const b=this._signal=this.#e.signal;this.#W=e,this.#J=t,this.#Q=n,this.#s=r,this.#l=o,this.#F=d,this.#$=h,this._eventBus=c,c._on("editingaction",this.onEditingAction.bind(this),{signal:b}),c._on("pagechanging",this.onPageChanging.bind(this),{signal:b}),c._on("scalechanging",this.onScaleChanging.bind(this),{signal:b}),c._on("rotationchanging",this.onRotationChanging.bind(this),{signal:b}),c._on("setpreference",this.onSetPreference.bind(this),{signal:b}),c._on("switchannotationeditorparams",H=>this.updateParams(H.type,H.value),{signal:b}),window.addEventListener("pointerdown",()=>{this.#N=!0},{capture:!0,signal:b}),window.addEventListener("pointerup",()=>{this.#N=!1},{capture:!0,signal:b}),this.#ae(),this.#he(),this.#te(),this.#r=h.annotationStorage,this.#T=h.filterFactory,this.#U=f,this.#_=m||null,this.#y=y,this.#b=A,this.#x=v,this.#q=N||null,this.viewParameters={realScale:Tf.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=T||null,this._supportsPinchToZoom=_!==!1,o?.setSidebarUiManager(this)}destroy(){this.#O?.resolve(),this.#O=null,this.#e?.abort(),this.#e=null,this._signal=null;for(const e of this.#a.values())e.destroy();this.#a.clear(),this.#n.clear(),this.#p.clear(),this.#M?.clear(),this.#t=null,this.#S.clear(),this.#c.destroy(),this.#s?.destroy(),this.#l?.destroy(),this.#F?.destroy(),this.#C?.hide(),this.#C=null,this.#B?.destroy(),this.#B=null,this.#i=null,this.#A&&(clearTimeout(this.#A),this.#A=null),this.#I&&(clearTimeout(this.#I),this.#I=null),this._editorUndoBar?.destroy(),this.#$=null}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#q}get useNewAltTextFlow(){return this.#b}get useNewAltTextWhenAddingImage(){return this.#x}get hcmFilter(){return bi(this,"hcmFilter",this.#U?this.#T.addHCMFilter(this.#U.foreground,this.#U.background):"none")}get direction(){return bi(this,"direction",getComputedStyle(this.#W).direction)}get _highlightColors(){return bi(this,"_highlightColors",this.#_?new Map(this.#_.split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return bi(this,"highlightColors",null);const t=new Map,n=!!this.#U;for(const[r,o]of e){const d=r.endsWith("_HCM");if(n&&d){t.set(r.replace("_HCM",""),o);continue}!n&&!d&&t.set(r,o)}return bi(this,"highlightColors",t)}get highlightColorNames(){return bi(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#u=e}setMainHighlightColorPicker(e){this.#B=e}editAltText(e,t=!1){this.#s?.editAltText(this,e,t)}hasCommentManager(){return!!this.#l}editComment(e,t,n,r){this.#l?.showDialog(this,e,t,n,r)}selectComment(e,t){this.#a.get(e)?.getEditorByUID(t)?.toggleComment(!0,!0)}updateComment(e){this.#l?.updateComment(e.getData())}updatePopupColor(e){this.#l?.updatePopupColor(e)}removeComment(e){this.#l?.removeComments([e.uid])}toggleComment(e,t,n=void 0){this.#l?.toggleCommentPopup(e,t,n)}makeCommentColor(e,t){return e&&this.#l?.makeCommentColor(e,t)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(e){if(this.#a.has(e-1))return;const{resolve:t,promise:n}=Promise.withResolvers(),r=o=>{o.pageNumber===e&&(this._eventBus._off("editorsrendered",r),t())};this._eventBus.on("editorsrendered",r),await n}getSignature(e){this.#F?.getSignature({uiManager:this,editor:e})}get signatureManager(){return this.#F}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":this.#x=t;break}}onPageChanging({pageNumber:e}){this.#f=e-1}focusMainContainer(){this.#W.focus()}findParent(e,t){for(const n of this.#a.values()){const{x:r,y:o,width:d,height:c}=n.div.getBoundingClientRect();if(e>=r&&e<=r+d&&t>=o&&t<=o+c)return n}return null}disableUserSelect(e=!1){this.#J.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#p.add(e)}removeShouldRescale(e){this.#p.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*Tf.PDF_TO_CSS_UNITS;for(const t of this.#p)t.onScaleChanging();this.#u?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#Z({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#ee(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const n of this.#a.values())if(n.hasTextLayer(e))return n;return null}highlightSelection(e="",t=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:r,anchorOffset:o,focusNode:d,focusOffset:c}=n,h=n.toString(),m=this.#Z(n).closest(".textLayer"),y=this.getSelectionBoxes(m);if(!y)return;n.empty();const A=this.#ee(m),v=this.#k===Ci.NONE,N=()=>{const T=A?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:y,anchorNode:r,anchorOffset:o,focusNode:d,focusOffset:c,text:h});v&&this.showAllEditors("highlight",!0,!0),t&&T?.editComment()};if(v){this.switchToMode(Ci.HIGHLIGHT,N);return}N()}commentSelection(e=""){this.highlightSelection(e,!0)}#re(){const e=document.getSelection();if(!e||e.isCollapsed)return;const n=this.#Z(e).closest(".textLayer"),r=this.getSelectionBoxes(n);r&&(this.#C||=new XC(this),this.#C.show(n,r,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(e){if(!this.#r)return null;const t=`${yp}${e}`,n=this.#r.getRawValue(t);return n&&this.#r.remove(t),n}addToAnnotationStorage(e){!e.isEmpty()&&this.#r&&!this.#r.has(e.id)&&this.#r.setValue(e.id,e)}a11yAlert(e,t=null){const n=this.#Q;n&&(n.setAttribute("data-l10n-id",e),t?n.setAttribute("data-l10n-args",JSON.stringify(t)):n.removeAttribute("data-l10n-args"))}#se(){const e=document.getSelection();if(!e||e.isCollapsed){this.#D&&(this.#C?.hide(),this.#D=null,this.#E({hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===this.#D)return;const r=this.#Z(e).closest(".textLayer");if(!r){this.#D&&(this.#C?.hide(),this.#D=null,this.#E({hasSelectedText:!1}));return}if(this.#C?.hide(),this.#D=t,this.#E({hasSelectedText:!0}),!(this.#k!==Ci.HIGHLIGHT&&this.#k!==Ci.NONE)&&(this.#k===Ci.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#v=this.isShiftKeyDown,!this.isShiftKeyDown)){const o=this.#k===Ci.HIGHLIGHT?this.#ee(r):null;if(o?.toggleDrawing(),this.#N){const d=new AbortController,c=this.combinedSignal(d),h=f=>{f.type==="pointerup"&&f.button!==0||(d.abort(),o?.toggleDrawing(!0),f.type==="pointerup"&&this.#X("main_toolbar"))};window.addEventListener("pointerup",h,{signal:c}),window.addEventListener("blur",h,{signal:c})}else o?.toggleDrawing(!0),this.#X("main_toolbar")}}#X(e=""){this.#k===Ci.HIGHLIGHT?this.highlightSelection(e):this.#y&&this.#re()}#ae(){document.addEventListener("selectionchange",this.#se.bind(this),{signal:this._signal})}#oe(){if(this.#w)return;this.#w=new AbortController;const e=this.combinedSignal(this.#w);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#le(){this.#w?.abort(),this.#w=null}blur(){if(this.isShiftKeyDown=!1,this.#v&&(this.#v=!1,this.#X("main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of this.#S)if(t.div.contains(e)){this.#L=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#L)return;const[e,t]=this.#L;this.#L=null,t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}#te(){if(this.#R)return;this.#R=new AbortController;const e=this.combinedSignal(this.#R);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#ce(){this.#R?.abort(),this.#R=null}#de(){if(this.#h)return;this.#h=new AbortController;const e=this.combinedSignal(this.#h);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#ue(){this.#h?.abort(),this.#h=null}#he(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#te(),this.setEditingState(!0)}removeEditListeners(){this.#ce(),this.setEditingState(!1)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of this.#d)if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const n of this.#d)if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const t=[];for(const n of this.#S){const r=n.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const o of t.items)for(const d of this.#d)if(d.isHandlingMimeForPasting(o.type)){d.paste(o,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(o){xi(`paste: "${o.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const r=this.currentLayer;try{const o=[];for(const h of n){const f=await r.deserialize(h);if(!f)return;o.push(f)}const d=()=>{for(const h of o)this.#ne(h);this.#ie(o)},c=()=>{for(const h of o)h.remove()};this.addCommands({cmd:d,undo:c,mustExec:!0})}catch(o){xi(`paste: "${o.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),this.#k!==Ci.NONE&&!this.isEditorHandlingKeyboard&&Yu._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,this.#v&&(this.#v=!1,this.#X("main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#E(e){Object.entries(e).some(([n,r])=>this.#Y[n]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#Y,e)}),this.#k===Ci.HIGHLIGHT&&e.hasSelectedEditor===!1&&this.#V([[rr.HIGHLIGHT_FREE,!0]]))}#V(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#oe(),this.#de(),this.#E({isEditing:this.#k!==Ci.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:this.#c.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#le(),this.#ue(),this.#E({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#d){this.#d=e;for(const t of this.#d)this.#V(t.defaultPropertiesToUpdate)}}getId(){return this.#P.id}get currentLayer(){return this.#a.get(this.#f)}getLayer(e){return this.#a.get(e)}get currentPageIndex(){return this.#f}addLayer(e){this.#a.set(e.pageIndex,e),this.#j?e.enable():e.disable()}removeLayer(e){this.#a.delete(e.pageIndex)}async updateMode(e,t=null,n=!1,r=!1,o=!1){if(this.#k!==e&&!(this.#O&&(await this.#O.promise,!this.#O))){if(this.#O=Promise.withResolvers(),this.#u?.commitOrRemove(),this.#k===Ci.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#k=e,e===Ci.NONE){this.setEditingState(!1),this.#pe();for(const d of this.#n.values())d.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#O.resolve();return}for(const d of this.#n.values())d.addStandaloneCommentButton();e===Ci.SIGNATURE&&await this.#F?.loadSignatures(),this.setEditingState(!0),await this.#fe(),this.unselectAll();for(const d of this.#a.values())d.updateMode(e);if(e===Ci.POPUP){this.#i||=await this.#$.getAnnotationsByType(new Set(this.#d.map(h=>h._editorType)));const d=new Set,c=[];for(const h of this.#n.values()){const{annotationElementId:f,hasComment:m,deleted:y}=h;f&&d.add(f),m&&!y&&c.push(h.getData())}for(const h of this.#i){const{id:f,popupRef:m,contentsObj:y}=h;m&&y?.str&&!d.has(f)&&!this.#m.has(f)&&c.push(h)}this.#l?.showSidebar(c)}if(!t){n&&this.addNewEditorFromKeyboard(),this.#O.resolve();return}for(const d of this.#n.values())d.uid===t?(this.setSelected(d),o?d.editComment():r?d.enterInEditMode():d.focus()):d.unselect();this.#O.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==this.#k&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(this.#d){switch(e){case rr.CREATE:this.currentLayer.addNewEditor(t);return;case rr.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#G||=new Map).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const n of this.#S)n.updateParams(e,t);else for(const n of this.#d)n.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){for(const o of this.#n.values())o.editorType===e&&o.show(t);(this.#G?.get(rr.HIGHLIGHT_SHOW_ALL)??!0)!==t&&this.#V([[rr.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(this.#z!==e){this.#z=e;for(const t of this.#a.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}async#fe(){if(!this.#j){this.#j=!0;const e=[];for(const t of this.#a.values())e.push(t.enable());await Promise.all(e);for(const t of this.#n.values())t.enable()}}#pe(){if(this.unselectAll(),this.#j){this.#j=!1;for(const e of this.#a.values())e.disable();for(const e of this.#n.values())e.disable()}}*getEditors(e){for(const t of this.#n.values())t.pageIndex===e&&(yield t)}getEditor(e){return this.#n.get(e)}addEditor(e){this.#n.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#A&&clearTimeout(this.#A),this.#A=setTimeout(()=>{this.focusMainContainer(),this.#A=null},0)),this.#n.delete(e.id),e.annotationElementId&&this.#M?.delete(e.annotationElementId),this.unselect(e),(!e.annotationElementId||!this.#m.has(e.annotationElementId))&&this.#r?.remove(e.id)}addDeletedAnnotationElement(e){this.#m.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#m.has(e)}removeDeletedAnnotationElement(e){this.#m.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#ne(e){const t=this.#a.get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#V(e.propertiesToUpdate))}get#ge(){let e=null;for(e of this.#S);return e}updateUI(e){this.#ge===e&&this.#V(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#V(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#S.has(e)){this.#S.delete(e),e.unselect(),this.#E({hasSelectedEditor:this.hasSelection});return}this.#S.add(e),e.select(),this.#V(e.propertiesToUpdate),this.#E({hasSelectedEditor:!0})}setSelected(e){this.updateToolbar({mode:e.mode,editId:e.uid}),this.#u?.commitOrRemove();for(const t of this.#S)t!==e&&t.unselect();this.#S.clear(),this.#S.add(e),e.select(),this.#V(e.propertiesToUpdate),this.#E({hasSelectedEditor:!0})}isSelected(e){return this.#S.has(e)}get firstSelectedEditor(){return this.#S.values().next().value}unselect(e){e.unselect(),this.#S.delete(e),this.#E({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#S.size!==0}get isEnterHandled(){return this.#S.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#c.undo(),this.#E({hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#c.redo(),this.#E({hasSomethingToUndo:!0,hasSomethingToRedo:this.#c.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(e){this.#c.add(e),this.#E({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(e){this.#c.cleanType(e)}#K(){if(this.#n.size===0)return!0;if(this.#n.size===1)for(const e of this.#n.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();const e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...this.#S],n=()=>{this._editorUndoBar?.show(r,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},r=()=>{for(const o of t)this.#ne(o)};this.addCommands({cmd:n,undo:r,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#ie(e){for(const t of this.#S)t.unselect();this.#S.clear();for(const t of e)t.isEmpty()||(this.#S.add(t),t.select());this.#E({hasSelectedEditor:this.hasSelection})}selectAll(){for(const e of this.#S)e.commit();this.#ie(this.#n.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#k!==Ci.NONE))&&!this.#u?.commitOrRemove()&&this.hasSelection){for(const e of this.#S)e.unselect();this.#S.clear(),this.#E({hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;this.#H[0]+=e,this.#H[1]+=t;const[r,o]=this.#H,d=[...this.#S],c=1e3;this.#I&&clearTimeout(this.#I),this.#I=setTimeout(()=>{this.#I=null,this.#H[0]=this.#H[1]=0,this.addCommands({cmd:()=>{for(const h of d)this.#n.has(h.id)&&(h.translateInPage(r,o),h.translationDone())},undo:()=>{for(const h of d)this.#n.has(h.id)&&(h.translateInPage(-r,-o),h.translationDone())},mustExec:!1})},c);for(const h of d)h.translateInPage(e,t),h.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#g=new Map;for(const e of this.#S)this.#g.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#g)return!1;this.disableUserSelect(!1);const e=this.#g;this.#g=null;let t=!1;for(const[{x:r,y:o,pageIndex:d},c]of e)c.newX=r,c.newY=o,c.newPageIndex=d,t||=r!==c.savedX||o!==c.savedY||d!==c.savedPageIndex;if(!t)return!1;const n=(r,o,d,c)=>{if(this.#n.has(r.id)){const h=this.#a.get(c);h?r._setParentAndPosition(h,o,d):(r.pageIndex=c,r.x=o,r.y=d)}};return this.addCommands({cmd:()=>{for(const[r,{newX:o,newY:d,newPageIndex:c}]of e)n(r,o,d,c)},undo:()=>{for(const[r,{savedX:o,savedY:d,savedPageIndex:c}]of e)n(r,o,d,c)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#g)for(const n of this.#g.keys())n.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#S.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#k}isEditingMode(){return this.#k!==Ci.NONE}get imageManager(){return bi(this,"imageManager",new ky)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let f=0,m=t.rangeCount;f<m;f++)if(!e.contains(t.getRangeAt(f).commonAncestorContainer))return null;const{x:n,y:r,width:o,height:d}=e.getBoundingClientRect();let c;switch(e.getAttribute("data-main-rotation")){case"90":c=(f,m,y,A)=>({x:(m-r)/d,y:1-(f+y-n)/o,width:A/d,height:y/o});break;case"180":c=(f,m,y,A)=>({x:1-(f+y-n)/o,y:1-(m+A-r)/d,width:y/o,height:A/d});break;case"270":c=(f,m,y,A)=>({x:1-(m+A-r)/d,y:(f-n)/o,width:A/d,height:y/o});break;default:c=(f,m,y,A)=>({x:(f-n)/o,y:(m-r)/d,width:y/o,height:A/d});break}const h=[];for(let f=0,m=t.rangeCount;f<m;f++){const y=t.getRangeAt(f);if(!y.collapsed)for(const{x:A,y:v,width:N,height:T}of y.getClientRects())N===0||T===0||h.push(c(A,v,N,T))}return h.length===0?null:h}addChangedExistingAnnotation({annotationElementId:e,id:t}){(this.#o||=new Map).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){this.#o?.delete(e)}renderAnnotationElement(e){const t=this.#o?.get(e.data.id);if(!t)return;const n=this.#r.getRawValue(t);n&&(this.#k===Ci.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}setMissingCanvas(e,t,n){const r=this.#M?.get(e);r&&(r.setCanvas(t,n),this.#M.delete(e))}addMissingCanvas(e,t){(this.#M||=new Map).set(e,t)}}class Ld{#e=null;#t=!1;#i=null;#n=null;#a=null;#s=null;#r=!1;#o=null;#c=null;#l=null;#h=null;#u=!1;static#f=null;static _l10n=null;constructor(e){this.#c=e,this.#u=e._uiManager.useNewAltTextFlow,Ld.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){Ld._l10n??=e}async render(){const e=this.#i=document.createElement("button");e.className="altText",e.tabIndex="0";const t=this.#n=document.createElement("span");e.append(t),this.#u?(e.classList.add("new"),e.setAttribute("data-l10n-id",Ld.#f.missing),t.setAttribute("data-l10n-id",Ld.#f["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=this.#c._uiManager._signal;e.addEventListener("contextmenu",Wc,{signal:n}),e.addEventListener("pointerdown",o=>o.stopPropagation(),{signal:n});const r=o=>{o.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#u&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#m}})};return e.addEventListener("click",r,{capture:!0,signal:n}),e.addEventListener("keydown",o=>{o.target===e&&o.key==="Enter"&&(this.#r=!0,r(o))},{signal:n}),await this.#g(),e}get#m(){return this.#e&&"added"||this.#e===null&&this.guessedText&&"review"||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#r}),this.#r=!1)}isEmpty(){return this.#u?this.#e===null:!this.#e&&!this.#t}hasData(){return this.#u?this.#e!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(e){this.#e===null&&(this.#l=e,this.#h=await Ld._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#g())}toggleAltTextBadge(e=!1){if(!this.#u||this.#e){this.#o?.remove(),this.#o=null;return}if(!this.#o){const t=this.#o=document.createElement("div");t.className="noAltTextBadge",this.#c.div.append(t)}this.#o.classList.toggle("hidden",!e)}serialize(e){let t=this.#e;return!e&&this.#l===t&&(t=this.#h),{altText:t,decorative:this.#t,guessedText:this.#l,textWithDisclaimer:this.#h}}get data(){return{altText:this.#e,decorative:this.#t}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:r,cancel:o=!1}){n&&(this.#l=n,this.#h=r),!(this.#e===e&&this.#t===t)&&(o||(this.#e=e,this.#t=t),this.#g())}toggle(e=!1){this.#i&&(!e&&this.#s&&(clearTimeout(this.#s),this.#s=null),this.#i.disabled=!e)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#m}})}destroy(){this.#i?.remove(),this.#i=null,this.#n=null,this.#a=null,this.#o?.remove(),this.#o=null}async#g(){const e=this.#i;if(!e)return;if(this.#u){if(e.classList.toggle("done",!!this.#e),e.setAttribute("data-l10n-id",Ld.#f[this.#m]),this.#n?.setAttribute("data-l10n-id",Ld.#f[`${this.#m}-label`]),!this.#e){this.#a?.remove();return}}else{if(!this.#e&&!this.#t){e.classList.remove("done"),this.#a?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=this.#a;if(!t){this.#a=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${this.#c.id}`;const r=100,o=this.#c._uiManager._signal;o.addEventListener("abort",()=>{clearTimeout(this.#s),this.#s=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#s=setTimeout(()=>{this.#s=null,this.#a.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},r)},{signal:o}),e.addEventListener("mouseleave",()=>{this.#s&&(clearTimeout(this.#s),this.#s=null),this.#a?.classList.remove("show")},{signal:o})}this.#t?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=this.#e),t.parentNode||e.append(t),this.#c.getElementForAltText()?.setAttribute("aria-describedby",t.id)}}class Lg{#e=null;#t=null;#i=!1;#n=null;#a=null;#s=null;#r=null;#o=null;#c=!1;#l=null;constructor(e){this.#n=e}renderForToolbar(){const e=this.#t=document.createElement("button");return e.className="comment",this.#h(e,!1)}renderForStandalone(){const e=this.#e=document.createElement("button");e.className="annotationCommentButton";const t=this.#n.commentButtonPosition;if(t){const{style:n}=e;n.insetInlineEnd=`calc(${100*(this.#n._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,n.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const r=this.#n.commentButtonColor;r&&(n.backgroundColor=r)}return this.#h(e,!0)}focusButton(){setTimeout(()=>{(this.#e??this.#t)?.focus()},0)}onUpdatedColor(){if(!this.#e)return;const e=this.#n.commentButtonColor;e&&(this.#e.style.backgroundColor=e),this.#n._uiManager.updatePopupColor(this.#n)}get commentButtonWidth(){return(this.#e?.getBoundingClientRect().width??0)/this.#n.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#e)return null;const{x:e,y:t,height:n}=this.#e.getBoundingClientRect(),{x:r,y:o,width:d,height:c}=this.#n.parent.boundingClientRect;return[(e-r)/d,(t+n-o)/c]}set commentPopupPositionInLayer(e){this.#l=e}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#e?.remove(),this.#e=null}removeToolbarCommentButton(){this.#t?.remove(),this.#t=null}setCommentButtonStates({selected:e,hasPopup:t}){this.#e&&(this.#e.classList.toggle("selected",e),this.#e.ariaExpanded=t)}#h(e,t){if(!this.#n._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[this.#n._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const n=this.#n._uiManager._signal;if(!(n instanceof AbortSignal)||n.aborted)return e;e.addEventListener("contextmenu",Wc,{signal:n}),t&&(e.addEventListener("focusin",o=>{this.#n._focusEventsAllowed=!1,Qs(o)},{capture:!0,signal:n}),e.addEventListener("focusout",o=>{this.#n._focusEventsAllowed=!0,Qs(o)},{capture:!0,signal:n})),e.addEventListener("pointerdown",o=>o.stopPropagation(),{signal:n});const r=o=>{o.preventDefault(),e===this.#t?this.edit():this.#n.toggleComment(!0)};return e.addEventListener("click",r,{capture:!0,signal:n}),e.addEventListener("keydown",o=>{o.target===e&&o.key==="Enter"&&(this.#i=!0,r(o))},{signal:n}),e.addEventListener("pointerenter",()=>{this.#n.toggleComment(!1,!0)},{signal:n}),e.addEventListener("pointerleave",()=>{this.#n.toggleComment(!1,!1)},{signal:n}),e}edit(e){const t=this.commentPopupPositionInLayer;let n,r;if(t)[n,r]=t;else{[n,r]=this.#n.commentButtonPosition;const{width:m,height:y,x:A,y:v}=this.#n;n=A+n*m,r=v+r*y}const o=this.#n.parent.boundingClientRect,{x:d,y:c,width:h,height:f}=o;this.#n._uiManager.editComment(this.#n,d+n*h,c+r*f,{...e,parentDimensions:o})}finish(){this.#t&&(this.#t.focus({focusVisible:this.#i}),this.#i=!1)}isDeleted(){return this.#c||this.#r===""}isEmpty(){return this.#r===null}hasBeenEdited(){return this.isDeleted()||this.#r!==this.#a}serialize(){return this.data}get data(){return{text:this.#r,richText:this.#s,date:this.#o,deleted:this.isDeleted()}}set data(e){if(e!==this.#r&&(this.#s=null),e===null){this.#r="",this.#c=!0;return}this.#r=e,this.#o=new Date,this.#c=!1}setInitialText(e,t=null){this.#a=e,this.data=e,this.#o=null,this.#s=t}shown(){}destroy(){this.#t?.remove(),this.#t=null,this.#e?.remove(),this.#e=null,this.#r="",this.#s=null,this.#o=null,this.#n=null,this.#i=!1,this.#c=!1}}class p0{#e;#t=!1;#i=null;#n;#a;#s;#r;#o=null;#c;#l=null;#h;#u=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:r=null,onPinching:o=null,onPinchEnd:d=null,signal:c}){this.#e=e,this.#i=n,this.#n=t,this.#a=r,this.#s=o,this.#r=d,this.#h=new AbortController,this.#c=AbortSignal.any([c,this.#h.signal]),e.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#c})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Id.pixelRatio}#f(e){if(this.#n?.())return;if(e.touches.length===1){if(this.#o)return;const r=this.#o=new AbortController,o=AbortSignal.any([this.#c,r.signal]),d=this.#e,c={capture:!0,signal:o,passive:!1},h=f=>{f.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};d.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(Qs(f),h(f))},c),d.addEventListener("pointerup",h,c),d.addEventListener("pointercancel",h,c);return}if(!this.#u){this.#u=new AbortController;const r=AbortSignal.any([this.#c,this.#u.signal]),o=this.#e,d={signal:r,capture:!1,passive:!1};o.addEventListener("touchmove",this.#m.bind(this),d);const c=this.#g.bind(this);o.addEventListener("touchend",c,d),o.addEventListener("touchcancel",c,d),d.capture=!0,o.addEventListener("pointerdown",Qs,d),o.addEventListener("pointermove",Qs,d),o.addEventListener("pointercancel",Qs,d),o.addEventListener("pointerup",Qs,d),this.#a?.()}if(Qs(e),e.touches.length!==2||this.#i?.()){this.#l=null;return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),this.#l={touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY}}#m(e){if(!this.#l||e.touches.length!==2)return;Qs(e);let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);const{screenX:r,screenY:o}=t,{screenX:d,screenY:c}=n,h=this.#l,{touch0X:f,touch0Y:m,touch1X:y,touch1Y:A}=h,v=y-f,N=A-m,T=d-r,_=c-o,b=Math.hypot(T,_)||1,H=Math.hypot(v,N)||1;if(!this.#t&&Math.abs(H-b)<=p0.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(h.touch0X=r,h.touch0Y=o,h.touch1X=d,h.touch1Y=c,!this.#t){this.#t=!0;return}const R=[(r+d)/2,(o+c)/2];this.#s?.(R,H,b)}#g(e){e.touches.length>=2||(this.#u&&(this.#u.abort(),this.#u=null,this.#r?.()),this.#l&&(Qs(e),this.#l=null,this.#t=!1))}destroy(){this.#h?.abort(),this.#h=null,this.#o?.abort(),this.#o=null}}class Vn{#e=null;#t=null;#i=null;#n=null;#a=null;#s=!1;#r=null;#o="";#c=null;#l=null;#h=null;#u=null;#f=null;#m="";#g=!1;#d=null;#p=!1;#y=!1;#b=!1;#x=null;#T=0;#A=0;#w=null;#_=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#v=!1;#C=Vn._zIndex++;static _borderLineWidth=-1;static _colorManager=new _y;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const e=Vn.prototype._resizeWithKeyboard,t=Yu.TRANSLATE_SMALL,n=Yu.TRANSLATE_BIG;return bi(this,"_resizerKeyboardManager",new jp([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],Vn.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null,this.canAddComment=!0;const{rotation:t,rawDims:{pageWidth:n,pageHeight:r,pageX:o,pageY:d}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,r],this.pageTranslation=[o,d];const[c,h]=this.parentDimensions;this.x=e.x/c,this.y=e.y/h,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return bi(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new JC({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(Vn._l10n??=e,Vn._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),Vn._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);Vn._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){ss("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#v}set _isDraggable(e){this.#v=e,this.div?.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#C}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(this.#I(),this.#u?.remove(),this.#u=null),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#g?this.#g=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,r){const[o,d]=this.parentDimensions;[n,r]=this.screenToPageTranslation(n,r),this.x=(e+n)/o,this.y=(t+r)/d,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[n,r]=this.parentDimensions;this.setAt(e*n,t*r,this.width*n,this.height*r),this._onTranslated()}#P([e,t],n,r){[n,r]=this.screenToPageTranslation(n,r),this.x+=n/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#P(this.parentDimensions,e,t)}translateInPage(e,t){this.#d||=[this.x,this.y,this.width,this.height],this.#P(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){this.#d||=[this.x,this.y,this.width,this.height];const{div:n,parentDimensions:[r,o]}=this;if(this.x+=e/r,this.y+=t/o,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:y,y:A}=this.div.getBoundingClientRect();this.parent.findNewParent(this,y,A)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:d,y:c}=this;const[h,f]=this.getBaseTranslation();d+=h,c+=f;const{style:m}=n;m.left=`${(100*d).toFixed(2)}%`,m.top=`${(100*c).toFixed(2)}%`,this._onTranslating(d,c),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#d&&(this.#d[0]!==this.x||this.#d[1]!==this.y)}get _hasBeenResized(){return!!this.#d&&(this.#d[2]!==this.width||this.#d[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=Vn,r=n/e,o=n/t;switch(this.rotation){case 90:return[-r,o];case 180:return[r,o];case 270:return[r,-o];default:return[-r,-o]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[n,r]}=this;let{x:o,y:d,width:c,height:h}=this;if(c*=n,h*=r,o*=n,d*=r,this._mustFixPosition)switch(e){case 0:o=Sl(o,0,n-c),d=Sl(d,0,r-h);break;case 90:o=Sl(o,0,n-h),d=Sl(d,c,r);break;case 180:o=Sl(o,c,n),d=Sl(d,h,r);break;case 270:o=Sl(o,h,n),d=Sl(d,0,r-c);break}this.x=o/=n,this.y=d/=r;const[f,m]=this.getBaseTranslation();o+=f,d+=m,t.left=`${(100*o).toFixed(2)}%`,t.top=`${(100*d).toFixed(2)}%`,this.moveInDOM()}static#j(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return Vn.#j(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return Vn.#j(e,t,360-this.parentRotation)}#N(e){switch(e){case 90:{const[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(){const{div:{style:e},width:t,height:n}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*n).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#z(){if(this.#c)return;this.#c=document.createElement("div"),this.#c.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const r=document.createElement("div");this.#c.append(r),r.classList.add("resizer",n),r.setAttribute("data-resizer-name",n),r.addEventListener("pointerdown",this.#R.bind(this,n),{signal:t}),r.addEventListener("contextmenu",Wc,{signal:t}),r.tabIndex=-1}this.div.prepend(this.#c)}#R(e,t){t.preventDefault();const{isMac:n}=jo.platform;if(t.button!==0||t.ctrlKey&&n)return;this.#i?.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,this.#l=[t.screenX,t.screenY];const o=new AbortController,d=this._uiManager.combinedSignal(o);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#M.bind(this,e),{passive:!0,capture:!0,signal:d}),window.addEventListener("touchmove",Qs,{passive:!1,signal:d}),window.addEventListener("contextmenu",Wc,{signal:d}),this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const c=this.parent.div.style.cursor,h=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const f=()=>{o.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=c,this.div.style.cursor=h,this.#B()};window.addEventListener("pointerup",f,{signal:d}),window.addEventListener("blur",f,{signal:d})}#L(e,t,n,r){this.width=n,this.height=r,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#B(){if(!this.#h)return;const{savedX:e,savedY:t,savedWidth:n,savedHeight:r}=this.#h;this.#h=null;const o=this.x,d=this.y,c=this.width,h=this.height;o===e&&d===t&&c===n&&h===r||this.addCommands({cmd:this.#L.bind(this,o,d,c,h),undo:this.#L.bind(this,e,t,n,r),mustExec:!0})}static _round(e){return Math.round(e*1e4)/1e4}#M(e,t){const[n,r]=this.parentDimensions,o=this.x,d=this.y,c=this.width,h=this.height,f=Vn.MIN_SIZE/n,m=Vn.MIN_SIZE/r,y=this.#N(this.rotation),A=(ie,le)=>[y[0]*ie+y[2]*le,y[1]*ie+y[3]*le],v=this.#N(360-this.rotation),N=(ie,le)=>[v[0]*ie+v[2]*le,v[1]*ie+v[3]*le];let T,_,b=!1,H=!1;switch(e){case"topLeft":b=!0,T=(ie,le)=>[0,0],_=(ie,le)=>[ie,le];break;case"topMiddle":T=(ie,le)=>[ie/2,0],_=(ie,le)=>[ie/2,le];break;case"topRight":b=!0,T=(ie,le)=>[ie,0],_=(ie,le)=>[0,le];break;case"middleRight":H=!0,T=(ie,le)=>[ie,le/2],_=(ie,le)=>[0,le/2];break;case"bottomRight":b=!0,T=(ie,le)=>[ie,le],_=(ie,le)=>[0,0];break;case"bottomMiddle":T=(ie,le)=>[ie/2,le],_=(ie,le)=>[ie/2,0];break;case"bottomLeft":b=!0,T=(ie,le)=>[0,le],_=(ie,le)=>[ie,0];break;case"middleLeft":H=!0,T=(ie,le)=>[0,le/2],_=(ie,le)=>[ie,le/2];break}const R=T(c,h),M=_(c,h);let B=A(...M);const q=Vn._round(o+B[0]),G=Vn._round(d+B[1]);let X=1,O=1,Y,W;if(t.fromKeyboard)({deltaX:Y,deltaY:W}=t);else{const{screenX:ie,screenY:le}=t,[se,Ae]=this.#l;[Y,W]=this.screenToPageTranslation(ie-se,le-Ae),this.#l[0]=ie,this.#l[1]=le}if([Y,W]=N(Y/n,W/r),b){const ie=Math.hypot(c,h);X=O=Math.max(Math.min(Math.hypot(M[0]-R[0]-Y,M[1]-R[1]-W)/ie,1/c,1/h),f/c,m/h)}else H?X=Sl(Math.abs(M[0]-R[0]-Y),f,1)/c:O=Sl(Math.abs(M[1]-R[1]-W),m,1)/h;const I=Vn._round(c*X),J=Vn._round(h*O);B=A(..._(I,J));const Z=q-B[0],Ce=G-B[1];this.#d||=[this.x,this.y,this.width,this.height],this.width=I,this.height=J,this.x=Z,this.y=Ce,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#i?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#y)return this._editToolbar;this._editToolbar=new pp(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,n]of e)await this._editToolbar.addButton(t,n);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#i?.destroy()}addContainer(e){const t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#i||(Ld.initialize(Vn._l10n),this.#i=new Ld(this),this.#e&&(this.#i.data=this.#e,this.#e=null)),this.#i}get altTextData(){return this.#i?.data}set altTextData(e){this.#i&&(this.#i.data=e)}get guessedAltText(){return this.#i?.guessedText}async setGuessedAltText(e){await this.#i?.setGuessedText(e)}serializeAltText(e){return this.#i?.serialize(e)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}focusCommentButton(){this.#n?.focusButton()}addCommentButton(){return this.canAddComment?this.#n||=new Lg(this):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(this.#a){this._uiManager.isEditingMode()&&this.#a.classList.remove("hidden");return}this.hasComment&&(this.#a=this.#n.renderForStandalone(),this.div.append(this.#a))}}removeStandaloneCommentButton(){this.#n.removeStandaloneCommentButton(),this.#a=null}hideStandaloneCommentButton(){this.#a?.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:n,deleted:r}}=this.#n;return{text:t,richText:e,date:n,deleted:r,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){this.#n||=new Lg(this),this.#n.data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:n}){if(!t||(this.#n||=new Lg(this),this.#n.setInitialText(e,n),!this.annotationElementId))return;const r=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);r&&this.updateFromAnnotationLayer(r)}get hasEditedComment(){return this.#n?.hasBeenEdited()}get hasDeletedComment(){return this.#n?.isDeleted()}get hasComment(){return!!this.#n&&!this.#n.isEmpty()&&!this.#n.isDeleted()}async editComment(e){this.#n||=new Lg(this),this.#n.edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){this.#n.setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,r]=e.rect,[o]=this.pageDimensions,[d]=this.pageTranslation,c=d+o+1,h=r-100,f=c+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[c,h,f,r]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){this.#n.data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=this.#s?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),this.#U();const[t,n]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*n/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/n).toFixed(2)}%`);const[r,o]=this.getInitialTranslation();return this.translate(r,o),lv(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#_||=new p0({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#q.bind(this),onPinching:this.#k.bind(this),onPinchEnd:this.#S.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),e}#q(){this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#i?.toggle(!1),this.parent.togglePointerEvents(!1)}#k(e,t,n){let o=.7*(n/t)+1-.7;if(o===1)return;const d=this.#N(this.rotation),c=(q,G)=>[d[0]*q+d[2]*G,d[1]*q+d[3]*G],[h,f]=this.parentDimensions,m=this.x,y=this.y,A=this.width,v=this.height,N=Vn.MIN_SIZE/h,T=Vn.MIN_SIZE/f;o=Math.max(Math.min(o,1/A,1/v),N/A,T/v);const _=Vn._round(A*o),b=Vn._round(v*o);if(_===A&&b===v)return;this.#d||=[m,y,A,v];const H=c(A/2,v/2),R=Vn._round(m+H[0]),M=Vn._round(y+H[1]),B=c(_/2,b/2);this.x=R-B[0],this.y=M-B[1],this.width=_,this.height=b,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#S(){this.#i?.toggle(!0),this.parent.togglePointerEvents(!0),this.#B()}pointerdown(e){const{isMac:t}=jo.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#g=!0,this._isDraggable){this.#F(e);return}this.#D(e)}#D(e){const{isMac:t}=jo.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#F(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1;const r=new AbortController,o=this._uiManager.combinedSignal(r),d={capture:!0,passive:!1,signal:o},c=f=>{r.abort(),this.#r=null,this.#g=!1,this._uiManager.endDragSession()||this.#D(f),n&&this._onStopDragging()};t&&(this.#T=e.clientX,this.#A=e.clientY,this.#r=e.pointerId,this.#o=e.pointerType,window.addEventListener("pointermove",f=>{n||(n=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:m,clientY:y,pointerId:A}=f;if(A!==this.#r){Qs(f);return}const[v,N]=this.screenToPageTranslation(m-this.#T,y-this.#A);this.#T=m,this.#A=y,this._uiManager.dragSelectedEditors(v,N)},d),window.addEventListener("touchmove",Qs,d),window.addEventListener("pointerdown",f=>{f.pointerType===this.#o&&(this.#_||f.isPrimary)&&c(f),Qs(f)},d));const h=f=>{if(!this.#r||this.#r===f.pointerId){c(f);return}Qs(f)};window.addEventListener("pointerup",h,{signal:o}),window.addEventListener("blur",h,{signal:o})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#x&&clearTimeout(this.#x),this.#x=setTimeout(()=>{this.#x=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){const r=this.parentScale,[o,d]=this.pageDimensions,[c,h]=this.pageTranslation,f=e/r,m=t/r,y=this.x*o,A=this.y*d,v=this.width*o,N=this.height*d;switch(n){case 0:return[y+f+c,d-A-m-N+h,y+f+v+c,d-A-m+h];case 90:return[y+m+c,d-A+f+h,y+m+N+c,d-A+f+v+h];case 180:return[y-f-v+c,d-A+m+h,y-f+c,d-A+m+N+h];case 270:return[y-m-N+c,d-A-f-v+h,y-m+c,d-A-f+h];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,r,o,d]=e,c=o-n,h=d-r;switch(this.rotation){case 0:return[n,t-d,c,h];case 90:return[n,t-r,h,c];case 180:return[o,t-r,c,h];case 270:return[o,t-d,h,c];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&Vn._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#n?.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:n,opacity:r,deleted:o,richText:d},uid:c,pageIndex:h,creationDate:f,modificationDate:m}=this;return{id:c,pageIndex:h,rect:this.getPDFRect(),richText:d,contentsObj:{str:e},creationDate:f,modificationDate:n||m,popupRef:!o,color:t,opacity:r}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#y=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#y=!1,!0):!1}isInEditMode(){return this.#y}shouldGetKeyboardEvents(){return this.#b}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:n,right:r}=this.getClientDimensions(),{innerHeight:o,innerWidth:d}=window;return t<d&&r>0&&e<o&&n>0}#U(){if(this.#f||!this.div)return;this.#f=new AbortController;const e=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#U()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(e,t,n){const r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});r.rotation=e.rotation,r.#e=e.accessibilityData,r._isCopy=e.isCopy||!1;const[o,d]=r.pageDimensions,[c,h,f,m]=r.getRectInCurrentCoords(e.rect,d);return r.x=c/o,r.y=h/d,r.width=f/o,r.height=m/d,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#x&&(clearTimeout(this.#x),this.#x=null),this.#I(),this.removeEditToolbar(),this.#w){for(const e of this.#w.values())clearTimeout(e);this.#w=null}this.parent=null,this.#_?.destroy(),this.#_=null,this.#u?.remove(),this.#u=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#z(),this.#c.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[n,r,o,d]=this.getPDFRect();return[Vn._round(n+(o-n)*e),Vn._round(r+(d-r)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#n.commentPopupPositionInLayer}set commentPopupPosition(e){this.#n.commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return this.#n.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#n.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){this.#n?.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#c.children;if(!this.#t){this.#t=Array.from(t);const d=this.#G.bind(this),c=this.#$.bind(this),h=this._uiManager._signal;for(const f of this.#t){const m=f.getAttribute("data-resizer-name");f.setAttribute("role","spinbutton"),f.addEventListener("keydown",d,{signal:h}),f.addEventListener("blur",c,{signal:h}),f.addEventListener("focus",this.#Y.bind(this,m),{signal:h}),f.setAttribute("data-l10n-id",Vn._l10nResizer[m])}}const n=this.#t[0];let r=0;for(const d of t){if(d===n)break;r++}const o=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(o!==r){if(o<r)for(let c=0;c<r-o;c++)this.#c.append(this.#c.firstElementChild);else if(o>r)for(let c=0;c<o-r;c++)this.#c.firstElementChild.before(this.#c.lastElementChild);let d=0;for(const c of t){const f=this.#t[d++].getAttribute("data-resizer-name");c.setAttribute("data-l10n-id",Vn._l10nResizer[f])}}this.#H(0),this.#b=!0,this.#c.firstElementChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#G(e){Vn._resizerKeyboardManager.exec(this,e)}#$(e){this.#b&&e.relatedTarget?.parentNode!==this.#c&&this.#I()}#Y(e){this.#m=this.#b?e:""}#H(e){if(this.#t)for(const t of this.#t)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#b&&this.#M(this.#m,{deltaX:e,deltaY:t,fromKeyboard:!0})}#I(){this.#b=!1,this.#H(-1),this.#B()}_stopResizingWithKeyboard(){this.#I(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#c?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(e){this.#p=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#w||=new Map;const{action:n}=e;let r=this.#w.get(n);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),this.#w.delete(n),this.#w.size===0&&(this.#w=null)},Vn._telemetryTimeout),this.#w.set(n,r);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#s=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#s=!0}updateFakeAnnotationElement(e){if(!this.#u&&!this.deleted){this.#u=e.addFakeAnnotation(this);return}if(this.deleted){this.#u.remove(),this.#u=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#u.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){const{firstElementChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}}class JC extends Vn{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Mb=3285377520,Fc=4294901760,Ed=65535;class cv{constructor(e){this.h1=e?e&4294967295:Mb,this.h2=e?e&4294967295:Mb}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let T=0,_=e.length;T<_;T++){const b=e.charCodeAt(T);b<=255?t[n++]=b:(t[n++]=b>>>8,t[n++]=b&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=n>>2,o=n-r*4,d=new Uint32Array(t.buffer,0,r);let c=0,h=0,f=this.h1,m=this.h2;const y=3432918353,A=461845907,v=y&Ed,N=A&Ed;for(let T=0;T<r;T++)T&1?(c=d[T],c=c*y&Fc|c*v&Ed,c=c<<15|c>>>17,c=c*A&Fc|c*N&Ed,f^=c,f=f<<13|f>>>19,f=f*5+3864292196):(h=d[T],h=h*y&Fc|h*v&Ed,h=h<<15|h>>>17,h=h*A&Fc|h*N&Ed,m^=h,m=m<<13|m>>>19,m=m*5+3864292196);switch(c=0,o){case 3:c^=t[r*4+2]<<16;case 2:c^=t[r*4+1]<<8;case 1:c^=t[r*4],c=c*y&Fc|c*v&Ed,c=c<<15|c>>>17,c=c*A&Fc|c*N&Ed,r&1?f^=c:m^=c}this.h1=f,this.h2=m}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Fc|e*36045&Ed,t=t*4283543511&Fc|((t<<16|e>>>16)*2950163797&Fc)>>>16,e^=t>>>1,e=e*444984403&Fc|e*60499&Ed,t=t*3301882366&Fc|((t<<16|e>>>16)*3120437893&Fc)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const ly=Object.freeze({map:null,hash:"",transfer:void 0});class jy{#e=!1;#t=null;#i=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=this.#n.get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return this.#n.get(e)}remove(e){const t=this.#n.get(e);if(t!==void 0&&(t instanceof Vn&&this.#i.delete(t.annotationElementId),this.#n.delete(e),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const n of this.#n.values())if(n instanceof Vn)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=this.#n.get(e);let r=!1;if(n!==void 0)for(const[o,d]of Object.entries(t))n[o]!==d&&(r=!0,n[o]=d);else r=!0,this.#n.set(e,t);r&&this.#a(),t instanceof Vn&&((this.#i||=new Map).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return this.#n.has(e)}get size(){return this.#n.size}#a(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new dv(this)}get serializable(){if(this.#n.size===0)return ly;const e=new Map,t=new cv,n=[],r=Object.create(null);let o=!1;for(const[d,c]of this.#n){const h=c instanceof Vn?c.serialize(!1,r):c;h&&(e.set(d,h),t.update(`${d}:${JSON.stringify(h)}`),o||=!!h.bitmap)}if(o)for(const d of e.values())d.bitmap&&n.push(d.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:ly}get editorStats(){let e=null;const t=new Map;let n=0,r=0;for(const o of this.#n.values()){if(!(o instanceof Vn)){o.popup&&(o.popup.deleted?r+=1:n+=1);continue}o.isCommentDeleted?r+=1:o.hasEditedComment&&(n+=1);const d=o.telemetryFinalData;if(!d)continue;const{type:c}=d;t.has(c)||t.set(c,Object.getPrototypeOf(o).constructor),e||=Object.create(null);const h=e[c]||=new Map;for(const[f,m]of Object.entries(d)){if(f==="type")continue;let y=h.get(f);y||(y=new Map,h.set(f,y));const A=y.get(m)??0;y.set(m,A+1)}}if((r>0||n>0)&&(e||=Object.create(null),e.comments={deleted:r,edited:n}),!e)return null;for(const[o,d]of t)e[o]=d.computeTelemetryFinalData(e[o]);return e}resetModifiedIds(){this.#t=null}updateEditor(e,t){const n=this.#i?.get(e);return n?(n.updateFromAnnotationLayer(t),!0):!1}getEditor(e){return this.#i?.get(e)||null}get modifiedIds(){if(this.#t)return this.#t;const e=[];if(this.#i)for(const t of this.#i.values())t.serialize()&&e.push(t.annotationElementId);return this.#t={ids:new Set(e),hash:e.join(",")}}[Symbol.iterator](){return this.#n.entries()}}class dv extends jy{#e;constructor(e){super();const{map:t,hash:n,transfer:r}=e.serializable,o=structuredClone(t,r?{transfer:r}:null);this.#e={map:o,hash:n,transfer:r}}get print(){ss("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}get modifiedIds(){return bi(this,"modifiedIds",{ids:new Set,hash:""})}}class QC{#e=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:n}){if(!(!e||this.#e.has(e.loadedName))){if(sr(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:r,src:o,style:d}=e,c=new FontFace(r,o,d);this.addNativeFontFace(c);try{await c.load(),this.#e.add(r),n?.(e)}catch{xi(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(c)}return}ss("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(r){throw xi(`Failed to load font '${n.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const r=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){const e=!!this._document?.fonts;return bi(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return bi(this,"isSyncFontLoadingSupported",wl||jo.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(sr(!r.done,"completeRequest() cannot be called twice."),r.done=!0;n.length>0&&n[0].done;){const o=n.shift();setTimeout(o.callback,0)}}const{loadingRequests:n}=this,r={done:!1,complete:t,callback:e};return n.push(r),r}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return bi(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(M,B){return M.charCodeAt(B)<<24|M.charCodeAt(B+1)<<16|M.charCodeAt(B+2)<<8|M.charCodeAt(B+3)&255}function r(M,B,q,G){const X=M.substring(0,B),O=M.substring(B+q);return X+G+O}let o,d;const c=this._document.createElement("canvas");c.width=1,c.height=1;const h=c.getContext("2d");let f=0;function m(M,B){if(++f>30){xi("Load test font never loaded."),B();return}if(h.font="30px "+M,h.fillText(".",0,20),h.getImageData(0,0,1,1).data[3]>0){B();return}setTimeout(m.bind(null,M,B))}const y=`lt${Date.now()}${this.loadTestFontId++}`;let A=this._loadTestFont;A=r(A,976,y.length,y);const N=16,T=1482184792;let _=n(A,N);for(o=0,d=y.length-3;o<d;o+=4)_=_-T+n(y,o)|0;o<y.length&&(_=_-T+n(y+"XXX",o)|0),A=r(A,N,4,DC(_));const b=`url(data:font/opentype;base64,${btoa(A)});`,H=`@font-face {font-family:"${y}";src:${b}}`;this.insertRule(H);const R=this._document.createElement("div");R.style.visibility="hidden",R.style.width=R.style.height="10px",R.style.position="absolute",R.style.top=R.style.left="0px";for(const M of[e.loadedName,y]){const B=this._document.createElement("span");B.textContent="Hi",B.style.fontFamily=M,R.append(B)}this._document.body.append(R),m(y,()=>{R.remove(),t.complete()})}}class e3{#e;constructor(e,t=null,n,r){this.compiledGlyphs=Object.create(null),this.#e=e,this._inspectFont=t,n&&Object.assign(this,n),r&&(this.charProcOperatorList=r)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${rv(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const n=this.loadedName+"_path_"+t;let r;try{r=e.get(n)}catch(d){xi(`getPathGenerator - ignoring character: "${d}".`)}const o=ov(r);return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=o}get black(){return this.#e.black}get bold(){return this.#e.bold}get disableFontFace(){return this.#e.disableFontFace??!1}set disableFontFace(e){bi(this,"disableFontFace",!!e)}get fontExtraProperties(){return this.#e.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#e.isInvalidPDFjsFont}get isType3Font(){return this.#e.isType3Font}get italic(){return this.#e.italic}get missingFile(){return this.#e.missingFile}get remeasure(){return this.#e.remeasure}get vertical(){return this.#e.vertical}get ascent(){return this.#e.ascent}get defaultWidth(){return this.#e.defaultWidth}get descent(){return this.#e.descent}get bbox(){return this.#e.bbox}set bbox(e){bi(this,"bbox",e)}get fontMatrix(){return this.#e.fontMatrix}get fallbackName(){return this.#e.fallbackName}get loadedName(){return this.#e.loadedName}get mimetype(){return this.#e.mimetype}get name(){return this.#e.name}get data(){return this.#e.data}clearData(){this.#e.clearData()}get cssFontInfo(){return this.#e.cssFontInfo}get systemFontInfo(){return this.#e.systemFontInfo}get defaultVMetrics(){return this.#e.defaultVMetrics}}class vf{#e;#t;#i;static strings=["fontFamily","fontWeight","italicAngle"];static write(e){const t=new TextEncoder,n={};let r=0;for(const f of vf.strings){const m=t.encode(e[f]);n[f]=m,r+=4+m.length}const o=new ArrayBuffer(r),d=new Uint8Array(o),c=new DataView(o);let h=0;for(const f of vf.strings){const m=n[f],y=m.length;c.setUint32(h,y),d.set(m,h+4),h+=4+y}return sr(h===o.byteLength,"CssFontInfo.write: Buffer overflow"),o}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#i=new TextDecoder}#n(e){sr(e<vf.strings.length,"Invalid string index");let t=0;for(let r=0;r<e;r++)t+=this.#t.getUint32(t)+4;const n=this.#t.getUint32(t);return this.#i.decode(new Uint8Array(this.#e,t+4,n))}get fontFamily(){return this.#n(0)}get fontWeight(){return this.#n(1)}get italicAngle(){return this.#n(2)}}class wf{#e;#t;#i;static strings=["css","loadedName","baseFontName","src"];static write(e){const t=new TextEncoder,n={};let r=0;for(const A of wf.strings){const v=t.encode(e[A]);n[A]=v,r+=4+v.length}r+=4;let o,d,c=1+r;e.style&&(o=t.encode(e.style.style),d=t.encode(e.style.weight),c+=4+o.length+4+d.length);const h=new ArrayBuffer(c),f=new Uint8Array(h),m=new DataView(h);let y=0;m.setUint8(y++,e.guessFallback?1:0),m.setUint32(y,0),y+=4,r=0;for(const A of wf.strings){const v=n[A],N=v.length;r+=4+N,m.setUint32(y,N),f.set(v,y+4),y+=4+N}return m.setUint32(y-r-4,r),e.style&&(m.setUint32(y,o.length),f.set(o,y+4),y+=4+o.length,m.setUint32(y,d.length),f.set(d,y+4),y+=4+d.length),sr(y<=h.byteLength,"SubstitionInfo.write: Buffer overflow"),h.transferToFixedLength(y)}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#i=new TextDecoder}get guessFallback(){return this.#t.getUint8(0)!==0}#n(e){sr(e<wf.strings.length,"Invalid string index");let t=5;for(let r=0;r<e;r++)t+=this.#t.getUint32(t)+4;const n=this.#t.getUint32(t);return this.#i.decode(new Uint8Array(this.#e,t+4,n))}get css(){return this.#n(0)}get loadedName(){return this.#n(1)}get baseFontName(){return this.#n(2)}get src(){return this.#n(3)}get style(){let e=1;e+=4+this.#t.getUint32(e);const t=this.#t.getUint32(e),n=this.#i.decode(new Uint8Array(this.#e,e+4,t));e+=4+t;const r=this.#t.getUint32(e),o=this.#i.decode(new Uint8Array(this.#e,e+4,r));return{style:n,weight:o}}}class Xr{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#e=Math.ceil(this.bools.length*2/8);static#t=this.#e+this.numbers.length*8;static#i=this.#t+1+8;static#n=this.#i+1+48;static#a=this.#n+1+6;#s;#r;#o;constructor({data:e,extra:t}){this.#s=e,this.#r=new TextDecoder,this.#o=new DataView(this.#s),t&&Object.assign(this,t)}#c(e){sr(e<Xr.bools.length,"Invalid boolean index");const t=Math.floor(e/4),n=e*2%8,r=this.#o.getUint8(t)>>n&3;return r===0?void 0:r===2}get black(){return this.#c(0)}get bold(){return this.#c(1)}get disableFontFace(){return this.#c(2)}get fontExtraProperties(){return this.#c(3)}get isInvalidPDFjsFont(){return this.#c(4)}get isType3Font(){return this.#c(5)}get italic(){return this.#c(6)}get missingFile(){return this.#c(7)}get remeasure(){return this.#c(8)}get vertical(){return this.#c(9)}#l(e){return sr(e<Xr.numbers.length,"Invalid number index"),this.#o.getFloat64(Xr.#e+e*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let e=Xr.#t;if(this.#o.getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<4;r++)n.push(this.#o.getInt16(e,!0)),e+=2;return n}get fontMatrix(){let e=Xr.#i;if(this.#o.getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<6;r++)n.push(this.#o.getFloat64(e,!0)),e+=8;return n}get defaultVMetrics(){let e=Xr.#n;if(this.#o.getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<3;r++)n.push(this.#o.getInt16(e,!0)),e+=2;return n}#h(e){sr(e<Xr.strings.length,"Invalid string index");let t=Xr.#a+4;for(let o=0;o<e;o++)t+=this.#o.getUint32(t)+4;const n=this.#o.getUint32(t),r=new Uint8Array(n);return r.set(new Uint8Array(this.#s,t+4,n)),this.#r.decode(r)}get fallbackName(){return this.#h(0)}get loadedName(){return this.#h(1)}get mimetype(){return this.#h(2)}get name(){return this.#h(3)}get data(){let e=Xr.#a;const t=this.#o.getUint32(e);e+=4+t;const n=this.#o.getUint32(e);e+=4+n;const r=this.#o.getUint32(e);e+=4+r;const o=this.#o.getUint32(e);if(o!==0)return new Uint8Array(this.#s,e+4,o)}clearData(){let e=Xr.#a;const t=this.#o.getUint32(e);e+=4+t;const n=this.#o.getUint32(e);e+=4+n;const r=this.#o.getUint32(e);e+=4+r;const o=this.#o.getUint32(e);new Uint8Array(this.#s,e+4,o).fill(0),this.#o.setUint32(e,0)}get cssFontInfo(){let e=Xr.#a;const t=this.#o.getUint32(e);e+=4+t;const n=this.#o.getUint32(e);e+=4+n;const r=this.#o.getUint32(e);if(r===0)return null;const o=new Uint8Array(r);return o.set(new Uint8Array(this.#s,e+4,r)),new vf(o.buffer)}get systemFontInfo(){let e=Xr.#a;const t=this.#o.getUint32(e);e+=4+t;const n=this.#o.getUint32(e);if(n===0)return null;const r=new Uint8Array(n);return r.set(new Uint8Array(this.#s,e+4,n)),new wf(r.buffer)}static write(e){const t=e.systemFontInfo?wf.write(e.systemFontInfo):null,n=e.cssFontInfo?vf.write(e.cssFontInfo):null,r=new TextEncoder,o={};let d=0;for(const T of Xr.strings)o[T]=r.encode(e[T]),d+=4+o[T].length;const c=Xr.#a+4+d+4+(t?t.byteLength:0)+4+(n?n.byteLength:0)+4+(e.data?e.data.length:0),h=new ArrayBuffer(c),f=new Uint8Array(h),m=new DataView(h);let y=0;const A=Xr.bools.length;let v=0,N=0;for(let T=0;T<A;T++){const _=e[Xr.bools[T]];v|=(_===void 0?0:_?2:1)<<N,N+=2,(N===8||T===A-1)&&(m.setUint8(y++,v),v=0,N=0)}sr(y===Xr.#e,"FontInfo.write: Boolean properties offset mismatch");for(const T of Xr.numbers)m.setFloat64(y,e[T]),y+=8;if(sr(y===Xr.#t,"FontInfo.write: Number properties offset mismatch"),e.bbox){m.setUint8(y++,4);for(const T of e.bbox)m.setInt16(y,T,!0),y+=2}else m.setUint8(y++,0),y+=8;if(sr(y===Xr.#i,"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){m.setUint8(y++,6);for(const T of e.fontMatrix)m.setFloat64(y,T,!0),y+=8}else m.setUint8(y++,0),y+=48;if(sr(y===Xr.#n,"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){m.setUint8(y++,1);for(const T of e.defaultVMetrics)m.setInt16(y,T,!0),y+=2}else m.setUint8(y++,0),y+=6;sr(y===Xr.#a,"FontInfo.write: DefaultVMetrics properties offset mismatch"),m.setUint32(Xr.#a,0),y+=4;for(const T of Xr.strings){const _=o[T],b=_.length;m.setUint32(y,b),f.set(_,y+4),y+=4+b}if(m.setUint32(Xr.#a,y-Xr.#a-4),!t)m.setUint32(y,0),y+=4;else{const T=t.byteLength;m.setUint32(y,T),sr(y+4+T<=h.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),f.set(new Uint8Array(t),y+4),y+=4+T}if(!n)m.setUint32(y,0),y+=4;else{const T=n.byteLength;m.setUint32(y,T),sr(y+4+T<=h.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),f.set(new Uint8Array(n),y+4),y+=4+T}return e.data===void 0?(m.setUint32(y,0),y+=4):(m.setUint32(y,e.data.length),f.set(e.data,y+4),y+=4+e.data.length),sr(y<=h.byteLength,"FontInfo.write: Buffer overflow"),h.transferToFixedLength(y)}}class ao{static#e=0;static#t=1;static#i=2;static#n=3;static#a=4;static#s=8;static#r=12;static#o=16;constructor(e){this.buffer=e,this.view=new DataView(e),this.data=new Uint8Array(e)}static write(e){let t,n=null,r=[],o=[],d=[],c=[],h=null,f=null;switch(e[0]){case"RadialAxial":t=e[1]==="axial"?1:2,n=e[2],d=e[3],t===1?r.push(...e[4],...e[5]):r.push(e[4][0],e[4][1],e[6],e[5][0],e[5][1],e[7]);break;case"Mesh":t=3,h=e[1],r=e[2],o=e[3],c=e[4]||[],n=e[6],f=e[7];break;default:throw new Error(`Unsupported pattern type: ${e[0]}`)}const m=Math.floor(r.length/2),y=Math.floor(o.length/3),A=d.length,v=c.length;let N=0;for(const B of c)N+=1,N=Math.ceil(N/4)*4,N+=4+B.coords.length*4,N+=4+B.colors.length*4,B.verticesPerRow!==void 0&&(N+=4);const T=20+m*8+y*3+A*8+(n?16:0)+(f?3:0)+N,_=new ArrayBuffer(T),b=new DataView(_),H=new Uint8Array(_);b.setUint8(ao.#e,t),b.setUint8(ao.#t,n?1:0),b.setUint8(ao.#i,f?1:0),b.setUint8(ao.#n,h),b.setUint32(ao.#a,m,!0),b.setUint32(ao.#s,y,!0),b.setUint32(ao.#r,A,!0),b.setUint32(ao.#o,v,!0);let R=20;new Float32Array(_,R,m*2).set(r),R+=m*8,H.set(o,R),R+=y*3;for(const[B,q]of d)b.setFloat32(R,B,!0),R+=4,b.setUint32(R,parseInt(q.slice(1),16),!0),R+=4;if(n)for(const B of n)b.setFloat32(R,B,!0),R+=4;f&&(H.set(f,R),R+=3);for(let B=0;B<c.length;B++){const q=c[B];b.setUint8(R,q.type),R+=1,R=Math.ceil(R/4)*4,b.setUint32(R,q.coords.length,!0),R+=4,new Int32Array(_,R,q.coords.length).set(q.coords),R+=q.coords.length*4,b.setUint32(R,q.colors.length,!0),R+=4,new Int32Array(_,R,q.colors.length).set(q.colors),R+=q.colors.length*4,q.verticesPerRow!==void 0&&(b.setUint32(R,q.verticesPerRow,!0),R+=4)}return _}getIR(){const e=this.view,t=this.data[ao.#e],n=!!this.data[ao.#t],r=!!this.data[ao.#i],o=e.getUint32(ao.#a,!0),d=e.getUint32(ao.#s,!0),c=e.getUint32(ao.#r,!0),h=e.getUint32(ao.#o,!0);let f=20;const m=new Float32Array(this.buffer,f,o*2);f+=o*8;const y=new Uint8Array(this.buffer,f,d*3);f+=d*3;const A=[];for(let _=0;_<c;++_){const b=e.getFloat32(f,!0);f+=4;const H=e.getUint32(f,!0);f+=4,A.push([b,`#${H.toString(16).padStart(6,"0")}`])}let v=null;if(n){v=[];for(let _=0;_<4;++_)v.push(e.getFloat32(f,!0)),f+=4}let N=null;r&&(N=new Uint8Array(this.buffer,f,3),f+=3);const T=[];for(let _=0;_<h;++_){const b=e.getUint8(f);f+=1,f=Math.ceil(f/4)*4;const H=e.getUint32(f,!0);f+=4;const R=new Int32Array(this.buffer,f,H);f+=H*4;const M=e.getUint32(f,!0);f+=4;const B=new Int32Array(this.buffer,f,M);f+=M*4;const q={type:b,coords:R,colors:B};b===iy.LATTICE&&(q.verticesPerRow=e.getUint32(f,!0),f+=4),T.push(q)}if(t===1)return["RadialAxial","axial",v,A,Array.from(m.slice(0,2)),Array.from(m.slice(2,4)),null,null];if(t===2)return["RadialAxial","radial",v,A,[m[0],m[1]],[m[3],m[4]],m[2],m[5]];if(t===3){const _=this.data[ao.#n];let b=null;if(m.length>0){let H=m[0],R=m[0],M=m[1],B=m[1];for(let q=0;q<m.length;q+=2){const G=m[q],X=m[q+1];H=H>G?G:H,M=M>X?X:M,R=R<G?G:R,B=B<X?X:B}b=[H,M,R,B]}return["Mesh",_,m,y,T,b,v,N]}throw new Error(`Unsupported pattern kind: ${t}`)}}function t3(s){if(s instanceof URL)return s.href;if(typeof s=="string"){if(wl)return s;const e=URL.parse(s,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function n3(s){if(wl&&typeof Buffer<"u"&&s instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength)return s;if(typeof s=="string")return Cp(s);if(s instanceof ArrayBuffer||ArrayBuffer.isView(s)||typeof s=="object"&&!isNaN(s?.length))return new Uint8Array(s);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Mg(s){if(typeof s!="string")return null;if(s.endsWith("/"))return s;throw new Error(`Invalid factory url: "${s}" must include trailing slash.`)}const cy=s=>typeof s=="object"&&Number.isInteger(s?.num)&&s.num>=0&&Number.isInteger(s?.gen)&&s.gen>=0,i3=s=>typeof s=="object"&&typeof s?.name=="string",r3=BC.bind(null,cy,i3);class s3{#e=new Map;#t=Promise.resolve();postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};this.#t.then(()=>{for(const[r]of this.#e)r.call(this,n)})}addEventListener(e,t,n=null){let r=null;if(n?.signal instanceof AbortSignal){const{signal:o}=n;if(o.aborted){xi("LoopbackPort - cannot use an `aborted` signal.");return}const d=()=>this.removeEventListener(e,t);r=()=>o.removeEventListener("abort",d),o.addEventListener("abort",d)}this.#e.set(t,r)}removeEventListener(e,t){this.#e.get(t)?.(),this.#e.delete(t)}terminate(){for(const[,e]of this.#e)e?.();this.#e.clear()}}const Ig={DATA:1,ERROR:2},_a={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Ib(){}function Vl(s){if(s instanceof Gu||s instanceof ry||s instanceof jb||s instanceof i0||s instanceof Dm)return s;switch(s instanceof Error||typeof s=="object"&&s!==null||ss('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),s.name){case"AbortException":return new Gu(s.message);case"InvalidPDFException":return new ry(s.message);case"PasswordException":return new jb(s.message,s.code);case"ResponseException":return new i0(s.message,s.status,s.missing);case"UnknownErrorException":return new Dm(s.message,s.details)}return new Dm(s.message,s.toString())}class dp{#e=new AbortController;constructor(e,t,n){this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",this.#t.bind(this),{signal:this.#e.signal})}#t({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#n(e);return}if(e.callback){const n=e.callbackId,r=this.callbackCapabilities[n];if(!r)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===Ig.DATA)r.resolve(e.data);else if(e.callback===Ig.ERROR)r.reject(Vl(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const n=this.sourceName,r=e.sourceName,o=this.comObj;Promise.try(t,e.data).then(function(d){o.postMessage({sourceName:n,targetName:r,callback:Ig.DATA,callbackId:e.callbackId,data:d})},function(d){o.postMessage({sourceName:n,targetName:r,callback:Ig.ERROR,callbackId:e.callbackId,reason:Vl(d)})});return}if(e.streamId){this.#i(e);return}t(e.data)}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const r=this.callbackId++,o=Promise.withResolvers();this.callbackCapabilities[r]=o;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},n)}catch(d){o.reject(d)}return o.promise}sendWithStream(e,t,n,r){const o=this.streamId++,d=this.sourceName,c=this.targetName,h=this.comObj;return new ReadableStream({start:f=>{const m=Promise.withResolvers();return this.streamControllers[o]={controller:f,startCall:m,pullCall:null,cancelCall:null,isClosed:!1},h.postMessage({sourceName:d,targetName:c,action:e,streamId:o,data:t,desiredSize:f.desiredSize},r),m.promise},pull:f=>{const m=Promise.withResolvers();return this.streamControllers[o].pullCall=m,h.postMessage({sourceName:d,targetName:c,stream:_a.PULL,streamId:o,desiredSize:f.desiredSize}),m.promise},cancel:f=>{sr(f instanceof Error,"cancel must have a valid reason");const m=Promise.withResolvers();return this.streamControllers[o].cancelCall=m,this.streamControllers[o].isClosed=!0,h.postMessage({sourceName:d,targetName:c,stream:_a.CANCEL,streamId:o,reason:Vl(f)}),m.promise}},n)}#i(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,o=this.comObj,d=this,c=this.actionHandler[e.action],h={enqueue(f,m=1,y){if(this.isCancelled)return;const A=this.desiredSize;this.desiredSize-=m,A>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),o.postMessage({sourceName:n,targetName:r,stream:_a.ENQUEUE,streamId:t,chunk:f},y)},close(){this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:r,stream:_a.CLOSE,streamId:t}),delete d.streamSinks[t])},error(f){sr(f instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:r,stream:_a.ERROR,streamId:t,reason:Vl(f)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};h.sinkCapability.resolve(),h.ready=h.sinkCapability.promise,this.streamSinks[t]=h,Promise.try(c,e.data,h).then(function(){o.postMessage({sourceName:n,targetName:r,stream:_a.START_COMPLETE,streamId:t,success:!0})},function(f){o.postMessage({sourceName:n,targetName:r,stream:_a.START_COMPLETE,streamId:t,reason:Vl(f)})})}#n(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,o=this.comObj,d=this.streamControllers[t],c=this.streamSinks[t];switch(e.stream){case _a.START_COMPLETE:e.success?d.startCall.resolve():d.startCall.reject(Vl(e.reason));break;case _a.PULL_COMPLETE:e.success?d.pullCall.resolve():d.pullCall.reject(Vl(e.reason));break;case _a.PULL:if(!c){o.postMessage({sourceName:n,targetName:r,stream:_a.PULL_COMPLETE,streamId:t,success:!0});break}c.desiredSize<=0&&e.desiredSize>0&&c.sinkCapability.resolve(),c.desiredSize=e.desiredSize,Promise.try(c.onPull||Ib).then(function(){o.postMessage({sourceName:n,targetName:r,stream:_a.PULL_COMPLETE,streamId:t,success:!0})},function(f){o.postMessage({sourceName:n,targetName:r,stream:_a.PULL_COMPLETE,streamId:t,reason:Vl(f)})});break;case _a.ENQUEUE:if(sr(d,"enqueue should have stream controller"),d.isClosed)break;d.controller.enqueue(e.chunk);break;case _a.CLOSE:if(sr(d,"close should have stream controller"),d.isClosed)break;d.isClosed=!0,d.controller.close(),this.#a(d,t);break;case _a.ERROR:sr(d,"error should have stream controller"),d.controller.error(Vl(e.reason)),this.#a(d,t);break;case _a.CANCEL_COMPLETE:e.success?d.cancelCall.resolve():d.cancelCall.reject(Vl(e.reason)),this.#a(d,t);break;case _a.CANCEL:if(!c)break;const h=Vl(e.reason);Promise.try(c.onCancel||Ib,h).then(function(){o.postMessage({sourceName:n,targetName:r,stream:_a.CANCEL_COMPLETE,streamId:t,success:!0})},function(f){o.postMessage({sourceName:n,targetName:r,stream:_a.CANCEL_COMPLETE,streamId:t,reason:Vl(f)})}),c.sinkCapability.reject(h),c.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#a(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.#e?.abort(),this.#e=null}}class uv{#e=!1;constructor({enableHWA:e=!1}){this.#e=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!this.#e})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){ss("Abstract method `_createCanvas` called.")}}class a3 extends uv{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}class hv{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){ss("Abstract method `_fetch` called.")}}class zb extends hv{async _fetch(e){const t=await Tp(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Cp(t)}}class fv{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,r,o){return"none"}destroy(e=!1){}}class o3 extends fv{#e;#t;#i;#n;#a;#s;#r=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#n=e,this.#a=t}get#o(){return this.#t||=new Map}get#c(){return this.#s||=new Map}get#l(){if(!this.#i){const e=this.#a.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const n=this.#a.createElementNS(su,"svg");n.setAttribute("width",0),n.setAttribute("height",0),this.#i=this.#a.createElementNS(su,"defs"),e.append(n),n.append(this.#i),this.#a.body.append(e)}return this.#i}#h(e){if(e.length===1){const h=e[0],f=new Array(256);for(let y=0;y<256;y++)f[y]=h[y]/255;const m=f.join(",");return[m,m,m]}const[t,n,r]=e,o=new Array(256),d=new Array(256),c=new Array(256);for(let h=0;h<256;h++)o[h]=t[h]/255,d[h]=n[h]/255,c[h]=r[h]/255;return[o.join(","),d.join(","),c.join(",")]}#u(e){if(this.#e===void 0){this.#e="";const t=this.#a.URL;t!==this.#a.baseURI&&(f0(t)?xi('#createUrl: ignore "data:"-URL for performance reasons.'):this.#e=tv(t,""))}return`url(${this.#e}#${e})`}addFilter(e){if(!e)return"none";let t=this.#o.get(e);if(t)return t;const[n,r,o]=this.#h(e),d=e.length===1?n:`${n}${r}${o}`;if(t=this.#o.get(d),t)return this.#o.set(e,t),t;const c=`g_${this.#n}_transfer_map_${this.#r++}`,h=this.#u(c);this.#o.set(e,h),this.#o.set(d,h);const f=this.#g(c);return this.#p(n,r,o,f),h}addHCMFilter(e,t){const n=`${e}-${t}`,r="base";let o=this.#c.get(r);if(o?.key===n||(o?(o.filter?.remove(),o.key=n,o.url="none",o.filter=null):(o={key:n,url:"none",filter:null},this.#c.set(r,o)),!e||!t))return o.url;const d=this.#b(e);e=vn.makeHexColor(...d);const c=this.#b(t);if(t=vn.makeHexColor(...c),this.#l.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return o.url;const h=new Array(256);for(let v=0;v<=255;v++){const N=v/255;h[v]=N<=.03928?N/12.92:((N+.055)/1.055)**2.4}const f=h.join(","),m=`g_${this.#n}_hcm_filter`,y=o.filter=this.#g(m);this.#p(f,f,f,y),this.#m(y);const A=(v,N)=>{const T=d[v]/255,_=c[v]/255,b=new Array(N+1);for(let H=0;H<=N;H++)b[H]=T+H/N*(_-T);return b.join(",")};return this.#p(A(0,5),A(1,5),A(2,5),y),o.url=this.#u(m),o.url}addAlphaFilter(e){let t=this.#o.get(e);if(t)return t;const[n]=this.#h([e]),r=`alpha_${n}`;if(t=this.#o.get(r),t)return this.#o.set(e,t),t;const o=`g_${this.#n}_alpha_map_${this.#r++}`,d=this.#u(o);this.#o.set(e,d),this.#o.set(r,d);const c=this.#g(o);return this.#y(n,c),d}addLuminosityFilter(e){let t=this.#o.get(e||"luminosity");if(t)return t;let n,r;if(e?([n]=this.#h([e]),r=`luminosity_${n}`):r="luminosity",t=this.#o.get(r),t)return this.#o.set(e,t),t;const o=`g_${this.#n}_luminosity_map_${this.#r++}`,d=this.#u(o);this.#o.set(e,d),this.#o.set(r,d);const c=this.#g(o);return this.#f(c),e&&this.#y(n,c),d}addHighlightHCMFilter(e,t,n,r,o){const d=`${t}-${n}-${r}-${o}`;let c=this.#c.get(e);if(c?.key===d||(c?(c.filter?.remove(),c.key=d,c.url="none",c.filter=null):(c={key:d,url:"none",filter:null},this.#c.set(e,c)),!t||!n))return c.url;const[h,f]=[t,n].map(this.#b.bind(this));let m=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),y=Math.round(.2126*f[0]+.7152*f[1]+.0722*f[2]),[A,v]=[r,o].map(this.#b.bind(this));y<m&&([m,y,A,v]=[y,m,v,A]),this.#l.style.color="";const N=(b,H,R)=>{const M=new Array(256),B=(y-m)/R,q=b/255,G=(H-b)/(255*R);let X=0;for(let O=0;O<=R;O++){const Y=Math.round(m+O*B),W=q+O*G;for(let I=X;I<=Y;I++)M[I]=W;X=Y+1}for(let O=X;O<256;O++)M[O]=M[X-1];return M.join(",")},T=`g_${this.#n}_hcm_${e}_filter`,_=c.filter=this.#g(T);return this.#m(_),this.#p(N(A[0],v[0],5),N(A[1],v[1],5),N(A[2],v[2],5),_),c.url=this.#u(T),c.url}destroy(e=!1){e&&this.#s?.size||(this.#i?.parentNode.parentNode.remove(),this.#i=null,this.#t?.clear(),this.#t=null,this.#s?.clear(),this.#s=null,this.#r=0)}#f(e){const t=this.#a.createElementNS(su,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#m(e){const t=this.#a.createElementNS(su,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#g(e){const t=this.#a.createElementNS(su,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#l.append(t),t}#d(e,t,n){const r=this.#a.createElementNS(su,t);r.setAttribute("type","discrete"),r.setAttribute("tableValues",n),e.append(r)}#p(e,t,n,r){const o=this.#a.createElementNS(su,"feComponentTransfer");r.append(o),this.#d(o,"feFuncR",e),this.#d(o,"feFuncG",t),this.#d(o,"feFuncB",n)}#y(e,t){const n=this.#a.createElementNS(su,"feComponentTransfer");t.append(n),this.#d(n,"feFuncA",e)}#b(e){return this.#l.style.color=e,_p(getComputedStyle(this.#l).getPropertyValue("color"))}}class pv{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){ss("Abstract method `_fetch` called.")}}class Bb extends pv{async _fetch(e){const t=await Tp(e,"arraybuffer");return new Uint8Array(t)}}class gv{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){ss("Abstract method `_fetch` called.")}}class Fb extends gv{async _fetch(e){const t=await Tp(e,"arraybuffer");return new Uint8Array(t)}}wl&&xi("Please use the `legacy` build in Node.js environments.");async function Ny(s){const t=await process.getBuiltinModule("fs").promises.readFile(s);return new Uint8Array(t)}class l3 extends fv{}class c3 extends uv{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class d3 extends hv{async _fetch(e){return Ny(e)}}class u3 extends pv{async _fetch(e){return Ny(e)}}class h3 extends gv{async _fetch(e){return Ny(e)}}const af="__forcedDependency",{floor:Ob,ceil:Ub}=Math;function zg(s,e,t,n,r,o){s[e*4+0]=Math.min(s[e*4+0],t),s[e*4+1]=Math.min(s[e*4+1],n),s[e*4+2]=Math.max(s[e*4+2],r),s[e*4+3]=Math.max(s[e*4+3],o)}const dy=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class f3{#e;#t;constructor(e,t){this.#e=e,this.#t=t}get length(){return this.#e.length}isEmpty(e){return this.#e[e]===dy}minX(e){return this.#t[e*4+0]/256}minY(e){return this.#t[e*4+1]/256}maxX(e){return(this.#t[e*4+2]+1)/256}maxY(e){return(this.#t[e*4+3]+1)/256}}const Bg=(s,e)=>{if(!s)return;let t=s.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},s.set(e,t)),t};class p3{#e={__proto__:null};#t={__proto__:null,transform:[],moveText:[],sameLineText:[],[af]:[]};#i=new Map;#n=[];#a=[];#s=[[1,0,0,1,0,0]];#r=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#c=-1;#l=new Set;#h=new Map;#u=new Map;#f;#m;#g;#d;#p;constructor(e,t,n=!1){this.#f=e.width,this.#m=e.height,this.#y(t),n&&(this.#p=new Map)}growOperationsCount(e){e>=this.#d.length&&this.#y(e,this.#d)}#y(e,t){const n=new ArrayBuffer(e*4);this.#g=new Uint8ClampedArray(n),this.#d=new Uint32Array(n),t&&t.length>0?(this.#d.set(t),this.#d.fill(dy,t.length)):this.#d.fill(dy)}save(e){return this.#e={__proto__:this.#e},this.#t={__proto__:this.#t,transform:{__proto__:this.#t.transform},moveText:{__proto__:this.#t.moveText},sameLineText:{__proto__:this.#t.sameLineText},[af]:{__proto__:this.#t[af]}},this.#r={__proto__:this.#r},this.#n.push(e),this}restore(e){const t=Object.getPrototypeOf(this.#e);if(t===null)return this;this.#e=t,this.#t=Object.getPrototypeOf(this.#t),this.#r=Object.getPrototypeOf(this.#r);const n=this.#n.pop();return n!==void 0&&(Bg(this.#p,e)?.dependencies.add(n),this.#d[e]=this.#d[n]),this}recordOpenMarker(e){return this.#n.push(e),this}getOpenMarker(){return this.#n.length===0?null:this.#n.at(-1)}recordCloseMarker(e){const t=this.#n.pop();return t!==void 0&&(Bg(this.#p,e)?.dependencies.add(t),this.#d[e]=this.#d[t]),this}beginMarkedContent(e){return this.#a.push(e),this}endMarkedContent(e){const t=this.#a.pop();return t!==void 0&&(Bg(this.#p,e)?.dependencies.add(t),this.#d[e]=this.#d[t]),this}pushBaseTransform(e){return this.#s.push(vn.multiplyByDOMMatrix(this.#s.at(-1),e.getTransform())),this}popBaseTransform(){return this.#s.length>1&&this.#s.pop(),this}recordSimpleData(e,t){return this.#e[e]=t,this}recordIncrementalData(e,t){return this.#t[e].push(t),this}resetIncrementalData(e,t){return this.#t[e].length=0,this}recordNamedData(e,t){return this.#i.set(e,t),this}recordSimpleDataFromNamed(e,t,n){this.#e[e]=this.#i.get(t)??n}recordFutureForcedDependency(e,t){return this.recordIncrementalData(af,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in this.#e&&this.recordFutureForcedDependency(t,this.#e[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of this.#l)this.recordFutureForcedDependency(af,e);return this}resetBBox(e){return this.#c!==e&&(this.#c=e,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0),this}recordClipBox(e,t,n,r,o,d){const c=vn.multiplyByDOMMatrix(this.#s.at(-1),t.getTransform()),h=[1/0,1/0,-1/0,-1/0];vn.axialAlignedBoundingBox([n,o,r,d],c,h);const f=vn.intersect(this.#r,h);return f?(this.#r[0]=f[0],this.#r[1]=f[1],this.#r[2]=f[2],this.#r[3]=f[3]):(this.#r[0]=this.#r[1]=1/0,this.#r[2]=this.#r[3]=-1/0),this}recordBBox(e,t,n,r,o,d){const c=this.#r;if(c[0]===1/0)return this;const h=vn.multiplyByDOMMatrix(this.#s.at(-1),t.getTransform());if(c[0]===-1/0)return vn.axialAlignedBoundingBox([n,o,r,d],h,this.#o),this;const f=[1/0,1/0,-1/0,-1/0];return vn.axialAlignedBoundingBox([n,o,r,d],h,f),this.#o[0]=Math.min(this.#o[0],Math.max(f[0],c[0])),this.#o[1]=Math.min(this.#o[1],Math.max(f[1],c[1])),this.#o[2]=Math.max(this.#o[2],Math.min(f[2],c[2])),this.#o[3]=Math.max(this.#o[3],Math.min(f[3],c[3])),this}recordCharacterBBox(e,t,n,r=1,o=0,d=0,c){const h=n.bbox;let f,m;if(h&&(f=h[2]!==h[0]&&h[3]!==h[1]&&this.#u.get(n),f!==!1&&(m=[0,0,0,0],vn.axialAlignedBoundingBox(h,n.fontMatrix,m),(r!==1||o!==0||d!==0)&&vn.scaleMinMax([r,0,0,-r,o,d],m),f)))return this.recordBBox(e,t,m[0],m[2],m[1],m[3]);if(!c)return this.recordFullPageBBox(e);const y=c();return h&&m&&f===void 0&&(f=m[0]<=o-y.actualBoundingBoxLeft&&m[2]>=o+y.actualBoundingBoxRight&&m[1]<=d-y.actualBoundingBoxAscent&&m[3]>=d+y.actualBoundingBoxDescent,this.#u.set(n,f),f)?this.recordBBox(e,t,m[0],m[2],m[1],m[3]):this.recordBBox(e,t,o-y.actualBoundingBoxLeft,o+y.actualBoundingBoxRight,d-y.actualBoundingBoxAscent,d+y.actualBoundingBoxDescent)}recordFullPageBBox(e){return this.#o[0]=Math.max(0,this.#r[0]),this.#o[1]=Math.max(0,this.#r[1]),this.#o[2]=Math.min(this.#f,this.#r[2]),this.#o[3]=Math.min(this.#m,this.#r[3]),this}getSimpleIndex(e){return this.#e[e]}recordDependencies(e,t){const n=this.#l,r=this.#e,o=this.#t;for(const d of t)d in this.#e?n.add(r[d]):d in o&&o[d].forEach(n.add,n);return this}recordNamedDependency(e,t){return this.#i.has(t)&&this.#l.add(this.#i.get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[af]),this.#p){const n=Bg(this.#p,e),{dependencies:r}=n;this.#l.forEach(r.add,r),this.#n.forEach(r.add,r),this.#a.forEach(r.add,r),r.delete(e),n.isRenderingOperation=!0}if(this.#c===e){const n=Ob(this.#o[0]*256/this.#f),r=Ob(this.#o[1]*256/this.#m),o=Ub(this.#o[2]*256/this.#f),d=Ub(this.#o[3]*256/this.#m);zg(this.#g,e,n,r,o,d);for(const c of this.#l)c!==e&&zg(this.#g,c,n,r,o,d);for(const c of this.#n)c!==e&&zg(this.#g,c,n,r,o,d);for(const c of this.#a)c!==e&&zg(this.#g,c,n,r,o,d);t||(this.#l.clear(),this.#c=-1)}return this}recordShowTextOperation(e,t=!1){const n=Array.from(this.#l);this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const r of n)this.recordIncrementalData("sameLineText",r);return this}bboxToClipBoxDropOperation(e,t=!1){return this.#c===e&&(this.#c=-1,this.#r[0]=Math.max(this.#r[0],this.#o[0]),this.#r[1]=Math.max(this.#r[1],this.#o[1]),this.#r[2]=Math.min(this.#r[2],this.#o[2]),this.#r[3]=Math.min(this.#r[3],this.#o[3]),t||this.#l.clear()),this}_takePendingDependencies(){const e=this.#l;return this.#l=new Set,e}_extractOperation(e){const t=this.#h.get(e);return this.#h.delete(e),t}_pushPendingDependencies(e){for(const t of e)this.#l.add(t)}take(){return this.#u.clear(),new f3(this.#d,this.#g)}takeDebugMetadata(){return this.#p}}class r0{#e;#t;#i;#n=0;#a=0;constructor(e,t,n){if(e instanceof r0&&e.#i===!!n)return e;this.#e=e,this.#t=t,this.#i=!!n}growOperationsCount(){throw new Error("Unreachable")}save(e){return this.#a++,this.#e.save(this.#t),this}restore(e){return this.#a>0&&(this.#e.restore(this.#t),this.#a--),this}recordOpenMarker(e){return this.#n++,this}getOpenMarker(){return this.#n>0?this.#t:this.#e.getOpenMarker()}recordCloseMarker(e){return this.#n--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return this.#e.pushBaseTransform(e),this}popBaseTransform(){return this.#e.popBaseTransform(),this}recordSimpleData(e,t){return this.#e.recordSimpleData(e,this.#t),this}recordIncrementalData(e,t){return this.#e.recordIncrementalData(e,this.#t),this}resetIncrementalData(e,t){return this.#e.resetIncrementalData(e,this.#t),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,n){return this.#e.recordSimpleDataFromNamed(e,t,this.#t),this}recordFutureForcedDependency(e,t){return this.#e.recordFutureForcedDependency(e,this.#t),this}inheritSimpleDataAsFutureForcedDependencies(e){return this.#e.inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#e.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return this.#i||this.#e.resetBBox(this.#t),this}recordClipBox(e,t,n,r,o,d){return this.#i||this.#e.recordClipBox(this.#t,t,n,r,o,d),this}recordBBox(e,t,n,r,o,d){return this.#i||this.#e.recordBBox(this.#t,t,n,r,o,d),this}recordCharacterBBox(e,t,n,r,o,d,c){return this.#i||this.#e.recordCharacterBBox(this.#t,t,n,r,o,d,c),this}recordFullPageBBox(e){return this.#i||this.#e.recordFullPageBBox(this.#t),this}getSimpleIndex(e){return this.#e.getSimpleIndex(e)}recordDependencies(e,t){return this.#e.recordDependencies(this.#t,t),this}recordNamedDependency(e,t){return this.#e.recordNamedDependency(this.#t,t),this}recordOperation(e){return this.#e.recordOperation(this.#t,!0),this}recordShowTextOperation(e){return this.#e.recordShowTextOperation(this.#t,!0),this}bboxToClipBoxDropOperation(e){return this.#i||this.#e.bboxToClipBoxDropOperation(this.#t,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const Oc={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},_o={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function uy(s,e){if(!e)return;const t=e[2]-e[0],n=e[3]-e[1],r=new Path2D;r.rect(e[0],e[1],t,n),s.clip(r)}class Py{isModifyingCurrentTransform(){return!1}getPattern(){ss("Abstract method `getPattern` called.")}}class g3 extends Py{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,r){let o;if(r===_o.STROKE||r===_o.FILL){const d=t.current.getClippedPathBoundingBox(r,Fs(e))||[0,0,0,0],c=Math.ceil(d[2]-d[0])||1,h=Math.ceil(d[3]-d[1])||1,f=t.cachedCanvases.getCanvas("pattern",c,h),m=f.context;m.clearRect(0,0,m.canvas.width,m.canvas.height),m.beginPath(),m.rect(0,0,m.canvas.width,m.canvas.height),m.translate(-d[0],-d[1]),n=vn.transform(n,[1,0,0,1,d[0],d[1]]),m.transform(...t.baseTransform),this.matrix&&m.transform(...this.matrix),uy(m,this._bbox),m.fillStyle=this._createGradient(m),m.fill(),o=e.createPattern(f.canvas,"no-repeat");const y=new DOMMatrix(n);o.setTransform(y)}else uy(e,this._bbox),o=this._createGradient(e);return o}}function Im(s,e,t,n,r,o,d,c){const h=e.coords,f=e.colors,m=s.data,y=s.width*4;let A;h[t+1]>h[n+1]&&(A=t,t=n,n=A,A=o,o=d,d=A),h[n+1]>h[r+1]&&(A=n,n=r,r=A,A=d,d=c,c=A),h[t+1]>h[n+1]&&(A=t,t=n,n=A,A=o,o=d,d=A);const v=(h[t]+e.offsetX)*e.scaleX,N=(h[t+1]+e.offsetY)*e.scaleY,T=(h[n]+e.offsetX)*e.scaleX,_=(h[n+1]+e.offsetY)*e.scaleY,b=(h[r]+e.offsetX)*e.scaleX,H=(h[r+1]+e.offsetY)*e.scaleY;if(N>=H)return;const R=f[o],M=f[o+1],B=f[o+2],q=f[d],G=f[d+1],X=f[d+2],O=f[c],Y=f[c+1],W=f[c+2],I=Math.round(N),J=Math.round(H);let Z,Ce,ie,le,se,Ae,ue,E;for(let L=I;L<=J;L++){if(L<_){const re=L<N?0:(N-L)/(N-_);Z=v-(v-T)*re,Ce=R-(R-q)*re,ie=M-(M-G)*re,le=B-(B-X)*re}else{let re;L>H?re=1:_===H?re=0:re=(_-L)/(_-H),Z=T-(T-b)*re,Ce=q-(q-O)*re,ie=G-(G-Y)*re,le=X-(X-W)*re}let Q;L<N?Q=0:L>H?Q=1:Q=(N-L)/(N-H),se=v-(v-b)*Q,Ae=R-(R-O)*Q,ue=M-(M-Y)*Q,E=B-(B-W)*Q;const ee=Math.round(Math.min(Z,se)),oe=Math.round(Math.max(Z,se));let xe=y*L+ee*4;for(let re=ee;re<=oe;re++)Q=(Z-re)/(Z-se),Q<0?Q=0:Q>1&&(Q=1),m[xe++]=Ce-(Ce-Ae)*Q|0,m[xe++]=ie-(ie-ue)*Q|0,m[xe++]=le-(le-E)*Q|0,m[xe++]=255}}function m3(s,e,t){const n=e.coords,r=e.colors;let o,d;switch(e.type){case iy.LATTICE:const c=e.verticesPerRow,h=Math.floor(n.length/c)-1,f=c-1;for(o=0;o<h;o++){let m=o*c;for(let y=0;y<f;y++,m++)Im(s,t,n[m],n[m+1],n[m+c],r[m],r[m+1],r[m+c]),Im(s,t,n[m+c+1],n[m+1],n[m+c],r[m+c+1],r[m+1],r[m+c])}break;case iy.TRIANGLES:for(o=0,d=n.length;o<d;o+=3)Im(s,t,n[o],n[o+1],n[o+2],r[o],r[o+1],r[o+2]);break;default:throw new Error("illegal figure")}}class y3 extends Py{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,n){const c=Math.floor(this._bounds[0]),h=Math.floor(this._bounds[1]),f=Math.ceil(this._bounds[2])-c,m=Math.ceil(this._bounds[3])-h,y=Math.min(Math.ceil(Math.abs(f*e[0]*1.1)),3e3),A=Math.min(Math.ceil(Math.abs(m*e[1]*1.1)),3e3),v=f/y,N=m/A,T={coords:this._coords,colors:this._colors,offsetX:-c,offsetY:-h,scaleX:1/v,scaleY:1/N},_=y+4,b=A+4,H=n.getCanvas("mesh",_,b),R=H.context,M=R.createImageData(y,A);if(t){const q=M.data;for(let G=0,X=q.length;G<X;G+=4)q[G]=t[0],q[G+1]=t[1],q[G+2]=t[2],q[G+3]=255}for(const q of this._figures)m3(M,q,T);return R.putImageData(M,2,2),{canvas:H.canvas,offsetX:c-2*v,offsetY:h-2*N,scaleX:v,scaleY:N}}isModifyingCurrentTransform(){return!0}getPattern(e,t,n,r){uy(e,this._bbox);const o=new Float32Array(2);if(r===_o.SHADING)vn.singularValueDecompose2dScale(Fs(e),o);else if(this.matrix){vn.singularValueDecompose2dScale(this.matrix,o);const[c,h]=o;vn.singularValueDecompose2dScale(t.baseTransform,o),o[0]*=c,o[1]*=h}else vn.singularValueDecompose2dScale(t.baseTransform,o);const d=this._createMeshCanvas(o,r===_o.SHADING?null:this._background,t.cachedCanvases);return r!==_o.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(d.offsetX,d.offsetY),e.scale(d.scaleX,d.scaleY),e.createPattern(d.canvas,"no-repeat")}}class x3 extends Py{getPattern(){return"hotpink"}}function b3(s){switch(s[0]){case"RadialAxial":return new g3(s);case"Mesh":return new y3(s);case"Dummy":return new x3}throw new Error(`Unknown IR type: ${s[0]}`)}const Hb={COLORED:1,UNCOLORED:2};class Ey{static MAX_PATTERN_SIZE=3e3;constructor(e,t,n,r){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=n,this.baseTransform=r}createPatternCanvas(e,t){const{bbox:n,operatorList:r,paintType:o,tilingType:d,color:c,canvasGraphicsFactory:h}=this;let{xstep:f,ystep:m}=this;f=Math.abs(f),m=Math.abs(m),h0("TilingType: "+d);const y=n[0],A=n[1],v=n[2],N=n[3],T=v-y,_=N-A,b=new Float32Array(2);vn.singularValueDecompose2dScale(this.matrix,b);const[H,R]=b;vn.singularValueDecompose2dScale(this.baseTransform,b);const M=H*b[0],B=R*b[1];let q=T,G=_,X=!1,O=!1;const Y=Math.ceil(f*M),W=Math.ceil(m*B),I=Math.ceil(T*M),J=Math.ceil(_*B);Y>=I?q=f:X=!0,W>=J?G=m:O=!0;const Z=this.getSizeAndScale(q,this.ctx.canvas.width,M),Ce=this.getSizeAndScale(G,this.ctx.canvas.height,B),ie=e.cachedCanvases.getCanvas("pattern",Z.size,Ce.size),le=ie.context,se=h.createCanvasGraphics(le,t);if(se.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(se,o,c),le.translate(-Z.scale*y,-Ce.scale*A),se.transform(0,Z.scale,0,0,Ce.scale,0,0),le.save(),se.dependencyTracker?.save(),this.clipBbox(se,y,A,v,N),se.baseTransform=Fs(se.ctx),se.executeOperatorList(r),se.endDrawing(),se.dependencyTracker?.restore(),le.restore(),X||O){const Ae=ie.canvas;X&&(q=f),O&&(G=m);const ue=this.getSizeAndScale(q,this.ctx.canvas.width,M),E=this.getSizeAndScale(G,this.ctx.canvas.height,B),L=ue.size,Q=E.size,ee=e.cachedCanvases.getCanvas("pattern-workaround",L,Q),oe=ee.context,xe=X?Math.floor(T/f):0,re=O?Math.floor(_/m):0;for(let Le=0;Le<=xe;Le++)for(let Ee=0;Ee<=re;Ee++)oe.drawImage(Ae,L*Le,Q*Ee,L,Q,0,0,L,Q);return{canvas:ee.canvas,scaleX:ue.scale,scaleY:E.scale,offsetX:y,offsetY:A}}return{canvas:ie.canvas,scaleX:Z.scale,scaleY:Ce.scale,offsetX:y,offsetY:A}}getSizeAndScale(e,t,n){const r=Math.max(Ey.MAX_PATTERN_SIZE,t);let o=Math.ceil(e*n);return o>=r?o=r:n=o/e,{scale:n,size:o}}clipBbox(e,t,n,r,o){const d=r-t,c=o-n;e.ctx.rect(t,n,d,c),vn.axialAlignedBoundingBox([t,n,r,o],Fs(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const r=e.ctx,o=e.current;switch(t){case Hb.COLORED:const{fillStyle:d,strokeStyle:c}=this.ctx;r.fillStyle=o.fillColor=d,r.strokeStyle=o.strokeColor=c;break;case Hb.UNCOLORED:r.fillStyle=r.strokeStyle=n,o.fillColor=o.strokeColor=n;break;default:throw new RC(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,n,r,o){let d=n;r!==_o.SHADING&&(d=vn.transform(d,t.baseTransform),this.matrix&&(d=vn.transform(d,this.matrix)));const c=this.createPatternCanvas(t,o);let h=new DOMMatrix(d);h=h.translate(c.offsetX,c.offsetY),h=h.scale(1/c.scaleX,1/c.scaleY);const f=e.createPattern(c.canvas,"repeat");return f.setTransform(h),f}}function v3({src:s,srcPos:e=0,dest:t,width:n,height:r,nonBlackColor:o=4294967295,inverseDecode:d=!1}){const c=jo.isLittleEndian?4278190080:255,[h,f]=d?[o,c]:[c,o],m=n>>3,y=n&7,A=s.length;t=new Uint32Array(t.buffer);let v=0;for(let N=0;N<r;N++){for(const _=e+m;e<_;e++){const b=e<A?s[e]:255;t[v++]=b&128?f:h,t[v++]=b&64?f:h,t[v++]=b&32?f:h,t[v++]=b&16?f:h,t[v++]=b&8?f:h,t[v++]=b&4?f:h,t[v++]=b&2?f:h,t[v++]=b&1?f:h}if(y===0)continue;const T=e<A?s[e++]:255;for(let _=0;_<y;_++)t[v++]=T&1<<7-_?f:h}return{srcPos:e,destPos:v}}const Vb=16,qb=100,w3=15,Wb=10,ql=16,zm=new DOMMatrix,vc=new Float32Array(2),pf=new Float32Array([1/0,1/0,-1/0,-1/0]);function S3(s,e){if(s._removeMirroring)throw new Error("Context is already forwarding operations.");s.__originalSave=s.save,s.__originalRestore=s.restore,s.__originalRotate=s.rotate,s.__originalScale=s.scale,s.__originalTranslate=s.translate,s.__originalTransform=s.transform,s.__originalSetTransform=s.setTransform,s.__originalResetTransform=s.resetTransform,s.__originalClip=s.clip,s.__originalMoveTo=s.moveTo,s.__originalLineTo=s.lineTo,s.__originalBezierCurveTo=s.bezierCurveTo,s.__originalRect=s.rect,s.__originalClosePath=s.closePath,s.__originalBeginPath=s.beginPath,s._removeMirroring=()=>{s.save=s.__originalSave,s.restore=s.__originalRestore,s.rotate=s.__originalRotate,s.scale=s.__originalScale,s.translate=s.__originalTranslate,s.transform=s.__originalTransform,s.setTransform=s.__originalSetTransform,s.resetTransform=s.__originalResetTransform,s.clip=s.__originalClip,s.moveTo=s.__originalMoveTo,s.lineTo=s.__originalLineTo,s.bezierCurveTo=s.__originalBezierCurveTo,s.rect=s.__originalRect,s.closePath=s.__originalClosePath,s.beginPath=s.__originalBeginPath,delete s._removeMirroring},s.save=function(){e.save(),this.__originalSave()},s.restore=function(){e.restore(),this.__originalRestore()},s.translate=function(t,n){e.translate(t,n),this.__originalTranslate(t,n)},s.scale=function(t,n){e.scale(t,n),this.__originalScale(t,n)},s.transform=function(t,n,r,o,d,c){e.transform(t,n,r,o,d,c),this.__originalTransform(t,n,r,o,d,c)},s.setTransform=function(t,n,r,o,d,c){e.setTransform(t,n,r,o,d,c),this.__originalSetTransform(t,n,r,o,d,c)},s.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},s.rotate=function(t){e.rotate(t),this.__originalRotate(t)},s.clip=function(t){e.clip(t),this.__originalClip(t)},s.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},s.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},s.bezierCurveTo=function(t,n,r,o,d,c){e.bezierCurveTo(t,n,r,o,d,c),this.__originalBezierCurveTo(t,n,r,o,d,c)},s.rect=function(t,n,r,o){e.rect(t,n,r,o),this.__originalRect(t,n,r,o)},s.closePath=function(){e.closePath(),this.__originalClosePath()},s.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class A3{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let r;return this.cache[e]!==void 0?(r=this.cache[e],this.canvasFactory.reset(r,t,n)):(r=this.canvasFactory.create(t,n),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Fg(s,e,t,n,r,o,d,c,h,f){const[m,y,A,v,N,T]=Fs(s);if(y===0&&A===0){const H=d*m+N,R=Math.round(H),M=c*v+T,B=Math.round(M),q=(d+h)*m+N,G=Math.abs(Math.round(q)-R)||1,X=(c+f)*v+T,O=Math.abs(Math.round(X)-B)||1;return s.setTransform(Math.sign(m),0,0,Math.sign(v),R,B),s.drawImage(e,t,n,r,o,0,0,G,O),s.setTransform(m,y,A,v,N,T),[G,O]}if(m===0&&v===0){const H=c*A+N,R=Math.round(H),M=d*y+T,B=Math.round(M),q=(c+f)*A+N,G=Math.abs(Math.round(q)-R)||1,X=(d+h)*y+T,O=Math.abs(Math.round(X)-B)||1;return s.setTransform(0,Math.sign(y),Math.sign(A),0,R,B),s.drawImage(e,t,n,r,o,0,0,O,G),s.setTransform(m,y,A,v,N,T),[O,G]}s.drawImage(e,t,n,r,o,d,c,h,f);const _=Math.hypot(m,y),b=Math.hypot(A,v);return[_*h,b*f]}class $b{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=ny;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=To.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(e,t,n){n?.(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=pf.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=_o.FILL,t=null){const n=this.minMax.slice();if(e===_o.STROKE){t||ss("Stroke bounding box must include transform."),vn.singularValueDecompose2dScale(t,vc);const r=vc[0]*this.lineWidth/2,o=vc[1]*this.lineWidth/2;n[0]-=r,n[1]-=o,n[2]+=r,n[3]+=o}return n}updateClipFromPath(){const e=vn.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(pf,0)}getClippedPathBoundingBox(e=_o.FILL,t=null){return vn.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function Gb(s,e){if(e instanceof ImageData){s.putImageData(e,0,0);return}const t=e.height,n=e.width,r=t%ql,o=(t-r)/ql,d=r===0?o:o+1,c=s.createImageData(n,ql);let h=0,f;const m=e.data,y=c.data;let A,v,N,T;if(e.kind===Xg.GRAYSCALE_1BPP){const _=m.byteLength,b=new Uint32Array(y.buffer,0,y.byteLength>>2),H=b.length,R=n+7>>3,M=4294967295,B=jo.isLittleEndian?4278190080:255;for(A=0;A<d;A++){for(N=A<o?ql:r,f=0,v=0;v<N;v++){const q=_-h;let G=0;const X=q>R?n:q*8-7,O=X&-8;let Y=0,W=0;for(;G<O;G+=8)W=m[h++],b[f++]=W&128?M:B,b[f++]=W&64?M:B,b[f++]=W&32?M:B,b[f++]=W&16?M:B,b[f++]=W&8?M:B,b[f++]=W&4?M:B,b[f++]=W&2?M:B,b[f++]=W&1?M:B;for(;G<X;G++)Y===0&&(W=m[h++],Y=128),b[f++]=W&Y?M:B,Y>>=1}for(;f<H;)b[f++]=0;s.putImageData(c,0,A*ql)}}else if(e.kind===Xg.RGBA_32BPP){for(v=0,T=n*ql*4,A=0;A<o;A++)y.set(m.subarray(h,h+T)),h+=T,s.putImageData(c,0,v),v+=ql;A<d&&(T=n*r*4,y.set(m.subarray(h,h+T)),s.putImageData(c,0,v))}else if(e.kind===Xg.RGB_24BPP)for(N=ql,T=n*N,A=0;A<d;A++){for(A>=o&&(N=r,T=n*N),f=0,v=T;v--;)y[f++]=m[h++],y[f++]=m[h++],y[f++]=m[h++],y[f++]=255;s.putImageData(c,0,A*ql)}else throw new Error(`bad image kind: ${e.kind}`)}function Yb(s,e){if(e.bitmap){s.drawImage(e.bitmap,0,0);return}const t=e.height,n=e.width,r=t%ql,o=(t-r)/ql,d=r===0?o:o+1,c=s.createImageData(n,ql);let h=0;const f=e.data,m=c.data;for(let y=0;y<d;y++){const A=y<o?ql:r;({srcPos:h}=v3({src:f,srcPos:h,dest:m,width:n,height:A,nonBlackColor:0})),s.putImageData(c,0,y*ql)}}function rp(s,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of t)s[n]!==void 0&&(e[n]=s[n]);s.setLineDash!==void 0&&(e.setLineDash(s.getLineDash()),e.lineDashOffset=s.lineDashOffset)}function Og(s){s.strokeStyle=s.fillStyle="#000000",s.fillRule="nonzero",s.globalAlpha=1,s.lineWidth=1,s.lineCap="butt",s.lineJoin="miter",s.miterLimit=10,s.globalCompositeOperation="source-over",s.font="10px sans-serif",s.setLineDash!==void 0&&(s.setLineDash([]),s.lineDashOffset=0);const{filter:e}=s;e!=="none"&&e!==""&&(s.filter="none")}function Xb(s,e){if(e)return!0;vn.singularValueDecompose2dScale(s,vc);const t=Math.fround(Id.pixelRatio*Tf.PDF_TO_CSS_UNITS);return vc[0]<=t&&vc[1]<=t}const C3=["butt","round","square"],T3=["miter","round","bevel"],k3={},Kb={};class Sf{constructor(e,t,n,r,o,{optionalContentConfig:d,markedContentStack:c=null},h,f,m){this.ctx=e,this.current=new $b(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=r,this.filterFactory=o,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=c||[],this.optionalContentConfig=d,this.cachedCanvases=new A3(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=h,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=f,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=m??null}getObject(e,t,n=null){return typeof t=="string"?(this.dependencyTracker?.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):n}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:r=null}){const o=this.ctx.canvas.width,d=this.ctx.canvas.height,c=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,o,d),this.ctx.fillStyle=c,n){const h=this.cachedCanvases.getCanvas("transparent",o,d);this.compositeCtx=this.ctx,this.transparentCanvas=h.canvas,this.ctx=h.context,this.ctx.save(),this.ctx.transform(...Fs(this.compositeCtx))}this.ctx.save(),Og(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Fs(this.ctx)}executeOperatorList(e,t,n,r,o){const d=e.argsArray,c=e.fnArray;let h=t||0;const f=d.length;if(f===h)return h;const m=f-h>Wb&&typeof n=="function",y=m?Date.now()+w3:0;let A=0;const v=this.commonObjs,N=this.objs;let T,_;for(;;){if(r!==void 0&&h===r.nextBreakPoint)return r.breakIt(h,n),h;if(!o||o(h))if(T=c[h],_=d[h]??null,T!==xp.dependency)_===null?this[T](h):this[T](h,..._);else for(const b of _){this.dependencyTracker?.recordNamedData(b,h);const H=b.startsWith("g_")?v:N;if(!H.has(b))return H.get(b,n),h}if(h++,h===f)return h;if(m&&++A>Wb){if(Date.now()>y)return n(),h;A=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const n=e.width??e.displayWidth,r=e.height??e.displayHeight;let o=Math.max(Math.hypot(t[0],t[1]),1),d=Math.max(Math.hypot(t[2],t[3]),1),c=n,h=r,f="prescale1",m,y;for(;o>2&&c>1||d>2&&h>1;){let A=c,v=h;o>2&&c>1&&(A=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c/2),o/=c/A),d>2&&h>1&&(v=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h)/2,d/=h/v),m=this.cachedCanvases.getCanvas(f,A,v),y=m.context,y.clearRect(0,0,A,v),y.drawImage(e,0,0,c,h,0,0,A,v),e=m.canvas,c=A,h=v,f=f==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:c,paintHeight:h}}_createMaskCanvas(e,t){const n=this.ctx,{width:r,height:o}=t,d=this.current.fillColor,c=this.current.patternFill,h=Fs(n);let f,m,y,A;if((t.bitmap||t.data)&&t.count>1){const Y=t.bitmap||t.data.buffer;m=JSON.stringify(c?h:[h.slice(0,4),d]),f=this._cachedBitmapsMap.get(Y),f||(f=new Map,this._cachedBitmapsMap.set(Y,f));const W=f.get(m);if(W&&!c){const I=Math.round(Math.min(h[0],h[2])+h[4]),J=Math.round(Math.min(h[1],h[3])+h[5]);return this.dependencyTracker?.recordDependencies(e,Oc.transformAndFill),{canvas:W,offsetX:I,offsetY:J}}y=W}y||(A=this.cachedCanvases.getCanvas("maskCanvas",r,o),Yb(A.context,t));let v=vn.transform(h,[1/r,0,0,-1/o,0,0]);v=vn.transform(v,[1,0,0,1,0,-o]);const N=pf.slice();vn.axialAlignedBoundingBox([0,0,r,o],v,N);const[T,_,b,H]=N,R=Math.round(b-T)||1,M=Math.round(H-_)||1,B=this.cachedCanvases.getCanvas("fillCanvas",R,M),q=B.context,G=T,X=_;q.translate(-G,-X),q.transform(...v),y||(y=this._scaleImage(A.canvas,Pd(q)),y=y.img,f&&c&&f.set(m,y)),q.imageSmoothingEnabled=Xb(Fs(q),t.interpolate),Fg(q,y,0,0,y.width,y.height,0,0,r,o),q.globalCompositeOperation="source-in";const O=vn.transform(Pd(q),[1,0,0,1,-G,-X]);return q.fillStyle=c?d.getPattern(n,this,O,_o.FILL,e):d,q.fillRect(0,0,r,o),f&&!c&&(this.cachedCanvases.delete("fillCanvas"),f.set(m,B.canvas)),this.dependencyTracker?.recordDependencies(e,Oc.transformAndFill),{canvas:B.canvas,offsetX:Math.round(G),offsetY:Math.round(X)}}setLineWidth(e,t){this.dependencyTracker?.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){this.dependencyTracker?.recordSimpleData("lineCap",e),this.ctx.lineCap=C3[t]}setLineJoin(e,t){this.dependencyTracker?.recordSimpleData("lineJoin",e),this.ctx.lineJoin=T3[t]}setMiterLimit(e,t){this.dependencyTracker?.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,n){this.dependencyTracker?.recordSimpleData("dash",e);const r=this.ctx;r.setLineDash!==void 0&&(r.setLineDash(t),r.lineDashOffset=n)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){for(const[n,r]of t)switch(n){case"LW":this.setLineWidth(e,r);break;case"LC":this.setLineCap(e,r);break;case"LJ":this.setLineJoin(e,r);break;case"ML":this.setMiterLimit(e,r);break;case"D":this.setDash(e,r[0],r[1]);break;case"RI":this.setRenderingIntent(e,r);break;case"FL":this.setFlatness(e,r);break;case"Font":this.setFont(e,r[0],r[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=r;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=r;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=r;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",e),this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(r);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,n=this.ctx.canvas.height,r="smaskGroupAt"+this.groupLevel,o=this.cachedCanvases.getCanvas(r,t,n);this.suspendedCtx=this.ctx;const d=this.ctx=o.context;d.setTransform(this.suspendedCtx.getTransform()),rp(this.suspendedCtx,d),S3(d,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),rp(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,r){const o=r[0],d=r[1],c=r[2]-o,h=r[3]-d;c===0||h===0||(this.genericComposeSMask(t.context,n,c,h,t.subtype,t.backdrop,t.transferMap,o,d,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,r,o,d,c,h,f,m,y){let A=e.canvas,v=h-m,N=f-y;if(d)if(v<0||N<0||v+n>A.width||N+r>A.height){const _=this.cachedCanvases.getCanvas("maskExtension",n,r),b=_.context;b.drawImage(A,-v,-N),b.globalCompositeOperation="destination-atop",b.fillStyle=d,b.fillRect(0,0,n,r),b.globalCompositeOperation="source-over",A=_.canvas,v=N=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const _=new Path2D;_.rect(v,N,n,r),e.clip(_),e.globalCompositeOperation="destination-atop",e.fillStyle=d,e.fillRect(v,N,n,r),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),o==="Alpha"&&c?t.filter=this.filterFactory.addAlphaFilter(c):o==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(c));const T=new Path2D;T.rect(h,f,n,r),t.clip(T),t.globalCompositeOperation="destination-in",t.drawImage(A,v,N,n,r,h,f,n,r),t.restore()}save(e){this.inSMaskMode&&rp(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),this.dependencyTracker?.save(e)}restore(e){if(this.dependencyTracker?.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&rp(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,n,r,o,d,c){this.dependencyTracker?.recordIncrementalData("transform",e),this.ctx.transform(t,n,r,o,d,c),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n,r){let[o]=n;if(!r){o||=n[0]=new Path2D,this[t](e,o);return}if(this.dependencyTracker!==null){const d=t===xp.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,r[0]-d,r[2]+d,r[1]-d,r[3]+d).recordDependencies(e,["transform"])}o instanceof Path2D||(o=n[0]=ov(o)),vn.axialAlignedBoundingBox(r,Fs(this.ctx),this.current.minMax),this[t](e,o),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,n=!0){const r=this.ctx,o=this.current.strokeColor;if(r.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof o=="object"&&o?.getPattern){const d=o.isModifyingCurrentTransform()?r.getTransform():null;if(r.save(),r.strokeStyle=o.getPattern(r,this,Pd(r),_o.STROKE,e),d){const c=new Path2D;c.addPath(t,r.getTransform().invertSelf().multiplySelf(d)),t=c}this.rescaleAndStroke(t,!1),r.restore()}else this.rescaleAndStroke(t,!0);this.dependencyTracker?.recordDependencies(e,Oc.stroke),n&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(_o.STROKE,Fs(this.ctx))),r.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,n=!0){const r=this.ctx,o=this.current.fillColor,d=this.current.patternFill;let c=!1;if(d){const f=o.isModifyingCurrentTransform()?r.getTransform():null;if(this.dependencyTracker?.save(e),r.save(),r.fillStyle=o.getPattern(r,this,Pd(r),_o.FILL,e),f){const m=new Path2D;m.addPath(t,r.getTransform().invertSelf().multiplySelf(f)),t=m}c=!0}const h=this.current.getClippedPathBoundingBox();this.contentVisible&&h!==null&&(this.pendingEOFill?(r.fill(t,"evenodd"),this.pendingEOFill=!1):r.fill(t)),this.dependencyTracker?.recordDependencies(e,Oc.fill),c&&(r.restore(),this.dependencyTracker?.restore(e)),n&&this.consumePath(e,t,h)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){this.ctx.fill(t),this.dependencyTracker?.recordDependencies(e,Oc.rawFillPath).recordOperation(e)}clip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=k3}eoClip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=Kb}beginText(e){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:r}=this;t!==void 0&&r.recordFutureForcedDependency("textClip",r.getOpenMarker()).recordFutureForcedDependency("textClip",e),r.recordCloseMarker(e)}if(t!==void 0){const r=new Path2D,o=n.getTransform().invertSelf();for(const{transform:d,x:c,y:h,fontSize:f,path:m}of t)m&&r.addPath(m,new DOMMatrix(d).preMultiplySelf(o).translate(c,h).scale(f,-f));n.clip(r)}delete this.pendingTextPaths}setCharSpacing(e,t){this.dependencyTracker?.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){this.dependencyTracker?.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){this.dependencyTracker?.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){this.dependencyTracker?.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,n){this.dependencyTracker?.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const r=this.commonObjs.get(t),o=this.current;if(!r)throw new Error(`Can't find font for ${t}`);if(o.fontMatrix=r.fontMatrix||ny,(o.fontMatrix[0]===0||o.fontMatrix[3]===0)&&xi("Invalid font matrix for font "+t),n<0?(n=-n,o.fontDirection=-1):o.fontDirection=1,this.current.font=r,this.current.fontSize=n,r.isType3Font)return;const d=r.loadedName||"sans-serif",c=r.systemFontInfo?.css||`"${d}", ${r.fallbackName}`;let h="normal";r.black?h="900":r.bold&&(h="bold");const f=r.italic?"italic":"normal";let m=n;n<Vb?m=Vb:n>qb&&(m=qb),this.current.fontSizeScale=n/m,this.ctx.font=`${f} ${h} ${m}px ${c}`}setTextRenderingMode(e,t){this.dependencyTracker?.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){this.dependencyTracker?.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,n){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=n}setLeadingMoveText(e,t,n){this.setLeading(e,-n),this.moveText(e,t,n)}setTextMatrix(e,t){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",e);const{current:n}=this;n.textMatrix=t,n.textMatrixScale=Math.hypot(t[0],t[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(e){this.moveText(e,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}#i(e,t,n){const r=new Path2D;return r.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),r}paintChar(e,t,n,r,o,d){const c=this.ctx,h=this.current,f=h.font,m=h.textRenderingMode,y=h.fontSize/h.fontSizeScale,A=m&To.FILL_STROKE_MASK,v=!!(m&To.ADD_TO_PATH_FLAG),N=h.patternFill&&!f.missingFile,T=h.patternStroke&&!f.missingFile;let _;if((f.disableFontFace||v||N||T)&&!f.missingFile&&(_=f.getPathGenerator(this.commonObjs,t)),_&&(f.disableFontFace||N||T)){c.save(),c.translate(n,r),c.scale(y,-y),this.dependencyTracker?.recordCharacterBBox(e,c,f);let b;if(A===To.FILL||A===To.FILL_STROKE)if(o){b=c.getTransform(),c.setTransform(...o);const H=this.#i(_,b,o);c.fill(H)}else c.fill(_);if(A===To.STROKE||A===To.FILL_STROKE)if(d){b||=c.getTransform(),c.setTransform(...d);const{a:H,b:R,c:M,d:B}=b,q=vn.inverseTransform(d),G=vn.transform([H,R,M,B,0,0],q);vn.singularValueDecompose2dScale(G,vc),c.lineWidth*=Math.max(vc[0],vc[1])/y,c.stroke(this.#i(_,b,d))}else c.lineWidth/=y,c.stroke(_);c.restore()}else(A===To.FILL||A===To.FILL_STROKE)&&(c.fillText(t,n,r),this.dependencyTracker?.recordCharacterBBox(e,c,f,y,n,r,()=>c.measureText(t))),(A===To.STROKE||A===To.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(e,c,f,y,n,r,()=>c.measureText(t)).recordDependencies(e,Oc.stroke),c.strokeText(t,n,r));v&&((this.pendingTextPaths||=[]).push({transform:Fs(c),x:n,y:r,fontSize:y,path:_}),this.dependencyTracker?.recordCharacterBBox(e,c,f,y,n,r))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let r=3;r<t.length;r+=4)if(t[r]>0&&t[r]<255){n=!0;break}return bi(this,"isFontSubpixelAAEnabled",n)}showText(e,t){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,Oc.showText).resetBBox(e),this.current.textRenderingMode&To.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,r=n.font;if(r.isType3Font){this.showType3Text(e,t),this.dependencyTracker?.recordShowTextOperation(e);return}const o=n.fontSize;if(o===0){this.dependencyTracker?.recordOperation(e);return}const d=this.ctx,c=n.fontSizeScale,h=n.charSpacing,f=n.wordSpacing,m=n.fontDirection,y=n.textHScale*m,A=t.length,v=r.vertical,N=v?1:-1,T=r.defaultVMetrics,_=o*n.fontMatrix[0],b=n.textRenderingMode===To.FILL&&!r.disableFontFace&&!n.patternFill;d.save(),n.textMatrix&&d.transform(...n.textMatrix),d.translate(n.x,n.y+n.textRise),m>0?d.scale(y,-1):d.scale(y,1);let H,R;if(n.patternFill){d.save();const X=n.fillColor.getPattern(d,this,Pd(d),_o.FILL,e);H=Fs(d),d.restore(),d.fillStyle=X}if(n.patternStroke){d.save();const X=n.strokeColor.getPattern(d,this,Pd(d),_o.STROKE,e);R=Fs(d),d.restore(),d.strokeStyle=X}let M=n.lineWidth;const B=n.textMatrixScale;if(B===0||M===0){const X=n.textRenderingMode&To.FILL_STROKE_MASK;(X===To.STROKE||X===To.FILL_STROKE)&&(M=this.getSinglePixelWidth())}else M/=B;if(c!==1&&(d.scale(c,c),M/=c),d.lineWidth=M,r.isInvalidPDFjsFont){const X=[];let O=0;for(const W of t)X.push(W.unicode),O+=W.width;const Y=X.join("");if(d.fillText(Y,0,0),this.dependencyTracker!==null){const W=d.measureText(Y);this.dependencyTracker.recordBBox(e,this.ctx,-W.actualBoundingBoxLeft,W.actualBoundingBoxRight,-W.actualBoundingBoxAscent,W.actualBoundingBoxDescent).recordShowTextOperation(e)}n.x+=O*_*y,d.restore(),this.compose();return}let q=0,G;for(G=0;G<A;++G){const X=t[G];if(typeof X=="number"){q+=N*X*o/1e3;continue}let O=!1;const Y=(X.isSpace?f:0)+h,W=X.fontChar,I=X.accent;let J,Z,Ce=X.width;if(v){const se=X.vmetric||T,Ae=-(X.vmetric?se[1]:Ce*.5)*_,ue=se[2]*_;Ce=se?-se[0]:Ce,J=Ae/c,Z=(q+ue)/c}else J=q/c,Z=0;let ie;if(r.remeasure&&Ce>0){ie=d.measureText(W);const se=ie.width*1e3/o*c;if(Ce<se&&this.isFontSubpixelAAEnabled){const Ae=Ce/se;O=!0,d.save(),d.scale(Ae,1),J/=Ae}else Ce!==se&&(J+=(Ce-se)/2e3*o/c)}if(this.contentVisible&&(X.isInFont||r.missingFile)){if(b&&!I)d.fillText(W,J,Z),this.dependencyTracker?.recordCharacterBBox(e,d,ie?{bbox:null}:r,o/c,J,Z,()=>ie??d.measureText(W));else if(this.paintChar(e,W,J,Z,H,R),I){const se=J+o*I.offset.x/c,Ae=Z-o*I.offset.y/c;this.paintChar(e,I.fontChar,se,Ae,H,R)}}const le=v?Ce*_-Y*m:Ce*_+Y*m;q+=le,O&&d.restore()}v?n.y-=q:n.x+=q*y,d.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(e)}showType3Text(e,t){const n=this.ctx,r=this.current,o=r.font,d=r.fontSize,c=r.fontDirection,h=o.vertical?1:-1,f=r.charSpacing,m=r.wordSpacing,y=r.textHScale*c,A=r.fontMatrix||ny,v=t.length,N=r.textRenderingMode===To.INVISIBLE;let T,_,b,H;if(N||d===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),r.textMatrix&&n.transform(...r.textMatrix),n.translate(r.x,r.y+r.textRise),n.scale(y,c);const R=this.dependencyTracker;for(this.dependencyTracker=R?new r0(R,e):null,T=0;T<v;++T){if(_=t[T],typeof _=="number"){H=h*_*d/1e3,this.ctx.translate(H,0),r.x+=H*y;continue}const M=(_.isSpace?m:0)+f,B=o.charProcOperatorList[_.operatorListId];B?this.contentVisible&&(this.save(),n.scale(d,d),n.transform(...A),this.executeOperatorList(B),this.restore()):xi(`Type3 character "${_.operatorListId}" is not available.`);const q=[_.width,0];vn.applyTransform(q,A),b=q[0]*d+M,n.translate(b,0),r.x+=b*y}n.restore(),R&&(this.dependencyTracker=R)}setCharWidth(e,t,n){}setCharWidthAndBounds(e,t,n,r,o,d,c){const h=new Path2D;h.rect(r,o,d-r,c-o),this.ctx.clip(h),this.dependencyTracker?.recordBBox(e,this.ctx,r,d,o,c).recordClipBox(e,this.ctx,r,d,o,c),this.endPath(e)}getColorN_Pattern(e,t){let n;if(t[0]==="TilingPattern"){const r=this.baseTransform||Fs(this.ctx),o={createCanvasGraphics:(d,c)=>new Sf(d,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new r0(this.dependencyTracker,c,!0):null)};n=new Ey(t,this.ctx,o,r)}else n=this._getPattern(e,t[1],t[2]);return n}setStrokeColorN(e,...t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,n=null){let r;return this.cachedPatterns.has(t)?r=this.cachedPatterns.get(t):(r=b3(this.getObject(e,t)),this.cachedPatterns.set(t,r)),n&&(r.matrix=n),r}shadingFill(e,t){if(!this.contentVisible)return;const n=this.ctx;this.save(e);const r=this._getPattern(e,t);n.fillStyle=r.getPattern(n,this,Pd(n),_o.SHADING,e);const o=Pd(n);if(o){const{width:d,height:c}=n.canvas,h=pf.slice();vn.axialAlignedBoundingBox([0,0,d,c],o,h);const[f,m,y,A]=h;this.ctx.fillRect(f,m,y-f,A-m)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,Oc.transform).recordDependencies(e,Oc.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){ss("Should not call beginInlineImage")}beginImageData(){ss("Should not call beginImageData")}paintFormXObjectBegin(e,t,n){if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=Fs(this.ctx),n)){vn.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[r,o,d,c]=n,h=new Path2D;h.rect(r,o,d-r,c-o),this.ctx.clip(h),this.dependencyTracker?.recordClipBox(e,this.ctx,r,d,o,c),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;t.isolated||h0("TODO: Support non-isolated groups."),t.knockout&&xi("Knockout groups not supported.");const r=Fs(n);if(t.matrix&&n.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let o=pf.slice();vn.axialAlignedBoundingBox(t.bbox,Fs(n),o);const d=[0,0,n.canvas.width,n.canvas.height];o=vn.intersect(o,d)||[0,0,0,0];const c=Math.floor(o[0]),h=Math.floor(o[1]),f=Math.max(Math.ceil(o[2])-c,1),m=Math.max(Math.ceil(o[3])-h,1);this.current.startNewPathAndClipBox([0,0,f,m]);let y="groupAt"+this.groupLevel;t.smask&&(y+="_smask_"+this.smaskCounter++%2);const A=this.cachedCanvases.getCanvas(y,f,m),v=A.context;v.translate(-c,-h),v.transform(...r);let N=new Path2D;const[T,_,b,H]=t.bbox;if(N.rect(T,_,b-T,H-_),t.matrix){const R=new Path2D;R.addPath(N,new DOMMatrix(t.matrix)),N=R}v.clip(N),t.smask&&this.smaskStack.push({canvas:A.canvas,context:v,offsetX:c,offsetY:h,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(c,h),n.save()),rp(n,v),this.ctx=v,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(e,t){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,r=this.groupStack.pop();if(this.ctx=r,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const o=Fs(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...o);const d=pf.slice();vn.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],o,d),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(d)}}beginAnnotation(e,t,n,r,o,d){if(this.#e(),Og(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const c=n[2]-n[0],h=n[3]-n[1];if(d&&this.annotationCanvasMap){r=r.slice(),r[4]-=n[0],r[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=c,n[3]=h,vn.singularValueDecompose2dScale(Fs(this.ctx),vc);const{viewportScale:f}=this,m=Math.ceil(c*this.outputScaleX*f),y=Math.ceil(h*this.outputScaleY*f);this.annotationCanvas=this.canvasFactory.create(m,y);const{canvas:A,context:v}=this.annotationCanvas;this.annotationCanvasMap.set(t,A),this.annotationCanvas.savedCtx=this.ctx,this.ctx=v,this.ctx.save(),this.ctx.setTransform(vc[0],0,0,-vc[1],0,h*vc[1]),Og(this.ctx)}else{Og(this.ctx),this.endPath(e);const f=new Path2D;f.rect(n[0],n[1],c,h),this.ctx.clip(f)}}this.current=new $b(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...r),this.transform(e,...o)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){if(!this.contentVisible)return;const n=t.count;t=this.getObject(e,t.data,t),t.count=n;const r=this.ctx,o=this._createMaskCanvas(e,t),d=o.canvas;r.save(),r.setTransform(1,0,0,1,0,0),r.drawImage(d,o.offsetX,o.offsetY),this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,o.offsetX,o.offsetX+d.width,o.offsetY,o.offsetY+d.height).recordOperation(e),r.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n,r=0,o=0,d,c){if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const h=this.ctx;h.save();const f=Fs(h);h.transform(n,r,o,d,0,0);const m=this._createMaskCanvas(e,t);h.setTransform(1,0,0,1,m.offsetX-f[4],m.offsetY-f[5]),this.dependencyTracker?.resetBBox(e);for(let y=0,A=c.length;y<A;y+=2){const v=vn.transform(f,[n,r,o,d,c[y],c[y+1]]);h.drawImage(m.canvas,v[4],v[5]),this.dependencyTracker?.recordBBox(e,this.ctx,v[4],v[4]+m.canvas.width,v[5],v[5]+m.canvas.height)}h.restore(),this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageMaskXObjectGroup(e,t){if(!this.contentVisible)return;const n=this.ctx,r=this.current.fillColor,o=this.current.patternFill;this.dependencyTracker?.resetBBox(e).recordDependencies(e,Oc.transformAndFill);for(const d of t){const{data:c,width:h,height:f,transform:m}=d,y=this.cachedCanvases.getCanvas("maskCanvas",h,f),A=y.context;A.save();const v=this.getObject(e,c,d);Yb(A,v),A.globalCompositeOperation="source-in",A.fillStyle=o?r.getPattern(A,this,Pd(n),_o.FILL,e):r,A.fillRect(0,0,h,f),A.restore(),n.save(),n.transform(...m),n.scale(1,-1),Fg(n,y.canvas,0,0,h,f,0,-1,1,1),this.dependencyTracker?.recordBBox(e,n,0,h,0,f),n.restore()}this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const n=this.getObject(e,t);if(!n){xi("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,n)}paintImageXObjectRepeat(e,t,n,r,o){if(!this.contentVisible)return;const d=this.getObject(e,t);if(!d){xi("Dependent image isn't ready yet");return}const c=d.width,h=d.height,f=[];for(let m=0,y=o.length;m<y;m+=2)f.push({transform:[n,0,0,r,o[m],o[m+1]],x:0,y:0,w:c,h});this.paintInlineImageXObjectGroup(e,d,f)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:n,height:r}=e,o=this.cachedCanvases.getCanvas("inlineImage",n,r),d=o.context;return d.filter=this.current.transferMaps,d.drawImage(t,0,0),d.filter="none",o.canvas}paintInlineImageXObject(e,t){if(!this.contentVisible)return;const n=t.width,r=t.height,o=this.ctx;this.save(e);const{filter:d}=o;d!=="none"&&d!==""&&(o.filter="none"),o.scale(1/n,-1/r);let c;if(t.bitmap)c=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)c=t;else{const m=this.cachedCanvases.getCanvas("inlineImage",n,r).context;Gb(m,t),c=this.applyTransferMapsToCanvas(m)}const h=this._scaleImage(c,Pd(o));o.imageSmoothingEnabled=Xb(Fs(o),t.interpolate),this.dependencyTracker?.resetBBox(e).recordBBox(e,o,0,n,-r,0).recordDependencies(e,Oc.imageXObject).recordOperation(e),Fg(o,h.img,0,0,h.paintWidth,h.paintHeight,0,-r,n,r),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,n){if(!this.contentVisible)return;const r=this.ctx;let o;if(t.bitmap)o=t.bitmap;else{const d=t.width,c=t.height,f=this.cachedCanvases.getCanvas("inlineImage",d,c).context;Gb(f,t),o=this.applyTransferMapsToCanvas(f)}this.dependencyTracker?.resetBBox(e);for(const d of n)r.save(),r.transform(...d.transform),r.scale(1,-1),Fg(r,o,d.x,d.y,d.w,d.h,0,-1,1,1),this.dependencyTracker?.recordBBox(e,r,0,1,-1,0),r.restore();this.dependencyTracker?.recordOperation(e),this.compose()}paintSolidColorImageMask(e){this.contentVisible&&(this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,Oc.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,n){}beginMarkedContent(e,t){this.dependencyTracker?.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,n){this.dependencyTracker?.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){this.dependencyTracker?.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,n){const r=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const o=this.ctx;this.pendingClip?(r||(this.pendingClip===Kb?o.clip(t,"evenodd"):o.clip(t)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):this.dependencyTracker?.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Fs(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:n,c:r,d:o}=this.ctx.getTransform();let d,c;if(n===0&&r===0){const h=Math.abs(t),f=Math.abs(o);if(h===f)if(e===0)d=c=1/h;else{const m=h*e;d=c=m<1?1/m:1}else if(e===0)d=1/h,c=1/f;else{const m=h*e,y=f*e;d=m<1?1/m:1,c=y<1?1/y:1}}else{const h=Math.abs(t*o-n*r),f=Math.hypot(t,n),m=Math.hypot(r,o);if(e===0)d=m/h,c=f/h;else{const y=e*h;d=m>y?m/y:1,c=f>y?f/y:1}}this._cachedScaleForStroking[0]=d,this._cachedScaleForStroking[1]=c}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:n,current:{lineWidth:r}}=this,[o,d]=this.getScaleForStroking();if(o===d){n.lineWidth=(r||1)*o,n.stroke(e);return}const c=n.getLineDash();t&&n.save(),n.scale(o,d),zm.a=1/o,zm.d=1/d;const h=new Path2D;if(h.addPath(e,zm),c.length>0){const f=Math.max(o,d);n.setLineDash(c.map(m=>m/f)),n.lineDashOffset/=f}n.lineWidth=r||1,n.stroke(h),t&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const s in xp)Sf.prototype[s]!==void 0&&(Sf.prototype[xp[s]]=Sf.prototype[s]);class Af{static#e=null;static#t="";static get workerPort(){return this.#e}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#e=e}static get workerSrc(){return this.#t}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#t=e}}class _3{#e;#t;constructor({parsedData:e,rawData:t}){this.#e=e,this.#t=t}getRaw(){return this.#t}get(e){return this.#e.get(e)??null}[Symbol.iterator](){return this.#e.entries()}}const df=Symbol("INTERNAL");class j3{#e=!1;#t=!1;#i=!1;#n=!0;constructor(e,{name:t,intent:n,usage:r,rbGroups:o}){this.#e=!!(e&bc.DISPLAY),this.#t=!!(e&bc.PRINT),this.name=t,this.intent=n,this.usage=r,this.rbGroups=o}get visible(){if(this.#i)return this.#n;if(!this.#n)return!1;const{print:e,view:t}=this.usage;return this.#e?t?.viewState!=="OFF":this.#t?e?.printState!=="OFF":!0}_setVisible(e,t,n=!1){e!==df&&ss("Internal method `_setVisible` called."),this.#i=n,this.#n=t}}class N3{#e=null;#t=new Map;#i=null;#n=null;constructor(e,t=bc.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#n=e.order;for(const n of e.groups)this.#t.set(n.id,new j3(t,n));if(e.baseState==="OFF")for(const n of this.#t.values())n._setVisible(df,!1);for(const n of e.on)this.#t.get(n)._setVisible(df,!0);for(const n of e.off)this.#t.get(n)._setVisible(df,!1);this.#i=this.getHash()}}#a(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let r=1;r<t;r++){const o=e[r];let d;if(Array.isArray(o))d=this.#a(o);else if(this.#t.has(o))d=this.#t.get(o).visible;else return xi(`Optional content group not found: ${o}`),!0;switch(n){case"And":if(!d)return!1;break;case"Or":if(d)return!0;break;case"Not":return!d;default:return!0}}return n==="And"}isVisible(e){if(this.#t.size===0)return!0;if(!e)return h0("Optional content group not defined."),!0;if(e.type==="OCG")return this.#t.has(e.id)?this.#t.get(e.id).visible:(xi(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#a(e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!this.#t.has(t))return xi(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!this.#t.has(t))return xi(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!this.#t.has(t))return xi(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!this.#t.has(t))return xi(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!1}return!0}return xi(`Unknown optional content policy ${e.policy}.`),!0}return xi(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){const r=this.#t.get(e);if(!r){xi(`Optional content group not found: ${e}`);return}if(n&&t&&r.rbGroups.length)for(const o of r.rbGroups)for(const d of o)d!==e&&this.#t.get(d)?._setVisible(df,!1,!0);r._setVisible(df,!!t,!0),this.#e=null}setOCGState({state:e,preserveRB:t}){let n;for(const r of e){switch(r){case"ON":case"OFF":case"Toggle":n=r;continue}const o=this.#t.get(r);if(o)switch(n){case"ON":this.setVisibility(r,!0,t);break;case"OFF":this.setVisibility(r,!1,t);break;case"Toggle":this.setVisibility(r,!o.visible,t);break}}this.#e=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#t.size?this.#n?this.#n.slice():[...this.#t.keys()]:null}getGroup(e){return this.#t.get(e)||null}getHash(){if(this.#e!==null)return this.#e;const e=new cv;for(const[t,n]of this.#t)e.update(`${t}:${n.visible}`);return this.#e=e.hexdigest()}[Symbol.iterator](){return this.#t.entries()}}class P3{constructor(e,{disableRange:t=!1,disableStream:n=!1}){sr(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:r,initialData:o,progressiveDone:d,contentDispositionFilename:c}=e;if(this._queuedChunks=[],this._progressiveDone=d,this._contentDispositionFilename=c,o?.length>0){const h=o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer;this._queuedChunks.push(h)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((h,f)=>{this._onReceiveData({begin:h,chunk:f})}),e.addProgressListener((h,f)=>{this._onProgress({loaded:h,total:f})}),e.addProgressiveReadListener(h=>{this._onReceiveData({chunk:h})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const r=this._rangeReaders.some(function(o){return o._begin!==e?!1:(o._enqueue(n),!0)});sr(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){sr(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new E3(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new R3(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}}class E3{constructor(e,t,n=!1,r=null){this._stream=e,this._done=n||!1,this._filename=Ty(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(const o of this._queuedChunks)this._loaded+=o.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class R3{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function D3(s){let e=!0,t=n("filename\\*","i").exec(s);if(t){t=t[1];let m=c(t);return m=unescape(m),m=h(m),m=f(m),o(m)}if(t=d(s),t){const m=f(t);return o(m)}if(t=n("filename","i").exec(s),t){t=t[1];let m=c(t);return m=f(m),o(m)}function n(m,y){return new RegExp("(?:^|;)\\s*"+m+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',y)}function r(m,y){if(m){if(!/^[\x00-\xFF]+$/.test(y))return y;try{const A=new TextDecoder(m,{fatal:!0}),v=Cp(y);y=A.decode(v),e=!1}catch{}}return y}function o(m){return e&&/[\x80-\xff]/.test(m)&&(m=r("utf-8",m),e&&(m=r("iso-8859-1",m))),m}function d(m){const y=[];let A;const v=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(A=v.exec(m))!==null;){let[,T,_,b]=A;if(T=parseInt(T,10),T in y){if(T===0)break;continue}y[T]=[_,b]}const N=[];for(let T=0;T<y.length&&T in y;++T){let[_,b]=y[T];b=c(b),_&&(b=unescape(b),T===0&&(b=h(b))),N.push(b)}return N.join("")}function c(m){if(m.startsWith('"')){const y=m.slice(1).split('\\"');for(let A=0;A<y.length;++A){const v=y[A].indexOf('"');v!==-1&&(y[A]=y[A].slice(0,v),y.length=A+1),y[A]=y[A].replaceAll(/\\(.)/g,"$1")}m=y.join('"')}return m}function h(m){const y=m.indexOf("'");if(y===-1)return m;const A=m.slice(0,y),N=m.slice(y+1).replace(/^[^']*'/,"");return r(A,N)}function f(m){return!m.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(m)?m:m.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(y,A,v,N){if(v==="q"||v==="Q")return N=N.replaceAll("_"," "),N=N.replaceAll(/=([0-9a-fA-F]{2})/g,function(T,_){return String.fromCharCode(parseInt(_,16))}),r(A,N);try{N=atob(N)}catch{}return r(A,N)})}return""}function mv(s,e){const t=new Headers;if(!s||!e||typeof e!="object")return t;for(const n in e){const r=e[n];r!==void 0&&t.append(n,r)}return t}function g0(s){return URL.parse(s)?.origin??null}function yv({responseHeaders:s,isHttp:e,rangeChunkSize:t,disableRange:n}){const r={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(s.get("Content-Length"),10);return!Number.isInteger(o)||(r.suggestedLength=o,o<=2*t)||n||!e||s.get("Accept-Ranges")!=="bytes"||(s.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function xv(s){const e=s.get("Content-Disposition");if(e){let t=D3(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Ty(t))return t}return null}function Np(s,e){return new i0(`Unexpected server response (${s}) while retrieving PDF "${e}".`,s,s===404||s===0&&e.startsWith("file:"))}function bv(s){return s===200||s===206}function vv(s,e,t){return{method:"GET",headers:s,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function wv(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:(xi(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}class L3{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=mv(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return sr(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new M3(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new I3(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class M3{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const n=new Headers(e.headers),r=t.url;fetch(r,vv(n,this._withCredentials,this._abortController)).then(o=>{if(e._responseOrigin=g0(o.url),!bv(o.status))throw Np(o.status,r);this._reader=o.body.getReader(),this._headersCapability.resolve();const d=o.headers,{allowRangeRequests:c,suggestedLength:h}=yv({responseHeaders:d,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=c,this._contentLength=h||this._contentLength,this._filename=xv(d),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Gu("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:wv(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class I3{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;const o=new Headers(e.headers);o.append("Range",`bytes=${t}-${n-1}`);const d=r.url;fetch(d,vv(o,this._withCredentials,this._abortController)).then(c=>{const h=g0(c.url);if(h!==e._responseOrigin)throw new Error(`Expected range response-origin "${h}" to match "${e._responseOrigin}".`);if(!bv(c.status))throw Np(c.status,d);this._readCapability.resolve(),this._reader=c.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:wv(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}const Bm=200,Fm=206;function z3(s){const e=s.response;return typeof e!="string"?e:Cp(e).buffer}class B3{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:n}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=mv(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,n=this.currXhrId++,r=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[o,d]of this.headers)t.setRequestHeader(o,d);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=Fm):r.expectedStatus=Bm,t.responseType="arraybuffer",sr(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){const n=this.pendingRequests[e];n&&n.onProgress?.(t)}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const r=n.xhr;if(r.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),r.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],r.status===0&&this.isHttp){n.onError(r.status);return}const o=r.status||Bm;if(!(o===Bm&&n.expectedStatus===Fm)&&o!==n.expectedStatus){n.onError(r.status);return}const c=z3(r);if(o===Fm){const h=r.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(h);f?n.onDone({begin:parseInt(f[1],10),chunk:c}):(xi('Missing or invalid "Content-Range" header.'),n.onError(0))}else c?n.onDone({begin:0,chunk:c}):n.onError(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class F3{constructor(e){this._source=e,this._manager=new B3(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return sr(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new O3(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new U3(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class O3{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=g0(t.responseURL);const n=t.getAllResponseHeaders(),r=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(c=>{const[h,...f]=c.split(": ");return[h,f.join(": ")]}):[]),{allowRangeRequests:o,suggestedLength:d}=yv({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});o&&(this._isRangeSupported=!0),this._contentLength=d||this._contentLength,this._filename=xv(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Np(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class U3{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const e=g0(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=Np(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const H3=/^[a-z][a-z0-9\-+.]+:/i;function V3(s){if(H3.test(s))return new URL(s);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(s))}class q3{constructor(e){this.source=e,this.url=V3(e.url),sr(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return sr(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new W3(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new $3(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class W3{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(r=>{this._contentLength=r.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},r=>{r.code==="ENOENT"&&(r=Np(0,this._url.href)),this._storedError=r,this._headersCapability.reject(r)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Gu("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class $3{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const r=e.source;this._isStreamingSupported=!r.disableStream;const o=process.getBuiltinModule("fs");this._setReadableStream(o.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const sp=Symbol("INITIAL_DATA");class Sv{#e=Object.create(null);#t(e){return this.#e[e]||={...Promise.withResolvers(),data:sp}}get(e,t=null){if(t){const r=this.#t(e);return r.promise.then(()=>t(r.data)),null}const n=this.#e[e];if(!n||n.data===sp)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=this.#e[e];return!!t&&t.data!==sp}delete(e){const t=this.#e[e];return!t||t.data===sp?!1:(delete this.#e[e],!0)}resolve(e,t=null){const n=this.#t(e);n.data=t,n.resolve()}clear(){for(const e in this.#e){const{data:t}=this.#e[e];t?.bitmap?.close()}this.#e=Object.create(null)}*[Symbol.iterator](){for(const e in this.#e){const{data:t}=this.#e[e];t!==sp&&(yield[e,t])}}}const G3=1e5,Zb=30;class vl{#e=Promise.withResolvers();#t=null;#i=!1;#n=!!globalThis.FontInspector?.enabled;#a=null;#s=null;#r=0;#o=0;#c=null;#l=null;#h=0;#u=0;#f=Object.create(null);#m=[];#g=null;#d=[];#p=new WeakMap;#y=null;static#b=new Map;static#x=new Map;static#T=new WeakMap;static#A=null;static#w=new Set;constructor({textContentSource:e,container:t,viewport:n}){if(e instanceof ReadableStream)this.#g=e;else if(typeof e=="object")this.#g=new ReadableStream({start(h){h.enqueue(e),h.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#t=this.#l=t,this.#u=n.scale*Id.pixelRatio,this.#h=n.rotation,this.#s={div:null,properties:null,ctx:null};const{pageWidth:r,pageHeight:o,pageX:d,pageY:c}=n.rawDims;this.#y=[1,0,0,-1,-d,c+o],this.#o=r,this.#r=o,vl.#N(),kh(t,n),this.#e.promise.finally(()=>{vl.#w.delete(this),this.#s=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=jo.platform;return bi(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{this.#c.read().then(({value:t,done:n})=>{if(n){this.#e.resolve();return}this.#a??=t.lang,Object.assign(this.#f,t.styles),this.#_(t.items),e()},this.#e.reject)};return this.#c=this.#g.getReader(),vl.#w.add(this),e(),this.#e.promise}update({viewport:e,onBefore:t=null}){const n=e.scale*Id.pixelRatio,r=e.rotation;if(r!==this.#h&&(t?.(),this.#h=r,kh(this.#l,{rotation:r})),n!==this.#u){t?.(),this.#u=n;const o={div:null,properties:null,ctx:vl.#P(this.#a)};for(const d of this.#d)o.properties=this.#p.get(d),o.div=d,this.#C(o)}}cancel(){const e=new Gu("TextLayer task cancelled.");this.#c?.cancel(e).catch(()=>{}),this.#c=null,this.#e.reject(e)}get textDivs(){return this.#d}get textContentItemsStr(){return this.#m}#_(e){if(this.#i)return;this.#s.ctx??=vl.#P(this.#a);const t=this.#d,n=this.#m;for(const r of e){if(t.length>G3){xi("Ignoring additional textDivs for performance reasons."),this.#i=!0;return}if(r.str===void 0){if(r.type==="beginMarkedContentProps"||r.type==="beginMarkedContent"){const o=this.#t;this.#t=document.createElement("span"),this.#t.classList.add("markedContent"),r.id&&this.#t.setAttribute("id",`${r.id}`),o.append(this.#t)}else r.type==="endMarkedContent"&&(this.#t=this.#t.parentNode);continue}n.push(r.str),this.#v(r)}}#v(e){const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#d.push(t);const r=vn.transform(this.#y,e.transform);let o=Math.atan2(r[1],r[0]);const d=this.#f[e.fontName];d.vertical&&(o+=Math.PI/2);let c=this.#n&&d.fontSubstitution||d.fontFamily;c=vl.fontFamilyMap.get(c)||c;const h=Math.hypot(r[2],r[3]),f=h*vl.#z(c,d,this.#a);let m,y;o===0?(m=r[4],y=r[5]-f):(m=r[4]+f*Math.sin(o),y=r[5]-f*Math.cos(o));const A="calc(var(--total-scale-factor) *",v=t.style;this.#t===this.#l?(v.left=`${(100*m/this.#o).toFixed(2)}%`,v.top=`${(100*y/this.#r).toFixed(2)}%`):(v.left=`${A}${m.toFixed(2)}px)`,v.top=`${A}${y.toFixed(2)}px)`),v.fontSize=`${A}${(vl.#A*h).toFixed(2)}px)`,v.fontFamily=c,n.fontSize=h,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#n&&(t.dataset.fontName=d.fontSubstitutionLoadedName||e.fontName),o!==0&&(n.angle=o*(180/Math.PI));let N=!1;if(e.str.length>1)N=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const T=Math.abs(e.transform[0]),_=Math.abs(e.transform[3]);T!==_&&Math.max(T,_)/Math.min(T,_)>1.5&&(N=!0)}if(N&&(n.canvasWidth=d.vertical?e.height:e.width),this.#p.set(t,n),this.#s.div=t,this.#s.properties=n,this.#C(this.#s),n.hasText&&this.#t.append(t),n.hasEOL){const T=document.createElement("br");T.setAttribute("role","presentation"),this.#t.append(T)}}#C(e){const{div:t,properties:n,ctx:r}=e,{style:o}=t;let d="";if(vl.#A>1&&(d=`scale(${1/vl.#A})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:c}=o,{canvasWidth:h,fontSize:f}=n;vl.#j(r,f*this.#u,c);const{width:m}=r.measureText(t.textContent);m>0&&(d=`scaleX(${h*this.#u/m}) ${d}`)}n.angle!==0&&(d=`rotate(${n.angle}deg) ${d}`),d.length>0&&(o.transform=d)}static cleanup(){if(!(this.#w.size>0)){this.#b.clear();for(const{canvas:e}of this.#x.values())e.remove();this.#x.clear()}}static#P(e=null){let t=this.#x.get(e||="");if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#x.set(e,t),this.#T.set(t,{size:0,family:""})}return t}static#j(e,t,n){const r=this.#T.get(e);t===r.size&&n===r.family||(e.font=`${t}px ${n}`,r.size=t,r.family=n)}static#N(){if(this.#A!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#A=e.getBoundingClientRect().height,e.remove()}static#z(e,t,n){const r=this.#b.get(e);if(r)return r;const o=this.#P(n);o.canvas.width=o.canvas.height=Zb,this.#j(o,Zb,e);const d=o.measureText(""),c=d.fontBoundingBoxAscent,h=Math.abs(d.fontBoundingBoxDescent);o.canvas.width=o.canvas.height=0;let f=.8;return c?f=c/(c+h):(jo.platform.isFirefox&&xi("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?f=t.ascent:t.descent&&(f=1+t.descent)),this.#b.set(e,f),f}}const Y3=100;function Av(s={}){typeof s=="string"||s instanceof URL?s={url:s}:(s instanceof ArrayBuffer||ArrayBuffer.isView(s))&&(s={data:s});const e=new Ry,{docId:t}=e,n=s.url?t3(s.url):null,r=s.data?n3(s.data):null,o=s.httpHeaders||null,d=s.withCredentials===!0,c=s.password??null,h=s.range instanceof Cv?s.range:null,f=Number.isInteger(s.rangeChunkSize)&&s.rangeChunkSize>0?s.rangeChunkSize:2**16;let m=s.worker instanceof vp?s.worker:null;const y=s.verbosity,A=typeof s.docBaseUrl=="string"&&!f0(s.docBaseUrl)?s.docBaseUrl:null,v=Mg(s.cMapUrl),N=s.cMapPacked!==!1,T=s.CMapReaderFactory||(wl?d3:zb),_=Mg(s.iccUrl),b=Mg(s.standardFontDataUrl),H=s.StandardFontDataFactory||(wl?u3:Bb),R=Mg(s.wasmUrl),M=s.WasmFactory||(wl?h3:Fb),B=s.stopAtErrors!==!0,q=Number.isInteger(s.maxImageSize)&&s.maxImageSize>-1?s.maxImageSize:-1,G=s.isEvalSupported!==!1,X=typeof s.isOffscreenCanvasSupported=="boolean"?s.isOffscreenCanvasSupported:!wl,O=typeof s.isImageDecoderSupported=="boolean"?s.isImageDecoderSupported:!wl&&(jo.platform.isFirefox||!globalThis.chrome),Y=Number.isInteger(s.canvasMaxAreaInBytes)?s.canvasMaxAreaInBytes:-1,W=typeof s.disableFontFace=="boolean"?s.disableFontFace:wl,I=s.fontExtraProperties===!0,J=s.enableXfa===!0,Z=s.ownerDocument||globalThis.document,Ce=s.disableRange===!0,ie=s.disableStream===!0,le=s.disableAutoFetch===!0,se=s.pdfBug===!0,Ae=s.CanvasFactory||(wl?c3:a3),ue=s.FilterFactory||(wl?l3:o3),E=s.enableHWA===!0,L=s.useWasm!==!1,Q=h?h.length:s.length??NaN,ee=typeof s.useSystemFonts=="boolean"?s.useSystemFonts:!wl&&!W,oe=typeof s.useWorkerFetch=="boolean"?s.useWorkerFetch:!!(T===zb&&H===Bb&&M===Fb&&v&&b&&R&&cp(v,document.baseURI)&&cp(b,document.baseURI)&&cp(R,document.baseURI)),xe=null;NC(y);const re={canvasFactory:new Ae({ownerDocument:Z,enableHWA:E}),filterFactory:new ue({docId:t,ownerDocument:Z}),cMapReaderFactory:oe?null:new T({baseUrl:v,isCompressed:N}),standardFontDataFactory:oe?null:new H({baseUrl:b}),wasmFactory:oe?null:new M({baseUrl:R})};m||(m=vp.create({verbosity:y,port:Af.workerPort}),e._worker=m);const Le={docId:t,apiVersion:"5.4.449",data:r,password:c,disableAutoFetch:le,rangeChunkSize:f,length:Q,docBaseUrl:A,enableXfa:J,evaluatorOptions:{maxImageSize:q,disableFontFace:W,ignoreErrors:B,isEvalSupported:G,isOffscreenCanvasSupported:X,isImageDecoderSupported:O,canvasMaxAreaInBytes:Y,fontExtraProperties:I,useSystemFonts:ee,useWasm:L,useWorkerFetch:oe,cMapUrl:v,iccUrl:_,standardFontDataUrl:b,wasmUrl:R}},Ee={ownerDocument:Z,pdfBug:se,styleElement:xe,loadingParams:{disableAutoFetch:le,enableXfa:J}};return m.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(m.destroyed)throw new Error("Worker was destroyed");const Oe=m.messageHandler.sendWithPromise("GetDocRequest",Le,r?[r.buffer]:null);let Ze;if(h)Ze=new P3(h,{disableRange:Ce,disableStream:ie});else if(!r){if(!n)throw new Error("getDocument - no `url` parameter provided.");const st=cp(n)?L3:wl?q3:F3;Ze=new st({url:n,length:Q,httpHeaders:o,withCredentials:d,rangeChunkSize:f,disableRange:Ce,disableStream:ie})}return Oe.then(st=>{if(e.destroyed)throw new Error("Loading aborted");if(m.destroyed)throw new Error("Worker was destroyed");const mt=new dp(t,st,m.port),Mt=new Z3(mt,e,Ze,Ee,re,E);e._transport=Mt,mt.send("Ready",null)})}).catch(e._capability.reject),e}class Ry{static#e=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${Ry.#e++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class Cv{#e=Promise.withResolvers();#t=[];#i=[];#n=[];#a=[];constructor(e,t,n=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=r}addRangeListener(e){this.#a.push(e)}addProgressListener(e){this.#n.push(e)}addProgressiveReadListener(e){this.#i.push(e)}addProgressiveDoneListener(e){this.#t.push(e)}onDataRange(e,t){for(const n of this.#a)n(e,t)}onDataProgress(e,t){this.#e.promise.then(()=>{for(const n of this.#n)n(e,t)})}onDataProgressiveRead(e){this.#e.promise.then(()=>{for(const t of this.#i)t(e)})}onDataProgressiveDone(){this.#e.promise.then(()=>{for(const e of this.#t)e()})}transportReady(){this.#e.resolve()}requestDataRange(e,t){ss("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class X3{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return bi(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(e){return this._transport.extractPages(e)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class K3{#e=!1;constructor(e,t,n,r=!1){this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=r?new Pb:null,this._pdfBug=r,this.commonObjs=n.commonObjs,this.objs=new Sv,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:o=!1}={}){return new kp({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:o})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return bi(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,canvas:t=e.canvas,viewport:n,intent:r="display",annotationMode:o=Hu.ENABLE,transform:d=null,background:c=null,optionalContentConfigPromise:h=null,annotationCanvasMap:f=null,pageColors:m=null,printAnnotationStorage:y=null,isEditing:A=!1,recordOperations:v=!1,operationsFilter:N=null}){this._stats?.time("Overall");const T=this._transport.getRenderingIntent(r,o,y,A),{renderingIntent:_,cacheKey:b}=T;this.#e=!1,h||=this._transport.getOptionalContentConfig(_);let H=this._intentStates.get(b);H||(H=Object.create(null),this._intentStates.set(b,H)),H.streamReaderCancelTimeout&&(clearTimeout(H.streamReaderCancelTimeout),H.streamReaderCancelTimeout=null);const R=!!(_&bc.PRINT);H.displayReadyCapability||(H.displayReadyCapability=Promise.withResolvers(),H.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(T));const M=!!(this._pdfBug&&globalThis.StepperManager?.enabled),B=!this.recordedBBoxes&&(v||M),q=O=>{if(H.renderTasks.delete(G),B){const Y=G.gfx?.dependencyTracker.take();Y&&(G.stepper&&G.stepper.setOperatorBBoxes(Y,G.gfx.dependencyTracker.takeDebugMetadata()),v&&(this.recordedBBoxes=Y))}R&&(this.#e=!0),this.#t(),O?(G.capability.reject(O),this._abortOperatorList({intentState:H,reason:O instanceof Error?O:new Error(O)})):G.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},G=new gf({callback:q,params:{canvas:t,canvasContext:e,dependencyTracker:B?new p3(t,H.operatorList.length,M):null,viewport:n,transform:d,background:c},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:f,operatorList:H.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!R,pdfBug:this._pdfBug,pageColors:m,enableHWA:this._transport.enableHWA,operationsFilter:N});(H.renderTasks||=new Set).add(G);const X=G.task;return Promise.all([H.displayReadyCapability.promise,h]).then(([O,Y])=>{if(this.destroyed){q();return}if(this._stats?.time("Rendering"),!(Y.renderingIntent&_))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");G.initializeGraphics({transparency:O,optionalContentConfig:Y}),G.operatorListChanged()}).catch(q),X}getOperatorList({intent:e="display",annotationMode:t=Hu.ENABLE,printAnnotationStorage:n=null,isEditing:r=!1}={}){function o(){c.operatorList.lastChunk&&(c.opListReadCapability.resolve(c.operatorList),c.renderTasks.delete(h))}const d=this._transport.getRenderingIntent(e,t,n,r,!0);let c=this._intentStates.get(d.cacheKey);c||(c=Object.create(null),this._intentStates.set(d.cacheKey,c));let h;return c.opListReadCapability||(h=Object.create(null),h.operatorListChanged=o,c.opListReadCapability=Promise.withResolvers(),(c.renderTasks||=new Set).add(h),c.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(d)),c.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>bp.textContent(n));const t=this.streamTextContent(e);return new Promise(function(n,r){function o(){d.read().then(function({value:h,done:f}){if(f){n(c);return}c.lang??=h.lang,Object.assign(c.styles,h.styles),c.items.push(...h.items),o()},r)}const d=t.getReader(),c={items:[],styles:Object.create(null),lang:null};o()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),this.#e=!1,Promise.all(e)}cleanup(e=!1){this.#e=!0;const t=this.#t();return e&&t&&(this._stats&&=new Pb),t}#t(){if(!this.#e||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}_startRenderPage(e,t){const n=this._intentStates.get(t);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let n=0,r=e.length;n<r;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&this.#t()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:r}){const{map:o,transfer:d}=n,h=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:o,modifiedIds:r},d).getReader(),f=this._intentStates.get(t);f.streamReader=h;const m=()=>{h.read().then(({value:y,done:A})=>{if(A){f.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(y,f),m())},y=>{if(f.streamReader=null,!this._transport.destroyed){if(f.operatorList){f.operatorList.lastChunk=!0;for(const A of f.renderTasks)A.operatorListChanged();this.#t()}if(f.displayReadyCapability)f.displayReadyCapability.reject(y);else if(f.opListReadCapability)f.opListReadCapability.reject(y);else throw y}})};m()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof Cy){let r=Y3;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new Gu(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,o]of this._intentStates)if(o===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}var Vu,od,lu,vh,a0,wh,Sh,Cl,Kg,Tv,kv,up,Cf,Zg;const js=class js{constructor({name:e=null,port:t=null,verbosity:n=PC()}={}){_d(this,Cl);_d(this,Vu,Promise.withResolvers());_d(this,od,null);_d(this,lu,null);_d(this,vh,null);if(this.name=e,this.destroyed=!1,this.verbosity=n,t){if(Ts(js,Sh).has(t))throw new Error("Cannot use more than one PDFWorker per port.");Ts(js,Sh).set(t,this),jd(this,Cl,Tv).call(this,t)}else jd(this,Cl,kv).call(this)}get promise(){return Ts(this,Vu).promise}get port(){return Ts(this,lu)}get messageHandler(){return Ts(this,od)}destroy(){this.destroyed=!0,Ts(this,vh)?.terminate(),Hl(this,vh,null),Ts(js,Sh).delete(Ts(this,lu)),Hl(this,lu,null),Ts(this,od)?.destroy(),Hl(this,od,null)}static create(e){const t=Ts(this,Sh).get(e?.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new js(e)}static get workerSrc(){if(Af.workerSrc)return Af.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return bi(this,"_setupFakeWorkerGlobal",(async()=>Ts(this,Cf,Zg)?Ts(this,Cf,Zg):(await import(this.workerSrc)).WorkerMessageHandler)())}};Vu=new WeakMap,od=new WeakMap,lu=new WeakMap,vh=new WeakMap,a0=new WeakMap,wh=new WeakMap,Sh=new WeakMap,Cl=new WeakSet,Kg=function(){Ts(this,Vu).resolve(),Ts(this,od).send("configure",{verbosity:this.verbosity})},Tv=function(e){Hl(this,lu,e),Hl(this,od,new dp("main","worker",e)),Ts(this,od).on("ready",()=>{}),jd(this,Cl,Kg).call(this)},kv=function(){if(Ts(js,wh)||Ts(js,Cf,Zg)){jd(this,Cl,up).call(this);return}let{workerSrc:e}=js;try{js._isSameOrigin(window.location,e)||(e=js._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new dp("main","worker",t),r=()=>{o.abort(),n.destroy(),t.terminate(),this.destroyed?Ts(this,Vu).reject(new Error("Worker was destroyed")):jd(this,Cl,up).call(this)},o=new AbortController;t.addEventListener("error",()=>{Ts(this,vh)||r()},{signal:o.signal}),n.on("test",c=>{if(o.abort(),this.destroyed||!c){r();return}Hl(this,od,n),Hl(this,lu,t),Hl(this,vh,t),jd(this,Cl,Kg).call(this)}),n.on("ready",c=>{if(o.abort(),this.destroyed){r();return}try{d()}catch{jd(this,Cl,up).call(this)}});const d=()=>{const c=new Uint8Array;n.send("test",c,[c.buffer])};d();return}catch{h0("The worker has been disabled.")}jd(this,Cl,up).call(this)},up=function(){Ts(js,wh)||(xi("Setting up fake worker."),Hl(js,wh,!0)),js._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){Ts(this,Vu).reject(new Error("Worker was destroyed"));return}const t=new s3;Hl(this,lu,t);const n=`fake${$1(js,a0)._++}`,r=new dp(n+"_worker",n,t);e.setup(r,t),Hl(this,od,new dp(n,n+"_worker",t)),jd(this,Cl,Kg).call(this)}).catch(e=>{Ts(this,Vu).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},Cf=new WeakSet,Zg=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},_d(js,Cf),_d(js,a0,0),_d(js,wh,!1),_d(js,Sh,new WeakMap),wl&&(Hl(js,wh,!0),Af.workerSrc||="./pdf.worker.mjs"),js._isSameOrigin=(e,t)=>{const n=URL.parse(e);if(!n?.origin||n.origin==="null")return!1;const r=new URL(t,n);return n.origin===r.origin},js._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},js.fromPort=e=>{if(HC("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return js.create(e)};let vp=js;class Z3{#e=new Map;#t=new Map;#i=new Map;#n=new Map;#a=null;constructor(e,t,n,r,o,d){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new Sv,this.fontLoader=new QC({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=o.canvasFactory,this.filterFactory=o.filterFactory,this.cMapReaderFactory=o.cMapReaderFactory,this.standardFontDataFactory=o.standardFontDataFactory,this.wasmFactory=o.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=d,this.setupMessageHandler()}#s(e,t=null){const n=this.#e.get(e);if(n)return n;const r=this.messageHandler.sendWithPromise(e,t);return this.#e.set(e,r),r}get annotationStorage(){return bi(this,"annotationStorage",new jy)}getRenderingIntent(e,t=Hu.ENABLE,n=null,r=!1,o=!1){let d=bc.DISPLAY,c=ly;switch(e){case"any":d=bc.ANY;break;case"display":break;case"print":d=bc.PRINT;break;default:xi(`getRenderingIntent - invalid intent: ${e}`)}const h=d&bc.PRINT&&n instanceof dv?n:this.annotationStorage;switch(t){case Hu.DISABLE:d+=bc.ANNOTATIONS_DISABLE;break;case Hu.ENABLE:break;case Hu.ENABLE_FORMS:d+=bc.ANNOTATIONS_FORMS;break;case Hu.ENABLE_STORAGE:d+=bc.ANNOTATIONS_STORAGE,c=h.serializable;break;default:xi(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(d+=bc.IS_EDITING),o&&(d+=bc.OPLIST);const{ids:f,hash:m}=h.modifiedIds,y=[d,c.hash,m];return{renderingIntent:d,cacheKey:y.join("_"),annotationStorageSerializable:c,modifiedIds:f}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#a?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const n of this.#t.values())e.push(n._destroy());this.#t.clear(),this.#i.clear(),this.#n.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(),vl.cleanup(),this._networkStream?.cancelAllRequests(new Gu("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,r)=>{sr(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=o=>{this._lastProgress={loaded:o.loaded,total:o.total}},r.onPull=()=>{this._fullReader.read().then(function({value:o,done:d}){if(d){r.close();return}sr(o instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{r.error(o)})},r.onCancel=o=>{this._fullReader.cancel(o),r.ready.catch(d=>{if(!this.destroyed)throw d})}}),e.on("ReaderHeadersReady",async n=>{await this._fullReader.headersReady;const{isStreamingSupported:r,isRangeSupported:o,contentLength:d}=this._fullReader;return(!r||!o)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=c=>{t.onProgress?.({loaded:c.loaded,total:c.total})}),{isStreamingSupported:r,isRangeSupported:o,contentLength:d}}),e.on("GetRangeReader",(n,r)=>{sr(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const o=this._networkStream.getRangeReader(n.begin,n.end);if(!o){r.close();return}r.onPull=()=>{o.read().then(function({value:d,done:c}){if(c){r.close();return}sr(d instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(d),1,[d])}).catch(d=>{r.error(d)})},r.onCancel=d=>{o.cancel(d),r.ready.catch(c=>{if(!this.destroyed)throw c})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new X3(n,this))}),e.on("DocException",n=>{t._capability.reject(Vl(n))}),e.on("PasswordRequest",n=>{this.#a=Promise.withResolvers();try{if(!t.onPassword)throw Vl(n);const r=o=>{o instanceof Error?this.#a.reject(o):this.#a.resolve({password:o})};t.onPassword(r,n.code)}catch(r){this.#a.reject(r)}return this.#a.promise}),e.on("DataLoaded",n=>{t.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;this.#t.get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,r,o])=>{if(this.destroyed||this.commonObjs.has(n))return null;switch(r){case"Font":if("error"in o){const y=o.error;xi(`Error during font loading: ${y}`),this.commonObjs.resolve(n,y);break}const d=new Xr(o),c=this._params.pdfBug&&globalThis.FontInspector?.enabled?(y,A)=>globalThis.FontInspector.fontAdded(y,A):null,h=new e3(d,c,o.extra,o.charProcOperatorList);this.fontLoader.bind(h).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!h.fontExtraProperties&&h.data&&h.clearData(),this.commonObjs.resolve(n,h)});break;case"CopyLocalImage":const{imageRef:f}=o;sr(f,"The imageRef must be defined.");for(const y of this.#t.values())for(const[,A]of y.objs)if(A?.ref===f)return A.dataLen?(this.commonObjs.resolve(n,structuredClone(A)),A.dataLen):null;break;case"FontPath":case"Image":this.commonObjs.resolve(n,o);break;case"Pattern":const m=new ao(o);this.commonObjs.resolve(n,m.getIR());break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([n,r,o,d])=>{if(this.destroyed)return;const c=this.#t.get(r);if(!c.objs.has(n)){if(c._intentStates.size===0){d?.bitmap?.close();return}switch(o){case"Image":case"Pattern":c.objs.resolve(n,d);break;default:throw new Error(`Got unknown object type ${o}`)}}}),e.on("DocProgress",n=>{this.destroyed||t.onProgress?.({loaded:n.loaded,total:n.total})}),e.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const r=this[n.type];if(!r)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return r.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&xi("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}extractPages(e){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:e})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=this.#i.get(t);if(n)return n;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(o=>{if(this.destroyed)throw new Error("Transport destroyed");o.refStr&&this.#n.set(o.refStr,e);const d=new K3(t,o,this,this._params.pdfBug);return this.#t.set(t,d),d});return this.#i.set(t,r),r}getPageIndex(e){return cy(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#s("GetFieldObjects")}hasJSActions(){return this.#s("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return this.#s("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#s("GetOptionalContentConfig").then(t=>new N3(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#e.get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(r=>({info:r[0],metadata:r[1]?new _3(r[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null,hasStructTree:r[2]}));return this.#e.set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#t.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(!0),vl.cleanup()}}cachedPageNumber(e){if(!cy(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return this.#n.get(t)??null}}class J3{#e=null;onContinue=null;onError=null;constructor(e){this.#e=e}get promise(){return this.#e.capability.promise}cancel(e=0){this.#e.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this.#e.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#e;return e.form||e.canvas&&t?.size>0}}class gf{#e=null;static#t=new WeakSet;constructor({callback:e,params:t,objs:n,commonObjs:r,annotationCanvasMap:o,operatorList:d,pageIndex:c,canvasFactory:h,filterFactory:f,useRequestAnimationFrame:m=!1,pdfBug:y=!1,pageColors:A=null,enableHWA:v=!1,operationsFilter:N=null}){this.callback=e,this.params=t,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=o,this.operatorListIdx=null,this.operatorList=d,this._pageIndex=c,this.canvasFactory=h,this.filterFactory=f,this._pdfBug=y,this.pageColors=A,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=m===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new J3(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=v,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=N}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(gf.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");gf.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:r,background:o,dependencyTracker:d}=this.params,c=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Sf(c,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,d),this.gfx.beginDrawing({transform:r,viewport:n,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#e&&(window.cancelAnimationFrame(this.#e),this.#e=null),gf.#t.delete(this._canvas),e||=new Cy(`Rendering cancelled, page ${this._pageIndex+1}`,t),this.callback(e),this.task.onError?.(e)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#e=window.requestAnimationFrame(()=>{this.#e=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),gf.#t.delete(this._canvas),this.callback())))}}const _v="5.4.449",Q3="f44e5f0e6";class Uc{#e=null;#t=null;#i;#n=null;#a=!1;#s=!1;#r=null;#o;#c=null;#l=null;static#h=null;static get _keyboardManager(){return bi(this,"_keyboardManager",new jp([[["Escape","mac+Escape"],Uc.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Uc.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Uc.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Uc.prototype._moveToPrevious],[["Home","mac+Home"],Uc.prototype._moveToBeginning],[["End","mac+End"],Uc.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#s=!1,this.#r=e):this.#s=!0,this.#l=e?._uiManager||t,this.#o=this.#l._eventBus,this.#i=e?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",Uc.#h||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const e=this.#e=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",this.#r&&(e.ariaControls=`${this.#r.id}_colorpicker_dropdown`);const t=this.#l._signal;e.addEventListener("click",this.#g.bind(this),{signal:t}),e.addEventListener("keydown",this.#m.bind(this),{signal:t});const n=this.#t=document.createElement("span");return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=this.#i,e.append(n),e}renderMainDropdown(){const e=this.#n=this.#u();return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}#u(){const e=document.createElement("div"),t=this.#l._signal;e.addEventListener("contextmenu",Wc,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#r&&(e.id=`${this.#r.id}_colorpicker_dropdown`);for(const[n,r]of this.#l.highlightColors){const o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",r),o.title=n,o.setAttribute("data-l10n-id",Uc.#h[n]);const d=document.createElement("span");o.append(d),d.className="swatch",d.style.backgroundColor=r,o.ariaSelected=r===this.#i,o.addEventListener("click",this.#f.bind(this,r),{signal:t}),e.append(o)}return e.addEventListener("keydown",this.#m.bind(this),{signal:t}),e}#f(e,t){t.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:rr.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)}_colorSelectFromKeyboard(e){if(e.target===this.#e){this.#g(e);return}const t=e.target.getAttribute("data-color");t&&this.#f(t,e)}_moveToNext(e){if(!this.#p){this.#g(e);return}if(e.target===this.#e){this.#n.firstElementChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#n?.firstElementChild||e.target===this.#e){this.#p&&this._hideDropdownFromKeyboard();return}this.#p||this.#g(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#p){this.#g(e);return}this.#n.firstElementChild?.focus()}_moveToEnd(e){if(!this.#p){this.#g(e);return}this.#n.lastElementChild?.focus()}#m(e){Uc._keyboardManager.exec(this,e)}#g(e){if(this.#p){this.hideDropdown();return}if(this.#a=e.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#d.bind(this),{signal:this.#l.combinedSignal(this.#c)})),this.#e.ariaExpanded="true",this.#n){this.#n.classList.remove("hidden");return}const t=this.#n=this.#u();this.#e.append(t)}#d(e){this.#n?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#n?.classList.add("hidden"),this.#e.ariaExpanded="false",this.#c?.abort(),this.#c=null}get#p(){return this.#n&&!this.#n.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#s){if(!this.#p){this.#r?.unselect();return}this.hideDropdown(),this.#e.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(e){if(this.#t&&(this.#t.style.backgroundColor=e),!this.#n)return;const t=this.#l.highlightColors.values();for(const n of this.#n.children)n.ariaSelected=t.next().value===e.toUpperCase()}destroy(){this.#e?.remove(),this.#e=null,this.#t=null,this.#n?.remove(),this.#n=null}}class wp{#e=null;#t=null;#i=null;static#n=null;constructor(e){this.#t=e,this.#i=e._uiManager,wp.#n||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#e)return this.#e;const{editorType:e,colorType:t,color:n}=this.#t,r=this.#e=document.createElement("input");return r.type="color",r.value=n||"#000000",r.className="basicColorPicker",r.tabIndex=0,r.setAttribute("data-l10n-id",wp.#n[e]),r.addEventListener("input",()=>{this.#i.updateParams(t,r.value)},{signal:this.#i._signal}),r}update(e){this.#e&&(this.#e.value=e)}destroy(){this.#e?.remove(),this.#e=null}hideDropdown(){}}function Jb(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}function ap(s){return Math.max(0,Math.min(255,255*s))}class Qb{static CMYK_G([e,t,n,r]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=ap(e),[e,e,e]}static G_HTML([e]){const t=Jb(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(ap)}static RGB_HTML(e){return`#${e.map(Jb).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,n+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,n,r]){return[ap(1-Math.min(1,e+r)),ap(1-Math.min(1,n+r)),ap(1-Math.min(1,t+r))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){const r=1-e,o=1-t,d=1-n,c=Math.min(r,o,d);return["CMYK",r,o,d,c]}}class eT{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),n||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){ss("Abstract method `_createSVG` called.")}}class s0 extends eT{_createSVG(e){return document.createElementNS(su,e)}}const tT=9,_h=new WeakSet,nT=new Date().getTimezoneOffset()*60*1e3;class Om{static create(e){switch(e.data.annotationType){case ja.LINK:return new Dy(e);case ja.TEXT:return new rT(e);case ja.WIDGET:switch(e.data.fieldType){case"Tx":return new sT(e);case"Btn":return e.data.radioButton?new jv(e):e.data.checkBox?new oT(e):new lT(e);case"Ch":return new cT(e);case"Sig":return new aT(e)}return new Eh(e);case ja.POPUP:return new hy(e);case ja.FREETEXT:return new Nv(e);case ja.LINE:return new uT(e);case ja.SQUARE:return new hT(e);case ja.CIRCLE:return new fT(e);case ja.POLYLINE:return new Pv(e);case ja.CARET:return new gT(e);case ja.INK:return new Ly(e);case ja.POLYGON:return new pT(e);case ja.HIGHLIGHT:return new Ev(e);case ja.UNDERLINE:return new mT(e);case ja.SQUIGGLY:return new yT(e);case ja.STRIKEOUT:return new xT(e);case ja.STAMP:return new Rv(e);case ja.FILEATTACHMENT:return new bT(e);default:return new Os(e)}}}class Os{#e=null;#t=!1;#i=null;constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:r=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,this.hasOwnCommentButton=!1,t&&(this.contentElement=this.container=this._createContainer(n)),r&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e?.str||t?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Os._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:e}=this,t=this.annotationStorage?.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const e=this.annotationStorage?.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:n,rect:r}=this.data;let o=-1/0,d=-1/0;if(t?.length>=8){for(let c=0;c<t.length;c+=8)t[c+1]>d?(d=t[c+1],o=t[c+2]):t[c+1]===d&&(o=Math.max(o,t[c+2]));return[o,d]}if(n?.length>=1){for(const c of n)for(let h=0,f=c.length;h<f;h+=2)c[h+1]>d?(d=c[h+1],o=c[h]):c[h+1]===d&&(o=Math.max(o,c[h]));if(o!==1/0)return[o,d]}return r?[r[2],r[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:o,pageY:d}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-o)/n,e[1]=100*(e[1]-d)/r,e}get commentText(){const{data:e}=this;return this.annotationStorage.getRawValue(`${yp}${e.id}`)?.popup?.contents||e.contentsObj?.str||""}set commentText(e){const{data:t}=this,n={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:n})||this.annotationStorage.setValue(`${yp}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:n,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){(this.#i?.popup||this.popup)?.remove(),this.#i=this.popup=null}updateEdited(e){if(!this.container)return;e.rect&&(this.#e||={rect:this.data.rect.slice(0)});const{rect:t,popup:n}=e;t&&this.#n(t);let r=this.#i?.popup||this.popup;!r&&n?.text&&(this._createPopup(n),r=this.#i.popup),r&&(r.updateEdited(e),n?.deleted&&(r.remove(),this.#i=null,this.popup=null))}resetEdited(){this.#e&&(this.#n(this.#e.rect),this.#i?.popup.resetEdited(),this.#e=null)}#n(e){const{container:{style:t},data:{rect:n,rotation:r},parent:{viewport:{rawDims:{pageWidth:o,pageHeight:d,pageX:c,pageY:h}}}}=this;n?.splice(0,4,...e),t.left=`${100*(e[0]-c)/o}%`,t.top=`${100*(d-e[3]+h)/d}%`,r===0?(t.width=`${100*(e[2]-e[0])/o}%`,t.height=`${100*(e[3]-e[1])/d}%`):this.setRotation(r)}_createContainer(e){const{data:t,parent:{page:n,viewport:r}}=this,o=document.createElement("section");o.setAttribute("data-annotation-id",t.id),!(this instanceof Eh)&&!(this instanceof Dy)&&(o.tabIndex=0);const{style:d}=o;if(d.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(o.title=t.alternativeText),t.noRotate&&o.classList.add("norotate"),!t.rect||this instanceof hy){const{rotation:T}=t;return!t.hasOwnCanvas&&T!==0&&this.setRotation(T,o),o}const{width:c,height:h}=this;if(!e&&t.borderStyle.width>0){d.borderWidth=`${t.borderStyle.width}px`;const T=t.borderStyle.horizontalCornerRadius,_=t.borderStyle.verticalCornerRadius;if(T>0||_>0){const H=`calc(${T}px * var(--total-scale-factor)) / calc(${_}px * var(--total-scale-factor))`;d.borderRadius=H}else if(this instanceof jv){const H=`calc(${c}px * var(--total-scale-factor)) / calc(${h}px * var(--total-scale-factor))`;d.borderRadius=H}switch(t.borderStyle.style){case cf.SOLID:d.borderStyle="solid";break;case cf.DASHED:d.borderStyle="dashed";break;case cf.BEVELED:xi("Unimplemented border style: beveled");break;case cf.INSET:xi("Unimplemented border style: inset");break;case cf.UNDERLINE:d.borderBottomStyle="solid";break}const b=t.borderColor||null;b?(this.#t=!0,d.borderColor=vn.makeHexColor(b[0]|0,b[1]|0,b[2]|0)):d.borderWidth=0}const f=vn.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:m,pageHeight:y,pageX:A,pageY:v}=r.rawDims;d.left=`${100*(f[0]-A)/m}%`,d.top=`${100*(f[1]-v)/y}%`;const{rotation:N}=t;return t.hasOwnCanvas||N===0?(d.width=`${100*c/m}%`,d.height=`${100*h/y}%`):this.setRotation(N,o),o}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:r}=this.parent.viewport.rawDims;let{width:o,height:d}=this;e%180!==0&&([o,d]=[d,o]),t.style.width=`${100*o/n}%`,t.style.height=`${100*d/r}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,n,r)=>{const o=r.detail[t],d=o[0],c=o.slice(1);r.target.style[n]=Qb[`${d}_HTML`](c),this.annotationStorage.setValue(this.data.id,{[n]:Qb[`${d}_rgb`](c)})};return bi(this,"_commonActions",{display:t=>{const{display:n}=t.detail,r=n%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const r of Object.keys(t.detail))(e[r]||n[r])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[r,o]of Object.entries(t)){const d=n[r];if(d){const c={detail:{[r]:o},target:e};d(c),delete t[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,r,o]=this.data.rect.map(T=>Math.fround(T));if(e.length===8){const[T,_,b,H]=e.subarray(2,6);if(r===T&&o===_&&t===b&&n===H)return}const{style:d}=this.container;let c;if(this.#t){const{borderColor:T,borderWidth:_}=d;d.borderWidth=0,c=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${T}" stroke-width="${_}">`],this.container.classList.add("hasBorder")}const h=r-t,f=o-n,{svgFactory:m}=this,y=m.createElement("svg");y.classList.add("quadrilateralsContainer"),y.setAttribute("width",0),y.setAttribute("height",0),y.role="none";const A=m.createElement("defs");y.append(A);const v=m.createElement("clipPath"),N=`clippath_${this.data.id}`;v.setAttribute("id",N),v.setAttribute("clipPathUnits","objectBoundingBox"),A.append(v);for(let T=2,_=e.length;T<_;T+=8){const b=e[T],H=e[T+1],R=e[T+2],M=e[T+3],B=m.createElement("rect"),q=(R-t)/h,G=(o-H)/f,X=(b-R)/h,O=(H-M)/f;B.setAttribute("x",q),B.setAttribute("y",G),B.setAttribute("width",X),B.setAttribute("height",O),v.append(B),c?.push(`<rect vector-effect="non-scaling-stroke" x="${q}" y="${G}" width="${X}" height="${O}"/>`)}this.#t&&(c.push("</g></svg>')"),d.backgroundImage=c.join("")),this.container.append(y),this.container.style.clipPath=`url(#${N})`}_createPopup(e=null){const{data:t}=this;let n,r;e?(n={str:e.text},r=e.date):(n=t.contentsObj,r=t.modificationDate),this.#i=new hy({data:{color:t.color,titleObj:t.titleObj,modificationDate:r,contentsObj:n,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#i||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#i}render(){ss("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const n=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:o,id:d,exportValues:c}of r){if(o===-1||d===t)continue;const h=typeof c=="string"?c:null,f=document.querySelector(`[data-element-id="${d}"]`);if(f&&!_h.has(f)){xi(`_getElementsByName - element not allowed: ${d}`);continue}n.push({id:d,exportValue:h,domElement:f})}return n}for(const r of document.getElementsByName(e)){const{exportValue:o}=r,d=r.getAttribute("data-element-id");d!==t&&_h.has(r)&&n.push({id:d,exportValue:o,domElement:r})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class iT extends Os{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&this._createPopup(e.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class Dy extends Os{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,n=document.createElement("a");n.setAttribute("data-element-id",e.id);let r=!1;return e.url?(t.addLinkAttributes(n,e.url,e.newWindow),r=!0):e.action?(this._bindNamedAction(n,e.action,e.overlaidText),r=!0):e.attachment?(this.#t(n,e.attachment,e.overlaidText,e.attachmentDest),r=!0):e.setOCGState?(this.#i(n,e.setOCGState,e.overlaidText),r=!0):e.dest?(this._bindLink(n,e.dest,e.overlaidText),r=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,e),r=!0),e.resetForm?(this._bindResetFormAction(n,e.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(n,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&(this.contentElement=n,this.container.append(n)),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t,n=""){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#e(),n&&(e.title=n)}_bindNamedAction(e,t,n=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),n&&(e.title=n),this.#e()}#t(e,t,n="",r=null){e.href=this.linkService.getAnchorUrl(""),t.description?e.title=t.description:n&&(e.title=n),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,r),!1),this.#e()}#i(e,t,n=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),n&&(e.title=n),this.#e()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(t.actions)){const o=n.get(r);o&&(e[o]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:r}}),!1))}t.overlaidText&&(e.title=t.overlaidText),e.onclick||(e.onclick=()=>!1),this.#e()}_bindResetFormAction(e,t){const n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){xi('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),n||(e.onclick=()=>!1);return}e.onclick=()=>{n?.();const{fields:r,refs:o,include:d}=t,c=[];if(r.length!==0||o.length!==0){const m=new Set(o);for(const y of r){const A=this._fieldObjects[y]||[];for(const{id:v}of A)m.add(v)}for(const y of Object.values(this._fieldObjects))for(const A of y)m.has(A.id)===d&&c.push(A)}else for(const m of Object.values(this._fieldObjects))c.push(...m);const h=this.annotationStorage,f=[];for(const m of c){const{id:y}=m;switch(f.push(y),m.type){case"text":{const v=m.defaultValue||"";h.setValue(y,{value:v});break}case"checkbox":case"radiobutton":{const v=m.defaultValue===m.exportValues;h.setValue(y,{value:v});break}case"combobox":case"listbox":{const v=m.defaultValue||"";h.setValue(y,{value:v});break}default:continue}const A=document.querySelector(`[data-element-id="${y}"]`);if(A){if(!_h.has(A)){xi(`_bindResetFormAction - element not allowed: ${y}`);continue}}else continue;A.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:f,name:"ResetForm"}}),!1}}}class rT extends Os{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(e),this.container}}class Eh extends Os{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return jo.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,r,o){n.includes("mouse")?e.addEventListener(n,d=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:o(d),shift:d.shiftKey,modifier:this._getKeyModifier(d)}})}):e.addEventListener(n,d=>{if(n==="blur"){if(!t.focused||!d.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}o&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:o(d)}})})}_setEventListeners(e,t,n,r){for(const[o,d]of n)(d==="Action"||this.data.actions?.[d])&&((d==="Focus"||d==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,o,d,r),d==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):d==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":vn.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||tT,o=e.style;let d;const c=2,h=f=>Math.round(10*f)/10;if(this.data.multiLine){const f=Math.abs(this.data.rect[3]-this.data.rect[1]-c),m=Math.round(f/(Rm*r))||1,y=f/m;d=Math.min(r,h(y/Rm))}else{const f=Math.abs(this.data.rect[3]-this.data.rect[1]-c);d=Math.min(r,h(f/Rm))}o.fontSize=`calc(${d}px * var(--total-scale-factor))`,o.color=vn.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(o.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class sT extends Eh{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,r){const o=this.annotationStorage;for(const d of this._getElementsByName(e.name,e.id))d.domElement&&(d.domElement[t]=n),o.setValue(d.id,{[r]:n})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const r=e.getValue(t,{value:this.data.fieldValue});let o=r.value||"";const d=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;d&&o.length>d&&(o=o.slice(0,d));let c=r.formattedValue||this.data.textContent?.join(`
`)||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));const h={userValue:o,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=c??o,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",c??o),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),_h.add(n),this.contentElement=n,n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:f,datetimeType:m,timeStep:y}=this.data,A=!!m&&this.enableScripting;f&&(n.title=f),this._setRequired(n,this.data.required),d&&(n.maxLength=d),n.addEventListener("input",N=>{e.setValue(t,{value:N.target.value}),this.setPropertyOnSiblings(n,"value",N.target.value,"value"),h.formattedValue=null}),n.addEventListener("resetform",N=>{const T=this.data.defaultFieldValue??"";n.value=h.userValue=T,h.formattedValue=null});let v=N=>{const{formattedValue:T}=h;T!=null&&(N.target.value=T),N.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",T=>{if(h.focused)return;const{target:_}=T;if(A&&(_.type=m,y&&(_.step=y)),h.userValue){const b=h.userValue;if(A)if(m==="time"){const H=new Date(b),R=[H.getHours(),H.getMinutes(),H.getSeconds()];_.value=R.map(M=>M.toString().padStart(2,"0")).join(":")}else _.value=new Date(b-nT).toISOString().split(m==="date"?"T":".",1)[0];else _.value=b}h.lastCommittedValue=_.value,h.commitKey=1,this.data.actions?.Focus||(h.focused=!0)}),n.addEventListener("updatefromsandbox",T=>{this.showElementAndHideCanvas(T.target);const _={value(b){h.userValue=b.detail.value??"",A||e.setValue(t,{value:h.userValue.toString()}),b.target.value=h.userValue},formattedValue(b){const{formattedValue:H}=b.detail;h.formattedValue=H,H!=null&&b.target!==document.activeElement&&(b.target.value=H);const R={formattedValue:H};A&&(R.value=H),e.setValue(t,R)},selRange(b){b.target.setSelectionRange(...b.detail.selRange)},charLimit:b=>{const{charLimit:H}=b.detail,{target:R}=b;if(H===0){R.removeAttribute("maxLength");return}R.setAttribute("maxLength",H);let M=h.userValue;!M||M.length<=H||(M=M.slice(0,H),R.value=h.userValue=M,e.setValue(t,{value:M}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:M,willCommit:!0,commitKey:1,selStart:R.selectionStart,selEnd:R.selectionEnd}}))}};this._dispatchEventFromSandbox(_,T)}),n.addEventListener("keydown",T=>{h.commitKey=1;let _=-1;if(T.key==="Escape"?_=0:T.key==="Enter"&&!this.data.multiLine?_=2:T.key==="Tab"&&(h.commitKey=3),_===-1)return;const{value:b}=T.target;h.lastCommittedValue!==b&&(h.lastCommittedValue=b,h.userValue=b,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:b,willCommit:!0,commitKey:_,selStart:T.target.selectionStart,selEnd:T.target.selectionEnd}}))});const N=v;v=null,n.addEventListener("blur",T=>{if(!h.focused||!T.relatedTarget)return;this.data.actions?.Blur||(h.focused=!1);const{target:_}=T;let{value:b}=_;if(A){if(b&&m==="time"){const H=b.split(":").map(R=>parseInt(R,10));b=new Date(2e3,0,1,H[0],H[1],H[2]||0).valueOf(),_.step=""}else b.includes("T")||(b=`${b}T00:00`),b=new Date(b).valueOf();_.type="text"}h.userValue=b,h.lastCommittedValue!==b&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:b,willCommit:!0,commitKey:h.commitKey,selStart:T.target.selectionStart,selEnd:T.target.selectionEnd}}),N(T)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",T=>{h.lastCommittedValue=null;const{data:_,target:b}=T,{value:H,selectionStart:R,selectionEnd:M}=b;let B=R,q=M;switch(T.inputType){case"deleteWordBackward":{const G=H.substring(0,R).match(/\w*[^\w]*$/);G&&(B-=G[0].length);break}case"deleteWordForward":{const G=H.substring(R).match(/^[^\w]*\w*/);G&&(q+=G[0].length);break}case"deleteContentBackward":R===M&&(B-=1);break;case"deleteContentForward":R===M&&(q+=1);break}T.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:H,change:_||"",willCommit:!1,selStart:B,selEnd:q}})}),this._setEventListeners(n,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],T=>T.target.value)}if(v&&n.addEventListener("blur",v),this.data.comb){const T=(this.data.rect[2]-this.data.rect[0])/d;n.classList.add("comb"),n.style.letterSpacing=`calc(${T}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class aT extends Eh{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class oT extends Eh{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",e.setValue(n,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const o=document.createElement("input");return _h.add(o),o.setAttribute("data-element-id",n),o.disabled=t.readOnly,this._setRequired(o,this.data.required),o.type="checkbox",o.name=t.fieldName,r&&o.setAttribute("checked",!0),o.setAttribute("exportValue",t.exportValue),o.tabIndex=0,o.addEventListener("change",d=>{const{name:c,checked:h}=d.target;for(const f of this._getElementsByName(c,n)){const m=h&&f.exportValue===t.exportValue;f.domElement&&(f.domElement.checked=m),e.setValue(f.id,{value:m})}e.setValue(n,{value:h})}),o.addEventListener("resetform",d=>{const c=t.defaultFieldValue||"Off";d.target.checked=c===t.exportValue}),this.enableScripting&&this.hasJSActions&&(o.addEventListener("updatefromsandbox",d=>{const c={value(h){h.target.checked=h.detail.value!=="Off",e.setValue(n,{value:h.target.checked})}};this._dispatchEventFromSandbox(c,d)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],d=>d.target.checked)),this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class jv extends Eh{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof r=="string"&&(r=r!==t.buttonValue,e.setValue(n,{value:r})),r)for(const d of this._getElementsByName(t.fieldName,n))e.setValue(d.id,{value:!1});const o=document.createElement("input");if(_h.add(o),o.setAttribute("data-element-id",n),o.disabled=t.readOnly,this._setRequired(o,this.data.required),o.type="radio",o.name=t.fieldName,r&&o.setAttribute("checked",!0),o.tabIndex=0,o.addEventListener("change",d=>{const{name:c,checked:h}=d.target;for(const f of this._getElementsByName(c,n))e.setValue(f.id,{value:!1});e.setValue(n,{value:h})}),o.addEventListener("resetform",d=>{const c=t.defaultFieldValue;d.target.checked=c!=null&&c===t.buttonValue}),this.enableScripting&&this.hasJSActions){const d=t.buttonValue;o.addEventListener("updatefromsandbox",c=>{const h={value:f=>{const m=d===f.detail.value;for(const y of this._getElementsByName(f.target.name)){const A=m&&y.id===n;y.domElement&&(y.domElement.checked=A),e.setValue(y.id,{value:A})}}};this._dispatchEventFromSandbox(h,c)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],c=>c.target.checked)}return this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class lT extends Dy{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}}class cT extends Eh{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");_h.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=0;let o=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",m=>{const y=this.data.defaultFieldValue;for(const A of r.options)A.selected=A.value===y});for(const m of this.data.options){const y=document.createElement("option");y.textContent=m.displayValue,y.value=m.exportValue,n.value.includes(m.exportValue)&&(y.setAttribute("selected",!0),o=!1),r.append(y)}let d=null;if(o){const m=document.createElement("option");m.value=" ",m.setAttribute("hidden",!0),m.setAttribute("selected",!0),r.prepend(m),d=()=>{m.remove(),r.removeEventListener("input",d),d=null},r.addEventListener("input",d)}const c=m=>{const y=m?"value":"textContent",{options:A,multiple:v}=r;return v?Array.prototype.filter.call(A,N=>N.selected).map(N=>N[y]):A.selectedIndex===-1?null:A[A.selectedIndex][y]};let h=c(!1);const f=m=>{const y=m.target.options;return Array.prototype.map.call(y,A=>({displayValue:A.textContent,exportValue:A.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",m=>{const y={value(A){d?.();const v=A.detail.value,N=new Set(Array.isArray(v)?v:[v]);for(const T of r.options)T.selected=N.has(T.value);e.setValue(t,{value:c(!0)}),h=c(!1)},multipleSelection(A){r.multiple=!0},remove(A){const v=r.options,N=A.detail.remove;v[N].selected=!1,r.remove(N),v.length>0&&Array.prototype.findIndex.call(v,_=>_.selected)===-1&&(v[0].selected=!0),e.setValue(t,{value:c(!0),items:f(A)}),h=c(!1)},clear(A){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),h=c(!1)},insert(A){const{index:v,displayValue:N,exportValue:T}=A.detail.insert,_=r.children[v],b=document.createElement("option");b.textContent=N,b.value=T,_?_.before(b):r.append(b),e.setValue(t,{value:c(!0),items:f(A)}),h=c(!1)},items(A){const{items:v}=A.detail;for(;r.length!==0;)r.remove(0);for(const N of v){const{displayValue:T,exportValue:_}=N,b=document.createElement("option");b.textContent=T,b.value=_,r.append(b)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:c(!0),items:f(A)}),h=c(!1)},indices(A){const v=new Set(A.detail.indices);for(const N of A.target.options)N.selected=v.has(N.index);e.setValue(t,{value:c(!0)}),h=c(!1)},editable(A){A.target.disabled=!A.detail.editable}};this._dispatchEventFromSandbox(y,m)}),r.addEventListener("input",m=>{const y=c(!0),A=c(!1);e.setValue(t,{value:y}),m.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:h,change:A,changeEx:y,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],m=>m.target.value)):r.addEventListener("input",function(m){e.setValue(t,{value:c(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class hy extends Os{constructor(e){const{data:t,elements:n,parent:r}=e,o=!!r._commentManager;if(super(e,{isRenderable:!o&&Os._hasPopupData(t)}),this.elements=n,o&&Os._hasPopupData(t)){const d=this.popup=this.#e();for(const c of n)c.popup=d}else this.popup=null}#e(){return new dT({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";const t=this.popup=this.#e(),n=[];for(const r of this.elements)r.popup=t,r.container.ariaHasPopup="dialog",n.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(r=>`${ff}${r}`).join(",")),this.container}}class dT{#e=null;#t=this.#q.bind(this);#i=this.#F.bind(this);#n=this.#D.bind(this);#a=this.#S.bind(this);#s=null;#r=null;#o=null;#c=null;#l=null;#h=null;#u=null;#f=!1;#m=null;#g=null;#d=null;#p=null;#y=null;#b=null;#x=null;#T=null;#A=null;#w=null;#_=!1;#v=null;#C=null;constructor({container:e,color:t,elements:n,titleObj:r,modificationDate:o,contentsObj:d,richText:c,parent:h,rect:f,parentRect:m,open:y,commentManager:A=null}){this.#r=e,this.#A=r,this.#o=d,this.#T=c,this.#h=h,this.#s=t,this.#x=f,this.#u=m,this.#l=n,this.#e=A,this.#v=n[0],this.#c=sy.toDateObject(o),this.trigger=n.flatMap(v=>v.getElementsToTriggerPopup()),A||(this.#P(),this.#r.hidden=!0,y&&this.#S())}#P(){if(this.#g)return;this.#g=new AbortController;const{signal:e}=this.#g;for(const t of this.trigger)t.addEventListener("click",this.#a,{signal:e}),t.addEventListener("pointerenter",this.#n,{signal:e}),t.addEventListener("pointerleave",this.#i,{signal:e}),t.classList.add("popupTriggerArea");for(const t of this.#l)t.container?.addEventListener("keydown",this.#t,{signal:e})}#j(){const e=this.#l.find(t=>t.hasCommentButton);e&&(this.#y=e._normalizePoint(e.commentButtonPosition))}renderCommentButton(){if(this.#p){this.#p.parentNode||this.#v.container.after(this.#p);return}if(this.#y||this.#j(),!this.#y)return;const{signal:e}=this.#g=new AbortController,t=this.#v.hasOwnCommentButton,n=()=>{this.#e.toggleCommentPopup(this,!0,void 0,!t)},r=()=>{this.#e.toggleCommentPopup(this,!1,!0,!t)},o=()=>{this.#e.toggleCommentPopup(this,!1,!1)};if(t){this.#p=this.#v.container;for(const d of this.trigger)d.ariaHasPopup="dialog",d.ariaControls="commentPopup",d.addEventListener("keydown",this.#t,{signal:e}),d.addEventListener("click",n,{signal:e}),d.addEventListener("pointerenter",r,{signal:e}),d.addEventListener("pointerleave",o,{signal:e}),d.classList.add("popupTriggerArea")}else{const d=this.#p=document.createElement("button");d.className="annotationCommentButton";const c=this.#v.container;d.style.zIndex=c.style.zIndex+1,d.tabIndex=0,d.ariaHasPopup="dialog",d.ariaControls="commentPopup",d.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#z(),this.#N(),d.addEventListener("keydown",this.#t,{signal:e}),d.addEventListener("click",n,{signal:e}),d.addEventListener("pointerenter",r,{signal:e}),d.addEventListener("pointerleave",o,{signal:e}),c.after(d)}}#N(){if(this.#v.extraPopupElement&&!this.#v.editor)return;this.#p||this.renderCommentButton();const[e,t]=this.#y,{style:n}=this.#p;n.left=`calc(${e}%)`,n.top=`calc(${t}% - var(--comment-button-dim))`}#z(){this.#v.extraPopupElement||(this.#p||this.renderCommentButton(),this.#p.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:e,opacity:t}=this.#v.commentData;return e?this.#h._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{this.#p?.focus()},0)}getData(){const{richText:e,color:t,opacity:n,creationDate:r,modificationDate:o}=this.#v.commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:n,creationDate:r,modificationDate:o}}get elementBeforePopup(){return this.#p}get comment(){return this.#C||=this.#v.commentText,this.#C}set comment(e){e!==this.comment&&(this.#v.commentText=this.#C=e)}focus(){this.#v.container?.focus()}get parentBoundingClientRect(){return this.#v.layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){this.#p&&(this.#p.classList.toggle("selected",e),this.#p.ariaExpanded=t)}setSelectedCommentButton(e){this.#p.classList.toggle("selected",e)}get commentPopupPosition(){if(this.#b)return this.#b;const{x:e,y:t,height:n}=this.#p.getBoundingClientRect(),{x:r,y:o,width:d,height:c}=this.#v.layer.getBoundingClientRect();return[(e-r)/d,(t+n-o)/c]}set commentPopupPosition(e){this.#b=e}hasDefaultPopupPosition(){return this.#b===null}get commentButtonPosition(){return this.#y}get commentButtonWidth(){return this.#p.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,n]=this.#b||this.commentButtonPosition.map(f=>f/100),r=this.parentBoundingClientRect,{x:o,y:d,width:c,height:h}=r;this.#e.showDialog(null,this,o+t*c,d+n*h,{...e,parentDimensions:r})}render(){if(this.#m)return;const e=this.#m=document.createElement("div");if(e.className="popup",this.#s){const n=e.style.outlineColor=vn.makeHexColor(...this.#s);e.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const t=document.createElement("span");if(t.className="header",this.#A?.str){const n=document.createElement("span");n.className="title",t.append(n),{dir:n.dir,str:n.textContent}=this.#A}if(e.append(t),this.#c){const n=document.createElement("time");n.className="popupDate",n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#c.valueOf()})),n.dateTime=this.#c.toISOString(),t.append(n)}av({html:this.#R||this.#o.str,dir:this.#o?.dir,className:"popupContent"},e),this.#r.append(e)}get#R(){const e=this.#T,t=this.#o;return e?.str&&(!t?.str||t.str===e.str)&&this.#T.html||null}get#L(){return this.#R?.attributes?.style?.fontSize||0}get#B(){return this.#R?.attributes?.style?.color||null}#M(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},r={style:{color:this.#B,fontSize:this.#L?`calc(${this.#L}px * var(--total-scale-factor))`:""}};for(const o of e.split(`
`))t.push({name:"span",value:o,attributes:r});return n}#q(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#f)&&this.#S()}updateEdited({rect:e,popup:t,deleted:n}){if(this.#e){n?(this.remove(),this.#C=null):t&&(t.deleted?this.remove():(this.#z(),this.#C=t.text)),e&&(this.#y=null,this.#j(),this.#N());return}if(n||t?.deleted){this.remove();return}this.#P(),this.#w||={contentsObj:this.#o,richText:this.#T},e&&(this.#d=null),t&&t.text&&(this.#T=this.#M(t.text),this.#c=sy.toDateObject(t.date),this.#o=null),this.#m?.remove(),this.#m=null}resetEdited(){this.#w&&({contentsObj:this.#o,richText:this.#T}=this.#w,this.#w=null,this.#m?.remove(),this.#m=null,this.#d=null)}remove(){if(this.#g?.abort(),this.#g=null,this.#m?.remove(),this.#m=null,this.#_=!1,this.#f=!1,this.#p?.remove(),this.#p=null,this.trigger)for(const e of this.trigger)e.classList.remove("popupTriggerArea")}#k(){if(this.#d!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:r,pageY:o}}}=this.#h;let d=!!this.#u,c=d?this.#u:this.#x;for(const N of this.#l)if(!c||vn.intersect(N.data.rect,c)!==null){c=N.data.rect,d=!0;break}const h=vn.normalizeRect([c[0],e[3]-c[1]+e[1],c[2],e[3]-c[3]+e[1]]),m=d?c[2]-c[0]+5:0,y=h[0]+m,A=h[1];this.#d=[100*(y-r)/t,100*(A-o)/n];const{style:v}=this.#r;v.left=`${this.#d[0]}%`,v.top=`${this.#d[1]}%`}#S(){if(this.#e){this.#e.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#D(),this.#r.addEventListener("click",this.#a),this.#r.addEventListener("keydown",this.#t)):(this.#F(),this.#r.removeEventListener("click",this.#a),this.#r.removeEventListener("keydown",this.#t))}#D(){this.#m||this.render(),this.isVisible?this.#f&&this.#r.classList.add("focused"):(this.#k(),this.#r.hidden=!1,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)+1e3)}#F(){this.#r.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#r.hidden=!0,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)-1e3)}forceHide(){this.#_=this.isVisible,this.#_&&(this.#r.hidden=!0)}maybeShow(){this.#e||(this.#P(),this.#_&&(this.#m||this.#D(),this.#_=!1,this.#r.hidden=!1))}get isVisible(){return this.#e?!1:this.#r.hidden===!1}}class Nv extends Os{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Ci.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=this.contentElement=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class uT extends Os{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:e,width:t,height:n}=this,r=this.svgFactory.create(t,n,!0),o=this.#e=this.svgFactory.createElement("svg:line");return o.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),o.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),o.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),o.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),o.setAttribute("stroke-width",e.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class hT extends Os{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:e,width:t,height:n}=this,r=this.svgFactory.create(t,n,!0),o=e.borderStyle.width,d=this.#e=this.svgFactory.createElement("svg:rect");return d.setAttribute("x",o/2),d.setAttribute("y",o/2),d.setAttribute("width",t-o),d.setAttribute("height",n-o),d.setAttribute("stroke-width",o||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),r.append(d),this.container.append(r),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class fT extends Os{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:e,width:t,height:n}=this,r=this.svgFactory.create(t,n,!0),o=e.borderStyle.width,d=this.#e=this.svgFactory.createElement("svg:ellipse");return d.setAttribute("cx",t/2),d.setAttribute("cy",n/2),d.setAttribute("rx",t/2-o/2),d.setAttribute("ry",n/2-o/2),d.setAttribute("stroke-width",o||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),r.append(d),this.container.append(r),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Pv extends Os{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:n,popupRef:r},width:o,height:d}=this;if(!t)return this.container;const c=this.svgFactory.create(o,d,!0);let h=[];for(let m=0,y=t.length;m<y;m+=2){const A=t[m]-e[0],v=e[3]-t[m+1];h.push(`${A},${v}`)}h=h.join(" ");const f=this.#e=this.svgFactory.createElement(this.svgElementName);return f.setAttribute("points",h),f.setAttribute("stroke-width",n.width||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),c.append(f),this.container.append(c),!r&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class pT extends Pv{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class gT extends Os{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class Ly extends Os{#e=null;#t=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Ci.HIGHLIGHT:Ci.INK}#i(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:t,inkLists:n,borderStyle:r,popupRef:o}}=this,{transform:d,width:c,height:h}=this.#i(t,e),f=this.svgFactory.create(c,h,!0),m=this.#e=this.svgFactory.createElement("svg:g");f.append(m),m.setAttribute("stroke-width",r.width||1),m.setAttribute("stroke-linecap","round"),m.setAttribute("stroke-linejoin","round"),m.setAttribute("stroke-miterlimit",10),m.setAttribute("stroke","transparent"),m.setAttribute("fill","transparent"),m.setAttribute("transform",d);for(let y=0,A=n.length;y<A;y++){const v=this.svgFactory.createElement(this.svgElementName);this.#t.push(v),v.setAttribute("points",n[y].join(",")),m.append(v)}return!o&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(f),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:t,points:n,rect:r}=e,o=this.#e;if(t>=0&&o.setAttribute("stroke-width",t||1),n)for(let d=0,c=this.#t.length;d<c;d++)this.#t[d].setAttribute("points",n[d].join(","));if(r){const{transform:d,width:c,height:h}=this.#i(this.data.rotation,r);o.parentElement.setAttribute("viewBox",`0 0 ${c} ${h}`),o.setAttribute("transform",d)}}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Ev extends Os{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Ci.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class mT extends Os{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class yT extends Os{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class xT extends Os{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),e){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class Rv extends Os{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Ci.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class bT extends Os{#e=null;constructor(e){super(e,{isRenderable:!0});const{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let n;t.hasAppearance||t.fillAlpha===0?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),n.addEventListener("dblclick",this.#t.bind(this)),this.#e=n;const{isMac:r}=jo.platform;return e.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&this.#t()}),!t.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):n.classList.add("popupTriggerArea"),e.append(n),e}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class My{#e=null;#t=null;#i=null;#n=new Map;#a=null;#s=null;#r=[];#o=!1;constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:r,page:o,viewport:d,structTreeLayer:c,commentManager:h,linkService:f,annotationStorage:m}){this.div=e,this.#e=t,this.#t=n,this.#a=c||null,this.#s=f||null,this.#i=m||new jy,this.page=o,this.viewport=d,this.zIndex=0,this._annotationEditorUIManager=r,this._commentManager=h||null}hasEditableAnnotations(){return this.#n.size>0}async render(e){const{annotations:t}=e,n=this.div;kh(n,this.viewport);const r=new Map,o=[],d={data:null,layer:n,linkService:this.#s,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new s0,annotationStorage:this.#i,enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const c of t){if(c.noHTML)continue;const h=c.annotationType===ja.POPUP;if(h){const y=r.get(c.id);if(!y)continue;if(!this._commentManager){o.push(c);continue}d.elements=y}else if(c.rect[2]===c.rect[0]||c.rect[3]===c.rect[1])continue;d.data=c;const f=Om.create(d);if(!f.isRenderable)continue;if(!h&&(this.#r.push(f),c.popupRef)){const y=r.get(c.popupRef);y?y.push(f):r.set(c.popupRef,[f])}const m=f.render();c.hidden&&(m.style.visibility="hidden"),f._isEditable&&(this.#n.set(f.data.id,f),this._annotationEditorUIManager?.renderAnnotationElement(f))}await this.#c();for(const c of o){const h=d.elements=r.get(c.id);d.data=c;const f=Om.create(d);if(!f.isRenderable)continue;const m=f.render();f.contentElement.id=`${ff}${c.id}`,c.hidden&&(m.style.visibility="hidden"),h.at(-1).container.after(m)}this.#l()}async#c(){if(this.#r.length===0)return;this.div.replaceChildren();const e=[];if(!this.#o){this.#o=!0;for(const{contentElement:n,data:{id:r}}of this.#r){const o=n.id=`${ff}${r}`;e.push(this.#a?.getAriaAttributes(o).then(d=>{if(d)for(const[c,h]of d)n.setAttribute(c,h)}))}}this.#r.sort(({data:{rect:[n,r,o,d]}},{data:{rect:[c,h,f,m]}})=>{if(n===o&&r===d)return 1;if(c===f&&h===m)return-1;const y=d,A=r,v=(r+d)/2,N=m,T=h,_=(h+m)/2;if(v>=N&&_<=A)return-1;if(_>=y&&v<=T)return 1;const b=(n+o)/2,H=(c+f)/2;return b-H});const t=document.createDocumentFragment();for(const n of this.#r)t.append(n.container),this._commentManager?(n.extraPopupElement?.popup||n.popup)?.renderCommentButton():n.extraPopupElement&&t.append(n.extraPopupElement.render());if(this.div.append(t),await Promise.all(e),this.#e)for(const n of this.#r)this.#e.addPointerInTextLayer(n.contentElement,!1)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:this.#s,svgFactory:new s0,parent:this};for(const n of e){n.borderStyle||=My._defaultBorderStyle,t.data=n;const r=Om.create(t);r.isRenderable&&(r.render(),r.contentElement.id=`${ff}${n.id}`,this.#r.push(r))}await this.#c()}update({viewport:e}){const t=this.div;this.viewport=e,kh(t,{rotation:e.rotation}),this.#l(),t.hidden=!1}#l(){if(!this.#t)return;const e=this.div;for(const[t,n]of this.#t){const r=e.querySelector(`[data-annotation-id="${t}"]`);if(!r)continue;n.className="annotationContent";const{firstChild:o}=r;o?o.nodeName==="CANVAS"?o.replaceWith(n):o.classList.contains("annotationContent")?o.after(n):o.before(n):r.append(n);const d=this.#n.get(t);d&&(d._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(t,r.id,n),d._hasNoCanvas=!1):d.canvas=n)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(e){return this.#n.get(e)}addFakeAnnotation(e){const{div:t}=this,{id:n,rotation:r}=e,o=new iT({data:{id:n,rect:e.getPDFRect(),rotation:r},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:this.#s,annotationStorage:this.#i});return o.render(),o.contentElement.id=`${ff}${n}`,o.createOrUpdatePopup(),this.#r.push(o),o}removeAnnotation(e){const t=this.#r.findIndex(r=>r.data.id===e);if(t<0)return;const[n]=this.#r.splice(t,1);this.#e?.removePointerInTextLayer(n.contentElement)}updateFakeAnnotations(e){if(e.length!==0){for(const t of e)t.updateFakeAnnotationElement(this);this.#c()}}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}static get _defaultBorderStyle(){return bi(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:cf.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const Ug=/\r\n?|\n/g;class oo extends Vn{#e="";#t=`${this.id}-editor`;#i=null;#n;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=oo.prototype,t=o=>o.isEmpty(),n=Yu.TRANSLATE_SMALL,r=Yu.TRANSLATE_BIG;return bi(this,"_keyboardManager",new jp([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[n,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,n],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,r],checker:t}]]))}static _type="freetext";static _editorType=Ci.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.color=e.color||oo._defaultColor||Vn._defaultLineColor,this.#n=e.fontSize||oo._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(e,t){Vn.initialize(e,t);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case rr.FREETEXT_SIZE:oo._defaultFontSize=t;break;case rr.FREETEXT_COLOR:oo._defaultColor=t;break}}updateParams(e,t){switch(e){case rr.FREETEXT_SIZE:this.#a(t);break;case rr.FREETEXT_COLOR:this.#s(t);break}}static get defaultPropertiesToUpdate(){return[[rr.FREETEXT_SIZE,oo._defaultFontSize],[rr.FREETEXT_COLOR,oo._defaultColor||Vn._defaultLineColor]]}get propertiesToUpdate(){return[[rr.FREETEXT_SIZE,this.#n],[rr.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new wp(this),[["colorPicker",this._colorPicker]]}get colorType(){return rr.FREETEXT_COLOR}#a(e){const t=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--total-scale-factor))`,this.translate(0,-(r-this.#n)*this.parentScale),this.#n=r,this.#o()},n=this.#n;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:rr.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#s(e){const t=r=>{this.color=r,this.onUpdatedColor()},n=this.color;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:rr.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-oo._internalPadding*e,-(oo._internalPadding+this.#n)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;const e=this._uiManager.combinedSignal(this.#i);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#t),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#r(){const e=[];this.editorDiv.normalize();let t=null;for(const n of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&n.nodeName==="BR"||(e.push(oo.#c(n)),t=n);return e.join(`
`)}#o(){const[e,t]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:r,div:o}=this,d=o.style.display,c=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),n=o.getBoundingClientRect(),o.remove(),o.style.display=d,o.classList.toggle("hidden",c)}this.rotation%180===this.parentRotation%180?(this.width=n.width/e,this.height=n.height/t):(this.width=n.height/e,this.height=n.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#e,t=this.#e=this.#r().trimEnd();if(e===t)return;const n=r=>{if(this.#e=r,!r){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#o()};this.addCommands({cmd:()=>{n(t)},undo:()=>{n(e)},mustExec:!1}),this.#o()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){oo._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,t;(this._isCopy||this.annotationElementId)&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#t),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,n.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[r,o]=this.parentDimensions;if(this.annotationElementId){const{position:d}=this._initialData;let[c,h]=this.getInitialTranslation();[c,h]=this.pageTranslationToScreen(c,h);const[f,m]=this.pageDimensions,[y,A]=this.pageTranslation;let v,N;switch(this.rotation){case 0:v=e+(d[0]-y)/f,N=t+this.height-(d[1]-A)/m;break;case 90:v=e+(d[0]-y)/f,N=t-(d[1]-A)/m,[c,h]=[h,-c];break;case 180:v=e-this.width+(d[0]-y)/f,N=t-(d[1]-A)/m,[c,h]=[-c,-h];break;case 270:v=e+(d[0]-y-this.height*m)/f,N=t+(d[1]-A-this.width*f)/m,[c,h]=[-h,c];break}this.setAt(v*r,N*o,c,h)}else this._moveAfterPaste(e,t);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Ug,"")}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:n}=t;if(n.length===1&&n[0]==="text/plain")return;e.preventDefault();const r=oo.#u(t.getData("text")||"").replaceAll(Ug,`
`);if(!r)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const d=o.getRangeAt(0);if(!r.includes(`
`)){d.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:c,startOffset:h}=d,f=[],m=[];if(c.nodeType===Node.TEXT_NODE){const v=c.parentElement;if(m.push(c.nodeValue.slice(h).replaceAll(Ug,"")),v!==this.editorDiv){let N=f;for(const T of this.editorDiv.childNodes){if(T===v){N=m;continue}N.push(oo.#c(T))}}f.push(c.nodeValue.slice(0,h).replaceAll(Ug,""))}else if(c===this.editorDiv){let v=f,N=0;for(const T of this.editorDiv.childNodes)N++===h&&(v=m),v.push(oo.#c(T))}this.#e=`${f.join(`
`)}${r}${m.join(`
`)}`,this.#l();const y=new Range;let A=Math.sumPrecise(f.map(v=>v.length));for(const{firstChild:v}of this.editorDiv.childNodes)if(v.nodeType===Node.TEXT_NODE){const N=v.nodeValue.length;if(A<=N){y.setStart(v,A),y.setEnd(v,A);break}A-=N}o.removeAllRanges(),o.addRange(y)}#l(){if(this.editorDiv.replaceChildren(),!!this.#e)for(const e of this.#e.split(`
`)){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#h(){return this.#e.replaceAll(""," ")}static#u(e){return e.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const e=oo._internalPadding*this.parentScale;return this.getRect(e,e)}static async deserialize(e,t,n){let r=null;if(e instanceof Nv){const{data:{defaultAppearanceData:{fontSize:d,fontColor:c},rect:h,rotation:f,id:m,popupRef:y,richText:A,contentsObj:v,creationDate:N,modificationDate:T},textContent:_,textPosition:b,parent:{page:{pageNumber:H}}}=e;if(!_||_.length===0)return null;r=e={annotationType:Ci.FREETEXT,color:Array.from(c),fontSize:d,value:_.join(`
`),position:b,pageIndex:H-1,rect:h.slice(0),rotation:f,annotationElementId:m,id:m,deleted:!1,popupRef:y,comment:v?.str||null,richText:A,creationDate:N,modificationDate:T}}const o=await super.deserialize(e,t,n);return o.#n=e.fontSize,o.color=vn.makeHexColor(...e.color),o.#e=oo.#u(e.value),o._initialData=r,e.comment&&o.setCommentData(e),o}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const t=Vn._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),n=Object.assign(super.serialize(e),{color:t,fontSize:this.#n,value:this.#h()});return this.addComment(n),e?(n.isCopy=!0,n):this.annotationElementId&&!this.#f(n)?null:(n.id=this.annotationElementId,n)}#f(e){const{value:t,fontSize:n,color:r,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||e.value!==t||e.fontSize!==n||e.color.some((d,c)=>d!==r[c])||e.pageIndex!==o}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(!t)return null;const{style:n}=t;n.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,n.color=this.color,t.replaceChildren();for(const r of this.#e.split(`
`)){const o=document.createElement("div");o.append(r?document.createTextNode(r):document.createElement("br")),t.append(o)}return e.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#e}}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}class mn{static PRECISION=1e-4;toSVGPath(){ss("Abstract method `toSVGPath` must be implemented.")}get box(){ss("Abstract getter `box` must be implemented.")}serialize(e,t){ss("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,r,o,d){d||=new Float32Array(e.length);for(let c=0,h=e.length;c<h;c+=2)d[c]=t+e[c]*r,d[c+1]=n+e[c+1]*o;return d}static _rescaleAndSwap(e,t,n,r,o,d){d||=new Float32Array(e.length);for(let c=0,h=e.length;c<h;c+=2)d[c]=t+e[c+1]*r,d[c+1]=n+e[c]*o;return d}static _translate(e,t,n,r){r||=new Float32Array(e.length);for(let o=0,d=e.length;o<d;o+=2)r[o]=t+e[o],r[o+1]=n+e[o+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,r,o){switch(o){case 90:return[1-t/n,e/r];case 180:return[1-e/n,1-t/r];case 270:return[t/n,1-e/r];default:return[e/n,t/r]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,r,o,d){return[(e+5*n)/6,(t+5*r)/6,(5*n+o)/6,(5*r+d)/6,(n+o)/2,(r+d)/2]}}class bh{#e;#t=[];#i;#n;#a=[];#s=new Float32Array(18);#r;#o;#c;#l;#h;#u;#f=[];static#m=8;static#g=2;static#d=bh.#m+bh.#g;constructor({x:e,y:t},n,r,o,d,c=0){this.#e=n,this.#u=o*r,this.#n=d,this.#s.set([NaN,NaN,NaN,NaN,e,t],6),this.#i=c,this.#l=bh.#m*r,this.#c=bh.#d*r,this.#h=r,this.#f.push(e,t)}isEmpty(){return isNaN(this.#s[8])}#p(){const e=this.#s.subarray(4,6),t=this.#s.subarray(16,18),[n,r,o,d]=this.#e;return[(this.#r+(e[0]-t[0])/2-n)/o,(this.#o+(e[1]-t[1])/2-r)/d,(this.#r+(t[0]-e[0])/2-n)/o,(this.#o+(t[1]-e[1])/2-r)/d]}add({x:e,y:t}){this.#r=e,this.#o=t;const[n,r,o,d]=this.#e;let[c,h,f,m]=this.#s.subarray(8,12);const y=e-f,A=t-m,v=Math.hypot(y,A);if(v<this.#c)return!1;const N=v-this.#l,T=N/v,_=T*y,b=T*A;let H=c,R=h;c=f,h=m,f+=_,m+=b,this.#f?.push(e,t);const M=-b/N,B=_/N,q=M*this.#u,G=B*this.#u;return this.#s.set(this.#s.subarray(2,8),0),this.#s.set([f+q,m+G],4),this.#s.set(this.#s.subarray(14,18),12),this.#s.set([f-q,m-G],16),isNaN(this.#s[6])?(this.#a.length===0&&(this.#s.set([c+q,h+G],2),this.#a.push(NaN,NaN,NaN,NaN,(c+q-n)/o,(h+G-r)/d),this.#s.set([c-q,h-G],14),this.#t.push(NaN,NaN,NaN,NaN,(c-q-n)/o,(h-G-r)/d)),this.#s.set([H,R,c,h,f,m],6),!this.isEmpty()):(this.#s.set([H,R,c,h,f,m],6),Math.abs(Math.atan2(R-h,H-c)-Math.atan2(b,_))<Math.PI/2?([c,h,f,m]=this.#s.subarray(2,6),this.#a.push(NaN,NaN,NaN,NaN,((c+f)/2-n)/o,((h+m)/2-r)/d),[c,h,H,R]=this.#s.subarray(14,18),this.#t.push(NaN,NaN,NaN,NaN,((H+c)/2-n)/o,((R+h)/2-r)/d),!0):([H,R,c,h,f,m]=this.#s.subarray(0,6),this.#a.push(((H+5*c)/6-n)/o,((R+5*h)/6-r)/d,((5*c+f)/6-n)/o,((5*h+m)/6-r)/d,((c+f)/2-n)/o,((h+m)/2-r)/d),[f,m,c,h,H,R]=this.#s.subarray(12,18),this.#t.push(((H+5*c)/6-n)/o,((R+5*h)/6-r)/d,((5*c+f)/6-n)/o,((5*h+m)/6-r)/d,((c+f)/2-n)/o,((h+m)/2-r)/d),!0))}toSVGPath(){if(this.isEmpty())return"";const e=this.#a,t=this.#t;if(isNaN(this.#s[6])&&!this.isEmpty())return this.#y();const n=[];n.push(`M${e[4]} ${e[5]}`);for(let r=6;r<e.length;r+=6)isNaN(e[r])?n.push(`L${e[r+4]} ${e[r+5]}`):n.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);this.#x(n);for(let r=t.length-6;r>=6;r-=6)isNaN(t[r])?n.push(`L${t[r+4]} ${t[r+5]}`):n.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);return this.#b(n),n.join(" ")}#y(){const[e,t,n,r]=this.#e,[o,d,c,h]=this.#p();return`M${(this.#s[2]-e)/n} ${(this.#s[3]-t)/r} L${(this.#s[4]-e)/n} ${(this.#s[5]-t)/r} L${o} ${d} L${c} ${h} L${(this.#s[16]-e)/n} ${(this.#s[17]-t)/r} L${(this.#s[14]-e)/n} ${(this.#s[15]-t)/r} Z`}#b(e){const t=this.#t;e.push(`L${t[4]} ${t[5]} Z`)}#x(e){const[t,n,r,o]=this.#e,d=this.#s.subarray(4,6),c=this.#s.subarray(16,18),[h,f,m,y]=this.#p();e.push(`L${(d[0]-t)/r} ${(d[1]-n)/o} L${h} ${f} L${m} ${y} L${(c[0]-t)/r} ${(c[1]-n)/o}`)}newFreeDrawOutline(e,t,n,r,o,d){return new Dv(e,t,n,r,o,d)}getOutlines(){const e=this.#a,t=this.#t,n=this.#s,[r,o,d,c]=this.#e,h=new Float32Array((this.#f?.length??0)+2);for(let y=0,A=h.length-2;y<A;y+=2)h[y]=(this.#f[y]-r)/d,h[y+1]=(this.#f[y+1]-o)/c;if(h[h.length-2]=(this.#r-r)/d,h[h.length-1]=(this.#o-o)/c,isNaN(n[6])&&!this.isEmpty())return this.#T(h);const f=new Float32Array(this.#a.length+24+this.#t.length);let m=e.length;for(let y=0;y<m;y+=2){if(isNaN(e[y])){f[y]=f[y+1]=NaN;continue}f[y]=e[y],f[y+1]=e[y+1]}m=this.#w(f,m);for(let y=t.length-6;y>=6;y-=6)for(let A=0;A<6;A+=2){if(isNaN(t[y+A])){f[m]=f[m+1]=NaN,m+=2;continue}f[m]=t[y+A],f[m+1]=t[y+A+1],m+=2}return this.#A(f,m),this.newFreeDrawOutline(f,h,this.#e,this.#h,this.#i,this.#n)}#T(e){const t=this.#s,[n,r,o,d]=this.#e,[c,h,f,m]=this.#p(),y=new Float32Array(36);return y.set([NaN,NaN,NaN,NaN,(t[2]-n)/o,(t[3]-r)/d,NaN,NaN,NaN,NaN,(t[4]-n)/o,(t[5]-r)/d,NaN,NaN,NaN,NaN,c,h,NaN,NaN,NaN,NaN,f,m,NaN,NaN,NaN,NaN,(t[16]-n)/o,(t[17]-r)/d,NaN,NaN,NaN,NaN,(t[14]-n)/o,(t[15]-r)/d],0),this.newFreeDrawOutline(y,e,this.#e,this.#h,this.#i,this.#n)}#A(e,t){const n=this.#t;return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6}#w(e,t){const n=this.#s.subarray(4,6),r=this.#s.subarray(16,18),[o,d,c,h]=this.#e,[f,m,y,A]=this.#p();return e.set([NaN,NaN,NaN,NaN,(n[0]-o)/c,(n[1]-d)/h,NaN,NaN,NaN,NaN,f,m,NaN,NaN,NaN,NaN,y,A,NaN,NaN,NaN,NaN,(r[0]-o)/c,(r[1]-d)/h],t),t+=24}}class Dv extends mn{#e;#t=new Float32Array(4);#i;#n;#a;#s;#r;constructor(e,t,n,r,o,d){super(),this.#r=e,this.#a=t,this.#e=n,this.#s=r,this.#i=o,this.#n=d,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#o(d);const[c,h,f,m]=this.#t;for(let y=0,A=e.length;y<A;y+=2)e[y]=(e[y]-c)/f,e[y+1]=(e[y+1]-h)/m;for(let y=0,A=t.length;y<A;y+=2)t[y]=(t[y]-c)/f,t[y+1]=(t[y+1]-h)/m}toSVGPath(){const e=[`M${this.#r[4]} ${this.#r[5]}`];for(let t=6,n=this.#r.length;t<n;t+=6){if(isNaN(this.#r[t])){e.push(`L${this.#r[t+4]} ${this.#r[t+5]}`);continue}e.push(`C${this.#r[t]} ${this.#r[t+1]} ${this.#r[t+2]} ${this.#r[t+3]} ${this.#r[t+4]} ${this.#r[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,n,r],o){const d=n-e,c=r-t;let h,f;switch(o){case 0:h=mn._rescale(this.#r,e,r,d,-c),f=mn._rescale(this.#a,e,r,d,-c);break;case 90:h=mn._rescaleAndSwap(this.#r,e,t,d,c),f=mn._rescaleAndSwap(this.#a,e,t,d,c);break;case 180:h=mn._rescale(this.#r,n,t,-d,c),f=mn._rescale(this.#a,n,t,-d,c);break;case 270:h=mn._rescaleAndSwap(this.#r,n,r,-d,-c),f=mn._rescaleAndSwap(this.#a,n,r,-d,-c);break}return{outline:Array.from(h),points:[Array.from(f)]}}#o(e){const t=this.#r;let n=t[4],r=t[5];const o=[n,r,n,r];let d=n,c=r,h=n,f=r;const m=e?Math.max:Math.min,y=new Float32Array(4);for(let v=6,N=t.length;v<N;v+=6){const T=t[v+4],_=t[v+5];isNaN(t[v])?(vn.pointBoundingBox(T,_,o),c>_?(d=T,c=_):c===_&&(d=m(d,T)),f<_?(h=T,f=_):f===_&&(h=m(h,T))):(y[0]=y[1]=1/0,y[2]=y[3]=-1/0,vn.bezierBoundingBox(n,r,...t.slice(v,v+6),y),vn.rectBoundingBox(y[0],y[1],y[2],y[3],o),c>y[1]?(d=y[0],c=y[1]):c===y[1]&&(d=m(d,y[0])),f<y[3]?(h=y[2],f=y[3]):f===y[3]&&(h=m(h,y[2]))),n=T,r=_}const A=this.#t;A[0]=o[0]-this.#i,A[1]=o[1]-this.#i,A[2]=o[2]-o[0]+2*this.#i,A[3]=o[3]-o[1]+2*this.#i,this.firstPoint=[d,c],this.lastPoint=[h,f]}get box(){return this.#t}newOutliner(e,t,n,r,o,d=0){return new bh(e,t,n,r,o,d)}getNewOutline(e,t){const[n,r,o,d]=this.#t,[c,h,f,m]=this.#e,y=o*f,A=d*m,v=n*f+c,N=r*m+h,T=this.newOutliner({x:this.#a[0]*y+v,y:this.#a[1]*A+N},this.#e,this.#s,e,this.#n,t??this.#i);for(let _=2;_<this.#a.length;_+=2)T.add({x:this.#a[_]*y+v,y:this.#a[_+1]*A+N});return T.getOutlines()}}class fy{#e;#t;#i;#n=[];#a=[];constructor(e,t=0,n=0,r=!0){const o=[1/0,1/0,-1/0,-1/0],d=10**-4;for(const{x:T,y:_,width:b,height:H}of e){const R=Math.floor((T-t)/d)*d,M=Math.ceil((T+b+t)/d)*d,B=Math.floor((_-t)/d)*d,q=Math.ceil((_+H+t)/d)*d,G=[R,B,q,!0],X=[M,B,q,!1];this.#n.push(G,X),vn.rectBoundingBox(R,B,M,q,o)}const c=o[2]-o[0]+2*n,h=o[3]-o[1]+2*n,f=o[0]-n,m=o[1]-n;let y=r?-1/0:1/0,A=1/0;const v=this.#n.at(r?-1:-2),N=[v[0],v[2]];for(const T of this.#n){const[_,b,H,R]=T;!R&&r?b<A?(A=b,y=_):b===A&&(y=Math.max(y,_)):R&&!r&&(b<A?(A=b,y=_):b===A&&(y=Math.min(y,_))),T[0]=(_-f)/c,T[1]=(b-m)/h,T[2]=(H-m)/h}this.#e=new Float32Array([f,m,c,h]),this.#t=[y,A],this.#i=N}getOutlines(){this.#n.sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);const e=[];for(const t of this.#n)t[3]?(e.push(...this.#l(t)),this.#o(t)):(this.#c(t),e.push(...this.#l(t)));return this.#s(e)}#s(e){const t=[],n=new Set;for(const d of e){const[c,h,f]=d;t.push([c,h,d],[c,f,d])}t.sort((d,c)=>d[1]-c[1]||d[0]-c[0]);for(let d=0,c=t.length;d<c;d+=2){const h=t[d][2],f=t[d+1][2];h.push(f),f.push(h),n.add(h),n.add(f)}const r=[];let o;for(;n.size>0;){const d=n.values().next().value;let[c,h,f,m,y]=d;n.delete(d);let A=c,v=h;for(o=[c,f],r.push(o);;){let N;if(n.has(m))N=m;else if(n.has(y))N=y;else break;n.delete(N),[c,h,f,m,y]=N,A!==c&&(o.push(A,v,c,v===h?h:f),A=c),v=v===h?f:h}o.push(A,v)}return new vT(r,this.#e,this.#t,this.#i)}#r(e){const t=this.#a;let n=0,r=t.length-1;for(;n<=r;){const o=n+r>>1,d=t[o][0];if(d===e)return o;d<e?n=o+1:r=o-1}return r+1}#o([,e,t]){const n=this.#r(e);this.#a.splice(n,0,[e,t])}#c([,e,t]){const n=this.#r(e);for(let r=n;r<this.#a.length;r++){const[o,d]=this.#a[r];if(o!==e)break;if(o===e&&d===t){this.#a.splice(r,1);return}}for(let r=n-1;r>=0;r--){const[o,d]=this.#a[r];if(o!==e)break;if(o===e&&d===t){this.#a.splice(r,1);return}}}#l(e){const[t,n,r]=e,o=[[t,n,r]],d=this.#r(r);for(let c=0;c<d;c++){const[h,f]=this.#a[c];for(let m=0,y=o.length;m<y;m++){const[,A,v]=o[m];if(!(f<=A||v<=h)){if(A>=h){if(v>f)o[m][1]=f;else{if(y===1)return[];o.splice(m,1),m--,y--}continue}o[m][2]=h,v>f&&o.push([t,f,v])}}}return o}}class vT extends mn{#e;#t;constructor(e,t,n,r){super(),this.#t=e,this.#e=t,this.firstPoint=n,this.lastPoint=r}toSVGPath(){const e=[];for(const t of this.#t){let[n,r]=t;e.push(`M${n} ${r}`);for(let o=2;o<t.length;o+=2){const d=t[o],c=t[o+1];d===n?(e.push(`V${c}`),r=c):c===r&&(e.push(`H${d}`),n=d)}e.push("Z")}return e.join(" ")}serialize([e,t,n,r],o){const d=[],c=n-e,h=r-t;for(const f of this.#t){const m=new Array(f.length);for(let y=0;y<f.length;y+=2)m[y]=e+f[y]*c,m[y+1]=r-f[y+1]*h;d.push(m)}return d}get box(){return this.#e}get classNamesForOutlining(){return["highlightOutline"]}}class py extends bh{newFreeDrawOutline(e,t,n,r,o,d){return new wT(e,t,n,r,o,d)}}class wT extends Dv{newOutliner(e,t,n,r,o,d=0){return new py(e,t,n,r,o,d)}}class la extends Vn{#e=null;#t=0;#i;#n=null;#a=null;#s=null;#r=null;#o=0;#c=null;#l=null;#h=null;#u=!1;#f=null;#m=null;#g=null;#d="";#p;#y="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=Ci.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const e=la.prototype;return bi(this,"_keyboardManager",new jp([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||la._defaultColor,this.#p=e.thickness||la._defaultThickness,this.opacity=e.opacity||la._defaultOpacity,this.#i=e.boxes||null,this.#y=e.methodOfCreation||"",this.#d=e.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(this.#u=!0,this.#x(e),this.#v()):this.#i&&(this.#e=e.anchorNode,this.#t=e.anchorOffset,this.#r=e.focusNode,this.#o=e.focusOffset,this.#b(),this.#v(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#u?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#p,methodOfCreation:this.#y}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#b(){const e=new fy(this.#i,.001);this.#l=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const t=new fy(this.#i,.0025,.001,this._uiManager.direction==="ltr");this.#s=t.getOutlines();const{firstPoint:n}=this.#l;this.#f=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height];const{lastPoint:r}=this.#s;this.#m=[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height]}#x({highlightOutlines:e,highlightId:t,clipPathId:n}){this.#l=e;const r=1.5;if(this.#s=e.getNewOutline(this.#p/2+r,.0025),t>=0)this.#h=t,this.#n=n,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#g=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},!0);else if(this.parent){const y=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#h,{bbox:la.#C(this.#l.box,(y-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#g,{bbox:la.#C(this.#s.box,y),path:{d:this.#s.toSVGPath()}})}const[o,d,c,h]=e.box;switch(this.rotation){case 0:this.x=o,this.y=d,this.width=c,this.height=h;break;case 90:{const[y,A]=this.parentDimensions;this.x=d,this.y=1-o,this.width=c*A/y,this.height=h*y/A;break}case 180:this.x=1-o,this.y=1-d,this.width=c,this.height=h;break;case 270:{const[y,A]=this.parentDimensions;this.x=1-d,this.y=o,this.width=c*A/y,this.height=h*y/A;break}}const{firstPoint:f}=e;this.#f=[(f[0]-o)/c,(f[1]-d)/h];const{lastPoint:m}=this.#s;this.#m=[(m[0]-o)/c,(m[1]-d)/h]}static initialize(e,t){Vn.initialize(e,t),la._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case rr.HIGHLIGHT_COLOR:la._defaultColor=t;break;case rr.HIGHLIGHT_THICKNESS:la._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#m}get commentButtonPosition(){return this.#f}updateParams(e,t){switch(e){case rr.HIGHLIGHT_COLOR:this.#T(t);break;case rr.HIGHLIGHT_THICKNESS:this.#A(t);break}}static get defaultPropertiesToUpdate(){return[[rr.HIGHLIGHT_COLOR,la._defaultColor],[rr.HIGHLIGHT_THICKNESS,la._defaultThickness]]}get propertiesToUpdate(){return[[rr.HIGHLIGHT_COLOR,this.color||la._defaultColor],[rr.HIGHLIGHT_THICKNESS,this.#p||la._defaultThickness],[rr.HIGHLIGHT_FREE,this.#u]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#h,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#a?.updateColor(this.color),super.onUpdatedColor()}#T(e){const t=(o,d)=>{this.color=o,this.opacity=d,this.onUpdatedColor()},n=this.color,r=this.opacity;this.addCommands({cmd:t.bind(this,e,la._defaultOpacity),undo:t.bind(this,n,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:rr.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(e)},!0)}#A(e){const t=this.#p,n=r=>{this.#p=r,this.#w(r)};this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:rr.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#a=new Uc({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#N())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#N())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#_(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#v(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#_():e&&(this.#v(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#w(e){this.#u&&(this.#x({highlightOutlines:this.#l.getNewOutline(e/2)}),this.fixAndSetPosition(),this.setDims())}#_(){this.#h===null||!this.parent||(this.parent.drawLayer.remove(this.#h),this.#h=null,this.parent.drawLayer.remove(this.#g),this.#g=null)}#v(e=this.parent){this.#h===null&&({id:this.#h,clipPathId:this.#n}=e.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#u},path:{d:this.#l.toSVGPath()}},!1,!0),this.#g=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#u},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},this.#u),this.#c&&(this.#c.style.clipPath=this.#n))}static#C([e,t,n,r],o){switch(o){case 90:return[1-t-r,e,r,n];case 180:return[1-e-n,1-t-r,n,r];case 270:return[t,1-e-n,r,n]}return[e,t,n,r]}rotate(e){const{drawLayer:t}=this.parent;let n;this.#u?(e=(e-this.rotation+360)%360,n=la.#C(this.#l.box,e)):n=la.#C([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#h,{bbox:n,root:{"data-main-rotation":e}}),t.updateProperties(this.#g,{bbox:la.#C(this.#s.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();this.#d&&(e.setAttribute("aria-label",this.#d),e.setAttribute("role","mark")),this.#u?e.classList.add("free"):this.div.addEventListener("keydown",this.#P.bind(this),{signal:this._uiManager._signal});const t=this.#c=document.createElement("div");return e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#n,this.setDims(),lv(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1}})}#P(e){la._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#j(!0);break;case 1:case 3:this.#j(!1);break}}#j(e){if(!this.#e)return;const t=window.getSelection();e?t.setPosition(this.#e,this.#t):t.setPosition(this.#r,this.#o)}select(){super.select(),this.#g&&this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#g&&(this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{selected:!1}}),this.#u||this.#j(!1))}get _mustFixPosition(){return!this.#u}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#h,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#g,{rootClass:{hidden:!e}}))}#N(){return this.#u?this.rotation:0}#z(){if(this.#u)return null;const[e,t]=this.pageDimensions,[n,r]=this.pageTranslation,o=this.#i,d=new Float32Array(o.length*8);let c=0;for(const{x:h,y:f,width:m,height:y}of o){const A=h*e+n,v=(1-f)*t+r;d[c]=d[c+4]=A,d[c+1]=d[c+3]=v,d[c+2]=d[c+6]=A+m*e,d[c+5]=d[c+7]=v-y*t,c+=8}return d}#R(e){return this.#l.serialize(e,this.#N())}static startHighlighting(e,t,{target:n,x:r,y:o}){const{x:d,y:c,width:h,height:f}=n.getBoundingClientRect(),m=new AbortController,y=e.combinedSignal(m),A=v=>{m.abort(),this.#B(e,v)};window.addEventListener("blur",A,{signal:y}),window.addEventListener("pointerup",A,{signal:y}),window.addEventListener("pointerdown",Qs,{capture:!0,passive:!1,signal:y}),window.addEventListener("contextmenu",Wc,{signal:y}),n.addEventListener("pointermove",this.#L.bind(this,e),{signal:y}),this._freeHighlight=new py({x:r,y:o},[d,c,h,f],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#L(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#B(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(e,t,n){let r=null;if(e instanceof Ev){const{data:{quadPoints:N,rect:T,rotation:_,id:b,color:H,opacity:R,popupRef:M,richText:B,contentsObj:q,creationDate:G,modificationDate:X},parent:{page:{pageNumber:O}}}=e;r=e={annotationType:Ci.HIGHLIGHT,color:Array.from(H),opacity:R,quadPoints:N,boxes:null,pageIndex:O-1,rect:T.slice(0),rotation:_,annotationElementId:b,id:b,deleted:!1,popupRef:M,richText:B,comment:q?.str||null,creationDate:G,modificationDate:X}}else if(e instanceof Ly){const{data:{inkLists:N,rect:T,rotation:_,id:b,color:H,borderStyle:{rawWidth:R},popupRef:M,richText:B,contentsObj:q,creationDate:G,modificationDate:X},parent:{page:{pageNumber:O}}}=e;r=e={annotationType:Ci.HIGHLIGHT,color:Array.from(H),thickness:R,inkLists:N,boxes:null,pageIndex:O-1,rect:T.slice(0),rotation:_,annotationElementId:b,id:b,deleted:!1,popupRef:M,richText:B,comment:q?.str||null,creationDate:G,modificationDate:X}}const{color:o,quadPoints:d,inkLists:c,opacity:h}=e,f=await super.deserialize(e,t,n);f.color=vn.makeHexColor(...o),f.opacity=h||1,c&&(f.#p=e.thickness),f._initialData=r,e.comment&&f.setCommentData(e);const[m,y]=f.pageDimensions,[A,v]=f.pageTranslation;if(d){const N=f.#i=[];for(let T=0;T<d.length;T+=8)N.push({x:(d[T]-A)/m,y:1-(d[T+1]-v)/y,width:(d[T+2]-d[T])/m,height:(d[T+1]-d[T+5])/y});f.#b(),f.#v(),f.rotate(f.rotation)}else if(c){f.#u=!0;const N=c[0],T={x:N[0]-A,y:y-(N[1]-v)},_=new py(T,[0,0,m,y],1,f.#p/2,!0,.001);for(let R=0,M=N.length;R<M;R+=2)T.x=N[R]-A,T.y=y-(N[R+1]-v),_.add(T);const{id:b,clipPathId:H}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:f.color,"fill-opacity":f._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:_.toSVGPath()}},!0,!0);f.#x({highlightOutlines:_.getOutlines(),highlightId:b,clipPathId:H}),f.#v(),f.rotate(f.parentRotation)}return f}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const t=Vn._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),n=super.serialize(e);return Object.assign(n,{color:t,opacity:this.opacity,thickness:this.#p,quadPoints:this.#z(),outlines:this.#R(n.rect)}),this.addComment(n),this.annotationElementId&&!this.#M(n)?null:(n.id=this.annotationElementId,n)}#M(e){const{color:t}=this._initialData;return this.hasEditedComment||e.color.some((n,r)=>n!==t[r])}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class Lv{#e=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,n]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,n)}updateSVGProperty(e,t){this.#e[e]=t}toSVGProperties(){const e=this.#e;return this.#e=Object.create(null),{root:e}}reset(){this.#e=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){ss("Not implemented")}}class kr extends Vn{#e=null;#t;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#i=null;static#n=null;static#a=null;static _INNER_MARGIN=3;constructor(e){super(e),this.#t=e.mustBeCommitted||!1,this._addOutlines(e)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(e){e.drawOutlines&&(this.#s(e),this.#c())}#s({drawOutlines:e,drawId:t,drawingOptions:n}){this.#e=e,this._drawingOptions||=n,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),t>=0?(this._drawId=t,this.parent.drawLayer.finalizeDraw(t,e.defaultProperties)):this._drawId=this.#r(e,this.parent),this.#u(e.box)}#r(e,t){const{id:n}=t.drawLayer.draw(kr._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return n}static _mergeSVGProperties(e,t){const n=new Set(Object.keys(e));for(const[r,o]of Object.entries(t))n.has(r)?Object.assign(e[r],o):e[r]=o;return e}static getDefaultDrawingOptions(e){ss("Not implemented")}static get typesMap(){ss("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,t){const n=this.typesMap.get(e);n&&this._defaultDrawingOptions.updateProperty(n,t),this._currentParent&&(kr.#i.updateProperty(n,t),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,t){const n=this.constructor.typesMap.get(e);n&&this._updateProperty(e,n,t)}static get defaultPropertiesToUpdate(){const e=[],t=this._defaultDrawingOptions;for(const[n,r]of this.typesMap)e.push([n,t[r]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:t}=this;for(const[n,r]of this.constructor.typesMap)e.push([n,t[r]]);return e}_updateProperty(e,t,n){const r=this._drawingOptions,o=r[t],d=c=>{r.updateProperty(t,c);const h=this.#e.updateProperty(t,c);h&&this.#u(h),this.parent?.drawLayer.updateProperties(this._drawId,r.toSVGProperties()),e===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:d.bind(this,n),undo:d.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,kr._mergeSVGProperties(this.#e.getPathResizingSVGProperties(this.#h()),{bbox:this.#f()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,kr._mergeSVGProperties(this.#e.getPathResizedSVGProperties(this.#h()),{bbox:this.#f()}))}_onTranslating(e,t){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#f()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,kr._mergeSVGProperties(this.#e.getPathTranslatedSVGProperties(this.#h(),this.parentDimensions),{bbox:this.#f()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#t&&(this.#t=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#o(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#c(),this.#u(this.#e.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#o()):e&&(this._uiManager.addShouldRescale(this),this.#c(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),t&&this.select()}#o(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#c(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#r(this.#e,e)}}#l([e,t,n,r]){const{parentDimensions:[o,d],rotation:c}=this;switch(c){case 90:return[t,1-e,n*(d/o),r*(o/d)];case 180:return[1-e,1-t,n,r];case 270:return[1-t,e,n*(d/o),r*(o/d)];default:return[e,t,n,r]}}#h(){const{x:e,y:t,width:n,height:r,parentDimensions:[o,d],rotation:c}=this;switch(c){case 90:return[1-t,e,n*(o/d),r*(d/o)];case 180:return[1-e,1-t,n,r];case 270:return[t,1-e,n*(o/d),r*(d/o)];default:return[e,t,n,r]}}#u(e){[this.x,this.y,this.width,this.height]=this.#l(e),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#f(){const{x:e,y:t,width:n,height:r,rotation:o,parentRotation:d,parentDimensions:[c,h]}=this;switch((o*4+d)/90){case 1:return[1-t-r,e,r,n];case 2:return[1-e-n,1-t-r,n,r];case 3:return[t,1-e-n,r,n];case 4:return[e,t-n*(c/h),r*(h/c),n*(c/h)];case 5:return[1-t,e,n*(c/h),r*(h/c)];case 6:return[1-e-r*(h/c),1-t,r*(h/c),n*(c/h)];case 7:return[t-n*(c/h),1-e-r*(h/c),n*(c/h),r*(h/c)];case 8:return[e-n,t-r,n,r];case 9:return[1-t,e-n,r,n];case 10:return[1-e,1-t,n,r];case 11:return[t-r,1-e,r,n];case 12:return[e-r*(h/c),t,r*(h/c),n*(c/h)];case 13:return[1-t-n*(c/h),e-r*(h/c),n*(c/h),r*(h/c)];case 14:return[1-e,1-t-n*(c/h),r*(h/c),n*(c/h)];case 15:return[t,1-e,n*(c/h),r*(h/c)];default:return[e,t,n,r]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,kr._mergeSVGProperties({bbox:this.#f()},this.#e.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#u(this.#e.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,t;this._isCopy&&(e=this.x,t=this.y);const n=super.render();n.classList.add("draw");const r=document.createElement("div");return n.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,t),n}static createDrawerInstance(e,t,n,r,o){ss("Not implemented")}static startDrawing(e,t,n,r){const{target:o,offsetX:d,offsetY:c,pointerId:h,pointerType:f}=r;if(_r.isInitializedAndDifferentPointerType(f))return;const{viewport:{rotation:m}}=e,{width:y,height:A}=o.getBoundingClientRect(),v=kr.#n=new AbortController,N=e.combinedSignal(v);if(_r.setPointer(f,h),window.addEventListener("pointerup",T=>{_r.isSamePointerIdOrRemove(T.pointerId)&&this._endDraw(T)},{signal:N}),window.addEventListener("pointercancel",T=>{_r.isSamePointerIdOrRemove(T.pointerId)&&this._currentParent.endDrawingSession()},{signal:N}),window.addEventListener("pointerdown",T=>{_r.isSamePointerType(T.pointerType)&&(_r.initializeAndAddPointerId(T.pointerId),kr.#i.isCancellable()&&(kr.#i.removeLastElement(),kr.#i.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:N}),window.addEventListener("contextmenu",Wc,{signal:N}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:N}),o.addEventListener("touchmove",T=>{_r.isSameTimeStamp(T.timeStamp)&&Qs(T)},{signal:N}),e.toggleDrawing(),t._editorUndoBar?.hide(),kr.#i){e.drawLayer.updateProperties(this._currentDrawId,kr.#i.startNew(d,c,y,A,m));return}t.updateUIForDefaultProperties(this),kr.#i=this.createDrawerInstance(d,c,y,A,m),kr.#a=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(kr.#a.toSVGProperties(),kr.#i.defaultSVGProperties),!0,!1)}static _drawMove(e){if(_r.isSameTimeStamp(e.timeStamp),!kr.#i)return;const{offsetX:t,offsetY:n,pointerId:r}=e;if(_r.isSamePointerId(r)){if(_r.isUsingMultiplePointers()){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,kr.#i.add(t,n)),_r.setTimeStamp(e.timeStamp),Qs(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,kr.#i=null,kr.#a=null,_r.clearPointerType(),_r.clearTimeStamp()),kr.#n&&(kr.#n.abort(),kr.#n=null,_r.clearPointerIds())}static _endDraw(e){const t=this._currentParent;if(t){if(t.toggleDrawing(!0),this._cleanup(!1),e?.target===t.div&&t.drawLayer.updateProperties(this._currentDrawId,kr.#i.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const n=kr.#i,r=this._currentDrawId,o=n.getLastElement();t.addCommands({cmd:()=>{t.drawLayer.updateProperties(r,n.setLastElement(o))},undo:()=>{t.drawLayer.updateProperties(r,n.removeLastElement())},mustExec:!1,type:rr.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const t=this._currentParent;if(!t)return null;if(t.toggleDrawing(!0),t.cleanUndoStack(rr.DRAW_STEP),!kr.#i.isEmpty()){const{pageDimensions:[n,r],scale:o}=t,d=t.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:kr.#i.getOutlines(n*o,r*o,o,this._INNER_MARGIN),drawingOptions:kr.#a,mustBeCommitted:!e});return this._cleanup(!0),d}return t.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,t,n,r,o,d){ss("Not implemented")}static async deserialize(e,t,n){const{rawDims:{pageWidth:r,pageHeight:o,pageX:d,pageY:c}}=t.viewport,h=this.deserializeDraw(d,c,r,o,this._INNER_MARGIN,e),f=await super.deserialize(e,t,n);return f.createDrawingOptions(e),f.#s({drawOutlines:h}),f.#c(),f.onScaleChanging(),f.rotate(),f}serializeDraw(e){const[t,n]=this.pageTranslation,[r,o]=this.pageDimensions;return this.#e.serialize([t,n,r,o],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class ST{#e=new Float64Array(6);#t;#i;#n;#a;#s;#r="";#o=0;#c=new Pp;#l;#h;constructor(e,t,n,r,o,d){this.#l=n,this.#h=r,this.#n=o,this.#a=d,[e,t]=this.#u(e,t);const c=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#s=[e,t],this.#i=[{line:c,points:this.#s}],this.#e.set(c,0)}updateProperty(e,t){e==="stroke-width"&&(this.#a=t)}#u(e,t){return mn._normalizePoint(e,t,this.#l,this.#h,this.#n)}isEmpty(){return!this.#i||this.#i.length===0}isCancellable(){return this.#s.length<=10}add(e,t){[e,t]=this.#u(e,t);const[n,r,o,d]=this.#e.subarray(2,6),c=e-o,h=t-d;return Math.hypot(this.#l*c,this.#h*h)<=2?null:(this.#s.push(e,t),isNaN(n)?(this.#e.set([o,d,e,t],2),this.#t.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#e[0])&&this.#t.splice(6,6),this.#e.set([n,r,o,d,e,t],0),this.#t.push(...mn.createBezierPoints(n,r,o,d,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const n=this.add(e,t);return n||(this.#s.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,r,o){this.#l=n,this.#h=r,this.#n=o,[e,t]=this.#u(e,t);const d=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#s=[e,t];const c=this.#i.at(-1);return c&&(c.line=new Float32Array(c.line),c.points=new Float32Array(c.points)),this.#i.push({line:d,points:this.#s}),this.#e.set(d,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#i.at(-1)}setLastElement(e){return this.#i?(this.#i.push(e),this.#t=e.line,this.#s=e.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(e)}removeLastElement(){if(!this.#i)return this.#c.removeLastElement();this.#i.pop(),this.#r="";for(let e=0,t=this.#i.length;e<t;e++){const{line:n,points:r}=this.#i[e];this.#t=n,this.#s=r,this.#o=0,this.toSVGPath()}return{path:{d:this.#r}}}toSVGPath(){const e=mn.svgRound(this.#t[4]),t=mn.svgRound(this.#t[5]);if(this.#s.length===2)return this.#r=`${this.#r} M ${e} ${t} Z`,this.#r;if(this.#s.length<=6){const r=this.#r.lastIndexOf("M");this.#r=`${this.#r.slice(0,r)} M ${e} ${t}`,this.#o=6}if(this.#s.length===4){const r=mn.svgRound(this.#t[10]),o=mn.svgRound(this.#t[11]);return this.#r=`${this.#r} L ${r} ${o}`,this.#o=12,this.#r}const n=[];this.#o===0&&(n.push(`M ${e} ${t}`),this.#o=6);for(let r=this.#o,o=this.#t.length;r<o;r+=6){const[d,c,h,f,m,y]=this.#t.slice(r,r+6).map(mn.svgRound);n.push(`C${d} ${c} ${h} ${f} ${m} ${y}`)}return this.#r+=n.join(" "),this.#o=this.#t.length,this.#r}getOutlines(e,t,n,r){const o=this.#i.at(-1);return o.line=new Float32Array(o.line),o.points=new Float32Array(o.points),this.#c.build(this.#i,e,t,n,this.#n,this.#a,r),this.#e=null,this.#t=null,this.#i=null,this.#r=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Pp extends mn{#e;#t=0;#i;#n;#a;#s;#r;#o;#c;build(e,t,n,r,o,d,c){this.#a=t,this.#s=n,this.#r=r,this.#o=o,this.#c=d,this.#i=c??0,this.#n=e,this.#u()}get thickness(){return this.#c}setLastElement(e){return this.#n.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#n.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:t}of this.#n){if(e.push(`M${mn.svgRound(t[4])} ${mn.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12&&isNaN(t[6])){e.push(`L${mn.svgRound(t[10])} ${mn.svgRound(t[11])}`);continue}for(let n=6,r=t.length;n<r;n+=6){const[o,d,c,h,f,m]=t.subarray(n,n+6).map(mn.svgRound);e.push(`C${o} ${d} ${c} ${h} ${f} ${m}`)}}return e.join("")}serialize([e,t,n,r],o){const d=[],c=[],[h,f,m,y]=this.#h();let A,v,N,T,_,b,H,R,M;switch(this.#o){case 0:M=mn._rescale,A=e,v=t+r,N=n,T=-r,_=e+h*n,b=t+(1-f-y)*r,H=e+(h+m)*n,R=t+(1-f)*r;break;case 90:M=mn._rescaleAndSwap,A=e,v=t,N=n,T=r,_=e+f*n,b=t+h*r,H=e+(f+y)*n,R=t+(h+m)*r;break;case 180:M=mn._rescale,A=e+n,v=t,N=-n,T=r,_=e+(1-h-m)*n,b=t+f*r,H=e+(1-h)*n,R=t+(f+y)*r;break;case 270:M=mn._rescaleAndSwap,A=e+n,v=t+r,N=-n,T=-r,_=e+(1-f-y)*n,b=t+(1-h-m)*r,H=e+(1-f)*n,R=t+(1-h)*r;break}for(const{line:B,points:q}of this.#n)d.push(M(B,A,v,N,T,o?new Array(B.length):null)),c.push(M(q,A,v,N,T,o?new Array(q.length):null));return{lines:d,points:c,rect:[_,b,H,R]}}static deserialize(e,t,n,r,o,{paths:{lines:d,points:c},rotation:h,thickness:f}){const m=[];let y,A,v,N,T;switch(h){case 0:T=mn._rescale,y=-e/n,A=t/r+1,v=1/n,N=-1/r;break;case 90:T=mn._rescaleAndSwap,y=-t/r,A=-e/n,v=1/r,N=1/n;break;case 180:T=mn._rescale,y=e/n+1,A=-t/r,v=-1/n,N=1/r;break;case 270:T=mn._rescaleAndSwap,y=t/r+1,A=e/n+1,v=-1/r,N=-1/n;break}if(!d){d=[];for(const b of c){const H=b.length;if(H===2){d.push(new Float32Array([NaN,NaN,NaN,NaN,b[0],b[1]]));continue}if(H===4){d.push(new Float32Array([NaN,NaN,NaN,NaN,b[0],b[1],NaN,NaN,NaN,NaN,b[2],b[3]]));continue}const R=new Float32Array(3*(H-2));d.push(R);let[M,B,q,G]=b.subarray(0,4);R.set([NaN,NaN,NaN,NaN,M,B],0);for(let X=4;X<H;X+=2){const O=b[X],Y=b[X+1];R.set(mn.createBezierPoints(M,B,q,G,O,Y),(X-2)*3),[M,B,q,G]=[q,G,O,Y]}}}for(let b=0,H=d.length;b<H;b++)m.push({line:T(d[b].map(R=>R??NaN),y,A,v,N),points:T(c[b].map(R=>R??NaN),y,A,v,N)});const _=new this.prototype.constructor;return _.build(m,n,r,1,h,f,o),_}#l(e=this.#c){const t=this.#i+e/2*this.#r;return this.#o%180===0?[t/this.#a,t/this.#s]:[t/this.#s,t/this.#a]}#h(){const[e,t,n,r]=this.#e,[o,d]=this.#l(0);return[e+o,t+d,n-2*o,r-2*d]}#u(){const e=this.#e=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:r}of this.#n){if(r.length<=12){for(let c=4,h=r.length;c<h;c+=6)vn.pointBoundingBox(r[c],r[c+1],e);continue}let o=r[4],d=r[5];for(let c=6,h=r.length;c<h;c+=6){const[f,m,y,A,v,N]=r.subarray(c,c+6);vn.bezierBoundingBox(o,d,f,m,y,A,v,N,e),o=v,d=N}}const[t,n]=this.#l();e[0]=Sl(e[0]-t,0,1),e[1]=Sl(e[1]-n,0,1),e[2]=Sl(e[2]+t,0,1),e[3]=Sl(e[3]+n,0,1),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#e}updateProperty(e,t){return e==="stroke-width"?this.#f(t):null}#f(e){const[t,n]=this.#l();this.#c=e;const[r,o]=this.#l(),[d,c]=[r-t,o-n],h=this.#e;return h[0]-=d,h[1]-=c,h[2]+=2*d,h[3]+=2*c,h}updateParentDimensions([e,t],n){const[r,o]=this.#l();this.#a=e,this.#s=t,this.#r=n;const[d,c]=this.#l(),h=d-r,f=c-o,m=this.#e;return m[0]-=h,m[1]-=f,m[2]+=2*h,m[3]+=2*f,m}updateRotation(e){return this.#t=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#e.map(mn.svgRound).join(" ")}get defaultProperties(){const[e,t]=this.#e;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${mn.svgRound(e)} ${mn.svgRound(t)}`}}}get rotationTransform(){const[,,e,t]=this.#e;let n=0,r=0,o=0,d=0,c=0,h=0;switch(this.#t){case 90:r=t/e,o=-e/t,c=e;break;case 180:n=-1,d=-1,c=e,h=t;break;case 270:r=-t/e,o=e/t,h=t;break;default:return""}return`matrix(${n} ${r} ${o} ${d} ${mn.svgRound(c)} ${mn.svgRound(h)})`}getPathResizingSVGProperties([e,t,n,r]){const[o,d]=this.#l(),[c,h,f,m]=this.#e;if(Math.abs(f-o)<=mn.PRECISION||Math.abs(m-d)<=mn.PRECISION){const T=e+n/2-(c+f/2),_=t+r/2-(h+m/2);return{path:{"transform-origin":`${mn.svgRound(e)} ${mn.svgRound(t)}`,transform:`${this.rotationTransform} translate(${T} ${_})`}}}const y=(n-2*o)/(f-2*o),A=(r-2*d)/(m-2*d),v=f/n,N=m/r;return{path:{"transform-origin":`${mn.svgRound(c)} ${mn.svgRound(h)}`,transform:`${this.rotationTransform} scale(${v} ${N}) translate(${mn.svgRound(o)} ${mn.svgRound(d)}) scale(${y} ${A}) translate(${mn.svgRound(-o)} ${mn.svgRound(-d)})`}}}getPathResizedSVGProperties([e,t,n,r]){const[o,d]=this.#l(),c=this.#e,[h,f,m,y]=c;if(c[0]=e,c[1]=t,c[2]=n,c[3]=r,Math.abs(m-o)<=mn.PRECISION||Math.abs(y-d)<=mn.PRECISION){const _=e+n/2-(h+m/2),b=t+r/2-(f+y/2);for(const{line:H,points:R}of this.#n)mn._translate(H,_,b,H),mn._translate(R,_,b,R);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${mn.svgRound(e)} ${mn.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const A=(n-2*o)/(m-2*o),v=(r-2*d)/(y-2*d),N=-A*(h+o)+e+o,T=-v*(f+d)+t+d;if(A!==1||v!==1||N!==0||T!==0)for(const{line:_,points:b}of this.#n)mn._rescale(_,N,T,A,v,_),mn._rescale(b,N,T,A,v,b);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${mn.svgRound(e)} ${mn.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],n){const[r,o]=n,d=this.#e,c=e-d[0],h=t-d[1];if(this.#a===r&&this.#s===o)for(const{line:f,points:m}of this.#n)mn._translate(f,c,h,f),mn._translate(m,c,h,m);else{const f=this.#a/r,m=this.#s/o;this.#a=r,this.#s=o;for(const{line:y,points:A}of this.#n)mn._rescale(y,c,h,f,m,y),mn._rescale(A,c,h,f,m,A);d[2]*=f,d[3]*=m}return d[0]=e,d[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${mn.svgRound(e)} ${mn.svgRound(t)}`}}}get defaultSVGProperties(){const e=this.#e;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${mn.svgRound(e[0])} ${mn.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}class m0 extends Lv{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:Vn._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new m0(this._viewParameters);return e.updateAll(this),e}}class Iy extends kr{static _type="ink";static _editorType=Ci.INK;static _defaultDrawingOptions=null;constructor(e){super({...e,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,t){Vn.initialize(e,t),this._defaultDrawingOptions=new m0(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return bi(this,"typesMap",new Map([[rr.INK_THICKNESS,"stroke-width"],[rr.INK_COLOR,"stroke"],[rr.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,n,r,o){return new ST(e,t,n,r,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,n,r,o,d){return Pp.deserialize(e,t,n,r,o,d)}static async deserialize(e,t,n){let r=null;if(e instanceof Ly){const{data:{inkLists:d,rect:c,rotation:h,id:f,color:m,opacity:y,borderStyle:{rawWidth:A},popupRef:v,richText:N,contentsObj:T,creationDate:_,modificationDate:b},parent:{page:{pageNumber:H}}}=e;r=e={annotationType:Ci.INK,color:Array.from(m),thickness:A,opacity:y,paths:{points:d},boxes:null,pageIndex:H-1,rect:c.slice(0),rotation:h,annotationElementId:f,id:f,deleted:!1,popupRef:v,richText:N,comment:T?.str||null,creationDate:_,modificationDate:b}}const o=await super.deserialize(e,t,n);return o._initialData=r,e.comment&&o.setCommentData(e),o}get toolbarButtons(){return this._colorPicker||=new wp(this),[["colorPicker",this._colorPicker]]}get colorType(){return rr.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:t,parent:n}=this;t.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:n}){this._drawingOptions=Iy.getDefaultDrawingOptions({stroke:vn.makeHexColor(...e),"stroke-width":t,"stroke-opacity":n})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:t,points:n}=this.serializeDraw(e),{_drawingOptions:{stroke:r,"stroke-opacity":o,"stroke-width":d}}=this,c=Object.assign(super.serialize(e),{color:Vn._colorManager.convert(r),opacity:o,thickness:d,paths:{lines:t,points:n}});return this.addComment(c),e?(c.isCopy=!0,c):this.annotationElementId&&!this.#e(c)?null:(c.id=this.annotationElementId,c)}#e(e){const{color:t,thickness:n,opacity:r,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||e.color.some((d,c)=>d!==t[c])||e.thickness!==n||e.opacity!==r||e.pageIndex!==o}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;const{points:t,rect:n}=this.serializeDraw(!1);return e.updateEdited({rect:n,thickness:this._drawingOptions["stroke-width"],points:t,popup:this.comment}),null}}class gy extends Pp{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const Hg=8,op=3;class uf{static#e={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#t(e,t,n,r){return n-=e,r-=t,n===0?r>0?0:4:n===1?r+6:2-r}static#i=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#n(e,t,n,r,o,d,c){const h=this.#t(n,r,o,d);for(let f=0;f<8;f++){const m=(-f+h-c+16)%8,y=this.#i[2*m],A=this.#i[2*m+1];if(e[(n+y)*t+(r+A)]!==0)return m}return-1}static#a(e,t,n,r,o,d,c){const h=this.#t(n,r,o,d);for(let f=0;f<8;f++){const m=(f+h+c+16)%8,y=this.#i[2*m],A=this.#i[2*m+1];if(e[(n+y)*t+(r+A)]!==0)return m}return-1}static#s(e,t,n,r){const o=e.length,d=new Int32Array(o);for(let m=0;m<o;m++)d[m]=e[m]<=r?1:0;for(let m=1;m<n-1;m++)d[m*t]=d[m*t+t-1]=0;for(let m=0;m<t;m++)d[m]=d[t*n-1-m]=0;let c=1,h;const f=[];for(let m=1;m<n-1;m++){h=1;for(let y=1;y<t-1;y++){const A=m*t+y,v=d[A];if(v===0)continue;let N=m,T=y;if(v===1&&d[A-1]===0)c+=1,T-=1;else if(v>=1&&d[A+1]===0)c+=1,T+=1,v>1&&(h=v);else{v!==1&&(h=Math.abs(v));continue}const _=[y,m],b=T===y+1,H={isHole:b,points:_,id:c,parent:0};f.push(H);let R;for(const W of f)if(W.id===h){R=W;break}R?R.isHole?H.parent=b?R.parent:h:H.parent=b?h:R.parent:H.parent=b?h:0;const M=this.#n(d,t,m,y,N,T,0);if(M===-1){d[A]=-c,d[A]!==1&&(h=Math.abs(d[A]));continue}let B=this.#i[2*M],q=this.#i[2*M+1];const G=m+B,X=y+q;N=G,T=X;let O=m,Y=y;for(;;){const W=this.#a(d,t,O,Y,N,T,1);B=this.#i[2*W],q=this.#i[2*W+1];const I=O+B,J=Y+q;_.push(J,I);const Z=O*t+Y;if(d[Z+1]===0?d[Z]=-c:d[Z]===1&&(d[Z]=c),I===m&&J===y&&O===G&&Y===X){d[A]!==1&&(h=Math.abs(d[A]));break}else N=O,T=Y,O=I,Y=J}}}return f}static#r(e,t,n,r){if(n-t<=4){for(let G=t;G<n-2;G+=2)r.push(e[G],e[G+1]);return}const o=e[t],d=e[t+1],c=e[n-4]-o,h=e[n-3]-d,f=Math.hypot(c,h),m=c/f,y=h/f,A=m*d-y*o,v=h/c,N=1/f,T=Math.atan(v),_=Math.cos(T),b=Math.sin(T),H=N*(Math.abs(_)+Math.abs(b)),R=N*(1-H+H**2),M=Math.max(Math.atan(Math.abs(b+_)*R),Math.atan(Math.abs(b-_)*R));let B=0,q=t;for(let G=t+2;G<n-2;G+=2){const X=Math.abs(A-m*e[G+1]+y*e[G]);X>B&&(q=G,B=X)}B>(f*M)**2?(this.#r(e,t,q+2,r),this.#r(e,q,n,r)):r.push(o,d)}static#o(e){const t=[],n=e.length;return this.#r(e,0,n,t),t.push(e[n-2],e[n-1]),t.length<=4?null:t}static#c(e,t,n,r,o,d){const c=new Float32Array(d**2),h=-2*r**2,f=d>>1;for(let T=0;T<d;T++){const _=(T-f)**2;for(let b=0;b<d;b++)c[T*d+b]=Math.exp((_+(b-f)**2)/h)}const m=new Float32Array(256),y=-2*o**2;for(let T=0;T<256;T++)m[T]=Math.exp(T**2/y);const A=e.length,v=new Uint8Array(A),N=new Uint32Array(256);for(let T=0;T<n;T++)for(let _=0;_<t;_++){const b=T*t+_,H=e[b];let R=0,M=0;for(let q=0;q<d;q++){const G=T+q-f;if(!(G<0||G>=n))for(let X=0;X<d;X++){const O=_+X-f;if(O<0||O>=t)continue;const Y=e[G*t+O],W=c[q*d+X]*m[Math.abs(Y-H)];R+=Y*W,M+=W}}const B=v[b]=Math.round(R/M);N[B]++}return[v,N]}static#l(e){const t=new Uint32Array(256);for(const n of e)t[n]++;return t}static#h(e){const t=e.length,n=new Uint8ClampedArray(t>>2);let r=-1/0,o=1/0;for(let c=0,h=n.length;c<h;c++){const f=n[c]=e[c<<2];r=Math.max(r,f),o=Math.min(o,f)}const d=255/(r-o);for(let c=0,h=n.length;c<h;c++)n[c]=(n[c]-o)*d;return n}static#u(e){let t,n=-1/0,r=-1/0;const o=e.findIndex(h=>h!==0);let d=o,c=o;for(t=o;t<256;t++){const h=e[t];h>n&&(t-d>r&&(r=t-d,c=t-1),n=h,d=t)}for(t=c-1;t>=0&&!(e[t]>e[t+1]);t--);return t}static#f(e){const t=e,{width:n,height:r}=e,{maxDim:o}=this.#e;let d=n,c=r;if(n>o||r>o){let A=n,v=r,N=Math.log2(Math.max(n,r)/o);const T=Math.floor(N);N=N===T?T-1:T;for(let b=0;b<N;b++){d=Math.ceil(A/2),c=Math.ceil(v/2);const H=new OffscreenCanvas(d,c);H.getContext("2d").drawImage(e,0,0,A,v,0,0,d,c),A=d,v=c,e!==t&&e.close(),e=H.transferToImageBitmap()}const _=Math.min(o/d,o/c);d=Math.round(d*_),c=Math.round(c*_)}const f=new OffscreenCanvas(d,c).getContext("2d",{willReadFrequently:!0});f.fillStyle="white",f.fillRect(0,0,d,c),f.filter="grayscale(1)",f.drawImage(e,0,0,e.width,e.height,0,0,d,c);const m=f.getImageData(0,0,d,c).data;return[this.#h(m),d,c]}static extractContoursFromText(e,{fontFamily:t,fontStyle:n,fontWeight:r},o,d,c,h){let f=new OffscreenCanvas(1,1),m=f.getContext("2d",{alpha:!1});const y=200,A=m.font=`${n} ${r} ${y}px ${t}`,{actualBoundingBoxLeft:v,actualBoundingBoxRight:N,actualBoundingBoxAscent:T,actualBoundingBoxDescent:_,fontBoundingBoxAscent:b,fontBoundingBoxDescent:H,width:R}=m.measureText(e),M=1.5,B=Math.ceil(Math.max(Math.abs(v)+Math.abs(N)||0,R)*M),q=Math.ceil(Math.max(Math.abs(T)+Math.abs(_)||y,Math.abs(b)+Math.abs(H)||y)*M);f=new OffscreenCanvas(B,q),m=f.getContext("2d",{alpha:!0,willReadFrequently:!0}),m.font=A,m.filter="grayscale(1)",m.fillStyle="white",m.fillRect(0,0,B,q),m.fillStyle="black",m.fillText(e,B*(M-1)/2,q*(3-M)/2);const G=this.#h(m.getImageData(0,0,B,q).data),X=this.#l(G),O=this.#u(X),Y=this.#s(G,B,q,O);return this.processDrawnLines({lines:{curves:Y,width:B,height:q},pageWidth:o,pageHeight:d,rotation:c,innerMargin:h,mustSmooth:!0,areContours:!0})}static process(e,t,n,r,o){const[d,c,h]=this.#f(e),[f,m]=this.#c(d,c,h,Math.hypot(c,h)*this.#e.sigmaSFactor,this.#e.sigmaR,this.#e.kernelSize),y=this.#u(m),A=this.#s(f,c,h,y);return this.processDrawnLines({lines:{curves:A,width:c,height:h},pageWidth:t,pageHeight:n,rotation:r,innerMargin:o,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:r,innerMargin:o,mustSmooth:d,areContours:c}){r%180!==0&&([t,n]=[n,t]);const{curves:h,width:f,height:m}=e,y=e.thickness??0,A=[],v=Math.min(t/f,n/m),N=v/t,T=v/n,_=[];for(const{points:H}of h){const R=d?this.#o(H):H;if(!R)continue;_.push(R);const M=R.length,B=new Float32Array(M),q=new Float32Array(3*(M===2?2:M-2));if(A.push({line:q,points:B}),M===2){B[0]=R[0]*N,B[1]=R[1]*T,q.set([NaN,NaN,NaN,NaN,B[0],B[1]],0);continue}let[G,X,O,Y]=R;G*=N,X*=T,O*=N,Y*=T,B.set([G,X,O,Y],0),q.set([NaN,NaN,NaN,NaN,G,X],0);for(let W=4;W<M;W+=2){const I=B[W]=R[W]*N,J=B[W+1]=R[W+1]*T;q.set(mn.createBezierPoints(G,X,O,Y,I,J),(W-2)*3),[G,X,O,Y]=[O,Y,I,J]}}if(A.length===0)return null;const b=c?new gy:new Pp;return b.build(A,t,n,1,r,c?0:y,o),{outline:b,newCurves:_,areContours:c,thickness:y,width:f,height:m}}static async compressSignature({outlines:e,areContours:t,thickness:n,width:r,height:o}){let d=1/0,c=-1/0,h=0;for(const R of e){h+=R.length;for(let M=2,B=R.length;M<B;M++){const q=R[M]-R[M-2];d=Math.min(d,q),c=Math.max(c,q)}}let f;d>=-128&&c<=127?f=Int8Array:d>=-32768&&c<=32767?f=Int16Array:f=Int32Array;const m=e.length,y=Hg+op*m,A=new Uint32Array(y);let v=0;A[v++]=y*Uint32Array.BYTES_PER_ELEMENT+(h-2*m)*f.BYTES_PER_ELEMENT,A[v++]=0,A[v++]=r,A[v++]=o,A[v++]=t?0:1,A[v++]=Math.max(0,Math.floor(n??0)),A[v++]=m,A[v++]=f.BYTES_PER_ELEMENT;for(const R of e)A[v++]=R.length-2,A[v++]=R[0],A[v++]=R[1];const N=new CompressionStream("deflate-raw"),T=N.writable.getWriter();await T.ready,T.write(A);const _=f.prototype.constructor;for(const R of e){const M=new _(R.length-2);for(let B=2,q=R.length;B<q;B++)M[B-2]=R[B]-R[B-2];T.write(M)}T.close();const b=await new Response(N.readable).arrayBuffer(),H=new Uint8Array(b);return rv(H)}static async decompressSignature(e){try{const t=FC(e),{readable:n,writable:r}=new DecompressionStream("deflate-raw"),o=r.getWriter();await o.ready,o.write(t).then(async()=>{await o.ready,await o.close()}).catch(()=>{});let d=null,c=0;for await(const R of n)d||=new Uint8Array(new Uint32Array(R.buffer,0,4)[0]),d.set(R,c),c+=R.length;const h=new Uint32Array(d.buffer,0,d.length>>2),f=h[1];if(f!==0)throw new Error(`Invalid version: ${f}`);const m=h[2],y=h[3],A=h[4]===0,v=h[5],N=h[6],T=h[7],_=[],b=(Hg+op*N)*Uint32Array.BYTES_PER_ELEMENT;let H;switch(T){case Int8Array.BYTES_PER_ELEMENT:H=new Int8Array(d.buffer,b);break;case Int16Array.BYTES_PER_ELEMENT:H=new Int16Array(d.buffer,b);break;case Int32Array.BYTES_PER_ELEMENT:H=new Int32Array(d.buffer,b);break}c=0;for(let R=0;R<N;R++){const M=h[op*R+Hg],B=new Float32Array(M+2);_.push(B);for(let q=0;q<op-1;q++)B[q]=h[op*R+Hg+q+1];for(let q=0;q<M;q++)B[q+2]=B[q]+H[c++]}return{areContours:A,thickness:v,outlines:_,width:m,height:y}}catch(t){return xi(`decompressSignature: ${t}`),null}}}class zy extends Lv{constructor(){super(),super.updateProperties({fill:Vn._defaultLineColor,"stroke-width":0})}clone(){const e=new zy;return e.updateAll(this),e}}class By extends m0{constructor(e){super(e),super.updateProperties({stroke:Vn._defaultLineColor,"stroke-width":1})}clone(){const e=new By(this._viewParameters);return e.updateAll(this),e}}class Dd extends kr{#e=!1;#t=null;#i=null;#n=null;static _type="signature";static _editorType=Ci.SIGNATURE;static _defaultDrawingOptions=null;constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#i=e.signatureData||null,this.#t=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,t){Vn.initialize(e,t),this._defaultDrawingOptions=new zy,this._defaultDrawnSignatureOptions=new By(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!1}static get typesMap(){return bi(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#t}}static computeTelemetryFinalData(e){const t=e.get("hasDescription");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,t;const{_isCopy:n}=this;if(n&&(this._isCopy=!1,e=this.x,t=this.y),super.render(),this._drawId===null)if(this.#i){const{lines:r,mustSmooth:o,areContours:d,description:c,uuid:h,heightInPage:f}=this.#i,{rawDims:{pageWidth:m,pageHeight:y},rotation:A}=this.parent.viewport,v=uf.processDrawnLines({lines:r,pageWidth:m,pageHeight:y,rotation:A,innerMargin:Dd._INNER_MARGIN,mustSmooth:o,areContours:d});this.addSignature(v,f,c,h)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#t||""}));return n&&(this._isCopy=!0,this._moveAfterPaste(e,t)),this.div}setUuid(e){this.#n=e,this.addEditToolbar()}getUuid(){return this.#n}get description(){return this.#t}set description(e){this.#t=e,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:e})),super.addEditToolbar().then(t=>{t?.updateEditSignatureButton(e)}))}getSignaturePreview(){const{newCurves:e,areContours:t,thickness:n,width:r,height:o}=this.#i,d=Math.max(r,o),c=uf.processDrawnLines({lines:{curves:e.map(h=>({points:h})),thickness:n,width:r,height:o},pageWidth:d,pageHeight:d,rotation:0,innerMargin:0,mustSmooth:!1,areContours:t});return{areContours:t,outline:c.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,t,n,r){const{x:o,y:d}=this,{outline:c}=this.#i=e;this.#e=c instanceof gy,this.description=n;let h;this.#e?h=Dd.getDefaultDrawingOptions():(h=Dd._defaultDrawnSignatureOptions.clone(),h.updateProperties({"stroke-width":c.thickness})),this._addOutlines({drawOutlines:c,drawingOptions:h});const[,f]=this.pageDimensions;let m=t/f;m=m>=1?.5:m,this.width*=m/this.height,this.width>=1&&(m*=.9/this.width,this.width=.9),this.height=m,this.setDims(),this.x=o,this.y=d,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(r),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!r,hasDescription:!!n}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:t,pageHeight:n},rotation:r}=this.parent.viewport;return uf.process(e,t,n,r,Dd._INNER_MARGIN)}getFromText(e,t){const{rawDims:{pageWidth:n,pageHeight:r},rotation:o}=this.parent.viewport;return uf.extractContoursFromText(e,t,n,r,o,Dd._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:t,pageHeight:n},rotation:r}=this.parent.viewport;return uf.processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:r,innerMargin:Dd._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:t}){e?this._drawingOptions=Dd.getDefaultDrawingOptions():(this._drawingOptions=Dd._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":t}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:t,points:n}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":r}}=this,o=Object.assign(super.serialize(e),{isSignature:!0,areContours:this.#e,color:[0,0,0],thickness:this.#e?0:r});return this.addComment(o),e?(o.paths={lines:t,points:n},o.uuid=this.#n,o.isCopy=!0):o.lines=t,this.#t&&(o.accessibilityData={type:"Figure",alt:this.#t}),o}static deserializeDraw(e,t,n,r,o,d){return d.areContours?gy.deserialize(e,t,n,r,o,d):Pp.deserialize(e,t,n,r,o,d)}static async deserialize(e,t,n){const r=await super.deserialize(e,t,n);return r.#e=e.areContours,r.description=e.accessibilityData?.alt||"",r.#n=e.uuid,r}}class AT extends Vn{#e=null;#t=null;#i=null;#n=null;#a=null;#s="";#r=null;#o=!1;#c=null;#l=!1;#h=!1;static _type="stamp";static _editorType=Ci.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#n=e.bitmapUrl,this.#a=e.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,t){Vn.initialize(e,t)}static isHandlingMimeForPasting(e){return ay.includes(e)}static paste(e,t){t.pasteEditor({mode:Ci.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){const t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#u(e,t=!1){if(!e){this.remove();return}this.#e=e.bitmap,t||(this.#t=e.id,this.#l=e.isSvg),e.file&&(this.#s=e.file.name),this.#g()}#f(){if(this.#i=null,this._uiManager.enableWaiting(!1),!!this.#r){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(e=null,t=!0){if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:o,height:d}=e||this.copyCanvas(null,null,!0).imageData,c=await n.guess({name:"altText",request:{data:r,width:o,height:d,channels:r.length/(o*d)}});if(!c)throw new Error("No response from the AI service.");if(c.error)throw new Error("Error from the AI service.");if(c.cancel)return null;if(!c.output)throw new Error("No valid response from the AI service.");const h=c.output;return await this.setGuessedAltText(h),t&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}#m(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(n=>this.#u(n,!0)).finally(()=>this.#f());return}if(this.#n){const n=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(n).then(r=>this.#u(r)).finally(()=>this.#f());return}if(this.#a){const n=this.#a;this.#a=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(n).then(r=>this.#u(r)).finally(()=>this.#f());return}const e=document.createElement("input");e.type="file",e.accept=ay.join(",");const t=this._uiManager._signal;this.#i=new Promise(n=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#u(r)}n()},{signal:t}),e.addEventListener("cancel",()=>{this.remove(),n()},{signal:t})}).finally(()=>this.#f()),e.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#r?.remove(),this.#r=null,this.#c&&(clearTimeout(this.#c),this.#c=null)),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#m();return}super.rebuild(),this.div!==null&&(this.#t&&this.#r===null&&this.#m(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#i||this.#e||this.#n||this.#a||this.#t||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;return this._isCopy&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#e?this.#g():this.#m()),this._isCopy&&this._moveAfterPaste(e,t),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,t){const{id:n,bitmap:r}=this._uiManager.imageManager.getFromCanvas(e,t);t.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(this.#t=n,r&&(this.#e=r),this.#o=!1,this.#g())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#c!==null&&clearTimeout(this.#c);const e=200;this.#c=setTimeout(()=>{this.#c=null,this.#p()},e)}#g(){const{div:e}=this;let{width:t,height:n}=this.#e;const[r,o]=this.pageDimensions,d=.75;if(this.width)t=this.width*r,n=this.height*o;else if(t>d*r||n>d*o){const h=Math.min(d*r/t,d*o/n);t*=h,n*=h}this._uiManager.enableWaiting(!1);const c=this.#r=document.createElement("canvas");c.setAttribute("role","img"),this.addContainer(c),this.width=t/r,this.height=n/o,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#p(),this.#h||(this.parent.addUndoableEditor(this),this.#h=!0),this._reportTelemetry({action:"inserted_image"}),this.#s&&this.div.setAttribute("aria-description",this.#s),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(e,t,n=!1){e||(e=224);const{width:r,height:o}=this.#e,d=new Id;let c=this.#e,h=r,f=o,m=null;if(t){if(r>t||o>t){const q=Math.min(t/r,t/o);h=Math.floor(r*q),f=Math.floor(o*q)}m=document.createElement("canvas");const A=m.width=Math.ceil(h*d.sx),v=m.height=Math.ceil(f*d.sy);this.#l||(c=this.#d(A,v));const N=m.getContext("2d");N.filter=this._uiManager.hcmFilter;let T="white",_="#cfcfd8";this._uiManager.hcmFilter!=="none"?_="black":WC.isDarkMode&&(T="#8f8f9d",_="#42414d");const b=15,H=b*d.sx,R=b*d.sy,M=new OffscreenCanvas(H*2,R*2),B=M.getContext("2d");B.fillStyle=T,B.fillRect(0,0,H*2,R*2),B.fillStyle=_,B.fillRect(0,0,H,R),B.fillRect(H,R,H,R),N.fillStyle=N.createPattern(M,"repeat"),N.fillRect(0,0,A,v),N.drawImage(c,0,0,c.width,c.height,0,0,A,v)}let y=null;if(n){let A,v;if(d.symmetric&&c.width<e&&c.height<e)A=c.width,v=c.height;else if(c=this.#e,r>e||o>e){const _=Math.min(e/r,e/o);A=Math.floor(r*_),v=Math.floor(o*_),this.#l||(c=this.#d(A,v))}const T=new OffscreenCanvas(A,v).getContext("2d",{willReadFrequently:!0});T.drawImage(c,0,0,c.width,c.height,0,0,A,v),y={width:A,height:v,data:T.getImageData(0,0,A,v).data}}return{canvas:m,width:h,height:f,imageData:y}}#d(e,t){const{width:n,height:r}=this.#e;let o=n,d=r,c=this.#e;for(;o>2*e||d>2*t;){const h=o,f=d;o>2*e&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),d>2*t&&(d=d>=16384?Math.floor(d/2)-1:Math.ceil(d/2));const m=new OffscreenCanvas(o,d);m.getContext("2d").drawImage(c,0,0,h,f,0,0,o,d),c=m.transferToImageBitmap()}return c}#p(){const[e,t]=this.parentDimensions,{width:n,height:r}=this,o=new Id,d=Math.ceil(n*e*o.sx),c=Math.ceil(r*t*o.sy),h=this.#r;if(!h||h.width===d&&h.height===c)return;h.width=d,h.height=c;const f=this.#l?this.#e:this.#d(d,c),m=h.getContext("2d");m.filter=this._uiManager.hcmFilter,m.drawImage(f,0,0,f.width,f.height,0,0,d,c)}#y(e){if(e){if(this.#l){const r=this._uiManager.imageManager.getSvgUrl(this.#t);if(r)return r}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#e,t.getContext("2d").drawImage(this.#e,0,0),t.toDataURL()}if(this.#l){const[t,n]=this.pageDimensions,r=Math.round(this.width*t*Tf.PDF_TO_CSS_UNITS),o=Math.round(this.height*n*Tf.PDF_TO_CSS_UNITS),d=new OffscreenCanvas(r,o);return d.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,r,o),d.transferToImageBitmap()}return structuredClone(this.#e)}static async deserialize(e,t,n){let r=null,o=!1;if(e instanceof Rv){const{data:{rect:T,rotation:_,id:b,structParent:H,popupRef:R,richText:M,contentsObj:B,creationDate:q,modificationDate:G},container:X,parent:{page:{pageNumber:O}},canvas:Y}=e;let W,I;Y?(delete e.canvas,{id:W,bitmap:I}=n.imageManager.getFromCanvas(X.id,Y),Y.remove()):(o=!0,e._hasNoCanvas=!0);const J=(await t._structTree.getAriaAttributes(`${ff}${b}`))?.get("aria-label")||"";r=e={annotationType:Ci.STAMP,bitmapId:W,bitmap:I,pageIndex:O-1,rect:T.slice(0),rotation:_,annotationElementId:b,id:b,deleted:!1,accessibilityData:{decorative:!1,altText:J},isSvg:!1,structParent:H,popupRef:R,richText:M,comment:B?.str||null,creationDate:q,modificationDate:G}}const d=await super.deserialize(e,t,n),{rect:c,bitmap:h,bitmapUrl:f,bitmapId:m,isSvg:y,accessibilityData:A}=e;o?(n.addMissingCanvas(e.id,d),d.#o=!0):m&&n.imageManager.isValidId(m)?(d.#t=m,h&&(d.#e=h)):d.#n=f,d.#l=y;const[v,N]=d.pageDimensions;return d.width=(c[2]-c[0])/v,d.height=(c[3]-c[1])/N,A&&(d.altTextData=A),d._initialData=r,e.comment&&d.setCommentData(e),d.#h=!!r,d}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=Object.assign(super.serialize(e),{bitmapId:this.#t,isSvg:this.#l});if(this.addComment(n),e)return n.bitmapUrl=this.#y(!0),n.accessibilityData=this.serializeAltText(!0),n.isCopy=!0,n;const{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(n.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const c=this.#b(n);return c.isSame?null:(c.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1,n.id=this.annotationElementId,delete n.bitmapId,n)}if(t===null)return n;t.stamps||=new Map;const d=this.#l?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!t.stamps.has(this.#t))t.stamps.set(this.#t,{area:d,serialized:n}),n.bitmap=this.#y(!1);else if(this.#l){const c=t.stamps.get(this.#t);d>c.area&&(c.area=d,c.serialized.bitmap.close(),c.serialized.bitmap=this.#y(!1))}return n}#b(e){const{pageIndex:t,accessibilityData:{altText:n}}=this._initialData,r=e.pageIndex===t,o=(e.accessibilityData?.alt||"")===n;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&r&&o,isSameAltText:o}}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class au{#e;#t=!1;#i=null;#n=null;#a=null;#s=new Map;#r=!1;#o=!1;#c=!1;#l=null;#h=null;#u=null;#f=null;#m=null;#g=-1;#d;static _initialized=!1;static#p=new Map([oo,Iy,AT,la,Dd].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:r,accessibilityManager:o,annotationLayer:d,drawLayer:c,textLayer:h,viewport:f,l10n:m}){const y=[...au.#p.values()];if(!au._initialized){au._initialized=!0;for(const A of y)A.initialize(m,e)}e.registerEditorTypes(y),this.#d=e,this.pageIndex=t,this.div=n,this.#e=o,this.#i=d,this.viewport=f,this.#u=h,this.drawLayer=c,this._structTree=r,this.#d.addLayer(this)}get isEmpty(){return this.#s.size===0}get isInvisible(){return this.isEmpty&&this.#d.getMode()===Ci.NONE}updateToolbar(e){this.#d.updateToolbar(e)}updateMode(e=this.#d.getMode()){switch(this.#w(),e){case Ci.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Ci.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Ci.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===Ci.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const n of au.#p.values())t.toggle(`${n._type}Editing`,e===n._editorType)}this.div.hidden=!1}hasTextLayer(e){return e===this.#u?.div}setEditingState(e){this.#d.setEditingState(e)}addCommands(e){this.#d.addCommands(e)}cleanUndoStack(e){this.#d.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#i?.togglePointerEvents(e)}get#y(){return this.#s.size!==0?this.#s.values():this.#d.getEditors(this.pageIndex)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#m?.abort(),this.#m=null;const e=new Set;for(const n of this.#y)n.enableEditing(),n.show(!0),n.annotationElementId&&(this.#d.removeChangedExistingAnnotation(n),e.add(n.annotationElementId));const t=this.#i;if(t)for(const n of t.getEditableAnnotations()){if(n.hide(),this.#d.isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;const r=await this.deserialize(n);r&&(this.addOrRebuild(r),r.enableEditing())}this.#c=!1,this.#d._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#u&&!this.#m){this.#m=new AbortController;const r=this.#d.combinedSignal(this.#m);this.#u.div.addEventListener("pointerdown",o=>{const{clientX:c,clientY:h,timeStamp:f}=o,m=this.#g;if(f-m>500){this.#g=f;return}this.#g=-1;const{classList:y}=this.div;y.toggle("getElements",!0);const A=document.elementsFromPoint(c,h);if(y.toggle("getElements",!1),!this.div.contains(A[0]))return;let v;const N=new RegExp(`^${yp}[0-9]+$`);for(const _ of A)if(N.test(_.id)){v=_.id;break}if(!v)return;const T=this.#s.get(v);T?.annotationElementId===null&&(o.stopPropagation(),o.preventDefault(),T.dblclick(o))},{signal:r,capture:!0})}const e=this.#i,t=[];if(e){const r=new Map,o=new Map;for(const c of this.#y){if(c.disableEditing(),!c.annotationElementId){t.push(c);continue}if(c.serialize()!==null){r.set(c.annotationElementId,c);continue}else o.set(c.annotationElementId,c);this.getEditableAnnotation(c.annotationElementId)?.show(),c.remove()}const d=e.getEditableAnnotations();for(const c of d){const{id:h}=c.data;if(this.#d.isDeletedAnnotationElement(h)){c.updateEdited({deleted:!0});continue}let f=o.get(h);if(f){f.resetAnnotationElement(c),f.show(!1),c.show();continue}f=r.get(h),f&&(this.#d.addChangedExistingAnnotation(f),f.renderAnnotationElement(c)&&f.show(!1)),c.show()}}this.#w(),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const r of au.#p.values())n.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),e?.updateFakeAnnotations(t),this.#o=!1}getEditableAnnotation(e){return this.#i?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#d.getActive()!==e&&this.#d.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#u?.div&&!this.#f){this.#f=new AbortController;const e=this.#d.combinedSignal(this.#f);this.#u.div.addEventListener("pointerdown",this.#b.bind(this),{signal:e}),this.#u.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#u?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#u.div.classList.remove("highlighting"))}#b(e){this.#d.unselectAll();const{target:t}=e;if(t===this.#u.div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&this.#u.div.contains(t)){const{isMac:n}=jo.platform;if(e.button!==0||e.ctrlKey&&n)return;this.#d.showAllEditors("highlight",!0,!0),this.#u.div.classList.add("free"),this.toggleDrawing(),la.startHighlighting(this,this.#d.direction==="ltr",{target:this.#u.div,x:e.x,y:e.y}),this.#u.div.addEventListener("pointerup",()=>{this.#u.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#d._signal}),e.preventDefault()}}enableClick(){if(this.#n)return;this.#n=new AbortController;const e=this.#d.combinedSignal(this.#n);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){this.#n?.abort(),this.#n=null}attach(e){this.#s.set(e.id,e);const{annotationElementId:t}=e;t&&this.#d.isDeletedAnnotationElement(t)&&this.#d.removeDeletedAnnotationElement(e)}detach(e){this.#s.delete(e.id),this.#e?.removePointerInTextLayer(e.contentDiv),!this.#o&&e.annotationElementId&&this.#d.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#d.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#d.addDeletedAnnotationElement(e),Vn.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),this.#d.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#c),this.#d.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!this.#a&&(e._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#d._signal}),t.focus())},0)),e._structTreeParentId=this.#e?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getEditorByUID(e){for(const t of this.#s.values())if(t.uid===e)return t;return null}getNextId(){return this.#d.getId()}get#x(){return au.#p.get(this.#d.getMode())}combinedSignal(e){return this.#d.combinedSignal(e)}#T(e){const t=this.#x;return t?new t.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#x?.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await this.#d.updateMode(e.mode);const{offsetX:n,offsetY:r}=this.#A(),o=this.getNextId(),d=this.#T({parent:this,id:o,x:n,y:r,uiManager:this.#d,isCentered:!0,...t});d&&this.add(d)}async deserialize(e){return await au.#p.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#d)||null}createAndAddNewEditor(e,t,n={}){const r=this.getNextId(),o=this.#T({parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:this.#d,isCentered:t,...n});return o&&this.add(o),o}get boundingClientRect(){return this.div.getBoundingClientRect()}#A(){const{x:e,y:t,width:n,height:r}=this.boundingClientRect,o=Math.max(0,e),d=Math.max(0,t),c=Math.min(window.innerWidth,e+n),h=Math.min(window.innerHeight,t+r),f=(o+c)/2-e,m=(d+h)/2-t,[y,A]=this.viewport.rotation%180===0?[f,m]:[m,f];return{offsetX:y,offsetY:A}}addNewEditor(e={}){this.createAndAddNewEditor(this.#A(),!0,e)}setSelected(e){this.#d.setSelected(e)}toggleSelected(e){this.#d.toggleSelected(e)}unselect(e){this.#d.unselect(e)}pointerup(e){const{isMac:t}=jo.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!this.#r||(this.#r=!1,this.#x?.isDrawer&&this.#x.supportMultipleDrawings))return;if(!this.#t){this.#t=!0;return}const n=this.#d.getMode();if(n===Ci.STAMP||n===Ci.SIGNATURE){this.#d.unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){if(this.#d.getMode()===Ci.HIGHLIGHT&&this.enableTextSelection(),this.#r){this.#r=!1;return}const{isMac:t}=jo.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(this.#r=!0,this.#x?.isDrawer){this.startDrawingSession(e);return}const n=this.#d.getActive();this.#t=!n||n.isEmpty()}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),this.#l){this.#x.startDrawing(this,this.#d,!1,e);return}this.#d.setCurrentDrawingSession(this),this.#l=new AbortController;const t=this.#d.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(this.#h=null,this.commitOrRemove())},{signal:t}),this.#x.startDrawing(this,this.#d,!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&(this.#h=t);return}this.#h&&setTimeout(()=>{this.#h?.focus(),this.#h=null},0)}endDrawingSession(e=!1){return this.#l?(this.#d.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#h=null,this.#x.endDrawing(e)):null}findNewParent(e,t,n){const r=this.#d.findParent(t,n);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#x.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#d.getActive()?.parent===this&&(this.#d.commitOrRemove(),this.#d.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const e of this.#s.values())this.#e?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#s.clear(),this.#d.removeLayer(this)}#w(){for(const e of this.#s.values())e.isEmpty()&&e.remove()}render({viewport:e}){this.viewport=e,kh(this.div,e);for(const t of this.#d.getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){this.#d.commitOrRemove(),this.#w();const t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,kh(this.div,{rotation:n}),t!==n)for(const r of this.#s.values())r.rotate(n)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return this.#d.viewParameters.realScale}}class ko{#e=null;#t=new Map;#i=new Map;static#n=0;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(!this.#e){this.#e=e;return}if(this.#e!==e){if(this.#t.size>0)for(const t of this.#t.values())t.remove(),e.append(t);this.#e=e}}static get _svgFactory(){return bi(this,"_svgFactory",new s0)}static#a(e,[t,n,r,o]){const{style:d}=e;d.top=`${100*n}%`,d.left=`${100*t}%`,d.width=`${100*r}%`,d.height=`${100*o}%`}#s(){const e=ko._svgFactory.create(1,1,!0);return this.#e.append(e),e.setAttribute("aria-hidden",!0),e}#r(e,t){const n=ko._svgFactory.createElement("clipPath");e.append(n);const r=`clip_${t}`;n.setAttribute("id",r),n.setAttribute("clipPathUnits","objectBoundingBox");const o=ko._svgFactory.createElement("use");return n.append(o),o.setAttribute("href",`#${t}`),o.classList.add("clip"),r}#o(e,t){for(const[n,r]of Object.entries(t))r===null?e.removeAttribute(n):e.setAttribute(n,r)}draw(e,t=!1,n=!1){const r=ko.#n++,o=this.#s(),d=ko._svgFactory.createElement("defs");o.append(d);const c=ko._svgFactory.createElement("path");d.append(c);const h=`path_p${this.pageIndex}_${r}`;c.setAttribute("id",h),c.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#i.set(r,c);const f=n?this.#r(d,h):null,m=ko._svgFactory.createElement("use");return o.append(m),m.setAttribute("href",`#${h}`),this.updateProperties(o,e),this.#t.set(r,o),{id:r,clipPathId:`url(#${f})`}}drawOutline(e,t){const n=ko.#n++,r=this.#s(),o=ko._svgFactory.createElement("defs");r.append(o);const d=ko._svgFactory.createElement("path");o.append(d);const c=`path_p${this.pageIndex}_${n}`;d.setAttribute("id",c),d.setAttribute("vector-effect","non-scaling-stroke");let h;if(t){const y=ko._svgFactory.createElement("mask");o.append(y),h=`mask_p${this.pageIndex}_${n}`,y.setAttribute("id",h),y.setAttribute("maskUnits","objectBoundingBox");const A=ko._svgFactory.createElement("rect");y.append(A),A.setAttribute("width","1"),A.setAttribute("height","1"),A.setAttribute("fill","white");const v=ko._svgFactory.createElement("use");y.append(v),v.setAttribute("href",`#${c}`),v.setAttribute("stroke","none"),v.setAttribute("fill","black"),v.setAttribute("fill-rule","nonzero"),v.classList.add("mask")}const f=ko._svgFactory.createElement("use");r.append(f),f.setAttribute("href",`#${c}`),h&&f.setAttribute("mask",`url(#${h})`);const m=f.cloneNode();return r.append(m),f.classList.add("mainOutline"),m.classList.add("secondaryOutline"),this.updateProperties(r,e),this.#t.set(n,r),n}finalizeDraw(e,t){this.#i.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;const{root:n,bbox:r,rootClass:o,path:d}=t,c=typeof e=="number"?this.#t.get(e):e;if(c){if(n&&this.#o(c,n),r&&ko.#a(c,r),o){const{classList:h}=c;for(const[f,m]of Object.entries(o))h.toggle(f,m)}if(d){const f=c.firstElementChild.firstElementChild;this.#o(f,d)}}}updateParent(e,t){if(t===this)return;const n=this.#t.get(e);n&&(t.#e.append(n),this.#t.delete(e),t.#t.set(e,n))}remove(e){this.#i.delete(e),this.#e!==null&&(this.#t.get(e).remove(),this.#t.delete(e))}destroy(){this.#e=null;for(const e of this.#t.values())e.remove();this.#t.clear(),this.#i.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:fy};globalThis.pdfjsLib={AbortException:Gu,AnnotationEditorLayer:au,AnnotationEditorParamsType:rr,AnnotationEditorType:Ci,AnnotationEditorUIManager:Yu,AnnotationLayer:My,AnnotationMode:Hu,AnnotationType:ja,applyOpacity:GC,build:Q3,ColorPicker:Uc,createValidAbsoluteUrl:ev,CSSConstants:$C,DOMSVGFactory:s0,DrawLayer:ko,FeatureTest:jo,fetchData:Tp,findContrastColor:YC,getDocument:Av,getFilenameFromUrl:OC,getPdfFilenameFromUrl:UC,getRGB:_p,getUuid:iv,getXfaPageViewport:VC,GlobalWorkerOptions:Af,ImageKind:Xg,InvalidPDFException:ry,isDataScheme:f0,isPdfFile:Ty,isValidExplicitDest:r3,MathClamp:Sl,noContextMenu:Wc,normalizeUnicode:zC,OPS:xp,OutputScale:Id,PasswordResponses:jC,PDFDataRangeTransport:Cv,PDFDateString:sy,PDFWorker:vp,PermissionFlag:_C,PixelsPerInch:Tf,RenderingCancelledException:Cy,renderRichText:av,ResponseException:i0,setLayerDimensions:kh,shadow:bi,SignatureExtractor:uf,stopEvent:Qs,SupportedImageMimeTypes:ay,TextLayer:vl,TouchManager:p0,updateUrlHash:tv,Util:vn,VerbosityLevel:d0,version:_v,XfaLayer:sv};typeof window<"u"&&(Af.workerSrc=`https://cdn.jsdelivr.net/npm/pdfjs-dist@${_v}/build/pdf.worker.min.mjs`);const Mv=()=>{if(typeof window<"u"){const s=localStorage.getItem("geminiApiKey");if(s&&s.trim())return s.trim()}return null},CT=()=>{if(typeof window<"u"){const s=localStorage.getItem("geminiModel");if(s)return s}return"gemini-2.5-flash-lite"},TT=()=>{const s=Mv(),e=CT();return s?`https://generativelanguage.googleapis.com/v1/models/${e}:generateContent?key=${s}`:null},kT=s=>{const e=xy[s];return!e||!e.prefix||e.prefix.length<1?"?":e.prefix[0].substring(0,1).toUpperCase()},_T=({componentEditor:s,componentDefinition:e,setComponentEditor:t,componentsTop:n,componentsBottom:r,setComponentsTop:o,setComponentsBottom:d,connectingPin:c,setConnectingPin:h,componentDialogPosition:f,setComponentDialogPosition:m,isDraggingDialog:y,setIsDraggingDialog:A,dialogDragOffset:v,setDialogDragOffset:N,areComponentsLocked:T,setSelectedComponentIds:_,setNotesDialogVisible:b,projectDirHandle:H,showGeminiSettingsDialog:R=!1,onGeminiSettingsDialogClose:M,onFindComponent:B})=>{const[q,G]=U.useState(!1),[X,O]=U.useState(null),[Y,W]=U.useState(!1),[I,J]=U.useState(!1),[Z,Ce]=U.useState(null),[ie,le]=U.useState(!1),[se,Ae]=U.useState(()=>typeof window<"u"&&localStorage.getItem("geminiApiKey")||""),[ue,E]=U.useState(()=>typeof window<"u"&&localStorage.getItem("geminiModel")||"gemini-2.5-flash-lite"),[L,Q]=U.useState(()=>typeof window<"u"?!!localStorage.getItem("geminiApiKey"):!1);U.useEffect(()=>{if(R){const ze=setTimeout(()=>{J(!0)},0);return()=>clearTimeout(ze)}},[R]),U.useEffect(()=>{typeof window<"u"&&Q(!!localStorage.getItem("geminiApiKey")||!!se.trim())},[se]);const ee=()=>{se.trim()?(typeof window<"u"&&(localStorage.setItem("geminiApiKey",se.trim()),localStorage.setItem("geminiModel",ue)),Q(!0),Mt({visible:!0,title:"API Key and Model Saved",message:`API key and model (${ue}) saved! You can now use the "Extract Datasheet Information" feature.`,type:"success"})):(typeof window<"u"&&(localStorage.removeItem("geminiApiKey"),localStorage.setItem("geminiModel",ue)),Q(!1),Mt({visible:!0,title:"API Key Removed",message:"API key removed. Model preference saved.",type:"info"}))},oe=()=>{typeof window<"u"&&localStorage.removeItem("geminiApiKey"),Ae(""),Q(!1),Mt({visible:!0,title:"API Key Removed",message:"API key has been removed from browser localStorage. You will need to enter it again to use AI features.",type:"info"})},xe=()=>{const ze=s?.designator?.trim().toUpperCase();if(!ze)return;const Ct=[...n,...r].filter(it=>it.designator?.trim().toUpperCase()===ze);if(Ct.length===0)return;if(B&&Ct.length>0){const it=Ct[0];B(it.id,it.x,it.y)}const wt=new Set(Ct.map(it=>it.id));_(wt)},[re,Le]=U.useState(()=>{const ze=localStorage.getItem("componentDialogSize");if(ze)try{return JSON.parse(ze)}catch{return{width:350,height:window.innerHeight*.4}}return{width:350,height:window.innerHeight*.4}}),[Ee,Oe]=U.useState(!1),[Ze,st]=U.useState({x:0,y:0,width:0,height:0}),[mt,Mt]=U.useState({visible:!1,title:"",message:"",type:"info"}),K=Dt.useMemo(()=>{if(!s||!s.visible)return null;let ze=n.find(Ne=>Ne.id===s.id);return ze||(ze=r.find(Ne=>Ne.id===s.id)),ze||null},[s,n,r]);Dt.useEffect(()=>{if(!K){O(null);return}const ze=K.id,Ne=K.componentType,Ct=K.componentType;if(!Ne){console.error("[ComponentEditor useEffect] Component missing componentType:",{comp:K,componentId:ze}),O(null);return}if(Ne==="IntegratedCircuit"||Ct==="Semiconductor"){const wt=K;O(null),s&&t({...s,datasheetFileName:wt.datasheetFileName||void 0})}else O(null)},[K?.id,K?.componentType,K?.datasheetFileName]),U.useEffect(()=>{if(!Ee)return;const ze=Ct=>{const wt=Ct.clientX-Ze.x,it=Ct.clientY-Ze.y,pt=Math.max(350,Math.min(window.innerWidth-20,Ze.width+wt)),Ot=Math.max(200,Math.min(window.innerHeight-20,Ze.height+it)),Qe={width:pt,height:Ot};Le(Qe),localStorage.setItem("componentDialogSize",JSON.stringify(Qe))},Ne=()=>{Oe(!1)};return document.addEventListener("mousemove",ze),document.addEventListener("mouseup",Ne),()=>{document.removeEventListener("mousemove",ze),document.removeEventListener("mouseup",Ne)}},[Ee,Ze]);const jt=ze=>{ze.preventDefault(),ze.stopPropagation(),Oe(!0),st({x:ze.clientX,y:ze.clientY,width:re.width,height:re.height})};if(!s||!s.visible)return l.jsxs(l.Fragment,{children:[I&&l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10005},onClick:ze=>{ze.target===ze.currentTarget&&(J(!1),M?.())},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"24px",minWidth:"500px",maxWidth:"600px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid #1f1f24"},onClick:ze=>ze.stopPropagation(),children:[l.jsxs("div",{style:{marginBottom:"16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[l.jsx("h3",{style:{margin:0,color:"#fff",fontSize:"18px",fontWeight:600},children:"Google Gemini API Configuration"}),l.jsx("button",{onClick:()=>{J(!1),M?.()},style:{background:"transparent",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:0,width:"30px",height:"30px",display:"flex",alignItems:"center",justifyContent:"center"},title:"Close",children:""})]}),l.jsxs("div",{style:{marginBottom:"20px",color:"#ddd",fontSize:"14px",lineHeight:"1.6"},children:[l.jsx("p",{style:{margin:"0 0 12px 0",fontWeight:600,color:"#fff"},children:"Benefits of Adding Your API Key:"}),l.jsxs("ul",{style:{margin:"0 0 16px 0",paddingLeft:"20px"},children:[l.jsx("li",{children:"Automatically extract pin names and component properties (voltage, current, temperature, etc.) from datasheet PDFs"}),l.jsx("li",{children:"Get datasheet summary for component notes"}),l.jsx("li",{children:"Save time by avoiding manual data entry"})]}),l.jsx("p",{style:{margin:"0 0 12px 0",fontWeight:600,color:"#fff"},children:"How to Get Your Free API Key:"}),l.jsxs("p",{style:{margin:"0 0 16px 0"},children:["Go to"," ",l.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",style:{color:"#4CAF50",textDecoration:"underline"},children:"Google AI Studio (aistudio.google.com/app/apikey)"}),', sign in with your Google account, and click "Get API key" or "Create API key" in the Dashboard to generate a key for a new or existing Google Cloud project, then copy it and paste it below.']}),l.jsxs("div",{style:{marginBottom:"12px"},children:[l.jsx("label",{style:{display:"block",marginBottom:"6px",color:"#fff",fontSize:"13px",fontWeight:600},children:"Enter Your API Key:"}),l.jsx("input",{type:"password",value:se,onChange:ze=>Ae(ze.target.value),placeholder:"Paste your Gemini API key here",style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid #555",borderRadius:"4px",background:"#1f1f24",color:"#fff",boxSizing:"border-box"},autoFocus:!0})]}),l.jsxs("div",{style:{marginBottom:"12px"},children:[l.jsx("label",{style:{display:"block",marginBottom:"6px",color:"#fff",fontSize:"13px",fontWeight:600},children:"Select Gemini Model:"}),l.jsxs("select",{value:ue,onChange:ze=>E(ze.target.value),style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid #555",borderRadius:"4px",background:"#1f1f24",color:"#fff",boxSizing:"border-box",cursor:"pointer"},children:[l.jsx("option",{value:"gemini-2.5-flash-lite",children:"gemini-2.5-flash-lite (Lightweight, Fast)"}),l.jsx("option",{value:"gemini-2.5-flash",children:"gemini-2.5-flash (Fast, Balanced)"}),l.jsx("option",{value:"gemini-2.5-pro",children:"gemini-2.5-pro (High Quality, Slower)"}),l.jsx("option",{value:"gemini-1.5-flash",children:"gemini-1.5-flash (Legacy Fast)"}),l.jsx("option",{value:"gemini-1.5-pro",children:"gemini-1.5-pro (Legacy High Quality)"})]}),l.jsx("p",{style:{margin:"6px 0 0 0",color:"#aaa",fontSize:"12px",lineHeight:"1.4"},children:"Choose the model based on your needs: Flash models are faster and use fewer tokens, while Pro models provide higher quality responses."})]}),l.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"#1f1f24",borderRadius:"4px",border:"1px solid #444"},children:[l.jsx("p",{style:{margin:"0 0 8px 0",fontWeight:600,color:"#fff",fontSize:"13px"},children:"Storage & Security Information:"}),l.jsxs("p",{style:{margin:"0 0 8px 0",color:"#ddd",fontSize:"12px",lineHeight:"1.5"},children:["Your API key will be stored in your browser's ",l.jsx("strong",{children:"localStorage"})," under the key ",l.jsx("code",{style:{background:"#2b2b31",padding:"2px 4px",borderRadius:"2px",color:"#4CAF50"},children:"'geminiApiKey'"}),"."]}),l.jsx("p",{style:{margin:"0 0 8px 0",color:"#ffaa00",fontSize:"12px",lineHeight:"1.5",fontWeight:600},children:" Security Warnings:"}),l.jsxs("ul",{style:{margin:"0 0 8px 0",paddingLeft:"20px",color:"#ddd",fontSize:"12px",lineHeight:"1.5"},children:[l.jsx("li",{children:"localStorage is accessible via browser DevTools"}),l.jsx("li",{children:"Do not use on shared or public computers"}),l.jsx("li",{children:"Malicious browser extensions could access your key"}),l.jsx("li",{children:"XSS attacks could potentially read your key"}),l.jsx("li",{children:"The key is stored in plain text (not encrypted)"})]}),l.jsx("p",{style:{margin:"0",color:"#aaa",fontSize:"11px",lineHeight:"1.4",fontStyle:"italic"},children:"For maximum security, consider using API key restrictions in Google Cloud Console and regularly rotating your keys."})]})]}),l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px"},children:[l.jsx("button",{onClick:oe,disabled:!L,style:{padding:"8px 16px",background:L?"#d32f2f":"#444",color:"#fff",border:"1px solid #666",borderRadius:6,cursor:L?"pointer":"not-allowed",fontSize:"14px",fontWeight:600,opacity:L?1:.5},title:L?"Remove API key from browser localStorage":"No API key stored",children:"Remove API Key"}),l.jsxs("div",{style:{display:"flex",gap:"8px"},children:[l.jsx("button",{onClick:()=>{J(!1),M?.()},style:{padding:"8px 16px",background:"#555",color:"#fff",border:"1px solid #666",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"Cancel"}),l.jsx("button",{onClick:()=>{ee(),J(!1),M?.()},style:{padding:"8px 16px",background:"#4CAF50",color:"#fff",border:"1px solid #45a049",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"Save API Key"})]})]})]})}),l.jsx(_b,{visible:mt.visible,title:mt.title,message:mt.message,type:mt.type,onClose:()=>{Mt({visible:!1,title:"",message:"",type:"info"})},onShowResponse:mt.onShowResponse})]});if(!K)return console.error("[ComponentEditor] Component not found:",{componentId:s.id,componentsTopCount:n.length,componentsBottomCount:r.length}),null;if(!K.id||!K.componentType||typeof K.pinCount!="number")return console.error("[ComponentEditor] Component missing required properties:",{componentId:K.id,hasComponentType:!!K.componentType,componentType:K.componentType,pinCount:K.pinCount,pinCountType:typeof K.pinCount,component:K}),null;let $t="top";n.find(ze=>ze.id===s.id)||($t="bottom"),s.layer!==$t&&t({...s,layer:$t});const Yt=ze=>{const Ne={...ze};console.log("[ComponentEditor] updateComponent - Entry:",{componentId:ze.id,componentType:ze.componentType});const Ct=s.designator?.trim()||"";Ne.designator=Ct,Ne.x=s.x,Ne.y=s.y,Ne.layer=s.layer,Ne.orientation=s.orientation??0;const wt=Ct.length>0?Ct.charAt(0).toUpperCase():kT(ze.componentType);if(Ne.abbreviation=wt,s.manufacturer!==void 0&&(Ne.manufacturer=s.manufacturer?.trim()||void 0),s.partNumber!==void 0&&(Ne.partNumber=s.partNumber?.trim()||void 0),s.pinCount!==ze.pinCount){Ne.pinCount=s.pinCount;const it=ze.pinConnections||[];if(Ne.pinConnections=new Array(s.pinCount).fill("").map((pt,Ot)=>Ot<it.length?it[Ot]:""),ze.pinPolarities){const pt=ze.pinPolarities||[];Ne.pinPolarities=new Array(s.pinCount).fill("").map((Ot,Qe)=>Qe<pt.length?pt[Qe]:"")}if(ze.pinNames){const pt=ze.pinNames||[];Ne.pinNames=new Array(s.pinCount).fill("").map((Ot,Qe)=>Qe<pt.length?pt[Qe]:"")}}else Ne.pinConnections=ze.pinConnections||[],ze.pinPolarities&&(Ne.pinPolarities=ze.pinPolarities),ze.pinNames&&(Ne.pinNames=ze.pinNames);return ze.componentType==="Resistor"?(Ne.resistance=s.resistance||void 0,Ne.resistanceUnit=s.resistanceUnit||void 0,Ne.power=s.power?`${s.power}W`:void 0,Ne.tolerance=s.tolerance||void 0):ze.componentType==="Capacitor"?(Ne.capacitance=s.capacitance||void 0,Ne.capacitanceUnit=s.capacitanceUnit||void 0,Ne.voltage=s.voltage||void 0,Ne.voltageUnit=s.voltageUnit||void 0,Ne.tolerance=s.tolerance||void 0,Ne.dielectric=s.dielectric||void 0):ze.componentType==="Electrolytic Capacitor"?(Ne.capacitance=s.capacitance||void 0,Ne.capacitanceUnit=s.capacitanceUnit||void 0,Ne.voltage=s.voltage||void 0,Ne.voltageUnit=s.voltageUnit||void 0,Ne.tolerance=s.tolerance||void 0,Ne.esr=s.esr||void 0,Ne.esrUnit=s.esrUnit||void 0,Ne.temperature=s.temperature||void 0):ze.componentType==="Film Capacitor"?(Ne.capacitance=s.capacitance||void 0,Ne.capacitanceUnit=s.capacitanceUnit||void 0,Ne.voltage=s.voltage||void 0,Ne.voltageUnit=s.voltageUnit||void 0,Ne.tolerance=s.tolerance||void 0,Ne.filmType=s.filmType||void 0):ze.componentType==="Diode"?(Ne.diodeType=s.diodeType||ze.diodeType||"Standard",Ne.voltage=s.voltage||void 0,Ne.voltageUnit=s.voltageUnit||void 0,Ne.current=s.current||void 0,Ne.currentUnit=s.currentUnit||void 0,Ne.ledColor=s.ledColor||void 0):ze.componentType==="Battery"?(Ne.voltage=s.voltage||void 0,Ne.voltageUnit=s.voltageUnit||void 0,Ne.capacity=s.capacity||void 0,Ne.capacityUnit=s.capacityUnit||void 0,Ne.chemistry=s.chemistry||void 0):ze.componentType==="Fuse"?(Ne.current=s.current||void 0,Ne.currentUnit=s.currentUnit||void 0,Ne.voltage=s.voltage||void 0,Ne.voltageUnit=s.voltageUnit||void 0,Ne.fuseType=s.fuseType||void 0):ze.componentType==="FerriteBead"?(Ne.impedance=s.impedance||void 0,Ne.impedanceUnit=s.impedanceUnit||void 0,Ne.current=s.current||void 0,Ne.currentUnit=s.currentUnit||void 0):ze.componentType==="Connector"?(Ne.connectorType=s.connectorType||void 0,Ne.gender=s.gender||void 0):ze.componentType==="Jumper"?Ne.positions=s.positions||void 0:ze.componentType==="Relay"?(Ne.coilVoltage=s.coilVoltage||void 0,Ne.coilVoltageUnit=s.coilVoltageUnit||void 0,Ne.contactType=s.contactType||void 0,Ne.current=s.current||void 0,Ne.currentUnit=s.currentUnit||void 0):ze.componentType==="Inductor"?(Ne.inductance=s.inductance||void 0,Ne.inductanceUnit=s.inductanceUnit||void 0,Ne.current=s.current||void 0,Ne.currentUnit=s.currentUnit||void 0,Ne.resistance=s.resistance||void 0,Ne.resistanceUnit=s.resistanceUnit||void 0):ze.componentType==="Speaker"?(Ne.impedance=s.impedance||void 0,Ne.impedanceUnit=s.impedanceUnit||void 0,Ne.power=s.power?`${s.power}W`:void 0):ze.componentType==="Motor"?(Ne.motorType=s.motorType||void 0,Ne.voltage=s.voltage||void 0,Ne.voltageUnit=s.voltageUnit||void 0,Ne.current=s.current||void 0,Ne.currentUnit=s.currentUnit||void 0):ze.componentType==="PowerSupply"?(Ne.inputVoltage=s.inputVoltage||void 0,Ne.inputVoltageUnit=s.inputVoltageUnit||void 0,Ne.outputVoltage=s.outputVoltage||void 0,Ne.outputVoltageUnit=s.outputVoltageUnit||void 0,Ne.current=s.current||void 0,Ne.currentUnit=s.currentUnit||void 0):ze.componentType==="Transistor"?(Ne.transistorType=s.transistorType||void 0,Ne.polarity=s.polarity||void 0,Ne.voltage=s.voltage||void 0,Ne.voltageUnit=s.voltageUnit||void 0,Ne.current=s.current||void 0,Ne.currentUnit=s.currentUnit||void 0):ze.componentType==="ResistorNetwork"?(Ne.resistance=s.resistance||void 0,Ne.resistanceUnit=s.resistanceUnit||void 0,Ne.configuration=s.configuration||void 0):ze.componentType==="Thermistor"?(Ne.resistance=s.resistance||void 0,Ne.resistanceUnit=s.resistanceUnit||void 0,Ne.thermistorType=s.thermistorType||void 0,Ne.beta=s.beta||void 0):ze.componentType==="Switch"?(Ne.switchType=s.switchType||void 0,Ne.current=s.current||void 0,Ne.currentUnit=s.currentUnit||void 0,Ne.voltage=s.voltage||void 0,Ne.voltageUnit=s.voltageUnit||void 0):ze.componentType==="Transformer"?(Ne.primaryVoltage=s.primaryVoltage||void 0,Ne.primaryVoltageUnit=s.primaryVoltageUnit||void 0,Ne.secondaryVoltage=s.secondaryVoltage||void 0,Ne.secondaryVoltageUnit=s.secondaryVoltageUnit||void 0,Ne.power=s.power?`${s.power}W`:void 0,Ne.turns=s.turns||void 0):ze.componentType==="TestPoint"?Ne.signal=s.signal||void 0:ze.componentType==="Film Capacitor"?(Ne.capacitance=s.capacitance||void 0,Ne.capacitanceUnit=s.capacitanceUnit||void 0,Ne.voltage=s.voltage||void 0,Ne.voltageUnit=s.voltageUnit||void 0,Ne.tolerance=s.tolerance||void 0,Ne.filmType=s.filmType||void 0):ze.componentType==="IntegratedCircuit"||ze.componentType==="Semiconductor"?(Ne.description=s.description?.trim()||void 0,ze.componentType==="Semiconductor"&&(Ne.componentType="IntegratedCircuit"),Ne.icType=s.icType||void 0,Ne.manufacturer=s.manufacturer?.trim()||void 0,Ne.partNumber=s.partNumber?.trim()||void 0,Ne.operatingTemperature=s.operatingTemperature?.trim()||void 0,Ne.packageType=s.packageType||void 0,s.datasheetFileName?Ne.datasheetFileName=s.datasheetFileName:Ne.datasheetFileName=void 0):Ne.description=s.description?.trim()||void 0,ze.componentType==="VacuumTube"?Ne.tubeType=s.tubeType||void 0:ze.componentType==="VariableResistor"?(Ne.vrType=s.vrType||void 0,Ne.resistance=s.resistance||void 0,Ne.resistanceUnit=s.resistanceUnit||void 0,Ne.power=s.power?`${s.power}W`:void 0,Ne.taper=s.taper||void 0):ze.componentType==="Crystal"?(Ne.frequency=s.frequency||void 0,Ne.loadCapacitance=s.loadCapacitance||void 0,Ne.tolerance=s.tolerance||void 0):ze.componentType==="GenericComponent"&&(Ne.genericType=s.genericType||"Attenuator",Ne.voltage=s.voltage||void 0,Ne.voltageUnit=s.voltageUnit||void 0,Ne.current=s.current||void 0,Ne.currentUnit=s.currentUnit||void 0,Ne.power=s.power||void 0,Ne.frequency=s.frequency||void 0,Ne.model=s.model||void 0),Ne},yt=()=>{if(T){alert("Cannot edit: Components are locked. Unlock components to edit them.");return}const ze=n.find(wt=>wt.id===s.id),Ne=r.find(wt=>wt.id===s.id),Ct=ze||Ne;if(Ct){Ct.componentType==="IntegratedCircuit"&&console.log("[ComponentEditor] handleSave - Before updateComponent call:",{componentDatasheet:Ct.datasheet,editorDatasheet:s.datasheet,editorDatasheetType:typeof s.datasheet,editorDatasheetLength:s.datasheet?.length,fullEditor:s});const wt=Yt(Ct);Ct.componentType==="IntegratedCircuit"&&console.log("[ComponentEditor] handleSave - After updateComponent call:",{updatedComponentDatasheet:wt.datasheet,updatedComponentDatasheetType:typeof wt.datasheet});const it=Ct.layer,pt=s.layer;it!==pt?it==="top"?(o(Ot=>Ot.filter(Qe=>Qe.id!==s.id)),d(Ot=>[...Ot,wt])):(d(Ot=>Ot.filter(Qe=>Qe.id!==s.id)),o(Ot=>[...Ot,wt])):pt==="top"?o(Ot=>{const Qe=Ot.map(Wt=>Wt.id===s.id?(console.log("[ComponentEditor] Updating component in top array - datasheet:",wt.datasheet),wt):Wt),St=Qe.find(Wt=>Wt.id===s.id);return St&&St.componentType==="IntegratedCircuit"&&console.log("[ComponentEditor] After state update - component datasheet in array:",St.datasheet),Qe}):d(Ot=>{const Qe=Ot.map(Wt=>Wt.id===s.id?(console.log("[ComponentEditor] Updating component in bottom array - datasheet:",wt.datasheet),wt):Wt),St=Qe.find(Wt=>Wt.id===s.id);return St&&St.componentType==="IntegratedCircuit"&&console.log("[ComponentEditor] After state update - component datasheet in array:",St.datasheet),Qe})}else if(console.warn(`Component ${s.id} not found in either layer array`),s.layer==="top"){const wt=r.find(it=>it.id===s.id);if(wt){const it=Yt(wt);d(pt=>pt.filter(Ot=>Ot.id!==s.id)),o(pt=>[...pt,it])}}else{const wt=n.find(it=>it.id===s.id);if(wt){const it=Yt(wt);o(pt=>pt.filter(Ot=>Ot.id!==s.id)),d(pt=>[...pt,it])}}t(null),h(null)},on=async()=>{const ze=Mv(),Ne=TT();if(!ze||!Ne){J(!0);return}const Ct=K?.datasheetFileName;if(!X&&(!H||!Ct)){Mt({visible:!0,title:"Datasheet Required",message:"Please choose a datasheet file before extracting information.",type:"info"});return}G(!0);try{let wt;if(X)wt=await X.arrayBuffer();else if(H&&Ct){const Lt=Ct.split("/");let Ht=H;for(let vi=0;vi<Lt.length-1;vi++){const ar=Lt[vi];try{Ht=await Ht.getDirectoryHandle(ar)}catch{const Fn=ar==="datasheets"?"Datasheets":ar==="Datasheets"?"datasheets":ar;try{Ht=await Ht.getDirectoryHandle(Fn)}catch{throw new Error(`Directory '${ar}' not found in project folder.`)}}}wt=await(await(await Ht.getFileHandle(Lt[Lt.length-1])).getFile()).arrayBuffer()}else throw new Error("No datasheet file available");const it=await Av({data:wt}).promise;let pt="";for(let Lt=1;Lt<=it.numPages;Lt++){const ti=(await(await it.getPage(Lt)).getTextContent()).items.map(vi=>vi.str).join(" ");pt+=ti+`
`}const Ot=2e4,Qe=pt.length>Ot?pt.substring(0,Ot)+`
[... text truncated ...]`:pt,Wt=(s.layer==="top"?n:r).find(Lt=>Lt.id===s.id);if(!Wt)throw new Error("Component not found");const Kt=((e||Vc(Wt))?.fields||[]).filter(Lt=>Lt.name!=="datasheet").map(Lt=>({name:Lt.name,label:Lt.label,type:Lt.type,hasUnits:!!(Lt.units&&Lt.units.length>0),units:Lt.units||[]})),rn=`You are analyzing an electronic component datasheet. Extract pin information, component properties, a datasheet summary, IC type, and pin count, then return the data as a JSON object.

Requirements:
1. Return a JSON object with three sections: "pins", "properties", and "summary"
2. First, determine the total number of pins (pinCount) for this component from the datasheet. This should be a positive integer representing the total number of pins/pads on the component.
3. For pins, extract information for ALL pins found in the datasheet (not just a subset). For each pin, provide:
   - pinNumber: The pin number (1, 2, 3, etc.)
   - pinName: The signal name (e.g., VCC, GND, IN+, OUT, etc.). Use the exact name from the datasheet.
   - pinDescription: A brief description of the pin's function (optional, can be empty string)
4. For component properties, extract the following information if available in the datasheet:
${Kt.map(Lt=>Lt.hasUnits?`   - ${Lt.name}: The ${Lt.label.toLowerCase()} value (as a number) and ${Lt.name}Unit: The unit (one of: ${Lt.units.join(", ")})`:Lt.type==="enum"?`   - ${Lt.name}: The ${Lt.label.toLowerCase()} (as a string)`:`   - ${Lt.name}: The ${Lt.label.toLowerCase()} (as a string or number, depending on the field type)`).join(`
`)}
5. For IC Type (icType), determine the type of integrated circuit from the datasheet. Choose from: "Op-Amp", "Microcontroller", "Microprocessor", "Logic", "Memory", "Voltage Regulator", "Timer", "ADC", "DAC", "Comparator", "Transceiver", "Driver", "Amplifier", or "Other". If it's clearly an op amp, use "Op-Amp". If it's clearly a microcontroller, use "Microcontroller", etc.
6. For Package Type (packageType), determine the package type from the datasheet. Choose from: "DIP", "PDIP", "SOIC", "QFP", "LQFP", "TQFP", "BGA", "SSOP", "TSOP", "Various", or "Other". If multiple package types are mentioned in the datasheet, use "Various". If it's a plastic DIP, use "PDIP". If it's a standard DIP, use "DIP".
7. For pin count (pinCount), determine the total number of pins/pads on the component from the datasheet. This should be a positive integer. Include this in the properties section.
8. For datasheet summary (datasheetSummary), provide a concise summary (2-4 sentences) of the introductory information from the datasheet, including what the component is, its main purpose, and key features mentioned in the introduction or overview section.
9. Only include properties that are actually found in the datasheet - do not make up values
10. For numeric fields with units, extract both the numeric value and the appropriate unit
11. Return ONLY valid JSON, no additional text, explanations, or markdown formatting

Example JSON format:
{
  "pins": [
    {"pinNumber": 1, "pinName": "VCC", "pinDescription": "Power supply positive"},
    {"pinNumber": 2, "pinName": "GND", "pinDescription": "Ground"},
    {"pinNumber": 3, "pinName": "IN+", "pinDescription": "Non-inverting input"},
    {"pinNumber": 4, "pinName": "IN-", "pinDescription": "Inverting input"},
    {"pinNumber": 5, "pinName": "OUT", "pinDescription": "Output"}
  ],
  "properties": {
    "partNumber": "LM358",
    "manufacturer": "Texas Instruments",
    "voltage": 36,
    "voltageUnit": "V",
    "description": "Dual operational amplifier",
    "icType": "Op-Amp",
    "packageType": "PDIP",
    "pinCount": 5
  },
  "summary": {
    "datasheetSummary": "The LM358 is a dual operational amplifier featuring low power consumption and wide supply voltage range. It is designed for single supply operation from 3V to 32V or dual supplies from 1.5V to 16V. The device offers high gain bandwidth product and low input offset voltage."
  }
}

Datasheet text:
${Qe}`,un=await fetch(Ne,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:rn}]}]})});if(!un.ok){const Lt=await un.text();let Ht=`Gemini API error: ${un.status} ${un.statusText}`;try{const Et=JSON.parse(Lt);Et.error&&Et.error.message&&(Ht+=`. ${Et.error.message}`)}catch{Ht+=`. ${Lt.substring(0,200)}`}throw new Error(Ht)}const ot=await un.json();let Zt="";if(ot.candidates&&ot.candidates[0]){if(ot.candidates[0].finishReason&&ot.candidates[0].finishReason!=="STOP")throw new Error(`Gemini API response blocked: ${ot.candidates[0].finishReason}`);if(ot.candidates[0].content&&ot.candidates[0].content.parts){const Lt=ot.candidates[0].content.parts;Lt&&Lt[0]&&Lt[0].text&&(Zt=Lt[0].text.trim())}}if(!Zt)throw Ce(null),new Error("No response text from Gemini API. The API may have returned an empty response.");Ce(Zt),Zt=Zt.replace(/^```[\w]*\n?/gm,"").replace(/\n?```$/gm,"");let Ft;try{Ft=JSON.parse(Zt)}catch(Lt){throw new Error(`Failed to parse JSON response from Gemini API: ${Lt instanceof Error?Lt.message:"Unknown error"}`)}if(!Ft||typeof Ft!="object")throw new Error("Invalid JSON response from Gemini API: expected an object");let Jt=s.pinCount;if(Ft.properties&&typeof Ft.properties=="object"&&Ft.properties.pinCount){const Lt=parseInt(String(Ft.properties.pinCount),10);!isNaN(Lt)&&Lt>0&&(Jt=Lt)}else if(Ft.pins&&Array.isArray(Ft.pins)){let Lt=0;for(const Ht of Ft.pins)if(Ht&&typeof Ht=="object"&&Ht.pinNumber){const Et=parseInt(String(Ht.pinNumber),10);!isNaN(Et)&&Et>Lt&&(Lt=Et)}Lt>0&&(Jt=Lt)}const yn=new Array(Jt).fill("");let _n=0;if(Ft.pins&&Array.isArray(Ft.pins)){for(const Lt of Ft.pins)if(Lt&&typeof Lt=="object"&&Lt.pinNumber&&Lt.pinName){const Ht=parseInt(String(Lt.pinNumber),10);!isNaN(Ht)&&Ht>=1&&Ht<=Jt&&(yn[Ht-1]=String(Lt.pinName).trim(),_n++)}}if(_n===0)throw new Error("Could not parse any pin information from the JSON response.");const Qt={...s};let Ut=0;const zi=[];if(Jt!==s.pinCount&&(Qt.pinCount=Jt,zi.push({label:"Pin Count",value:String(Jt)}),Ut++),Ft.properties&&typeof Ft.properties=="object"){const Lt=Ft.properties;for(const Ht of Kt)if(Lt.hasOwnProperty(Ht.name)){const Et=Lt[Ht.name];if(Et!=null&&Et!==""){let ti="";if(Ht.hasUnits){Qt[Ht.name]=String(Et);const vi=`${Ht.name}Unit`;let ar="";if(Lt.hasOwnProperty(vi)){const _t=String(Lt[vi]).trim();Ht.units.includes(_t)?(Qt[vi]=_t,ar=_t):Ht.units.length>0&&(Qt[vi]=Ht.units[0],ar=Ht.units[0])}else Ht.units.length>0&&(Qt[vi]=Ht.units[0],ar=Ht.units[0]);ti=`${Et} ${ar}`.trim()}else Qt[Ht.name]=String(Et),ti=String(Et);zi.push({label:Ht.label,value:ti}),Ut++}}if(Lt.hasOwnProperty("icType")&&Lt.icType){const Ht=String(Lt.icType).trim();["Op-Amp","Microcontroller","Microprocessor","Logic","Memory","Voltage Regulator","Timer","ADC","DAC","Comparator","Transceiver","Driver","Amplifier","Other"].includes(Ht)&&(Qt.icType=Ht,zi.push({label:"IC Type",value:Ht}),Ut++)}if(Lt.hasOwnProperty("packageType")&&Lt.packageType){const Ht=String(Lt.packageType).trim(),Et=["DIP","PDIP","SOIC","QFP","LQFP","TQFP","BGA","SSOP","TSOP","Various","Other"];let ti=Ht;if(Ht.toUpperCase()==="PDIP"||Ht.toUpperCase()==="DIP")Ht.includes(",")||Ht.includes(" or ")||Ht.includes(" and ")?ti="Various":Ht.toUpperCase().includes("PDIP")?ti="PDIP":ti="DIP";else if(Et.includes(Ht))ti=Ht;else if(Ht.includes(",")||Ht.includes(" or ")||Ht.includes(" and "))ti="Various";else{const vi=Ht.toUpperCase();vi.includes("LQFP")?ti="LQFP":vi.includes("TQFP")?ti="TQFP":vi.includes("QFP")?ti="QFP":vi.includes("SOIC")?ti="SOIC":vi.includes("BGA")?ti="BGA":vi.includes("SSOP")?ti="SSOP":vi.includes("TSOP")?ti="TSOP":ti="Other"}(Et.includes(ti)||ti==="Various")&&(Qt.packageType=ti,zi.push({label:"Package Type",value:ti}),Ut++)}}let Jn="";if(Ft.summary&&typeof Ft.summary=="object"&&Ft.summary.datasheetSummary&&(Jn=String(Ft.summary.datasheetSummary).trim(),Jn)){Qt.notes=Jn;const Lt=Jn.length>100?Jn.substring(0,100)+"...":Jn;zi.push({label:"Notes",value:Lt}),Ut++}if(t(Qt),Wt){const Lt=Wt.pinConnections||[],Ht=new Array(Jt).fill("").map((ci,ri)=>ri<Lt.length?Lt[ri]:""),Et=Wt.pinPolarities||[],ti=new Array(Jt).fill("").map((ci,ri)=>ri<Et.length?Et[ri]:""),vi=[...yn];for(;vi.length<Jt;)vi.push("");const ar={...Wt,pinNames:vi,pinCount:Jt,pinConnections:Ht,pinPolarities:ti,...Jn&&{notes:Jn}};s.layer==="top"?o(ci=>ci.map(ri=>ri.id===s.id?ar:ri)):d(ci=>ci.map(ri=>ri.id===s.id?ar:ri));const _t=yn.filter(ci=>ci.length>0).length;let Fn=`Extracted ${_t} pin name${_t!==1?"s":""}`;Jt!==s.pinCount&&(Fn+=" and pin count"),Ut>0&&(Fn+=` and ${Ut} propert${Ut===1?"y":"ies"}`),Fn+=" from datasheet.",zi.length>0&&(Fn+=`

Extracted Properties:`,zi.forEach(ci=>{Fn+=`
   ${ci.label}: ${ci.value}`}));const Xn=[];yn.forEach((ci,ri)=>{ci&&ci.trim()&&Xn.push(`Pin ${ri+1}: ${ci.trim()}`)}),Xn.length>0&&(Fn+=`

Pin Names:`,Fn+=`
  `+Xn.join(", ")),Mt({visible:!0,title:"Extraction Complete",message:Fn,type:"success"}),Ce(null)}}catch(wt){console.error("Error fetching pin names:",wt),Mt({visible:!0,title:"Extraction Failed",message:`Failed to extract information: ${wt instanceof Error?wt.message:"Unknown error"}. Please enter pin names manually.`,type:"info",onShowResponse:Z?()=>le(!0):void 0})}finally{G(!1)}};return l.jsxs(l.Fragment,{children:[l.jsx("style",{children:`
        @keyframes heartbeat {
          0%, 100% {
            transform: scale(1);
            box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.8);
          }
          50% {
            transform: scale(1.15);
            box-shadow: 0 0 0 8px rgba(76, 175, 80, 0);
          }
        }
        .fetch-pin-names-pulse {
          animation: heartbeat 0.8s ease-in-out infinite;
        }
      `}),l.jsxs("div",{"data-component-editor-dialog":!0,onClick:ze=>{if(c&&c.componentId===K.id){const Ne=ze.target;(Ne.tagName==="BUTTON"||Ne.tagName==="INPUT"||Ne.closest("button")||Ne.closest("input"))&&ze.stopPropagation()}},style:{position:"fixed",top:f?`${f.y}px`:"90px",left:f?`${f.x}px`:`${window.innerWidth-280}px`,transform:"none",background:c&&c.componentId===K.id?"rgba(255, 255, 255, 0.95)":"#fff",border:"1px solid #0b5fff",borderRadius:4,boxShadow:"0 2px 6px rgba(0,0,0,0.15)",zIndex:1e3,minWidth:"350px",width:`${re.width}px`,height:`${re.height}px`,maxHeight:`${window.innerHeight-20}px`,display:"flex",flexDirection:"column",pointerEvents:"auto",cursor:y?"grabbing":"default"},children:[l.jsxs("div",{onMouseDown:ze=>{const Ne=ze.target;Ne.tagName==="BUTTON"||Ne.tagName==="INPUT"||Ne.closest("button")||Ne.closest("input")||f&&(N({x:ze.clientX-f.x,y:ze.clientY-f.y}),A(!0),ze.preventDefault())},style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px",borderBottom:"1px solid #e0e0e0",background:"#888",cursor:y?"grabbing":"grab",userSelect:"none",flexShrink:0},children:[l.jsx("h3",{style:{margin:0,fontSize:"13px",color:"#fff",fontWeight:600},children:"Component Properties"}),l.jsx("button",{onClick:()=>{t(null),h(null)},style:{background:"transparent",border:"none",fontSize:"15px",cursor:"pointer",color:"#fff",padding:0,width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",padding:"6px 20px 6px 6px",overflowY:"auto",flex:1,minHeight:0},children:[(()=>{const ze=e||Vc(K);return l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Category:"}),l.jsx("div",{style:{width:"180px",padding:"2px 3px",background:"#f5f5f5",borderRadius:2,fontSize:"11px",color:"#000"},children:ze?.category||"N/A"})]})})(),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Type:"}),l.jsx("div",{style:{width:"180px",padding:"2px 3px",background:"#f5f5f5",borderRadius:2,fontSize:"11px",color:"#000"},children:(()=>{const ze=e||Vc(K);return ze?.displayName?K.componentType==="Capacitor"&&!ze.displayName.toLowerCase().includes("capacitor")?`${ze.displayName} Capacitor`:ze.displayName:K.componentType==="GenericComponent"&&K.genericType?wc(K.genericType):K.componentType==="Diode"&&K.diodeType&&K.diodeType!=="Standard"?wc(K.diodeType):K.componentType==="VariableResistor"&&K.vrType&&K.vrType!=="Potentiometer"?wc(K.vrType):K.componentType==="Capacitor"&&K.dielectric==="Tantalum"?"Tantalum Capacitor":K.componentType==="Capacitor"&&K.capacitorType==="Electrolytic"?"Electrolytic Capacitor":K.componentType==="Capacitor"&&K.capacitorType==="Film"?"Film Capacitor":wc(K.componentType)})()})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-layer-${K.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Layer:"}),l.jsxs("select",{id:`component-layer-${K.id}`,name:`component-layer-${K.id}`,value:s.layer,onChange:ze=>t({...s,layer:ze.target.value}),disabled:T,style:{width:"80px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:T?.6:1},children:[l.jsx("option",{value:"top",children:"Top"}),l.jsx("option",{value:"bottom",children:"Bottom"})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-designator-${K.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Designator:"}),l.jsx("input",{id:`component-designator-${K.id}`,name:`component-designator-${K.id}`,type:"text",value:s.designator||"",onChange:ze=>{const Ne=ze.target.value,Ct=Ne.length>0?Ne.charAt(0).toUpperCase():s.abbreviation;t({...s,designator:Ne,abbreviation:Ct})},disabled:T,style:{width:"80px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",fontFamily:"monospace",textTransform:"uppercase",opacity:T?.6:1},placeholder:"e.g., U2, R7, C1",onKeyDown:ze=>{ze.key==="Enter"&&!T&&(ze.preventDefault(),xe())}}),l.jsx("button",{onClick:xe,disabled:T||!s.designator?.trim(),style:{padding:"4px 12px",background:T||!s.designator?.trim()?"#ccc":"linear-gradient(90deg, #7B68EE 0%, #6A5ACD 100%)",color:"#fff",border:"none",borderRadius:"4px",fontSize:"11px",fontWeight:600,cursor:T||!s.designator?.trim()?"not-allowed":"pointer",opacity:T||!s.designator?.trim()?.6:1,textShadow:"0 1px 2px rgba(0, 0, 0, 0.3)",whiteSpace:"nowrap"},title:"Find all components with this designator",children:"Find"})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-orientation-${K.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Orientation:"}),l.jsxs("select",{id:`component-orientation-${K.id}`,name:`component-orientation-${K.id}`,value:s.orientation??0,onChange:ze=>{const Ne=parseInt(ze.target.value)||0;if(t({...s,orientation:Ne}),!T){const wt=(s.layer==="top"?n:r).find(it=>it.id===s.id);if(wt){const it={...wt,orientation:Ne};s.layer==="top"?o(pt=>pt.map(Ot=>Ot.id===s.id?it:Ot)):d(pt=>pt.map(Ot=>Ot.id===s.id?it:Ot))}}},disabled:T,style:{width:"70px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:T?.6:1},children:[l.jsx("option",{value:"0",children:"0"}),l.jsx("option",{value:"90",children:"90"}),l.jsx("option",{value:"180",children:"180"}),l.jsx("option",{value:"270",children:"270"})]})]}),(K.componentType==="IntegratedCircuit"||K.componentType==="Semiconductor")&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"6px"},children:[l.jsx("label",{htmlFor:`component-datasheet-${K.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Datasheet:"}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",flex:1},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",flexWrap:"wrap",flex:1},children:[l.jsx("input",{id:`component-datasheet-file-${K.id}`,type:"file",accept:".pdf",onChange:async ze=>{const Ne=ze.target.files?.[0]||null;if(Ne){O(Ne);let Ct=Ne.name;if(H)try{let wt;try{wt=await H.getDirectoryHandle("datasheets",{create:!0})}catch(Ot){console.error("Failed to get/create datasheets directory:",Ot),wt=H}const pt=await(await wt.getFileHandle(Ne.name,{create:!0})).createWritable();await pt.write(await Ne.arrayBuffer()),await pt.close(),Ct=wt===H?Ne.name:`datasheets/${Ne.name}`}catch(wt){console.error("Failed to copy datasheet to project directory:",wt)}t({...s,datasheetFileName:Ct})}else O(null),t({...s,datasheetFileName:void 0})},disabled:T,style:{position:"absolute",width:"0.1px",height:"0.1px",opacity:0,overflow:"hidden",zIndex:-1}}),l.jsx("label",{htmlFor:`component-datasheet-file-${K.id}`,style:{display:"inline-block",padding:"2px 6px",background:T?"#ccc":"#4CAF50",border:"none",borderRadius:2,fontSize:"11px",color:"#fff",cursor:T?"not-allowed":"pointer",opacity:T?.6:1,whiteSpace:"nowrap",flex:"0 0 auto"},children:"Choose File"}),(()=>{const ze=K?.datasheetFileName,Ne=X?.name||(ze?ze.split("/").pop():null),Ct=!!X;return Ne?Ct?l.jsx("a",{href:"#",onClick:wt=>{wt.preventDefault(),wt.stopPropagation();try{const it=X,pt=URL.createObjectURL(it),Ot=window.open(pt,"_blank","noopener,noreferrer");if(!Ot||Ot.closed){URL.revokeObjectURL(pt);const Qe=document.createElement("a"),St=URL.createObjectURL(it);Qe.href=St,Qe.target="_blank",Qe.rel="noopener noreferrer",document.body.appendChild(Qe),Qe.click(),document.body.removeChild(Qe)}}catch(it){console.error("Error opening datasheet:",it),alert("Failed to open datasheet file.")}},style:{fontSize:"11px",color:"#0066cc",whiteSpace:"nowrap",textDecoration:"underline",cursor:"pointer",flex:"0 0 auto"},title:"Click to open PDF in new window",children:Ne}):l.jsxs("span",{style:{fontSize:"11px",color:"#666",flex:"0 0 auto",fontStyle:"italic"},title:"Re-choose the datasheet file to open it",children:[Ne," (re-choose file to open)"]}):l.jsx("span",{style:{fontSize:"11px",color:"#666",flex:"0 0 auto"},children:"No file chosen"})})()]}),l.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginTop:"4px"},children:l.jsx("button",{onClick:on,disabled:q||T,className:q?"fetch-pin-names-pulse":"",style:{padding:"3px 8px",fontSize:"11px",background:T?"#ccc":"#4CAF50",color:"#fff",border:"none",borderRadius:"3px",cursor:q||T?"not-allowed":"pointer",opacity:T?.6:1,fontWeight:600,whiteSpace:"nowrap",transition:"background 0.2s"},children:q?"Extracting...":"Extract Datasheet Information"})})]})]}),(K.componentType==="IntegratedCircuit"||K.componentType==="Semiconductor")&&l.jsxs(l.Fragment,{children:[l.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid #e0e0e0",fontSize:"11px",fontWeight:600,color:"#000",marginBottom:"4px"},children:"IC Properties:"}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"6px"},children:[l.jsx("label",{htmlFor:`component-manufacturer-ic-${K.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Manufacturer:"}),l.jsx("input",{id:`component-manufacturer-ic-${K.id}`,type:"text",value:s.manufacturer||"",onChange:ze=>t({...s,manufacturer:ze.target.value}),disabled:T,style:{width:"150px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:T?.6:1}})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"6px"},children:[l.jsx("label",{htmlFor:`component-partnumber-ic-${K.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Part Number:"}),l.jsx("input",{id:`component-partnumber-ic-${K.id}`,type:"text",value:s.partNumber||"",onChange:ze=>t({...s,partNumber:ze.target.value}),disabled:T,style:{width:"150px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:T?.6:1}})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"6px"},children:[l.jsx("label",{htmlFor:`component-pincount-ic-${K.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Pin Count:"}),l.jsx("input",{id:`component-pincount-ic-${K.id}`,name:`component-pincount-ic-${K.id}`,type:"number",min:"1",value:s.pinCount,onChange:ze=>{const Ne=Math.max(1,parseInt(ze.target.value)||1);t({...s,pinCount:Ne})},onBlur:ze=>{if(T){alert("Cannot edit: Components are locked. Unlock components to edit them.");return}const Ne=Math.max(1,parseInt(ze.target.value)||1),wt=(s.layer==="top"?n:r).find(it=>it.id===s.id);if(wt&&Ne!==wt.pinCount){const it=wt.pinConnections||[],pt=new Array(Ne).fill("").map((Wt,Bt)=>Bt<it.length?it[Bt]:""),Ot=wt.pinPolarities||[],Qe=wt.pinPolarities?new Array(Ne).fill("").map((Wt,Bt)=>Bt<Ot.length?Ot[Bt]:""):void 0,St={...wt,pinCount:Ne,pinConnections:pt,...Qe!==void 0&&{pinPolarities:Qe}};s.layer==="top"?o(Wt=>Wt.map(Bt=>Bt.id===s.id?St:Bt)):d(Wt=>Wt.map(Bt=>Bt.id===s.id?St:Bt)),t({...s,pinCount:Ne})}},disabled:T,style:{width:"80px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:T?.6:1}})]})]})]}),l.jsx(kC,{component:K,componentEditor:s,componentDefinition:e,setComponentEditor:t,areComponentsLocked:T,componentsTop:n,componentsBottom:r,uploadedDatasheetFile:X,setUploadedDatasheetFile:O,setComponentsTop:o,setComponentsBottom:d}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-description-${K.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Description:"}),l.jsx("input",{id:`component-description-${K.id}`,name:`component-description-${K.id}`,type:"text",value:s.description||"",onChange:ze=>{t({...s,description:ze.target.value})},disabled:T,style:{width:"180px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:T?.6:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},placeholder:"",title:s.description||""})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-notes-${K.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Notes:"}),l.jsx("input",{id:`component-notes-${K.id}`,name:`component-notes-${K.id}`,type:"text",readOnly:!0,value:K.notes||"",onClick:()=>{T||(_(new Set([K.id])),b(!0))},disabled:T,style:{width:"180px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:T?.6:1,cursor:T?"not-allowed":"pointer",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},placeholder:"Click to edit notes...",title:K.notes||"Click to edit notes..."})]}),(K.componentType==="IntegratedCircuit"||K.componentType==="Semiconductor")&&l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-operatingTemperature-${K.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Operating Temperature:"}),l.jsx("input",{id:`component-operatingTemperature-${K.id}`,name:`component-operatingTemperature-${K.id}`,type:"text",value:s.operatingTemperature||"",onChange:ze=>{t({...s,operatingTemperature:ze.target.value})},disabled:T,style:{width:"180px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:T?.6:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},placeholder:"",title:s.operatingTemperature||""})]}),K.componentType!=="IntegratedCircuit"&&K.componentType!=="Semiconductor"&&l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-pincount-${K.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Pin Count:"}),l.jsx("input",{id:`component-pincount-${K.id}`,name:`component-pincount-${K.id}`,type:"number",min:"1",value:s.pinCount,onChange:ze=>{const Ne=Math.max(1,parseInt(ze.target.value)||1);t({...s,pinCount:Ne})},onBlur:ze=>{if(T){alert("Cannot edit: Components are locked. Unlock components to edit them.");return}const Ne=Math.max(1,parseInt(ze.target.value)||1),wt=(s.layer==="top"?n:r).find(it=>it.id===s.id);if(wt&&Ne!==wt.pinCount){const it=wt.pinConnections||[],pt=new Array(Ne).fill("").map((Wt,Bt)=>Bt<it.length?it[Bt]:""),Ot=wt.pinPolarities||[],Qe=wt.pinPolarities?new Array(Ne).fill("").map((Wt,Bt)=>Bt<Ot.length?Ot[Bt]:""):void 0,St={...wt,pinCount:Ne,pinConnections:pt,...Qe!==void 0&&{pinPolarities:Qe}};s.layer==="top"?o(Wt=>Wt.map(Bt=>Bt.id===s.id?St:Bt)):d(Wt=>Wt.map(Bt=>Bt.id===s.id?St:Bt)),t({...s,pinCount:Ne})}},disabled:T,style:{width:"60px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:T?.6:1}})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-x-${K.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"X:"}),l.jsx("input",{id:`component-x-${K.id}`,name:`component-x-${K.id}`,type:"number",value:s.x.toFixed(2),onChange:ze=>{const Ne=parseFloat(ze.target.value)||0;t({...s,x:Ne})},disabled:T,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:T?.6:1}})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{htmlFor:`component-y-${K.id}`,style:{fontSize:"11px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"110px",flexShrink:0},children:"Y:"}),l.jsx("input",{id:`component-y-${K.id}`,name:`component-y-${K.id}`,type:"number",value:s.y.toFixed(2),onChange:ze=>{const Ne=parseFloat(ze.target.value)||0;t({...s,y:Ne})},disabled:T,style:{width:"90px",padding:"2px 3px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,fontSize:"11px",color:"#000",opacity:T?.6:1}})]}),l.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid #e0e0e0"},children:[l.jsx("label",{style:{display:"block",fontSize:"11px",fontWeight:600,color:"#333",marginBottom:"2px"},children:"Pin Connections:"}),c&&c.componentId===K.id&&l.jsxs("div",{style:{padding:"2px 3px",background:"#fff3cd",border:"1px solid #ffc107",borderRadius:2,marginBottom:"2px",fontSize:"11px",color:"#856404"},children:["Pin ",c.pinIndex+1," selected. Click on a via or pad to connect."]}),(()=>{const ze=Sp(K),Ct=(s.layer==="top"?n:r).find(Ln=>Ln.id===s.id),wt=Ct?.pinNames,pt=(e||Vc(K))?.properties?.pinNames,Ot=pt&&pt.length>0,Qe=Ot&&pt.includes("CHIP_DEPENDENT"),St=Ot&&!Qe,Wt=Qe,Bt=Ot;return l.jsx("div",{children:l.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"11px",marginTop:"2px"},children:[l.jsx("thead",{children:l.jsxs("tr",{style:{borderBottom:"1px solid #ddd",background:"#f5f5f5"},children:[l.jsx("th",{style:{padding:"2px 4px",textAlign:"left",fontWeight:600,fontSize:"11px",color:"#333",width:"20px"}}),l.jsx("th",{style:{padding:"2px 4px",textAlign:"left",fontWeight:600,fontSize:"11px",color:"#333",width:"40px"},children:"Pin"}),Bt&&l.jsx("th",{style:{padding:"2px 4px",textAlign:"left",fontWeight:600,fontSize:"11px",color:"#333",width:"70px"},children:"Pin Name"}),ze&&l.jsx("th",{style:{padding:"2px 4px",textAlign:"left",fontWeight:600,fontSize:"11px",color:"#333",width:"50px"},children:"Polarity"}),l.jsx("th",{style:{padding:"2px 4px",textAlign:"left",fontWeight:600,fontSize:"11px",color:"#333"},children:"Node ID"})]})}),l.jsx("tbody",{children:Array.from({length:s.pinCount},(Ln,Kt)=>{const rn=Ct?.pinConnections&&Ct.pinConnections.length>Kt?Ct.pinConnections[Kt]:"",un=Ct?.pinPolarities&&Ct.pinPolarities.length>Kt&&Ct.pinPolarities[Kt]||"",ot=wt&&Kt<wt.length?wt[Kt]:"",Zt=pt&&Kt<pt.length?pt[Kt]:"",sn=Zt==="CHIP_DEPENDENT",Ft=ot&&ot.trim()!==""?ot:sn?"":Zt,Jt=c&&c.componentId===K.id&&c.pinIndex===Kt;return l.jsxs("tr",{style:{cursor:T?"not-allowed":"pointer",background:Jt?"#e6f0ff":rn?"#d4edda":"#fff",borderBottom:"1px solid #eee"},onClick:yn=>{if(yn.target.tagName!=="SELECT"){if(T){alert("Cannot edit: Components are locked. Unlock components to edit them.");return}h(Jt?null:{componentId:K.id,pinIndex:Kt})}},title:rn?`Connected to: ${rn}`:"Select this pin, then click on a via or pad to connect",children:[l.jsx("td",{style:{padding:"2px 4px",textAlign:"center"},children:l.jsx("input",{id:`pin-radio-${K.id}-${Kt}`,name:`pin-radio-${K.id}`,type:"radio",checked:!!Jt,onChange:()=>{if(T){alert("Cannot edit: Components are locked. Unlock components to edit them.");return}h(Jt?null:{componentId:K.id,pinIndex:Kt})},disabled:T,style:{margin:0,cursor:T?"not-allowed":"pointer",opacity:T?.6:1,width:"10px",height:"10px"}})}),l.jsx("td",{style:{padding:"2px 4px",color:"#333",fontWeight:Jt?600:400,fontFamily:"monospace"},children:Kt+1}),(St||Wt)&&l.jsx("td",{style:{padding:"2px 4px",textAlign:"left"},children:St?l.jsx("select",{value:Ft||"",onChange:yn=>{if(T){alert("Cannot edit: Components are locked. Unlock components to edit them.");return}const _n=yn.target.value,Ut=(s.layer==="top"?n:r).find(zi=>zi.id===s.id);if(Ut){const Jn=[...Ut.pinNames||(pt?[...pt]:[])];for(;Jn.length<s.pinCount;)Jn.push("");Jn[Kt]=_n;const Lt={...Ut,pinNames:Jn};s.layer==="top"?o(Ht=>Ht.map(Et=>Et.id===s.id?Lt:Et)):d(Ht=>Ht.map(Et=>Et.id===s.id?Lt:Et))}},disabled:T,onClick:yn=>yn.stopPropagation(),onFocus:yn=>yn.stopPropagation(),style:{padding:"2px 4px",fontSize:"11px",border:"1px solid #ddd",borderRadius:2,background:"#fff",color:"#333",cursor:T?"not-allowed":"pointer",opacity:T?.6:1,width:"100%",fontStyle:"italic",minHeight:"18px"},children:pt&&pt.length>0?pt.filter(yn=>yn!=="CHIP_DEPENDENT").map((yn,_n)=>l.jsx("option",{value:yn,children:yn},_n)):l.jsx("option",{value:"",children:"-"})}):l.jsx("input",{type:"text",value:Ft||"",onChange:yn=>{if(T){alert("Cannot edit: Components are locked. Unlock components to edit them.");return}const _n=yn.target.value,Ut=(s.layer==="top"?n:r).find(zi=>zi.id===s.id);if(Ut){const Jn=[...Ut.pinNames||[]];for(;Jn.length<s.pinCount;)Jn.push("");Jn[Kt]=_n;const Lt={...Ut,pinNames:Jn};s.layer==="top"?o(Ht=>Ht.map(Et=>Et.id===s.id?Lt:Et)):d(Ht=>Ht.map(Et=>Et.id===s.id?Lt:Et))}},disabled:T,onClick:yn=>yn.stopPropagation(),onFocus:yn=>yn.stopPropagation(),placeholder:"Pin name",style:{padding:"1px 2px",fontSize:"11px",border:"1px solid #ddd",borderRadius:2,background:"#fff",color:"#333",width:"100%",opacity:T?.6:1,cursor:T?"not-allowed":"text"}})}),ze&&l.jsx("td",{style:{padding:"2px 4px",textAlign:"center"},children:rn?l.jsx("span",{style:{fontFamily:"monospace",fontWeight:600,color:un==="+"?"#d32f2f":un==="-"?"#1976d2":"#999"},children:un||"-"}):l.jsxs("select",{value:un??"",onChange:yn=>{if(T){alert("Cannot edit: Components are locked. Unlock components to edit them.");return}const _n=yn.target.value,Ut=(s.layer==="top"?n:r).find(zi=>zi.id===s.id);if(Ut){const Jn=[...Ut.pinPolarities||new Array(Ut.pinCount).fill("")];for(;Jn.length<Ut.pinCount;)Jn.push("");Jn[Kt]=_n;const Lt={...Ut,pinPolarities:Jn};s.layer==="top"?o(Ht=>Ht.map(Et=>Et.id===s.id?Lt:Et)):d(Ht=>Ht.map(Et=>Et.id===s.id?Lt:Et))}},disabled:T,onClick:yn=>yn.stopPropagation(),onFocus:yn=>yn.stopPropagation(),style:{padding:"1px 2px",fontSize:"11px",border:"1px solid #ddd",borderRadius:2,background:"#fff",cursor:T?"not-allowed":"pointer",opacity:T?.6:1,width:"100%",fontFamily:"monospace",fontWeight:600},children:[l.jsx("option",{value:"",children:"-"}),l.jsx("option",{value:"+",children:"+"}),l.jsx("option",{value:"-",children:"-"})]},`polarity-${K.id}-${Kt}-${un}`)}),l.jsx("td",{style:{padding:"2px 4px",color:rn?"#28a745":"#999",fontWeight:rn?600:400,fontFamily:"monospace"},children:rn||"-"})]},Kt)})})]})})})()]})]}),l.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"6px",padding:"6px",paddingRight:"24px",borderTop:"1px solid #e0e0e0",flexShrink:0},children:[l.jsx("button",{onClick:()=>{t(null),h(null)},disabled:T,style:{padding:"2px 5px",background:T?"#f5f5f5":"#fff",color:T?"#999":"#333",border:"1px solid #ddd",borderRadius:2,cursor:T?"not-allowed":"pointer",fontSize:"11px",opacity:T?.6:1},children:"Cancel"}),l.jsx("button",{onClick:yt,disabled:T,style:{padding:"2px 5px",background:T?"#f5f5f5":"#0b5fff",color:T?"#999":"#fff",border:"1px solid #ddd",borderRadius:2,cursor:T?"not-allowed":"pointer",fontSize:"11px",opacity:T?.6:1},children:"Save"})]}),Y&&l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10005},onClick:ze=>{ze.target===ze.currentTarget&&W(!1)},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"24px",minWidth:"400px",maxWidth:"600px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid #1f1f24"},onClick:ze=>ze.stopPropagation(),children:[l.jsxs("div",{style:{marginBottom:"16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[l.jsx("h3",{style:{margin:0,color:"#fff",fontSize:"18px",fontWeight:600},children:"How to Get a Google Gemini API Key"}),l.jsx("button",{onClick:()=>W(!1),style:{background:"transparent",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:0,width:"30px",height:"30px",display:"flex",alignItems:"center",justifyContent:"center"},title:"Close",children:""})]}),l.jsx("div",{style:{marginBottom:"20px",color:"#ddd",fontSize:"14px",lineHeight:"1.6"},children:l.jsxs("p",{style:{margin:"0 0 12px 0"},children:["To get a Google Gemini API key, go to"," ",l.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",style:{color:"#4CAF50",textDecoration:"underline"},children:"Google AI Studio (aistudio.google.com/app/apikey)"}),', sign in with your Google account, and click "Get API key" or "Create API key" in the Dashboard to generate a key for a new or existing Google Cloud project, then copy it and store it securely.']})}),l.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:l.jsx("button",{onClick:()=>W(!1),style:{padding:"8px 16px",background:"#4CAF50",color:"#fff",border:"1px solid #45a049",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"OK"})})]})}),l.jsx("div",{onMouseDown:jt,style:{position:"absolute",bottom:0,right:0,width:"20px",height:"20px",cursor:"nwse-resize",background:"linear-gradient(135deg, transparent 0%, transparent 40%, #ccc 40%, #ccc 45%, transparent 45%, transparent 55%, #ccc 55%, #ccc 60%, transparent 60%)",zIndex:1001},title:"Drag to resize"})]}),I&&l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10005},onClick:ze=>{ze.target===ze.currentTarget&&(J(!1),M?.())},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"24px",minWidth:"500px",maxWidth:"600px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid #1f1f24"},onClick:ze=>ze.stopPropagation(),children:[l.jsxs("div",{style:{marginBottom:"16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[l.jsx("h3",{style:{margin:0,color:"#fff",fontSize:"18px",fontWeight:600},children:"Google Gemini API Configuration"}),l.jsx("button",{onClick:()=>J(!1),style:{background:"transparent",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:0,width:"30px",height:"30px",display:"flex",alignItems:"center",justifyContent:"center"},title:"Close",children:""})]}),l.jsxs("div",{style:{marginBottom:"20px",color:"#ddd",fontSize:"14px",lineHeight:"1.6"},children:[l.jsx("p",{style:{margin:"0 0 12px 0",fontWeight:600,color:"#fff"},children:"Benefits of Adding Your API Key:"}),l.jsxs("ul",{style:{margin:"0 0 16px 0",paddingLeft:"20px"},children:[l.jsx("li",{children:"Automatically extract pin names and component properties (voltage, current, temperature, etc.) from datasheet PDFs"}),l.jsx("li",{children:"Get datasheet summary for component notes"}),l.jsx("li",{children:"Save time by avoiding manual data entry"})]}),l.jsx("p",{style:{margin:"0 0 12px 0",fontWeight:600,color:"#fff"},children:"How to Get Your Free API Key:"}),l.jsxs("p",{style:{margin:"0 0 16px 0"},children:["Go to"," ",l.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",style:{color:"#4CAF50",textDecoration:"underline"},children:"Google AI Studio (aistudio.google.com/app/apikey)"}),', sign in with your Google account, and click "Get API key" or "Create API key" in the Dashboard to generate a key for a new or existing Google Cloud project, then copy it and paste it below.']}),l.jsxs("div",{style:{marginBottom:"12px"},children:[l.jsx("label",{style:{display:"block",marginBottom:"6px",color:"#fff",fontSize:"13px",fontWeight:600},children:"Enter Your API Key:"}),l.jsx("input",{type:"password",value:se,onChange:ze=>Ae(ze.target.value),placeholder:"Paste your Gemini API key here",style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid #555",borderRadius:"4px",background:"#1f1f24",color:"#fff",boxSizing:"border-box"},autoFocus:!0})]}),l.jsxs("div",{style:{marginBottom:"12px"},children:[l.jsx("label",{style:{display:"block",marginBottom:"6px",color:"#fff",fontSize:"13px",fontWeight:600},children:"Select Gemini Model:"}),l.jsxs("select",{value:ue,onChange:ze=>E(ze.target.value),style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid #555",borderRadius:"4px",background:"#1f1f24",color:"#fff",boxSizing:"border-box",cursor:"pointer"},children:[l.jsx("option",{value:"gemini-2.5-flash-lite",children:"gemini-2.5-flash-lite (Lightweight, Fast)"}),l.jsx("option",{value:"gemini-2.5-flash",children:"gemini-2.5-flash (Fast, Balanced)"}),l.jsx("option",{value:"gemini-2.5-pro",children:"gemini-2.5-pro (High Quality, Slower)"}),l.jsx("option",{value:"gemini-1.5-flash",children:"gemini-1.5-flash (Legacy Fast)"}),l.jsx("option",{value:"gemini-1.5-pro",children:"gemini-1.5-pro (Legacy High Quality)"})]}),l.jsx("p",{style:{margin:"6px 0 0 0",color:"#aaa",fontSize:"12px",lineHeight:"1.4"},children:"Choose the model based on your needs: Flash models are faster and use fewer tokens, while Pro models provide higher quality responses."})]}),l.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"#1f1f24",borderRadius:"4px",border:"1px solid #444"},children:[l.jsx("p",{style:{margin:"0 0 8px 0",fontWeight:600,color:"#fff",fontSize:"13px"},children:"Storage & Security Information:"}),l.jsxs("p",{style:{margin:"0 0 8px 0",color:"#ddd",fontSize:"12px",lineHeight:"1.5"},children:["Your API key will be stored in your browser's ",l.jsx("strong",{children:"localStorage"})," under the key ",l.jsx("code",{style:{background:"#2b2b31",padding:"2px 4px",borderRadius:"2px",color:"#4CAF50"},children:"'geminiApiKey'"}),"."]}),l.jsx("p",{style:{margin:"0 0 8px 0",color:"#ffaa00",fontSize:"12px",lineHeight:"1.5",fontWeight:600},children:" Security Warnings:"}),l.jsxs("ul",{style:{margin:"0 0 8px 0",paddingLeft:"20px",color:"#ddd",fontSize:"12px",lineHeight:"1.5"},children:[l.jsx("li",{children:"localStorage is accessible via browser DevTools"}),l.jsx("li",{children:"Do not use on shared or public computers"}),l.jsx("li",{children:"Malicious browser extensions could access your key"}),l.jsx("li",{children:"XSS attacks could potentially read your key"}),l.jsx("li",{children:"The key is stored in plain text (not encrypted)"})]}),l.jsx("p",{style:{margin:"0",color:"#aaa",fontSize:"11px",lineHeight:"1.4",fontStyle:"italic"},children:"For maximum security, consider using API key restrictions in Google Cloud Console and regularly rotating your keys."})]})]}),l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px"},children:[l.jsx("button",{onClick:oe,disabled:!L,style:{padding:"8px 16px",background:L?"#d32f2f":"#444",color:"#fff",border:"1px solid #666",borderRadius:6,cursor:L?"pointer":"not-allowed",fontSize:"14px",fontWeight:600,opacity:L?1:.5},title:L?"Remove API key from browser localStorage":"No API key stored",children:"Remove API Key"}),l.jsxs("div",{style:{display:"flex",gap:"8px"},children:[l.jsx("button",{onClick:()=>{J(!1),M?.()},style:{padding:"8px 16px",background:"#555",color:"#fff",border:"1px solid #666",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"Cancel"}),l.jsx("button",{onClick:()=>{ee(),J(!1),M?.()},style:{padding:"8px 16px",background:"#4CAF50",color:"#fff",border:"1px solid #45a049",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"Save API Key"})]})]})]})}),ie&&Z&&l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10006},onClick:ze=>{ze.target===ze.currentTarget&&le(!1)},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"24px",minWidth:"600px",maxWidth:"90vw",maxHeight:"90vh",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"2px solid #2196F3",display:"flex",flexDirection:"column"},onClick:ze=>ze.stopPropagation(),children:[l.jsxs("div",{style:{marginBottom:"16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[l.jsx("h3",{style:{margin:0,color:"#fff",fontSize:"18px",fontWeight:600},children:"Gemini API Response"}),l.jsx("button",{onClick:()=>{le(!1),Ce(null)},style:{background:"transparent",border:"none",color:"#fff",fontSize:"24px",cursor:"pointer",padding:0,width:"30px",height:"30px",display:"flex",alignItems:"center",justifyContent:"center"},title:"Close",children:""})]}),l.jsx("div",{style:{marginBottom:"20px",color:"#ddd",fontSize:"13px",lineHeight:"1.6",overflow:"auto",flex:1,padding:"12px",background:"#1f1f24",borderRadius:"4px",fontFamily:"monospace",whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:"60vh"},children:Z}),l.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[l.jsx("button",{onClick:()=>{navigator.clipboard.writeText(Z||""),alert("Response copied to clipboard")},style:{padding:"8px 16px",background:"#555",color:"#fff",border:"1px solid #666",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"Copy to Clipboard"}),l.jsx("button",{onClick:()=>{le(!1),Ce(null)},style:{padding:"8px 16px",background:"#4CAF50",color:"#fff",border:"1px solid #45a049",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"Close"})]})]})}),l.jsx(_b,{visible:mt.visible,title:mt.title,message:mt.message,type:mt.type,onClose:()=>{Mt({visible:!1,title:"",message:"",type:"info"}),ie||Ce(null)},onShowResponse:mt.onShowResponse})]})};function jT(s){if(s.baseType)return s.baseType;switch(s.category){case"Capacitors":return"Capacitor";case"Diodes":return"Diode";case"Resistors":return"Resistor";case"Semiconductors":return"Semiconductor";case"Passive Components":return"Passive";case"Power & Energy":return"PowerEnergy";case"Connectors & Switches":return s.type==="Switch"||s.subcategory==="Switch"?"Switch":"Connector";case"Other":return s.type==="Transformer"?"Transformer":"Other";default:return"Other"}}const NT=o0.components,PT=NT.map(s=>{const e=`${s.category}:${s.subcategory}:${s.type}`,t=jT(s);return{...s,key:e,baseType:t}}),Iv=new Map;PT.forEach(s=>{Iv.set(s.key,s)});function ET(s){if(s)return Iv.get(s)}const Um=s=>{const{category:e,subcategory:t,type:n,designator:r}=s;let o,d;switch(e){case"Capacitors":t==="Electrolytic"?o="Electrolytic Capacitor":t==="Film"?o="Film Capacitor":(o="Capacitor",t==="Tantalum"&&(d="Tantalum"));break;case"Diodes":o="Diode",t==="LED"?d="LED":t==="Infrared"?d="Infrared":t==="Photodiode"?d="Photodiode":t==="Schottky"?d="Schottky":t==="Zener"?d="Zener":d="Standard";break;case"Resistors":t==="Network"?(o="ResistorNetwork",d="Network"):t==="Thermistor"?(o="Thermistor",d="Thermistor"):t==="Variable"?(o="VariableResistor",d="Potentiometer"):t==="Varistor"?(o="VariableResistor",d="Varistor"):o="Resistor";break;case"Semiconductors":t==="BJT"||t==="MOSFET"||t==="JFET"?o="Transistor":o="IntegratedCircuit";break;case"Passive Components":n==="Inductor"?o="Inductor":n==="FerriteBead"?o="FerriteBead":o="Crystal";break;case"Power & Energy":t==="Battery"?o="Battery":t==="Power Supply"?o="PowerSupply":o="Fuse";break;case"Connectors & Switches":t==="Connector"?o="Connector":t==="Jumper"?o="Jumper":t==="Switch"?o="Switch":o="Relay";break;case"Other":t==="Transformer"?o="Transformer":t==="Speaker"?o="Speaker":t==="Motor"?o="Motor":t==="Test Point"?o="TestPoint":t==="Vacuum Tube"?o="VacuumTube":(o="GenericComponent",t==="Attenuator"?d="Attenuator":t==="Circuit Breaker"?d="CircuitBreaker":t==="Thermocouple"?d="Thermocouple":t==="Tuner"&&(d="Tuner"));break;default:o="GenericComponent";break}const c=`${e}:${t}:${n}:${r}`,h=`${e}:${t}:${n}`,f=ET(h);return{componentType:o,designator:r,subtype:d,uniqueKey:c,componentDefinition:s,dataDrivenDefinition:f}},zv=Wu.reduce((s,e)=>(s[e.category]||(s[e.category]=[]),s[e.category].push(e),s),{});Object.values(zv).forEach(s=>{s.sort((e,t)=>e.displayName.localeCompare(t.displayName))});const RT=({visible:s,selectedLayer:e,selectedComponentType:t,selectedComponentKey:n,onLayerChange:r,onComponentTypeChange:o,onClose:d})=>{const[c,h]=U.useState(""),[f,m]=U.useState(null),[y,A]=U.useState(!1),v=U.useRef({x:0,y:0}),N=U.useRef(null),T=U.useRef(null);U.useEffect(()=>{s&&f===null&&m({x:window.innerWidth-400-8,y:130})},[s,f]),U.useEffect(()=>{if(s&&T.current){const B=setTimeout(()=>{T.current?.focus(),T.current?.select()},100);return()=>clearTimeout(B)}},[s]);const _=U.useCallback(B=>{const q=B.target;if(!(q.tagName==="BUTTON"||q.tagName==="INPUT"||q.closest("button")||q.closest("input"))&&N.current){const G=N.current.getBoundingClientRect();v.current={x:B.clientX-G.left,y:B.clientY-G.top},A(!0),B.preventDefault()}},[]);U.useEffect(()=>{if(!y)return;const B=G=>{const X=G.clientX-v.current.x,O=G.clientY-v.current.y,Y=N.current?.offsetWidth||400,W=N.current?.offsetHeight||600,I=Math.max(0,Math.min(X,window.innerWidth-Y)),J=Math.max(0,Math.min(O,window.innerHeight-W));m({x:I,y:J})},q=()=>{A(!1)};return document.addEventListener("mousemove",B),document.addEventListener("mouseup",q),()=>{document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",q)}},[y]);const b=U.useMemo(()=>{if(!c.trim())return()=>!0;const B=c.toLowerCase();return q=>!!(q.searchText&&q.searchText.toLowerCase().includes(B)||q.displayName&&q.displayName.toLowerCase().includes(B)||q.description&&q.description.toLowerCase().includes(B)||q.category&&q.category.toLowerCase().includes(B)||q.subcategory&&q.subcategory.toLowerCase().includes(B)||q.designator&&q.designator.toLowerCase().includes(B)||q.type&&q.type.toLowerCase().includes(B)||q.resolvedTypeName&&q.resolvedTypeName.toLowerCase().includes(B))},[c]),H=U.useMemo(()=>c.trim()?Wu.filter(B=>{const q=Um(B);return b({category:B.category,type:q.componentType,subcategory:B.subcategory,designator:B.designator,displayName:B.displayName,description:B.description,resolvedTypeName:wc(q.componentType),searchText:B.searchText})}):Wu,[c,b]);if(!s)return null;const R={position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"transparent",display:"flex",alignItems:"flex-start",justifyContent:"flex-end",zIndex:10005,pointerEvents:"none"},M={padding:"20px",overflow:"auto",flex:1};return l.jsx("div",{style:R,onClick:B=>B.stopPropagation(),children:l.jsxs("div",{ref:N,onClick:B=>B.stopPropagation(),style:{position:"fixed",top:f?`${f.y}px`:void 0,left:f?`${f.x}px`:void 0,backgroundColor:"#fff",borderRadius:8,minWidth:"300px",maxWidth:"400px",width:"fit-content",maxHeight:"80%",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",border:"1px solid #ddd",zIndex:10005,display:"flex",flexDirection:"column",pointerEvents:"auto",transform:"none"},children:[l.jsxs("div",{onMouseDown:_,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px",borderBottom:"1px solid #e0e0e0",background:"#888",cursor:y?"grabbing":"grab",userSelect:"none",flexShrink:0},children:[l.jsx("h2",{style:{margin:0,fontSize:"12px",color:"#fff",fontWeight:600},children:"Select Component"}),l.jsx("button",{type:"button",onMouseDown:B=>{B.stopPropagation()},onClick:B=>{B.stopPropagation(),d()},style:{background:"transparent",border:"none",fontSize:"14px",cursor:"pointer",color:"#fff",padding:0,width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]}),l.jsxs("div",{style:M,children:[l.jsx("div",{style:{marginBottom:"16px"},onClick:B=>B.stopPropagation(),children:l.jsx("input",{ref:T,type:"text",placeholder:"Search by Component Type...",value:c,onChange:B=>h(B.target.value),onClick:B=>B.stopPropagation(),onMouseDown:B=>B.stopPropagation(),style:{width:"100%",padding:"8px 12px",fontSize:"13px",border:"1px solid #ddd",borderRadius:4,color:"#333",backgroundColor:"#fff",boxSizing:"border-box"}})}),l.jsxs("div",{style:{marginBottom:"20px",paddingBottom:"16px",borderBottom:"2px solid #eee"},onClick:B=>B.stopPropagation(),children:[l.jsx("div",{style:{marginBottom:"8px",fontSize:"14px",fontWeight:600,color:"#333"},children:"Layer:"}),l.jsxs("div",{style:{display:"flex",gap:"16px"},children:[l.jsxs("label",{onClick:B=>B.stopPropagation(),onMouseDown:B=>B.stopPropagation(),style:{display:"flex",alignItems:"center",cursor:"pointer",fontSize:"14px",color:"#333"},children:[l.jsx("input",{type:"radio",name:"componentLayer",checked:e==="top",onChange:()=>r("top"),onClick:B=>B.stopPropagation(),onMouseDown:B=>B.stopPropagation(),style:{marginRight:"8px",width:"20px",height:"20px",cursor:"pointer",accentColor:"#0066cc",appearance:"none",WebkitAppearance:"none",MozAppearance:"none",border:e==="top"?"2px solid #0066cc":"2px solid #999",borderRadius:"50%",backgroundColor:e==="top"?"#0066cc":"transparent",position:"relative"}}),"Top"]}),l.jsxs("label",{onClick:B=>B.stopPropagation(),onMouseDown:B=>B.stopPropagation(),style:{display:"flex",alignItems:"center",cursor:"pointer",fontSize:"14px",color:"#333"},children:[l.jsx("input",{type:"radio",name:"componentLayer",checked:e==="bottom",onChange:()=>r("bottom"),onClick:B=>B.stopPropagation(),onMouseDown:B=>B.stopPropagation(),style:{marginRight:"8px",width:"20px",height:"20px",cursor:"pointer",accentColor:"#0066cc",appearance:"none",WebkitAppearance:"none",MozAppearance:"none",border:e==="bottom"?"2px solid #0066cc":"2px solid #999",borderRadius:"50%",backgroundColor:e==="bottom"?"#0066cc":"transparent",position:"relative"}}),"Bottom"]})]})]}),l.jsxs("div",{children:[l.jsx("div",{style:{marginBottom:"12px",fontSize:"14px",fontWeight:600,color:"#333"},children:"Component Type:"}),l.jsx("div",{style:{maxHeight:"calc(80vh - 280px)",overflowY:"auto"},children:c.trim()?H.length>0?H.map(B=>{const q=Um(B),G=q.uniqueKey||`${B.category}:${B.subcategory}:${B.type}:${B.designator}`,X=n===G,O=`${B.designator} - ${B.displayName}`;return l.jsxs("label",{onClick:Y=>{Y.stopPropagation(),o(q.componentType,G,q)},onMouseDown:Y=>Y.stopPropagation(),style:{display:"block",width:"100%",textAlign:"left",padding:"8px 12px",marginBottom:"4px",background:X?"#e6f0ff":"#fff",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",fontSize:"12px",color:"#333"},children:[l.jsx("input",{type:"radio",name:"componentType-search",checked:X,onChange:()=>o(q.componentType,G,q),onClick:Y=>Y.stopPropagation(),onMouseDown:Y=>Y.stopPropagation(),style:{marginRight:"10px",width:"20px",height:"20px",cursor:"pointer",appearance:"none",WebkitAppearance:"none",MozAppearance:"none",border:X?"2px solid #0066cc":"2px solid #999",borderRadius:"50%",backgroundColor:X?"#0066cc":"transparent",position:"relative",flexShrink:0}}),l.jsx("strong",{children:O})]},G)}):l.jsxs("div",{style:{padding:"12px",color:"#666",fontSize:"12px",textAlign:"center"},children:['No matches found for "',c,'"']}):Object.entries(zv).map(([B,q])=>q.length===0?null:l.jsxs("div",{style:{marginBottom:"12px"},children:[l.jsx("div",{style:{fontSize:"13px",fontWeight:600,color:"#333",padding:"6px 8px",marginBottom:"4px",backgroundColor:"#f5f5f5",borderRadius:4},children:B}),l.jsx("div",{style:{marginLeft:"8px"},children:q.map(G=>{const X=Um(G),O=X.uniqueKey||`${G.category}:${G.subcategory}:${G.type}:${G.designator}`,Y=n===O,W=`${G.designator} - ${G.displayName}`;return l.jsxs("label",{onClick:I=>{I.stopPropagation(),o(X.componentType,O,X)},onMouseDown:I=>I.stopPropagation(),style:{display:"block",width:"100%",textAlign:"left",padding:"6px 12px",marginBottom:"2px",background:Y?"#e6f0ff":"#fff",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",fontSize:"12px",color:"#333"},children:[l.jsx("input",{type:"radio",name:`componentType-${B}`,checked:Y,onChange:()=>o(X.componentType,O,X),onMouseDown:I=>I.stopPropagation(),style:{marginRight:"10px",width:"20px",height:"20px",cursor:"pointer",appearance:"none",WebkitAppearance:"none",MozAppearance:"none",border:Y?"2px solid #0066cc":"2px solid #999",borderRadius:"50%",backgroundColor:Y?"#0066cc":"transparent",position:"relative",flexShrink:0}}),W]},O)})})]},B))})]})]})]})})},DT=({visible:s,onClose:e,powerBuses:t,setPowerBuses:n,editingPowerBusId:r,setEditingPowerBusId:o,powers:d})=>{const[c,h]=U.useState(null),[f,m]=U.useState(!1),[y,A]=U.useState(null),v=U.useRef(null);U.useEffect(()=>{s&&!c&&h({x:window.innerWidth/2-140,y:window.innerHeight/2-200})},[s,c]),U.useEffect(()=>{if(!f)return;const M=q=>{c&&y&&h({x:q.clientX-y.x,y:q.clientY-y.y})},B=()=>{m(!1),A(null)};return window.addEventListener("mousemove",M),window.addEventListener("mouseup",B),()=>{window.removeEventListener("mousemove",M),window.removeEventListener("mouseup",B)}},[f,c,y]);const N=t.filter(M=>M.id!==r),T=t.find(M=>M.id===r);if(!s)return null;const _=[...N].sort((M,B)=>{const q=O=>{const Y=O.match(/([+-]?)(\d+\.?\d*)/);if(Y){const W=Y[1]||"+",I=parseFloat(Y[2]);return{absValue:Math.abs(I),isNegative:W==="-"}}return{absValue:1/0,isNegative:!1}},G=q(M.voltage),X=q(B.voltage);return G.absValue!==X.absValue?G.absValue-X.absValue:G.isNegative!==X.isNegative?G.isNegative?-1:1:0}),b=T?[..._,T]:_,H=()=>{const M={id:`powerbus-${Date.now()}-${Math.random()}`,name:"New Power Bus",voltage:"+0.0",color:"#ff0000"};n(B=>[...B,M]),o(M.id)},R=M=>{const B=M.target;B.tagName==="BUTTON"||B.tagName==="INPUT"||B.closest("button")||B.closest("input")||c&&(A({x:M.clientX-c.x,y:M.clientY-c.y}),m(!0),M.preventDefault())};return l.jsxs("div",{ref:v,style:{position:"fixed",top:c?`${c.y}px`:"50%",left:c?`${c.x}px`:"50%",transform:c?"none":"translate(-50%, -50%)",background:"#fff",border:"1px solid #0b5fff",borderRadius:4,boxShadow:"0 2px 6px rgba(0,0,0,0.15)",zIndex:1e3,minWidth:"280px",maxWidth:"320px",maxHeight:"80vh",display:"flex",flexDirection:"column",cursor:f?"grabbing":"default"},children:[l.jsxs("div",{onMouseDown:R,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px",borderBottom:"1px solid #e0e0e0",background:"#888",cursor:f?"grabbing":"grab",userSelect:"none",flexShrink:0},children:[l.jsx("h2",{style:{margin:0,fontSize:"12px",color:"#fff",fontWeight:600},children:"Manage Power Buses"}),l.jsx("button",{onClick:e,style:{background:"transparent",border:"none",fontSize:"14px",cursor:"pointer",color:"#fff",padding:0,width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]}),l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px",padding:"6px 20px 6px 6px",overflowY:"auto",flex:1,minHeight:0},children:b.map(M=>{const B=t.find(O=>O.id===M.id)||M,q=t.findIndex(O=>O.id===M.id),G=t.some(O=>O.name===B.name&&O.id!==M.id),X=t.some(O=>O.voltage===B.voltage&&O.id!==M.id);return l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px",padding:"4px",marginBottom:"4px",background:"#f9f9f9",borderRadius:4,border:"1px solid #e0e0e0"},children:l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsxs("div",{style:{flex:1,minWidth:0,display:"flex",flexDirection:"column",gap:"4px"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{style:{fontSize:"9px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"50px",flexShrink:0},children:"Name:"}),l.jsx("input",{type:"text",value:B.name,onChange:O=>{const Y=O.target.value;if(!t.some(I=>I.name===Y&&I.id!==M.id)){const I=[...t];q>=0&&(I[q]={...B,name:Y},n(I))}},placeholder:"e.g., +5VDC",style:{flex:1,padding:"2px 3px",border:G?"1px solid #ff0000":"1px solid #ddd",borderRadius:2,fontSize:"10px",background:"#f5f5f5",color:"#000"}})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{style:{fontSize:"9px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"50px",flexShrink:0},children:"Value:"}),l.jsx("input",{type:"text",inputMode:"decimal",value:B.voltage,onChange:O=>{const Y=O.target.value;if(Y===""||/^[+-]?\d*\.?\d*$/.test(Y)){const W=[...t];q>=0&&(W[q]={...B,voltage:Y},n(W))}},onBlur:O=>{const Y=O.target.value.trim();if(Y==="")return;const W=parseFloat(Y);if(!isNaN(W)){const I=W>=0?"+":"-",J=Math.abs(W),Z=`${I}${J.toFixed(1).replace(/\.?0+$/,"")}`,Ce=[...t];q>=0&&(Ce[q]={...B,voltage:Z},n(Ce))}},placeholder:"e.g., +5.0",style:{flex:1,padding:"2px 3px",border:X?"1px solid #ff0000":"1px solid #ddd",borderRadius:2,fontSize:"10px",background:"#f5f5f5",color:"#000"}})]})]}),l.jsx("input",{type:"color",value:B.color,onChange:O=>{const Y=[...t];q>=0&&(Y[q]={...B,color:O.target.value},n(Y))},style:{width:"24px",height:"24px",border:"1px solid #ccc",borderRadius:2,cursor:"pointer",flexShrink:0},title:"Color"}),l.jsx("button",{onClick:()=>{const O=d.filter(Y=>Y.powerBusId===M.id);if(O.length>0){alert(`Cannot delete: ${O.length} power node(s) are using this bus. Remove or reassign them first.`);return}n(Y=>Y.filter(W=>W.id!==M.id))},style:{padding:"2px 6px",background:"#f5f5f5",color:"#333",border:"1px solid #ddd",borderRadius:2,cursor:"pointer",fontSize:"9px",flexShrink:0},children:"Delete"})]})},M.id)})}),l.jsxs("div",{style:{padding:"6px",borderTop:"1px solid #e0e0e0",display:"flex",gap:"4px",flexShrink:0},children:[l.jsx("button",{onClick:H,style:{flex:1,padding:"4px 8px",background:"#f0f0f0",color:"#333",border:"1px solid #ccc",borderRadius:2,cursor:"pointer",fontSize:"10px"},children:"+ Add Power Bus"}),l.jsx("button",{onClick:e,style:{flex:1,padding:"4px 8px",background:"#0b5fff",color:"#fff",border:"none",borderRadius:2,cursor:"pointer",fontSize:"10px",fontWeight:500},children:"Close"})]})]})},LT=({visible:s,onClose:e,groundBuses:t,setGroundBuses:n,editingGroundBusId:r,setEditingGroundBusId:o,grounds:d})=>{const[c,h]=U.useState(null),[f,m]=U.useState(!1),[y,A]=U.useState(null),v=U.useRef(null);U.useEffect(()=>{s&&!c&&h({x:window.innerWidth/2-140,y:window.innerHeight/2-200})},[s,c]),U.useEffect(()=>{if(!f)return;const M=q=>{c&&y&&h({x:q.clientX-y.x,y:q.clientY-y.y})},B=()=>{m(!1),A(null)};return window.addEventListener("mousemove",M),window.addEventListener("mouseup",B),()=>{window.removeEventListener("mousemove",M),window.removeEventListener("mouseup",B)}},[f,c,y]);const N=t.filter(M=>M.id!==r),T=t.find(M=>M.id===r);if(!s)return null;const _=[...N].sort((M,B)=>M.name.localeCompare(B.name)),b=T?[..._,T]:_,H=()=>{const M={id:`groundbus-${Date.now()}-${Math.random()}`,name:"New Ground Bus",color:"#000000"};n(B=>[...B,M]),o(M.id)},R=M=>{const B=M.target;B.tagName==="BUTTON"||B.tagName==="INPUT"||B.closest("button")||B.closest("input")||c&&(A({x:M.clientX-c.x,y:M.clientY-c.y}),m(!0),M.preventDefault())};return l.jsxs("div",{ref:v,style:{position:"fixed",top:c?`${c.y}px`:"50%",left:c?`${c.x}px`:"50%",transform:c?"none":"translate(-50%, -50%)",background:"#fff",border:"1px solid #0b5fff",borderRadius:4,boxShadow:"0 2px 6px rgba(0,0,0,0.15)",zIndex:1e3,minWidth:"280px",maxWidth:"320px",maxHeight:"80vh",display:"flex",flexDirection:"column",cursor:f?"grabbing":"default"},children:[l.jsxs("div",{onMouseDown:R,style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px",borderBottom:"1px solid #e0e0e0",background:"#888",cursor:f?"grabbing":"grab",userSelect:"none",flexShrink:0},children:[l.jsx("h2",{style:{margin:0,fontSize:"12px",color:"#fff",fontWeight:600},children:"Manage Ground Buses"}),l.jsx("button",{onClick:e,style:{background:"transparent",border:"none",fontSize:"14px",cursor:"pointer",color:"#fff",padding:0,width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]}),l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px",padding:"6px 20px 6px 6px",overflowY:"auto",flex:1,minHeight:0},children:b.map(M=>{const B=t.find(X=>X.id===M.id)||M,q=t.findIndex(X=>X.id===M.id),G=t.some(X=>X.name===B.name&&X.id!==M.id);return l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",padding:"4px",marginBottom:"4px",background:"#f9f9f9",borderRadius:4,border:"1px solid #e0e0e0"},children:[l.jsx("div",{style:{flex:1,minWidth:0},children:l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx("label",{style:{fontSize:"9px",fontWeight:600,color:"#333",whiteSpace:"nowrap",width:"50px",flexShrink:0},children:"Name:"}),l.jsx("input",{type:"text",value:B.name,onChange:X=>{const O=X.target.value;if(!t.some(W=>W.name===O&&W.id!==M.id)){const W=[...t];q>=0&&(W[q]={...B,name:O},n(W))}},placeholder:"e.g., GND, Earth",style:{flex:1,padding:"2px 3px",border:G?"1px solid #ff0000":"1px solid #ddd",borderRadius:2,fontSize:"10px",background:"#f5f5f5",color:"#000"}})]})}),l.jsx("input",{type:"color",value:B.color,onChange:X=>{const O=[...t];q>=0&&(O[q]={...B,color:X.target.value},n(O))},style:{width:"24px",height:"24px",border:"1px solid #ccc",borderRadius:2,cursor:"pointer",flexShrink:0},title:"Color"}),l.jsx("button",{onClick:()=>{const X=d.filter(O=>O.groundBusId===M.id);if(X.length>0){alert(`Cannot delete: ${X.length} ground node(s) are using this bus. Remove or reassign them first.`);return}n(O=>O.filter(Y=>Y.id!==M.id))},style:{padding:"2px 6px",background:"#f5f5f5",color:"#333",border:"1px solid #ddd",borderRadius:2,cursor:"pointer",fontSize:"9px",flexShrink:0},children:"Delete"})]},M.id)})}),l.jsxs("div",{style:{padding:"6px",borderTop:"1px solid #e0e0e0",display:"flex",gap:"4px",flexShrink:0},children:[l.jsx("button",{onClick:H,style:{flex:1,padding:"4px 8px",background:"#f0f0f0",color:"#333",border:"1px solid #ccc",borderRadius:2,cursor:"pointer",fontSize:"10px"},children:"+ Add Ground Bus"}),l.jsx("button",{onClick:e,style:{flex:1,padding:"4px 8px",background:"#0b5fff",color:"#fff",border:"none",borderRadius:2,cursor:"pointer",fontSize:"10px",fontWeight:500},children:"Close"})]})]})},MT=({visible:s,onClose:e,autoAssignDesignators:t,setAutoAssignDesignators:n,useGlobalDesignatorCounters:r,setUseGlobalDesignatorCounters:o})=>s?l.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#fff",border:"1px solid #ddd",borderRadius:6,padding:"16px",zIndex:1e3,minWidth:"300px",maxWidth:"400px",boxShadow:"0 2px 6px rgba(0,0,0,0.15)"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[l.jsx("h2",{style:{margin:0,fontSize:"14px",fontWeight:600,color:"#222"},children:"Manage Designators"}),l.jsx("button",{onClick:e,style:{background:"transparent",border:"none",fontSize:"18px",cursor:"pointer",color:"#666",padding:0,width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]}),l.jsxs("div",{style:{marginBottom:"16px"},children:[l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"13px",color:"#333",marginBottom:"12px"},children:[l.jsx("input",{type:"checkbox",checked:t,onChange:d=>{n(d.target.checked)},style:{width:"16px",height:"16px",cursor:"pointer"}}),l.jsx("span",{children:"Automatically assign designators"})]}),l.jsx("div",{style:{marginTop:"8px",padding:"8px",background:"#f5f5f5",borderRadius:4,fontSize:"11px",color:"#666",lineHeight:"1.4",marginBottom:"12px"},children:t?l.jsx("div",{children:"When enabled, new components automatically receive sequential designators (e.g., C1, C2, C3 for Capacitors; R1, R2, R3 for Resistors)."}):l.jsx("div",{children:"When disabled, you must manually assign designators to each component. The designator field will be empty when components are created."})}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"13px",color:"#333"},children:[l.jsx("input",{type:"checkbox",checked:r,onChange:d=>{o(d.target.checked)},style:{width:"16px",height:"16px",cursor:"pointer"}}),l.jsx("span",{children:"Use global designator counters"})]}),l.jsx("div",{style:{marginTop:"8px",padding:"8px",background:"#f5f5f5",borderRadius:4,fontSize:"11px",color:"#666",lineHeight:"1.4"},children:r?l.jsx("div",{children:"When ON, designators continue from global counters across all projects. New components start with the next value from the global counter (e.g., if global counter is C10, new capacitor will be C11)."}):l.jsx("div",{children:"When OFF (default), designators start at 1 for each project. Each project maintains its own independent designator sequence (e.g., C1, C2, C3...)."})})]}),l.jsx("button",{onClick:e,style:{width:"100%",padding:"6px 12px",background:"#f0f0f0",color:"#333",border:"1px solid #ccc",borderRadius:4,cursor:"pointer",fontSize:"12px"},children:"Close"})]}):null,e2=({visible:s,title:e,message:t,onYes:n,onNo:r,onCancel:o,yesButtonRef:d})=>s?l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10001},onClick:c=>{c.target===c.currentTarget&&o()},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"24px",minWidth:"400px",maxWidth:"500px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid #1f1f24"},onClick:c=>c.stopPropagation(),children:[l.jsx("h2",{style:{margin:"0 0 16px 0",fontSize:"18px",fontWeight:600,color:"#f2f2f2"},children:e}),l.jsx("p",{style:{margin:"0 0 24px 0",fontSize:"14px",color:"#e0e0e0",lineHeight:"1.5"},children:t}),l.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[l.jsx("button",{onClick:o,style:{padding:"8px 16px",background:"#444",color:"#f2f2f2",border:"1px solid #555",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:500},children:"Cancel"}),l.jsx("button",{onClick:r,style:{padding:"8px 16px",background:"#555",color:"#f2f2f2",border:"1px solid #666",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:500},children:"No"}),l.jsx("button",{ref:d,onClick:n,style:{padding:"8px 16px",background:"#4CAF50",color:"#fff",border:"1px solid #45a049",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},autoFocus:!0,children:"Yes"})]})]})}):null,IT=({visible:s,size:e,onSizeChange:t,onApply:n,onCancel:r})=>{const o=U.useRef(null);if(U.useEffect(()=>{s&&o.current&&(o.current.focus(),o.current.select())},[s]),!s)return null;const d=[2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32];return l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10003},onClick:c=>{c.target===c.currentTarget&&r()},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"24px",minWidth:"300px",maxWidth:"400px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid #1f1f24"},onClick:c=>c.stopPropagation(),children:[l.jsx("h2",{style:{margin:"0 0 16px 0",fontSize:"18px",fontWeight:600,color:"#f2f2f2"},children:"Set Size"}),l.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",color:"#e0e0e0",fontWeight:500},children:"Size (pixels):"}),l.jsx("input",{ref:o,type:"number",min:"1",max:"99",value:e,onChange:c=>{const h=parseInt(c.target.value)||1,f=Math.max(1,Math.min(99,h));t(f)},onKeyDown:c=>{if(c.key==="Enter"?n():c.key==="Escape"&&r(),c.key.length===1&&/[0-9]/.test(c.key)){const h=e.toString();h.length>=2&&o.current?.selectionStart===o.current?.selectionEnd&&o.current?.selectionStart===h.length&&c.preventDefault()}},onInput:c=>{const h=c.target,f=h.value;if(f.length>2){h.value=f.slice(0,2);const m=parseInt(h.value)||1;t(Math.max(1,Math.min(99,m)))}},style:{width:"100%",padding:"8px 12px",marginBottom:"16px",background:"#1f1f24",border:"1px solid #444",borderRadius:6,color:"#f2f2f2",fontSize:"14px"},autoFocus:!0}),l.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",color:"#e0e0e0",fontWeight:500},children:"Or select from list:"}),l.jsxs("select",{value:d.includes(e)?e:"",onChange:c=>{const h=parseInt(c.target.value);!isNaN(h)&&h>0&&t(h)},style:{width:"100%",padding:"8px 12px",marginBottom:"20px",background:"#1f1f24",border:"1px solid #444",borderRadius:6,color:"#f2f2f2",fontSize:"14px"},children:[l.jsx("option",{value:"",style:{background:"#1f1f24",color:"#f2f2f2"},children:"-- Select --"}),d.map(c=>l.jsxs("option",{value:c,style:{background:"#1f1f24",color:"#f2f2f2"},children:[c," pixels"]},c))]}),l.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[l.jsx("button",{onClick:r,style:{padding:"8px 16px",background:"#444",color:"#f2f2f2",border:"1px solid #555",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:500},children:"Cancel"}),l.jsx("button",{onClick:n,style:{padding:"8px 16px",background:"#4CAF50",color:"#fff",border:"1px solid #45a049",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"Apply"})]})]})})},zT=({visible:s,interval:e,onIntervalChange:t,onApply:n,onCancel:r})=>s?l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10003},onClick:o=>{o.target===o.currentTarget&&r()},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"24px",minWidth:"300px",maxWidth:"400px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid #1f1f24"},onClick:o=>o.stopPropagation(),children:[l.jsx("h2",{style:{margin:"0 0 16px 0",fontSize:"18px",fontWeight:600,color:"#f2f2f2"},children:"Auto Save"}),l.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",color:"#e0e0e0",fontWeight:500},children:"Select time interval:"}),l.jsxs("select",{value:e===null?"disable":(e||5).toString(),onChange:o=>{const d=o.target.value;if(d==="disable")t(null);else{const c=parseFloat(d);!isNaN(c)&&c>0&&t(c)}},style:{width:"100%",padding:"8px 12px",marginBottom:"20px",background:"#1f1f24",border:"1px solid #444",borderRadius:6,color:"#f2f2f2",fontSize:"14px"},autoFocus:!0,children:[l.jsx("option",{value:"1",style:{background:"#1f1f24",color:"#f2f2f2"},children:"1 minute"}),l.jsx("option",{value:"5",style:{background:"#1f1f24",color:"#f2f2f2"},children:"5 minutes"}),l.jsx("option",{value:"10",style:{background:"#1f1f24",color:"#f2f2f2"},children:"10 minutes"}),l.jsx("option",{value:"20",style:{background:"#1f1f24",color:"#f2f2f2"},children:"20 minutes"}),l.jsx("option",{value:"30",style:{background:"#1f1f24",color:"#f2f2f2"},children:"30 minutes"}),l.jsx("option",{value:"disable",style:{background:"#1f1f24",color:"#f2f2f2"},children:"Disable"})]}),l.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[l.jsx("button",{onClick:r,style:{padding:"8px 16px",background:"#444",color:"#f2f2f2",border:"1px solid #555",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:500},children:"Cancel"}),l.jsx("button",{onClick:n,style:{padding:"8px 16px",background:"#4CAF50",color:"#fff",border:"1px solid #45a049",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"Apply"})]})]})}):null,BT=({visible:s,interval:e,onIntervalChange:t,onEnable:n,onSkip:r})=>s?l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10004},onClick:o=>{o.target===o.currentTarget&&r()},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"24px",minWidth:"400px",maxWidth:"500px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid #1f1f24"},onClick:o=>o.stopPropagation(),children:[l.jsx("h2",{style:{margin:"0 0 16px 0",fontSize:"18px",fontWeight:600,color:"#f2f2f2"},children:"Enable Auto Save?"}),l.jsx("p",{style:{margin:"0 0 20px 0",fontSize:"14px",color:"#e0e0e0",lineHeight:"1.5"},children:"We recommend enabling Auto Save to automatically save your project at regular intervals. This helps protect your work from accidental loss."}),l.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",color:"#e0e0e0",fontWeight:500},children:"Select time interval:"}),l.jsxs("select",{value:e===null?"disable":(e||5).toString(),onChange:o=>{const d=o.target.value;if(d==="disable")t(null);else{const c=parseFloat(d);!isNaN(c)&&c>0&&t(c)}},style:{width:"100%",padding:"8px 12px",marginBottom:"24px",background:"#1f1f24",border:"1px solid #444",borderRadius:6,color:"#f2f2f2",fontSize:"14px"},autoFocus:!0,children:[l.jsx("option",{value:"1",style:{background:"#1f1f24",color:"#f2f2f2"},children:"1 minute"}),l.jsx("option",{value:"5",style:{background:"#1f1f24",color:"#f2f2f2"},children:"5 minutes"}),l.jsx("option",{value:"10",style:{background:"#1f1f24",color:"#f2f2f2"},children:"10 minutes"}),l.jsx("option",{value:"20",style:{background:"#1f1f24",color:"#f2f2f2"},children:"20 minutes"}),l.jsx("option",{value:"30",style:{background:"#1f1f24",color:"#f2f2f2"},children:"30 minutes"})]}),l.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[l.jsx("button",{onClick:r,style:{padding:"8px 16px",background:"#444",color:"#f2f2f2",border:"1px solid #555",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:500},children:"Skip"}),l.jsx("button",{onClick:n,style:{padding:"8px 16px",background:"#4CAF50",color:"#fff",border:"1px solid #45a049",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"Enable Auto Save"})]})]})}):null,FT=({visible:s,projectDirHandle:e,onClose:t,onRestore:n,position:r,isDragging:o=!1,onDragStart:d})=>{const[c,h]=U.useState([]),[f,m]=U.useState(!1),[y,A]=U.useState(null),[v,N]=U.useState(null),T=U.useRef(null);U.useEffect(()=>{if(!s||!e){h([]),A(null),N(null);return}(async()=>{m(!0),N(null);try{let B;try{B=await e.getDirectoryHandle("history")}catch{h([]),m(!1);return}const q=X=>{const O=X.match(/_(\d{4})_(\d{2})_(\d{2})-(\d{2})-(\d{2})-(\d{2})\.json$/);if(O){const[,W,I,J,Z,Ce,ie]=O;return new Date(parseInt(W),parseInt(I)-1,parseInt(J),parseInt(Z),parseInt(Ce),parseInt(ie))}const Y=X.match(/_(\d{4})_(\d{2})_(\d{2})_(\d{2})_(\d{2})_(\d{2})\.json$/);if(Y){const[,W,I,J,Z,Ce,ie]=Y;return new Date(parseInt(W),parseInt(I)-1,parseInt(J),parseInt(Z),parseInt(Ce),parseInt(ie))}return null},G=[];for await(const X of B.keys())if(X.endsWith(".json"))try{const Y=await(await B.getFileHandle(X)).getFile(),W=q(X);G.push({name:X,lastModified:new Date(Y.lastModified),size:Y.size,timestamp:W||new Date(Y.lastModified)})}catch(O){console.warn(`Failed to read file ${X}:`,O)}G.sort((X,O)=>O.timestamp.getTime()-X.timestamp.getTime()),h(G)}catch(B){console.error("Failed to load history files:",B),N("Failed to load history files. Please try again.")}finally{m(!1)}})()},[s,e]);const _=async()=>{if(y)try{await n(y),t()}catch(M){console.error("Failed to restore file:",M),N("Failed to restore file. Please try again.")}},b=M=>M.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),H=M=>M<1024?`${M} B`:M<1024*1024?`${(M/1024).toFixed(1)} KB`:`${(M/(1024*1024)).toFixed(1)} MB`;if(!s)return null;const R=r?{position:"fixed",left:`${r.x}px`,top:`${r.y}px`,backgroundColor:"#fff",borderRadius:8,minWidth:"500px",maxWidth:"700px",width:"fit-content",maxHeight:"80%",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",border:"1px solid #ddd",zIndex:1e4,display:"flex",flexDirection:"column",cursor:o?"grabbing":"default"}:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#fff",borderRadius:8,minWidth:"500px",maxWidth:"700px",width:"fit-content",maxHeight:"80%",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",border:"1px solid #ddd",zIndex:1e4,display:"flex",flexDirection:"column"};return l.jsxs("div",{style:R,children:[l.jsxs("div",{onMouseDown:d,style:{backgroundColor:"#f5f5f5",padding:"12px 16px",borderBottom:"1px solid #ddd",borderRadius:"8px 8px 0 0",cursor:o?"grabbing":"move",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[l.jsx("h2",{style:{margin:0,fontSize:"16px",fontWeight:600,color:"#000"},children:"PastTime"}),l.jsx("button",{onClick:t,style:{background:"transparent",border:"none",fontSize:"20px",cursor:"pointer",color:"#666",padding:"0 4px",lineHeight:1},title:"Close",children:""})]}),l.jsxs("div",{style:{padding:"16px",display:"flex",flexDirection:"column",flex:1,minHeight:0},children:[v&&l.jsx("div",{style:{padding:"12px",backgroundColor:"#fee",color:"#c00",borderRadius:4,marginBottom:"12px"},children:v}),f?l.jsx("div",{style:{padding:"40px",textAlign:"center",color:"#666"},children:"Loading history files..."}):c.length===0?l.jsx("div",{style:{padding:"40px",textAlign:"center",color:"#666"},children:"No history files found."}):l.jsxs(l.Fragment,{children:[l.jsx("div",{style:{marginBottom:"12px",color:"#333",fontSize:"14px"},children:"Select a file to restore:"}),l.jsx("div",{ref:T,style:{border:"1px solid #ddd",borderRadius:4,overflowY:"auto",maxHeight:"400px",backgroundColor:"#fafafa"},children:c.map((M,B)=>l.jsxs("div",{onClick:()=>A(M.name),style:{padding:"12px 16px",borderBottom:B<c.length-1?"1px solid #eee":"none",backgroundColor:y===M.name?"#e6f0ff":"transparent",cursor:"pointer",transition:"background-color 0.1s"},onMouseEnter:q=>{y!==M.name&&(q.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:q=>{y!==M.name&&(q.currentTarget.style.backgroundColor="transparent")},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"4px"},children:[l.jsx("div",{style:{fontWeight:600,color:"#000",fontSize:"13px",wordBreak:"break-word",flex:1},children:M.name}),l.jsx("div",{style:{color:"#666",fontSize:"12px",marginLeft:"12px",whiteSpace:"nowrap"},children:H(M.size)})]}),l.jsx("div",{style:{color:"#666",fontSize:"12px"},children:b(M.lastModified)})]},M.name))})]})]}),l.jsxs("div",{style:{padding:"12px 16px",borderTop:"1px solid #ddd",display:"flex",justifyContent:"flex-end",gap:"8px"},children:[l.jsx("button",{onClick:t,style:{padding:"6px 16px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",color:"#333",fontSize:"13px"},children:"Cancel"}),l.jsx("button",{onClick:_,disabled:!y||f,style:{padding:"6px 16px",background:y&&!f?"#0066cc":"#ccc",border:"none",borderRadius:4,cursor:y&&!f?"pointer":"not-allowed",color:"#fff",fontSize:"13px",fontWeight:500},children:"Restore"})]})]})},OT=()=>l.jsxs("svg",{width:"45",height:"30",viewBox:"0 0 45 30",style:{marginLeft:"8px",flexShrink:0},children:[l.jsx("rect",{x:"8",y:"4",width:"29",height:"14",rx:"2",ry:"2",fill:"#000"}),l.jsx("rect",{x:"10",y:"18",width:"2.5",height:"6",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"14.5",y:"18",width:"2.5",height:"6",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"19",y:"18",width:"2.5",height:"6",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"23.5",y:"18",width:"2.5",height:"6",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"28",y:"18",width:"2.5",height:"6",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"32.5",y:"18",width:"2.5",height:"6",rx:"0.5",fill:"#000"})]}),UT=()=>l.jsxs("svg",{width:"40",height:"30",viewBox:"0 0 40 30",style:{marginLeft:"8px",flexShrink:0},children:[l.jsx("rect",{x:"2",y:"11",width:"5",height:"2.5",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"2",y:"14.5",width:"5",height:"2.5",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"2",y:"18",width:"5",height:"2.5",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"7",y:"6",width:"26",height:"18",rx:"2",ry:"2",fill:"#000"}),l.jsx("rect",{x:"13",y:"10",width:"14",height:"10",rx:"1.5",ry:"1.5",fill:"#fff"}),l.jsx("circle",{cx:"14.5",cy:"11.5",r:"1",fill:"#000"}),l.jsx("rect",{x:"33",y:"11",width:"5",height:"2.5",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"33",y:"14.5",width:"5",height:"2.5",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"33",y:"18",width:"5",height:"2.5",rx:"0.5",fill:"#000"})]}),HT=()=>l.jsxs("svg",{width:"35",height:"35",viewBox:"0 0 35 35",style:{marginLeft:"8px",flexShrink:0},children:[l.jsx("rect",{x:"12",y:"2",width:"2.5",height:"4",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"16.25",y:"2",width:"2.5",height:"4",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"20.5",y:"2",width:"2.5",height:"4",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"2",y:"12",width:"4",height:"2.5",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"2",y:"16.25",width:"4",height:"2.5",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"2",y:"20.5",width:"4",height:"2.5",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"6",y:"6",width:"23",height:"23",fill:"#000"}),l.jsx("rect",{x:"29",y:"12",width:"4",height:"2.5",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"29",y:"16.25",width:"4",height:"2.5",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"29",y:"20.5",width:"4",height:"2.5",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"12",y:"29",width:"2.5",height:"4",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"16.25",y:"29",width:"2.5",height:"4",rx:"0.5",fill:"#000"}),l.jsx("rect",{x:"20.5",y:"29",width:"2.5",height:"4",rx:"0.5",fill:"#000"})]}),Bv=({rotate:s=0})=>{const n=s!==0?`rotate(${s} 20 20)`:"";return l.jsx("svg",{width:"40",height:"40",viewBox:"0 0 40 40",style:{marginLeft:"8px",flexShrink:0},children:l.jsxs("g",{transform:n,children:[l.jsx("rect",{x:"8",y:"10",width:"24",height:"20",rx:"2",ry:"2",fill:"#555"}),l.jsx("rect",{x:"2",y:"12",width:"6",height:"3",rx:"1",ry:"1",fill:"#555"}),l.jsx("rect",{x:"2",y:"18",width:"6",height:"3",rx:"1",ry:"1",fill:"#555"}),l.jsx("rect",{x:"2",y:"24",width:"6",height:"3",rx:"1",ry:"1",fill:"#555"}),l.jsx("rect",{x:"32",y:"12",width:"6",height:"3",rx:"1",ry:"1",fill:"#555"}),l.jsx("rect",{x:"32",y:"18",width:"6",height:"3",rx:"1",ry:"1",fill:"#555"}),l.jsx("rect",{x:"32",y:"24",width:"6",height:"3",rx:"1",ry:"1",fill:"#555"}),l.jsx("rect",{x:"12",y:"14",width:"16",height:"12",rx:"1.5",ry:"1.5",fill:"#fff"}),l.jsx("circle",{cx:"14",cy:"16",r:"1.5",fill:"#555"})]})})},VT=()=>l.jsx(Bv,{rotate:0}),qT=()=>l.jsx(Bv,{rotate:90}),WT=({visible:s,isPad:e,onConfirm:t,onClose:n})=>{const[r,o]=U.useState("linear"),[d,c]=U.useState("vertical-edges"),[h,f]=U.useState("8"),[m,y]=U.useState("");U.useEffect(()=>{s&&(o("linear"),c("vertical-edges"),f("8"),y(""))},[s]);const A=(T,_)=>{const b=T.trim();if(b==="")return{valid:!1,error:"Number of pins is required."};const H=parseInt(b,10);return isNaN(H)?{valid:!1,error:"Please enter a valid number."}:H<1?{valid:!1,error:"Number of pins must be >= 1."}:_==="linear"?H!==Math.floor(H)||H<=0?{valid:!1,error:"Linear arrangement requires a positive integer."}:{valid:!0,error:"",numPins:H}:_==="twoSided"?H!==Math.floor(H)||H<=0?{valid:!1,error:"2-sided arrangement requires a positive integer."}:H%2!==0?{valid:!1,error:"2-sided components must have an even number of pins."}:{valid:!0,error:"",numPins:H}:_==="fourSided"?H!==Math.floor(H)||H<=0?{valid:!1,error:"4-sided arrangement requires a positive integer."}:H%4!==0?{valid:!1,error:"4-sided components must have a number of pins divisible by 4."}:{valid:!0,error:"",numPins:H}:{valid:!0,error:"",numPins:H}},v=T=>{let _=T===""?"":T.replace(/[^\d]/g,"");f(_);const b=A(_,r);b.error?y(b.error):y("")},N=U.useCallback(()=>{const T=A(h,r);if(!T.valid||T.numPins===void 0){y(T.error||"Invalid number of pins.");return}y(""),t({numPins:T.numPins,type:r,...r==="twoSided"?{twoSidedOrientation:d}:{}})},[h,r,d,t]);return U.useEffect(()=>{if(!s)return;const T=_=>{_.key==="Enter"&&!_.shiftKey&&!_.ctrlKey&&!_.altKey&&!_.metaKey&&(_.preventDefault(),N())};return window.addEventListener("keydown",T),()=>{window.removeEventListener("keydown",T)}},[s,N]),s?l.jsxs(l.Fragment,{children:[l.jsx("style",{children:`
        .number-input-large-spinners::-webkit-inner-spin-button,
        .number-input-large-spinners::-webkit-outer-spin-button {
          opacity: 1;
          height: 20px;
          width: 20px;
          cursor: pointer;
        }
        .number-input-large-spinners::-webkit-inner-spin-button {
          margin-right: 4px;
        }
      `}),l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:T=>{T.target===T.currentTarget&&n()},children:l.jsxs("div",{style:{backgroundColor:"#fff",padding:"20px",borderRadius:"8px",minWidth:"320px",maxWidth:"380px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"},onClick:T=>T.stopPropagation(),children:[l.jsxs("h2",{style:{marginTop:0,marginBottom:"20px",color:"#222",fontSize:"18px"},children:[e?"Pad Pattern":"Via Pattern"," Placement"]}),l.jsxs("div",{style:{marginBottom:"15px"},children:[l.jsx("label",{style:{display:"block",marginBottom:"5px",color:"#222",fontWeight:500},children:"Arrangement:"}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[l.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[l.jsx("input",{type:"radio",value:"linear",checked:r==="linear",onChange:T=>{const _=T.target.value;o(_);const b=A(h,_);b.error?y(b.error):y("")},style:{marginRight:"8px"}}),l.jsx("span",{style:{color:"#222"},children:"Linear (1 side)"}),l.jsx(OT,{})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[l.jsx("input",{type:"radio",value:"twoSided",checked:r==="twoSided",onChange:T=>{const _=T.target.value;o(_);const b=A(h,_);b.error?y(b.error):y("")},style:{marginRight:"8px"}}),l.jsx("span",{style:{color:"#222"},children:"2-Sided"}),l.jsx(UT,{})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[l.jsx("input",{type:"radio",value:"fourSided",checked:r==="fourSided",onChange:T=>{const _=T.target.value;o(_);const b=A(h,_);b.error?y(b.error):y("")},style:{marginRight:"8px"}}),l.jsx("span",{style:{color:"#222"},children:"4-Sided"}),l.jsx(HT,{})]})]})]}),r==="twoSided"&&l.jsxs("div",{style:{marginBottom:"15px"},children:[l.jsx("label",{style:{display:"block",marginBottom:"5px",color:"#222",fontWeight:500},children:"Orientation:"}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[l.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[l.jsx("input",{type:"radio",value:"vertical-edges",checked:d==="vertical-edges",onChange:T=>c(T.target.value),style:{marginRight:"8px"}}),l.jsxs("span",{style:{color:"#222"},children:["Vertical ",e?"Pads":"Vias"," (left & right)"]}),l.jsx(VT,{})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[l.jsx("input",{type:"radio",value:"horizontal-edges",checked:d==="horizontal-edges",onChange:T=>c(T.target.value),style:{marginRight:"8px"}}),l.jsxs("span",{style:{color:"#222"},children:["Horizontal ",e?"Pads":"Vias"," (top & bottom)"]}),l.jsx(qT,{})]})]})]}),l.jsxs("div",{style:{marginBottom:"15px"},children:[l.jsx("label",{style:{display:"block",marginBottom:"5px",color:"#222",fontWeight:500},children:"Number of Pins:"}),l.jsx("input",{type:"number",min:r==="linear"?1:r==="twoSided"?2:4,step:r==="linear"?1:r==="twoSided"?2:4,value:h,onChange:T=>v(T.target.value),onBlur:()=>{const T=A(h,r);T.valid?y(""):y(T.error)},style:{width:"80px",padding:"6px 24px 6px 6px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",color:"#000",background:"#fff"},className:"number-input-large-spinners"}),m&&l.jsx("div",{style:{color:"#d32f2f",fontSize:"12px",marginTop:"4px"},children:m})]}),l.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",marginTop:"20px"},children:[l.jsx("button",{onClick:n,style:{padding:"8px 16px",background:"#444",color:"#f2f2f2",border:"1px solid #555",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:500},children:"Cancel"}),l.jsx("button",{onClick:N,style:{padding:"8px 16px",background:"#4CAF50",color:"#fff",border:"1px solid #45a049",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:600},children:"OK"})]})]})})]}):null};function $T(s,e){const t={x:s.x,y:s.y},n={x:e.x,y:e.y},r={x:n.x,y:t.y},o={x:t.x,y:n.y};return{corner1:t,corner2:r,corner3:n,corner4:o}}function GT(s){if(s.numPins<1)throw new Error("Number of pins must be >= 1.");if(s.type==="twoSided"){if(s.numPins%2!==0)throw new Error("2-sided components must have an even number of pins.");if(!s.twoSidedOrientation)throw new Error("Orientation required for 2-sided components.")}if(s.type==="fourSided"&&s.numPins%4!==0)throw new Error("4-sided components must have N divisible by 4.");if(Math.abs(s.point1.x-s.point2.x)<.001||Math.abs(s.point1.y-s.point2.y)<.001)throw new Error("Area must have non-zero width and height.")}function YT(s,e){const t=[],{corner1:n,corner2:r,corner3:o,corner4:d}=e,c=Math.abs(r.x-n.x),h=Math.abs(o.y-r.y);if(c>h){const f=(n.y+d.y)/2,m=Math.min(n.x,r.x),y=Math.max(n.x,r.x),A=y-m,v=s.numPins>1?A/(s.numPins-1):0,N=Math.hypot(n.x-m,n.y-f),T=Math.hypot(n.x-y,n.y-f),_=N<T;if(s.numPins===1)t.push({pinNumber:1,x:(m+y)/2,y:f});else for(let b=1;b<=s.numPins;b++){const H=_?m+(b-1)*v:y-(b-1)*v;t.push({pinNumber:b,x:H,y:f})}}else{const f=(n.x+r.x)/2,m=Math.min(n.y,r.y),y=Math.max(o.y,d.y),A=y-m,v=s.numPins>1?A/(s.numPins-1):0,N=Math.hypot(n.x-f,n.y-m),T=Math.hypot(n.x-f,n.y-y),_=N<T;if(s.numPins===1)t.push({pinNumber:1,x:f,y:(m+y)/2});else for(let b=1;b<=s.numPins;b++){const H=_?m+(b-1)*v:y-(b-1)*v;t.push({pinNumber:b,x:f,y:H})}}return t}function XT(s,e){const t=[],{corner1:n,corner2:r,corner3:o,corner4:d}=e,c=s.type==="fourSided"?s.numPins/4:s.numPins/2,h=Math.min(n.x,r.x,o.x,d.x),f=Math.min(n.y,r.y,o.y,d.y),m=Math.abs(n.y-f)<.001,y=Math.abs(n.x-h)<.001,A=m?y?"TopLeft":"TopRight":y?"BottomLeft":"BottomRight",v=Math.max(n.x,r.x,o.x,d.x),N=Math.max(n.y,r.y,o.y,d.y),T=(I,J,Z=.001)=>{const Ce=[n,r,o,d];for(const ie of Ce)if(Math.abs(ie.x-I)<Z&&Math.abs(ie.y-J)<Z)return ie;return null},_=T(h,f)||n,b=T(v,f)||r,H=T(v,N)||o,R=T(h,N)||d,M={start:_,end:R,name:"Left",direction:"Down"},B={start:R,end:H,name:"Bottom",direction:"Right"},q={start:H,end:b,name:"Right",direction:"Up"},G={start:b,end:_,name:"Top",direction:"Left"};let X;const O=[];if(A==="TopLeft"?(X=M,O.push(M,B,q,G)):A==="BottomLeft"?(X=B,O.push(B,q,G,M)):A==="BottomRight"?(X=q,O.push(q,G,M,B)):(X=G,O.push(G,M,B,q)),s.type==="twoSided"){if(s.twoSidedOrientation==="vertical-edges"){if(A!=="TopLeft"&&A!=="BottomRight")throw new Error(`Invalid Pin 1 location for Left/Right orientation. Pin 1 is at ${A}, but must be at Top-Left or Bottom-Right.`)}else if(A!=="TopRight"&&A!=="BottomLeft")throw new Error(`Invalid Pin 1 location for Top/Bottom orientation. Pin 1 is at ${A}, but must be at Top-Right or Bottom-Left.`)}const Y=[];s.type==="fourSided"?Y.push(...O):s.twoSidedOrientation==="vertical-edges"?X===M?Y.push(M,q):Y.push(q,M):X===G?Y.push(G,B):Y.push(B,G);let W=1;for(const I of Y){const J=Math.hypot(I.end.x-I.start.x,I.end.y-I.start.y),Z=s.type==="fourSided"?J/(c+1):c>1?J/(c-1):0,Ce=[];if(s.type==="fourSided")if(I.direction==="Down")for(let ie=1;ie<=c;ie++)Ce.push({x:I.start.x,y:I.start.y+ie*Z});else if(I.direction==="Right")for(let ie=1;ie<=c;ie++)Ce.push({x:I.start.x+ie*Z,y:I.start.y});else if(I.direction==="Up")for(let ie=1;ie<=c;ie++)Ce.push({x:I.start.x,y:I.start.y-ie*Z});else for(let ie=1;ie<=c;ie++)Ce.push({x:I.start.x-ie*Z,y:I.start.y});else if(c===1){const ie=(I.start.x+I.end.x)/2,le=(I.start.y+I.end.y)/2;Ce.push({x:ie,y:le})}else if(I.direction==="Down")for(let ie=0;ie<c;ie++)Ce.push({x:I.start.x,y:I.start.y+ie*Z});else if(I.direction==="Right")for(let ie=0;ie<c;ie++)Ce.push({x:I.start.x+ie*Z,y:I.start.y});else if(I.direction==="Up")for(let ie=0;ie<c;ie++)Ce.push({x:I.start.x,y:I.start.y-ie*Z});else for(let ie=0;ie<c;ie++)Ce.push({x:I.start.x-ie*Z,y:I.start.y});if(I===X){let ie=0,le=1/0;for(let Ae=0;Ae<Ce.length;Ae++){const ue=Math.hypot(Ce[Ae].x-n.x,Ce[Ae].y-n.y);ue<le&&(le=ue,ie=Ae)}const se=Math.hypot(I.start.x-n.x,I.start.y-n.y);if(le<se&&ie>0){const Ae=Ce.slice(0,ie),ue=Ce.slice(ie);Ce.length=0,Ce.push(...ue,...Ae)}}for(const ie of Ce)t.push({pinNumber:W++,x:ie.x,y:ie.y})}return t}function KT(s){GT(s);const e=$T(s.point1,s.point2);return s.type==="linear"?YT(s,e):XT(s,e)}function ZT(){const[s,e]=U.useState([]),[t,n]=U.useState(!1),[r,o]=U.useState([]),[d,c]=U.useState(null),[h,f]=U.useState("trace"),[m,y]=U.useState("top"),A=U.useRef([]),v=U.useRef(0),N=U.useRef(!1),T=U.useCallback(()=>{n(!0),o([]),A.current=[]},[]),_=U.useCallback(()=>{n(!1),o([]),A.current=[]},[]),b=U.useCallback(R=>{o(M=>[...M,R]),A.current=[...A.current,R]},[]),H=U.useCallback(R=>{e(M=>[...M,R]),o([]),A.current=[]},[]);return{drawingStrokes:s,setDrawingStrokes:e,isDrawing:t,setIsDrawing:n,currentStroke:r,setCurrentStroke:o,tracePreviewMousePos:d,setTracePreviewMousePos:c,drawingMode:h,setDrawingMode:f,selectedDrawingLayer:m,setSelectedDrawingLayer:y,currentStrokeRef:A,lastTraceClickTimeRef:v,isDoubleClickingTraceRef:N,startDrawing:T,stopDrawing:_,addPointToStroke:b,finishStroke:H}}function JT(){const[s,e]=U.useState(new Set),[t,n]=U.useState(!1),[r,o]=U.useState(new Set),[d,c]=U.useState(new Set),[h,f]=U.useState(new Set),m=U.useCallback(()=>{e(new Set),o(new Set),c(new Set),f(new Set)},[]),y=U.useCallback((N,T="stroke")=>{T==="stroke"?e(_=>new Set([..._,N])):T==="component"?o(_=>new Set([..._,N])):T==="power"?c(_=>new Set([..._,N])):T==="ground"&&f(_=>new Set([..._,N]))},[]),A=U.useCallback((N,T="stroke")=>{T==="stroke"?e(_=>{const b=new Set(_);return b.delete(N),b}):T==="component"?o(_=>{const b=new Set(_);return b.delete(N),b}):T==="power"?c(_=>{const b=new Set(_);return b.delete(N),b}):T==="ground"&&f(_=>{const b=new Set(_);return b.delete(N),b})},[]),v=U.useCallback((N,T="stroke")=>{T==="stroke"?e(N):T==="component"?o(N):T==="power"?c(N):T==="ground"&&f(N)},[]);return{selectedIds:s,setSelectedIds:e,isSelecting:t,setIsSelecting:n,selectedComponentIds:r,setSelectedComponentIds:o,selectedPowerIds:d,setSelectedPowerIds:c,selectedGroundIds:h,setSelectedGroundIds:f,clearSelection:m,addToSelection:y,removeFromSelection:A,setSelection:v}}function QT(){const[s,e]=U.useState(null),[t,n]=U.useState(!1),[r,o]=U.useState(null),[d,c]=U.useState("nudge"),h=U.useCallback((m,y)=>{e(m),n(!0),o(y)},[]),f=U.useCallback(()=>{n(!1),e(null),o(null)},[]);return{selectedImageForTransform:s,setSelectedImageForTransform:e,isTransforming:t,setIsTransforming:n,transformStartPos:r,setTransformStartPos:o,transformMode:d,setTransformMode:c,startTransform:h,stopTransform:f}}function e4(){const[s,e]=U.useState(null),[t,n]=U.useState(null),[r,o]=U.useState("overlay"),[d,c]=U.useState(50),[h,f]=U.useState(!1),[m,y]=U.useState(2e3),[A,v]=U.useState(!1),N=U.useCallback(b=>{e(b)},[]),T=U.useCallback(b=>{n(b)},[]),_=U.useCallback(()=>{e(null),n(null)},[]);return{topImage:s,setTopImage:e,bottomImage:t,setBottomImage:n,currentView:r,setCurrentView:o,transparency:d,setTransparency:c,isTransparencyCycling:h,setIsTransparencyCycling:f,transparencyCycleSpeed:m,setTransparencyCycleSpeed:y,isGrayscale:A,setIsGrayscale:v,loadTopImage:N,loadBottomImage:T,clearImages:_}}function t4(){const[s,e]=U.useState(1),[t,n]=U.useState({x:0,y:0}),[r,o]=U.useState(0),[d,c]=U.useState(!1),[h,f]=U.useState(!1),[m,y]=U.useState(!1),A=U.useCallback(()=>{e(1),n({x:0,y:0}),o(0),c(!1)},[]),v=U.useCallback((R=1.2)=>{e(M=>M*R)},[]),N=U.useCallback((R=1.2)=>{e(M=>M/R)},[]),T=U.useCallback(R=>{e(R)},[]),_=U.useCallback((R,M,B)=>{const q=R/B,G=M/B;n(X=>({x:X.x-q,y:X.y-G}))},[]),b=U.useCallback((R,M)=>{n({x:R,y:M})},[]),H=U.useCallback((R,M)=>({x:R-t.x*s,y:M-t.y*s}),[t,s]);return{viewScale:s,setViewScale:e,cameraWorldCenter:t,setCameraWorldCenter:n,viewRotation:r,setViewRotation:o,viewFlipX:d,setViewFlipX:c,isShiftConstrained:h,setIsShiftConstrained:f,showBothLayers:m,setShowBothLayers:y,resetView:A,zoomIn:v,zoomOut:N,setZoom:T,pan:_,setCameraCenter:b,getViewPan:H}}function n4(){const[s,e]=U.useState(()=>[{id:"powerbus-default",name:"+5VDC",voltage:"+5",color:"#ff0000"}]),[t,n]=U.useState(()=>[{id:"groundbus-circuit",name:"GND",color:"#000000"}]),[r,o]=U.useState([]),[d,c]=U.useState([]),[h,f]=U.useState(null),[m,y]=U.useState(null),A=U.useCallback(q=>{e(G=>[...G,q])},[]),v=U.useCallback((q,G)=>{e(X=>X.map(O=>O.id===q?{...O,...G}:O))},[]),N=U.useCallback(q=>{e(G=>G.filter(X=>X.id!==q)),o(G=>G.filter(X=>X.powerBusId!==q))},[]),T=U.useCallback(q=>{o(G=>[...G,q])},[]),_=U.useCallback(q=>{o(G=>G.filter(X=>X.id!==q))},[]),b=U.useCallback(q=>{c(G=>[...G,q])},[]),H=U.useCallback(q=>{c(G=>G.filter(X=>X.id!==q))},[]),R=U.useCallback(q=>{n(G=>[...G,q])},[]),M=U.useCallback((q,G)=>{n(X=>X.map(O=>O.id===q?{...O,...G}:O))},[]),B=U.useCallback(q=>{n(G=>G.filter(X=>X.id!==q)),c(G=>G.filter(X=>X.groundBusId===q))},[]);return{powerBuses:s,setPowerBuses:e,groundBuses:t,setGroundBuses:n,powerSymbols:r,setPowerSymbols:o,groundSymbols:d,setGroundSymbols:c,powerEditor:h,setPowerEditor:f,groundEditor:m,setGroundEditor:y,addPowerBus:A,updatePowerBus:v,removePowerBus:N,addPowerSymbol:T,removePowerSymbol:_,addGroundSymbol:b,removeGroundSymbol:H,addGroundBus:R,updateGroundBus:M,removeGroundBus:B}}const ji={brushColor:"#008080",brushSize:6,topTraceColor:"#AA4499",bottomTraceColor:"#F781BF",topTraceSize:6,bottomTraceSize:6,viaSize:18,viaColor:"#ff0000",topPadColor:"#0072B2",bottomPadColor:"#56B4E9",topPadSize:18,bottomPadSize:18,topTestPointColor:"#FFFF00",bottomTestPointColor:"#FFFF00",topTestPointSize:18,bottomTestPointSize:18,topComponentColor:"#8C564B",bottomComponentColor:"#9C755F",topComponentSize:18,bottomComponentSize:18,componentConnectionColor:"#E69F00",componentConnectionSize:3};function i4(){const[s,e]=U.useState(ji.brushColor),[t,n]=U.useState(ji.brushSize),[r,o]=U.useState(ji.topTraceColor),[d,c]=U.useState(ji.bottomTraceColor),[h,f]=U.useState(ji.topTraceSize),[m,y]=U.useState(ji.bottomTraceSize),[A,v]=U.useState(ji.topPadColor),[N,T]=U.useState(ji.bottomPadColor),[_,b]=U.useState(ji.topPadSize),[H,R]=U.useState(ji.bottomPadSize),[M,B]=U.useState(ji.topTestPointColor),[q,G]=U.useState(ji.bottomTestPointColor),[X,O]=U.useState(ji.topTestPointSize),[Y,W]=U.useState(ji.bottomTestPointSize),[I,J]=U.useState(ji.topComponentColor),[Z,Ce]=U.useState(ji.bottomComponentColor),[ie,le]=U.useState(ji.topComponentSize),[se,Ae]=U.useState(ji.bottomComponentSize),[ue,E]=U.useState(ji.componentConnectionColor),[L,Q]=U.useState(ji.componentConnectionSize),ee=U.useCallback(()=>{e(ji.brushColor),n(ji.brushSize),o(ji.topTraceColor),c(ji.bottomTraceColor),f(ji.topTraceSize),y(ji.bottomTraceSize),v(ji.topPadColor),T(ji.bottomPadColor),b(ji.topPadSize),R(ji.bottomPadSize),B(ji.topTestPointColor),G(ji.bottomTestPointColor),O(ji.topTestPointSize),W(ji.bottomTestPointSize),J(ji.topComponentColor),Ce(ji.bottomComponentColor),le(ji.topComponentSize),Ae(ji.bottomComponentSize),E(ji.componentConnectionColor),Q(ji.componentConnectionSize)},[]),oe=U.useCallback(Ee=>{Ee.brushColor!==void 0&&e(Ee.brushColor),Ee.brushSize!==void 0&&n(Ee.brushSize),Ee.topTraceColor!==void 0&&o(Ee.topTraceColor),Ee.bottomTraceColor!==void 0&&c(Ee.bottomTraceColor),Ee.topTraceSize!==void 0&&f(Ee.topTraceSize),Ee.bottomTraceSize!==void 0&&y(Ee.bottomTraceSize),Ee.topPadColor!==void 0&&v(Ee.topPadColor),Ee.bottomPadColor!==void 0&&T(Ee.bottomPadColor),Ee.topPadSize!==void 0&&b(Ee.topPadSize),Ee.bottomPadSize!==void 0&&R(Ee.bottomPadSize),Ee.topTestPointColor!==void 0&&B(Ee.topTestPointColor),Ee.bottomTestPointColor!==void 0&&G(Ee.bottomTestPointColor),Ee.topTestPointSize!==void 0&&O(Ee.topTestPointSize),Ee.bottomTestPointSize!==void 0&&W(Ee.bottomTestPointSize),Ee.topComponentColor!==void 0&&J(Ee.topComponentColor),Ee.bottomComponentColor!==void 0&&Ce(Ee.bottomComponentColor),Ee.topComponentSize!==void 0&&le(Ee.topComponentSize),Ee.bottomComponentSize!==void 0&&Ae(Ee.bottomComponentSize),Ee.componentConnectionColor!==void 0&&E(Ee.componentConnectionColor),Ee.componentConnectionSize!==void 0&&Q(Ee.componentConnectionSize)},[]),xe=U.useCallback((Ee,Oe,Ze)=>{},[]),re=U.useCallback((Ee,Oe,Ze)=>{},[]),Le=U.useCallback(()=>({brushColor:s,brushSize:t,topTraceColor:r,bottomTraceColor:d,topTraceSize:h,bottomTraceSize:m,viaSize:ji.viaSize,viaColor:ji.viaColor,topPadColor:A,bottomPadColor:N,topPadSize:_,bottomPadSize:H,topTestPointColor:M,bottomTestPointColor:q,topTestPointSize:X,bottomTestPointSize:Y,topComponentColor:I,bottomComponentColor:Z,topComponentSize:ie,bottomComponentSize:se,componentConnectionColor:ue,componentConnectionSize:L}),[s,t,r,d,h,m,A,N,_,H,M,q,X,Y,I,Z,ie,se,ue,L]);return{brushColor:s,setBrushColor:e,brushSize:t,setBrushSize:n,topTraceColor:r,setTopTraceColor:o,bottomTraceColor:d,setBottomTraceColor:c,topTraceSize:h,setTopTraceSize:f,bottomTraceSize:m,setBottomTraceSize:y,topPadColor:A,setTopPadColor:v,bottomPadColor:N,setBottomPadColor:T,topPadSize:_,setTopPadSize:b,bottomPadSize:H,setBottomPadSize:R,topTestPointColor:M,setTopTestPointColor:B,bottomTestPointColor:q,setBottomTestPointColor:G,topTestPointSize:X,setTopTestPointSize:O,bottomTestPointSize:Y,setBottomTestPointSize:W,topComponentColor:I,setTopComponentColor:J,bottomComponentColor:Z,setBottomComponentColor:Ce,topComponentSize:ie,setTopComponentSize:le,bottomComponentSize:se,setBottomComponentSize:Ae,componentConnectionColor:ue,setComponentConnectionColor:E,componentConnectionSize:L,setComponentConnectionSize:Q,resetToDefaults:ee,loadFromProject:oe,getCurrentSettings:Le,saveDefaultSize:xe,saveDefaultColor:re}}function r4(s,e,t,n,r,o,d,c,h,f,m,y,A,v,N,T,_,b,H,R,M,B,q,G,X){const[O,Y]=U.useState(()=>s()),W=U.useRef(null),I=U.useRef(n),J=U.useRef(r),Z=U.useCallback(le=>e==="draw"&&t==="trace"?le.get("trace"):e==="draw"&&t==="via"?le.get("via"):e==="draw"&&t==="pad"?le.get("pad"):e==="component"?le.get("component"):e==="power"?le.get("power"):e==="ground"?le.get("ground"):null,[e,t]);U.useEffect(()=>{Y(le=>{const se=Z(le),Ae=se?.id||null,ue=W.current,E=new Map(le);if(ue&&ue!==Ae){const L=le.get(ue);L&&E.set(ue,{...L,settings:{color:I.current,size:J.current}})}if(se&&Ae!==ue)if(e==="draw"&&t==="trace"){const L=B||"top",Q=L==="top"?o:d,ee=L==="top"?c:h;I.current=Q,J.current=ee,E.set("trace",{...se,settings:{color:Q,size:ee}})}else if(e==="draw"&&t==="pad"){const L=q||"top",Q=L==="top"?f:m,ee=L==="top"?y:A;I.current=Q,J.current=ee,E.set("pad",{...se,settings:{color:Q,size:ee}})}else if(e==="component"){const L=X||"top",Q=L==="top"?b:H,ee=L==="top"?R:M;I.current=Q,J.current=ee,E.set("component",{...se,settings:{color:Q,size:ee}})}else I.current=se.settings.color,J.current=se.settings.size;return W.current=Ae,E})},[e,t,o,d,c,h,f,m,y,A,b,H,R,M,B,q,X,Z]);const Ce=U.useCallback((le,se)=>{Y(Ae=>{const ue=new Map(Ae),E=ue.get(le);return E&&ue.set(le,{...E,settings:se}),ue})},[]),ie=U.useCallback((le,se,Ae)=>{Y(ue=>{const E=new Map(ue),L=E.get(le);if(L){const Q=new Map(L.layerSettings);Q.set(se,Ae),E.set(le,{...L,layerSettings:Q})}return E})},[]);return{toolRegistry:O,setToolRegistry:Y,updateToolSettings:Ce,updateToolLayerSettings:ie,getCurrentToolDef:Z}}function s4(s){const{currentTool:e,drawingMode:t,traceToolLayer:n,padToolLayer:r,testPointToolLayer:o,componentToolLayer:d}=s,[c,h]=U.useState(0),f=U.useCallback(()=>e==="draw"&&t==="via"?"via":e==="draw"&&t==="pad"?r==="bottom"?"padBottom":"padTop":e==="draw"&&t==="testPoint"?o==="bottom"?"testPointBottom":"testPointTop":e==="draw"&&t==="trace"?n==="bottom"?"traceBottom":"traceTop":e==="component"?d==="bottom"?"componentBottom":"componentTop":e==="power"?"power":e==="ground"?"ground":null,[e,t,r,o,n,d]),m=U.useCallback(()=>{const N=f();if(N){const T=Bn.get(N);return{currentTool:e,drawingMode:t,layer:e==="draw"&&t==="pad"?r||"top":e==="draw"&&t==="testPoint"?o||"top":e==="draw"&&t==="trace"?n||"top":e==="component"?d||"top":void 0,toolInstanceId:N,color:T.color,size:T.size}}return{currentTool:e,drawingMode:t,layer:void 0,toolInstanceId:null,color:"#000000",size:10}},[e,t,r,o,n,d,f]);U.useEffect(()=>{const N=f();return N?Bn.subscribe(N,()=>{h(_=>_+1)}):void 0},[f]);const y=m(),A=U.useCallback(N=>{const T=f();T&&Bn.setColor(T,N)},[f]),v=U.useCallback(N=>{const T=f();T&&Bn.setSize(T,N)},[f]);return{toolState:y,setColor:A,setSize:v,getCurrentToolInstanceId:f}}function a4(){const[s,e]=U.useState(!1),[t,n]=U.useState(!1),[r,o]=U.useState(!1),[d,c]=U.useState(!1),[h,f]=U.useState(!1),[m,y]=U.useState(!1),[A,v]=U.useState(!1),[N,T]=U.useState(!1),_=U.useCallback(()=>{e(!0),n(!0),o(!0),c(!0),f(!0),y(!0),v(!0),T(!0)},[]),b=U.useCallback(()=>{e(!1),n(!1),o(!1),c(!1),f(!1),y(!1),v(!1),T(!1)},[]);return{areImagesLocked:s,setAreImagesLocked:e,areViasLocked:t,setAreViasLocked:n,arePadsLocked:r,setArePadsLocked:o,areTestPointsLocked:d,setAreTestPointsLocked:c,areTracesLocked:h,setAreTracesLocked:f,areComponentsLocked:m,setAreComponentsLocked:y,areGroundNodesLocked:A,setAreGroundNodesLocked:v,arePowerNodesLocked:N,setArePowerNodesLocked:T,lockAll:_,unlockAll:b}}function o4(){const[s,e]=U.useState(null),[t,n]=U.useState({visible:!1,size:6}),[r,o]=U.useState({visible:!1,interval:5}),[d,c]=U.useState({visible:!1,source:null,interval:5}),[h,f]=U.useState({visible:!1,text:""}),[m,y]=U.useState({visible:!1,title:"",message:""}),[A,v]=U.useState({visible:!1}),[N,T]=U.useState({visible:!1}),[_,b]=U.useState({visible:!1,projectName:"",locationPath:"",locationHandle:null}),[H,R]=U.useState({visible:!1,filename:"",locationPath:"",locationHandle:null}),[M,B]=U.useState(!1),[q,G]=U.useState(!0),[X,O]=U.useState(!1);return{openMenu:s,setOpenMenu:e,setSizeDialog:t,setSetSizeDialog:n,autoSaveDialog:r,setAutoSaveDialog:o,autoSavePromptDialog:d,setAutoSavePromptDialog:c,debugDialog:h,setDebugDialog:f,errorDialog:m,setErrorDialog:y,newProjectDialog:A,setNewProjectDialog:v,openProjectDialog:N,setOpenProjectDialog:T,newProjectSetupDialog:_,setNewProjectSetupDialog:b,saveAsDialog:H,setSaveAsDialog:R,showColorPicker:M,setShowColorPicker:B,showWelcomeDialog:q,setShowWelcomeDialog:G,transformImagesDialogVisible:X,setTransformImagesDialogVisible:O}}function l4(){const[s,e]=U.useState(!1),[t,n]=U.useState(1),[r,o]=U.useState(null),[d,c]=U.useState(""),[h,f]=U.useState(""),[m,y]=U.useState(null),[A,v]=U.useState("pcb_project"),[N,T]=U.useState([]),[_,b]=U.useState(-1),H=U.useRef(null),R=U.useRef(!1),M=U.useRef(!1);return{autoSaveEnabled:s,setAutoSaveEnabled:e,autoSaveInterval:t,setAutoSaveInterval:n,autoSaveDirHandle:r,setAutoSaveDirHandle:o,autoSaveBaseName:d,setAutoSaveBaseName:c,currentProjectFilePath:h,setCurrentProjectFilePath:f,projectDirHandle:m,setProjectDirHandle:y,projectName:A,setProjectName:v,autoSaveFileHistory:N,setAutoSaveFileHistory:T,currentFileIndex:_,setCurrentFileIndex:b,autoSaveIntervalRef:H,hasChangesSinceLastAutoSaveRef:R,prevAutoSaveEnabledRef:M}}function c4(){const[s,e]=U.useState(null),t=U.useRef(!1),n=U.useCallback((c,h,f,m,y)=>{if(t.current)return;const A={drawingStrokes:JSON.parse(JSON.stringify(c)),componentsTop:JSON.parse(JSON.stringify(h)),componentsBottom:JSON.parse(JSON.stringify(f)),powerSymbols:JSON.parse(JSON.stringify(m)),groundSymbols:JSON.parse(JSON.stringify(y))};e(A)},[]),r=U.useCallback(()=>{if(!s)return null;t.current=!0;const c=s;return e(null),setTimeout(()=>{t.current=!1},100),c},[s]),o=s!==null,d=U.useCallback(()=>{e(null)},[]);return{saveSnapshot:n,undo:r,canUndo:o,clearSnapshot:d}}function d4(){const e=e4(),{topImage:t,setTopImage:n,bottomImage:r,setBottomImage:o,currentView:d,setCurrentView:c,transparency:h,setTransparency:f,isTransparencyCycling:m,setIsTransparencyCycling:y,transparencyCycleSpeed:A,setTransparencyCycleSpeed:v,isGrayscale:N,setIsGrayscale:T}=e,[_,b]=U.useState("none"),[H,R]=U.useState(()=>{const p=localStorage.getItem("bomExportFormat");return p==="json"||p==="pdf"?p:"pdf"});Dt.useEffect(()=>{localStorage.setItem("bomExportFormat",H)},[H]);const M=i4(),{brushColor:B,setBrushColor:q,brushSize:G,setBrushSize:X,topTraceColor:O,setTopTraceColor:Y,bottomTraceColor:W,setBottomTraceColor:I,topTraceSize:J,setTopTraceSize:Z,bottomTraceSize:Ce,setBottomTraceSize:ie,topPadColor:le,setTopPadColor:se,bottomPadColor:Ae,setBottomPadColor:ue,topPadSize:E,setTopPadSize:L,bottomPadSize:Q,setBottomPadSize:ee,topTestPointColor:oe,setTopTestPointColor:xe,bottomTestPointColor:re,setBottomTestPointColor:Le,topTestPointSize:Ee,setTopTestPointSize:Oe,bottomTestPointSize:Ze,setBottomTestPointSize:st,topComponentColor:mt,setTopComponentColor:Mt,bottomComponentColor:K,setBottomComponentColor:jt,topComponentSize:$t,setTopComponentSize:Yt,bottomComponentSize:yt,setBottomComponentSize:on,componentConnectionColor:ze,setComponentConnectionColor:Ne,componentConnectionSize:Ct,setComponentConnectionSize:wt,saveDefaultSize:it,saveDefaultColor:pt}=M,Ot=ZT(),{drawingStrokes:Qe,setDrawingStrokes:St,isDrawing:Wt,setIsDrawing:Bt,currentStroke:Ln,setCurrentStroke:Kt,tracePreviewMousePos:rn,setTracePreviewMousePos:un,drawingMode:ot,setDrawingMode:Zt,selectedDrawingLayer:sn,setSelectedDrawingLayer:Ft,currentStrokeRef:Jt,lastTraceClickTimeRef:yn,isDoubleClickingTraceRef:_n}=Ot,Qt=QT(),{selectedImageForTransform:Ut,setSelectedImageForTransform:zi,isTransforming:Jn,setIsTransforming:Lt,transformStartPos:Ht,setTransformStartPos:Et,transformMode:ti,setTransformMode:vi}=Qt,ar=t4(),{viewScale:_t,setViewScale:Fn,viewRotation:Xn,setViewRotation:ci,viewFlipX:ri,setViewFlipX:Br,cameraWorldCenter:Di,setCameraWorldCenter:Ni,resetView:Ns,isShiftConstrained:ha,setIsShiftConstrained:Na,showBothLayers:$l,setShowBothLayers:Wa,setCameraCenter:$a,getViewPan:No}=ar,[Qn,Us]=U.useState("top"),[Ti,Pa]=U.useState("top"),[On,Qo]=U.useState("top"),[wi,fa]=U.useState("top"),Ea=Dt.useRef("top"),el=Dt.useRef("top"),tl=Dt.useRef("top"),Ga=Dt.useRef("top");Dt.useEffect(()=>{Ea.current=Qn},[Qn]),Dt.useEffect(()=>{el.current=Ti},[Ti]),Dt.useEffect(()=>{tl.current=On},[On]),Dt.useEffect(()=>{Ga.current=wi},[wi]);const ud=s4({currentTool:_,drawingMode:ot,traceToolLayer:Qn,padToolLayer:Ti,testPointToolLayer:On,componentToolLayer:wi}),{toolState:dr}=ud,nl=r4(fC,_,ot,B,G,O,W,J,Ce,le,Ae,E,Q,oe,re,Ee,Ze,mt,K,$t,yt,Qn,Ti,On,wi),{toolRegistry:$n,setToolRegistry:Wn,getCurrentToolDef:il,updateToolSettings:co,updateToolLayerSettings:Ra}=nl,ea=Dt.useRef(null),ki=Dt.useRef(B),Ki=Dt.useRef(G);Dt.useEffect(()=>{Wn(p=>{const C=il(p),D=C?.id||null,$=ea.current,de=new Map(p);if($&&$!==D){const be=p.get($);be&&de.set($,{...be,settings:{color:ki.current,size:Ki.current}})}if(C&&D!==$)if(_==="draw"&&ot==="trace"){const be=Qn||"top",z=be==="top"?O:W,Pe=be==="top"?J:Ce;q(z),X(Pe),ki.current=z,Ki.current=Pe;const ve=new Map(C.layerSettings);ve.set("top",{color:O,size:J}),ve.set("bottom",{color:W,size:Ce}),de.set("trace",{...C,settings:{color:z,size:Pe},layerSettings:ve})}else if(_==="draw"&&ot==="pad"){const be=Ti||"top",z=be==="top"?le:Ae,Pe=be==="top"?E:Q;q(z),X(Pe),ki.current=z,Ki.current=Pe;const ve=new Map(C.layerSettings);ve.set("top",{color:le,size:E}),ve.set("bottom",{color:Ae,size:Q}),de.set("pad",{...C,settings:{color:z,size:Pe},layerSettings:ve})}else if(_==="draw"&&ot==="testPoint"){const be=On||"top",z=be==="top"?oe:re,Pe=be==="top"?Ee:Ze;q(z),X(Pe),ki.current=z,Ki.current=Pe;const ve=new Map(C.layerSettings);ve.set("top",{color:oe,size:Ee}),ve.set("bottom",{color:re,size:Ze}),de.set("testPoint",{...C,settings:{color:z,size:Pe},layerSettings:ve})}else if(_==="component"){const be=wi||"top",z=be==="top"?mt:K,Pe=be==="top"?$t:yt;q(z),X(Pe),ki.current=z,Ki.current=Pe;const ve=new Map(C.layerSettings);ve.set("top",{color:mt,size:$t}),ve.set("bottom",{color:K,size:yt}),de.set("component",{...C,settings:{color:z,size:Pe},layerSettings:ve})}else{const be=C.settings;q(be.color),X(be.size),ki.current=be.color,Ki.current=be.size}return ea.current=D,de})},[_,ot,il,O,W,J,Ce,le,Ae,E,Q,oe,re,Ee,Ze,On,mt,K,$t,yt]),Dt.useEffect(()=>{const p=$n.get("trace");if(p){const de=p.layerSettings.get("top"),be=p.layerSettings.get("bottom");de&&(Y(de.color),Z(de.size)),be&&(I(be.color),ie(be.size))}const C=$n.get("pad");if(C){const de=C.layerSettings.get("top"),be=C.layerSettings.get("bottom");de&&(se(de.color),L(de.size)),be&&(ue(be.color),ee(be.size))}const D=$n.get("testPoint");if(D){const de=D.layerSettings.get("top"),be=D.layerSettings.get("bottom");de&&(xe(de.color),Oe(de.size)),be&&(Le(be.color),st(be.size))}const $=$n.get("component");if($){const de=$.layerSettings.get("top"),be=$.layerSettings.get("bottom");de&&(Mt(de.color),Yt(de.size)),be&&(jt(be.color),on(be.size))}},[]),Dt.useEffect(()=>{Wn(p=>{const C=new Map(p),D=p.get("trace");if(D){const Pe=new Map(D.layerSettings);Pe.set("top",{color:O,size:J}),Pe.set("bottom",{color:W,size:Ce}),C.set("trace",{...D,layerSettings:Pe})}const $=p.get("pad");if($){const Pe=new Map($.layerSettings);Pe.set("top",{color:le,size:E}),Pe.set("bottom",{color:Ae,size:Q}),C.set("pad",{...$,layerSettings:Pe})}const de=p.get("testPoint");if(de){const Pe=new Map(de.layerSettings);Pe.set("top",{color:oe,size:Ee}),Pe.set("bottom",{color:re,size:Ze}),C.set("testPoint",{...de,layerSettings:Pe})}const be=p.get("component");if(be){const Pe=new Map(be.layerSettings);Pe.set("top",{color:mt,size:$t}),Pe.set("bottom",{color:K,size:yt}),C.set("component",{...be,layerSettings:Pe})}const z=p.get("componentConnection");return z&&C.set("componentConnection",{...z,settings:{color:ze,size:Ct}}),C})},[O,W,J,Ce,le,Ae,E,Q,oe,re,Ee,Ze,mt,K,$t,yt,ze,Ct,Wn]),Dt.useEffect(()=>{Wn(p=>{const C=il(p);if(C)if(_==="draw"&&ot==="trace"){const D=Qn||"top",$=D==="top"?"traceTop":"traceBottom",de=Bn.get($),be=de.color,z=de.size;D==="top"?(Y(be),Z(z),pt("trace",be,"top"),it("trace",z,"top")):(I(be),ie(z),pt("trace",be,"bottom"),it("trace",z,"bottom"));const Pe=new Map(p),ve=new Map(C.layerSettings);return ve.set(D,{color:be,size:z}),Pe.set(C.id,{...C,layerSettings:ve,settings:{color:be,size:z}}),ki.current=be,Ki.current=z,Pe}else if(_==="draw"&&ot==="pad"){const D=Ti||"top",$=D==="top"?"padTop":"padBottom",de=Bn.get($),be=de.color,z=de.size;D==="top"?(se(be),L(z),pt("pad",be,"top"),it("pad",z,"top")):(ue(be),ee(z),pt("pad",be,"bottom"),it("pad",z,"bottom"));const Pe=new Map(p),ve=new Map(C.layerSettings);return ve.set(D,{color:be,size:z}),Pe.set(C.id,{...C,layerSettings:ve,settings:{color:be,size:z}}),ki.current=be,Ki.current=z,Pe}else if(_==="draw"&&ot==="testPoint"){const D=On||"top",$=D==="top"?"testPointTop":"testPointBottom",de=Bn.get($),be=de.color,z=de.size;D==="top"?(xe(be),Oe(z),pt("testPoint",be,"top"),it("testPoint",z,"top")):(Le(be),st(z),pt("testPoint",be,"bottom"),it("testPoint",z,"bottom"));const Pe=new Map(p),ve=new Map(C.layerSettings);return ve.set(D,{color:be,size:z}),Pe.set(C.id,{...C,layerSettings:ve,settings:{color:be,size:z}}),ki.current=be,Ki.current=z,Pe}else if(_==="component"){const D=wi||"top",$=D==="top"?"componentTop":"componentBottom",de=Bn.get($),be=de.color,z=de.size;D==="top"?(Mt(be),Yt(z),pt("component",be,"top"),it("component",z,"top")):(jt(be),on(z),pt("component",be,"bottom"),it("component",z,"bottom"));const Pe=new Map(p),ve=new Map(C.layerSettings);return ve.set(D,{color:be,size:z}),Pe.set(C.id,{...C,layerSettings:ve,settings:{color:be,size:z}}),ki.current=be,Ki.current=z,Pe}else{const D=new Map(p);return D.set(C.id,{...C,settings:{color:B,size:G}}),ki.current=B,Ki.current=G,D}return p})},[B,G,_,ot,Qn,Ti,On,wi,il,pt,it,sf,Y,I,Z,ie,se,ue,L,ee,xe,Le,Oe,st,Mt,jt,Yt,on]),Dt.useEffect(()=>{if(_==="draw"&&ot==="trace"){const p=Qn;Ft(p),q(p==="top"?O:W),X(p==="top"?J:Ce),p==="top"?(ys(!0),Sa(!0)):(As(!0),Gs(!0)),Sd(!0)}else Sd(!1)},[_,ot,Qn,O,W,J,Ce]),Dt.useEffect(()=>{if(_==="draw"&&ot==="pad"){const p=Ti;Ft(p);const C=Bn.get(p==="top"?"padTop":"padBottom");q(C.color),X(C.size),p==="top"?(ys(!0),Xs(!0)):(As(!0),no(!0)),Zu(!0)}else Zu(!1)},[_,ot,Ti]),Dt.useEffect(()=>{if(_==="draw"&&ot==="testPoint"){const p=On;Ft(p),q(p==="top"?oe:re),X(p==="top"?Ee:Ze),p==="top"?(ys(!0),ic(!0)):(As(!0),rc(!0)),vu(!0)}else vu(!1)},[_,ot,On,oe,re,Ee,Ze]);const[Si,Fr]=U.useState(!1);Dt.useEffect(()=>{if(_==="component"){const p=wi;Ft(p),q(p==="top"?mt:K),X(p==="top"?$t:yt),p==="top"?(ys(!0),sa(!0)):(As(!0),Aa(!0)),Si||Nf(!0)}else Nf(!1),Fr(!1)},[_,wi,mt,K,$t,yt,Si]),Dt.useEffect(()=>{if(_==="component"){const p=wi;Ft(p),q(p==="top"?mt:K),X(p==="top"?$t:yt)}},[wi,_,mt,K,$t,yt]),Dt.useEffect(()=>{dr.toolInstanceId&&(q(dr.color),X(dr.size))},[dr.toolInstanceId,dr.color,dr.size,q,X,_,ot]);const[$c,ta]=U.useState(void 0),[,Hs]=U.useState([]),[,Gl]=U.useState([]),[,pa]=U.useState([]),[,vs]=U.useState([]),[na,Ya]=U.useState([]),[zt,$i]=U.useState([]),[uo,Tl]=U.useState([]),[Kr,ho]=U.useState([]),ur=U.useRef(null),or=Dt.useMemo(()=>{const p=ur.current;if(!p)return{x:0,y:0};const C=(p.width-10)/2,D=(p.height-10)/2;return No(C,D)},[ur.current?.width,ur.current?.height,Di,_t,No]),Po=Dt.useCallback(p=>{const C=ur.current;if(!C)return;const D=(C.width-10)/2,$=(C.height-10)/2,de=No(D,$),be=typeof p=="function"?p(de):p,z=(D-be.x)/_t,Pe=($-be.y)/_t;Ni({x:z,y:Pe})},[No,_t,Ni]),qn=JT(),{selectedIds:li,setSelectedIds:Pn,isSelecting:Gc,setIsSelecting:ga,selectedComponentIds:gn,setSelectedComponentIds:jn,selectedPowerIds:ui,setSelectedPowerIds:pn,selectedGroundIds:hi,setSelectedGroundIds:xn}=qn,du=v5(),{componentsTop:Gt,setComponentsTop:Bi,componentsBottom:an,setComponentsBottom:Kn,componentEditor:Vs,setComponentEditor:Xa,connectingPin:as,setConnectingPin:rl,componentDialogPosition:Da,setComponentDialogPosition:Ka,isDraggingDialog:sl,setIsDraggingDialog:Ac,dialogDragOffset:Yl,setDialogDragOffset:kl,openComponentEditor:Eo}=du,uu=n4(),{powerBuses:wn,setPowerBuses:Ro,groundBuses:j,setGroundBuses:te,powerSymbols:Se,setPowerSymbols:Ie,groundSymbols:Ve,setGroundSymbols:lt,powerEditor:At,setPowerEditor:ln}=uu,Tn=c4(),{saveSnapshot:Sn,undo:si,clearSnapshot:_i}=Tn;Dt.useEffect(()=>{_==="power"?(In(!1),wn.length>1?ct&&wn.some(C=>C.id===ct)?Ge(!1):(Ge(!0),ct!==null&&Ke(null)):wn.length===1?(Ke(wn[0].id),Ge(!1)):(Ge(!0),Ke(null))):Ge(!1)},[_,wn]),Dt.useEffect(()=>{_==="ground"?(Ge(!1),j.length>1?Ei&&j.some(C=>C.id===Ei)?In(!1):(In(!0),Ei!==null&&Gn(null)):j.length===1?(Gn(j[0].id),In(!1)):(In(!0),Gn(null))):In(!1)},[_,j]),Dt.useEffect(()=>{_!=="power"&&_!=="ground"&&(Ge(!1),In(!1))},[_]);const Zr=a4(),{areImagesLocked:Fi,setAreImagesLocked:Qi,areViasLocked:Ui,setAreViasLocked:Lr,arePadsLocked:hr,setArePadsLocked:fo,areTestPointsLocked:Ps,setAreTestPointsLocked:al,areTracesLocked:ws,setAreTracesLocked:ol,areComponentsLocked:Or,setAreComponentsLocked:ma,areGroundNodesLocked:Ss,setAreGroundNodesLocked:Za,arePowerNodesLocked:fi,setArePowerNodesLocked:po}=Zr,Cc=o4(),{openMenu:hd,setOpenMenu:Ja,setSizeDialog:qs,setSetSizeDialog:Do,autoSaveDialog:Tc,setAutoSaveDialog:Lo,autoSavePromptDialog:ya,setAutoSavePromptDialog:hs,debugDialog:Qa,setDebugDialog:ll,errorDialog:go,setErrorDialog:mo,newProjectDialog:xa,setNewProjectDialog:fs,openProjectDialog:Mo,setOpenProjectDialog:La,newProjectSetupDialog:Li,setNewProjectSetupDialog:Io,saveAsDialog:fr,setSaveAsDialog:jr,showColorPicker:fd,setShowColorPicker:Ma,transformImagesDialogVisible:_l,setTransformImagesDialogVisible:Es}=Cc,Xl=l4(),[pd,eo]=U.useState(!1),[cl,zo]=U.useState(!1),[ba,Ws]=U.useState(!1),[Ia,Bo]=U.useState(null),[va,yo]=U.useState(null),[er,Hi]=U.useState(null),[Nr,ps]=U.useState(null),[jl,dl]=U.useState(null),{autoSaveEnabled:gs,setAutoSaveEnabled:wa,autoSaveInterval:Nl,setAutoSaveInterval:ul,autoSaveDirHandle:Pl,setAutoSaveDirHandle:Kl,autoSaveBaseName:El,setAutoSaveBaseName:to,currentProjectFilePath:Rl,setCurrentProjectFilePath:br,projectDirHandle:Pi,setProjectDirHandle:Jr,projectName:Qr,setProjectName:za,autoSaveFileHistory:Bd,setAutoSaveFileHistory:hl,currentFileIndex:Fd,setCurrentFileIndex:Fo,autoSaveIntervalRef:Zi,hasChangesSinceLastAutoSaveRef:pr,prevAutoSaveEnabledRef:Rs}=Xl,Od=U.useRef(null),ia=U.useRef(null),gd=U.useRef(null),Ba=U.useRef(null),Yc=U.useRef(null),Dl=U.useRef(null),Zl=U.useRef(null),[fl,kc]=U.useState(!1),Oo=U.useRef(null),Jl=U.useRef(null),[Fa,Ql]=U.useState(!1),[xo,Ll]=U.useState({}),[md,ms]=U.useState(!1),bo=U.useCallback(()=>{const p=ur.current;if(!p)return null;const C=p.width-10,D=p.height-10;let $=1/0,de=1/0,be=-1/0,z=-1/0,Pe=!1;if(t){const Me=t,De=(Me.width||0)/2,$e=(Me.height||0)/2;$=Math.min($,Me.x-De),de=Math.min(de,Me.y-$e),be=Math.max(be,Me.x+De),z=Math.max(z,Me.y+$e),Pe=!0}if(r){const Me=r,De=(Me.width||0)/2,$e=(Me.height||0)/2;$=Math.min($,Me.x-De),de=Math.min(de,Me.y-$e),be=Math.max(be,Me.x+De),z=Math.max(z,Me.y+$e),Pe=!0}if(!Pe)return{pcbReferenceX:0,pcbReferenceY:0,x:0,y:0,zoom:1,viewRotation:0,viewFlipX:!1,isBottomView:!1,transparency:0,showTopImage:!0,showBottomImage:!0,showViasLayer:!0,showTopTracesLayer:!0,showBottomTracesLayer:!0,showTopPadsLayer:!0,showBottomPadsLayer:!0,showTopTestPointsLayer:!0,showBottomTestPointsLayer:!0,showTopComponents:!0,showBottomComponents:!0,showPowerLayer:!0,showGroundLayer:!0,showConnectionsLayer:!0};const ve=be-$,Re=z-de,je=.1,_e=ve*(1+2*je),fe=Re*(1+2*je),ye=_e>0?C/_e:1,pe=fe>0?D/fe:1;return{pcbReferenceX:0,pcbReferenceY:0,x:0,y:0,zoom:Math.min(ye,pe,1),viewRotation:0,viewFlipX:!1,isBottomView:!1,transparency:0,showTopImage:!0,showBottomImage:!0,showViasLayer:!0,showTopTracesLayer:!0,showBottomTracesLayer:!0,showTopPadsLayer:!0,showBottomPadsLayer:!0,showTopTestPointsLayer:!0,showBottomTestPointsLayer:!0,showTopComponents:!0,showBottomComponents:!0,showPowerLayer:!0,showGroundLayer:!0,showConnectionsLayer:!0}},[t,r]);Dt.useEffect(()=>{const p=bo();p&&Ll(C=>C[0]?C:{...C,0:p})},[t,r,bo]);const os=U.useRef(null),[Oa,vo]=U.useState(!1),[Ds,_c]=U.useState(null),[yd,ec]=U.useState(null),[Ml,ra]=U.useState({width:960,height:600}),Pr=U.useRef(null),Mi=U.useRef(null),Ua=U.useRef(null),ls=U.useRef(null),wo=U.useRef(null),tc=U.useRef(null),hu=U.useRef(null),Il=U.useRef(null),[Ur,ys]=U.useState(!0),[zl,As]=U.useState(!0),[fu,nc]=U.useState(!1),[Ar,$s]=U.useState(!0),[Cr,Sa]=U.useState(!0),[cs,Gs]=U.useState(!0),[Ys,Xs]=U.useState(!0),[tr,no]=U.useState(!0),[So,ic]=U.useState(!0),[Uo,rc]=U.useState(!0),[Vi,sa]=U.useState(!0),[Ks,Aa]=U.useState(!0),[Ha,x]=U.useState(!0),S=Se,P=Ve,[F,ne]=U.useState(!1),[ae,ce]=U.useState(null),[me,we]=U.useState(!1),[Te,Fe]=U.useState(void 0),[et,ke]=U.useState(!1),[qe,Ge]=U.useState(!1),[ct,Ke]=U.useState(null),[gt,ut]=U.useState(new Set),bt=U.useCallback(()=>{Pn(new Set),jn(new Set),pn(new Set),xn(new Set),ut(new Set)},[Pn,jn,pn,xn,ut]),[Nt,hn]=U.useState(!1),[dn,ni]=U.useState(null),[fn,In]=U.useState(!1),[Ei,Gn]=U.useState(null),[en,Vt]=U.useState(!0),[lr,Dn]=U.useState(!1),[di,nr]=U.useState(!1),gr=U.useRef({}),[mr,Ai]=U.useState(!0),[yr,Hr]=U.useState(!0),[Vr,pi]=U.useState(!0),[ai,Tr]=U.useState(null),[Gi,Cs]=U.useState(!1),[Er,Yi]=U.useState(null),[es,Ii]=U.useState(!1),[Mr,ts]=U.useState(null),[xr,qi]=U.useState(!1),[Ls,ns]=U.useState(null),[Nn,En]=U.useState([]),[Wi,aa]=U.useState(!1),[oa,Ms]=U.useState(null),[ds,Bl]=U.useState(!1),[pl,xd]=U.useState(null),[vr,pu]=U.useState(!1),[jc,Nc]=U.useState(null),[gl,Xu]=U.useState(!1),[bd,Ud]=U.useState(null),[gu,qr]=U.useState(!1),[Wr,sc]=U.useState(!1),[ac,Xc]=U.useState(null),[Fl,ml]=U.useState(!1),[oc,Pc]=U.useState(null),[Hd,Vd]=U.useState(!1),Ho=U.useRef(null),vd=U.useRef(!1),Ec=U.useRef(null),qd=U.useRef(!1),Kc=U.useRef(!1);Dt.useEffect(()=>{Ho.current=ac},[ac]),Dt.useEffect(()=>{vd.current=Fl},[Fl]),Dt.useEffect(()=>{Ec.current=oc},[oc]),Dt.useEffect(()=>{qd.current=Hd},[Hd]),Dt.useEffect(()=>{Kc.current=Wr},[Wr]);const[Rc,mu]=U.useState(null),[Rh,Wd]=U.useState(!1);Dt.useEffect(()=>{wn.length===0&&Ro([{id:"default-3v3",name:"+3.3V",voltage:"+3.3VDC",color:"#ff6600"},{id:"default-5v",name:"+5V",voltage:"+5VDC",color:"#ff0000"}])},[wn.length,Ro]);const Vo=U.useCallback((p,C)=>{const D=S.find(de=>de.pointId===p);if(D){const de=C.find(z=>z.id===D.powerBusId);return`Via (${de?de.voltage:D.type||"Power Node"})`}const $=P.find(de=>de.pointId===p);return $?`Via (${$.type||"Ground"})`:"Via"},[S,P]),yl=U.useCallback((p,C)=>{const D=S.find(de=>de.pointId===p);if(D){const de=C.find(z=>z.id===D.powerBusId);return`Pad (${de?de.voltage:D.type||"Power Node"})`}const $=P.find(de=>de.pointId===p);return $?`Pad (${$.type||"Ground"})`:"Pad"},[S,P]),Ca=U.useCallback((p,C)=>{const D=S.find(de=>de.pointId===p);if(D){const de=C.find(z=>z.id===D.powerBusId);return`Test Point (${de?de.voltage:D.type||"Power Node"})`}const $=P.find(de=>de.pointId===p);return $?`Test Point (${$.type||"Ground"})`:"Test Point"},[S,P]),yu=U.useCallback(()=>{const p=Qe.filter(C=>C.type==="via").map(C=>C.id);Pn(new Set(p)),jn(new Set),pn(new Set),xn(new Set),ut(new Set)},[Qe,Pn,jn,pn,xn]),$d=U.useCallback(()=>{const p=Qe.filter(C=>C.type==="trace").map(C=>C.id);Pn(new Set(p)),jn(new Set),pn(new Set),xn(new Set),ut(new Set)},[Qe,Pn,jn,pn,xn]),Ol=U.useCallback(()=>{const p=Qe.filter(C=>C.type==="pad").map(C=>C.id);Pn(new Set(p)),jn(new Set),pn(new Set),xn(new Set),ut(new Set)},[Qe,Pn,jn,pn,xn]),lc=U.useCallback(()=>{const p=[...Gt,...an].map(C=>C.id);jn(new Set(p)),Pn(new Set),pn(new Set),xn(new Set),ut(new Set)},[Gt,an,jn,Pn,pn,xn]),cc=U.useCallback(()=>{const p=[...Gt,...an].filter(C=>{const D=C.pinConnections||[];return!(D.length>0&&D.length===C.pinCount&&D.every(de=>de&&de.trim()!==""))}).map(C=>C.id);jn(new Set(p)),Pn(new Set),pn(new Set),xn(new Set),ut(new Set),ll({visible:!0,text:""})},[Gt,an,jn,Pn,pn,xn,ll]),xu=U.useCallback(()=>{const p=new Set;let C=0;for(const D of[...Gt,...an]){const $=D.pinConnections||[];for(const de of $)if(de&&de.trim()!==""){const be=parseInt(de.trim(),10);if(!isNaN(be)&&be>0){const z=`${D.id}:${be}`;p.add(z),C++}}}if(console.log(`Component connections: ${C} connection lines found`),p.size===0){console.log("No component connections found - components may not have pins connected"),alert("No component connections found. Please connect component pins to vias or pads first.");return}ut(p),Pn(new Set),jn(new Set),pn(new Set),xn(new Set),console.log(`Selected ${p.size} component connection lines`)},[Gt,an,Pn,jn,pn,xn]),Gd=U.useCallback(()=>{ba?(Br(!1),Ws(!1),f(0)):(Br(!0),Ws(!0),f(100))},[ba,Br,Ws,f]),Dc=U.useCallback(p=>{ci(C=>Hm(C,p))},[ci]),xl=U.useCallback((p,C)=>{const D=ur.current;if(!D)return;const $=D.width-10,de=D.height-10,be=$/2,z=de/2,Pe=be-p*_t,ve=z-C*_t;Po({x:Pe,y:ve})},[_t,Po]),Zc=U.useCallback((p,C,D)=>{xl(C,D),jn(new Set([p])),Pn(new Set),pn(new Set),xn(new Set),ut(new Set)},[xl,jn,Pn,pn,xn]),wd=U.useCallback((p,C,D)=>{xl(C,D),Pn(new Set([p])),jn(new Set),pn(new Set),xn(new Set),ut(new Set)},[xl,Pn,jn,pn,xn]),Ep=U.useCallback((p,C,D)=>{xl(C,D),pn(new Set([p])),Pn(new Set),jn(new Set),xn(new Set),ut(new Set)},[xl,pn,Pn,jn,xn]),_f=U.useCallback((p,C,D)=>{xl(C,D),xn(new Set([p])),Pn(new Set),jn(new Set),pn(new Set),ut(new Set)},[xl,xn,Pn,jn,pn]),y0=U.useCallback((p,C,D)=>{xl(C,D),Pn(new Set([p])),jn(new Set),pn(new Set),xn(new Set),ut(new Set)},[xl,Pn,jn,pn,xn]),Rp=Dt.useMemo(()=>{const p=new Set(S.map(D=>D.powerBusId).filter(D=>typeof D=="string"&&D.length>0)),C=wn.filter(D=>p.has(D.id)).map(D=>D.name);return Array.from(new Set(C)).sort()},[S,wn]),Dp=Dt.useMemo(()=>{const p=new Set(P.map(D=>D.groundBusId).filter(D=>typeof D=="string"&&D.length>0)),C=j.filter(D=>p.has(D.id)).map(D=>D.name);return Array.from(new Set(C)).sort()},[P,j]),Lp=U.useCallback(()=>{const p=S.map(C=>C.id);pn(new Set(p)),Pn(new Set),jn(new Set),xn(new Set),ut(new Set)},[S,pn,Pn,jn,xn]),Mp=U.useCallback(()=>{const p=P.map(C=>C.id);xn(new Set(p)),Pn(new Set),jn(new Set),pn(new Set),ut(new Set)},[P,xn,Pn,jn,pn]),Ip=U.useCallback(p=>{const C=wn.filter($=>$.name===p).map($=>$.id);if(C.length===0)return;const D=S.filter($=>$.powerBusId&&C.includes($.powerBusId)).map($=>$.id);pn(new Set(D)),Pn(new Set),jn(new Set),xn(new Set)},[wn,S,pn,Pn,jn,xn]),jf=U.useCallback(p=>{const C=j.filter($=>$.name===p).map($=>$.id);if(C.length===0)return;const D=P.filter($=>$.groundBusId&&C.includes($.groundBusId)).map($=>$.id);xn(new Set(D)),Pn(new Set),jn(new Set),pn(new Set)},[j,P,xn,Pn,jn,pn]);U.useCallback(p=>{switch(p.componentType){case"Resistor":case"ResistorNetwork":case"Thermistor":case"VariableResistor":if("resistance"in p&&p.resistance&&"resistanceUnit"in p&&p.resistanceUnit)return`${p.resistance} ${p.resistanceUnit}`;break;case"Capacitor":case"Electrolytic Capacitor":case"Film Capacitor":if("capacitance"in p&&p.capacitance&&"capacitanceUnit"in p&&p.capacitanceUnit)return`${p.capacitance} ${p.capacitanceUnit}`;break;case"Inductor":if("inductance"in p&&p.inductance&&"inductanceUnit"in p&&p.inductanceUnit)return`${p.inductance} ${p.inductanceUnit}`;break;case"Battery":if("voltage"in p&&p.voltage&&"voltageUnit"in p&&p.voltageUnit)return`${p.voltage} ${p.voltageUnit}`;break;case"Diode":if("voltage"in p&&p.voltage&&"voltageUnit"in p&&p.voltageUnit)return`${p.voltage} ${p.voltageUnit}`;break;case"Fuse":if("current"in p&&p.current&&"currentUnit"in p&&p.currentUnit)return`${p.current} ${p.currentUnit}`;break;case"FerriteBead":if("impedance"in p&&p.impedance&&"impedanceUnit"in p&&p.impedanceUnit)return`${p.impedance} ${p.impedanceUnit}`;break;case"Relay":if("coilVoltage"in p&&p.coilVoltage&&"coilVoltageUnit"in p&&p.coilVoltageUnit)return`${p.coilVoltage} ${p.coilVoltageUnit}`;break;case"Speaker":if("impedance"in p&&p.impedance&&"impedanceUnit"in p&&p.impedanceUnit)return`${p.impedance} ${p.impedanceUnit}`;break;case"Motor":if("voltage"in p&&p.voltage&&"voltageUnit"in p&&p.voltageUnit)return`${p.voltage} ${p.voltageUnit}`;break;case"PowerSupply":if("outputVoltage"in p&&p.outputVoltage&&"outputVoltageUnit"in p&&p.outputVoltageUnit)return`${p.outputVoltage} ${p.outputVoltageUnit}`;break;case"Transistor":if("partNumber"in p&&p.partNumber)return p.partNumber;break;case"IntegratedCircuit":if("partNumber"in p&&p.partNumber)return p.partNumber;break}return null},[]);const zp=U.useCallback(p=>{const C=[];switch(p.componentType){case"Capacitor":case"Electrolytic Capacitor":case"Film Capacitor":"capacitance"in p&&p.capacitance&&"capacitanceUnit"in p&&p.capacitanceUnit&&C.push(`Capacitance: ${p.capacitance} ${p.capacitanceUnit}`),"voltage"in p&&p.voltage&&"voltageUnit"in p&&p.voltageUnit&&C.push(`Voltage: ${p.voltage} ${p.voltageUnit}`),"dielectric"in p&&p.dielectric&&C.push(`Dielectric: ${p.dielectric}`);break;case"Resistor":case"ResistorNetwork":case"Thermistor":"resistance"in p&&p.resistance&&"resistanceUnit"in p&&p.resistanceUnit&&C.push(`Resistance: ${p.resistance} ${p.resistanceUnit}`),"power"in p&&p.power&&C.push(`Power: ${p.power}`),"tolerance"in p&&p.tolerance&&C.push(`Tolerance: ${p.tolerance}`);break;case"VariableResistor":"resistance"in p&&p.resistance&&"resistanceUnit"in p&&p.resistanceUnit&&C.push(`Resistance: ${p.resistance} ${p.resistanceUnit}`),"vrType"in p&&p.vrType&&C.push(`Type: ${p.vrType}`),"power"in p&&p.power&&C.push(`Power: ${p.power}`),"taper"in p&&p.taper&&C.push(`Taper: ${p.taper}`);break;case"Inductor":"inductance"in p&&p.inductance&&"inductanceUnit"in p&&p.inductanceUnit&&C.push(`Inductance: ${p.inductance} ${p.inductanceUnit}`),"current"in p&&p.current&&"currentUnit"in p&&p.currentUnit&&C.push(`Current: ${p.current} ${p.currentUnit}`),"tolerance"in p&&p.tolerance&&C.push(`Tolerance: ${p.tolerance}`);break;case"Battery":"voltage"in p&&p.voltage&&"voltageUnit"in p&&p.voltageUnit&&C.push(`Voltage: ${p.voltage} ${p.voltageUnit}`),"capacity"in p&&p.capacity&&"capacityUnit"in p&&p.capacityUnit&&C.push(`Capacity: ${p.capacity} ${p.capacityUnit}`);break;case"Diode":"voltage"in p&&p.voltage&&"voltageUnit"in p&&p.voltageUnit&&C.push(`Voltage: ${p.voltage} ${p.voltageUnit}`),"current"in p&&p.current&&"currentUnit"in p&&p.currentUnit&&C.push(`Current: ${p.current} ${p.currentUnit}`);break;case"Fuse":"current"in p&&p.current&&"currentUnit"in p&&p.currentUnit&&C.push(`Current: ${p.current} ${p.currentUnit}`),"voltage"in p&&p.voltage&&"voltageUnit"in p&&p.voltageUnit&&C.push(`Voltage: ${p.voltage} ${p.voltageUnit}`);break;case"FerriteBead":"impedance"in p&&p.impedance&&"impedanceUnit"in p&&p.impedanceUnit&&C.push(`Impedance: ${p.impedance} ${p.impedanceUnit}`),"current"in p&&p.current&&"currentUnit"in p&&p.currentUnit&&C.push(`Current: ${p.current} ${p.currentUnit}`);break;case"Relay":"coilVoltage"in p&&p.coilVoltage&&"coilVoltageUnit"in p&&p.coilVoltageUnit&&C.push(`Coil Voltage: ${p.coilVoltage} ${p.coilVoltageUnit}`),"contactRating"in p&&p.contactRating&&C.push(`Contact Rating: ${p.contactRating}`);break;case"Speaker":"impedance"in p&&p.impedance&&"impedanceUnit"in p&&p.impedanceUnit&&C.push(`Impedance: ${p.impedance} ${p.impedanceUnit}`),"power"in p&&p.power&&C.push(`Power: ${p.power}`);break;case"Motor":"voltage"in p&&p.voltage&&"voltageUnit"in p&&p.voltageUnit&&C.push(`Voltage: ${p.voltage} ${p.voltageUnit}`),"speed"in p&&p.speed&&"speedUnit"in p&&p.speedUnit&&C.push(`Speed: ${p.speed} ${p.speedUnit}`);break;case"PowerSupply":"outputVoltage"in p&&p.outputVoltage&&"outputVoltageUnit"in p&&p.outputVoltageUnit&&C.push(`Output Voltage: ${p.outputVoltage} ${p.outputVoltageUnit}`),"outputCurrent"in p&&p.outputCurrent&&"outputCurrentUnit"in p&&p.outputCurrentUnit&&C.push(`Output Current: ${p.outputCurrent} ${p.outputCurrentUnit}`);break;case"Transistor":"partNumber"in p&&p.partNumber&&C.push(`Part Number: ${p.partNumber}`),"transistorType"in p&&p.transistorType&&C.push(`Type: ${p.transistorType}`);break;case"Crystal":"frequency"in p&&p.frequency&&C.push(`Frequency: ${p.frequency}`),"loadCapacitance"in p&&p.loadCapacitance&&C.push(`Load Capacitance: ${p.loadCapacitance}`),"tolerance"in p&&p.tolerance&&C.push(`Tolerance: ${p.tolerance}`);break;case"VacuumTube":"tubeType"in p&&p.tubeType&&C.push(`Tube Type: ${p.tubeType}`),"partNumber"in p&&p.partNumber&&C.push(`Part Number: ${p.partNumber}`);break}return C},[]),[bu,Sd]=U.useState(!1),Yd=U.useRef(null),[Ku,Zu]=U.useState(!1),[Ju,vu]=U.useState(!1),wu=U.useRef(null),Xd=U.useRef(null),Qu=U.useRef(null),eh=U.useRef(null),[x0,Nf]=U.useState(!1),[dc,Kd]=U.useState(null),[Pf,Dh]=U.useState(null),[Jc,Bp]=U.useState(null),Zd=Dt.useRef(null),Ef=Dt.useRef(null),th=Dt.useRef(null),nh=U.useRef(null),Su=U.useRef(null),Au=U.useRef(null),Fp=U.useRef(null),Lh=U.useRef(null),Qc=U.useRef(null),[Op,Up]=U.useState(null),[qo,Mh]=U.useState(null),[uc,Ih]=U.useState(!1),[Jd,Rf]=U.useState(null),[Ad,ih]=U.useState(null);Dt.useEffect(()=>{Ef.current=Jc},[Jc]),Dt.useEffect(()=>{th.current=dc},[dc]);const Is=U.useCallback(async(p,C)=>{if(!C)throw new Error("No project directory available. Please create or open a project before loading images. The project directory is needed to store image files.");try{let D;try{D=await C.getDirectoryHandle("images",{create:!0})}catch(be){throw new Error(`Failed to create images directory in project folder. This may be due to insufficient permissions. Please ensure you have write access to the project directory. Error details: ${be.message}`)}const $=p.name,de=`images/${$}`;try{const z=await(await D.getFileHandle($,{create:!0})).createWritable();return await z.write(p),await z.close(),console.log(`Image copied to project directory: ${de}`),de}catch(be){throw new Error(`Failed to copy image file "${$}" to project images directory. The file may be locked by another application, or there may be insufficient disk space. Please try again or check your disk space. Error details: ${be.message}`)}}catch(D){throw D instanceof Error&&D.message.includes("No project directory")||D instanceof Error&&D.message.includes("Failed to")?D:new Error(`An unexpected error occurred while copying the image to the project directory. This may be due to file system permissions or disk space issues. Please try again. Technical details: ${D.message}`)}},[]),Ta=U.useCallback(async(p,C)=>{try{const D=p.name.toLowerCase(),de=[".png",".jpg",".jpeg"].some(pe=>D.endsWith(pe)),z=["image/png","image/jpeg","image/jpg"].includes(p.type);if(!de&&!z){alert(`Error: Unsupported image format.

The software only accepts PNG and JPEG image files.

File selected: ${p.name}
File type: ${p.type||"unknown"}

Please select a .png, .jpg, or .jpeg image file.`);return}let Pe;if(Pi)try{Pe=await Is(p,Pi)}catch(pe){const ge=pe instanceof Error?pe.message:"Unknown error occurred while copying image to project directory.";alert(`Error: ${ge}

The image could not be loaded. Please ensure you have a project open and have write permissions to the project directory.`);return}else{if(!confirm(`Warning: No project directory is currently open. The image will be loaded, but you must create or open a project and save it before the image will be stored in the project directory.

Do you want to continue loading the ${C==="top"?"top":"bottom"} image?`))return;Pe=p.name}const ve=await createImageBitmap(p),Re=URL.createObjectURL(p),je=ur.current;let _e=0,fe=0;je&&(_e=Di.x,fe=Di.y);const ye={url:Re,name:p.name,width:ve.width,height:ve.height,filePath:Pe,x:_e,y:fe,scale:1,rotation:0,flipX:!1,flipY:!1,skewX:0,skewY:0,keystoneV:0,keystoneH:0,bitmap:ve};C==="top"?n(ye):o(ye)}catch(D){const $=D instanceof Error?D.message:"Unknown error occurred while loading the image.";alert(`Error: Failed to load image file "${p.name}".

${$}

Please ensure the file is a valid image format (PNG, JPEG, etc.) and is not corrupted.`),console.error("Failed to load image",D)}},[Di,_t,Pi,Is]),Hp=U.useCallback(p=>{p.stopPropagation(),p.preventDefault();const C=ur.current;if(!C)return;document.activeElement!==C&&C.focus();const D=C.getBoundingClientRect(),$=C.width/D.width,de=C.height/D.height,be=p.nativeEvent.offsetX,z=p.nativeEvent.offsetY,Pe=typeof be=="number"?be:p.clientX-D.left,ve=typeof z=="number"?z:p.clientY-D.top,Re=Pe*$,je=ve*de,_e=Re-5,fe=je-5,ye=Jf(_e,fe,or,_t,Xn,ri),pe=ye.x,ge=ye.y;if(vd.current&&_==="select"){Vd(!0),Pc({start:{x:pe,y:ge},end:{x:pe,y:ge}});return}if(_==="center"){ms(!0),os.current&&clearTimeout(os.current),os.current=setTimeout(()=>{ms(!1),b("select"),ta(void 0)},2e3);return}if(_==="select"){if(as){let Ue=1/0,at=null,dt=null;const Rt=Math.max(6/_t,4),kn=[...Gt,...an].find(Yn=>Yn.id===as.componentId)?.layer||"top";for(const Yn of Qe)if((Yn.type==="via"||Yn.type==="pad")&&Yn.points.length>0){if(Yn.type==="pad"&&(Yn.layer||"top")!==kn)continue;const zn=Yn.points[0],Un=Math.max(1,Yn.size/2),ii=Math.hypot(zn.x-pe,zn.y-ge),nn=Math.max(Un,Rt);ii<=nn&&ii<Ue&&(Ue=ii,at=zn.id??null,dt=Yn)}if(dt?(console.log(`
[PIN CONNECTION] Found via!`),console.log(`  Stroke ID: ${dt.id}`),console.log(`  Point ID: ${at}`),console.log(`  Point coordinates: x=${dt.points[0].x.toFixed(2)}, y=${dt.points[0].y.toFixed(2)}`),console.log(`  Click coordinates: x=${pe.toFixed(2)}, y=${ge.toFixed(2)}`),console.log(`  Distance: ${Ue.toFixed(2)}`),console.log(`  Via size: ${dt.size}, radius: ${Math.max(1,dt.size/2)}`)):(console.log(`
[PIN CONNECTION] No via found!`),console.log(`  Click coordinates: x=${pe.toFixed(2)}, y=${ge.toFixed(2)}`),console.log(`  Hit tolerance: ${Rt.toFixed(2)}`),console.log(`  Total vias in drawingStrokes: ${Qe.filter(Yn=>Yn.type==="via").length}`)),at!=null){console.log(`
[PIN CONNECTION] Proceeding with connection...`),console.log(`  bestPointId is valid: ${at} (type: ${typeof at})`);const Yn=String(at),zn=as.pinIndex,Un=as.componentId;console.log(`
=== PIN CONNECTION START ===`),console.log(`Connecting pin ${zn} (Pin ${zn+1}) of component ${Un} to point ID ${Yn}`);const ii=Gt.find(It=>It.id===Un),nn=an.find(It=>It.id===Un);ii?(console.log("Component found in TOP layer"),Bi(It=>{const An=It.find(ei=>ei.id===Un);if(!An)return console.error(`Component ${Un} not found in TOP layer during update!`),It;console.log("BEFORE update: pinConnections =",An.pinConnections);const Oi=An.pinConnections||[],$r=Oi.length>0?[...Oi]:new Array(An.pinCount).fill("");let Dr;if($r.length!==An.pinCount){Dr=new Array(An.pinCount).fill("");for(let ei=0;ei<Math.min($r.length,An.pinCount);ei++)Dr[ei]=$r[ei]||""}else Dr=[...$r];Dr[zn]=Yn,console.log(`Updating pin ${zn} with value: ${Yn}`),console.log("New pinConnections array:",Dr);const zs=It.map(ei=>ei.id===Un?{...ei,pinConnections:Dr}:ei),us=zs.find(ei=>ei.id===Un);return console.log("AFTER update: pinConnections =",us?.pinConnections),console.log(`Pin ${zn} value: ${us?.pinConnections[zn]}`),console.log(`=== PIN CONNECTION COMPLETE (TOP) ===
`),zs})):nn?(console.log("Component found in BOTTOM layer"),Kn(It=>{const An=It.find(ei=>ei.id===Un);if(!An)return console.error(`Component ${Un} not found in BOTTOM layer during update!`),It;console.log("BEFORE update: pinConnections =",An.pinConnections);const Oi=An.pinConnections||[],$r=Oi.length>0?[...Oi]:new Array(An.pinCount).fill("");let Dr;if($r.length!==An.pinCount){Dr=new Array(An.pinCount).fill("");for(let ei=0;ei<Math.min($r.length,An.pinCount);ei++)Dr[ei]=$r[ei]||""}else Dr=[...$r];Dr[zn]=Yn,console.log(`Updating pin ${zn} with value: ${Yn}`),console.log("New pinConnections array:",Dr);const zs=It.map(ei=>ei.id===Un?{...ei,pinConnections:Dr}:ei),us=zs.find(ei=>ei.id===Un);return console.log("AFTER update: pinConnections =",us?.pinConnections),console.log(`Pin ${zn} value: ${us?.pinConnections[zn]}`),console.log(`=== PIN CONNECTION COMPLETE (BOTTOM) ===
`),zs})):(console.error(`Component ${Un} not found in either TOP or BOTTOM layer!`),console.log("Available TOP components:",Gt.map(It=>It.id)),console.log("Available BOTTOM components:",an.map(It=>It.id))),setTimeout(()=>{rl(null)},0);return}else rl(null)}const Me=10,De=(()=>{for(const Ue of Gt)if(pe>=Ue.x-Me&&pe<=Ue.x+Me&&ge>=Ue.y-Me&&ge<=Ue.y+Me)return{layer:"top",comp:Ue};for(const Ue of an)if(pe>=Ue.x-Me&&pe<=Ue.x+Me&&ge>=Ue.y-Me&&ge<=Ue.y+Me)return{layer:"bottom",comp:Ue};return null})();if(De){const{comp:Ue}=De;p.shiftKey?jn(at=>{const dt=new Set(at);return dt.has(Ue.id)?dt.delete(Ue.id):dt.add(Ue.id),dt}):(jn(new Set([Ue.id])),Pn(new Set),pn(new Set),xn(new Set));return}const $e=Math.max(6/_t,4);let ht=null;for(const Ue of S){const at=Math.max(6,Ue.size/2),dt=at*.8,Rt=at+dt,tn=Math.hypot(Ue.x-pe,Ue.y-ge),kn=Math.abs(pe-Ue.x)<=$e&&Math.abs(ge-Ue.y)<=Rt,Yn=Math.abs(ge-Ue.y)<=$e&&Math.abs(pe-Ue.x)<=Rt;if(tn<=Math.max(at,$e)||kn||Yn){ht=Ue;break}}if(ht){p.shiftKey?pn(Ue=>{const at=new Set(Ue);return at.has(ht.id)?at.delete(ht.id):at.add(ht.id),at}):(pn(new Set([ht.id])),Pn(new Set),jn(new Set),xn(new Set));return}let xt=null;for(const Ue of P){const at=Math.max(6,(Ue.size||18)/2),dt=at*.8,Rt=at+dt,tn=Math.hypot(Ue.x-pe,Ue.y-ge),kn=Math.abs(pe-Ue.x)<=$e&&Math.abs(ge-Ue.y)<=Rt,Yn=Math.abs(ge-Ue.y)<=$e&&Math.abs(pe-Ue.x)<=Rt;if(tn<=Math.max(at,$e)||kn||Yn){xt=Ue;break}}if(xt){p.shiftKey?xn(Ue=>{const at=new Set(Ue);return at.has(xt.id)?at.delete(xt.id):at.add(xt.id),at}):(xn(new Set([xt.id])),Pn(new Set),jn(new Set),pn(new Set));return}const Je=Math.max(6/_t,4/_t),We=Math.max(Je,.5);let Ye=null;for(const Ue of Qe)if((Ue.type==="via"||Ue.type==="pad"||Ue.type==="testPoint")&&Ue.points.length>0){let at=!1;if(Ue.type==="via"?at=Ar:Ue.type==="pad"?at=(Ue.layer||"top")==="top"?Ys:tr:Ue.type==="testPoint"&&(at=(Ue.layer||"top")==="top"?So:Uo),!at)continue;const dt=Ue.points[0],Rt=Math.max(1,Ue.size/2);if(Math.hypot(dt.x-pe,dt.y-ge)<=Math.max(Rt,We)){Ye=Ue;break}}if(Ye){p.shiftKey?Pn(Ue=>{const at=new Set(Ue);return at.has(Ye.id)?at.delete(Ye.id):at.add(Ye.id),at}):(Pn(new Set([Ye.id])),jn(new Set),pn(new Set),xn(new Set),ut(new Set));return}p.shiftKey||(Pn(new Set),jn(new Set),pn(new Set),xn(new Set),ut(new Set)),ga(!0),Rf({x:pe,y:ge,shiftKey:p.shiftKey}),ih({x:pe,y:ge,width:0,height:0});return}else if(_==="magnify"){const Me=p.shiftKey?.5:2,De=Math.max(.25,Math.min(8,_t*Me));$a(pe,ge),Fn(De);return}else if(_==="pan"){const Me={topImageX:t?.x??0,topImageY:t?.y??0,bottomImageX:r?.x??0,bottomImageY:r?.y??0,componentsTop:Object.fromEntries(Gt.map(De=>[De.id,{x:De.x,y:De.y}])),componentsBottom:Object.fromEntries(an.map(De=>[De.id,{x:De.x,y:De.y}])),powerSymbols:Object.fromEntries(Se.map(De=>[De.id,{x:De.x,y:De.y}])),groundSymbols:Object.fromEntries(Ve.map(De=>[De.id,{x:De.x,y:De.y}])),drawingStrokes:Qe.map(De=>({points:De.points.map($e=>({x:$e.x,y:$e.y}))})),vias:na.map(De=>({x:De.x,y:De.y})),pads:zt.map(De=>({x:De.x,y:De.y}))};Oo.current={startCX:_e,startCY:fe,panX:or.x,panY:or.y,objectStartPositions:Me},Jl.current={startClientX:p.clientX,startClientY:p.clientY,panX:or.x,panY:or.y,objectStartPositions:Me},kc(!0);return}else if(_==="draw"){const Me=(ht,xt)=>{let Tt=1/0,Je=null;const We=10/_t,Ye=_t>20?Math.max(We,1e-4):_t>10?Math.max(We,.001):Math.max(We,.01);for(const dt of Qe)if(dt.type==="via"){const Rt=dt.points[0],tn=Math.hypot(Rt.x-ht,Rt.y-xt);tn<=Ye&&tn<Tt&&(Tt=tn,Je=Rt)}else if(dt.type==="pad"){const Rt=dt.points[0],tn=Math.hypot(Rt.x-ht,Rt.y-xt);tn<=Ye&&tn<Tt&&(Tt=tn,Je=Rt)}for(const dt of S)if(dt.pointId!==void 0){const Rt=Math.hypot(dt.x-ht,dt.y-xt);Rt<=Ye&&Rt<Tt&&(Tt=Rt,Je={x:dt.x,y:dt.y,id:dt.pointId})}for(const dt of P)if(dt.pointId!==void 0){const Rt=Math.hypot(dt.x-ht,dt.y-xt);Rt<=Ye&&Rt<Tt&&(Tt=Rt,Je={x:dt.x,y:dt.y,id:dt.pointId})}const at=cr(Je??{x:ht,y:xt});return{x:at.x,y:at.y,nodeId:Je?.id}};if(ot==="via"){const ht=Bn.get("via"),xt=ht.color,Tt=ht.size,qt=uc?{x:cr({x:pe,y:ge}).x,y:cr({x:pe,y:ge}).y}:((dt,Rt)=>{let tn=1/0,kn=null;const zn=10/_t,Un=_t>10?Math.max(zn,.001):Math.max(zn,.01);for(const It of Qe)if(It.type==="via"||It.type==="pad"){const An=It.points[0],Oi=Math.hypot(An.x-dt,An.y-Rt);Oi<=Un&&Oi<tn&&(tn=Oi,kn=An)}for(const It of S)if(It.pointId!==void 0){const An=Math.hypot(It.x-dt,It.y-Rt);An<=Un&&An<tn&&(tn=An,kn={x:It.x,y:It.y,id:It.pointId})}for(const It of P)if(It.pointId!==void 0){const An=Math.hypot(It.x-dt,It.y-Rt);An<=Un&&An<tn&&(tn=An,kn={x:It.x,y:It.y,id:It.pointId})}const nn=cr(kn??{x:dt,y:Rt});return{x:nn.x,y:nn.y,nodeId:kn?.id}})(pe,ge),We=qt.nodeId??sd(),Ye=Vo(We,wn),Ue={id:We,x:qt.x,y:qt.y};Sn(Qe,Gt,an,Se,Ve);const at={id:`${Date.now()}-via`,points:[Ue],color:xt,size:Tt,layer:sn,type:"via",viaType:Ye};St(dt=>[...dt,at]),sn==="top"?Hs(dt=>[...dt,at.id]):Gl(dt=>[...dt,at.id]);return}if(ot==="pad"){if(!Ti)return;const xt=uc?{x:cr({x:pe,y:ge}).x,y:cr({x:pe,y:ge}).y}:((at,dt)=>{let Rt=1/0,tn=null;const Yn=10/_t,zn=_t>10?Math.max(Yn,.001):Math.max(Yn,.01);for(const nn of Qe)if(nn.type==="via"||nn.type==="pad"||nn.type==="testPoint"){const It=nn.points[0],An=Math.hypot(It.x-at,It.y-dt);An<=zn&&An<Rt&&(Rt=An,tn=It)}for(const nn of S)if(nn.pointId!==void 0){const It=Math.hypot(nn.x-at,nn.y-dt);It<=zn&&It<Rt&&(Rt=It,tn={x:nn.x,y:nn.y,id:nn.pointId})}for(const nn of P)if(nn.pointId!==void 0){const It=Math.hypot(nn.x-at,nn.y-dt);It<=zn&&It<Rt&&(Rt=It,tn={x:nn.x,y:nn.y,id:nn.pointId})}const ii=cr(tn??{x:at,y:dt});return{x:ii.x,y:ii.y,nodeId:tn?.id}})(pe,ge),Tt=xt.nodeId??sd(),Je=yl(Tt,wn),qt=B||(Ti==="top"?le:Ae),We=G||(Ti==="top"?E:Q),Ye={id:Tt,x:xt.x,y:xt.y};Sn(Qe,Gt,an,Se,Ve);const Ue={id:`${Date.now()}-pad`,points:[Ye],color:qt,size:We,layer:Ti,type:"pad",padType:Je};St(at=>[...at,Ue]);return}if(ot==="testPoint"){if(!On)return;const xt=uc?{x:cr({x:pe,y:ge}).x,y:cr({x:pe,y:ge}).y}:((dt,Rt)=>{let tn=1/0,kn=null;const Yn=15;for(const ii of Qe)if(ii.type==="via"||ii.type==="pad"||ii.type==="testPoint"){const nn=ii.points[0],It=Math.hypot(nn.x-dt,nn.y-Rt);It<=Yn&&It<tn&&(tn=It,kn=nn)}for(const ii of S)if(ii.pointId!==void 0){const nn=Math.hypot(ii.x-dt,ii.y-Rt);nn<=Yn&&nn<tn&&(tn=nn,kn={x:ii.x,y:ii.y,id:ii.pointId})}for(const ii of P)if(ii.pointId!==void 0){const nn=Math.hypot(ii.x-dt,ii.y-Rt);nn<=Yn&&nn<tn&&(tn=nn,kn={x:ii.x,y:ii.y,id:ii.pointId})}const Un=cr(kn??{x:dt,y:Rt});return{x:Un.x,y:Un.y,nodeId:kn?.id}})(pe,ge),Tt=xt.nodeId??sd(),Je=Ca(Tt,wn),qt=Je.includes("Power")?"power":Je.includes("Ground")?"ground":Je.includes("Signal")?"signal":"unknown",We=cr({x:xt.x,y:xt.y}),Ye=B||(On==="top"?oe:re),Ue=G||(On==="top"?Ee:Ze);Sn(Qe,Gt,an,Se,Ve);const at={id:`${Date.now()}-testPoint`,points:[{id:Tt,x:We.x,y:We.y}],color:Ye,size:Ue,layer:On,type:"testPoint",testPointType:qt};St(dt=>[...dt,at]);return}if(_n.current)return;const De=ot==="trace"&&!uc?Me(pe,ge):{x:cr({x:pe,y:ge}).x,y:cr({x:pe,y:ge}).y},$e=De.nodeId!==void 0?{id:De.nodeId,x:De.x,y:De.y}:{x:De.x,y:De.y};Kt(ht=>ht.length===0?[$e]:[...ht,$e]),yn.current=Date.now(),un(null),Bt(!1),Na(!1)}else if(_==="erase"){if(Qe.some(De=>De.layer===sn&&(De.type==="via"&&Ui||De.type==="pad"&&hr||De.type==="testPoint"&&Ps||De.type==="trace"&&ws))){const De=[];Ui&&Qe.some($e=>$e.layer===sn&&$e.type==="via")&&De.push("vias"),hr&&Qe.some($e=>$e.layer===sn&&$e.type==="pad")&&De.push("pads"),Ps&&Qe.some($e=>$e.layer===sn&&$e.type==="testPoint")&&De.push("test points"),ws&&Qe.some($e=>$e.layer===sn&&$e.type==="trace")&&De.push("traces"),De.length>0&&alert(`Cannot erase: ${De.join(", ")} are locked on the ${sn} layer. Unlock them to erase.`)}Bt(!0),Kt([{id:sd(),x:pe,y:ge}]),console.log("Starting erase at:",pe,ge,"selectedDrawingLayer:",sn,"total strokes:",Qe.length)}else if(_==="transform"&&Ut){if(Fi){alert("Cannot transform: Images are locked. Unlock images to transform them.");return}Lt(!0),Et({x:pe,y:ge})}else if(_==="component"){if(!th.current)return;const Me=cr({x:pe,y:ge}),$e=(Ga.current||"top")==="top"?"componentTop":"componentBottom",ht=Bn.get($e),xt=ht.color,Tt=ht.size,Je=[...Gt,...an];let qt;if(lr?qt=Qf():qt={...gr.current},!Ga.current)return;const We=Ef.current?.dataDrivenDefinition;if(!We){console.error("[Component Creation] Missing dataDrivenDefinition metadata for selected component.");return}let Ye;try{Ye=y5({definition:We,layer:Ga.current,x:Me.x,y:Me.y,color:xt,size:Tt,existingComponents:Je,counters:en?qt:{}})}catch(Ue){console.error("[Component Creation] Error creating component with v2 runtime:",Ue);return}if(Ye.abbreviation=Em(th.current),en&&Ye.designator){const Ue=Ye.designator.match(/^([A-Za-z]+)(\d+)$/);if(Ue){const at=Ue[1],dt=parseInt(Ue[2],10);if(lr){const Rt=Qf();lx(at,dt,Rt)}else gr.current[at]=Math.max(gr.current[at]||0,dt)}}Sn(Qe,Gt,an,Se,Ve),Ga.current==="top"?(sa(!0),Bi(Ue=>[...Ue,Ye])):(Aa(!0),Kn(Ue=>[...Ue,Ye]));return}else if(_==="power"){if(!ct)return;const De=uc?{x:cr({x:pe,y:ge}).x,y:cr({x:pe,y:ge}).y}:((ht,xt)=>{let Tt=1/0,Je=null;const We=10/_t,Ye=_t>20?Math.max(We,1e-4):_t>10?Math.max(We,.001):Math.max(We,.01);for(const dt of Qe)if(dt.type==="via"||dt.type==="pad"){const Rt=dt.points[0],tn=Math.hypot(Rt.x-ht,Rt.y-xt);tn<=Ye&&tn<Tt&&(Tt=tn,Je=Rt)}else if(dt.type==="trace")for(const Rt of dt.points){const tn=Math.hypot(Rt.x-ht,Rt.y-xt);tn<=Ye&&tn<Tt&&(Tt=tn,Je=Rt)}const at=cr(Je??{x:ht,y:xt});return{x:at.x,y:at.y,nodeId:Je?.id}})(pe,ge),$e=wn.find(ht=>ht.id===ct);if($e){const ht=De.nodeId??sd(),xt=`${$e.voltage} Power Node`;if(P.find(qt=>qt.pointId===ht)){mo({visible:!0,title:"Node ID Conflict",message:`Cannot place power node: A ground node already exists at this Node ID (${ht}). Power and ground nodes cannot share the same Node ID.`});return}Sn(Qe,Gt,an,Se,Ve);const Je={id:`power-${Date.now()}-${Math.random()}`,x:De.x,y:De.y,color:"#ff0000",size:G,powerBusId:$e.id,layer:sn,type:xt,pointId:ht};if(Ie(qt=>[...qt,Je]),De.nodeId!==void 0){const qt=Vo(De.nodeId,wn),We=yl(De.nodeId,wn),Ye=Ca(De.nodeId,wn),Ue=Ye.includes("Power")?"power":Ye.includes("Ground")?"ground":Ye.includes("Signal")?"signal":"unknown";St(at=>at.map(dt=>dt.type==="via"&&dt.points.length>0&&dt.points[0].id===De.nodeId?{...dt,viaType:qt}:dt.type==="pad"&&dt.points.length>0&&dt.points[0].id===De.nodeId?{...dt,padType:We}:dt.type==="testPoint"&&dt.points.length>0&&dt.points[0].id===De.nodeId?{...dt,testPointType:Ue}:dt))}}return}else if(_==="ground"){if(Ei===null){if(j.length===0){mo({visible:!0,title:"No Ground Bus",message:"No ground buses are defined. Please create a ground bus first using Tools  Manage Ground Buses."});return}In(!0);return}const Me=j.find(De=>De.id===Ei);if(Me){const $e=uc?{x:cr({x:pe,y:ge}).x,y:cr({x:pe,y:ge}).y}:((qt,We)=>{let Ye=1/0,Ue=null;const dt=10/_t,Rt=_t>20?Math.max(dt,1e-4):_t>10?Math.max(dt,.001):Math.max(dt,.01);for(const Yn of Qe)if(Yn.type==="via"||Yn.type==="pad"){const zn=Yn.points[0],Un=Math.hypot(zn.x-qt,zn.y-We);Un<=Rt&&Un<Ye&&(Ye=Un,Ue=zn)}else if(Yn.type==="trace")for(const zn of Yn.points){const Un=Math.hypot(zn.x-qt,zn.y-We);Un<=Rt&&Un<Ye&&(Ye=Un,Ue=zn)}const kn=cr(Ue??{x:qt,y:We});return{x:kn.x,y:kn.y,nodeId:Ue?.id}})(pe,ge),ht=$e.nodeId??sd(),xt=`${Me.name} Ground Node`,Tt=S.find(qt=>qt.pointId===ht);if(Tt){mo({visible:!0,title:"Node ID Conflict",message:`Cannot place ground node: A power node (${Tt.type||"Power Node"}) already exists at this Node ID (${ht}). Power and ground nodes cannot share the same Node ID.`});return}Sn(Qe,Gt,an,Se,Ve);const Je={id:`gnd-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,x:$e.x,y:$e.y,color:Me.color,size:G||$n.get("ground")?.settings.size||18,groundBusId:Me.id,layer:sn,type:xt,pointId:ht};if(lt(qt=>[...qt,Je]),$e.nodeId!==void 0){const qt=Vo($e.nodeId,wn),We=yl($e.nodeId,wn);St(Ye=>Ye.map(Ue=>Ue.type==="via"&&Ue.points.length>0&&Ue.points[0].id===$e.nodeId?{...Ue,viaType:qt}:Ue.type==="pad"&&Ue.points.length>0&&Ue.points[0].id===$e.nodeId?{...Ue,padType:We}:Ue))}}return}},[_,Ut,G,B,ot,sn,Qe,_t,or.x,or.y,Xn,ri,uc,ct,Ei,wn,j,dc,$n,Ti,Qn,On,S,P,Vo,yl,Ca,Ar,Ys,tr]),Vp=U.useCallback(p=>{if(_!=="magnify")return;p.preventDefault();const C=ur.current;if(!C)return;const D=C.getBoundingClientRect(),$=C.width/D.width,de=C.height/D.height,be=p.nativeEvent.offsetX,z=p.nativeEvent.offsetY,Pe=typeof be=="number"?be:p.clientX-D.left,ve=typeof z=="number"?z:p.clientY-D.top,Re=Pe*$,je=ve*de,_e=Re-5,fe=je-5,ye=Jf(_e,fe,or,_t,Xn,ri),pe=ye.x,ge=ye.y,Me=1.2,De=1/Me,$e=p.deltaY<0?Me:De,ht=Math.max(.25,Math.min(8,_t*$e));$a(pe,ge),Fn(ht)},[_,_t,or.x,or.y,Xn,ri]),qp=U.useCallback(p=>{if(_==="draw"&&ot==="trace"){_n.current=!0;let $e=Ln;if($e.length>1){const ht=[$e[0]];for(let xt=1;xt<$e.length;xt++){const Tt=ht[ht.length-1],Je=$e[xt];(Math.abs(Tt.x-Je.x)>.001||Math.abs(Tt.y-Je.y)>.001)&&ht.push(Je)}$e=ht}if($e.length>=1){Sn(Qe,Gt,an,Se,Ve);const ht=Qn||"top",xt=ht==="top"?"traceTop":"traceBottom",Tt=Bn.get(xt),Je={id:`${Date.now()}-trace`,points:$e,color:Tt.color,size:Tt.size,layer:ht,type:"trace"};St(qt=>[...qt,Je]),ht==="top"?pa(qt=>[...qt,Je.id]):vs(qt=>[...qt,Je.id]),Kt([]),un(null),setTimeout(()=>{_n.current=!1},300);return}}const C=ur.current;if(!C)return;const D=C.getBoundingClientRect(),$=C.width/D.width,de=C.height/D.height,be=p.nativeEvent.offsetX,z=p.nativeEvent.offsetY,Pe=typeof be=="number"?be:p.clientX-D.left,ve=typeof z=="number"?z:p.clientY-D.top,Re=Pe*$,je=ve*de,_e=Re-5,fe=je-5,ye=Jf(_e,fe,or,_t,Xn,ri),pe=ye.x,ge=ye.y,Me=Math.max(8/_t,4),De=(()=>{for(const $e of Qe)if($e.type==="testPoint"&&$e.points.length>0){const ht=$e.points[0],xt=Math.hypot(ht.x-pe,ht.y-ge),Tt=($e.size||18)/2;if(xt<=Tt+Me)return $e}return null})();if(De){Pn(new Set([De.id])),jn(new Set),pn(new Set),xn(new Set),Ii(!0);return}if(_==="select"||_==="component"){const ht=(()=>{for(const Je of Gt)if(pe>=Je.x-10&&pe<=Je.x+10&&ge>=Je.y-10&&ge<=Je.y+10)return{layer:"top",comp:Je};for(const Je of an)if(pe>=Je.x-10&&pe<=Je.x+10&&ge>=Je.y-10&&ge<=Je.y+10)return{layer:"bottom",comp:Je};return null})(),xt=Math.max(6/_t,4);let Tt=null;for(const Je of S){const qt=Math.max(6,Je.size/2),We=qt*.8,Ye=qt+We,Ue=Math.hypot(Je.x-pe,Je.y-ge),at=Math.abs(pe-Je.x)<=xt&&Math.abs(ge-Je.y)<=Ye,dt=Math.abs(ge-Je.y)<=xt&&Math.abs(pe-Je.x)<=Ye;if(Ue<=Math.max(qt,xt)||at||dt){Tt=Je;break}}if(Tt){pn(new Set([Tt.id])),ln({visible:!0,id:Tt.id,layer:Tt.layer,x:Tt.x,y:Tt.y,size:Tt.size,color:Tt.color,powerBusId:Tt.powerBusId});return}if(ht){const{layer:Je,comp:qt}=ht;Eo(qt,Je)}}},[_,ot,B,G,sn,Gt,an,S,_t,or.x,or.y,Xn,ri,dc,uc,Qe,Ut,fl,Op,as,$n,Ln,Qn,O,W,J,Ce,Ii,Pn,jn,pn,xn,Eo]),rh=U.useCallback(()=>{const p=Jt.current;if(_==="draw"&&ot==="trace"&&p.length>=2){let C=[p[0]];for(let z=1;z<p.length;z++){const Pe=C[C.length-1],ve=p[z];(Math.abs(Pe.x-ve.x)>.001||Math.abs(Pe.y-ve.y)>.001)&&C.push(ve)}const D=Qn||"top",$=D==="top"?"traceTop":"traceBottom",de=Bn.get($),be={id:`${Date.now()}-trace`,points:C,color:de.color,size:de.size,layer:D,type:"trace"};Sn(Qe,Gt,an,Se,Ve),St(z=>[...z,be]),D==="top"?pa(z=>[...z,be.id]):vs(z=>[...z,be.id]),Kt([]),un(null)}else if(_==="draw"&&ot==="trace"&&p.length===1){const C=Qn||"top",D=C==="top"?"traceTop":"traceBottom",$=Bn.get(D),de={id:`${Date.now()}-trace-dot`,points:p,color:$.color,size:$.size,layer:C,type:"trace"};St(be=>[...be,de]),C==="top"?pa(be=>[...be,de.id]):vs(be=>[...be,de.id]),Kt([])}},[_,ot,Qn,O,W,J,Ce,St]),Cu=U.useCallback((p,C,D)=>{const $=C-p.x,de=D-p.y;if($===0&&de===0)return{x:C,y:D};const z=(l5($,de)%180+180)%180,Pe=[0,45,90];let ve=0,Re=1e9;for(const je of Pe){const _e=Math.abs(z-je);_e<Re&&(Re=_e,ve=je)}if(ve===0)return{x:C,y:p.y};if(ve===90)return{x:p.x,y:D};{const je=Math.min(Math.abs($),Math.abs(de)),_e=$>=0?1:-1,fe=de>=0?1:-1;return{x:p.x+_e*je,y:p.y+fe*je}}},[]),Wp=U.useCallback(p=>{const C=ur.current?.getBoundingClientRect();if(!C)return;const D=p.clientX-C.left,$=p.clientY-C.top,de=ur.current,be=de.width/C.width,z=de.height/C.height,Pe=D*be,ve=$*z,Re=Pe-5,je=ve-5,_e=Jf(Re,je,or,_t,Xn,ri),fe=_e.x,ye=_e.y;if(Bo({x:fe,y:ye}),qd.current&&Ec.current&&Pc({start:Ec.current.start,end:{x:fe,y:ye}}),_==="draw"&&ot==="trace"&&Ln.length>0){const ge=uc?{x:cr({x:fe,y:ye}).x,y:cr({x:fe,y:ye}).y}:((Me,De)=>{let $e=1/0,ht=null;const Tt=10/_t,Je=_t>20?Math.max(Tt,1e-4):_t>10?Math.max(Tt,.001):Math.max(Tt,.01);for(const Ye of Qe)if(Ye.type==="via"){const Ue=Ye.points[0],at=Math.hypot(Ue.x-Me,Ue.y-De);at<=Je&&at<$e&&($e=at,ht=Ue)}else if(Ye.type==="pad"){const Ue=Ye.points[0],at=Math.hypot(Ue.x-Me,Ue.y-De);at<=Je&&at<$e&&($e=at,ht=Ue)}for(const Ye of S)if(Ye.pointId!==void 0){const Ue=Math.hypot(Ye.x-Me,Ye.y-De);Ue<=Je&&Ue<$e&&($e=Ue,ht={x:Ye.x,y:Ye.y,id:Ye.pointId})}for(const Ye of P)if(Ye.pointId!==void 0){const Ue=Math.hypot(Ye.x-Me,Ye.y-De);Ue<=Je&&Ue<$e&&($e=Ue,ht={x:Ye.x,y:Ye.y,id:Ye.pointId})}const We=cr(ht??{x:Me,y:De});return{x:We.x,y:We.y,nodeId:ht?.id}})(fe,ye);un({x:ge.x,y:ge.y})}else un(null);if(Oa){const ge=(()=>{for(const Me of Gt)if(fe>=Me.x-10&&fe<=Me.x+10&&ye>=Me.y-10&&ye<=Me.y+10)return{layer:"top",comp:Me};for(const Me of an)if(fe>=Me.x-10&&fe<=Me.x+10&&ye>=Me.y-10&&ye<=Me.y+10)return{layer:"bottom",comp:Me};return null})();if(ge)_c({component:ge.comp,layer:ge.layer,x:p.clientX,y:p.clientY}),ec(null);else{_c(null);const Me=Math.max(8/_t,4),De=(()=>{for(const $e of Qe)if($e.type==="testPoint"&&$e.points.length>0){const ht=$e.points[0],xt=Math.hypot(ht.x-fe,ht.y-ye),Tt=($e.size||18)/2;if(xt<=Tt+Me)return $e}return null})();ec(De?{stroke:De,x:p.clientX,y:p.clientY}:null)}}else _c(null),ec(null);if(_==="select"&&Gc&&Jd){const pe=Jd.x,ge=Jd.y;ih({x:Math.min(pe,fe),y:Math.min(ge,ye),width:Math.abs(fe-pe),height:Math.abs(ye-ge)})}else if(_==="pan"&&fl&&Oo.current){const{startCX:pe,startCY:ge,objectStartPositions:Me}=Oo.current,De=Re-pe,$e=je-ge,ht=sx(De,$e,_t,Xn,ri),xt=ht.x,Tt=ht.y;Me&&(t&&n({...t,x:Me.topImageX+xt,y:Me.topImageY+Tt}),r&&o({...r,x:Me.bottomImageX+xt,y:Me.bottomImageY+Tt}),Bi(Gt.map(Je=>({...Je,x:(Me.componentsTop?.[Je.id]?.x??Je.x)+xt,y:(Me.componentsTop?.[Je.id]?.y??Je.y)+Tt}))),Kn(an.map(Je=>({...Je,x:(Me.componentsBottom?.[Je.id]?.x??Je.x)+xt,y:(Me.componentsBottom?.[Je.id]?.y??Je.y)+Tt}))),Ie(Se.map(Je=>({...Je,x:(Me.powerSymbols?.[Je.id]?.x??Je.x)+xt,y:(Me.powerSymbols?.[Je.id]?.y??Je.y)+Tt}))),lt(Ve.map(Je=>({...Je,x:(Me.groundSymbols?.[Je.id]?.x??Je.x)+xt,y:(Me.groundSymbols?.[Je.id]?.y??Je.y)+Tt}))),St(Qe.map((Je,qt)=>({...Je,points:Je.points.map((We,Ye)=>{const Ue=Me.drawingStrokes?.[qt]?.points?.[Ye];return{...We,x:(Ue?.x??We.x)+xt,y:(Ue?.y??We.y)+Tt}})}))),Ya(na.map((Je,qt)=>{const We=Me.vias?.[qt];return{...Je,x:(We?.x??Je.x)+xt,y:(We?.y??Je.y)+Tt}})),$i(zt.map((Je,qt)=>{const We=Me.pads?.[qt];return{...Je,x:(We?.x??Je.x)+xt,y:(We?.y??Je.y)+Tt}})))}else if(Wt&&Ln.length>0){if(_==="draw")if(ha){const pe=Ln[0],ge=Cu(pe,fe,ye),Me=cr(ge),De={id:sd(),x:Me.x,y:Me.y};Kt([pe,De])}else{const pe=cr({x:fe,y:ye});Kt(ge=>[...ge,{id:sd(),x:pe.x,y:pe.y}])}else if(_==="erase"&&(Kt(pe=>[...pe,{id:sd(),x:fe,y:ye}]),St(pe=>{const ge=pe.filter(De=>{if(De.type==="via"&&Ui||De.type==="pad"&&hr||De.type==="testPoint"&&Ps||De.type==="trace"&&ws||De.layer!==sn)return!0;const $e=G/2,ht=fe-$e,xt=fe+$e,Tt=ye-$e,Je=ye+$e,qt=(Ue,at)=>Ue>=ht&&Ue<=xt&&at>=Tt&&at<=Je,We=(Ue,at,dt,Rt)=>{const ii=(zs,us)=>{let ei=0;return zs<ht?ei|=1:zs>xt&&(ei|=2),us<Tt?ei|=4:us>Je&&(ei|=8),ei};let nn=Ue,It=at,An=dt,Oi=Rt,$r=ii(nn,It),Dr=ii(An,Oi);for(;;){if(($r|Dr)===0)return!0;if(($r&Dr)!==0)return!1;const zs=$r!==0?$r:Dr;let us=0,ei=0;zs&8?(us=nn+(An-nn)*(Je-It)/(Oi-It),ei=Je):zs&4?(us=nn+(An-nn)*(Tt-It)/(Oi-It),ei=Tt):zs&2?(ei=It+(Oi-It)*(xt-nn)/(An-nn),us=xt):(ei=It+(Oi-It)*(ht-nn)/(An-nn),us=ht),zs===$r?(nn=us,It=ei,$r=ii(nn,It)):(An=us,Oi=ei,Dr=ii(An,Oi))}};let Ye=!1;if(De.points.length===1){const Ue=De.points[0];Ye=qt(Ue.x,Ue.y)}else for(let Ue=0;Ue<De.points.length-1;Ue++){const at=De.points[Ue],dt=De.points[Ue+1];if(We(at.x,at.y,dt.x,dt.y)){Ye=!0;break}}return Ye&&console.log("Erasing stroke at position:",fe,ye,"brushSize:",G,"selectedLayer:",sn),!Ye});console.log("Strokes before:",pe.length,"after:",ge.length);const Me=new Set(ge.map(De=>De.id));return Hs(De=>De.filter($e=>Me.has($e))),Gl(De=>De.filter($e=>Me.has($e))),pa(De=>De.filter($e=>Me.has($e))),vs(De=>De.filter($e=>Me.has($e))),ge}),fi||Ie(pe=>{const ge=G/2,Me=fe-ge,De=fe+ge,$e=ye-ge,ht=ye+ge,xt=Tt=>{const Je=Tt.size/2,qt=Tt.x-Je,We=Tt.x+Je,Ye=Tt.y-Je,Ue=Tt.y+Je;return!(De<qt||Me>We||ht<Ye||$e>Ue)};return pe.filter(Tt=>!xt(Tt))}),Ss||lt(pe=>{const ge=G/2,Me=fe-ge,De=fe+ge,$e=ye-ge,ht=ye+ge,xt=Je=>{const qt=Math.max(6,(Je.size||18)/2),We=qt*.8,Ye=qt+We,Ue=Je.x-Ye,at=Je.x+Ye,dt=Je.y-Ye,Rt=Je.y+Ye;return!(De<Ue||Me>at||ht<dt||$e>Rt)};return pe.filter(Je=>!xt(Je))}),!Or)){const pe=G/2,ge=fe-pe,Me=fe+pe,De=ye-pe,$e=ye+pe,ht=xt=>{const Je=(xt.size||18)/2,qt=xt.x-Je,We=xt.x+Je,Ye=xt.y-Je,Ue=xt.y+Je;return!(Me<qt||ge>We||$e<Ye||De>Ue)};Sn(Qe,Gt,an,Se,Ve),Bi(xt=>xt.filter(Tt=>!ht(Tt))),Kn(xt=>xt.filter(Tt=>!ht(Tt)))}}else if(Jn&&Ht&&Ut){if(Fi){Lt(!1),Et(null);return}const pe=fe-Ht.x,ge=ye-Ht.y;if(Ut==="top"){t&&n(Me=>Me?{...Me,x:Me.x+pe,y:Me.y+ge}:null),Et({x:fe,y:ye});return}if(Ut==="bottom"){r&&o(Me=>Me?{...Me,x:Me.x+pe,y:Me.y+ge}:null),Et({x:fe,y:ye});return}if(Ut==="both"){t&&n(Me=>Me?{...Me,x:Me.x+pe,y:Me.y+ge}:null),r&&o(Me=>Me?{...Me,x:Me.x+pe,y:Me.y+ge}:null),Et({x:fe,y:ye});return}}},[Wt,Ln,_,G,Jn,Ht,Ut,t,r,ha,Cu,sn,St,_t,or.x,or.y,Xn,ri,Gc,Jd,Fi,Ui,hr,ws,fi,Ss,Gt,an,Bi,Kn,Oa,_c,uc,Qe,S,P,Ln,ot,rn,un,fl,Oo,Po,5,or,sd,cr,b,ms,Sn,Se,Ve,Bo]),sh=U.useCallback(()=>{if(Bo(null),vd.current&&Ec.current&&Ho.current&&qd.current){const p=Ec.current,C=Ho.current,D=Math.abs(p.end.x-p.start.x),$=Math.abs(p.end.y-p.start.y);if(D>=1&&$>=1)try{const de=KT({numPins:C.numPins,type:C.type,twoSidedOrientation:C.twoSidedOrientation,point1:p.start,point2:p.end}),be=new Set(Qe.flatMap(ve=>ve.points.map(Re=>Re.id||0).filter(Re=>Re>0))),z=be.size>0?Math.max(...Array.from(be))+1:1,Pe=de.map((ve,Re)=>{const je=Kc.current?(Ti||"top")==="top"?"padTop":"padBottom":"via",_e=Bn.get(je),fe=z+Re,ye=Kc.current&&Ti||"top";return{id:fe.toString(),type:Kc.current?"pad":"via",points:[{x:ve.x,y:ve.y,id:fe}],size:_e.size,color:_e.color,layer:ye}});St(ve=>{const Re=[...ve,...Pe];return Sn(Re,Gt,an,Se,Ve),Re})}catch(de){console.error("IC Placement error:",de),alert(`Error placing ${Kc.current?"pads":"vias"}: ${de instanceof Error?de.message:String(de)}`)}ml(!1),Pc(null),Xc(null),Vd(!1),vd.current=!1,Ec.current=null,Ho.current=null,qd.current=!1,ta(void 0),b("select");return}if(_==="select"&&Gc){const p=Ad,C=Jd;if(ga(!1),Rf(null),ih(null),p&&C){const de=Math.max(3,5/_t),be=p.width<de&&p.height<de,z=(We,Ye)=>{const Ue=p.x,at=p.y,dt=p.x+p.width,Rt=p.y+p.height;return We>=Ue&&We<=dt&&Ye>=at&&Ye<=Rt},Pe=(We,Ye,Ue,at,dt,Rt,tn,kn)=>{const It=(ei,xs)=>{let bl=0;return ei<dt?bl|=1:ei>tn&&(bl|=2),xs<Rt?bl|=4:xs>kn&&(bl|=8),bl};let An=We,Oi=Ye,$r=Ue,Dr=at,zs=It(An,Oi),us=It($r,Dr);for(;;){if((zs|us)===0)return!0;if((zs&us)!==0)return!1;const ei=zs!==0?zs:us;let xs=0,bl=0;ei&8?(xs=An+($r-An)*(kn-Oi)/(Dr-Oi),bl=kn):ei&4?(xs=An+($r-An)*(Rt-Oi)/(Dr-Oi),bl=Rt):ei&2?(bl=Oi+(Dr-Oi)*(tn-An)/($r-An),xs=tn):(bl=Oi+(Dr-Oi)*(dt-An)/($r-An),xs=dt),ei===zs?(An=xs,Oi=bl,zs=It(An,Oi)):($r=xs,Dr=bl,us=It($r,Dr))}},ve=p.x,Re=p.y,je=p.x+p.width,_e=p.y+p.height,ye=Math.max(6/_t,4/_t,.5),pe=(We,Ye,Ue,at,dt,Rt)=>{const tn=dt-Ue,kn=Rt-at;if(tn===0&&kn===0)return Math.hypot(We-Ue,Ye-at);const Yn=Math.max(0,Math.min(1,((We-Ue)*tn+(Ye-at)*kn)/(tn*tn+kn*kn))),zn=Ue+Yn*tn,Un=at+Yn*kn;return Math.hypot(We-zn,Ye-Un)},ge=C?.shiftKey===!0,Me=new Set(ge?Array.from(li):[]),De=new Set(ge?Array.from(gn):[]),$e=new Set(ge?Array.from(ui):[]),ht=new Set(ge?Array.from(hi):[]),xt=C?.hitStrokeId;if(xt){const We=Qe.find(Ye=>Ye.id===xt);if(We){let Ye=!1;if(We.type==="via"||We.type==="pad"?Ye=Ar:Ye=We.layer==="top"?Cr:cs,Ye){ge?Pn(Ue=>{const at=new Set(Ue);return at.has(xt)?at.delete(xt):at.add(xt),at}):(Pn(new Set([xt])),jn(new Set),pn(new Set),xn(new Set));return}}}if(be){let We=null;for(const Ye of Qe){let Ue=!1;if(Ye.type==="via"?Ue=Ar:Ye.type==="pad"?Ue=(Ye.layer||"top")==="top"?Ys:tr:Ye.type==="testPoint"?Ue=(Ye.layer||"top")==="top"?So:Uo:Ye.type==="trace"?Ue=Ye.layer==="top"?Cr:cs:Ue=!1,!Ue)continue;let at=1/0;if(Ye.type==="via"||Ye.type==="pad"||Ye.type==="testPoint"){const dt=Ye.points[0],Rt=Math.max(1,Ye.size/2);at=Math.hypot(dt.x-C.x,dt.y-C.y);const kn=Math.max(6/_t,4/_t,.5);at<=Math.max(Rt,kn)&&(!We||at<We.dist)&&(We={id:Ye.id,dist:at})}else for(let dt=0;dt<Ye.points.length-1;dt++){const Rt=Ye.points[dt],tn=Ye.points[dt+1],kn=pe(C.x,C.y,Rt.x,Rt.y,tn.x,tn.y);if(kn<=Math.max(ye,Ye.size/2)){(!We||kn<We.dist)&&(We={id:Ye.id,dist:kn});break}}}We&&(ge&&Me.has(We.id)?Me.delete(We.id):Me.add(We.id))}else for(const We of Qe){let Ye=!1;if(We.type==="via"?Ye=Ar:We.type==="pad"?Ye=(We.layer||"top")==="top"?Ys:tr:We.type==="testPoint"?Ye=(We.layer||"top")==="top"?So:Uo:We.type==="trace"?Ye=We.layer==="top"?Cr:cs:Ye=!1,!Ye)continue;let Ue=!1;if(We.type==="via"||We.type==="pad"||We.type==="testPoint"){const at=We.points[0];Ue=z(at.x,at.y)}else for(let at=0;at<We.points.length-1;at++){const dt=We.points[at],Rt=We.points[at+1];if(Pe(dt.x,dt.y,Rt.x,Rt.y,ve,Re,je,_e)||z(dt.x,dt.y)&&z(Rt.x,Rt.y)){Ue=!0;break}}Ue&&(ge&&Me.has(We.id)?Me.delete(We.id):Me.add(We.id))}const Tt=We=>{const Ue=Math.max(10,We.size||18)/2;return We.x-Ue<=je&&We.x+Ue>=ve&&We.y-Ue<=_e&&We.y+Ue>=Re};if(be){const We=Ye=>{const at=Math.max(10,Ye.size||18)/2;return C.x>=Ye.x-at&&C.x<=Ye.x+at&&C.y>=Ye.y-at&&C.y<=Ye.y+at};Vi&&Gt.forEach(Ye=>{We(Ye)&&(ge&&De.has(Ye.id)?De.delete(Ye.id):De.add(Ye.id))}),Ks&&an.forEach(Ye=>{We(Ye)&&(ge&&De.has(Ye.id)?De.delete(Ye.id):De.add(Ye.id))})}else Vi&&Gt.forEach(We=>{Tt(We)&&(ge&&De.has(We.id)?De.delete(We.id):De.add(We.id))}),Ks&&an.forEach(We=>{Tt(We)&&(ge&&De.has(We.id)?De.delete(We.id):De.add(We.id))});const Je=We=>{const Ye=Math.max(6,We.size/2),Ue=Ye*.8,at=Ye+Ue;return We.x-at<=je&&We.x+at>=ve&&We.y-at<=_e&&We.y+at>=Re};if(Ha)if(be){let We=null;for(const Ye of S){const Ue=Math.max(6,Ye.size/2),at=Ue*.8,dt=Ue+at,Rt=Math.hypot(Ye.x-C.x,Ye.y-C.y),tn=Math.abs(C.x-Ye.x)<=ye&&Math.abs(C.y-Ye.y)<=dt,kn=Math.abs(C.y-Ye.y)<=ye&&Math.abs(C.x-Ye.x)<=dt;if(Rt<=Math.max(Ue,ye)||tn||kn){const zn=Math.min(Rt,Math.abs(C.x-Ye.x)+Math.abs(C.y-Ye.y));(!We||zn<We.dist)&&(We={id:Ye.id,dist:zn})}}We&&(ge&&$e.has(We.id)?$e.delete(We.id):$e.add(We.id))}else S.forEach(We=>{Je(We)&&(ge&&$e.has(We.id)?$e.delete(We.id):$e.add(We.id))});const qt=We=>{const Ye=Math.max(6,(We.size||18)/2),Ue=Ye*.8,at=Ye+Ue;return We.x-at<=je&&We.x+at>=ve&&We.y-at<=_e&&We.y+at>=Re};if(mr)if(be){let We=null;for(const Ye of P){const Ue=Math.max(6,(Ye.size||18)/2),at=Ue*.8,dt=Ue+at,Rt=Math.hypot(Ye.x-C.x,Ye.y-C.y),tn=Math.abs(C.x-Ye.x)<=ye&&Math.abs(C.y-Ye.y)<=dt,kn=Math.abs(C.y-Ye.y)<=ye&&Math.abs(C.x-Ye.x)<=dt;if(Rt<=Math.max(Ue,ye)||tn||kn){const zn=Math.min(Rt,Math.abs(C.x-Ye.x)+Math.abs(C.y-Ye.y));(!We||zn<We.dist)&&(We={id:Ye.id,dist:zn})}}We&&(ge&&ht.has(We.id)?ht.delete(We.id):ht.add(We.id))}else P.forEach(We=>{qt(We)&&(ge&&ht.has(We.id)?ht.delete(We.id):ht.add(We.id))});Pn(Me),jn(De),pn($e),xn(ht)}}if(Wt&&Ln.length>0){if(_==="draw"&&ot!=="trace"){const p={id:Date.now().toString(),points:Ln,color:B,size:G,layer:sn,type:"trace"};St(C=>[...C,p]),sn==="top"?pa(C=>[...C,p.id]):vs(C=>[...C,p.id])}Kt([])}fl&&(kc(!1),Oo.current=null,Jl.current=null),Bt(!1),Lt(!1),Et(null),Na(!1)},[Wt,Ln,_,B,G,sn,Ad,Jd,Gc,Qe,_t,Fa,li,S,P,Gt,an,gn,ui,hi,Ar,Cr,cs,Vi,Ks,Ha,mr,Bo]);Dt.useEffect(()=>{if(!(_==="pan"&&fl&&Jl.current))return;const p=D=>{const $=ur.current;if(!$)return;const de=$.getBoundingClientRect(),be=$.width/de.width,z=$.height/de.height,{startClientX:Pe,startClientY:ve,objectStartPositions:Re}=Jl.current,je=(D.clientX-Pe)*be,_e=(D.clientY-ve)*z,fe=sx(je,_e,_t,Xn,ri),ye=fe.x,pe=fe.y;Re&&(t&&n({...t,x:Re.topImageX+ye,y:Re.topImageY+pe}),r&&o({...r,x:Re.bottomImageX+ye,y:Re.bottomImageY+pe}),Bi(Gt.map(ge=>({...ge,x:(Re.componentsTop?.[ge.id]?.x??ge.x)+ye,y:(Re.componentsTop?.[ge.id]?.y??ge.y)+pe}))),Kn(an.map(ge=>({...ge,x:(Re.componentsBottom?.[ge.id]?.x??ge.x)+ye,y:(Re.componentsBottom?.[ge.id]?.y??ge.y)+pe}))),Ie(Se.map(ge=>({...ge,x:(Re.powerSymbols?.[ge.id]?.x??ge.x)+ye,y:(Re.powerSymbols?.[ge.id]?.y??ge.y)+pe}))),lt(Ve.map(ge=>({...ge,x:(Re.groundSymbols?.[ge.id]?.x??ge.x)+ye,y:(Re.groundSymbols?.[ge.id]?.y??ge.y)+pe}))),St(Qe.map((ge,Me)=>({...ge,points:ge.points.map((De,$e)=>{const ht=Re.drawingStrokes?.[Me]?.points?.[$e];return{...De,x:(ht?.x??De.x)+ye,y:(ht?.y??De.y)+pe}})}))),Ya(na.map((ge,Me)=>{const De=Re.vias?.[Me];return{...ge,x:(De?.x??ge.x)+ye,y:(De?.y??ge.y)+pe}})),$i(zt.map((ge,Me)=>{const De=Re.pads?.[Me];return{...ge,x:(De?.x??ge.x)+ye,y:(De?.y??ge.y)+pe}})))},C=()=>{kc(!1),Oo.current=null,Jl.current=null,window.removeEventListener("mousemove",p,!0),window.removeEventListener("mouseup",C,!0)};return window.addEventListener("mousemove",p,!0),window.addEventListener("mouseup",C,!0),()=>{window.removeEventListener("mousemove",p,!0),window.removeEventListener("mouseup",C,!0)}},[_,fl,_t,Xn,ri,t,r,Gt,an,Se,Ve,Qe,na,zt,n,o,Bi,Kn,Ie,lt,St,Ya,$i]);const Tu=U.useCallback(()=>{const p=ur.current;if(!p)return;const C=p.getContext("2d");if(!C)return;C.clearRect(0,0,p.width,p.height),C.fillStyle="#000000",C.fillRect(0,0,p.width,p.height),C.fillStyle="#ffffff",C.fillRect(5,5,p.width-10,p.height-10),C.save(),C.beginPath(),C.rect(5,5,p.width-10,p.height-10),C.clip(),C.translate(5,5);const D=(Pe,ve,Re,je,_e,fe,ye,pe)=>{const ge=document.createElement("canvas");ge.width=Re,ge.height=je;const Me=ge.getContext("2d",{willReadFrequently:!0});Me.clearRect(0,0,Re,je),Me.drawImage(ve,0,0,Re,je);let De=ge;if(Math.abs(_e)>1e-6){const $e=Jg(_e),ht=Math.max(.2,1-$e),xt=Math.max(.2,1+$e),Tt=Math.max(ht,xt),Je=Math.max(1,Math.ceil(Re*Tt)),qt=document.createElement("canvas");qt.width=Je,qt.height=je;const We=qt.getContext("2d",{willReadFrequently:!0});We.clearRect(0,0,Je,je);for(let Ye=0;Ye<je;Ye++){const Ue=je<=1?0:Ye/(je-1),at=ht*(1-Ue)+xt*Ue,dt=Math.max(1,Re*at),Rt=(Je-dt)/2;We.drawImage(De,0,Ye,Re,1,Rt,Ye,dt,1)}De=qt}if(Math.abs(fe)>1e-6){const $e=Jg(fe),ht=Math.max(.2,1-$e),xt=Math.max(.2,1+$e),Tt=Math.max(ht,xt),Je=Math.max(1,Math.ceil(je*Tt)),qt=document.createElement("canvas");qt.width=De.width,qt.height=Je;const We=qt.getContext("2d",{willReadFrequently:!0});We.clearRect(0,0,qt.width,Je);for(let Ye=0;Ye<De.width;Ye++){const Ue=De.width<=1?0:Ye/(De.width-1),at=ht*(1-Ue)+xt*Ue,dt=Math.max(1,je*at),Rt=(Je-dt)/2;We.drawImage(De,Ye,0,1,De.height,Ye,Rt,1,dt)}De=qt}Pe.drawImage(De,-ye/2,-pe/2,ye,pe)};C.translate(or.x,or.y),C.scale(_t,_t),c5(C,Xn,ri);{const Pe=Ur&&zl;if(t&&t.bitmap&&Ur){const ve=t.bitmap;C.save(),C.globalAlpha=1;const Re=[];t.brightness!==void 0&&t.brightness!==100&&Re.push(`brightness(${t.brightness}%)`),t.contrast!==void 0&&t.contrast!==100&&Re.push(`contrast(${t.contrast}%)`),N&&Re.push("grayscale(100%)"),C.filter=Re.length>0?Re.join(" "):"none",Vm(C,{x:t.x,y:t.y,rotation:t.rotation||0,scale:t.scale||1,flipX:t.flipX||!1,flipY:t.flipY||!1,skewX:t.skewX||0,skewY:t.skewY||0});const je=ve.width*1,_e=ve.height*1,fe=ve;t.keystoneV&&Math.abs(t.keystoneV)>1e-6||t.keystoneH&&Math.abs(t.keystoneH)>1e-6?D(C,fe,ve.width,ve.height,t.keystoneV||0,t.keystoneH||0,je,_e):C.drawImage(fe,-je/2,-_e/2,je,_e),C.restore()}if(r&&r.bitmap&&zl){const ve=r.bitmap;C.save(),C.globalAlpha=Pe?h/100:1;const Re=[];r.brightness!==void 0&&r.brightness!==100&&Re.push(`brightness(${r.brightness}%)`),r.contrast!==void 0&&r.contrast!==100&&Re.push(`contrast(${r.contrast}%)`),N&&Re.push("grayscale(100%)"),C.filter=Re.length>0?Re.join(" "):"none",Vm(C,{x:r.x,y:r.y,rotation:r.rotation||0,scale:r.scale||1,flipX:r.flipX||!1,flipY:r.flipY||!1,skewX:r.skewX||0,skewY:r.skewY||0});const je=ve.width*1,_e=ve.height*1,fe=ve;r.keystoneV&&Math.abs(r.keystoneV)>1e-6||r.keystoneH&&Math.abs(r.keystoneH)>1e-6?D(C,fe,ve.width,ve.height,r.keystoneV||0,r.keystoneH||0,je,_e):C.drawImage(fe,-je/2,-_e/2,je,_e),C.restore()}}if(b0(C),Ha&&S.length>0){const Pe=ve=>{C.save(),rx(C,ve.x,ve.y,ve.rotation??0,ve.flipX??!1,!1);const Re=wn.find(pe=>pe.id===ve.powerBusId),je=ui.has(ve.id),_e=Re?.color||"#ff0000";C.strokeStyle=_e,C.lineWidth=Math.max(1,(je?3:2)/Math.max(_t,.001)),C.lineCap="round";const fe=Math.max(6,ve.size/2),ye=fe*.8;if(je&&(C.strokeStyle="#0066ff",C.lineWidth=Math.max(1,4/Math.max(_t,.001)),C.beginPath(),C.arc(0,0,fe+ye+3,0,qa),C.stroke()),C.strokeStyle=_e,C.lineWidth=Math.max(1,(je?3:2)/Math.max(_t,.001)),C.beginPath(),C.arc(0,0,fe,0,qa),C.stroke(),C.beginPath(),C.moveTo(0,-fe-ye),C.lineTo(0,fe+ye),C.stroke(),C.beginPath(),C.moveTo(-fe-ye,0),C.lineTo(fe+ye,0),C.stroke(),Re){C.fillStyle=_e;const pe=Math.max(10,fe*.8);C.font=`${pe}px sans-serif`,C.textAlign="center",C.textBaseline="top",C.fillText(Re.name,0,fe+ye+8)}C.restore()};S.forEach(Pe)}if(mr&&P.length>0){const Pe=ve=>{C.save(),rx(C,ve.x,ve.y,ve.rotation??0,ve.flipX??!1,!1);const Re=hi.has(ve.id),je=j.find(pe=>pe.id===ve.groundBusId),_e=je?.color||ve.color||"#000000",fe=ve.groundBusId==="groundbus-earth";let ye;if(fe){const pe=Math.max(6,ve.size||18),ge=pe*.9,Me=pe*.24,De=pe*1.6;C.strokeStyle=_e,C.lineWidth=Math.max(1,(Re?3:2)/Math.max(_t,.001)),C.lineCap="round",Re&&(C.strokeStyle="#0066ff",C.lineWidth=Math.max(1,4/Math.max(_t,.001)),C.setLineDash([5,5]),C.strokeRect(-De/2-3,-3,De+6,ge+Me*2+6),C.setLineDash([])),C.strokeStyle=_e,C.lineWidth=Math.max(1,(Re?3:2)/Math.max(_t,.001)),C.beginPath(),C.moveTo(0,0),C.lineTo(0,ge),C.stroke();for(let $e=0;$e<3;$e++){const ht=ge+$e*Me,xt=De*(1-$e*.25);C.beginPath(),C.moveTo(-xt/2,ht),C.lineTo(xt/2,ht),C.stroke()}ye=ge+Me*2}else{const pe=Math.max(6,(ve.size||18)/2),ge=pe*.8;Re&&(C.strokeStyle="#0066ff",C.lineWidth=Math.max(1,4/Math.max(_t,.001)),C.beginPath(),C.arc(0,0,pe+ge+3,0,qa),C.stroke()),C.strokeStyle=_e,C.lineWidth=Math.max(1,(Re?3:2)/Math.max(_t,.001)),C.beginPath(),C.arc(0,0,pe,0,qa),C.stroke(),C.beginPath(),C.moveTo(0,-pe-ge),C.lineTo(0,pe+ge),C.stroke(),C.beginPath(),C.moveTo(-pe-ge,0),C.lineTo(pe+ge,0),C.stroke(),ye=pe+ge}if(je){C.fillStyle=_e;const pe=Math.max(10,(ve.size||18)*.5);C.font=`${pe}px sans-serif`,C.textAlign="center",C.textBaseline="top",C.fillText(je.name,0,ye+8)}C.restore()};P.forEach(Pe)}const $=Pe=>{const ve=Math.max(10,Pe.size||18),Re=ve/2;C.save(),C.translate(Pe.x,Pe.y),d5(C,Xn,ri),Pe.orientation!==void 0&&Pe.orientation!==0&&C.rotate(cu(Pe.orientation)),Pe.flipX&&C.scale(-1,1),Pe.flipY&&C.scale(1,-1),C.strokeStyle=Pe.color||"#111",C.lineWidth=Math.max(1,2/Math.max(_t,.001));const je=Pe.pinConnections||[],_e=je.length>0&&je.length===Pe.pinCount&&je.every(pe=>pe&&pe.trim()!=="");C.fillStyle=_e?"rgba(178, 223, 138, 0.85)":"rgba(255,255,255,0.85)",C.beginPath(),C.rect(-Re,-Re,ve,ve),C.fill(),C.stroke();const fe=Pe.designator?.trim()||"";if(fe){C.fillStyle=Pe.color||"#111";const pe=Math.max(6,ve*.35),ge=ve*.9;let Me=pe;C.font=`bold ${Me}px sans-serif`;const De=C.measureText(fe);De.width>ge&&(Me=ge/De.width*Me,Me=Math.max(6,Me),C.font=`bold ${Me}px sans-serif`),C.textAlign="center",C.textBaseline="middle",C.fillText(fe,0,0)}gn.has(Pe.id)&&(C.setLineDash([4,3]),C.strokeStyle="#00bfff",C.lineWidth=1.5,C.strokeRect(-Re-3,-Re-3,ve+6,ve+6),C.setLineDash([])),C.restore()};if(yr){const Pe=Re=>{const je=parseInt(Re,10);if(isNaN(je))return null;for(const _e of Qe)if((_e.type==="via"||_e.type==="pad"||_e.type==="testPoint")&&_e.points.length>0){const fe=_e.points[0];if(fe.id===je)return{x:fe.x,y:fe.y}}for(const _e of Qe)if(_e.type==="trace"){for(const fe of _e.points)if(fe.id===je)return{x:fe.x,y:fe.y}}for(const _e of S)if(_e.pointId===je)return{x:_e.x,y:_e.y};for(const _e of P)if(_e.pointId===je)return{x:_e.x,y:_e.y};return null},ve=Re=>{const je=Re.pinConnections||[],_e=Sp(Re)&&Re.pinPolarities,ye=Vc(Re)?.category==="Semiconductors",pe=new Map;for(let ge=0;ge<je.length;ge++){const Me=je[ge];if(Me&&Me.trim()!==""){const De=Me.trim(),$e=ye&&ge===0,ht=!!(_e&&Re.pinPolarities&&ge<Re.pinPolarities.length&&Re.pinPolarities[ge]==="-"),xt=pe.get(De);xt!==void 0?pe.set(De,{isNegative:xt.isNegative||ht,hasPin1:xt.hasPin1||$e}):pe.set(De,{isNegative:ht,hasPin1:$e})}}for(const[ge,Me]of pe){const{isNegative:De,hasPin1:$e}=Me,ht=Pe(ge);if(ht){const xt={x:Re.x,y:Re.y},Tt=parseInt(ge,10),Je=`${Re.id}:${Tt}`,qt=gt.has(Je);C.save(),qt?(C.strokeStyle="#00bfff",C.lineWidth=Math.max(2,Ct*1.5/Math.max(_t,.001)),C.setLineDash([4,3])):(De?C.strokeStyle="rgba(0, 0, 0, 0.8)":$e?C.strokeStyle=u5(ze,.4):C.strokeStyle=ze,C.lineWidth=Math.max(1,Ct/Math.max(_t,.001))),C.beginPath(),C.moveTo(xt.x,xt.y),C.lineTo(ht.x,ht.y),C.stroke(),C.setLineDash([]),C.restore()}}};Vi&&Gt.forEach(ve),Ks&&an.forEach(ve)}if(Vi&&Gt.forEach($),Ks&&an.forEach($),Fl&&oc){C.save();const Pe=oc.start,ve=oc.end,Re=Math.min(Pe.x,ve.x),je=Math.min(Pe.y,ve.y),_e=Math.max(Pe.x,ve.x),fe=Math.max(Pe.y,ve.y),ye=_e-Re,pe=fe-je,ge=Math.max(2,6/Math.max(1e-4,_t));C.strokeStyle="#ff8800",C.fillStyle="rgba(255, 136, 0, 0.2)",C.lineWidth=Math.max(1,2/Math.max(1e-4,_t)),C.setLineDash([ge,ge]),C.beginPath(),C.rect(Re,je,ye,pe),C.fill(),C.stroke(),C.fillStyle="#ff8800",C.beginPath(),C.arc(Pe.x,Pe.y,Math.max(3,6/Math.max(1e-4,_t)),0,Math.PI*2),C.fill(),C.setLineDash([]),C.restore()}if(_==="select"&&Ad){C.save();const Pe=Math.max(2,6/Math.max(1e-4,_t));C.strokeStyle="#00bfff",C.fillStyle="rgba(0, 191, 255, 0.15)",C.lineWidth=Math.max(1,1.5/Math.max(1e-4,_t)),C.setLineDash([Pe,Pe]),C.beginPath(),C.rect(Ad.x,Ad.y,Ad.width,Ad.height),C.fill(),C.stroke(),C.setLineDash([]),C.restore()}C.save();const de=50,z=2/_t;C.strokeStyle="#FF0000",C.lineWidth=z,C.lineCap="round",C.lineJoin="round",C.beginPath(),C.moveTo(-de,0),C.lineTo(de,0),C.stroke(),C.fillStyle="#FF0000",C.font=`${12/_t}px sans-serif`,C.textAlign="left",C.textBaseline="top",C.fillText("+X",de+2/_t,2/_t),C.textAlign="right",C.fillText("-X",-de-2/_t,2/_t),C.strokeStyle="#0000FF",C.lineWidth=z,C.lineCap="round",C.lineJoin="round",C.beginPath(),C.moveTo(0,-de),C.lineTo(0,de),C.stroke(),C.fillStyle="#0000FF",C.font=`${12/_t}px sans-serif`,C.textAlign="left",C.textBaseline="top",C.fillText("+Y",2/_t,de+2/_t),C.textBaseline="bottom",C.fillText("-Y",2/_t,-de-2/_t),C.restore(),C.restore()},[t,r,h,Qe,Ln,Wt,_,B,G,N,Ut,sn,_t,or.x,or.y,Xn,ri,Ur,zl,Ar,Cr,cs,Ys,tr,So,Uo,Vi,Ks,Gt,an,Ha,S,mr,P,yr,Ad,li,gn,ui,hi,gt,Qn,O,W,J,Ce,ot,rn,Fi,ze,Ct,Vr,Di,Fl,oc]);Dt.useEffect(()=>{const p=()=>{const C=Yc.current;if(!C)return;const D=1.6,$=244,de=12,be=6,z=12,Pe=C.clientWidth-$-de,ve=C.getBoundingClientRect(),Re=window.innerHeight,je=ve.top,fe=Re-je-be-10,ye=Math.min(C.clientHeight-z,fe),pe=Math.floor(ye*D),ge=Math.floor(Pe/D);let Me,De;pe<=Pe?(Me=pe,De=ye):(Me=Pe,De=ge),Me=Math.max(600,Me),De=Math.max(375,De),De=Math.max(355,De-20),ra($e=>{const ht=$e.width===0&&$e.height===0,xt=$e.width!==Me||$e.height!==De;return ht&&xt&&setTimeout(()=>{Ni({x:0,y:0})},0),$e.width===Me&&$e.height===De?$e:{width:Me,height:De}})};return p(),window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[Po,Ni]),Dt.useEffect(()=>{Fi&&(Jn&&(Lt(!1),Et(null)),zi(null))},[Fi,Jn,Lt,Et,zi]);const b0=U.useCallback(p=>{if(Qe.forEach(C=>{if(C.type==="via"||C.type==="pad"||C.type==="testPoint"||C.testPointType!==void 0||C.type!=="trace")return;let D=!1;if(C.layer==="top"?D=Cr:C.layer==="bottom"&&(D=cs),!!D){if(C.points.length===1){const $=C.points[0],de=Math.max(.5,C.size/2);li.has(C.id)&&(p.strokeStyle="#00bfff",p.lineWidth=2,p.setLineDash([4,3]),p.beginPath(),p.arc($.x,$.y,de+3,0,qa),p.stroke(),p.setLineDash([])),p.fillStyle=C.color,p.beginPath(),p.arc($.x,$.y,de,0,qa),p.fill()}else if(li.has(C.id)&&(p.strokeStyle="#00bfff",p.lineWidth=C.size+4,p.lineCap="round",p.lineJoin="round",p.globalAlpha=.6,p.beginPath(),C.points.forEach(($,de)=>{de===0?p.moveTo($.x,$.y):p.lineTo($.x,$.y)}),p.stroke(),p.globalAlpha=1),p.strokeStyle=C.color,p.lineWidth=C.size,p.lineCap="round",p.lineJoin="round",p.globalAlpha=1,p.beginPath(),C.points.forEach(($,de)=>{de===0?p.moveTo($.x,$.y):p.lineTo($.x,$.y)}),p.stroke(),Vr){p.fillStyle="#000000";for(const $ of C.points)p.beginPath(),p.arc($.x,$.y,C.size/2,0,qa),p.fill()}}}),Qe.forEach(C=>{if(C.type==="via"){if(!Ar)return}else if(C.type==="pad"){const $=C.layer||"top";if($==="top"&&!Ys||$==="bottom"&&!tr)return}else if(C.type==="testPoint"){const $=C.layer||"top";if($==="top"&&!So||$==="bottom"&&!Uo)return}else return;const D=C.points[0];if(li.has(C.id)){if(C.type==="via"){const $=Math.max(.5,C.size/2)+3;p.strokeStyle="#00bfff",p.lineWidth=2,p.setLineDash([4,3]),p.beginPath(),p.arc(D.x,D.y,$,0,qa),p.stroke(),p.setLineDash([])}else if(C.type==="pad"){const $=Math.max(.5,C.size/2)+3;p.strokeStyle="#00bfff",p.lineWidth=2,p.setLineDash([4,3]),p.strokeRect(D.x-$,D.y-$,C.size+6,C.size+6),p.setLineDash([])}else if(C.type==="testPoint"){const $=Math.max(.5,C.size/2)+3;p.strokeStyle="#00bfff",p.lineWidth=2,p.setLineDash([4,3]),p.beginPath(),p.moveTo(D.x,D.y-$),p.lineTo(D.x+$,D.y),p.lineTo(D.x,D.y+$),p.lineTo(D.x-$,D.y),p.closePath(),p.stroke(),p.setLineDash([])}}if(C.type==="via"){const $=Math.max(.5,C.size/2),de=$*.5,be=$*.7;p.fillStyle=C.color,p.beginPath(),p.arc(D.x,D.y,$,0,qa),p.arc(D.x,D.y,de,0,qa),p.fill("evenodd"),p.strokeStyle="#808080",p.lineWidth=1,p.beginPath(),p.moveTo(D.x-be,D.y),p.lineTo(D.x+be,D.y),p.stroke(),p.beginPath(),p.moveTo(D.x,D.y-be),p.lineTo(D.x,D.y+be),p.stroke()}else if(C.type==="pad"){const $=Math.max(.5,C.size/2),de=C.size,be=de*.5,z=$*.7;p.fillStyle=C.color,p.beginPath(),p.rect(D.x-$,D.y-$,de,de),p.rect(D.x-be/2,D.y-be/2,be,be),p.fill("evenodd"),p.strokeStyle="#808080",p.lineWidth=1,p.beginPath(),p.moveTo(D.x-z,D.y),p.lineTo(D.x+z,D.y),p.stroke(),p.beginPath(),p.moveTo(D.x,D.y-z),p.lineTo(D.x,D.y+z),p.stroke()}else if(C.type==="testPoint"){const $=Math.max(.5,C.size/2),de=$*.7;p.fillStyle=C.color||"#FFFF00",p.strokeStyle="#000000",p.lineWidth=2,p.beginPath(),p.moveTo(D.x,D.y-$),p.lineTo(D.x+$,D.y),p.lineTo(D.x,D.y+$),p.lineTo(D.x-$,D.y),p.closePath(),p.fill(),p.stroke(),p.strokeStyle="#808080",p.lineWidth=1,p.beginPath(),p.moveTo(D.x-de,D.y),p.lineTo(D.x+de,D.y),p.stroke(),p.beginPath(),p.moveTo(D.x,D.y-de),p.lineTo(D.x,D.y+de),p.stroke()}}),Ln.length>0){const C=sn;let D=!0;if(_==="draw"&&(ot==="via"?D=Ar:D=C==="top"?Cr:cs),D)if(_==="draw")if(ot==="via"){const $=Ln[Ln.length-1],de=Math.max(.5,G/2),be=de*.5,z=de*.7;p.fillStyle=B,p.beginPath(),p.arc($.x,$.y,de,0,qa),p.arc($.x,$.y,be,0,qa),p.fill("evenodd"),p.strokeStyle="#808080",p.lineWidth=1,p.beginPath(),p.moveTo($.x-z,$.y),p.lineTo($.x+z,$.y),p.stroke(),p.beginPath(),p.moveTo($.x,$.y-z),p.lineTo($.x,$.y+z),p.stroke()}else if(ot==="pad"){const $=Ln[Ln.length-1],de=Math.max(.5,G/2),be=G,z=be*.5,Pe=de*.7;p.fillStyle=B,p.beginPath(),p.rect($.x-de,$.y-de,be,be),p.rect($.x-z/2,$.y-z/2,z,z),p.fill("evenodd"),p.strokeStyle="#808080",p.lineWidth=1,p.beginPath(),p.moveTo($.x-Pe,$.y),p.lineTo($.x+Pe,$.y),p.stroke(),p.beginPath(),p.moveTo($.x,$.y-Pe),p.lineTo($.x,$.y+Pe),p.stroke()}else if(ot==="testPoint"){const $=Ln[Ln.length-1],de=Math.max(.5,G/2),be=de*.7;p.fillStyle=B,p.beginPath(),p.moveTo($.x,$.y-de),p.lineTo($.x+de,$.y),p.lineTo($.x,$.y+de),p.lineTo($.x-de,$.y),p.closePath(),p.fill(),p.strokeStyle="#808080",p.lineWidth=1,p.beginPath(),p.moveTo($.x-be,$.y),p.lineTo($.x+be,$.y),p.stroke(),p.beginPath(),p.moveTo($.x,$.y-be),p.lineTo($.x,$.y+be),p.stroke()}else{const $=Qn||"top",de=$==="top"?O:W,be=$==="top"?J:Ce;if(Ln.length===1){const z=Ln[0],Pe=Math.max(.5,be/2);p.fillStyle=de,p.beginPath(),p.arc(z.x,z.y,Pe,0,qa),p.fill(),rn&&(p.strokeStyle=de,p.lineWidth=be,p.lineCap="round",p.lineJoin="round",p.globalAlpha=.6,p.beginPath(),p.moveTo(z.x,z.y),p.lineTo(rn.x,rn.y),p.stroke(),p.globalAlpha=1)}else if(p.strokeStyle=de,p.lineWidth=be,p.lineCap="round",p.lineJoin="round",p.globalAlpha=1,p.beginPath(),Ln.forEach((z,Pe)=>{Pe===0?p.moveTo(z.x,z.y):p.lineTo(z.x,z.y)}),p.stroke(),rn&&Ln.length>0){const z=Ln[Ln.length-1];p.globalAlpha=.6,p.beginPath(),p.moveTo(z.x,z.y),p.lineTo(rn.x,rn.y),p.stroke(),p.globalAlpha=1}}else _==="erase"&&(p.strokeStyle="rgba(255, 0, 0, 0.5)",p.lineWidth=G,p.lineCap="round",p.lineJoin="round",p.globalAlpha=.5,p.beginPath(),Ln.forEach(($,de)=>{de===0?p.moveTo($.x,$.y):p.lineTo($.x,$.y)}),p.stroke())}},[Qe,li,Cr,cs,Ar,Ys,tr,So,Uo,Ln,_,ot,B,G,sn,Qn,O,W,J,Ce,rn,Vr]),ku=U.useCallback((p,C)=>{if(Fi){alert("Cannot transform: Images are locked. Unlock images to transform them.");return}p==="top"&&t?n(D=>D?{...D,...C}:null):p==="bottom"&&r?o(D=>D?{...D,...C}:null):p==="both"&&(t&&n(D=>D?{...D,...C}:null),r&&o(D=>D?{...D,...C}:null))},[t,r,Fi]),zh=U.useCallback(()=>{Ut&&(ku(Ut,{x:0,y:0,scale:1,rotation:0,flipX:!1,flipY:!1,skewX:0,skewY:0,keystoneV:0,keystoneH:0,brightness:100,contrast:100}),T(!1))},[ku,Ut]),Bh=U.useCallback((p=1)=>{if(li.size>0||gn.size>0||ui.size>0||hi.size>0){if(li.size>0){const C=Qe.filter(be=>li.has(be.id)),D=Ui&&C.some(be=>be.type==="via"),$=ws&&C.some(be=>be.type==="trace"),de=hr&&C.some(be=>be.type==="pad");if(D){alert("Cannot change size: Vias are locked. Unlock vias to change their size.");return}if($){alert("Cannot change size: Traces are locked. Unlock traces to change their size.");return}if(de){alert("Cannot change size: Pads are locked. Unlock pads to change their size.");return}}if(gn.size>0&&Or){alert("Cannot change size: Components are locked. Unlock components to change their size.");return}if(ui.size>0&&fi){alert("Cannot change size: Power nodes are locked. Unlock power nodes to change their size.");return}if(hi.size>0&&Ss){alert("Cannot change size: Ground nodes are locked. Unlock ground nodes to change their size.");return}if(St(C=>C.map(D=>{if(li.has(D.id)){const $=D.size+p;return D.type==="via"?it("via",$):D.type==="pad"?it("pad",$):D.type==="trace"&&it("trace",$,D.layer),{...D,size:$}}return D})),gn.size>0){const C=(gn.size>0&&Gt.find(D=>gn.has(D.id))?.size||18)+p;it("component",C),Bi(D=>D.map($=>gn.has($.id)?{...$,size:($.size||18)+p}:$)),Kn(D=>D.map($=>gn.has($.id)?{...$,size:($.size||18)+p}:$))}if(ui.size>0){const C=(S.find(D=>ui.has(D.id))?.size||18)+p;it("power",C),Ie(D=>D.map($=>ui.has($.id)?{...$,size:$.size+p}:$))}if(hi.size>0){const C=(P.find(D=>hi.has(D.id))?.size||18)+p;it("ground",C),lt(D=>D.map($=>hi.has($.id)?{...$,size:($.size||18)+p}:$))}}else{let C=null;if(_==="draw"&&ot==="via"?C="via":_==="draw"&&ot==="pad"?C=el.current==="bottom"?"padBottom":"padTop":_==="draw"&&ot==="testPoint"?C=tl.current==="bottom"?"testPointBottom":"testPointTop":_==="draw"&&ot==="trace"?C=Ea.current==="bottom"?"traceBottom":"traceTop":_==="component"?C=Ga.current==="bottom"?"componentBottom":"componentTop":_==="power"?C="power":_==="ground"&&(C="ground"),C){const D=Bn.get(C),$=Math.min(40,D.size+p);Bn.setSize(C,$)}}},[li,gn,ui,hi,Qe,Ui,ws,hr,Ps,Or,fi,Ss,_,ot,it]),Fh=U.useCallback((p=1)=>{if(li.size>0||gn.size>0||ui.size>0||hi.size>0){if(li.size>0){const C=Qe.filter(z=>li.has(z.id)),D=Ui&&C.some(z=>z.type==="via"),$=ws&&C.some(z=>z.type==="trace"),de=hr&&C.some(z=>z.type==="pad"),be=Ps&&C.some(z=>z.type==="testPoint");if(D){alert("Cannot change size: Vias are locked. Unlock vias to change their size.");return}if($){alert("Cannot change size: Traces are locked. Unlock traces to change their size.");return}if(de){alert("Cannot change size: Pads are locked. Unlock pads to change their size.");return}if(be){alert("Cannot change size: Test Points are locked. Unlock test points to change their size.");return}}if(gn.size>0&&Or){alert("Cannot change size: Components are locked. Unlock components to change their size.");return}if(ui.size>0&&fi){alert("Cannot change size: Power nodes are locked. Unlock power nodes to change their size.");return}if(hi.size>0&&Ss){alert("Cannot change size: Ground nodes are locked. Unlock ground nodes to change their size.");return}if(St(C=>C.map(D=>{if(li.has(D.id)){const $=Math.max(1,D.size-p);return D.type==="via"?it("via",$):D.type==="pad"?it("pad",$,D.layer):D.type==="testPoint"?it("testPoint",$,D.layer):D.type==="trace"&&it("trace",$,D.layer),{...D,size:$}}return D})),gn.size>0){const C=Math.max(12,(gn.size>0&&Gt.find(D=>gn.has(D.id))?.size||18)-p);it("component",C),Bi(D=>D.map($=>gn.has($.id)?{...$,size:Math.max(12,($.size||18)-p)}:$)),Kn(D=>D.map($=>gn.has($.id)?{...$,size:Math.max(12,($.size||18)-p)}:$))}if(ui.size>0){const C=Math.max(12,(S.find(D=>ui.has(D.id))?.size||18)-p);it("power",C),Ie(D=>D.map($=>ui.has($.id)?{...$,size:Math.max(12,$.size-p)}:$))}if(hi.size>0){const C=Math.max(12,(P.find(D=>hi.has(D.id))?.size||18)-p);it("ground",C),lt(D=>D.map($=>hi.has($.id)?{...$,size:Math.max(12,($.size||18)-p)}:$))}}else{let C=null;if(_==="draw"&&ot==="via"?C="via":_==="draw"&&ot==="pad"?C=(sn||Ti||"top")==="bottom"?"padBottom":"padTop":_==="draw"&&ot==="testPoint"?C=(sn||On||"top")==="bottom"?"testPointBottom":"testPointTop":_==="draw"&&ot==="trace"?C=(sn||Qn||"top")==="bottom"?"traceBottom":"traceTop":_==="component"?C=(sn||wi||"top")==="bottom"?"componentBottom":"componentTop":_==="power"?C="power":_==="ground"&&(C="ground"),C){const D=Bn.get(C),$=Math.max(1,D.size-p);Bn.setSize(C,$)}}},[li,gn,ui,hi,Qe,Ui,ws,hr,Ps,Or,fi,Ss,_,ot,sn,Ti,On,Qn,wi,it]),$p=U.useCallback(()=>{const p=qs.size;if(li.size>0||gn.size>0||ui.size>0||hi.size>0){if(li.size>0){const C=Qe.filter(z=>li.has(z.id)),D=Ui&&C.some(z=>z.type==="via"),$=hr&&C.some(z=>z.type==="pad"),de=ws&&C.some(z=>z.type==="trace"),be=Ps&&C.some(z=>z.type==="testPoint");if(D||$||de||be){alert("Cannot change size: selected items are locked.");return}}if(gn.size>0&&Or){alert("Cannot change size: selected components are locked.");return}if(ui.size>0&&fi){alert("Cannot change size: selected power nodes are locked.");return}if(hi.size>0&&Ss){alert("Cannot change size: selected ground nodes are locked.");return}St(C=>C.map(D=>li.has(D.id)?(D.type==="via"?(it("via",p),Wn($=>{const de=new Map($),be=de.get("via");return be&&de.set("via",{...be,settings:{...be.settings,size:p}}),de})):D.type==="pad"?(it("pad",p,D.layer),Wn($=>{const de=new Map($),be=de.get("pad");if(be){const z=new Map(be.layerSettings);z.set(D.layer,{...z.get(D.layer)||{color:be.settings.color,size:p},size:p}),de.set("pad",{...be,layerSettings:z})}return de})):D.type==="testPoint"?(it("testPoint",p,D.layer),Wn($=>{const de=new Map($),be=de.get("testPoint");if(be){const z=new Map(be.layerSettings);z.set(D.layer,{...z.get(D.layer)||{color:be.settings.color,size:p},size:p}),de.set("testPoint",{...be,layerSettings:z})}return de})):D.type==="trace"&&it("trace",p,D.layer),{...D,size:p}):D)),gn.size>0&&(it("component",p),Bi(C=>C.map(D=>gn.has(D.id)?{...D,size:p}:D)),Kn(C=>C.map(D=>gn.has(D.id)?{...D,size:p}:D))),ui.size>0&&(it("power",p),Ie(C=>C.map(D=>ui.has(D.id)?{...D,size:p}:D))),hi.size>0&&(it("ground",p),lt(C=>C.map(D=>hi.has(D.id)?{...D,size:p}:D)))}else X(p),_==="draw"&&ot==="trace"?sn==="top"?(Z(p),it("trace",p,"top")):(ie(p),it("trace",p,"bottom")):_==="draw"&&ot==="via"?it("via",p):_==="draw"&&ot==="pad"?it("pad",p,sn):_==="draw"&&ot==="testPoint"?it("testPoint",p,sn):it(_==="component"?"component":_==="power"?"power":_==="ground"?"ground":"brush",p);Do({visible:!1,size:6})},[qs.size,li,gn,ui,hi,Qe,Ui,ws,Or,fi,Ss,_,ot,sn,it,$n,Wn]),Df=U.useCallback(()=>{hs({visible:!1,source:null,interval:5})},[]),Oh=U.useCallback(async(p,C=!1)=>{if(p===null){wa(!1),ul(null),Zi.current&&(clearInterval(Zi.current),Zi.current=null),Lo({visible:!1,interval:5}),C&&hs({visible:!1,source:null,interval:5}),console.log("Auto save: Disabled");return}if(!Qr){alert("Please create a new project (File -> New Project) or open an existing project (File -> Open Project) first.");return}let D=Pi;if(!D){const z=window;if(typeof z.showDirectoryPicker=="function")try{D=await z.showDirectoryPicker(),Jr(D)}catch(Pe){Pe?.name!=="AbortError"&&(console.error("Failed to get directory:",Pe),alert("Failed to select project directory."));return}else{alert("Directory picker is not supported in this browser. Auto-save requires a directory handle.");return}}Kl(D);const $=Qr.replace(/\.json$/i,""),be=fh($).replace(/[^a-zA-Z0-9_-]/g,"_");to(be),pc.current=D,Wo.current=be,ul(p),wa(!0),pr.current=!0,Lo({visible:!1,interval:5}),C&&hs({visible:!1,source:null,interval:5}),setTimeout(()=>{console.log(`Auto save: Enabled with interval ${p} minutes`),gd.current&&gd.current()},200)},[Qr,Pi,wa,ul,Kl,to,Lo,hs,Jr]),Qd=U.useCallback(()=>{bt(),b("select")},[bt]),Uh=U.useCallback(p=>{if(p.key==="Escape"){const z=document.activeElement;if(z&&(z.tagName==="INPUT"&&z.type==="checkbox"||z.tagName==="INPUT"&&z.type==="radio")){z.blur(),p.preventDefault(),p.stopPropagation();return}}const C=document.activeElement;if(C&&(C.tagName==="INPUT"&&C.type!=="checkbox"&&C.type!=="radio"||C.tagName==="TEXTAREA"||C.isContentEditable))return;const D=Lc.current>0;if(D&&p.key!=="m"&&p.key!=="M")return;const $=parseInt(p.key);if(!isNaN($)&&$>=0&&$<=9){if(p.preventDefault(),p.stopPropagation(),_==="center"&&md){if(os.current&&(clearTimeout(os.current),os.current=null),ur.current){let ve=0,Re=0;t?(ve=t.x,Re=t.y):r&&(ve=r.x,Re=r.y),Ll(je=>({...je,[$]:{pcbReferenceX:ve,pcbReferenceY:Re,x:0,y:0,zoom:_t,viewRotation:Xn,viewFlipX:ri,isBottomView:ba,transparency:h,showTopImage:Ur,showBottomImage:zl,showViasLayer:Ar,showTopTracesLayer:Cr,showBottomTracesLayer:cs,showTopPadsLayer:Ys,showBottomPadsLayer:tr,showTopTestPointsLayer:So,showBottomTestPointsLayer:Uo,showTopComponents:Vi,showBottomComponents:Ks,showPowerLayer:Ha,showGroundLayer:mr,showConnectionsLayer:yr}}))}ms(!1),b("select"),ta(void 0);return}const z=xo[$];if(z){Fn(z.zoom),ci(z.viewRotation??0),Br(z.viewFlipX??!1),Ws(z.isBottomView??!1),f(z.transparency??50);const Pe=z.pcbReferenceX??z.x??0,ve=z.pcbReferenceY??z.y??0;let Re=0,je=0;t?(Re=t.x,je=t.y):r&&(Re=r.x,je=r.y);const _e=Pe-Re,fe=ve-je;(Math.abs(_e)>.001||Math.abs(fe)>.001)&&(t&&n({...t,x:t.x+_e,y:t.y+fe}),r&&o({...r,x:r.x+_e,y:r.y+fe}),Bi(Gt.map(ye=>({...ye,x:ye.x+_e,y:ye.y+fe}))),Kn(an.map(ye=>({...ye,x:ye.x+_e,y:ye.y+fe}))),Ie(Se.map(ye=>({...ye,x:ye.x+_e,y:ye.y+fe}))),lt(Ve.map(ye=>({...ye,x:ye.x+_e,y:ye.y+fe}))),St(Qe.map(ye=>({...ye,points:ye.points.map(pe=>({...pe,x:pe.x+_e,y:pe.y+fe}))}))),Ya(na.map(ye=>({...ye,x:ye.x+_e,y:ye.y+fe}))),$i(zt.map(ye=>({...ye,x:ye.x+_e,y:ye.y+fe})))),Ni({x:0,y:0}),ys(z.showTopImage),As(z.showBottomImage),$s(z.showViasLayer),Sa(z.showTopTracesLayer),Gs(z.showBottomTracesLayer),Xs(z.showTopPadsLayer),no(z.showBottomPadsLayer),ic(z.showTopTestPointsLayer),rc(z.showBottomTestPointsLayer),sa(z.showTopComponents),Aa(z.showBottomComponents),x(z.showPowerLayer),Ai(z.showGroundLayer),Hr(z.showConnectionsLayer)}return}if(p.key==="+"||p.key==="="){p.preventDefault(),p.stopPropagation(),Bh(p.shiftKey?5:1);return}if(p.key==="-"||p.key==="_"){p.preventDefault(),p.stopPropagation(),Fh(p.shiftKey?5:1);return}const de=p.shiftKey||p.getModifierState("CapsLock"),be=_==="transform"&&Ut;if(p.key==="ArrowUp"||p.key==="ArrowDown"||p.key==="ArrowLeft"||p.key==="ArrowRight"){if(gn.size>0){p.preventDefault(),p.stopPropagation();const z=p.shiftKey?10:1;let Pe=0,ve=0;p.key==="ArrowUp"?ve=-z:p.key==="ArrowDown"?ve=z:p.key==="ArrowLeft"?Pe=-z:p.key==="ArrowRight"&&(Pe=z);for(const Re of gn){const je=Gt.find(_e=>_e.id===Re);if(je){const _e=je.x+Pe,fe=je.y+ve,ye=cr({x:_e,y:fe});Bi(pe=>pe.map(ge=>ge.id===Re?{...ge,x:ye.x,y:ye.y}:ge))}else{const _e=an.find(fe=>fe.id===Re);if(_e){const fe=_e.x+Pe,ye=_e.y+ve,pe=cr({x:fe,y:ye});Kn(ge=>ge.map(Me=>Me.id===Re?{...Me,x:pe.x,y:pe.y}:Me))}}}return}if(de&&!be&&gn.size===0){if(p.key==="ArrowUp"||p.key==="ArrowDown"){p.preventDefault(),p.stopPropagation();const z=p.key==="ArrowUp"?-90:90;Dc(z);return}else if(p.key==="ArrowLeft"||p.key==="ArrowRight"){p.preventDefault(),p.stopPropagation(),Gd();return}}}if((p.key==="I"||p.key==="i")&&!p.ctrlKey&&!p.shiftKey&&!p.altKey){const z=document.activeElement;if(!!z&&(z.tagName==="INPUT"&&z.type!=="range"&&z.type!=="checkbox"&&z.type!=="radio"||z.tagName==="TEXTAREA"||z.isContentEditable))return;p.preventDefault(),p.stopPropagation();const ve=[];li.size>0,li.size===0&&gn.size===0&&ui.size===0&&hi.size===0&&ve.push(`
No objects selected.`);const Re=ve.join(`
`);console.log(Re),ll({visible:!0,text:Re});return}if((p.key==="N"||p.key==="n")&&!p.ctrlKey&&!p.shiftKey&&!p.altKey){const z=document.activeElement;if(!!z&&(z.tagName==="INPUT"&&z.type!=="range"&&z.type!=="checkbox"&&z.type!=="radio"||z.tagName==="TEXTAREA"||z.isContentEditable))return;p.preventDefault(),p.stopPropagation(),Ii(!0);return}if((p.key==="L"||p.key==="l")&&!p.ctrlKey&&!p.shiftKey&&!p.altKey){const z=document.activeElement;if(!!z&&(z.tagName==="INPUT"&&z.type!=="range"&&z.type!=="checkbox"&&z.type!=="radio"||z.tagName==="TEXTAREA"||z.isContentEditable))return;p.preventDefault(),p.stopPropagation(),Lf();return}if((p.key==="E"||p.key==="e")&&!p.ctrlKey&&!p.shiftKey&&!p.altKey){const z=document.activeElement;if(!!z&&(z.tagName==="INPUT"&&z.type!=="range"&&z.type!=="checkbox"&&z.type!=="radio"||z.tagName==="TEXTAREA"||z.isContentEditable))return;p.preventDefault(),p.stopPropagation(),Xt||zo(!0);return}if(p.key==="O"||p.key==="o"){const z=document.activeElement;if(!!z&&(z.tagName==="INPUT"&&z.type!=="range"&&z.type!=="checkbox"&&z.type!=="radio"||z.tagName==="TEXTAREA"||z.isContentEditable))return;p.preventDefault(),p.stopPropagation();const ve=xo[0];if(ve){Fn(ve.zoom),ci(ve.viewRotation??0),Br(ve.viewFlipX??!1),Ws(ve.isBottomView??!1),f(ve.transparency??50);const Re=ve.pcbReferenceX??ve.x??0,je=ve.pcbReferenceY??ve.y??0;let _e=0,fe=0;t?(_e=t.x,fe=t.y):r&&(_e=r.x,fe=r.y);const ye=Re-_e,pe=je-fe;(Math.abs(ye)>.001||Math.abs(pe)>.001)&&(t&&n({...t,x:t.x+ye,y:t.y+pe}),r&&o({...r,x:r.x+ye,y:r.y+pe}),Bi(Gt.map(ge=>({...ge,x:ge.x+ye,y:ge.y+pe}))),Kn(an.map(ge=>({...ge,x:ge.x+ye,y:ge.y+pe}))),Ie(Se.map(ge=>({...ge,x:ge.x+ye,y:ge.y+pe}))),lt(Ve.map(ge=>({...ge,x:ge.x+ye,y:ge.y+pe}))),St(Qe.map(ge=>({...ge,points:ge.points.map(Me=>({...Me,x:Me.x+ye,y:Me.y+pe}))}))),Ya(na.map(ge=>({...ge,x:ge.x+ye,y:ge.y+pe}))),$i(zt.map(ge=>({...ge,x:ge.x+ye,y:ge.y+pe})))),ys(ve.showTopImage),As(ve.showBottomImage),$s(ve.showViasLayer),Sa(ve.showTopTracesLayer),Gs(ve.showBottomTracesLayer),Xs(ve.showTopPadsLayer),no(ve.showBottomPadsLayer),ic(ve.showTopTestPointsLayer),rc(ve.showBottomTestPointsLayer),sa(ve.showTopComponents),Aa(ve.showBottomComponents),x(ve.showPowerLayer),Ai(ve.showGroundLayer),Hr(ve.showConnectionsLayer)}else Fn(1),ci(0),Br(!1),Ws(!1),f(0);Ni({x:0,y:0}),document.body&&(document.body.style.zoom="1"),document.documentElement&&(document.documentElement.style.zoom="1"),c("overlay"),Pn(new Set),jn(new Set),pn(new Set),xn(new Set),b("select");return}if((p.key==="Alt"||p.altKey)&&(Ih(!0),vo(!0)),p.key==="Escape"){p.preventDefault(),p.stopPropagation(),Qd(),Sd(!1),Zu(!1),vu(!1),Ge(!1),Ma(!1),Up(null);return}if(p.key==="Enter"&&_==="draw"&&ot==="trace"){rh();return}if((p.key==="Delete"||p.key==="Backspace")&&(li.size>0||gn.size>0||ui.size>0||hi.size>0)){if(p.preventDefault(),p.stopPropagation(),Sn(Qe,Gt,an,Se,Ve),li.size>0){const z=Qe.filter(_e=>li.has(_e.id)),Pe=Ui&&z.some(_e=>_e.type==="via"),ve=ws&&z.some(_e=>_e.type==="trace"),Re=hr&&z.some(_e=>_e.type==="pad"),je=Ps&&z.some(_e=>_e.type==="testPoint");Pe?alert("Cannot delete: Vias are locked. Unlock vias to delete them."):ve?alert("Cannot delete: Traces are locked. Unlock traces to delete them."):Re?alert("Cannot delete: Pads are locked. Unlock pads to delete them."):je?alert("Cannot delete: Test points are locked. Unlock test points to delete them."):(St(_e=>_e.filter(fe=>!li.has(fe.id))),Pn(new Set))}gn.size>0&&(Or?alert("Cannot delete: Components are locked. Unlock components to delete them."):(Bi(z=>z.filter(Pe=>!gn.has(Pe.id))),Kn(z=>z.filter(Pe=>!gn.has(Pe.id))),jn(new Set))),ui.size>0&&(fi?alert("Cannot delete: Power nodes are locked. Unlock power nodes to delete them."):(Ie(z=>z.filter(Pe=>!ui.has(Pe.id))),pn(new Set))),hi.size>0&&(Ss?alert("Cannot delete: Ground nodes are locked. Unlock ground nodes to delete them."):(lt(z=>z.filter(Pe=>!hi.has(Pe.id))),xn(new Set)));return}if((p.key==="z"||p.key==="Z")&&(p.ctrlKey||p.metaKey)&&!p.shiftKey&&!p.altKey){const z=document.activeElement;if(!!z&&(z.tagName==="INPUT"&&z.type!=="range"&&z.type!=="checkbox"&&z.type!=="radio"||z.tagName==="TEXTAREA"||z.isContentEditable))return;p.preventDefault(),p.stopPropagation();const ve=si();if(ve){const Re=new Set(ve.drawingStrokes.map(ye=>ye.id));for(const ye of Qe)if(!Re.has(ye.id))for(const pe of ye.points)pe.id&&typeof pe.id=="number"&&Ag(pe.id);const je=new Set([...ve.componentsTop.map(ye=>ye.id),...ve.componentsBottom.map(ye=>ye.id)]);for(const ye of[...Gt,...an])if(!je.has(ye.id)){for(const pe of ye.pinConnections)if(pe&&pe.trim()!==""){const ge=parseInt(pe,10);!isNaN(ge)&&ge>0&&Ag(ge)}}const _e=new Set(ve.powerSymbols.map(ye=>ye.id));for(const ye of Se)!_e.has(ye.id)&&ye.pointId&&typeof ye.pointId=="number"&&Ag(ye.pointId);const fe=new Set(ve.groundSymbols.map(ye=>ye.id));for(const ye of Ve)!fe.has(ye.id)&&ye.pointId&&typeof ye.pointId=="number"&&Ag(ye.pointId);St(ve.drawingStrokes),Bi(ve.componentsTop),Kn(ve.componentsBottom),Ie(ve.powerSymbols),lt(ve.groundSymbols),Kt([])}return}if((p.key==="c"||p.key==="C")&&(p.ctrlKey||p.metaKey)&&!p.shiftKey&&!p.altKey){const z=document.activeElement;if(!!z&&(z.tagName==="INPUT"&&z.type!=="range"&&z.type!=="checkbox"&&z.type!=="radio"||z.tagName==="TEXTAREA"||z.isContentEditable))return;if(gn.size===1){p.preventDefault(),p.stopPropagation();const ve=Array.from(gn)[0],Re=[...Gt,...an].find(je=>je.id===ve);Re&&(Mh(Re),console.log("Component copied:",Re.id,Re.designator))}return}if((p.key==="v"||p.key==="V")&&(p.ctrlKey||p.metaKey)&&!p.shiftKey&&!p.altKey){const z=document.activeElement;if(!!z&&(z.tagName==="INPUT"&&z.type!=="range"&&z.type!=="checkbox"&&z.type!=="radio"||z.tagName==="TEXTAREA"||z.isContentEditable))return;if(qo&&!Or){p.preventDefault(),p.stopPropagation();const ve=[...Gt,...an];let Re;lr?Re=Qf():Re={...gr.current};let je;if(qo.designator){const pe=qo.designator.match(/^([A-Za-z]+)(\d+)$/);pe?je=pe[1]:je=lm(qo.componentType)}else je=lm(qo.componentType);const _e=f5(je,ve,Re),fe=`${je}${_e}`;if(lr){const pe=Qf();lx(je,_e,pe)}else gr.current[je]=Math.max(gr.current[je]||0,_e);const ye={...qo,id:a2("comp"),designator:fe,pinConnections:new Array(qo.pinCount).fill(""),pinPolarities:qo.pinPolarities?new Array(qo.pinCount).fill(""):void 0,x:qo.x+5,y:qo.y+5};qo.pinNames&&(ye.pinNames=[...qo.pinNames]),ye.layer==="top"?Bi(pe=>[...pe,ye]):Kn(pe=>[...pe,ye]),bt(),jn(new Set([ye.id])),console.log("Component pasted:",ye.id,ye.designator)}return}if(p.code==="KeyV"&&p.altKey&&!p.ctrlKey&&!p.shiftKey&&!D){const z=document.activeElement;if(!!z&&(z.tagName==="INPUT"&&z.type!=="range"&&z.type!=="checkbox"&&z.type!=="radio"||z.tagName==="TEXTAREA"||z.isContentEditable))return;p.preventDefault(),p.stopPropagation(),sc(!1),qr(!0);return}if(p.code==="KeyP"&&p.altKey&&!p.ctrlKey&&!p.shiftKey&&!D){const z=document.activeElement;if(!!z&&(z.tagName==="INPUT"&&z.type!=="range"&&z.type!=="checkbox"&&z.type!=="radio"||z.tagName==="TEXTAREA"||z.isContentEditable))return;p.preventDefault(),p.stopPropagation(),sc(!0),qr(!0);return}if((p.key==="a"||p.key==="A")&&!p.ctrlKey&&!p.altKey&&!p.shiftKey&&!D){const z=document.activeElement;if(!!z&&(z.tagName==="INPUT"&&z.type!=="range"&&z.type!=="checkbox"&&z.type!=="radio"||z.tagName==="TEXTAREA"||z.isContentEditable))return;if(gn.size>0){p.preventDefault(),p.stopPropagation();const ve=Array.from(gn),Re=ve[ve.length-1];let je=null,_e=null;je=Gt.find(fe=>fe.id===Re)||null,je?_e="top":(je=an.find(fe=>fe.id===Re)||null,je&&(_e="bottom")),je&&_e&&Eo(je,_e)}return}if(!p.ctrlKey&&!p.altKey){const z=document.activeElement;if(!(!!z&&(z.tagName==="INPUT"&&z.type!=="range"&&z.type!=="checkbox"&&z.type!=="radio"||z.tagName==="TEXTAREA"||z.isContentEditable)))switch(p.key){case"s":case"S":p.preventDefault(),bt(),Qd();return;case"b":case"B":p.preventDefault(),bt(),wn.length===1?(Ke(wn[0].id),b("power"),Ge(!1),x(!0)):wn.length>1?Ge(!0):(Ge(!0),b("power"),x(!0));return;case"g":case"G":p.preventDefault(),bt(),j.length===1?(Gn(j[0].id),b("ground"),In(!1),Ai(!0)):j.length>1?In(!0):(In(!0),b("ground"),Ai(!0));return;case"v":case"V":p.preventDefault(),bt(),Zt("via"),b("draw"),$s(!0);return;case"p":case"P":p.preventDefault(),bt(),Zt("pad"),b("draw");return;case"y":case"Y":p.preventDefault(),bt(),Zt("testPoint"),b("draw");return;case"t":case"T":p.preventDefault(),bt(),Zt("trace"),b("draw");return;case"c":case"C":p.preventDefault(),bt(),b("component"),Zd.current?Kd(Zd.current):Kd(null);return;case"e":case"E":p.preventDefault(),bt(),b("erase");return;case"h":case"H":p.preventDefault(),bt(),b("pan");return;case"x":case"X":p.preventDefault(),bt(),b("center"),ms(!0),os.current&&clearTimeout(os.current),os.current=setTimeout(()=>{ms(!1),b("select"),ta(void 0)},2e3);return;case"m":case"M":if(!p.ctrlKey){p.preventDefault(),bt(),Ql(!1),b("magnify");return}break}}if(_==="transform"&&Ut){if(!(p.key==="ArrowLeft"||p.key==="ArrowRight"||p.key==="ArrowUp"||p.key==="ArrowDown"))return;p.preventDefault(),p.stopPropagation();const Pe=document.activeElement;if(Pe&&Pe.tagName==="INPUT"){const ve=Pe;ve.type==="radio"&&ve.blur()}if(Fi)return;if(ti==="nudge"){let ve=0,Re=0;switch(p.key){case"ArrowLeft":ve=-1;break;case"ArrowRight":ve=1;break;case"ArrowUp":Re=-1;break;case"ArrowDown":Re=1;break;default:return}Ut==="top"&&t?n(je=>je?{...je,x:je.x+ve,y:je.y+Re}:null):Ut==="bottom"&&r?o(je=>je?{...je,x:je.x+ve,y:je.y+Re}:null):Ut==="both"&&(t&&n(je=>je?{...je,x:je.x+ve,y:je.y+Re}:null),r&&o(je=>je?{...je,x:je.x+ve,y:je.y+Re}:null))}else if(ti==="scale"){let ve=0;switch(p.key){case"ArrowUp":ve=.01;break;case"ArrowDown":ve=-.01;break;case"ArrowRight":ve=.001;break;case"ArrowLeft":ve=-.001;break;default:return}if(Ut==="top"){t&&n(Re=>Re?{...Re,scale:Math.max(.1,Math.min(3,Re.scale+ve))}:null);return}if(Ut==="bottom"){r&&o(Re=>Re?{...Re,scale:Math.max(.1,Math.min(3,Re.scale+ve))}:null);return}if(Ut==="both"){t&&n(Re=>Re?{...Re,scale:Math.max(.1,Math.min(3,Re.scale+ve))}:null),r&&o(Re=>Re?{...Re,scale:Math.max(.1,Math.min(3,Re.scale+ve))}:null);return}}else if(ti==="rotate"){let ve=0;switch(p.key){case"ArrowUp":ve=1;break;case"ArrowDown":ve=-1;break;case"ArrowRight":ve=.1;break;case"ArrowLeft":ve=-.1;break;default:return}if(Ut==="top"){t&&n(Re=>Re?{...Re,rotation:Re.rotation+ve}:null);return}if(Ut==="bottom"){r&&o(Re=>Re?{...Re,rotation:Re.rotation+ve}:null);return}if(Ut==="both"){t&&n(Re=>Re?{...Re,rotation:Re.rotation+ve}:null),r&&o(Re=>Re?{...Re,rotation:Re.rotation+ve}:null);return}}else if(ti==="slant"){let ve=0,Re=0;switch(p.key){case"ArrowUp":Re=-.5;break;case"ArrowDown":Re=.5;break;case"ArrowLeft":ve=-.5;break;case"ArrowRight":ve=.5;break}if(ve!==0||Re!==0){const je=cu,_e=fe=>Math.max(-.7,Math.min(.7,fe));if(Ut==="top"){t&&n(fe=>fe?{...fe,skewX:_e((fe.skewX||0)+je(ve)),skewY:_e((fe.skewY||0)+je(Re))}:null);return}if(Ut==="bottom"){r&&o(fe=>fe?{...fe,skewX:_e((fe.skewX||0)+je(ve)),skewY:_e((fe.skewY||0)+je(Re))}:null);return}if(Ut==="both"){t&&n(fe=>fe?{...fe,skewX:_e((fe.skewX||0)+je(ve)),skewY:_e((fe.skewY||0)+je(Re))}:null),r&&o(fe=>fe?{...fe,skewX:_e((fe.skewX||0)+je(ve)),skewY:_e((fe.skewY||0)+je(Re))}:null);return}}}else if(ti==="keystone"){let ve=0,Re=0;switch(p.key){case"ArrowUp":Re=-.5;break;case"ArrowDown":Re=.5;break;case"ArrowLeft":ve=-.5;break;case"ArrowRight":ve=.5;break}if(ve!==0||Re!==0){const je=cu,_e=fe=>Math.max(-.35,Math.min(.35,fe));if(Ut==="top"){t&&n(fe=>fe?{...fe,keystoneH:_e((fe.keystoneH||0)+je(ve)),keystoneV:_e((fe.keystoneV||0)+je(Re))}:null);return}if(Ut==="bottom"){r&&o(fe=>fe?{...fe,keystoneH:_e((fe.keystoneH||0)+je(ve)),keystoneV:_e((fe.keystoneV||0)+je(Re))}:null);return}if(Ut==="both"){t&&n(fe=>fe?{...fe,keystoneH:_e((fe.keystoneH||0)+je(ve)),keystoneV:_e((fe.keystoneV||0)+je(Re))}:null),r&&o(fe=>fe?{...fe,keystoneH:_e((fe.keystoneH||0)+je(ve)),keystoneV:_e((fe.keystoneV||0)+je(Re))}:null);return}}}}else{const z=p.target;if(z.tagName==="INPUT"&&z.type==="range"){const Pe=z,ve=Number(Pe.value),Re=Number(Pe.min),je=Number(Pe.max),_e=Number(Pe.step)||1;switch(p.key){case"ArrowLeft":p.preventDefault();const fe=Math.max(Re,ve-_e);Pe.value=fe.toString(),Pe.dispatchEvent(new Event("input",{bubbles:!0}));break;case"ArrowRight":p.preventDefault();const ye=Math.min(je,ve+_e);Pe.value=ye.toString(),Pe.dispatchEvent(new Event("input",{bubbles:!0}));break}}}},[_,Ut,ti,t,r,li,gn,ui,hi,Qe,Gt,an,S,P,wn,ot,rh,Qn,O,W,J,Ce,Qd,Bi,Kn,si,St,Ie,lt,Se,Ve,Gd,Dc,xo,_t,Xn,ri,ba,h,Fn,ci,Br,Ws,f,n,o,Ya,$i,Ni,c,Pn,jn,pn,xn,b,na,zt,Ur,zl,Ar,Cr,cs,Ys,tr,So,Uo,Vi,Ks,Ha,mr,yr,ys,As,$s,Sa,Gs,Xs,no,ic,rc,sa,Aa,x,Ai,Hr,sc,qr,Eo]);Dt.useEffect(()=>{_!=="transform"&&zi(null)},[_]),Dt.useEffect(()=>{window.addEventListener("keydown",Uh,!0);const p=C=>{C.key==="Alt"&&(Ih(!1),vo(!1),_c(null))};return window.addEventListener("keyup",p,!0),()=>{window.removeEventListener("keydown",Uh,!0),window.removeEventListener("keyup",p,!0)}},[Uh,ui,hi,fi,fi,S,P,Bh,Fh,Qd,gn,Gt,an,Bi,Kn,xo,md,_]);const ed=U.useCallback(()=>{gr.current={},Y("#AA4499"),I("#F781BF"),Z(6),ie(6),pt("trace","#AA4499","top"),pt("trace","#F781BF","bottom"),it("trace",6,"top"),it("trace",6,"bottom"),se("#0072B2"),ue("#56B4E9"),L(18),ee(18),pt("pad","#0072B2","top"),pt("pad","#56B4E9","bottom"),it("pad",18,"top"),it("pad",18,"bottom"),Mt("#6A3D9A"),jt("#9467BD"),Yt(18),on(18),pt("component","#6A3D9A","top"),pt("component","#9467BD","bottom"),it("component",18,"top"),it("component",18,"bottom"),Us("top"),q("#AA4499"),X(6),Ro([{id:"powerbus-default",name:"+5VDC",voltage:"+5",color:"#ff0000"}]),te([{id:"groundbus-circuit",name:"GND",color:"#000000"}]),it("power",18),it("ground",18),Qi(!1),Lr(!1),ol(!1),ma(!1),Za(!1),po(!1),Ft("top"),b("select"),f(50),y(!1),c("overlay"),ax(),_i()},[pt,it,_i]),Cd=U.useCallback(()=>{Jr(null),Kl(null),io&&(io.current=null),pc&&(pc.current=null),br(""),za("pcb_project"),wa(!1),ul(null),to(""),hl([]),Fo(-1),Wo&&(Wo.current=""),pr.current=!1,eo(!1),Ws(!1),yo(null),Hi(null),Zi.current&&(clearInterval(Zi.current),Zi.current=null),n(null),o(null),_i(),St([]),Ya([]),$i([]),Tl([]),ho([]),Kt([]),Jt.current=[],Bi([]),Kn([]),Xa(null),rl(null),Ie([]),lt([]),ln(null),Ro([{id:"powerbus-default",name:"+5VDC",voltage:"+5",color:"#ff0000"}]),te([{id:"groundbus-circuit",name:"GND",color:"#000000"}]),Pn(new Set),jn(new Set),pn(new Set),xn(new Set),ga(!1),En([]),c("overlay"),Fn(1),$a(0,0),Wa(!0),Ft("top"),Ll({}),ms(!1),os.current&&(clearTimeout(os.current),os.current=null),zi(null),Lt(!1),Et(null),vi("nudge"),T(!1),f(50),y(!1),v(2e3),Qi(!1),Lr(!1),fo(!1),al(!1),ol(!1),ma(!1),Za(!1),po(!1),ys(!0),As(!0),$s(!0),Sa(!0),Gs(!0),Xs(!0),no(!0),ic(!0),rc(!0),sa(!0),Aa(!0),x(!0),Ai(!0),Hr(!0),pi(!0),b("select"),Zt("trace"),Us("top"),Pa("top"),Qo("top"),fa("top"),Ea.current="top",el.current="top",tl.current="top",Ga.current="top",gr.current={},Vt(!0),Dn(!1),ax(),Bn.initialize(),Ja(null),ll({visible:!1,text:""}),mo({visible:!1,title:"",message:""}),fs({visible:!1}),La({visible:!1}),Io({visible:!1,projectName:"",locationPath:"",locationHandle:null}),jr({visible:!1,filename:"",locationPath:"",locationHandle:null}),Lo({visible:!1,interval:null}),hs({visible:!1,source:"new",interval:5}),Ma(!1),ne(!1),hn(!1),nr(!1),Wd(!1),Ii(!1),aa(!1),Es(!1),mu(null),_c(null),ec(null),kc(!1),Oo.current=null,Jl.current=null,Bt(!1),un(null),yn.current=0,_n.current=!1,console.log("Project closed: All state cleared and browser permissions released")},[Jr,Kl,br,za,wa,ul,to,hl,Fo,n,o,St,Kt,Ya,$i,Tl,ho,Bi,Kn,Xa,rl,Ie,lt,ln,Ro,te,Pn,jn,pn,xn,ga,En,c,Fn,Po,Wa,Ft,Ll,ms,zi,Lt,Et,vi,T,f,y,v,Qi,Lr,fo,al,ol,ma,Za,po,ys,As,$s,Sa,Gs,Xs,no,ic,rc,sa,Aa,x,Ai,Hr,b,Zt,Us,Pa,Qo,fa,Vt,Dn,Ja,ll,mo,fs,Io,jr,Lo,hs,_i,Ma,ne,hn,nr,Wd,Ii,aa,mu,_c,ec,kc,Bt,un]),hc=U.useCallback(()=>{ed(),setTimeout(()=>{Fn(1),Ni({x:0,y:0}),document.body&&(document.body.style.zoom="1"),document.documentElement&&(document.documentElement.style.zoom="1"),Pn(new Set),jn(new Set),pn(new Set),xn(new Set)},200)},[ed,Fn,Ni]);Dt.useEffect(()=>{hc()},[]),Dt.useEffect(()=>{if(!Qa.visible)return;const p=[];li.size>0,li.size===0&&gn.size===0&&ui.size===0&&hi.size===0&&p.push(`
No objects selected.`);const C=p.join(`
`);ll(D=>({...D,text:C}))},[Qa.visible,li,gn,ui,hi,Qe,Gt,an,S,P,wn]),Dt.useEffect(()=>{const p=C=>{const D=ur.current;if(D&&!(C.target instanceof Node&&D.contains(C.target))){if(rh(),bu){const $=Yd.current;(!$||!(C.target instanceof Node)||!$.contains(C.target))&&Sd(!1)}if(fd){const $=Il.current;!C.target?.closest('button[title="Color Picker"]')&&(!$||!(C.target instanceof Node)||!$.contains(C.target))&&Ma(!1)}}};return document.addEventListener("mousedown",p,!0),()=>document.removeEventListener("mousedown",p,!0)},[rh,bu,Ku,fd]);const _u=p=>{if(!p.current)return{top:0,left:0};const C=p.current.getBoundingClientRect(),D=Yc.current?.getBoundingClientRect();return D?{top:C.top-D.top,left:C.left-D.left+C.width+4}:{top:0,left:0}},ah=U.useCallback(()=>{Yd.current&&nh.current&&requestAnimationFrame(()=>{if(Yd.current&&nh.current){const p=_u(nh);Yd.current.style.top=`${p.top}px`,Yd.current.style.left=`${p.left}px`}})},[]),Hh=U.useCallback(()=>{wu.current&&Su.current&&requestAnimationFrame(()=>{if(wu.current&&Su.current){const p=_u(Su);wu.current.style.top=`${p.top}px`,wu.current.style.left=`${p.left}px`}})},[]),fc=U.useCallback(()=>{Xd.current&&Au.current&&requestAnimationFrame(()=>{if(Xd.current&&Au.current){const p=_u(Au);Xd.current.style.top=`${p.top}px`,Xd.current.style.left=`${p.left}px`}})},[]);Dt.useEffect(()=>{bu&&ah()},[bu,ah]),Dt.useEffect(()=>{Ku&&Hh()},[Ku,Hh]),Dt.useEffect(()=>{Ju&&fc()},[Ju,fc]),Dt.useEffect(()=>{if(qe&&Qu.current&&Lh.current){const p=_u(Lh);Qu.current.style.top=`${p.top}px`,Qu.current.style.left=`${p.left}px`}},[qe]),Dt.useEffect(()=>{if(fn&&eh.current&&Qc.current){const p=_u(Qc);eh.current.style.top=`${p.top}px`,eh.current.style.left=`${p.left}px`}},[fn]),Dt.useEffect(()=>{const p=C=>{if(!as)return;const D=document.querySelector("[data-component-editor-dialog]");if(D&&C.target instanceof Node&&D.contains(C.target)){const We=C.target;if(We.tagName==="BUTTON"||We.tagName==="INPUT"||We.closest("button")||We.closest("input"))return}const $=ur.current;if(!$)return;const de=$.getBoundingClientRect(),be=C.clientX,z=C.clientY;if(be<de.left||be>de.right||z<de.top||z>de.bottom)return;const Pe=$.width/de.width,ve=$.height/de.height,Re=be-de.left,je=z-de.top,_e=Re*Pe,fe=je*ve,ye=_e-5,pe=fe-5,ge=Jf(ye,pe,or,_t,Xn,ri),Me=ge.x,De=ge.y;let $e=1/0,ht=null,xt=null;const Tt=Math.max(6/_t,4),qt=[...Gt,...an].find(We=>We.id===as.componentId)?.layer||"top";for(const We of Qe)if((We.type==="via"||We.type==="pad")&&We.points.length>0){if(We.type==="pad"&&(We.layer||"top")!==qt)continue;const Ye=We.points[0],Ue=Math.max(1,We.size/2),at=Math.hypot(Ye.x-Me,Ye.y-De),dt=Math.max(Ue,Tt);at<=dt&&at<$e&&($e=at,ht=Ye.id??null,xt=We)}if(ht!=null&&xt){console.log(`
[PIN CONNECTION - DOCUMENT HANDLER] Found via!`),console.log(`  Point ID: ${ht}`),console.log(`  Connecting pin ${as.pinIndex+1} of component ${as.componentId}`);const We=String(ht),Ye=as.pinIndex,Ue=as.componentId,at=Gt.find(Rt=>Rt.id===Ue),dt=an.find(Rt=>Rt.id===Ue);if(at){const Rt=Qe;Bi(tn=>{const kn=tn.find(It=>It.id===Ue);if(!kn)return tn;const Yn=kn.pinConnections||[],zn=Yn.length>0?[...Yn]:new Array(kn.pinCount).fill("");let Un;if(zn.length!==kn.pinCount){Un=new Array(kn.pinCount).fill("");for(let It=0;It<Math.min(zn.length,kn.pinCount);It++)Un[It]=zn[It]||""}else Un=[...zn];Un[Ye]=We,console.log(`Updated pin ${Ye} with value: ${We}`),console.log("New pinConnections:",Un);const ii=tn.find(It=>It.id===Ue),nn=ii?qm(ii,Un,Rt):null;return tn.map(It=>{if(It.id===Ue){const An={...It,pinConnections:Un};return nn&&(An.pinPolarities=nn),An}return It})})}else if(dt){const Rt=Qe;Kn(tn=>{const kn=tn.find(It=>It.id===Ue);if(!kn)return tn;const Yn=kn.pinConnections||[],zn=Yn.length>0?[...Yn]:new Array(kn.pinCount).fill("");let Un;if(zn.length!==kn.pinCount){Un=new Array(kn.pinCount).fill("");for(let It=0;It<Math.min(zn.length,kn.pinCount);It++)Un[It]=zn[It]||""}else Un=[...zn];Un[Ye]=We,console.log(`Updated pin ${Ye} with value: ${We}`),console.log("New pinConnections:",Un);const ii=tn.find(It=>It.id===Ue),nn=ii?qm(ii,Un,Rt):null;return tn.map(It=>{if(It.id===Ue){const An={...It,pinConnections:Un};return nn&&(An.pinPolarities=nn),An}return It})})}setTimeout(()=>{rl(null)},0)}else console.log("[PIN CONNECTION - DOCUMENT HANDLER] No via found at click location")};if(as)return document.addEventListener("mousedown",p,!0),()=>document.removeEventListener("mousedown",p,!0)},[as,Gt,an,Qe,_t,or.x,or.y,Xn,ri]);const Va=U.useCallback((p,C,D,$)=>{const de=window.innerWidth,be=window.innerHeight,z=10;let Pe=Math.max(z,Math.min(p,de-D-z)),ve=Math.max(z,Math.min(C,be-$-z));return{x:Pe,y:ve}},[]);Dt.useEffect(()=>{if(!sl)return;const p=D=>{if(!Yl)return;const $={x:D.clientX-Yl.x,y:D.clientY-Yl.y},de=Va($.x,$.y,250,window.innerHeight*.4);Ka(de),localStorage.setItem("componentDialogPosition",JSON.stringify(de))},C=()=>{Ac(!1),kl(null)};return document.addEventListener("mousemove",p),document.addEventListener("mouseup",C),()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",C)}},[sl,Yl,Va]),Dt.useEffect(()=>{if(!Gi)return;const p=D=>{if(!Er)return;const $={x:D.clientX-Er.x,y:D.clientY-Er.y},de=Va($.x,$.y,250,window.innerHeight*.4);Tr(de),localStorage.setItem("detailedInfoDialogPosition",JSON.stringify(de))},C=()=>{Cs(!1),Yi(null)};return document.addEventListener("mousemove",p),document.addEventListener("mouseup",C),()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",C)}},[Gi,Er,Va]),Dt.useEffect(()=>{if(!xr)return;const p=D=>{if(!Ls)return;const $={x:D.clientX-Ls.x,y:D.clientY-Ls.y};ts($),localStorage.setItem("notesDialogPosition",JSON.stringify($))},C=()=>{qi(!1),ns(null)};return document.addEventListener("mousemove",p),document.addEventListener("mouseup",C),()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",C)}},[xr,Ls]),Dt.useEffect(()=>{if(es&&Mr===null){const p=localStorage.getItem("notesDialogPosition");if(p)try{const C=JSON.parse(p);ts(C)}catch{ts({x:window.innerWidth-550,y:100})}else ts({x:window.innerWidth-550,y:100})}},[es,Mr]),Dt.useEffect(()=>{if(!ds)return;const p=D=>{if(!pl)return;const $={x:D.clientX-pl.x,y:D.clientY-pl.y};Ms($),localStorage.setItem("projectNotesDialogPosition",JSON.stringify($))},C=()=>{Bl(!1),xd(null)};return document.addEventListener("mousemove",p),document.addEventListener("mouseup",C),()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",C)}},[ds,pl]),Dt.useEffect(()=>{if(!gl)return;const p=D=>{if(!bd)return;const $={x:D.clientX-bd.x,y:D.clientY-bd.y};Nc($),localStorage.setItem("testPointsDialogPosition",JSON.stringify($))},C=()=>{Xu(!1),Ud(null)};return document.addEventListener("mousemove",p),document.addEventListener("mouseup",C),()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",C)}},[gl,bd]),Dt.useEffect(()=>{if(vr&&jc===null){const p=localStorage.getItem("testPointsDialogPosition");if(p)try{const C=JSON.parse(p);Nc(C)}catch{Nc({x:100,y:100})}else Nc({x:100,y:100})}},[vr,jc]),Dt.useEffect(()=>{if(Wi&&oa===null){const p=localStorage.getItem("projectNotesDialogPosition");if(p)try{const C=JSON.parse(p);Ms(C)}catch{Ms({x:100,y:100})}else Ms({x:100,y:100})}},[Wi,oa]);const Lf=U.useCallback(()=>{aa(!0)},[]),Mf=U.useCallback(()=>{pu(!0)},[]);Dt.useEffect(()=>{if(Vs&&Vs.visible&&Da===null){const p=localStorage.getItem("componentDialogPosition");let C;if(p)try{const D=JSON.parse(p);C=Va(D.x,D.y,250,window.innerHeight*.4),Ka(C)}catch{C=Va(window.innerWidth-280,90,250,window.innerHeight*.4),Ka(C)}else C=Va(window.innerWidth-280,90,250,window.innerHeight*.4),Ka(C)}else!Vs||Vs.visible},[Vs,Da,Va]),Dt.useEffect(()=>{if(Qa.visible&&ai===null){const p=localStorage.getItem("detailedInfoDialogPosition");let C;if(p)try{const D=JSON.parse(p);C=Va(D.x,D.y,400,window.innerHeight*.8),Tr(C)}catch{C=Va(window.innerWidth-450,90,400,window.innerHeight*.8),Tr(C)}else C=Va(window.innerWidth-450,90,400,window.innerHeight*.8),Tr(C)}else Qa.visible},[Qa.visible,ai,Va]),Dt.useEffect(()=>{const p=()=>{if(Da){const C=Va(Da.x,Da.y,250,window.innerHeight*.4);(C.x!==Da.x||C.y!==Da.y)&&(Ka(C),localStorage.setItem("componentDialogPosition",JSON.stringify(C)))}if(ai){const C=Va(ai.x,ai.y,400,window.innerHeight*.8);(C.x!==ai.x||C.y!==ai.y)&&(Tr(C),localStorage.setItem("detailedInfoDialogPosition",JSON.stringify(C)))}};return window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[Da,ai,Va]);const td=U.useCallback(p=>{switch(p){case"transparency":f(50);break;case"brushSize":X(3);break}},[]),Vh=Dt.useRef(A);Dt.useEffect(()=>{Vh.current=A},[A]),Dt.useEffect(()=>{if(m){Zl.current=performance.now(),f(0);const p=C=>{const D=Zl.current||C,$=Vh.current,de=(C-D)%$/$,be=1-Math.abs(1-2*de);f(Math.round(be*100)),Dl.current=requestAnimationFrame(p)};Dl.current=requestAnimationFrame(p)}return()=>{Dl.current&&(cancelAnimationFrame(Dl.current),Dl.current=null)}},[m]),Dt.useEffect(()=>{if(_==="center"){ta(x5());return}const p=_==="erase"?"erase":_==="magnify"?"magnify":_==="ground"?"ground":_==="power"?"power":_==="component"?"component":_==="draw"?ot==="via"?"via":ot==="pad"?"pad":ot==="testPoint"?"testPoint":"trace":"default";if(p==="default"){ta(void 0);return}const C=_t;let D;if(p==="magnify")D=18;else if(p==="component"){const fe=(wi||"top")==="top"?"componentTop":"componentBottom",pe=Bn.get(fe).size||yy.DEFAULT_SIZE;D=Math.max(16,Math.round(pe*C))}else if(p==="trace"){const fe=(Qn||"top")==="top"?"traceTop":"traceBottom",pe=Bn.get(fe).size||6;D=Math.max(6,Math.round(pe*C))}else if(p==="via"){const fe=Bn.get("via").size||6;D=Math.max(6,Math.round(fe*C))}else if(p==="pad"){const fe=(Ti||"top")==="top"?"padTop":"padBottom",pe=Bn.get(fe).size||6;D=Math.max(6,Math.round(pe*C))}else if(p==="testPoint"){const fe=(On||"top")==="top"?"testPointTop":"testPointBottom",pe=Bn.get(fe).size||18;D=Math.max(12,Math.round(pe*C))}else p==="power"||p==="ground"?D=Math.max(12,Math.round(G*C)):D=Math.max(6,Math.round(G*C));const de=D+4*2+(p==="magnify"?8:0),be=document.createElement("canvas");be.width=de,be.height=de;const z=be.getContext("2d");if(!z){ta(void 0);return}const Pe=de/2,ve=de/2,Re=D/2;if(z.clearRect(0,0,de,de),p==="via"){const _e=Re,fe=Re*.5,ye=Re*.7,ge=Bn.get("via").color;z.fillStyle=ge,z.beginPath(),z.arc(Pe,ve,_e,0,qa),z.arc(Pe,ve,fe,0,qa),z.fill("evenodd"),z.strokeStyle="#808080",z.lineWidth=1,z.beginPath(),z.moveTo(Pe-ye,ve),z.lineTo(Pe+ye,ve),z.stroke(),z.beginPath(),z.moveTo(Pe,ve-ye),z.lineTo(Pe,ve+ye),z.stroke()}else if(p==="pad"){const _e=Ti==="top"?"padTop":"padBottom",ye=Bn.get(_e).color,ge=D/2,Me=ge*2,De=Me*.5,$e=ge*.7;z.fillStyle=ye,z.beginPath(),z.rect(Pe-ge,ve-ge,Me,Me),z.rect(Pe-De/2,ve-De/2,De,De),z.fill("evenodd"),z.strokeStyle="#808080",z.lineWidth=1,z.beginPath(),z.moveTo(Pe-$e,ve),z.lineTo(Pe+$e,ve),z.stroke(),z.beginPath(),z.moveTo(Pe,ve-$e),z.lineTo(Pe,ve+$e),z.stroke()}else if(p==="trace"){const _e=Qn==="top"?"traceTop":"traceBottom",ye=Bn.get(_e).color;z.fillStyle=ye,z.beginPath(),z.arc(Pe,ve,Re,0,qa),z.fill()}else if(p==="testPoint"){ta(b5(D));return}else if(p==="erase"){const _e=G*C,fe=Math.max(_e*.75,8),ye=Math.max(_e*.5,6),pe=Math.max(_e*.2,2);z.save(),z.translate(Pe,ve),z.rotate(cu(-35)),z.fillStyle="#f5a3b3",z.strokeStyle="#111",z.lineWidth=1.5;const ge=1.5,Me=-fe/2,De=-ye/2;z.beginPath(),z.moveTo(Me+ge,De),z.lineTo(Me+fe-ge,De),z.quadraticCurveTo(Me+fe,De,Me+fe,De+ge),z.lineTo(Me+fe,De+ye-ge),z.quadraticCurveTo(Me+fe,De+ye,Me+fe-ge,De+ye),z.lineTo(Me+ge,De+ye),z.quadraticCurveTo(Me,De+ye,Me,De+ye-ge),z.lineTo(Me,De+ge),z.quadraticCurveTo(Me,De,Me+ge,De),z.closePath(),z.fill(),z.stroke(),z.fillStyle="#f18ea4",z.beginPath(),z.rect(-fe/2,ye/2-pe,fe,pe),z.fill(),z.restore()}else if(p==="magnify"){const _e=Re;z.strokeStyle="#111",z.lineWidth=2,z.beginPath(),z.arc(Pe-2,ve-2,_e,0,qa),z.stroke();const fe=Pe+_e*.6,ye=ve+_e*.6,pe=fe+6,ge=ye+6;z.beginPath(),z.moveTo(fe,ye),z.lineTo(pe,ge),z.stroke(),z.beginPath(),z.moveTo(Pe-6,ve-2),z.lineTo(Pe+2,ve-2),z.stroke(),Fa||(z.beginPath(),z.moveTo(Pe-2,ve-6),z.lineTo(Pe-2,ve+2),z.stroke())}else if(p==="ground"){const fe=(Ei?j.find(pe=>pe.id===Ei):null)?.color||"#000000";if(z.strokeStyle=fe,z.lineWidth=2,z.lineCap="round",Ei==="groundbus-earth"){const pe=Re*1.5,ge=pe*.9,Me=pe*.24,De=pe*1.6;z.beginPath(),z.moveTo(Pe,ve-ge/2),z.lineTo(Pe,ve+ge/2),z.stroke();for(let $e=0;$e<3;$e++){const ht=ve+ge/2+$e*Me,xt=De*(1-$e*.25);z.beginPath(),z.moveTo(Pe-xt/2,ht),z.lineTo(Pe+xt/2,ht),z.stroke()}}else{const pe=Re*.8;z.beginPath(),z.arc(Pe,ve,Re,0,qa),z.stroke(),z.beginPath(),z.moveTo(Pe,ve-Re-pe),z.lineTo(Pe,ve+Re+pe),z.stroke(),z.beginPath(),z.moveTo(Pe-Re-pe,ve),z.lineTo(Pe+Re+pe,ve),z.stroke()}}else if(p==="power"){const fe=(ct?wn.find(pe=>pe.id===ct):null)?.color||"#ff0000";z.strokeStyle=fe,z.lineWidth=2,z.lineCap="round";const ye=Re*.8;z.beginPath(),z.arc(Pe,ve,Re,0,qa),z.stroke(),z.beginPath(),z.moveTo(Pe,ve-Re-ye),z.lineTo(Pe,ve+Re+ye),z.stroke(),z.beginPath(),z.moveTo(Pe-Re-ye,ve),z.lineTo(Pe+Re+ye,ve),z.stroke()}else if(p==="component"){const fe=(wi||"top")==="top"?"componentTop":"componentBottom",pe=Bn.get(fe).color,ge=D,Me=ge/2;z.strokeStyle=pe,z.lineWidth=2,z.fillStyle="rgba(255,255,255,0.9)",z.beginPath(),z.rect(Pe-Me,ve-Me,ge,ge),z.fill(),z.stroke();const De=(()=>{const $e=Jc?.dataDrivenDefinition?.designator??Jc?.componentDefinition?.designator??Jc?.designator;return $e?$e.length<=3?$e:$e.substring(0,3):dc?Em(dc):"?"})();z.fillStyle=pe,z.font=`bold ${Math.max(8,ge*.35)}px sans-serif`,z.textAlign="center",z.textBaseline="middle",z.fillText(De,Pe,ve)}const je=`url(${be.toDataURL()}) ${Math.round(Pe)} ${Math.round(ve)}, crosshair`;ta(je)},[_,ot,B,G,_t,Fa,dc,Jc,ct,Ei,wn,j,$n,Qn,Ti,On,wi,dr.toolInstanceId]),Dt.useEffect(()=>{Tu()},[Tu]),Dt.useEffect(()=>{Tu()},[Ml.width,Ml.height]),Dt.useEffect(()=>{li.size===0&&_==="draw"&&ot==="trace"&&G>=1&&(sn==="top"?Z(G):ie(G))},[G,_,ot,sn,li]),Dt.useEffect(()=>{St(p=>p.map(C=>{if(C.type==="via"&&C.points.length>0&&C.points[0].id!==void 0){const D=C.points[0].id,$=Vo(D,wn);if(C.viaType!==$)return{...C,viaType:$}}else if(C.type==="pad"&&C.points.length>0&&C.points[0].id!==void 0){const D=C.points[0].id,$=yl(D,wn);if(C.padType!==$)return{...C,padType:$}}else if(C.type==="testPoint"&&C.points.length>0&&C.points[0].id!==void 0){const D=C.points[0].id,$=Ca(D,wn),de=$.includes("Power")?"power":$.includes("Ground")?"ground":$.includes("Signal")?"signal":"unknown";if(C.testPointType!==de)return{...C,testPointType:de}}return C}))},[S,P,wn,Vo,yl,Ca]);const Gp=U.useCallback(()=>{const p=ur.current;if(!p)return;const C=p.toDataURL("image/png"),D=window.open("","_blank");if(!D){alert("Please allow popups to print the canvas.");return}D.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>PCB Drawing</title>
          <style>
            @media print {
              @page {
                margin: 0;
                size: auto;
              }
              body {
                margin: 0;
                padding: 0;
              }
            }
            body {
              margin: 0;
              padding: 20px;
              display: flex;
              justify-content: center;
              align-items: center;
              background: white;
            }
            img {
              max-width: 100%;
              height: auto;
              display: block;
            }
          </style>
        </head>
        <body>
          <img src="${C}" alt="PCB Drawing" onload="window.setTimeout(function() { window.print(); }, 250);" />
        </body>
      </html>
    `),D.document.close()},[]);Dt.useEffect(()=>{const p=D=>{D.key==="Shift"&&Ql(!0)},C=D=>{D.key==="Shift"&&Ql(!1)};return window.addEventListener("keydown",p),window.addEventListener("keyup",C),()=>{window.removeEventListener("keydown",p),window.removeEventListener("keyup",C)}},[]);const oh=U.useCallback(p=>{if(p.size===0)return;const C=Array.from(p).map(D=>String(D));St(D=>D.map($=>{if($.type==="trace"){const de=$.points.filter(be=>be.id===void 0?!0:!p.has(be.id));return de.length<2?null:{...$,points:de}}return $}).filter($=>$!==null)),Bi(D=>D.map($=>{const de=$.pinConnections||[];if(de.some(z=>z&&C.includes(z))){const z=de.map(Pe=>Pe&&C.includes(Pe)?"":Pe);return{...$,pinConnections:z}}return $})),Kn(D=>D.map($=>{const de=$.pinConnections||[];if(de.some(z=>z&&C.includes(z))){const z=de.map(Pe=>Pe&&C.includes(Pe)?"":Pe);return{...$,pinConnections:z}}return $}))},[St,Bi,Kn]),ju=U.useRef(new Set);Dt.useEffect(()=>{const p=new Set;for(const D of Qe)if((D.type==="via"||D.type==="pad")&&D.points.length>0){const $=D.points[0].id;$!==void 0&&p.add($)}const C=new Set;for(const D of ju.current)p.has(D)||C.add(D);C.size>0&&oh(C),ju.current=p},[Qe,oh]),Dt.useEffect(()=>{St(p=>p.map(C=>{if(C.type==="via"&&C.points.length>0&&C.points[0].id!==void 0){const D=C.points[0].id,$=Vo(D,wn);if(C.viaType!==$)return{...C,viaType:$}}else if(C.type==="pad"&&C.points.length>0&&C.points[0].id!==void 0){const D=C.points[0].id,$=yl(D,wn);if(C.padType!==$)return{...C,padType:$}}else if(C.type==="testPoint"&&C.points.length>0&&C.points[0].id!==void 0){const D=C.points[0].id,$=Ca(D,wn),de=$.includes("Power")?"power":$.includes("Ground")?"ground":$.includes("Signal")?"signal":"unknown";if(C.testPointType!==de)return{...C,testPointType:de}}return C}))},[S,P,wn,Vo,yl,Ca]),Dt.useEffect(()=>{const p=C=>{wo.current&&(wo.current.contains(C.target)||Ja(null))};return document.addEventListener("click",p),()=>document.removeEventListener("click",p)},[]),Dt.useEffect(()=>{const p=(C,D)=>{const $=C.current;if(!$)return;const de=$.getContext("2d");if(!de)return;const be=$.width,z=$.height;if(de.clearRect(0,0,be,z),de.fillStyle="#fff",de.fillRect(0,0,be,z),D?.bitmap){const Pe=D.bitmap,ve=Math.min(be/Pe.width,z/Pe.height),Re=Math.max(1,Math.floor(Pe.width*ve)),je=Math.max(1,Math.floor(Pe.height*ve)),_e=Math.floor((be-Re)/2),fe=Math.floor((z-je)/2);de.drawImage(Pe,_e,fe,Re,je)}de.strokeStyle="#ddd",de.lineWidth=1,de.strokeRect(.5,.5,be-1,z-1)};p(tc,t),p(hu,r)},[t,r]),Dt.useEffect(()=>{const p=[],C=[],D=[],$=[];for(const de of Qe)if(de.type==="via"&&de.points.length>=1){const be=de.points[0],z={id:de.id,pointId:be.id,x:be.x,y:be.y,size:de.size,color:de.color};p.push(z)}else if(de.type==="pad"&&de.points.length>=1){const be=de.points[0],z={id:de.id,pointId:be.id,x:be.x,y:be.y,size:de.size,color:de.color,layer:de.layer||"top"};C.push(z)}else if(de.type==="trace"&&de.points.length>=2)for(let be=0;be<de.points.length-1;be++){const z=de.points[be],Pe=de.points[be+1],ve={id:de.id,startPointId:z.id,endPointId:Pe.id,x1:z.x,y1:z.y,x2:Pe.x,y2:Pe.y,size:de.size,color:de.color};de.layer==="top"?D.push(ve):$.push(ve)}Ya(p),$i(C),Tl(D),ho($)},[Qe]);const Rr=U.useRef(Qe);Rr.current=Qe;const nd=U.useCallback(()=>{const C=new Date().toISOString(),D=cx();return{project:{version:1,fileType:"PCB_REVERSE_ENGINEERING_AUTOSAVE",savedAt:C,view:{currentView:d,viewScale:_t,cameraWorldCenter:Di,showBothLayers:$l,selectedDrawingLayer:sn},images:{top:t?{name:t.name,width:t.width,height:t.height,filePath:t.filePath||t.name,x:t.x,y:t.y,scale:t.scale,rotation:t.rotation,flipX:t.flipX,flipY:t.flipY,skewX:t.skewX,skewY:t.skewY,keystoneV:t.keystoneV,keystoneH:t.keystoneH,brightness:t.brightness??100,contrast:t.contrast??100}:null,bottom:r?{name:r.name,width:r.width,height:r.height,filePath:r.filePath||r.name,x:r.x,y:r.y,scale:r.scale,rotation:r.rotation,flipX:r.flipX,flipY:r.flipY,skewX:r.skewX,skewY:r.skewY,keystoneV:r.keystoneV,keystoneH:r.keystoneH,brightness:r.brightness??100,contrast:r.contrast??100}:null},projectDirectoryName:io.current?io.current.name||null:Pi&&Pi.name||null,drawing:{drawingStrokes:Rr.current.filter(de=>!(de.type==="trace"&&de.points.length<2)),vias:na,tracesTop:uo,tracesBottom:Kr,componentsTop:Gt,componentsBottom:an,grounds:P,powers:S},powerBuses:wn,groundBuses:j,pointIdCounter:am(),designatorCounters:{...gr.current},autoAssignDesignators:en,useGlobalDesignatorCounters:lr,traceColors:{top:$n.get("trace")?.layerSettings.get("top")?.color||O,bottom:$n.get("trace")?.layerSettings.get("bottom")?.color||W},traceSizes:{top:$n.get("trace")?.layerSettings.get("top")?.size||J,bottom:$n.get("trace")?.layerSettings.get("bottom")?.size||Ce},padColors:{top:$n.get("pad")?.layerSettings.get("top")?.color||le,bottom:$n.get("pad")?.layerSettings.get("bottom")?.color||Ae},padSizes:{top:$n.get("pad")?.layerSettings.get("top")?.size||E,bottom:$n.get("pad")?.layerSettings.get("bottom")?.size||Q},componentColors:{top:$n.get("component")?.layerSettings.get("top")?.color||mt,bottom:$n.get("component")?.layerSettings.get("bottom")?.color||K},componentSizes:{top:$n.get("component")?.layerSettings.get("top")?.size||$t,bottom:$n.get("component")?.layerSettings.get("bottom")?.size||yt},testPointColors:{top:$n.get("testPoint")?.layerSettings.get("top")?.color||oe,bottom:$n.get("testPoint")?.layerSettings.get("bottom")?.color||re},testPointSizes:{top:$n.get("testPoint")?.layerSettings.get("top")?.size||Ee,bottom:$n.get("testPoint")?.layerSettings.get("bottom")?.size||Ze},componentConnectionColor:ze,componentConnectionSize:Ct,toolLayerDefaults:{trace:Qn,pad:Ti,testPoint:On,component:wi},toolSettings:{trace:$n.get("trace")?.settings||{color:"#ff0000",size:6},via:$n.get("via")?.settings||{color:"#ff0000",size:18},pad:$n.get("pad")?.settings||{color:"#ff0000",size:18},component:$n.get("component")?.settings||{color:"#ff0000",size:18},ground:$n.get("ground")?.settings||{color:"#000000",size:18},power:$n.get("power")?.settings||{color:"#ff0000",size:18},erase:$n.get("erase")?.settings||{color:"#f5a3b3",size:18}},locks:{areImagesLocked:Fi,areViasLocked:Ui,arePadsLocked:hr,areTracesLocked:ws,areComponentsLocked:Or,areGroundNodesLocked:Ss,arePowerNodesLocked:fi},visibility:{showViasLayer:Ar,showTopPadsLayer:Ys,showBottomPadsLayer:tr,showTopTracesLayer:Cr,showBottomTracesLayer:cs,showTopComponents:Vi,showBottomComponents:Ks,showPowerLayer:Ha,showGroundLayer:mr,showConnectionsLayer:yr,showTraceCornerDots:Vr},autoSave:{enabled:gs,interval:Nl,baseName:El},projectInfo:{name:Qr},projectNotes:Nn,homeViews:xo,toolInstances:Bn.getAll()},timestamp:D}},[d,_t,Di,$l,sn,t,r,Qe,na,uo,Kr,Gt,an,P,$n,Fi,Ui,hr,ws,Or,Ss,fi,wn,j,am,O,W,J,Ce,le,Ae,E,Q,mt,K,$t,yt,Qn,Ti,On,wi,gs,Nl,El,Qr,Ar,Ys,tr,Cr,cs,Vi,Ks,Ha,mr,yr,en,lr,Nn,xo]),Yp=U.useRef(nd);Yp.current=nd;const pc=U.useRef(Pl);pc.current=Pl;const Wo=U.useRef(El);Wo.current=El;const id=U.useRef(br);id.current=br;const If=U.useRef(Rl);If.current=Rl;const Ao=U.useRef([]);Ao.current=Bd;const Lc=U.useRef(-1);Lc.current=Fd;const io=U.useRef(null),lh=U.useRef(!1);Dt.useEffect(()=>{lh.current||(io.current=Pi)},[Pi]);const ch=U.useCallback(async()=>{console.log("Auto save: performAutoSave called");let p=pc.current||io.current,C=Wo.current;if(console.log(`Auto save: dirHandle=${p?`set (using ${pc.current?"autoSaveDirHandle":"projectDirHandle"})`:"missing"}, baseName=${C||"missing"}`),!p||!C){console.warn(`Auto save: Missing project directory handle (${!p}) or base name (${!C}). Please create a new project or open an existing project first.`),wa(!1),Zi.current&&(clearInterval(Zi.current),Zi.current=null);return}if(!pr.current){console.log("Auto save: Skipping - no changes since last save");return}const D=Rr.current,$=D.filter(je=>je.type==="trace"&&je.points.length<2);if($.length>0){console.log(`Auto save: Cleaning up ${$.length} single-point trace(s) before save`),$.forEach(_e=>console.log(`  - Removing single-point trace ${_e.id}`));const je=D.filter(_e=>!(_e.type==="trace"&&_e.points.length<2));St(je),Rr.current=je}console.log("Auto save: Starting save...");const{project:de,timestamp:be}=Yp.current(),Pe=`${fh(C)}_${be}.json`,ve=JSON.stringify(de,null,2),Re=new Blob([ve],{type:"application/json"});try{let je;try{je=await p.getDirectoryHandle("history",{create:!0})}catch(ge){console.error("Failed to get/create history directory:",ge);return}try{const ge=[],Me=If.current;for await(const De of p.keys())try{if(De==="history"||De===Pe)continue;const ht=await(await p.getFileHandle(De)).getFile();if(!De.endsWith(".json"))continue;const xt=await ht.text();try{const Tt=JSON.parse(xt);if(Tt.version&&(Tt.fileType==="PCB_REVERSE_ENGINEERING_AUTOSAVE"||!Tt.fileType)){ge.push(De);const Je=Tt.fileType?"auto-saved":"manually saved/opened";console.log(`Auto save: Found PCB project file in root: ${De} (${Je}${De===Me?" - this is the opened file":""})`)}}catch{continue}}catch{continue}for(const De of ge)try{const xt=await(await(await p.getFileHandle(De)).getFile()).text(),Je=await(await je.getFileHandle(De,{create:!0})).createWritable();await Je.write(new Blob([xt],{type:"application/json"})),await Je.close(),await p.removeEntry(De),console.log(`Auto save: Moved ${De} from root to history/`)}catch($e){console.warn(`Auto save: Failed to move ${De} to history:`,$e)}}catch(ge){console.warn("Auto save: Error checking for old files in root:",ge)}const fe=await(await p.getFileHandle(Pe,{create:!0})).createWritable();await fe.write(Re),await fe.close(),console.log(`Auto save: Successfully saved ${Pe} to root directory`),id.current(Pe);const ye=Ao.current,pe=[Pe,...ye.filter(ge=>ge!==Pe)].sort((ge,Me)=>Me.localeCompare(ge));hl(pe),Ao.current=pe,Fo(0),Lc.current=0,pr.current=!1,eo(!1)}catch(je){console.error("Auto save failed:",je)}},[]);gd.current=ch;const Nu=U.useCallback(async()=>{const{project:p}=nd(),C=JSON.stringify(p,null,2),D=new Blob([C],{type:"application/json"});if(Pi&&Qr)try{let Re=null;try{Re=await Pi.getDirectoryHandle("history",{create:!0})}catch(Me){console.error("Failed to get/create history directory:",Me),Re=null}const je=Qr.replace(/\.json$/i,""),_e=fh(je),{timestamp:fe}=nd(),ye=`${_e}_${fe}.json`;if(Re)try{const Me=[];for await(const De of Pi.keys())try{if(De==="history"||De===ye)continue;const ht=await(await Pi.getFileHandle(De)).getFile();if(!De.endsWith(".json"))continue;const xt=await ht.text();try{JSON.parse(xt).version&&(Me.push(De),console.log(`Save: Found PCB project file in root: ${De}`))}catch{continue}}catch{continue}for(const De of Me)try{const xt=await(await(await Pi.getFileHandle(De)).getFile()).text(),Je=await(await Re.getFileHandle(De,{create:!0})).createWritable();await Je.write(new Blob([xt],{type:"application/json"})),await Je.close(),await Pi.removeEntry(De),console.log(`Save: Moved ${De} from root to history/`)}catch($e){console.warn(`Save: Failed to move ${De} to history:`,$e)}}catch(Me){console.warn("Save: Error checking for old files in root:",Me)}const ge=await(await Pi.getFileHandle(ye,{create:!0})).createWritable();await ge.write(D),await ge.close(),br(ye),eo(!1),pr.current=!1,console.log(`Project saved successfully: ${Qr}/${ye}`),alert(`Project saved successfully!

File: ${ye}
Location: ${Qr}`);return}catch(Re){const je=Re instanceof Error?Re.message:String(Re);console.error("Failed to save to project directory:",Re),alert(`Failed to save project to directory.

Error: ${je}

Please try saving again or use Save As...`),Jr(null)}if(Qr&&!Pi){const Re=window;if(typeof Re.showDirectoryPicker=="function")try{const je=await Re.showDirectoryPicker();Jr(je);const _e=`${Qr}.json`,ye=await(await je.getFileHandle(_e,{create:!0})).createWritable();await ye.write(D),await ye.close(),br(_e),eo(!1),pr.current=!1,console.log(`Project saved successfully: ${_e} in selected directory`),alert(`Project saved successfully!

File: ${_e}`);return}catch(je){if(je?.name!=="AbortError"){const _e=je instanceof Error?je.message:String(je);console.error("Failed to get directory:",je),alert(`Failed to select directory.

Error: ${_e}

Falling back to file picker...`)}}}const $=Re=>String(Re).padStart(2,"0"),de=new Date,z=`pcb_project_${`${de.getFullYear()}_${$(de.getMonth()+1)}_${$(de.getDate())}_${$(de.getHours())}_${$(de.getMinutes())}_${$(de.getSeconds())}`}.json`,Pe=window;if(typeof Pe.showSaveFilePicker=="function")try{const Re=await Pe.showSaveFilePicker({suggestedName:z,types:[{description:"PCB Project",accept:{"application/json":[".json"]}}]}),je=await Re.createWritable();await je.write(D),await je.close();const _e=Re.name;try{const pe=await Re.getFile();br(pe.name)}catch{br(_e)}const ye=_e.replace(/\.json$/i,"").replace(/[^a-zA-Z0-9_-]/g,"_");ye&&za(ye);try{const pe=Re.name.replace(/\.json$/i,""),Me=fh(pe).replace(/[^a-zA-Z0-9_-]/g,"_");to(Me),Pl||console.log("Auto save: Directory handle not set. Will prompt on first auto save.")}catch(pe){console.warn("Could not set up auto save for new file:",pe)}console.log(`Project saved successfully: ${_e}`),alert(`Project saved successfully!

File: ${_e}`);return}catch(Re){if(Re?.name==="AbortError")return;const je=Re instanceof Error?Re.message:String(Re);console.warn("showSaveFilePicker failed, falling back to download",Re),alert(`File picker unavailable.

Error: ${je}

Falling back to browser download...`)}const ve=document.createElement("a");ve.href=URL.createObjectURL(D),ve.download=z,document.body.appendChild(ve),ve.click(),setTimeout(()=>{URL.revokeObjectURL(ve.href),document.body.removeChild(ve)},0),console.log(`Project downloaded: ${z}`),alert(`Project downloaded successfully!

File: ${z}

Note: For better project management, use File  New Project or File  Open Project.`)},[nd,Pi,Qr,br,Jr,eo,za,to,Pl,fh]),qh=U.useCallback(p=>{const C=new Mn,D=C.internal.pageSize.getWidth(),$=C.internal.pageSize.getHeight(),de=20;let be=de;const z=7,Pe=60;C.setFontSize(18),C.setFont("helvetica","bold"),C.text("Bill of Materials",D/2,be,{align:"center"}),be+=z*2,C.setFontSize(10),C.setFont("helvetica","normal"),p.projectName&&(C.text(`Project: ${p.projectName}`,de,be),be+=z),C.text(`Exported: ${new Date(p.exportedAt).toLocaleString()}`,de,be),be+=z,C.text(`Total Components: ${p.totalComponents} | Unique Components: ${p.uniqueComponents}`,de,be),be=Pe,C.setFontSize(9),C.setFont("helvetica","bold");const ve=[15,50,30,20,25,30,20],Re=["Qty","Component Type","Value","Package","Manufacturer","Part Number","Layer"];let je=de;return Re.forEach((fe,ye)=>{C.text(fe,je,be),je+=ve[ye]}),be+=z,C.setLineWidth(.5),C.line(de,be,D-de,be),be+=z*.5,C.setFont("helvetica","normal"),C.setFontSize(8),p.items.forEach(fe=>{const ye=$e=>{be>$-de-z*$e&&(C.addPage(),be=de+z)};ye(3),je=de,[fe.quantity.toString(),fe.componentType,fe.value||"-",fe.packageType||"-",fe.manufacturer||"-",fe.partNumber||"-",fe.layer].forEach(($e,ht)=>{const xt=ve[ht]-2,Tt=C.splitTextToSize($e,xt);C.text(Tt[0]||"-",je,be),je+=ve[ht]}),be+=z*1.2;const ge=(fe.notes||"").toString().trim(),Me=fe.datasheet?fe.datasheet.toString().trim():"",De=[];if(ge&&De.push(`Notes: ${ge}`),Me&&De.push(`Spec Sheet URL: ${Me}`),De.length>0){const $e=de+ve[0]+2,ht=D-de-$e;De.forEach(xt=>{C.splitTextToSize(xt,ht).forEach(Je=>{ye(2),C.text(Je,$e,be),be+=z*.9})})}ye(1),C.setLineWidth(.2),C.line(de,be,D-de,be),be+=z*.5}),C.output("blob")},[]),zf=U.useCallback(async()=>{if(console.log("handleExportBOM called, format:",H),!Pi){alert("Please create or open a project before exporting BOM.");return}try{console.log("Generating BOM data...");const p=S5(Gt,an,Qr);console.log("BOM data generated:",p),console.log("Creating/getting BOM directory...");let C;try{C=await Pi.getDirectoryHandle("BOM",{create:!0}),console.log("BOM directory obtained")}catch(Pe){console.error("Failed to get/create BOM directory:",Pe),alert("Failed to create BOM directory. See console for details.");return}const D=cx();let $,de;if(H==="pdf")console.log("Generating PDF..."),$=qh(p),de=`BOM_${D}.pdf`;else{console.log("Generating JSON...");const Pe=JSON.stringify(p,null,2);$=new Blob([Pe],{type:"application/json"}),de=`BOM_${D}.json`}console.log("Saving file:",de);const z=await(await C.getFileHandle(de,{create:!0})).createWritable();await z.write($),await z.close(),console.log("BOM file saved successfully"),alert(`BOM exported successfully to ${de} in BOM directory!`)}catch(p){console.error("Failed to export BOM:",p),alert(`Failed to export BOM: ${p instanceof Error?p.message:String(p)}. See console for details.`)}},[Pi,Gt,an,Qr,H,qh]);Dt.useEffect(()=>{Zi.current&&(clearInterval(Zi.current),Zi.current=null);const p=Rs.current;if(Rs.current=gs,gs&&Nl){const C=Nl*60*1e3;(Pl||Pi)&&El?(console.log(`Auto save: Setting up interval for ${Nl} minute(s) (${C}ms)`),p||(pr.current=!0,setTimeout(()=>{ch()},100)),Zi.current&&(clearInterval(Zi.current),Zi.current=null),Zi.current=window.setInterval(()=>{console.log("Auto save: Interval triggered, calling performAutoSave..."),console.log(`  - hasChangesSinceLastAutoSave: ${pr.current}`),console.log(`  - dirHandle: ${pc.current?"set":"missing"}`),console.log(`  - baseName: ${Wo.current||"missing"}`),ch()},C),console.log(`Auto save: Interval set up for ${C}ms (${Nl} minutes)`),console.log(`  - Auto save directory handle: ${Pl?"set":"missing"}`),console.log(`  - Project directory handle: ${Pi?"set":"missing"}`),console.log(`  - Base name: ${El||"missing"}`)):(console.warn(`Auto save: Cannot set up interval - missing directory handle (autoSaveDirHandle: ${!!Pl}, projectDirHandle: ${!!Pi}) or base name (${!El}). Disabling auto save.`),wa(!1),Zi.current&&(clearInterval(Zi.current),Zi.current=null))}else gs||(Rs.current=!1);return()=>{Zi.current&&(clearInterval(Zi.current),Zi.current=null)}},[gs,Nl,Pl,El,Pi]);const eu=U.useRef(!1),dh=U.useRef(!1),[rd,Zs]=Dt.useState(0);Dt.useEffect(()=>{const C=Object.keys(Bn.getAll()).map(D=>Bn.subscribe(D,()=>{Zs($=>$+1)}));return()=>C.forEach(D=>D())},[]),Dt.useEffect(()=>{if(dh.current){console.log("Change tracking: Skipping - project is being loaded");return}if(gs&&eu.current){eu.current=!1,console.log("Auto save: Skipping change tracking on first run after enable (initial save handled separately)");return}pr.current=!0,eo(!0),console.log("Change detected, marking as unsaved",{autoSaveEnabled:gs,topImage:!!t,bottomImage:!!r,drawingStrokesCount:Qe.length,componentsTopCount:Gt.length,componentsBottomCount:an.length,powersCount:S.length,groundsCount:P.length,powerBusesCount:wn.length,projectNotesCount:Nn.length,areImagesLocked:Fi,areViasLocked:Ui,areTracesLocked:ws,areComponentsLocked:Or,areGroundNodesLocked:Ss,arePowerNodesLocked:fi})},[t,r,Qe,Gt,an,S,P,wn,Nn,O,W,J,Ce,Fi,Ui,ws,Or,Ss,fi,j,gs,le,Ae,E,Q,mt,K,$t,yt,oe,re,Ee,Ze,ze,Ct,Qn,en,lr,xo,$n,rd]),Dt.useEffect(()=>{gs?(eu.current=!0,console.log("Auto save: Enabled, marking first run")):eu.current=!1},[gs]),Dt.useEffect(()=>{gs||(pr.current=!1)},[gs]);const uh=U.useCallback(()=>!!(t||r||Qe.length>0||Gt.length>0||an.length>0||S.length>0||P.length>0),[t,r,Qe,Gt,an,S,P]),Pu=U.useCallback(()=>{Io({visible:!0,projectName:"",locationPath:"",locationHandle:null})},[]),ka=U.useCallback(async()=>{const p=window;if(typeof p.showDirectoryPicker=="function")try{const C=await p.showDirectoryPicker({mode:"readwrite"});Io(D=>({...D,locationHandle:C,locationPath:C.name||"Selected folder"}))}catch(C){C?.name!=="AbortError"&&(console.error("Failed to get directory:",C),alert("Failed to select location directory."))}else alert("Directory picker is not supported in this browser. Please use a modern browser like Chrome or Edge.")},[]),Xp=U.useCallback(async()=>{const p=Li.projectName.trim();if(!p){alert("Please enter a project name.");return}const C=p.replace(/[^a-zA-Z0-9_-]/g,"_")||"pcb_project";if(!Li.locationHandle){alert("Please select a location for the project.");return}const D=Li.locationHandle;let $,de;if(D.name===C)$=D,de=D;else{de=D;try{$=await de.getDirectoryHandle(C,{create:!0})}catch(be){console.error("Failed to create project folder:",be),alert(`Failed to create project folder "${C}". See console for details.`);return}}try{await $.getDirectoryHandle("history",{create:!0}),await $.getDirectoryHandle("images",{create:!0}),await $.getDirectoryHandle("datasheets",{create:!0}),console.log("Created project subdirectories: history, images, datasheets")}catch(be){console.error("Failed to create project subdirectories:",be)}Cd(),Io({visible:!1,projectName:"",locationPath:"",locationHandle:null}),za(C),Jr($),ed(),Ns(),Ws(!1),f(0);try{const{project:be,timestamp:z}=nd(),ve=`${fh(C)}_${z}.json`,Re=JSON.stringify(be,null,2),je=new Blob([Re],{type:"application/json"}),fe=await(await $.getFileHandle(ve,{create:!0})).createWritable();await fe.write(je),await fe.close(),br(ve),console.log(`New project created: ${C}/${ve}`),hs({visible:!0,source:"new",interval:5})}catch(be){console.error("Failed to save new project:",be),alert("Failed to save new project file. See console for details.")}},[ed,nd,Li,Cd,Ns,Ws,f]),Wh=U.useCallback(()=>{Io({visible:!1,projectName:"",locationPath:"",locationHandle:null})},[]),Kp=U.useCallback(async()=>{const p=window;if(typeof p.showDirectoryPicker=="function")try{const C=await p.showDirectoryPicker();jr(D=>({...D,locationHandle:C,locationPath:C.name||"Selected folder"}))}catch(C){C?.name!=="AbortError"&&(console.error("Failed to get directory:",C),alert("Failed to select location directory."))}else alert("Directory picker is not supported in this browser. Please use a modern browser that supports the File System Access API.")},[]),is=U.useCallback(async()=>{const p=fr.filename.trim();if(!p){alert("Please enter a file name.");return}const D=(p.endsWith(".json")?p:`${p}.json`).replace(/[^a-zA-Z0-9_.-]/g,"_");if(!fr.locationHandle){alert("Please select a location for the file.");return}const $=fr.locationHandle;try{const{project:de}=nd(),be=JSON.stringify(de,null,2),z=new Blob([be],{type:"application/json"}),ve=await(await $.getFileHandle(D,{create:!0})).createWritable();await ve.write(z),await ve.close(),br(D);const Re=D.replace(/\.json$/i,"").replace(/[^a-zA-Z0-9_-]/g,"_");Re&&za(Re),Jr($),eo(!1),pr.current=!1,jr({visible:!1,filename:"",locationPath:"",locationHandle:null}),Ja(null),console.log(`Project saved as: ${D} in selected directory`)}catch(de){console.error("Failed to save project:",de),alert(`Failed to save project file "${D}". See console for details.`)}},[fr,nd]),ro=U.useCallback(()=>{jr({visible:!1,filename:"",locationPath:"",locationHandle:null})},[]),gc=U.useCallback(async()=>{fs({visible:!1}),await Nu(),Pu(),hc()},[Nu,Pu,hc]),Zp=U.useCallback(()=>{fs({visible:!1}),Pu(),hc()},[Pu,hc]),Jp=U.useCallback(()=>{fs({visible:!1})},[]);Dt.useEffect(()=>{if(xa.visible){setTimeout(()=>{Pr.current?.focus()},0);const p=C=>{C.key==="Enter"?(C.preventDefault(),gc()):C.key==="Escape"&&(C.preventDefault(),fs({visible:!1}))};return window.addEventListener("keydown",p),()=>{window.removeEventListener("keydown",p)}}},[xa.visible,gc]);const Td=U.useCallback(async(p,C)=>{dh.current=!0;try{if(_i(),p.toolInstances?Bn.initializeFromProject(p):Bn.initialize(),p.projectInfo&&p.projectInfo.name&&za(p.projectInfo.name),p.view){if(p.view.currentView&&c(p.view.currentView),p.view.viewScale!=null&&Fn(p.view.viewScale),p.view.cameraWorldCenter)Ni(p.view.cameraWorldCenter);else if(p.view.viewPan){const je=ur.current;if(je){const _e=(je.width-10)/2,fe=(je.height-10)/2,ye=p.view.viewScale??1,pe=(_e-p.view.viewPan.x)/ye,ge=(fe-p.view.viewPan.y)/ye;Ni({x:pe,y:ge})}else Ni({x:0,y:0})}p.view.showBothLayers!=null&&Wa(p.view.showBothLayers),p.view.selectedDrawingLayer&&Ft(p.view.selectedDrawingLayer)}if(p.homeViews){const je={};for(const[_e,fe]of Object.entries(p.homeViews)){const ye=parseInt(_e,10),pe=fe;let ge=pe.pcbReferenceX,Me=pe.pcbReferenceY;(ge===void 0||Me===void 0)&&(ge=pe.x??0,Me=pe.y??0),pe.showTopImage===void 0?je[ye]={pcbReferenceX:ge,pcbReferenceY:Me,x:0,y:0,zoom:pe.zoom,viewRotation:Xn,viewFlipX:ri,isBottomView:ba,transparency:h,showTopImage:Ur,showBottomImage:zl,showViasLayer:Ar,showTopTracesLayer:Cr,showBottomTracesLayer:cs,showTopPadsLayer:Ys,showBottomPadsLayer:tr,showTopTestPointsLayer:So,showBottomTestPointsLayer:Uo,showTopComponents:Vi,showBottomComponents:Ks,showPowerLayer:Ha,showGroundLayer:mr,showConnectionsLayer:yr}:je[ye]={...pe,pcbReferenceX:ge,pcbReferenceY:Me,x:0,y:0,viewRotation:pe.viewRotation??0,viewFlipX:pe.viewFlipX??!1,isBottomView:pe.isBottomView??!1,transparency:pe.transparency??50}}Ll(je)}else Ll({});if(p.projectNotes&&Array.isArray(p.projectNotes)?En(p.projectNotes):En([]),p.traceColors&&(p.traceColors.top&&(Y(p.traceColors.top),pt("trace",p.traceColors.top,"top")),p.traceColors.bottom&&(I(p.traceColors.bottom),pt("trace",p.traceColors.bottom,"bottom"))),p.traceSizes){const je=p.traceSizes.top!=null&&p.traceSizes.top>0?p.traceSizes.top:6;let _e=p.traceSizes.bottom!=null&&p.traceSizes.bottom>0?p.traceSizes.bottom:6;_e<6&&(_e=6),Z(je),ie(_e),it("trace",je,"top"),it("trace",_e,"bottom")}else Z(6),ie(6);if(p.padColors&&(p.padColors.top&&(se(p.padColors.top),pt("pad",p.padColors.top,"top")),p.padColors.bottom&&(ue(p.padColors.bottom),pt("pad",p.padColors.bottom,"bottom"))),p.padSizes){const je=p.padSizes.top!=null&&p.padSizes.top>0?p.padSizes.top:18,_e=p.padSizes.bottom!=null&&p.padSizes.bottom>0?p.padSizes.bottom:18;L(je),ee(_e),it("pad",je,"top"),it("pad",_e,"bottom")}if(p.componentColors&&(p.componentColors.top&&(Mt(p.componentColors.top),pt("component",p.componentColors.top,"top")),p.componentColors.bottom&&(jt(p.componentColors.bottom),pt("component",p.componentColors.bottom,"bottom"))),p.componentSizes){const je=p.componentSizes.top!=null&&p.componentSizes.top>0?p.componentSizes.top:18,_e=p.componentSizes.bottom!=null&&p.componentSizes.bottom>0?p.componentSizes.bottom:18;Yt(je),on(_e),it("component",je,"top"),it("component",_e,"bottom")}p.toolLayerDefaults?(p.toolLayerDefaults.trace&&Us(p.toolLayerDefaults.trace),p.toolLayerDefaults.pad&&Pa(p.toolLayerDefaults.pad),p.toolLayerDefaults.testPoint&&Qo(p.toolLayerDefaults.testPoint),p.toolLayerDefaults.component&&fa(p.toolLayerDefaults.component)):p.traceToolLayer&&Us(p.traceToolLayer),p.toolSettings&&Wn(je=>{const _e=new Map(je);if(p.toolSettings.trace){const ye=_e.get("trace");if(ye){const pe={...ye,settings:p.toolSettings.trace},ge=new Map(ye.layerSettings);p.traceSizes&&p.traceColors&&(ge.set("top",{color:p.traceColors.top||ye.layerSettings.get("top")?.color||"#AA4499",size:p.traceSizes.top||ye.layerSettings.get("top")?.size||6}),ge.set("bottom",{color:p.traceColors.bottom||ye.layerSettings.get("bottom")?.color||"#F781BF",size:p.traceSizes.bottom||ye.layerSettings.get("bottom")?.size||6})),_e.set("trace",{...pe,layerSettings:ge})}}if(p.toolSettings.via){const ye=_e.get("via");ye&&_e.set("via",{...ye,settings:p.toolSettings.via})}if(p.toolSettings.pad){const ye=_e.get("pad");if(ye){const pe={...ye,settings:p.toolSettings.pad},ge=new Map(ye.layerSettings);p.padSizes&&p.padColors&&(ge.set("top",{color:p.padColors.top||ye.layerSettings.get("top")?.color||"#0072B2",size:p.padSizes.top||ye.layerSettings.get("top")?.size||18}),ge.set("bottom",{color:p.padColors.bottom||ye.layerSettings.get("bottom")?.color||"#56B4E9",size:p.padSizes.bottom||ye.layerSettings.get("bottom")?.size||18})),_e.set("pad",{...pe,layerSettings:ge})}}if(p.toolSettings.component){const ye=_e.get("component");if(ye){const pe={...ye,settings:p.toolSettings.component},ge=new Map(ye.layerSettings);p.componentSizes&&p.componentColors&&(ge.set("top",{color:p.componentColors.top||ye.layerSettings.get("top")?.color||"#6A3D9A",size:p.componentSizes.top||ye.layerSettings.get("top")?.size||18}),ge.set("bottom",{color:p.componentColors.bottom||ye.layerSettings.get("bottom")?.color||"#9467BD",size:p.componentSizes.bottom||ye.layerSettings.get("bottom")?.size||18})),_e.set("component",{...pe,layerSettings:ge})}}if(p.testPointSizes&&p.testPointColors){xe(p.testPointColors.top||oe),Le(p.testPointColors.bottom||re),Oe(p.testPointSizes.top||Ee),st(p.testPointSizes.bottom||Ze);const ye=_e.get("testPoint");if(ye){const pe=new Map(ye.layerSettings);pe.set("top",{color:p.testPointColors.top||ye.layerSettings.get("top")?.color||"#E69F00",size:p.testPointSizes.top||ye.layerSettings.get("top")?.size||6}),pe.set("bottom",{color:p.testPointColors.bottom||ye.layerSettings.get("bottom")?.color||"#F0E442",size:p.testPointSizes.bottom||ye.layerSettings.get("bottom")?.size||6}),_e.set("testPoint",{...ye,layerSettings:pe})}}if(p.componentConnectionColor!==void 0&&Ne(p.componentConnectionColor),p.componentConnectionSize!==void 0&&wt(p.componentConnectionSize),p.toolSettings.ground){const ye=_e.get("ground");ye&&_e.set("ground",{...ye,settings:p.toolSettings.ground})}if(p.toolSettings.power){const ye=_e.get("power");ye&&_e.set("power",{...ye,settings:p.toolSettings.power})}if(p.toolSettings.erase){const ye=_e.get("erase");ye&&_e.set("erase",{...ye,settings:p.toolSettings.erase})}const fe=_==="draw"&&ot==="trace"?_e.get("trace"):_==="draw"&&ot==="via"?_e.get("via"):_==="draw"&&ot==="pad"?_e.get("pad"):_==="draw"&&ot==="testPoint"?_e.get("testPoint"):_==="component"?_e.get("component"):_==="power"?_e.get("power"):_==="ground"?_e.get("ground"):null;if(fe)if(_==="draw"&&ot==="trace"){const ye=Qn||"top",pe=fe.layerSettings.get(ye);pe?(q(pe.color),X(pe.size),ye==="top"?(Y(pe.color),Z(pe.size)):(I(pe.color),ie(pe.size))):(q(fe.settings.color),X(fe.settings.size))}else if(_==="draw"&&ot==="pad"){const ye=Ti||"top",pe=fe.layerSettings.get(ye);pe?(q(pe.color),X(pe.size),ye==="top"?(se(pe.color),L(pe.size)):(ue(pe.color),ee(pe.size))):(q(fe.settings.color),X(fe.settings.size))}else if(_==="component"){const ye=wi||"top",pe=fe.layerSettings.get(ye);pe?(q(pe.color),X(pe.size),ye==="top"?(Mt(pe.color),Yt(pe.size)):(jt(pe.color),on(pe.size))):(q(fe.settings.color),X(fe.settings.size))}else if(_==="draw"&&ot==="testPoint"){const ye=On||"top",pe=fe.layerSettings.get(ye);pe?(q(pe.color),X(pe.size),ye==="top"?(xe(pe.color),Oe(pe.size)):(Le(pe.color),st(pe.size))):(q(fe.settings.color),X(fe.settings.size))}else q(fe.settings.color),X(fe.settings.size);return _e});const D=async(je,_e)=>{if(!je)return null;let fe=null,ye="",pe=je.filePath||je.name;if(!_e){const ge=je.name||"image";return alert(`Error: Cannot load image "${ge}" because no project directory is available.

Please ensure you opened the project file from its project directory. The project directory is required to access the image files stored in the images/ subdirectory.`),null}if(pe)try{let ge=pe;!pe.startsWith("images/")&&!pe.startsWith("Images/")?ge=pe:pe.startsWith("Images/")?ge=pe.replace("Images/",""):pe.startsWith("images/")&&(ge=pe.replace("images/",""));let Me;try{Me=await _e.getDirectoryHandle("images")}catch{try{Me=await _e.getDirectoryHandle("Images")}catch{throw new Error("Neither 'images' nor 'Images' directory found in project folder.")}}const $e=await(await Me.getFileHandle(ge)).getFile();fe=await createImageBitmap($e),ye=URL.createObjectURL($e),console.log(`Loaded image from file path: images/${ge}`),pe.startsWith("images/")||(pe=`images/${pe.replace("Images/","")}`)}catch(ge){const Me=ge instanceof Error?ge.message:"Unknown error",De=je.name||"image",$e=pe.startsWith("images/")||pe.startsWith("Images/")?pe.replace("Images/","images/"):`images/${pe}`;return alert(`Error: Failed to load image "${De}" from project directory.

Expected location: ${$e}

This may occur if:
- The image file was moved or deleted
- The project directory structure was modified
- File permissions are insufficient

Please ensure the image file exists in the images/ subdirectory of your project folder.

Technical details: ${Me}`),null}else{const ge=je.name||"image";return alert(`Error: Image "${ge}" has no file path specified in the project file.

The project file is missing the image file path information. This may indicate the project file is corrupted or was created with an older version of the software.`),null}if(!fe){const ge=je.name||"image";return alert(`Error: Could not create image bitmap for "${ge}".

The image file may be corrupted or in an unsupported format. Please ensure the image is a valid PNG, JPEG, or other supported image format.`),null}return{url:ye,name:je.name??"image",width:je.width??fe.width,height:je.height??fe.height,filePath:pe,x:je.x??0,y:je.y??0,scale:je.scale??1,rotation:je.rotation??0,flipX:!!je.flipX,flipY:!!je.flipY,skewX:je.skewX??0,skewY:je.skewY??0,keystoneV:je.keystoneV??0,keystoneH:je.keystoneH??0,brightness:je.brightness??100,contrast:je.contrast??100,bitmap:fe}},$=C!==void 0?C:Pi,de=await D(p.images?.top,$),be=await D(p.images?.bottom,$);if(n(de),o(be),p.pointIdCounter&&typeof p.pointIdCounter=="number"?Sg(p.pointIdCounter):(console.warn("Project file missing pointIdCounter. Starting from 1."),Sg(1)),p.locks&&(typeof p.locks.areImagesLocked=="boolean"&&Qi(p.locks.areImagesLocked),typeof p.locks.areViasLocked=="boolean"&&Lr(p.locks.areViasLocked),typeof p.locks.arePadsLocked=="boolean"&&fo(p.locks.arePadsLocked),typeof p.locks.areTracesLocked=="boolean"&&ol(p.locks.areTracesLocked),typeof p.locks.areComponentsLocked=="boolean"&&ma(p.locks.areComponentsLocked),typeof p.locks.areGroundNodesLocked=="boolean"&&Za(p.locks.areGroundNodesLocked),typeof p.locks.arePowerNodesLocked=="boolean"&&po(p.locks.arePowerNodesLocked)),p.visibility&&(typeof p.visibility.showViasLayer=="boolean"&&$s(p.visibility.showViasLayer),typeof p.visibility.showTopPadsLayer=="boolean"&&Xs(p.visibility.showTopPadsLayer),typeof p.visibility.showBottomPadsLayer=="boolean"&&no(p.visibility.showBottomPadsLayer),typeof p.visibility.showTopTracesLayer=="boolean"&&Sa(p.visibility.showTopTracesLayer),typeof p.visibility.showBottomTracesLayer=="boolean"&&Gs(p.visibility.showBottomTracesLayer),typeof p.visibility.showTopComponents=="boolean"&&sa(p.visibility.showTopComponents),typeof p.visibility.showBottomComponents=="boolean"&&Aa(p.visibility.showBottomComponents),typeof p.visibility.showPowerLayer=="boolean"&&x(p.visibility.showPowerLayer),typeof p.visibility.showGroundLayer=="boolean"&&Ai(p.visibility.showGroundLayer),typeof p.visibility.showConnectionsLayer=="boolean"&&Hr(p.visibility.showConnectionsLayer),typeof p.visibility.showTraceCornerDots=="boolean"&&pi(p.visibility.showTraceCornerDots)),p.autoSave?(typeof p.autoSave.enabled=="boolean"&&wa(p.autoSave.enabled),typeof p.autoSave.interval=="number"&&ul(p.autoSave.interval),typeof p.autoSave.baseName=="string"&&p.autoSave.baseName?(to(p.autoSave.baseName),Wo.current=p.autoSave.baseName,p.autoSave.enabled&&!Pl&&(console.log("Auto save: Directory handle not available after page reload (expected). Auto save disabled. Use File -> Auto Save -> Enable to re-enable."),wa(!1),ul(null))):p.autoSave.enabled&&(console.warn("Auto save was enabled in project file but base name is missing. Disabling auto save."),wa(!1),ul(null),to(""),Wo.current="")):(wa(!1),ul(null),Kl(null),to(""),pc.current=null,Wo.current="",Zi.current&&(clearInterval(Zi.current),Zi.current=null)),p.drawing?.drawingStrokes&&Array.isArray(p.drawing.drawingStrokes)){const je=p.drawing.drawingStrokes.map(_e=>({..._e,points:_e.points.map(fe=>({...fe,...cr(fe)}))})).filter(_e=>!(_e.type==="trace"&&_e.points.length<2));St(je);for(const _e of je)for(const fe of _e.points)fe.id&&typeof fe.id=="number"&&om(fe.id)}else console.warn("Project file missing drawingStrokes. Starting with empty strokes."),St([]);if(p.drawing?.componentsTop){const je=p.drawing.componentsTop.map(_e=>{const fe=cr({x:_e.x,y:_e.y});return{..._e,x:fe.x,y:fe.y,layer:_e.layer||"top",pinConnections:_e.pinConnections||new Array(_e.pinCount||0).fill("")}});Bi(je)}if(p.drawing?.componentsBottom){const je=p.drawing.componentsBottom.map(_e=>{const fe=cr({x:_e.x,y:_e.y});return{..._e,x:fe.x,y:fe.y,layer:_e.layer||"bottom",pinConnections:_e.pinConnections||new Array(_e.pinCount||0).fill("")}});Kn(je)}if(p.designatorCounters&&typeof p.designatorCounters=="object"){const je=p.designatorCounters;gr.current={...je}}else gr.current={};if(typeof p.autoAssignDesignators=="boolean"&&Vt(p.autoAssignDesignators),typeof p.useGlobalDesignatorCounters=="boolean"?Dn(p.useGlobalDesignatorCounters):Dn(!1),p.drawing?.grounds){const _e=p.drawing.grounds.map(fe=>{fe.pointId||console.warn("Ground symbol missing pointId - this may cause issues");const ye=cr({x:fe.x,y:fe.y});return{...fe,x:ye.x,y:ye.y}}).filter(fe=>{const ye=typeof fe.x=="number"&&typeof fe.y=="number"&&!isNaN(fe.x)&&!isNaN(fe.y)&&isFinite(fe.x)&&isFinite(fe.y);return ye||console.warn(`Filtered out invalid ground symbol at (${fe.x}, ${fe.y})`),ye});lt(_e);for(const fe of _e)fe.pointId&&typeof fe.pointId=="number"&&om(fe.pointId)}else lt([]);let z;if(p.powerBuses&&Array.isArray(p.powerBuses)&&p.powerBuses.length>0?(z=p.powerBuses,Ro(z)):(z=[{id:"powerbus-default",name:"+5VDC",voltage:"+5",color:"#ff0000"}],Ro(z)),p.groundBuses&&Array.isArray(p.groundBuses)&&p.groundBuses.length>0?te(p.groundBuses):te([{id:"groundbus-circuit",name:"GND",color:"#000000"}]),p.drawing?.powers){const _e=p.drawing.powers.map(fe=>{fe.pointId||console.warn("Power symbol missing pointId - this may cause issues");const ye=cr({x:fe.x,y:fe.y});return{...fe,x:ye.x,y:ye.y}}).filter(fe=>{const ye=typeof fe.x=="number"&&typeof fe.y=="number"&&!isNaN(fe.x)&&!isNaN(fe.y)&&isFinite(fe.x)&&isFinite(fe.y);return ye||console.warn(`Filtered out invalid power node at (${fe.x}, ${fe.y})`),ye});Ie(_e);for(const fe of _e)fe.pointId&&typeof fe.pointId=="number"&&om(fe.pointId)}else Ie([]);let Pe=0;if(p.drawing?.drawingStrokes&&Array.isArray(p.drawing.drawingStrokes))for(const je of p.drawing.drawingStrokes)for(const _e of je.points)_e.id&&typeof _e.id=="number"&&_e.id>Pe&&(Pe=_e.id);if(p.drawing?.componentsTop&&Array.isArray(p.drawing.componentsTop)){for(const je of p.drawing.componentsTop)if(je.pinConnections&&Array.isArray(je.pinConnections)){for(const _e of je.pinConnections)if(_e&&typeof _e=="string"){const fe=parseInt(_e,10);!isNaN(fe)&&fe>Pe&&(Pe=fe)}}}if(p.drawing?.componentsBottom&&Array.isArray(p.drawing.componentsBottom)){for(const je of p.drawing.componentsBottom)if(je.pinConnections&&Array.isArray(je.pinConnections)){for(const _e of je.pinConnections)if(_e&&typeof _e=="string"){const fe=parseInt(_e,10);!isNaN(fe)&&fe>Pe&&(Pe=fe)}}}if(p.drawing?.grounds&&Array.isArray(p.drawing.grounds))for(const je of p.drawing.grounds)je.pointId&&typeof je.pointId=="number"&&je.pointId>Pe&&(Pe=je.pointId);if(p.drawing?.powers&&Array.isArray(p.drawing.powers))for(const je of p.drawing.powers)je.pointId&&typeof je.pointId=="number"&&je.pointId>Pe&&(Pe=je.pointId);const ve=Pe+1,Re=am();Re<ve&&(console.warn(`pointIdCounter was ${Re} but max existing ID is ${Pe}. Correcting to ${ve}.`),Sg(ve)),pr.current=!1,eo(!1),Ws(!1),setTimeout(()=>{dh.current=!1},100)}catch(D){console.error("Failed to open project",D),alert("Failed to open project file. See console for details."),dh.current=!1}},[_,ot,Pi,n,o,Sg,Qi,Lr,fo,ol,ma,Za,po,$s,Xs,no,Sa,Gs,sa,Aa,x,Ai,Hr,wa,ul,Kl,to,St,Bi,Kn,lt,Ro,te,Ie,sd,cr,lm,h5,Qf,Vt,Dn,_i]),Eu=U.useCallback(async()=>{},[Rl]),tu=U.useCallback(async p=>{const C=pc.current;if(!C){console.warn("Cannot load file: no directory handle");return}try{const $=await(await C.getFileHandle(p)).getFile();if($.size===0){console.warn(`File ${p} is empty, skipping`);const Re=Ao.current.filter(je=>je!==p);hl(Re),Ao.current=Re;return}const de=await $.text();if(!de||de.trim().length===0){console.warn(`File ${p} contains no data, skipping`);const Re=Ao.current.filter(je=>je!==p);hl(Re),Ao.current=Re;return}let be;try{be=JSON.parse(de)}catch(ve){console.error(`Failed to parse JSON from file ${p}:`,ve);const je=Ao.current.filter(_e=>_e!==p);hl(je),Ao.current=je,await Eu();return}ed(),Fn(1),document.body&&(document.body.style.zoom="1"),document.documentElement&&(document.documentElement.style.zoom="1"),Pn(new Set),jn(new Set),pn(new Set),xn(new Set),hc(),await Td(be),br(p);const Pe=Ao.current.indexOf(p);Pe>=0?(Fo(Pe),Lc.current=Pe):await Eu(),pr.current=!1,eo(!1)}catch(D){console.error("Failed to load file from history:",D);const $=Ao.current;if($.includes(p)){const de=$.filter(be=>be!==p);hl(de),Ao.current=de,await Eu()}}},[Td,Eu,hc]),$o=U.useCallback(async p=>{if(!Pi){console.warn("Cannot restore file: no project directory handle"),alert("No project directory available. Please open or create a project first.");return}try{let C;try{C=await Pi.getDirectoryHandle("history")}catch(z){console.error("History directory not found:",z),alert("History directory not found.");return}const $=await(await C.getFileHandle(p)).getFile();if($.size===0){alert(`File ${p} is empty.`);return}const de=await $.text();if(!de||de.trim().length===0){alert(`File ${p} contains no data.`);return}let be;try{be=JSON.parse(de)}catch(z){console.error(`Failed to parse JSON from file ${p}:`,z),alert(`Failed to parse file ${p}. It may be corrupted.`);return}ed(),Fn(1),document.body&&(document.body.style.zoom="1"),document.documentElement&&(document.documentElement.style.zoom="1"),Pn(new Set),jn(new Set),pn(new Set),xn(new Set),hc(),await Td(be),br(p),pr.current=!1,console.log(`Successfully restored file: ${p}`)}catch(C){console.error("Failed to restore file from history:",C),alert(`Failed to restore file ${p}. Please try again.`)}},[Pi,Td,Pn,jn,pn,xn,br,Fn,ed,hc]);Dt.useEffect(()=>{me&&!Te&&Fe({x:window.innerWidth/2-300,y:window.innerHeight/2-250})},[me,Te]);const mc=U.useCallback(p=>{if(!Te)return;ke(!0);const C=p.clientX-Te.x,D=p.clientY-Te.y,$=be=>{Fe({x:be.clientX-C,y:be.clientY-D})},de=()=>{ke(!1),document.removeEventListener("mousemove",$),document.removeEventListener("mouseup",de)};document.addEventListener("mousemove",$),document.addEventListener("mouseup",de)},[Te]);U.useCallback(async()=>{const p=Lc.current,C=Ao.current;if(p>=0&&p<C.length-1){const D=p+1,$=C[D];$&&await tu($)}},[tu]),U.useCallback(async()=>{const p=Lc.current,C=Ao.current;if(p<=0||p>=C.length||C.length===0){console.warn("Cannot navigate to newer file: index is",p,"history length is",C.length);return}if(p>0&&p<C.length&&C.length>0){const D=p-1;if(D>=0&&D<C.length){const $=C[D];$?await tu($):(console.warn("No newer file found at index",D),await Eu())}else console.warn("Cannot navigate to newer file: prevIndex",D,"is out of bounds")}},[tu,Eu]),Dt.useEffect(()=>{Jt.current=Ln},[Ln]);const $h=Dt.useRef(ot),so=Dt.useRef(sn);Dt.useEffect(()=>{const p=ot!==$h.current;if(_==="draw"&&$h.current==="trace"&&p){if(Jt.current.length>=2){Sn(Qe,Gt,an,Se,Ve);const C={id:`${Date.now()}-trace-autofinalize`,points:Jt.current,color:B,size:G,layer:so.current,type:"trace"};St(D=>[...D,C]),so.current==="top"?pa(D=>[...D,C.id]):vs(D=>[...D,C.id])}Kt([]),Bt(!1)}$h.current=ot,so.current=sn},[ot,sn,_,B,G]);const Bf=Dt.useRef(_);Dt.useEffect(()=>{if(Bf.current==="draw"&&_!=="draw"&&ot==="trace"&&Jt.current.length>=2){const p={id:`${Date.now()}-trace-autofinalize`,points:Jt.current,color:B,size:G,layer:sn,type:"trace"};St(C=>[...C,p]),sn==="top"?pa(C=>[...C,p.id]):vs(C=>[...C,p.id]),Kt([]),Bt(!1)}Bf.current=_},[_,ot,B,G,sn]);const Mc=Dt.useMemo(()=>e5,[]);Dt.useEffect(()=>{Tu()},[Qe]),Dt.useEffect(()=>{Tu()},[Gt,an,P,mr]);const Xt=Fd>0,Go=U.useCallback(async()=>{const p=window;if(typeof p.showOpenFilePicker=="function")try{const[C]=await p.showOpenFilePicker({multiple:!1}),D=await C.getFile();if(!D.name.toLowerCase().endsWith(".json")){alert("Please select a .json project file.");return}lh.current=!0,Cd(),await new Promise(ve=>setTimeout(ve,0)),br(D.name);const $=await D.text(),de=JSON.parse($);lh.current=!0;let be=null;try{if(typeof C.getParent=="function")be=await C.getParent();else{console.warn("getParent() not available. Prompting user for directory access...");const ve=window;if(typeof ve.showDirectoryPicker=="function")be=await ve.showDirectoryPicker({startIn:C});else throw new Error("Directory picker not available in this browser")}if(be)try{if((await(await be.getFileHandle(D.name)).getFile()).name!==D.name)throw new Error("Directory verification failed: file name mismatch")}catch(ve){throw console.error("Directory verification failed:",ve),console.error("The selected directory might not contain the opened file"),new Error("Directory verification failed - selected directory does not contain the opened file")}if(Jr(be),io.current=be,be)try{await be.getDirectoryHandle("history",{create:!0}),await be.getDirectoryHandle("images",{create:!0}),await be.getDirectoryHandle("datasheets",{create:!0}),console.log("Created/verified project subdirectories: history, images, datasheets")}catch(ve){console.error("Failed to create/verify project subdirectories:",ve)}}catch(ve){console.error("Failed to get directory handle from file handle:",ve)}finally{setTimeout(()=>{lh.current=!1},1e3)}const z=de.autoSave?.enabled===!0;await Td(de,be);let Pe;if(de.projectInfo?.name?Pe=de.projectInfo.name:(Pe=D.name.replace(/\.json$/i,"").replace(/[^a-zA-Z0-9_-]/g,"_")||"pcb_project",za(Pe)),Qr||za(Pe),z&&be){const ve=Pe.replace(/\.json$/i,""),je=fh(ve).replace(/[^a-zA-Z0-9_-]/g,"_");Kl(be),to(je),pc.current=be,Wo.current=je,Zi.current&&(clearInterval(Zi.current),Zi.current=null)}setTimeout(()=>{hs({visible:!0,source:"open",interval:5})},100)}catch(C){if(C?.name==="AbortError")return;console.warn("showOpenFilePicker failed, falling back to input",C),Ba.current?.click()}else Ba.current?.click()},[Td,Qr,br,za,Jr,hs,gs,Kl,to,Cd]),hh=U.useCallback(async()=>{La({visible:!1}),await Nu(),await Go()},[Nu,Go]),Ff=U.useCallback(async()=>{La({visible:!1}),await Go()},[Go]),yc=U.useCallback(()=>{La({visible:!1})},[]);Dt.useEffect(()=>{if(Mo.visible){setTimeout(()=>{Mi.current?.focus()},0);const p=C=>{C.key==="Enter"?(C.preventDefault(),hh()):C.key==="Escape"&&(C.preventDefault(),La({visible:!1}))};return window.addEventListener("keydown",p),()=>{window.removeEventListener("keydown",p)}}},[Mo.visible,hh]);const Qp=U.useCallback(async()=>{uh()?La({visible:!0}):await Go()},[uh,Go]);return l.jsxs("div",{className:"app",children:[l.jsx("header",{className:"app-header",children:l.jsx("h1",{children:" PCB Tracer (v3.0)"})}),l.jsx(yC,{openMenu:hd,setOpenMenu:Ja,isReadOnlyMode:Xt,currentProjectFilePath:Rl,isProjectActive:!!Pi,autoSaveEnabled:gs,autoSaveInterval:Nl,hasUnsavedChangesState:pd,onNewProject:Pu,onOpenProject:Qp,onSaveProject:Nu,onPrint:Gp,onExportBOM:zf,bomExportFormat:H,setBomExportFormat:R,hasUnsavedChanges:uh,setNewProjectDialog:fs,setAutoSaveDialog:Lo,onShowGeminiSettings:()=>nc(!0),topImage:t,bottomImage:r,setCurrentTool:b,resetImageTransform:zh,areImagesLocked:Fi,setAreImagesLocked:Qi,onEnterBoardDimensions:()=>Wd(!0),fileInputTopRef:Od,fileInputBottomRef:ia,openProjectRef:Ba,increaseSize:Bh,decreaseSize:Fh,brushSize:G,drawingStrokes:Qe,selectedIds:li,selectedComponentIds:gn,selectedPowerIds:ui,selectedGroundIds:hi,componentsTop:Gt,componentsBottom:an,powers:S,grounds:P,powerNodeNames:Rp,groundNodeNames:Dp,setSetSizeDialog:Do,areViasLocked:Ui,setAreViasLocked:Lr,arePadsLocked:hr,setArePadsLocked:fo,areTestPointsLocked:Ps,setAreTestPointsLocked:al,areTracesLocked:ws,setAreTracesLocked:ol,areComponentsLocked:Or,setAreComponentsLocked:ma,areGroundNodesLocked:Ss,setAreGroundNodesLocked:Za,arePowerNodesLocked:fi,setArePowerNodesLocked:po,showTraceCornerDots:Vr,setShowTraceCornerDots:pi,setSelectedIds:Pn,setSelectedComponentIds:jn,setSelectedPowerIds:pn,setSelectedGroundIds:xn,selectAllVias:yu,selectAllTraces:$d,selectAllPads:Ol,selectAllComponents:lc,selectDisconnectedComponents:cc,selectAllComponentConnections:xu,selectAllPowerNodes:Lp,selectAllGroundNodes:Mp,selectPowerNodesByName:Ip,selectGroundNodesByName:jf,setShowPowerBusManager:ne,setShowGroundBusManager:hn,setShowPastMachine:we,toolRegistry:$n,updateToolSettings:co,updateToolLayerSettings:Ra,setBrushSize:X,setBrushColor:q,saveToolSettings:Tb,saveToolLayerSettings:sf,colorPalette:Mc,currentTool:_,drawingMode:ot,traceToolLayer:Qn,padToolLayer:Ti,testPointToolLayer:On,componentToolLayer:wi,setTopTraceSize:Z,setBottomTraceSize:ie,setTopPadSize:L,setBottomPadSize:ee,setTopTestPointSize:Oe,setBottomTestPointSize:st,setTopComponentSize:Yt,setBottomComponentSize:on,setComponentConnectionSize:wt,topTraceColor:O,bottomTraceColor:W,topPadColor:le,bottomPadColor:Ae,topTestPointColor:oe,bottomTestPointColor:re,topComponentColor:mt,bottomComponentColor:K,setTopTraceColor:Y,setBottomTraceColor:I,setTopPadColor:se,setBottomPadColor:ue,setTopTestPointColor:xe,setBottomTestPointColor:Le,setTopComponentColor:Mt,setBottomComponentColor:jt,setComponentConnectionColor:Ne,saveDefaultSize:it,saveDefaultColor:pt,menuBarRef:wo,onOpenProjectNotes:Lf,onOpenTestPoints:Mf,onOpenTransformImages:()=>Es(!0),onOpenTransformAll:()=>zo(!0)}),l.jsx("div",{style:{display:"block",padding:0,margin:0,width:"100vw",height:"calc(100vh - 70px)",boxSizing:"border-box",position:"relative"},children:l.jsxs("div",{ref:Yc,style:{position:"relative",width:"100%",height:"100%",margin:0,padding:0,boxSizing:"border-box",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",borderRadius:"16px",overflow:"hidden"},children:[l.jsxs("div",{style:{position:"absolute",top:6,left:6,bottom:6,width:46,display:"flex",flexDirection:"column",gap:8,padding:"6px 3px",background:"rgba(250,250,255,0.95)",borderRadius:8,border:"1px solid #ddd",boxShadow:"0 2px 6px rgba(0,0,0,0.08)",zIndex:20},children:[l.jsxs("button",{onClick:()=>{Xt||Qd()},onMouseDown:p=>p.currentTarget.blur(),disabled:Xt,title:"Select (S)",style:{width:"100%",height:32,display:"flex",alignItems:"center",gap:3,padding:"4px 3px",borderRadius:6,border:_==="select"?"2px solid #000":"1px solid #ddd",background:_==="select"?"#e6f0ff":"#fff",color:Xt?"#999":"#222",outline:"none",cursor:Xt?"not-allowed":"pointer",opacity:Xt?.5:1},children:[l.jsx(Kw,{size:14}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",flex:1,minWidth:0},children:[l.jsx("span",{style:{fontSize:"10px",fontWeight:"bold",lineHeight:1},children:"S"}),l.jsx("span",{style:{fontSize:"9px",lineHeight:1,opacity:.7},children:"-"})]})]}),l.jsxs("button",{onMouseDown:p=>{if(p.altKey&&!Xt){p.preventDefault(),p.stopPropagation(),sc(!1),qr(!0);return}},onClick:p=>{!Xt&&!p.altKey&&(console.log("Via tool clicked"),bt(),Zt("via"),b("draw"),$s(!0))},disabled:Xt,title:"Draw Vias (V), Option+click for Pattern Placement",style:{width:"100%",height:32,display:"flex",alignItems:"center",gap:3,padding:"4px 3px",borderRadius:6,border:_==="draw"&&ot==="via"?"2px solid #000":"1px solid #ddd",background:_==="draw"&&ot==="via"?"#e6f0ff":"#fff",color:Xt?"#999":"#222",cursor:Xt?"not-allowed":"pointer",opacity:Xt?.5:1},children:[l.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24","aria-hidden":"true",style:{flexShrink:0},children:(()=>{const p=Bn.get("via").color;return l.jsxs(l.Fragment,{children:[l.jsx("circle",{cx:"12",cy:"12",r:"8",fill:"none",stroke:p,strokeWidth:"3"}),l.jsx("circle",{cx:"12",cy:"12",r:"4",fill:p})]})})()}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",flex:1,minWidth:0},children:[l.jsx("span",{style:{fontSize:"10px",fontWeight:"bold",lineHeight:1},children:"V"}),l.jsx("span",{style:{fontSize:"9px",lineHeight:1,opacity:.7},children:Bn.get("via").size})]})]}),l.jsxs("button",{ref:Su,onMouseDown:p=>{if(p.altKey&&!Xt){p.preventDefault(),p.stopPropagation(),sc(!0),qr(!0);return}},onClick:p=>{!Xt&&!p.altKey&&(console.log("Pad tool clicked"),bt(),Zt("pad"),b("draw"),setTimeout(()=>Hh(),0))},disabled:Xt,title:"Draw Pads (P), Option+click for Pattern Placement",style:{width:"100%",height:32,display:"flex",alignItems:"center",gap:3,padding:"4px 3px",borderRadius:6,border:_==="draw"&&ot==="pad"?"2px solid #000":"1px solid #ddd",background:_==="draw"&&ot==="pad"?"#e6f0ff":"#fff",color:Xt?"#999":"#222",cursor:Xt?"not-allowed":"pointer",opacity:Xt?.5:1},children:[l.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24","aria-hidden":"true",style:{flexShrink:0},children:(()=>{const C=Ti==="top"?"padTop":"padBottom",D=Bn.get(C).color,$=14,de=(24-$)/2,be=(24-$)/2;return l.jsx("rect",{x:de,y:be,width:$,height:$,fill:D})})()}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",flex:1,minWidth:0},children:[l.jsx("span",{style:{fontSize:"10px",fontWeight:"bold",lineHeight:1},children:"P"}),l.jsx("span",{style:{fontSize:"9px",lineHeight:1,opacity:.7},children:(()=>{if(_==="draw"&&ot==="pad"&&dr.toolInstanceId&&(dr.toolInstanceId==="padTop"||dr.toolInstanceId==="padBottom"))return dr.size;const p=Ti==="top"?"padTop":"padBottom";return Bn.get(p).size})()})]})]}),l.jsxs("button",{ref:Au,onClick:()=>{Xt||(console.log("Test Point tool clicked"),bt(),Zt("testPoint"),b("draw"),setTimeout(()=>fc(),0))},disabled:Xt,title:"Draw Test Points (Y)",style:{width:"100%",height:32,display:"flex",alignItems:"center",gap:3,padding:"4px 3px",borderRadius:6,border:_==="draw"&&ot==="testPoint"?"2px solid #000":"1px solid #ddd",background:_==="draw"&&ot==="testPoint"?"#e6f0ff":"#fff",color:Xt?"#999":"#222",cursor:Xt?"not-allowed":"pointer",opacity:Xt?.5:1},children:[l.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24","aria-hidden":"true",style:{flexShrink:0},children:(()=>{const C=On==="top"?"testPointTop":"testPointBottom",D=Bn.get(C).color,$=14,de=12,be=12;return l.jsx("path",{d:`M ${de} ${be-$/2} L ${de+$/2} ${be} L ${de} ${be+$/2} L ${de-$/2} ${be} Z`,fill:D,stroke:"#000",strokeWidth:"1.5"})})()}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",flex:1,minWidth:0},children:[l.jsx("span",{style:{fontSize:"10px",fontWeight:"bold",lineHeight:1},children:"Y"}),l.jsx("span",{style:{fontSize:"9px",lineHeight:1,opacity:.7},children:(()=>{if(_==="draw"&&ot==="testPoint"&&dr.toolInstanceId&&(dr.toolInstanceId==="testPointTop"||dr.toolInstanceId==="testPointBottom"))return dr.size;const p=On==="top"?"testPointTop":"testPointBottom";return Bn.get(p).size})()})]})]}),l.jsxs("button",{ref:nh,onClick:()=>{Xt||(console.log("Trace tool clicked"),bt(),Zt("trace"),b("draw"),setTimeout(()=>ah(),0))},disabled:Xt,title:"Draw Traces (T)",style:{width:"100%",height:32,display:"flex",alignItems:"center",gap:3,padding:"4px 3px",borderRadius:6,border:_==="draw"&&ot==="trace"?"2px solid #000":"1px solid #ddd",background:_==="draw"&&ot==="trace"?"#e6f0ff":"#fff",color:Xt?"#999":"#222",cursor:Xt?"not-allowed":"pointer",opacity:Xt?.5:1},children:[l.jsx(Jw,{size:14,color:(()=>{const C=Qn==="top"?"traceTop":"traceBottom";return Bn.get(C).color})()}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",flex:1,minWidth:0},children:[l.jsx("span",{style:{fontSize:"10px",fontWeight:"bold",lineHeight:1},children:"T"}),l.jsx("span",{style:{fontSize:"9px",lineHeight:1,opacity:.7},children:(()=>{const p=Qn==="top"?"traceTop":"traceBottom";return Bn.get(p).size})()})]})]}),l.jsxs("button",{ref:Fp,onClick:()=>{Xt||(console.log("Component tool clicked"),bt(),b("component"))},disabled:Xt,title:"Draw Component (C)",style:{width:"100%",height:32,display:"flex",alignItems:"center",gap:3,padding:"4px 3px",borderRadius:6,border:_==="component"?"2px solid #000":"1px solid #ddd",background:_==="component"?"#e6f0ff":"#fff",color:Xt?"#999":"#222",cursor:Xt?"not-allowed":"pointer",opacity:Xt?.5:1},children:[(()=>{const C=(wi||"top")==="top"?"componentTop":"componentBottom",D=Bn.get(C).color;return dc?l.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24","aria-hidden":"true",style:{flexShrink:0},children:[l.jsx("rect",{x:"4",y:"4",width:"16",height:"16",fill:"rgba(255,255,255,0.9)",stroke:D,strokeWidth:"1.5"}),l.jsx("text",{x:"12",y:"14",textAnchor:"middle",fontSize:"7",fill:D,fontWeight:"bold",fontFamily:"monospace",children:(()=>{const $=Jc?.componentDefinition?.designator??Jc?.designator;return $?$.length<=3?$:$.substring(0,3):Em(dc)})()})]}):l.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24","aria-hidden":"true",style:{flexShrink:0},children:[l.jsx("rect",{x:"5",y:"3",width:"14",height:"7",fill:D,stroke:D,strokeWidth:"0.5"}),l.jsxs("g",{stroke:D,fill:"none",strokeWidth:"1.5",children:[l.jsx("rect",{x:"5",y:"10",width:"14",height:"4",rx:"1.2"}),l.jsx("path",{d:"M7 14 v4 M10 14 v4 M13 14 v4 M16 14 v4",stroke:D})]})]})})(),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",flex:1,minWidth:0},children:[l.jsx("span",{style:{fontSize:"10px",fontWeight:"bold",lineHeight:1},children:"C"}),l.jsx("span",{style:{fontSize:"9px",lineHeight:1,opacity:.7},children:(()=>{const p=wi==="top"?"componentTop":"componentBottom";return Bn.get(p).size})()})]})]}),l.jsxs("button",{ref:Lh,onClick:()=>{Xt||(console.log("Power tool clicked"),bt(),In(!1),wn.length===1?(Ke(wn[0].id),b("power"),Ge(!1),x(!0)):wn.length>1?Ge(!0):(Ge(!0),b("power"),x(!0)))},disabled:Xt,title:"Draw Power (B)",style:{width:"100%",height:32,display:"flex",alignItems:"center",gap:3,padding:"4px 3px",borderRadius:6,border:_==="power"?"2px solid #000":"1px solid #ddd",background:_==="power"?"#e6f0ff":"#fff",color:Xt?"#999":"#222",cursor:Xt?"not-allowed":"pointer",opacity:Xt?.5:1},children:[l.jsx("span",{style:{color:(ct?wn.find(p=>p.id===ct)?.color:null)||"#ff0000",fontSize:"18px",fontWeight:"bold",lineHeight:1,flexShrink:0},children:"V"}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",flex:1,minWidth:0},children:[l.jsx("span",{style:{fontSize:"10px",fontWeight:"bold",lineHeight:1},children:"B"}),l.jsx("span",{style:{fontSize:"9px",lineHeight:1,opacity:.7},children:Bn.get("power").size})]})]}),l.jsxs("button",{ref:Qc,onClick:()=>{Xt||(console.log("Ground tool clicked"),Ge(!1),j.length===1?(Gn(j[0].id),b("ground"),In(!1),Ai(!0)):j.length>1?In(!0):(In(!0),b("ground"),Ai(!0)))},disabled:Xt,title:"Draw Ground (G)",style:{width:"100%",height:32,display:"flex",alignItems:"center",gap:3,padding:"4px 3px",borderRadius:6,border:_==="ground"?"2px solid #000":"1px solid #ddd",background:_==="ground"?"#e6f0ff":"#fff",color:Xt?"#999":"#222",cursor:Xt?"not-allowed":"pointer",opacity:Xt?.5:1},children:[l.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 20","aria-hidden":"true",style:{overflow:"visible",flexShrink:0},children:l.jsxs("g",{stroke:(Ei?j.find(p=>p.id===Ei)?.color:null)||"#000000",strokeWidth:"2",strokeLinecap:"round",children:[l.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"10"}),l.jsx("line",{x1:"5",y1:"10",x2:"19",y2:"10"}),l.jsx("line",{x1:"7",y1:"13",x2:"17",y2:"13"}),l.jsx("line",{x1:"9.5",y1:"16",x2:"14.5",y2:"16"})]})}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",flex:1,minWidth:0},children:[l.jsx("span",{style:{fontSize:"10px",fontWeight:"bold",lineHeight:1},children:"G"}),l.jsx("span",{style:{fontSize:"9px",lineHeight:1,opacity:.7},children:Bn.get("ground").size})]})]}),l.jsx("div",{style:{height:32}}),l.jsxs("button",{onClick:()=>{Xt||(bt(),b(p=>p==="pan"?"draw":"pan"))},disabled:Xt,title:"Move (H)",style:{width:"100%",height:32,display:"flex",alignItems:"center",gap:6,padding:"4px 6px",borderRadius:6,border:_==="pan"?"2px solid #000":"1px solid #ddd",background:_==="pan"?"#e6f0ff":"#fff",color:Xt?"#999":"#222",cursor:Xt?"not-allowed":"pointer",opacity:Xt?.5:1},children:[l.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24","aria-hidden":"true",style:{flexShrink:0},children:l.jsxs("g",{stroke:"#111",fill:"none",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M8 11v-4c0-.8.6-1.3 1.3-1.3S11 6.2 11 7v4"}),l.jsx("path",{d:"M11 11V6.5c0-.8.6-1.3 1.3-1.3S14 5.7 14 6.5V11"}),l.jsx("path",{d:"M14 11V7.2c0-.8.6-1.3 1.3-1.3.7 0 1.3.5 1.3 1.3V12c1 .6 1.6 1.5 1.6 2.7A4.3 4.3 0 0 1 14 19H9.2A4.2 4.2 0 0 1 5 14.8V11c0-.6.4-1 .9-1 .6 0 1 .4 1 1v2"})]})}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",flex:1,minWidth:0},children:[l.jsx("span",{style:{fontSize:"10px",fontWeight:"bold",lineHeight:1},children:"H"}),l.jsx("span",{style:{fontSize:"9px",lineHeight:1,opacity:.7},children:"-"})]})]}),l.jsxs("button",{onClick:()=>{bt(),Ql(!1),b(p=>p==="magnify"?"draw":"magnify")},title:"Magnify (M)",style:{width:"100%",height:32,display:"flex",alignItems:"center",gap:3,padding:"4px 3px",borderRadius:6,border:_==="magnify"?"2px solid #000":"1px solid #ddd",background:_==="magnify"?"#e6f0ff":"#fff",color:"#222",cursor:"pointer"},children:[l.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24","aria-hidden":"true",style:{flexShrink:0},children:[l.jsx("circle",{cx:"10",cy:"10",r:"7.5",fill:"none",stroke:"#111",strokeWidth:"2"}),l.jsx("line",{x1:"15.5",y1:"15.5",x2:"21",y2:"21",stroke:"#111",strokeWidth:"2",strokeLinecap:"round"}),Fa?l.jsx("line",{x1:"6.5",y1:"10",x2:"13.5",y2:"10",stroke:"#111",strokeWidth:"2.4",strokeLinecap:"round"}):l.jsxs(l.Fragment,{children:[l.jsx("line",{x1:"6.5",y1:"10",x2:"13.5",y2:"10",stroke:"#111",strokeWidth:"2.4",strokeLinecap:"round"}),l.jsx("line",{x1:"10",y1:"6.5",x2:"10",y2:"13.5",stroke:"#111",strokeWidth:"2.4",strokeLinecap:"round"})]})]}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",flex:1,minWidth:0},children:[l.jsx("span",{style:{fontSize:"10px",fontWeight:"bold",lineHeight:1},children:"M"}),l.jsx("span",{style:{fontSize:"9px",lineHeight:1,opacity:.7},children:"-"})]})]}),l.jsxs("button",{onClick:()=>{Xt||zo(!0)},disabled:Xt,title:"Change Perspective (E) - Open Change Perspective Dialog",style:{width:"100%",height:32,display:"flex",alignItems:"center",gap:3,padding:"4px 3px",borderRadius:6,border:cl?"2px solid #000":"1px solid #ddd",background:cl?"#e6f0ff":"#fff",color:Xt?"#999":"#222",cursor:Xt?"not-allowed":"pointer",opacity:Xt?.5:1},children:[l.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24","aria-hidden":"true",style:{flexShrink:0},children:[l.jsx("ellipse",{cx:"12",cy:"12",rx:"9",ry:"6",fill:"none",stroke:"#111",strokeWidth:"2"}),l.jsx("circle",{cx:"12",cy:"12",r:"4",fill:"none",stroke:"#111",strokeWidth:"2"}),l.jsx("circle",{cx:"11",cy:"11",r:"1.5",fill:"#111",stroke:"none"})]}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",flex:1,minWidth:0},children:[l.jsx("span",{style:{fontSize:"10px",fontWeight:"bold",lineHeight:1},children:"E"}),l.jsx("span",{style:{fontSize:"9px",lineHeight:1,opacity:.7},children:"-"})]})]}),l.jsxs("button",{onClick:()=>{Xt||(bt(),b("center"),ms(!0),os.current&&clearTimeout(os.current),os.current=setTimeout(()=>{ms(!1),b("select"),ta(void 0)},2e3))},disabled:Xt,title:"Set View (X) - Press 0-9 to Set View",style:{width:"100%",height:32,display:"flex",alignItems:"center",gap:3,padding:"4px 3px",borderRadius:6,border:_==="center"?"2px solid #000":"1px solid #ddd",background:_==="center"?"#e6f0ff":"#fff",color:Xt?"#999":"#222",cursor:Xt?"not-allowed":"pointer",opacity:Xt?.5:1},children:[l.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24","aria-hidden":"true",style:{flexShrink:0},children:[l.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"10",stroke:"#111",strokeWidth:"3",strokeLinecap:"round"}),l.jsx("line",{x1:"12",y1:"14",x2:"12",y2:"22",stroke:"#111",strokeWidth:"3",strokeLinecap:"round"}),l.jsx("line",{x1:"2",y1:"12",x2:"10",y2:"12",stroke:"#111",strokeWidth:"3",strokeLinecap:"round"}),l.jsx("line",{x1:"14",y1:"12",x2:"22",y2:"12",stroke:"#111",strokeWidth:"3",strokeLinecap:"round"})]}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",flex:1,minWidth:0},children:[l.jsx("span",{style:{fontSize:"10px",fontWeight:"bold",lineHeight:1},children:"X"}),l.jsx("span",{style:{fontSize:"9px",lineHeight:1,opacity:.7},children:"-"})]})]}),l.jsxs("div",{style:{position:"relative"},children:[l.jsx("button",{onClick:()=>{Xt||Ma(p=>!p)},disabled:Xt,title:"Color Picker",style:{width:32,height:32,display:"grid",placeItems:"center",borderRadius:6,border:"1px solid #ddd",background:"#fff",cursor:Xt?"not-allowed":"pointer",opacity:Xt?.5:1},children:l.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 16 16","aria-hidden":"true",children:[l.jsx("rect",{x:"0",y:"0",width:"3.5",height:"3.5",fill:"#9E9E9E",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"4",y:"0",width:"3.5",height:"3.5",fill:"#0072B2",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"8",y:"0",width:"3.5",height:"3.5",fill:"#56B4E9",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"12",y:"0",width:"3.5",height:"3.5",fill:"#00BFC4",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"0",y:"4",width:"3.5",height:"3.5",fill:"#6A3D9A",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"4",y:"4",width:"3.5",height:"3.5",fill:"#2CA02C",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"8",y:"4",width:"3.5",height:"3.5",fill:"#7FC97F",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"12",y:"4",width:"3.5",height:"3.5",fill:"#FF7F0E",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"0",y:"8",width:"3.5",height:"3.5",fill:"#FFD700",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"4",y:"8",width:"3.5",height:"3.5",fill:"#FF6B6B",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"8",y:"8",width:"3.5",height:"3.5",fill:"#E74C3C",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"12",y:"8",width:"3.5",height:"3.5",fill:"#FFB6C1",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"0",y:"12",width:"3.5",height:"3.5",fill:"#DDA0DD",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"4",y:"12",width:"3.5",height:"3.5",fill:"#8B4513",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"8",y:"12",width:"3.5",height:"3.5",fill:"#A0522D",stroke:"#ccc",strokeWidth:"0.3"}),l.jsx("rect",{x:"12",y:"12",width:"3.5",height:"3.5",fill:"#FF4500",stroke:"#ccc",strokeWidth:"0.3"})]})}),fd&&l.jsx("div",{ref:Il,style:{position:"absolute",left:42,top:0,padding:8,background:"#fff",border:"1px solid #ddd",borderRadius:6,boxShadow:"0 8px 18px rgba(0,0,0,0.18)",zIndex:50},children:l.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(8, 22px)",gap:4},children:Mc.map(p=>l.jsx("div",{onClick:()=>{q(p),Ma(!1);try{let D=null;_==="draw"&&ot==="via"?D="via":_==="draw"&&ot==="pad"?D=(Ti||"top")==="bottom"?"padBottom":"padTop":_==="draw"&&ot==="testPoint"?D=(On||"top")==="bottom"?"testPointBottom":"testPointTop":_==="draw"&&ot==="trace"?D=(Qn||"top")==="bottom"?"traceBottom":"traceTop":_==="component"?D=(wi||"top")==="bottom"?"componentBottom":"componentTop":_==="power"?D="power":_==="ground"&&(D="ground"),D&&Bn.setColor(D,p)}catch(D){console.error("Error updating tool instance color:",D)}const C=il($n);if(C)if(_==="draw"&&ot==="trace"){const D=Qn||"top",de=C.layerSettings.get(D)?.size||C.settings.size,be={color:p,size:de};Ra(C.id,D,be),sf(C.id),D==="top"?(Y(p),pt("trace",p,"top")):(I(p),pt("trace",p,"bottom"))}else if(_==="draw"&&ot==="pad"){const D=Ti||"top",de=C.layerSettings.get(D)?.size||C.settings.size,be={color:p,size:de};Ra(C.id,D,be),sf(C.id),D==="top"?(se(p),pt("pad",p,"top")):(ue(p),pt("pad",p,"bottom"))}else if(_==="draw"&&ot==="testPoint"){const D=On||"top",de=C.layerSettings.get(D)?.size||C.settings.size,be={color:p,size:de};Ra(C.id,D,be),sf(C.id),D==="top"?(xe(p),pt("testPoint",p,"top")):(Le(p),pt("testPoint",p,"bottom"))}else if(_==="component"){const D=wi||"top",de=C.layerSettings.get(D)?.size||C.settings.size,be={color:p,size:de};Ra(C.id,D,be),sf(C.id),D==="top"?(Mt(p),pt("component",p,"top")):(jt(p),pt("component",p,"bottom"))}else{const D={...C.settings,color:p};co(C.id,D),Tb(C.id,p,C.settings.size),_==="draw"&&ot==="via"&&pt("via",p)}pt("brush",p),li.size>0&&St(D=>D.map($=>li.has($.id)?($.type==="via"?(pt("via",p),Wn(de=>{const be=new Map(de),z=be.get("via");return z&&be.set("via",{...z,settings:{...z.settings,color:p}}),be})):$.type==="pad"?(pt("pad",p),Wn(de=>{const be=new Map(de),z=be.get("pad");return z&&be.set("pad",{...z,settings:{...z.settings,color:p}}),be})):$.type==="trace"&&pt("trace",p,$.layer),{...$,color:p}):$)),gn.size>0&&(pt("component",p),Bi(D=>D.map($=>gn.has($.id)?{...$,color:p}:$)),Kn(D=>D.map($=>gn.has($.id)?{...$,color:p}:$))),ui.size>0&&Ie(D=>D.map($=>ui.has($.id)?{...$,color:p}:$)),hi.size>0&&lt(D=>D.map($=>hi.has($.id)?{...$,color:p}:$))},title:p,style:{width:22,height:22,backgroundColor:p,border:p===B?"2px solid #333":"1px solid #ccc",cursor:"pointer"}},p))})})]}),l.jsx("div",{style:{height:32}}),l.jsx("button",{onClick:()=>{Xt||Lf()},disabled:Xt,title:"Project Notes",style:{width:32,height:32,display:"grid",placeItems:"center",borderRadius:6,border:"1px solid #ddd",background:"#fff",cursor:Xt?"not-allowed":"pointer",opacity:Xt?.5:1},children:l.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"2",fill:"#fff",stroke:"#FFD700",strokeWidth:"1"}),l.jsx("circle",{cx:"6",cy:"7",r:"1.5",fill:"#000"}),l.jsx("rect",{x:"9",y:"6",width:"8",height:"2",rx:"1",fill:"#000"}),l.jsx("circle",{cx:"6",cy:"11",r:"1.5",fill:"#000"}),l.jsx("rect",{x:"9",y:"10",width:"8",height:"2",rx:"1",fill:"#000"}),l.jsx("circle",{cx:"6",cy:"15",r:"1.5",fill:"#000"}),l.jsx("rect",{x:"9",y:"14",width:"8",height:"2",rx:"1",fill:"#000"}),l.jsx("circle",{cx:"6",cy:"19",r:"1.5",fill:"#000"}),l.jsx("rect",{x:"9",y:"18",width:"8",height:"2",rx:"1",fill:"#000"})]})}),l.jsx("button",{onClick:()=>{Xt||Mf()},disabled:Xt,title:"Test Points",style:{width:32,height:32,display:"grid",placeItems:"center",borderRadius:6,border:"1px solid #ddd",background:"#fff",cursor:Xt?"not-allowed":"pointer",opacity:Xt?.5:1},children:l.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("rect",{width:"24",height:"24",fill:"#FFD700"}),l.jsx("circle",{cx:"6",cy:"7",r:"1.5",fill:"#000"}),l.jsx("rect",{x:"9",y:"6",width:"8",height:"2",rx:"1",fill:"#000"}),l.jsx("circle",{cx:"6",cy:"11",r:"1.5",fill:"#000"}),l.jsx("rect",{x:"9",y:"10",width:"8",height:"2",rx:"1",fill:"#000"}),l.jsx("circle",{cx:"6",cy:"15",r:"1.5",fill:"#000"}),l.jsx("rect",{x:"9",y:"14",width:"8",height:"2",rx:"1",fill:"#000"}),l.jsx("circle",{cx:"6",cy:"19",r:"1.5",fill:"#000"}),l.jsx("rect",{x:"9",y:"18",width:"8",height:"2",rx:"1",fill:"#000"})]})})]}),_==="draw"&&ot==="trace"&&bu&&l.jsxs("div",{ref:Yd,style:{position:"absolute",padding:"4px 6px",background:"#fff",border:"2px solid #000",borderRadius:6,boxShadow:"0 2px 6px rgba(0,0,0,0.08)",zIndex:25},children:[l.jsxs("label",{className:"radio-label",style:{marginRight:6},children:[l.jsx("input",{type:"radio",name:"traceToolLayer",checked:Qn==="top",onChange:()=>{console.log("Trace tool Top clicked"),Ea.current="top",Us("top"),Ft("top"),q(O),X(J),Wn(p=>{const C=new Map(p),D=C.get("trace");return D&&C.set("trace",{...D,settings:{color:O,size:J}}),C}),Sd(!1),ys(!0),Sa(!0)}}),l.jsx("span",{children:"Top"})]}),l.jsxs("label",{className:"radio-label",children:[l.jsx("input",{type:"radio",name:"traceToolLayer",checked:Qn==="bottom",onChange:()=>{console.log("Trace tool Bottom clicked"),Ea.current="bottom",Us("bottom"),Ft("bottom"),q(W),X(Ce),Wn(p=>{const C=new Map(p),D=C.get("trace");return D&&C.set("trace",{...D,settings:{color:W,size:Ce}}),C}),Sd(!1),As(!0),Gs(!0)}}),l.jsx("span",{children:"Bottom"})]})]}),_==="draw"&&ot==="pad"&&Ku&&l.jsxs("div",{ref:wu,style:{position:"absolute",padding:"4px 6px",background:"#fff",border:"2px solid #000",borderRadius:6,boxShadow:"0 2px 6px rgba(0,0,0,0.08)",zIndex:25},children:[l.jsxs("label",{className:"radio-label",style:{marginRight:6},children:[l.jsx("input",{type:"radio",name:"padToolLayer",checked:Ti==="top",onChange:()=>{console.log("Pad tool Top clicked"),el.current="top",Pa("top"),Ft("top");const p=Bn.get("padTop");q(p.color),X(p.size),Wn(C=>{const D=new Map(C),$=D.get("pad");return $&&D.set("pad",{...$,settings:{color:p.color,size:p.size}}),D}),Zu(!1),ys(!0),Xs(!0)}}),l.jsx("span",{children:"Top"})]}),l.jsxs("label",{className:"radio-label",children:[l.jsx("input",{type:"radio",name:"padToolLayer",checked:Ti==="bottom",onChange:()=>{console.log("Pad tool Bottom clicked"),el.current="bottom",Pa("bottom"),Ft("bottom");const p=Bn.get("padBottom");q(p.color),X(p.size),Wn(C=>{const D=new Map(C),$=D.get("pad");return $&&D.set("pad",{...$,settings:{color:p.color,size:p.size}}),D}),Zu(!1),As(!0),no(!0)}}),l.jsx("span",{children:"Bottom"})]})]}),_==="draw"&&ot==="testPoint"&&Ju&&l.jsxs("div",{ref:Xd,style:{position:"absolute",padding:"4px 6px",background:"#fff",border:"2px solid #000",borderRadius:6,boxShadow:"0 2px 6px rgba(0,0,0,0.08)",zIndex:25},children:[l.jsxs("label",{className:"radio-label",style:{marginRight:6},children:[l.jsx("input",{type:"radio",name:"testPointToolLayer",checked:On==="top",onChange:()=>{console.log("Test Point tool Top clicked"),tl.current="top",Qo("top"),Ft("top"),q(oe),X(Ee),Wn(p=>{const C=new Map(p),D=C.get("testPoint");return D&&C.set("testPoint",{...D,settings:{color:oe,size:Ee}}),C}),vu(!1),ys(!0),ic(!0)}}),l.jsx("span",{children:"Top"})]}),l.jsxs("label",{className:"radio-label",children:[l.jsx("input",{type:"radio",name:"testPointToolLayer",checked:On==="bottom",onChange:()=>{console.log("Test Point tool Bottom clicked"),tl.current="bottom",Qo("bottom"),Ft("bottom"),q(re),X(Ze),Wn(p=>{const C=new Map(p),D=C.get("testPoint");return D&&C.set("testPoint",{...D,settings:{color:re,size:Ze}}),C}),vu(!1),As(!0),rc(!0)}}),l.jsx("span",{children:"Bottom"})]})]}),qe&&l.jsxs("div",{ref:Qu,style:{position:"absolute",padding:"4px 6px",background:"#fff",border:"2px solid #000",borderRadius:6,boxShadow:"0 2px 6px rgba(0,0,0,0.08)",zIndex:25,minWidth:"200px"},children:[l.jsx("div",{style:{marginBottom:"4px",fontWeight:600,fontSize:"12px",color:"#333"},children:"Select Power Bus:"}),wn.length===0?l.jsx("div",{style:{padding:"8px",color:"#666",fontSize:"12px"},children:"No power buses defined. Use Tools  Manage Power Buses to add one."}):[...wn].sort((p,C)=>{const D=be=>{const z=be.match(/([+-]?)(\d+\.?\d*)/);if(z){const Pe=z[1]||"+",ve=parseFloat(z[2]);return{absValue:Math.abs(ve),isNegative:Pe==="-",original:be}}return{absValue:1/0,isNegative:!1,original:be}},$=D(p.voltage),de=D(C.voltage);return $.absValue!==de.absValue?$.absValue-de.absValue:$.isNegative!==de.isNegative?$.isNegative?-1:1:0}).map(p=>l.jsx("button",{onClick:C=>{C.preventDefault(),C.stopPropagation(),Ke(p.id),_!=="power"&&(bt(),b("power"),x(!0)),Ge(!1)},style:{display:"block",width:"100%",textAlign:"left",padding:"4px 6px",marginBottom:"2px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",color:"#222"},children:l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[l.jsx("div",{style:{width:16,height:16,borderRadius:"50%",background:p.color,border:"1px solid #ccc"}}),l.jsxs("div",{children:[l.jsx("div",{style:{fontWeight:600,fontSize:"13px"},children:p.name}),l.jsx("div",{style:{fontSize:"11px",color:"#666"},children:p.voltage})]})]})},p.id)),l.jsx("div",{style:{height:1,background:"#ddd",margin:"4px 0"}}),l.jsx("button",{onClick:p=>{p.preventDefault(),p.stopPropagation(),Ge(!1),ne(!0)},style:{display:"block",width:"100%",textAlign:"left",padding:"4px 6px",marginBottom:"2px",background:"#f0f0f0",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",color:"#333",fontSize:"11px"},children:"Manage Power Buses"}),l.jsx("button",{onClick:p=>{p.preventDefault(),p.stopPropagation(),Ge(!1),Ke(null),b("select")},style:{display:"block",width:"100%",textAlign:"center",padding:"4px 6px",marginTop:"2px",background:"#f0f0f0",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",color:"#666",fontSize:"11px"},children:"Cancel"})]}),fn&&l.jsxs("div",{ref:eh,style:{position:"absolute",padding:"4px 6px",background:"#fff",border:"2px solid #000",borderRadius:6,boxShadow:"0 2px 6px rgba(0,0,0,0.08)",zIndex:25,minWidth:"200px"},children:[l.jsx("div",{style:{marginBottom:"4px",fontWeight:600,fontSize:"12px",color:"#333"},children:"Select Ground Bus:"}),j.length===0?l.jsx("div",{style:{padding:"8px",color:"#666",fontSize:"12px"},children:"No ground buses defined. Use Tools  Manage Ground Buses to add one."}):[...j].sort((p,C)=>p.name.localeCompare(C.name)).map(p=>{const C=p.id==="groundbus-earth",D=Ei===p.id;return l.jsx("button",{onClick:$=>{$.preventDefault(),$.stopPropagation(),Gn(p.id),_!=="ground"&&(bt(),b("ground"),Ai(!0)),In(!1)},style:{display:"block",width:"100%",textAlign:"left",padding:"4px 6px",marginBottom:"2px",background:D?"#e0e0e0":"#f5f5f5",border:D?"2px solid #000":"1px solid #ddd",borderRadius:4,cursor:"pointer",color:"#222"},children:l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[l.jsx("div",{style:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:C?l.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",style:{display:"block"},children:[l.jsx("line",{x1:"10",y1:"2",x2:"10",y2:"10",stroke:"#000",strokeWidth:"2",strokeLinecap:"round"}),l.jsx("line",{x1:"4",y1:"10",x2:"16",y2:"10",stroke:"#000",strokeWidth:"2",strokeLinecap:"round"}),l.jsx("line",{x1:"5",y1:"12.5",x2:"15",y2:"12.5",stroke:"#000",strokeWidth:"2",strokeLinecap:"round"}),l.jsx("line",{x1:"6",y1:"15",x2:"14",y2:"15",stroke:"#000",strokeWidth:"2",strokeLinecap:"round"})]}):l.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",style:{display:"block"},children:[l.jsx("circle",{cx:"10",cy:"10",r:"6",fill:"none",stroke:"#000",strokeWidth:"2"}),l.jsx("line",{x1:"10",y1:"2",x2:"10",y2:"18",stroke:"#000",strokeWidth:"2",strokeLinecap:"round"}),l.jsx("line",{x1:"2",y1:"10",x2:"18",y2:"10",stroke:"#000",strokeWidth:"2",strokeLinecap:"round"})]})}),l.jsx("div",{children:l.jsx("div",{style:{fontWeight:600,fontSize:"13px"},children:p.name})})]})},p.id)}),l.jsx("div",{style:{height:1,background:"#ddd",margin:"4px 0"}}),l.jsx("button",{onClick:p=>{p.preventDefault(),p.stopPropagation(),In(!1),hn(!0)},style:{display:"block",width:"100%",textAlign:"left",padding:"4px 6px",marginBottom:"2px",background:"#f0f0f0",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",color:"#333",fontSize:"11px"},children:"Manage Ground Buses"}),l.jsx("button",{onClick:p=>{p.preventDefault(),p.stopPropagation(),In(!1),Gn(null),b("select")},style:{display:"block",width:"100%",textAlign:"center",padding:"4px 6px",marginTop:"2px",background:"#f0f0f0",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",color:"#666",fontSize:"11px"},children:"Cancel"})]}),l.jsxs("div",{style:{position:"absolute",top:6,left:60,bottom:6,width:168,padding:6,display:"flex",flexDirection:"column",gap:2,background:"rgba(250,250,255,0.95)",borderRadius:8,border:"1px solid #ddd",boxShadow:"0 2px 6px rgba(0,0,0,0.08)",zIndex:3},children:[l.jsx("div",{style:{fontSize:11,fontWeight:700,color:"#333",marginBottom:2},children:"Layers"}),l.jsxs("div",{onClick:()=>Ft("top"),title:"Top layer",style:{cursor:"pointer",padding:2,borderRadius:4,border:Ut==="top"?"2px solid #0b5fff":"1px solid #ddd",background:"#fff"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:2},children:[l.jsx("div",{style:{fontSize:10,color:"#444",fontWeight:600},children:"Top Image"}),l.jsx("label",{className:"radio-label",style:{margin:0},children:l.jsx("input",{type:"checkbox",checked:Ur,onChange:p=>ys(p.target.checked)})})]}),l.jsx("canvas",{ref:tc,width:60,height:40,style:{width:"60px",height:"40px"}})]}),l.jsxs("div",{onClick:()=>Ft("bottom"),title:"Bottom layer",style:{cursor:"pointer",padding:2,borderRadius:4,border:Ut==="bottom"?"2px solid #0b5fff":"1px solid #ddd",background:"#fff"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:2},children:[l.jsx("div",{style:{fontSize:10,color:"#444",fontWeight:600},children:"Bottom Image"}),l.jsx("label",{className:"radio-label",style:{margin:0},children:l.jsx("input",{type:"checkbox",checked:zl,onChange:p=>As(p.target.checked)})})]}),l.jsx("canvas",{ref:hu,width:60,height:40,style:{width:"60px",height:"40px"}})]}),l.jsx("div",{style:{height:1,background:"#000",margin:"4px 0"}}),l.jsxs("label",{className:"radio-label",style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:Ar,onChange:p=>$s(p.target.checked)}),l.jsx("span",{children:"Vias"})]}),l.jsx("div",{style:{height:1,background:"#000",margin:"4px 0"}}),l.jsxs("label",{className:"radio-label",style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:Cr,onChange:p=>Sa(p.target.checked)}),l.jsx("span",{children:"Traces (Top)"})]}),l.jsxs("label",{className:"radio-label",style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:Vi,onChange:p=>sa(p.target.checked)}),l.jsx("span",{children:"Components (Top)"})]}),l.jsxs("label",{className:"radio-label",style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:Ys,onChange:p=>Xs(p.target.checked)}),l.jsx("span",{children:"Pads (Top)"})]}),l.jsxs("label",{className:"radio-label",style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:So,onChange:p=>ic(p.target.checked)}),l.jsx("span",{children:"Test Points (Top)"})]}),l.jsx("div",{style:{height:1,background:"#000",margin:"4px 0"}}),l.jsxs("label",{className:"radio-label",style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:cs,onChange:p=>Gs(p.target.checked)}),l.jsx("span",{children:"Traces (Bottom)"})]}),l.jsxs("label",{className:"radio-label",style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:Ks,onChange:p=>Aa(p.target.checked)}),l.jsx("span",{children:"Components (Bottom)"})]}),l.jsxs("label",{className:"radio-label",style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:tr,onChange:p=>no(p.target.checked)}),l.jsx("span",{children:"Pads (Bottom)"})]}),l.jsxs("label",{className:"radio-label",style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:Uo,onChange:p=>rc(p.target.checked)}),l.jsx("span",{children:"Test Points (Bottom)"})]}),l.jsx("div",{style:{height:1,background:"#000",margin:"4px 0"}}),l.jsxs("label",{className:"radio-label",style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:Ha,onChange:p=>x(p.target.checked)}),l.jsx("span",{children:"Power"})]}),l.jsxs("label",{className:"radio-label",style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:mr,onChange:p=>Ai(p.target.checked)}),l.jsx("span",{children:"Ground"})]}),l.jsxs("label",{className:"radio-label",style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:yr,onChange:p=>Hr(p.target.checked)}),l.jsx("span",{children:"Connections"})]}),l.jsx("div",{style:{height:1,background:"#000",margin:"4px 0"}}),l.jsxs("label",{className:"radio-label",style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:Ar&&Ys&&tr&&So&&Uo&&Cr&&cs&&Vi&&Ks&&Ha&&mr&&yr,onChange:p=>{const C=p.target.checked;$s(C),Xs(C),no(C),ic(C),rc(C),Sa(C),Gs(C),sa(C),Aa(C),x(C),Ai(C),Hr(C)}}),l.jsx("span",{style:{fontWeight:600,fontSize:11},children:"Select All Layers"})]}),l.jsx("div",{style:{height:1,background:"#000",margin:"4px 0"}}),l.jsxs("div",{style:{marginTop:6},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[l.jsxs("label",{style:{fontSize:10,color:"#333"},children:["Transparency: ",h,"%"]}),l.jsxs("label",{className:"radio-label",style:{margin:0},children:[l.jsx("input",{type:"checkbox",checked:m,onChange:p=>{const C=p.target.checked;C?(ys(!0),As(!0)):(f(50),b("select")),y(C)}}),l.jsx("span",{style:{marginLeft:6,fontSize:10},children:"Cycle"})]})]}),l.jsx("input",{type:"range",min:"0",max:"100",value:h,onChange:p=>f(Number(p.target.value)),onDoubleClick:()=>td("transparency"),className:"slider",style:{width:"100%",marginTop:3}}),m&&l.jsxs("div",{style:{marginTop:6},children:[l.jsxs("label",{style:{fontSize:10,color:"#333"},children:["Cycle Speed: ",(A/1e3).toFixed(1),"s"]}),l.jsx("input",{type:"range",min:"500",max:"8000",step:"100",value:8500-A,onChange:p=>v(8500-Number(p.target.value)),onDoubleClick:()=>v(2e3),className:"slider",style:{width:"100%",marginTop:3}})]})]})]}),l.jsx(xC,{visible:!t&&!r,canvasSize:Ml,canvasPosition:{left:244,top:6}}),l.jsx("canvas",{ref:ur,width:Ml.width,height:Ml.height,tabIndex:0,onMouseDown:Hp,onMouseMove:Wp,onMouseUp:sh,onMouseLeave:sh,onWheel:Vp,onDoubleClick:qp,className:`pcb-canvas ${_==="transform"?"transform-cursor":_==="draw"?"draw-cursor":_==="erase"?"erase-cursor":"default-cursor"}`,style:{position:"absolute",left:"244px",top:"6px",...$c?{cursor:$c}:_==="pan"?{cursor:fl?"grabbing":"grab"}:{},width:`${Ml.width}px`,height:`${Ml.height}px`,maxHeight:"none",aspectRatio:"auto",border:"none"}}),Ia&&l.jsxs("div",{style:{position:"absolute",left:`${244+Ml.width-120}px`,top:`${6+Ml.height+4}px`,fontSize:"11px",fontFamily:"monospace",color:"#333",backgroundColor:"rgba(255, 255, 255, 0.9)",padding:"2px 6px",borderRadius:"3px",border:"1px solid #ccc",pointerEvents:"none",zIndex:1e3},children:["(",Ia.x.toFixed(1),"mm, ",Ia.y.toFixed(1),"mm)"]}),l.jsx(_T,{componentEditor:Vs,setComponentEditor:Xa,componentsTop:Gt,componentsBottom:an,setComponentsTop:Bi,setComponentsBottom:Kn,connectingPin:as,setConnectingPin:rl,componentDialogPosition:Da,setComponentDialogPosition:Ka,isDraggingDialog:sl,setIsDraggingDialog:Ac,dialogDragOffset:Yl,setDialogDragOffset:kl,areComponentsLocked:Or,setSelectedComponentIds:jn,setNotesDialogVisible:Ii,projectDirHandle:Pi,showGeminiSettingsDialog:fu,onGeminiSettingsDialogClose:()=>nc(!1),onFindComponent:Zc,componentDefinition:Vs?(()=>{const p=Gt.find(C=>C.id===Vs.id)||an.find(C=>C.id===Vs.id);return p?Vc(p):void 0})():void 0}),Ds&&Oa&&(()=>{const p=Ds.component,C=Ds.layer;if(!p)return null;const D=p.componentType||"Component",$=p.componentType==="IntegratedCircuit"&&"icType"in p?p.icType:null,de=zp(p),be=Vc(p),z=be?.category==="Semiconductors",Pe=p?.pinNames,ve=be?.properties?.pinNames,Re=8,je=8,_e=200,fe=150,ye=10;let pe=Ds.x+Re,ge=Ds.y+je;return pe+_e+ye>window.innerWidth&&(pe=Ds.x-_e-Re),ge+fe+ye>window.innerHeight&&(ge=Ds.y-fe-je),pe=Math.max(ye,Math.min(pe,window.innerWidth-_e-ye)),ge=Math.max(ye,Math.min(ge,window.innerHeight-fe-ye)),l.jsxs("div",{style:{position:"fixed",left:`${pe}px`,top:`${ge}px`,background:"rgba(0, 0, 0, 0.85)",color:"#fff",padding:"8px 12px",borderRadius:4,fontSize:"12px",lineHeight:"1.4",zIndex:1e4,pointerEvents:"none",width:"max-content",maxWidth:"400px",minWidth:"150px",boxShadow:"0 2px 8px rgba(0,0,0,0.3)",wordWrap:"break-word",overflowWrap:"break-word"},children:[l.jsx("div",{style:{fontWeight:600,marginBottom:"4px"},children:wc(D)}),l.jsxs("div",{style:{marginBottom:"4px",color:"#e0e0e0",fontSize:"11px"},children:["Layer: ",C==="top"?"Top":"Bottom"]}),$&&l.jsxs("div",{style:{marginBottom:"4px",color:"#e0e0e0",fontSize:"11px"},children:["IC Type: ",$]}),de.length>0&&l.jsx("div",{style:{marginBottom:"4px"},children:de.map((Me,De)=>l.jsx("div",{style:{color:"#e0e0e0",fontSize:"11px",marginBottom:"2px"},children:Me},De))}),p.description&&l.jsx("div",{style:{marginBottom:"4px",color:"#e0e0e0",fontSize:"11px"},children:p.description}),p.notes&&l.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid rgba(255,255,255,0.2)",fontSize:"11px",color:"#d0d0d0",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:p.notes}),z&&p.pinCount>0&&(()=>{const Me=Array.from({length:p.pinCount},(De,$e)=>{const ht=p.pinConnections&&p.pinConnections.length>$e?p.pinConnections[$e]:"",xt=Pe&&$e<Pe.length?Pe[$e]:"",Tt=ve&&$e<ve.length?ve[$e]:"",Je=Tt==="CHIP_DEPENDENT",qt=xt&&xt.trim()!==""?xt:Je?"":Tt;return{pin:$e+1,name:qt||"-",nodeId:ht||"-"}});return l.jsxs("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.2)"},children:[l.jsx("div",{style:{fontSize:"11px",fontWeight:600,marginBottom:"4px",color:"#fff"},children:"Pin Connections:"}),l.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"10px"},children:[l.jsx("thead",{children:l.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.3)"},children:[l.jsx("th",{style:{textAlign:"left",padding:"2px 6px",fontWeight:600,color:"#fff"},children:"Pin"}),l.jsx("th",{style:{textAlign:"left",padding:"2px 6px",fontWeight:600,color:"#fff"},children:"Name"}),l.jsx("th",{style:{textAlign:"left",padding:"2px 6px",fontWeight:600,color:"#fff"},children:"Node ID"})]})}),l.jsx("tbody",{children:Me.map((De,$e)=>l.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[l.jsx("td",{style:{padding:"2px 6px",color:"#e0e0e0",fontFamily:"monospace"},children:De.pin}),l.jsx("td",{style:{padding:"2px 6px",color:"#e0e0e0",fontStyle:De.name!=="-"?"italic":"normal"},children:De.name}),l.jsx("td",{style:{padding:"2px 6px",color:"#e0e0e0",fontFamily:"monospace"},children:De.nodeId})]},$e))})]})]})})()]})})(),yd&&Oa&&(()=>{const p=yd.stroke;return p.notes?l.jsxs("div",{style:{position:"fixed",left:`${yd.x+10}px`,top:`${yd.y+10}px`,background:"rgba(0, 0, 0, 0.85)",color:"#fff",padding:"8px 12px",borderRadius:4,fontSize:"12px",lineHeight:"1.4",zIndex:1e4,pointerEvents:"none",width:"max-content",maxWidth:"400px",minWidth:"150px",boxShadow:"0 2px 8px rgba(0,0,0,0.3)",wordWrap:"break-word",overflowWrap:"break-word"},children:[l.jsx("div",{style:{fontWeight:600,marginBottom:"4px"},children:"Test Point"}),l.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid rgba(255,255,255,0.2)",fontSize:"11px",color:"#d0d0d0",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:p.notes})]}):null})(),At&&At.visible&&(()=>{if(!S.find(D=>D.id===At.id))return null;const C=wn.find(D=>D.id===At.powerBusId);return l.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#fff",border:"1px solid #0b5fff",borderRadius:4,padding:"6px",boxShadow:"0 2px 6px rgba(0,0,0,0.15)",zIndex:1e3,minWidth:"175px",maxWidth:"250px",maxHeight:"40vh",overflowY:"auto",pointerEvents:"auto"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[l.jsx("h3",{style:{margin:0,fontSize:"12px",color:"#333",fontWeight:600},children:"Power Properties"}),l.jsx("button",{onClick:()=>ln(null),style:{background:"transparent",border:"none",fontSize:"14px",cursor:"pointer",color:"#666",padding:0,width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[l.jsxs("div",{children:[l.jsx("label",{style:{display:"block",fontSize:"9px",fontWeight:600,color:"#333",marginBottom:"1px"},children:"Power Bus:"}),l.jsx("div",{style:{padding:"2px 3px",background:"#f5f5f5",borderRadius:2,fontSize:"10px",color:"#666"},children:C?`${C.name} (${C.voltage})`:"Unknown"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:`power-layer-${At.id}`,style:{display:"block",fontSize:"9px",fontWeight:600,color:"#333",marginBottom:"1px"},children:"Layer:"}),l.jsxs("select",{id:`power-layer-${At.id}`,name:`power-layer-${At.id}`,value:At.layer,onChange:D=>ln({...At,layer:D.target.value}),disabled:fi,style:{width:"100%",padding:"2px 3px",border:"1px solid #ddd",borderRadius:2,fontSize:"10px",opacity:fi?.6:1},children:[l.jsx("option",{value:"top",children:"Top"}),l.jsx("option",{value:"bottom",children:"Bottom"})]})]}),l.jsxs("div",{children:[l.jsx("label",{style:{display:"block",fontSize:"9px",fontWeight:600,color:"#333",marginBottom:"1px"},children:"X:"}),l.jsx("div",{style:{padding:"2px 3px",background:"#f5f5f5",borderRadius:2,fontSize:"10px",color:"#666"},children:At.x.toFixed(2)})]}),l.jsxs("div",{children:[l.jsx("label",{style:{display:"block",fontSize:"9px",fontWeight:600,color:"#333",marginBottom:"1px"},children:"Y:"}),l.jsx("div",{style:{padding:"2px 3px",background:"#f5f5f5",borderRadius:2,fontSize:"10px",color:"#666"},children:At.y.toFixed(2)})]})]}),l.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"3px",marginTop:"6px"},children:[l.jsx("button",{onClick:()=>ln(null),style:{padding:"2px 5px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:2,cursor:"pointer",fontSize:"10px",color:"#333"},children:"Cancel"}),l.jsx("button",{onClick:()=>{fi||(Ie(D=>D.map($=>$.id===At.id?{...$,layer:At.layer}:$)),ln(null))},disabled:fi,style:{padding:"2px 5px",background:fi?"#f5f5f5":"#0b5fff",color:fi?"#999":"#fff",border:"1px solid #ddd",borderRadius:2,cursor:fi?"not-allowed":"pointer",fontSize:"10px"},children:"Save"})]})]})})(),!t&&!r&&l.jsx("div",{className:"placeholder"})]})}),l.jsx(DT,{visible:F,onClose:()=>ne(!1),powerBuses:wn,setPowerBuses:Ro,editingPowerBusId:ae,setEditingPowerBusId:ce,powers:S}),l.jsx(LT,{visible:Nt,onClose:()=>hn(!1),groundBuses:j,setGroundBuses:te,editingGroundBusId:dn,setEditingGroundBusId:ni,grounds:P}),l.jsx(FT,{visible:me,projectDirHandle:Pi,onClose:()=>{we(!1),Fe(void 0)},onRestore:$o,position:Te,isDragging:et,onDragStart:mc}),l.jsx(MT,{visible:di,onClose:()=>nr(!1),autoAssignDesignators:en,setAutoAssignDesignators:Vt,useGlobalDesignatorCounters:lr,setUseGlobalDesignatorCounters:Dn}),l.jsx("input",{ref:Od,type:"file",accept:".png,.jpg,.jpeg,image/png,image/jpeg",style:{display:"none"},onChange:p=>{const C=p.target.files?.[0];C&&Ta(C,"top"),p.target.value=""}}),l.jsx("input",{ref:ia,type:"file",accept:".png,.jpg,.jpeg,image/png,image/jpeg",style:{display:"none"},onChange:p=>{const C=p.target.files?.[0];C&&Ta(C,"bottom"),p.target.value=""}}),l.jsx("input",{ref:Ba,type:"file",accept:".json,application/json",style:{display:"none"},onChange:async p=>{const C=p.target.files?.[0];if(C)try{Cd(),await new Promise(z=>setTimeout(z,0)),br(C.name);const D=await C.text(),$=JSON.parse(D);await Td($,null);let be;$.projectInfo?.name?be=$.projectInfo.name:(be=C.name.replace(/\.json$/i,"").replace(/[^a-zA-Z0-9_-]/g,"_")||"pcb_project",za(be)),Qr||za(be),setTimeout(()=>{hs({visible:!0,source:"open",interval:5})},100)}catch(D){console.error("Failed to open project",D),alert("Failed to open project file. See console for details.")}p.target.value=""}}),l.jsx(bC,{visible:Qa.visible,selectedIds:li,selectedComponentIds:gn,selectedPowerIds:ui,selectedGroundIds:hi,drawingStrokes:Qe,componentsTop:Gt,componentsBottom:an,powers:S,grounds:P,powerBuses:wn,onClose:()=>{ll({visible:!1,text:""})},setComponentsTop:Bi,setComponentsBottom:Kn,determineViaType:Vo,determinePadType:yl,determineTestPointType:Ca,onFindComponent:Zc,onFindStroke:wd,onFindPower:Ep,onFindGround:_f,onOpenNotesDialog:()=>Ii(!0),position:ai,isDragging:Gi,onDragStart:p=>{ai&&(Yi({x:p.clientX-ai.x,y:p.clientY-ai.y}),Cs(!0),p.preventDefault())}}),l.jsx(vC,{visible:es,selectedIds:li,selectedComponentIds:gn,selectedPowerIds:ui,selectedGroundIds:hi,drawingStrokes:Qe,componentsTop:Gt,componentsBottom:an,powers:S,grounds:P,powerBuses:wn,onClose:()=>{Ii(!1)},setComponentsTop:Bi,setComponentsBottom:Kn,setDrawingStrokes:St,setPowerSymbols:Ie,setGroundSymbols:lt,determineViaType:Vo,determinePadType:yl,determineTestPointType:Ca,position:Mr,isDragging:xr,onDragStart:p=>{Mr&&(ns({x:p.clientX-Mr.x,y:p.clientY-Mr.y}),qi(!0),p.preventDefault())}}),l.jsx(wC,{visible:Wi,projectNotes:Nn,setProjectNotes:En,onClose:()=>{aa(!1)},position:oa,isDragging:ds,onDragStart:p=>{oa?(xd({x:p.clientX-oa.x,y:p.clientY-oa.y}),Bl(!0),p.preventDefault()):(Ms({x:p.clientX-300,y:p.clientY-200}),xd({x:300,y:200}),Bl(!0),p.preventDefault())}}),l.jsx(SC,{visible:vr,drawingStrokes:Qe,onClose:()=>{pu(!1)},onFindTestPoint:y0,position:jc,isDragging:gl,onDragStart:p=>{jc?(Ud({x:p.clientX-jc.x,y:p.clientY-jc.y}),Xu(!0),p.preventDefault()):(Nc({x:p.clientX-300,y:p.clientY-200}),Ud({x:300,y:200}),Xu(!0),p.preventDefault())},determineTestPointType:Ca,powerBuses:wn}),l.jsx(e2,{visible:xa.visible,title:"New Project",message:"You have unsaved changes. Do you want to save your project before creating a new one?",onYes:gc,onNo:Zp,onCancel:Jp,yesButtonRef:Pr}),l.jsx(e2,{visible:Mo.visible,title:"Open Project",message:"You have unsaved changes. Do you want to save your project before opening another one?",onYes:hh,onNo:Ff,onCancel:yc,yesButtonRef:Mi}),Li.visible&&l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10002},onClick:p=>{p.target===p.currentTarget&&Wh()},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"24px",minWidth:"400px",maxWidth:"500px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid #1f1f24"},onClick:p=>p.stopPropagation(),children:[l.jsx("h2",{style:{margin:"0 0 16px 0",fontSize:"18px",fontWeight:600,color:"#f2f2f2"},children:"New Project"}),l.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",color:"#e0e0e0",fontWeight:500},children:"Project Name:"}),l.jsx("input",{ref:Ua,type:"text",value:Li.projectName,onChange:p=>{Io(C=>({...C,projectName:p.target.value}))},onKeyDown:p=>{p.key==="Enter"?(p.preventDefault(),Xp()):p.key==="Escape"&&(p.preventDefault(),Wh())},style:{width:"100%",padding:"8px 12px",marginBottom:"8px",background:"#1f1f24",border:"1px solid #444",borderRadius:6,color:"#f2f2f2",fontSize:"14px"},placeholder:"e.g., my_pcb_project",autoFocus:!0}),Li.projectName&&(()=>{const p=Li.projectName.match(/[^a-zA-Z0-9_-]/g);if(p){const C=[...new Set(p)];return l.jsxs("div",{style:{marginBottom:"12px",padding:"6px 10px",background:"#3a1f1f",border:"1px solid #a44",borderRadius:4,fontSize:"12px",color:"#ffaaaa"},children:["Invalid characters: ",C.map(D=>`"${D}"`).join(", "),". Only letters, numbers, underscore (_), and hyphen (-) are allowed."]})}return null})(),l.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",color:"#e0e0e0",fontWeight:500},children:"Location:"}),l.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"12px"},children:[l.jsx("input",{type:"text",value:Li.locationPath||"Not selected",readOnly:!0,style:{flex:1,padding:"8px 12px",background:"#1f1f24",border:"1px solid #444",borderRadius:6,color:Li.locationPath?"#f2f2f2":"#888",fontSize:"14px",cursor:"not-allowed"},placeholder:"Select a location..."}),l.jsx("button",{onClick:ka,style:{padding:"8px 16px",background:"#555",color:"#f2f2f2",border:"1px solid #666",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:500,whiteSpace:"nowrap"},children:"Browse..."})]}),Li.projectName&&Li.locationPath&&l.jsxs("div",{style:{marginBottom:"20px",padding:"8px 12px",background:"#1a1a1f",border:"1px solid #333",borderRadius:6,fontSize:"12px",color:"#aaa",fontFamily:"monospace"},children:[l.jsx("div",{style:{marginBottom:"4px",color:"#888"},children:"Project will be created at:"}),l.jsx("div",{style:{color:"#4CAF50"},children:(()=>{if(!Li.projectName||!Li.locationPath)return"";const C=Li.projectName.trim().replace(/[^a-zA-Z0-9_-]/g,"_")||"pcb_project",D=`${C}.json`;return Li.locationPath===C?`${Li.locationPath}/${D}`:`${Li.locationPath}/${C}/${D}`})()})]}),l.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[l.jsx("button",{onClick:Wh,style:{padding:"8px 16px",background:"#444",color:"#f2f2f2",border:"1px solid #555",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:500},children:"Cancel"}),l.jsx("button",{onClick:Xp,disabled:!Li.projectName.trim()||!Li.locationHandle,style:{padding:"8px 16px",background:!Li.projectName.trim()||!Li.locationHandle?"#555":"#4CAF50",color:"#fff",border:"1px solid "+(!Li.projectName.trim()||!Li.locationHandle?"#666":"#45a049"),borderRadius:6,cursor:!Li.projectName.trim()||!Li.locationHandle?"not-allowed":"pointer",fontSize:"14px",fontWeight:600,opacity:!Li.projectName.trim()||!Li.locationHandle?.6:1},children:"Create"})]})]})}),fr.visible&&l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10002},onClick:p=>{p.target===p.currentTarget&&ro()},children:l.jsxs("div",{style:{backgroundColor:"#2b2b31",borderRadius:8,padding:"24px",minWidth:"400px",maxWidth:"500px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid #1f1f24"},onClick:p=>p.stopPropagation(),children:[l.jsx("h2",{style:{margin:"0 0 16px 0",fontSize:"18px",fontWeight:600,color:"#f2f2f2"},children:"Save As"}),l.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",color:"#e0e0e0",fontWeight:500},children:"File Name:"}),l.jsx("input",{ref:ls,type:"text",value:fr.filename,onChange:p=>{jr(C=>({...C,filename:p.target.value}))},onKeyDown:p=>{p.key==="Enter"?(p.preventDefault(),is()):p.key==="Escape"&&(p.preventDefault(),ro())},style:{width:"100%",padding:"8px 12px",marginBottom:"8px",background:"#1f1f24",border:"1px solid #444",borderRadius:6,color:"#f2f2f2",fontSize:"14px"},placeholder:"e.g., my_project.json",autoFocus:!0}),l.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",color:"#e0e0e0",fontWeight:500},children:"Location:"}),l.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"12px"},children:[l.jsx("input",{type:"text",value:fr.locationPath||"Not selected",readOnly:!0,style:{flex:1,padding:"8px 12px",background:"#1f1f24",border:"1px solid #444",borderRadius:6,color:fr.locationPath?"#f2f2f2":"#888",fontSize:"14px",cursor:"not-allowed"},placeholder:"Select a location..."}),l.jsx("button",{onClick:Kp,style:{padding:"8px 16px",background:"#555",color:"#f2f2f2",border:"1px solid #666",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:500,whiteSpace:"nowrap"},children:"Browse..."})]}),fr.filename&&fr.locationPath&&l.jsxs("div",{style:{marginBottom:"20px",padding:"8px 12px",background:"#1a1a1f",border:"1px solid #333",borderRadius:6,fontSize:"12px",color:"#aaa",fontFamily:"monospace"},children:[l.jsx("div",{style:{marginBottom:"4px",color:"#888"},children:"File will be saved at:"}),l.jsxs("div",{style:{color:"#4CAF50"},children:[fr.locationPath,"/",fr.filename.endsWith(".json")?fr.filename:`${fr.filename}.json`]})]}),l.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[l.jsx("button",{onClick:ro,style:{padding:"8px 16px",background:"#444",color:"#f2f2f2",border:"1px solid #555",borderRadius:6,cursor:"pointer",fontSize:"14px",fontWeight:500},children:"Cancel"}),l.jsx("button",{onClick:is,disabled:!fr.filename.trim()||!fr.locationHandle,style:{padding:"8px 16px",background:!fr.filename.trim()||!fr.locationHandle?"#555":"#4CAF50",color:"#fff",border:"1px solid "+(!fr.filename.trim()||!fr.locationHandle?"#666":"#45a049"),borderRadius:6,cursor:!fr.filename.trim()||!fr.locationHandle?"not-allowed":"pointer",fontSize:"14px",fontWeight:600,opacity:!fr.filename.trim()||!fr.locationHandle?.6:1},children:"Save"})]})]})}),l.jsx(Q2,{visible:go.visible,title:go.title,message:go.message,onClose:()=>mo({visible:!1,title:"",message:""})}),l.jsx(AC,{visible:Rh,dimensions:Rc,onSave:p=>{mu(p)},onClose:()=>Wd(!1)}),l.jsx(CC,{visible:_l,onClose:()=>{let p=0,C=0;t?(p=t.x,C=t.y):r&&(p=r.x,C=r.y),Ll(D=>({...D,0:{pcbReferenceX:p,pcbReferenceY:C,x:0,y:0,zoom:_t,viewRotation:Xn,viewFlipX:ri,isBottomView:ba,transparency:h,showTopImage:Ur,showBottomImage:zl,showViasLayer:Ar,showTopTracesLayer:Cr,showBottomTracesLayer:cs,showTopPadsLayer:Ys,showBottomPadsLayer:tr,showTopTestPointsLayer:So,showBottomTestPointsLayer:Uo,showTopComponents:Vi,showBottomComponents:Ks,showPowerLayer:Ha,showGroundLayer:mr,showConnectionsLayer:yr}})),Es(!1)},topImage:t,bottomImage:r,selectedImageForTransform:Ut,setSelectedImageForTransform:zi,transformMode:ti,setTransformMode:vi,updateImageTransform:ku,resetImageTransform:zh,setCurrentTool:b,isGrayscale:N,setIsGrayscale:T,areImagesLocked:Fi}),l.jsx(TC,{visible:cl,onClose:()=>zo(!1),topImage:t,bottomImage:r,setTopImage:n,setBottomImage:o,componentsTop:Gt,componentsBottom:an,setComponentsTop:Bi,setComponentsBottom:Kn,drawingStrokes:Qe,setDrawingStrokes:St,powerSymbols:S,groundSymbols:P,setPowerSymbols:Ie,setGroundSymbols:lt,canvasRef:ur,isBottomView:ba,setIsBottomView:Ws,originalTopFlipX:va,setOriginalTopFlipX:yo,originalBottomFlipX:er,setOriginalBottomFlipX:Hi,originalTopFlipY:Nr,setOriginalTopFlipY:ps,originalBottomFlipY:jl,setOriginalBottomFlipY:dl,cameraWorldCenter:Di,setCameraWorldCenter:Ni,viewScale:_t,viewRotation:Xn,setViewRotation:ci,viewFlipX:ri,setViewFlipX:Br,contentBorder:5,setTransparency:f}),l.jsx(RT,{visible:x0,selectedLayer:wi,selectedComponentType:dc,selectedComponentKey:Pf,onLayerChange:p=>{fa(p),Ga.current=p,Ft(p),q(p==="top"?mt:K),X(p==="top"?$t:yt),p==="top"?(ys(!0),sa(!0)):(As(!0),Aa(!0))},onComponentTypeChange:(p,C,D)=>{Kd(p),Dh(C),Bp(D||null),Zd.current=p},onClose:()=>{Nf(!1),Fr(!0),b("select")}}),l.jsx(IT,{visible:qs.visible,size:qs.size,onSizeChange:p=>Do(C=>({...C,size:p})),onApply:$p,onCancel:()=>Do({visible:!1,size:6})}),l.jsx(zT,{visible:Tc.visible,interval:Tc.interval,onIntervalChange:p=>Lo({visible:!0,interval:p}),onApply:()=>Oh(Tc.interval,!1),onCancel:()=>Lo({visible:!1,interval:5})}),l.jsx(BT,{visible:ya.visible,interval:ya.interval,onIntervalChange:p=>hs({...ya,interval:p}),onEnable:()=>Oh(ya.interval,!0),onSkip:Df}),l.jsx(WT,{visible:gu,isPad:Wr,onConfirm:p=>{Xc({numPins:p.numPins,type:p.type,twoSidedOrientation:p.twoSidedOrientation,point1:{x:0,y:0},point2:{x:0,y:0}}),ml(!0),b("select"),qr(!1)},onClose:()=>{qr(!1)}}),l.jsx("div",{style:{position:"fixed",bottom:8,right:8,zIndex:100},children:l.jsxs("button",{onClick:()=>{window.open("https://github.com/sponsors/pgiacalo","_blank","noopener,noreferrer")},style:{display:"flex",alignItems:"center",gap:6,padding:"6px 12px",background:"linear-gradient(180deg, #f6f8fa 0%, #ebecef 100%)",border:"1px solid rgba(27, 31, 36, 0.15)",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:500,color:"#24292f",boxShadow:"0 1px 0 rgba(27, 31, 36, 0.04)",transition:"background 0.2s"},onMouseEnter:p=>{p.currentTarget.style.background="linear-gradient(180deg, #f3f4f6 0%, #e5e6e9 100%)"},onMouseLeave:p=>{p.currentTarget.style.background="linear-gradient(180deg, #f6f8fa 0%, #ebecef 100%)"},title:"Donate to support this project",children:[l.jsx("svg",{height:"16",width:"16",viewBox:"0 0 16 16",fill:"#bf3989","aria-hidden":"true",children:l.jsx("path",{d:"M4.25 2.5c-1.336 0-2.75 1.164-2.75 3 0 2.15 1.58 4.144 3.365 5.682A20.565 20.565 0 008 13.393a20.561 20.561 0 003.135-2.211C12.92 9.644 14.5 7.65 14.5 5.5c0-1.836-1.414-3-2.75-3-1.373 0-2.609.986-3.029 2.456a.749.749 0 01-1.442 0C6.859 3.486 5.623 2.5 4.25 2.5z"})}),"Donate"]})})]})}Vw.createRoot(document.getElementById("root")).render(l.jsx(U.StrictMode,{children:l.jsx(d4,{})}));export{zr as _,h4 as c,Dw as g};
