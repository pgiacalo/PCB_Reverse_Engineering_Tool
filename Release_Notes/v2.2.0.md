# Release Notes - v2.2.0

## Overview
Version 2.2.0 introduces significant improvements to tool state management, a new Project Notes / TODO List feature, numerous bug fixes, and enhanced user experience improvements.

## Major Features

### Project Notes / TODO List
- **New Feature**: Added a comprehensive Project Notes / TODO List dialog accessible via Tools menu or keyboard shortcut `L`
- Tabular interface with "Item" and "Notes" columns
- Checkbox column for checklist functionality
- Multi-line cell support with Excel-style keyboard navigation (Tab, Enter, Alt+Enter, Arrow keys)
- Resizable dialog with custom scrollbar styling
- Full persistence in project `.json` files
- Auto-save integration for project notes changes

### Centralized Tool State Management
- **Architecture Improvement**: Implemented singleton `ToolInstanceManager` for all drawing tools
- 11 distinct tool instances: via, padTop, padBottom, testPointTop, testPointBottom, traceTop, traceBottom, componentTop, componentBottom, power, ground
- Each tool instance maintains its own color and size attributes independently
- Eliminated state synchronization issues between tools
- Tool attributes are now persisted and restored with project files

### Enhanced Component Properties
- Added `description` field support for all component types
- Fixed bug where Description field was not being saved
- Fixed bug where Integrated Circuit Description was incorrectly copied to Designator
- Added clickable icon next to Datasheet URL to open in new browser tab
- Improved persistence for all component-specific fields (Datasheet, Manufacturer, Part Number, Film Type, etc.)
- Component type display names now use whitespace (e.g., "Integrated Circuit" instead of "IntegratedCircuit")

## Bug Fixes

### Auto-Save Directory Persistence
- **Critical Fix**: Fixed bug where auto-save was saving to incorrect directory after opening existing projects
- Auto-save now always saves to the same directory from which the project was originally created or opened
- Added directory verification to ensure correct file system access
- Improved handling of `getParent()` API compatibility across browsers
- Added `projectDirHandleRef` to maintain correct directory reference throughout project lifecycle

### Test Points Visibility
- Fixed bug where Test Points were incorrectly associated with other layers
- Test Points now correctly respond to their own layer visibility checkboxes
- Separated drawing logic for Test Points from Traces and Pads

### Tool State Synchronization
- Fixed issue where tool size was not updating correctly when using `+` and `-` keys
- Fixed toolbar size display flashing when switching between tools
- Fixed issue where Bottom layer tools were not updating size correctly
- Ensured tool instance attributes are the single source of truth

### Power/Ground Bus Manager
- Fixed bug where new bus input fields were moving around during editing
- New bus fields now remain at the bottom of the popup window during editing

### Information Dialog
- Removed "orientation" field
- Reorganized fields: Description, IC Type, and Notes now appear directly under Layer field
- Added single-line Notes field that opens Notes dialog on click
- Applied movement constraints matching Component Properties dialog

### Component Hover Tooltips
- Always displays component type
- Shows layer, description, and notes (when available)
- For ICs: displays IC type
- For other components: displays relevant information (e.g., capacitance, voltage, dielectric for Capacitors)

## UI/UX Improvements

### Dialog Enhancements
- Information dialog title changed from "Information (Ctrl+I)" to "Information (I)"
- Notes dialog title changed from "Notes (Ctrl+N)" to "Notes (N)"
- "Set Center Location" changed to "Set Home View"
- Project Notes dialog has custom scrollbar styling for better visibility
- Table header in Project Notes dialog is flush with dialog title (no gap)

### Toolbar Improvements
- Toolbar color picker now updates the active tool instance's color
- All toolbar icons now correctly display colors matching their tool instances
- Default via tool color set to green (`#2CA02C`)
- Default Connections color set to orange (`#E69F00`)

### Test Points Enhancements
- Default fill color changed to bright yellow (`#FFFF00`)
- Perimeter outline always remains black
- Option key hover now displays Notes popup
- Double-click opens Notes dialog
- Information dialog now presents same detailed information as Pads

### Layer Visibility Controls
- Added thin black borderlines between top/bottom checkboxes and Power checkbox
- Improved visual separation of layer groups

### About Menu Updates
- Tools & Shortcuts section now full-width column
- Added Notes Dialog shortcut information
- Added mention of troubleshooting electronics use case
- Updated PCB layer support description to "typical 2 to 4 layer PCBs"
- Simplified Technology section description
- Added file history auto-save information
- Marked KiCad export as future feature
- Added Future / TODO List section
- Added arrow key shortcuts for image transformations and component movement
- Added `+`/`-` key shortcuts for resizing icons

### Welcome Dialog
- Added bold note: "Best viewed in browser's Full Screen Mode"

## Technical Improvements

### Image Storage
- Changed from base64-encoded image data in JSON to relative file paths
- Significantly reduced project file sizes
- Images are now loaded from disk using stored file paths
- Project directory path stored in project JSON for consistent save locations

### Code Quality
- Removed verbose debug logging to improve performance
- Fixed 57 TypeScript compilation errors
- Improved type safety with explicit type definitions
- Better separation of concerns with centralized tool state management

### Documentation
- Created lessons learned document for auto-save directory persistence issue
- Improved code comments and documentation

## Version Information
- **Version**: 2.2.0
- **Release Date**: 2025-01-XX
- **Previous Version**: 2.1.0

## Migration Notes
- Project files from v2.1 are fully compatible with v2.2
- Images stored as base64 in older projects will continue to work (backward compatibility maintained)
- New projects will use file path storage for images
- Tool instance attributes are automatically initialized with defaults if not present in project file

